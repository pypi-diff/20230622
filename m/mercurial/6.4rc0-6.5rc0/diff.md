# Comparing `tmp/mercurial-6.4rc0.tar.gz` & `tmp/mercurial-6.5rc0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "mercurial-6.4rc0.tar", last modified: Thu Mar  2 22:30:09 2023, max compression
+gzip compressed data, was "mercurial-6.5rc0.tar", last modified: Thu Jun 22 12:24:49 2023, max compression
```

## Comparing `mercurial-6.4rc0.tar` & `mercurial-6.5rc0.tar`

### file list

```diff
@@ -1,2413 +1,2434 @@
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.278632 mercurial-6.4rc0/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      206 2023-03-02 22:29:51.000000 mercurial-6.4rc0/.arcconfig
--rw-r--r--   0 alphare   (1000) alphare   (1000)      343 2023-03-02 22:29:51.000000 mercurial-6.4rc0/.clang-format
--rw-r--r--   0 alphare   (1000) alphare   (1000)      348 2023-03-02 22:29:51.000000 mercurial-6.4rc0/.editorconfig
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.182632 mercurial-6.4rc0/.gitlab/
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.186632 mercurial-6.4rc0/.gitlab/merge_request_templates/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      550 2023-03-02 22:29:51.000000 mercurial-6.4rc0/.gitlab/merge_request_templates/Default.md
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1078 2023-03-02 22:29:51.000000 mercurial-6.4rc0/.hgignore
--rw-r--r--   0 alphare   (1000) alphare   (1000)   137224 2023-03-02 22:30:05.000000 mercurial-6.4rc0/.hgsigs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12002 2023-03-02 22:30:05.000000 mercurial-6.4rc0/.hgtags
--rw-r--r--   0 alphare   (1000) alphare   (1000)      614 2023-03-02 22:29:51.000000 mercurial-6.4rc0/.jshintrc
--rw-r--r--   0 alphare   (1000) alphare   (1000)      600 2023-03-02 22:29:51.000000 mercurial-6.4rc0/CONTRIBUTING
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1663 2023-03-02 22:29:51.000000 mercurial-6.4rc0/CONTRIBUTORS
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18092 2023-03-02 22:29:51.000000 mercurial-6.4rc0/COPYING
--rw-r--r--   0 alphare   (1000) alphare   (1000)    86667 2023-03-02 22:30:08.000000 mercurial-6.4rc0/MANIFEST.in
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9762 2023-03-02 22:29:51.000000 mercurial-6.4rc0/Makefile
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1323 2023-03-02 22:30:09.278632 mercurial-6.4rc0/PKG-INFO
--rw-r--r--   0 alphare   (1000) alphare   (1000)      958 2023-03-02 22:29:51.000000 mercurial-6.4rc0/README.rst
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3219 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/Makefile.python
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4067 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/all-revsets.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)      397 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/asv.conf.json
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/automation/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9805 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/README.rst
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1724 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/automation.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/automation/hgautomation/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1508 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/hgautomation/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    41049 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/hgautomation/aws.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14557 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/hgautomation/cli.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18087 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/hgautomation/linux.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      551 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/hgautomation/pypi.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2144 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/hgautomation/ssh.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2474 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/hgautomation/try_server.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17472 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/hgautomation/windows.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2081 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/hgautomation/winrm.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13276 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/linux-requirements-py3.5.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21872 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/linux-requirements-py3.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)      622 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/linux-requirements.txt.in
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15975 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/requirements.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)       28 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/automation/requirements.txt.in
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1711 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/base-revsets.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15235 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/bash_completion
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2142 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/bdiff-torture.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/benchmarks/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3952 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/benchmarks/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      614 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/benchmarks/perf.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1599 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/benchmarks/revset.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)    11670 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/byteify-strings.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      895 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/casesmash.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3627 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/catapipe.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)    35048 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/check-code.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3217 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/check-commit
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     5613 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/check-config.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3259 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/check-py3-compat.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     6143 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/check-pytype.sh
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/chg/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      895 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/chg/Makefile
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1223 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/chg/README
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1231 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/chg/chg.1
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14890 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/chg/chg.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15997 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/chg/hgclient.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)      866 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/chg/hgclient.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5881 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/chg/procutil.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)      528 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/chg/procutil.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4406 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/chg/util.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)      855 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/chg/util.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)      367 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/clang-format-ignorelist
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1179 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/debugcmdserver.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1452 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/debugshell.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.182632 mercurial-6.4rc0/contrib/docker/
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/docker/apache-server/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      520 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/docker/apache-server/Dockerfile
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5211 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/docker/apache-server/README.rst
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2154 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/docker/apache-server/entrypoint.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)       67 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/docker/apache-server/hgwebconfig
--rw-r--r--   0 alphare   (1000) alphare   (1000)      713 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/docker/apache-server/vhost.conf
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1351 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/dumprevlog
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1420 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/editmerge
--rw-r--r--   0 alphare   (1000) alphare   (1000)      102 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/editmergeps.bat
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1616 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/editmergeps.ps1
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/examples/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      496 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/examples/fix.hgrc
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/fuzz/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12668 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/FuzzedDataProvider.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4947 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/Makefile
--rw-r--r--   0 alphare   (1000) alphare   (1000)      894 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/README.rst
--rw-r--r--   0 alphare   (1000) alphare   (1000)      969 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/bdiff.cc
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1220 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/dirs.cc
--rw-r--r--   0 alphare   (1000) alphare   (1000)      661 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/dirs_corpus.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1062 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/dirstate.cc
--rw-r--r--   0 alphare   (1000) alphare   (1000)      479 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/dirstate_corpus.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1394 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/fm1readmarkers.cc
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1958 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/fm1readmarkers_corpus.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1851 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/fncache.cc
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1002 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/fuzzutil.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1398 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/jsonescapeu8fast.cc
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2075 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/manifest.cc
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1383 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/manifest_corpus.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3078 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/mpatch.cc
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23524 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/mpatch_corpus.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1752 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/pyutil.cc
--rw-r--r--   0 alphare   (1000) alphare   (1000)      228 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/pyutil.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1659 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/revlog.cc
--rw-r--r--   0 alphare   (1000) alphare   (1000)      812 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/revlog_corpus.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1515 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/standalone_fuzz_target_runner.cc
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1422 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/fuzz/xdiff.cc
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     4284 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/genosxversion.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4471 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/heptapod-ci.yml
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3541 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/hg-ssh
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3652 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/hg-test-mode.el
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4020 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/hgclient.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)   113188 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/hgk
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2903 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/hgperf
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/hgsh/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      160 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/hgsh/Makefile
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8745 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/hgsh/hgsh.c
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      669 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/hgweb.fcgi
--rw-r--r--   0 alphare   (1000) alphare   (1000)      678 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/hgweb.wsgi
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)    27296 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/import-checker.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10848 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/install-windows-dependencies.ps1
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8847 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/logo-droplets.svg
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1006 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/memory.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    44271 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/mercurial.el
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/merge-lists/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14485 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/merge-lists/Cargo.lock
--rw-r--r--   0 alphare   (1000) alphare   (1000)      599 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/merge-lists/Cargo.toml
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/merge-lists/src/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10241 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/merge-lists/src/main.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/merge-lists/tests/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3310 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/merge-lists/tests/test-merge-lists.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12462 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/mq.el
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/packaging/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4059 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/Makefile
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1123 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/build-linux-wheels.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2667 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/builddeb
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     4530 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/buildrpm
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.190632 mercurial-6.4rc0/contrib/packaging/debian/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      161 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/debian/cacerts.rc
--rw-r--r--   0 alphare   (1000) alphare   (1000)      164 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/debian/changelog
--rw-r--r--   0 alphare   (1000) alphare   (1000)        2 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/debian/compat
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1224 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/debian/control
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1072 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/debian/copyright
--rw-r--r--   0 alphare   (1000) alphare   (1000)       62 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/debian/default-tools.rc
--rw-r--r--   0 alphare   (1000) alphare   (1000)       38 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/debian/hgkpath.rc
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     4475 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/debian/rules
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/packaging/docker/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      298 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/docker/debian.template
--rw-r--r--   0 alphare   (1000) alphare   (1000)      275 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/docker/fedora.template
--rw-r--r--   0 alphare   (1000) alphare   (1000)      361 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/docker/rhel7
--rw-r--r--   0 alphare   (1000) alphare   (1000)      438 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/docker/rhel8
--rw-r--r--   0 alphare   (1000) alphare   (1000)      572 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/docker/rhel9
--rw-r--r--   0 alphare   (1000) alphare   (1000)      365 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/docker/ubuntu.template
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1462 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/dockerdeb
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1411 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/dockerrpm
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3501 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/hg-docker
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/packaging/hgpackaging/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/hgpackaging/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4074 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/hgpackaging/cli.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3728 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/hgpackaging/downloads.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4168 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/hgpackaging/inno.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5183 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/hgpackaging/pyoxidizer.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5918 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/hgpackaging/util.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2688 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/hgpackaging/wix.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/packaging/inno/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2424 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/inno/mercurial.iss
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5329 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/inno/modpath.iss
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1541 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/inno/readme.rst
--rw-r--r--   0 alphare   (1000) alphare   (1000)       59 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/linux-wheel-centos5-blacklist
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/packaging/macosx/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1857 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/macosx/Readme.html
--rw-r--r--   0 alphare   (1000) alphare   (1000)      794 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/macosx/Welcome.html
--rw-r--r--   0 alphare   (1000) alphare   (1000)      805 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/macosx/distribution.xml
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4843 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/mercurial.spec
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1312 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/packagelib.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1720 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/packaging.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2065 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/requirements-macos.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)      545 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/requirements-macos.txt.in
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24492 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/requirements-windows-py3.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)      507 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/requirements-windows.txt.in
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5151 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/requirements.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)      122 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/requirements.txt.in
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/packaging/wix/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1792 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/wix/COPYING.rtf
--rw-r--r--   0 alphare   (1000) alphare   (1000)      135 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/wix/defines.wxi
--rw-r--r--   0 alphare   (1000) alphare   (1000)      538 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/wix/guids.wxi
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5648 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/wix/mercurial.wxs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1949 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/packaging/wix/readme.rst
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/perf-utils/
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     5919 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/perf-utils/compare-discovery-case
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2659 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/perf-utils/discovery-helper.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3258 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/perf-utils/perf-revlog-write-plot.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     5321 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/perf-utils/search-discovery-case
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6001 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/perf-utils/subsetmaker.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)   124903 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/perf.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2439 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/phab-clean.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1315 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/phab-refresh-stack.sh
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/plan9/
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1050 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/plan9/9diff
--rw-r--r--   0 alphare   (1000) alphare   (1000)      277 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/plan9/9mail
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1761 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/plan9/README
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/plan9/hgrc.d/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      192 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/plan9/hgrc.d/9diff.rc
--rw-r--r--   0 alphare   (1000) alphare   (1000)       97 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/plan9/hgrc.d/9mail.rc
--rw-r--r--   0 alphare   (1000) alphare   (1000)      128 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/plan9/hgrc.d/factotum.rc
--rw-r--r--   0 alphare   (1000) alphare   (1000)      742 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/plan9/mkfile
--rw-r--r--   0 alphare   (1000) alphare   (1000)      478 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/plan9/proto
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4269 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/pull_logger.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9205 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/pylintrc
--rw-r--r--   0 alphare   (1000) alphare   (1000)      594 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-hook-examples.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/python-zstandard/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1484 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/LICENSE
--rw-r--r--   0 alphare   (1000) alphare   (1000)      139 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/MANIFEST.in
--rw-r--r--   0 alphare   (1000) alphare   (1000)    35617 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/NEWS.rst
--rw-r--r--   0 alphare   (1000) alphare   (1000)    62506 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/README.rst
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/python-zstandard/c-ext/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23805 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/bufferutil.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11571 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressionchunker.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11668 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressiondict.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17529 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressionparams.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18152 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressionreader.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10884 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressionwriter.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6748 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressobj.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    45707 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressor.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7048 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressoriterator.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4761 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/constants.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18046 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/decompressionreader.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9111 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/decompressionwriter.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5427 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/decompressobj.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    51907 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/decompressor.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7385 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/decompressoriterator.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4288 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/frameparams.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8819 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/c-ext/python-zstandard.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7177 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/make_cffi.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3335 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/setup.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6048 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/setup_zstd.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/python-zstandard/tests/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/tests/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5825 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/tests/common.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5171 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/tests/test_buffer_util.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    60810 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/tests/test_compressor.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    29165 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/tests/test_compressor_fuzzing.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9071 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/tests/test_data_structures.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2962 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/tests/test_data_structures_fuzzing.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    54630 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/tests/test_decompressor.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19315 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/tests/test_decompressor_fuzzing.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      274 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/tests/test_estimate_sizes.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1900 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/tests/test_module_attributes.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2892 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/tests/test_train_dictionary.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/python-zstandard/zstandard/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2390 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstandard/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    83092 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstandard/cffi.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/python-zstandard/zstd/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18091 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/COPYING
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1530 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/LICENSE
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.194632 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18345 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/bitstream.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5545 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/compiler.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4479 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/cpu.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1912 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/debug.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4960 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/debug.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9554 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/entropy_common.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2873 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/error_private.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2305 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/error_private.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    33031 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/fse.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11202 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/fse_decompress.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19952 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/huf.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14933 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/mem.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11059 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/pool.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2544 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/pool.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6667 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/pythoncapi_compat.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2819 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/threading.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5286 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/threading.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    29099 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/xxhash.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12781 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/xxhash.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2673 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/zstd_common.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3751 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/zstd_errors.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12480 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/common/zstd_internal.h
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.198632 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27542 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/fse_compress.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8544 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/hist.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4504 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/hist.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    32772 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/huf_compress.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)   172484 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_compress.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    40937 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_compress_internal.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5855 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_compress_literals.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1224 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_compress_literals.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19037 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_compress_sequences.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1910 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_compress_sequences.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19166 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_cwksp.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    25278 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_double_fast.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1283 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_double_fast.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21936 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_fast.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1203 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_fast.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    51720 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_lazy.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2745 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_lazy.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23858 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_ldm.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3850 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_ldm.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    57582 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_opt.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2016 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_opt.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    92625 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstdmt_compress.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9112 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstdmt_compress.h
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.198632 mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    50486 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/huf_decompress.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8874 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/zstd_ddict.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1308 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/zstd_ddict.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    72690 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    56849 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress_block.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2030 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress_block.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6992 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress_internal.h
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.198632 mercurial-6.4rc0/contrib/python-zstandard/zstd/deprecated/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11500 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/deprecated/zbuff.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1003 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/deprecated/zbuff_common.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5334 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/deprecated/zbuff_compress.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1919 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/deprecated/zbuff_decompress.c
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.198632 mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    42155 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/cover.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4569 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/cover.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    54649 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/divsufsort.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2419 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/divsufsort.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    28051 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/fastcover.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    43760 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/zdict.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17203 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/zdict.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)   119972 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd/zstd.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9897 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python-zstandard/zstd.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4572 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python3-ratchet.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17216 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/python3-whitelist
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6342 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/relnotes
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)    10429 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/revsetbenchmarks.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      853 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/setup-pytype.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)      679 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/showstack.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4007 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/simplemerge
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18553 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/synthrepo.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1581 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/tcsh_completion
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1955 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/tcsh_completion_build.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19926 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/testparseutil.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1403 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/undumprevlog
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.198632 mercurial-6.4rc0/contrib/vagrant/
--rw-r--r--   0 alphare   (1000) alphare   (1000)       80 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/vagrant/README.md
--rw-r--r--   0 alphare   (1000) alphare   (1000)      415 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/vagrant/Vagrantfile
--rw-r--r--   0 alphare   (1000) alphare   (1000)      292 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/vagrant/provision.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)      314 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/vagrant/run-tests.sh
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.198632 mercurial-6.4rc0/contrib/vim/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      859 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/vim/HGAnnotate.vim
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3533 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/vim/hg-menu.vim
--rw-r--r--   0 alphare   (1000) alphare   (1000)    58353 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/vim/hgcommand.vim
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1415 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/vim/hgtest.vim
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4024 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/vim/patchreview.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27369 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/vim/patchreview.vim
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.198632 mercurial-6.4rc0/contrib/win32/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4670 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/win32/ReadMe.html
--rw-r--r--   0 alphare   (1000) alphare   (1000)      267 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/win32/buildlocal.bat
--rw-r--r--   0 alphare   (1000) alphare   (1000)      509 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/win32/hg.bat
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4885 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/win32/hgwebdir_wsgi.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2238 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/win32/mercurial.ico
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2416 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/win32/mercurial.ini
--rw-r--r--   0 alphare   (1000) alphare   (1000)      248 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/win32/postinstall.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1227 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/xml.rnc
--rw-r--r--   0 alphare   (1000) alphare   (1000)    48881 2023-03-02 22:29:51.000000 mercurial-6.4rc0/contrib/zsh_completion
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.198632 mercurial-6.4rc0/doc/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1475 2023-03-02 22:29:51.000000 mercurial-6.4rc0/doc/Makefile
--rw-r--r--   0 alphare   (1000) alphare   (1000)      416 2023-03-02 22:29:51.000000 mercurial-6.4rc0/doc/README
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     6306 2023-03-02 22:29:51.000000 mercurial-6.4rc0/doc/check-seclevel.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1920 2023-03-02 22:29:51.000000 mercurial-6.4rc0/doc/docchecker
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)    11089 2023-03-02 22:29:51.000000 mercurial-6.4rc0/doc/gendoc.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2489 2023-03-02 22:30:05.000000 mercurial-6.4rc0/doc/hg-ssh.8
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5003 2023-03-02 22:30:07.000000 mercurial-6.4rc0/doc/hg-ssh.8.html
--rw-r--r--   0 alphare   (1000) alphare   (1000)   487539 2023-03-02 22:30:06.000000 mercurial-6.4rc0/doc/hg.1
--rw-r--r--   0 alphare   (1000) alphare   (1000)   779093 2023-03-02 22:30:08.000000 mercurial-6.4rc0/doc/hg.1.html
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4995 2023-03-02 22:30:06.000000 mercurial-6.4rc0/doc/hgignore.5
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8114 2023-03-02 22:30:08.000000 mercurial-6.4rc0/doc/hgignore.5.html
--rw-r--r--   0 alphare   (1000) alphare   (1000)    33848 2023-03-02 22:29:51.000000 mercurial-6.4rc0/doc/hgmanpage.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)   134509 2023-03-02 22:30:07.000000 mercurial-6.4rc0/doc/hgrc.5
--rw-r--r--   0 alphare   (1000) alphare   (1000)   197639 2023-03-02 22:30:08.000000 mercurial-6.4rc0/doc/hgrc.5.html
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1998 2023-03-02 22:29:51.000000 mercurial-6.4rc0/doc/runrst
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5415 2023-03-02 22:29:51.000000 mercurial-6.4rc0/doc/style.css
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1708 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hg
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.198632 mercurial-6.4rc0/hgdemandimport/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2585 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgdemandimport/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5451 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgdemandimport/demandimportpy3.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1645 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgdemandimport/tracing.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1226 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgeditor
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.202632 mercurial-6.4rc0/hgext/
--rw-r--r--   0 alphare   (1000) alphare   (1000)       67 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    41869 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/absorb.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14438 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/acl.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2349 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/amend.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4171 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/automv.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3128 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/beautifygraph.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6906 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/blackbox.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3766 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/bookflow.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    42492 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/bugzilla.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3973 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/censor.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2362 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/children.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7762 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/churn.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10723 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/clonebundles.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2717 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/closehead.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2404 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/commitextras.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.202632 mercurial-6.4rc0/hgext/convert/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23862 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12483 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/bzr.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17626 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/common.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22644 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/convcmd.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11351 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/cvs.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    36291 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/cvsps.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7837 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/darcs.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18068 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/filemap.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17697 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/git.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13259 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/gnuarch.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    25346 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/hg.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13877 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/monotone.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13026 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/p4.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    61956 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/subversion.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5365 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/convert/transport.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16679 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/eol.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    25435 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/extdiff.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4948 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/factotum.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.202632 mercurial-6.4rc0/hgext/fastannotate/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6532 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fastannotate/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12154 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fastannotate/commands.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    31416 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fastannotate/context.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      374 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fastannotate/error.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5879 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fastannotate/formatter.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8054 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fastannotate/protocol.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8726 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fastannotate/revmap.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4124 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fastannotate/support.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6982 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fastexport.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6520 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fetch.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    37191 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fix.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.202632 mercurial-6.4rc0/hgext/fsmonitor/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    33169 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fsmonitor/__init__.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.202632 mercurial-6.4rc0/hgext/fsmonitor/pywatchman/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    38268 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fsmonitor/pywatchman/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    32099 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fsmonitor/pywatchman/bser.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2665 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fsmonitor/pywatchman/capabilities.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2043 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fsmonitor/pywatchman/compat.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2822 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fsmonitor/pywatchman/encoding.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3650 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fsmonitor/pywatchman/load.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18028 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fsmonitor/pywatchman/pybser.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4744 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fsmonitor/state.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3883 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/fsmonitor/watchmanclient.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.202632 mercurial-6.4rc0/hgext/git/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1105 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/git/TODO.md
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11921 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/git/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11722 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/git/dirstate.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18158 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/git/gitlog.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      988 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/git/gitutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11605 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/git/index.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12250 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/git/manifest.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    33129 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/githelp.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11271 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/gpg.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3360 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/graphlog.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12065 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/hgk.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.202632 mercurial-6.4rc0/hgext/highlight/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3612 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/highlight/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3129 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/highlight/highlight.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    87682 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/histedit.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.202632 mercurial-6.4rc0/hgext/hooklib/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      999 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/hooklib/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3967 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/hooklib/changeset_obsoleted.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3766 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/hooklib/changeset_published.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1374 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/hooklib/enforce_draft_commits.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1335 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/hooklib/reject_merge_commits.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1233 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/hooklib/reject_new_heads.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.202632 mercurial-6.4rc0/hgext/infinitepush/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      943 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/infinitepush/README
--rw-r--r--   0 alphare   (1000) alphare   (1000)    45911 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/infinitepush/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3640 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/infinitepush/bundleparts.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1221 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/infinitepush/common.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3473 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/infinitepush/fileindexapi.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2066 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/infinitepush/indexapi.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1076 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/infinitepush/schema.sql
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9883 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/infinitepush/sqlindexapi.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6241 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/infinitepush/store.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20494 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/journal.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30687 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/keyword.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.206632 mercurial-6.4rc0/hgext/largefiles/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      172 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/largefiles/CONTRIBUTORS
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6901 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/largefiles/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6612 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/largefiles/basestore.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22797 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/largefiles/lfcommands.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26928 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/largefiles/lfutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2498 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/largefiles/localstore.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    64251 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/largefiles/overrides.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7703 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/largefiles/proto.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5159 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/largefiles/remotestore.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18695 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/largefiles/reposetup.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2663 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/largefiles/storefactory.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1572 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/largefiles/wirestore.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.206632 mercurial-6.4rc0/hgext/lfs/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7670 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/lfs/TODO.rst
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14598 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/lfs/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    29006 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/lfs/blobstore.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2847 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/lfs/pointer.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12003 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/lfs/wireprotolfsserver.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17138 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/lfs/wrapper.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2862 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/logtoprocess.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)   146637 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/mq.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.206632 mercurial-6.4rc0/hgext/narrow/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      782 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/narrow/TODO.rst
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2378 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/narrow/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11630 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/narrow/narrowbundle2.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24515 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/narrow/narrowcommands.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2519 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/narrow/narrowdirstate.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      890 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/narrow/narrowrepo.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1481 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/narrow/narrowtemplates.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4839 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/narrow/narrowwirepeer.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20518 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/notify.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2602 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/pager.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    31840 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/patchbomb.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    82651 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/phabricator.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1747 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/purge.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    83868 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/rebase.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5155 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/record.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22314 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/releasenotes.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6775 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/relink.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.206632 mercurial-6.4rc0/hgext/remotefilelog/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6096 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/README.md
--rw-r--r--   0 alphare   (1000) alphare   (1000)    42141 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18524 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/basepack.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15838 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/basestore.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2429 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/connectionpool.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      966 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/constants.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13163 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/contentstore.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15846 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/datapack.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13599 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/debugcommands.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22766 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/fileserverclient.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19110 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/historypack.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5241 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/metadatastore.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19317 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/remotefilectx.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15742 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/remotefilelog.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14389 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/remotefilelogserver.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    31000 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/repack.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11103 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/shallowbundle.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11964 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/shallowrepo.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      452 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/shallowstore.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15312 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/shallowutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      586 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotefilelog/shallowverifier.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13853 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/remotenames.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5338 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/schemes.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7884 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/share.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16293 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/show.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12320 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/sparse.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6905 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/split.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    40162 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/sqlitestore.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      914 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/strip.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30733 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/transplant.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10328 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/uncommit.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7071 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/win32mbcs.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7628 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/win32text.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.206632 mercurial-6.4rc0/hgext/zeroconf/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    61582 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/zeroconf/Zeroconf.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6996 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext/zeroconf/__init__.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.206632 mercurial-6.4rc0/hgext3rd/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      119 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgext3rd/__init__.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      685 2023-03-02 22:29:51.000000 mercurial-6.4rc0/hgweb.cgi
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.210632 mercurial-6.4rc0/i18n/
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     7524 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/check-translation.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)   528626 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/da.po
--rw-r--r--   0 alphare   (1000) alphare   (1000)   784964 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/de.po
--rw-r--r--   0 alphare   (1000) alphare   (1000)   252621 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/el.po
--rw-r--r--   0 alphare   (1000) alphare   (1000)   334018 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/fr.po
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     5323 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/hggettext
--rw-r--r--   0 alphare   (1000) alphare   (1000)   415076 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/it.po
--rw-r--r--   0 alphare   (1000) alphare   (1000)  1514507 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/ja.po
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1065 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/polib.LICENSE
--rw-r--r--   0 alphare   (1000) alphare   (1000)    62021 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/polib.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3205 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/posplit
--rw-r--r--   0 alphare   (1000) alphare   (1000)  1520505 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/pt_BR.po
--rw-r--r--   0 alphare   (1000) alphare   (1000)   427542 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/ro.po
--rw-r--r--   0 alphare   (1000) alphare   (1000)  1285212 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/ru.po
--rw-r--r--   0 alphare   (1000) alphare   (1000)   580645 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/sv.po
--rw-r--r--   0 alphare   (1000) alphare   (1000)   269346 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/zh_CN.po
--rw-r--r--   0 alphare   (1000) alphare   (1000)   323995 2023-03-02 22:29:51.000000 mercurial-6.4rc0/i18n/zh_TW.po
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.218632 mercurial-6.4rc0/mercurial/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      377 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)       61 2023-03-02 22:30:09.000000 mercurial-6.4rc0/mercurial/__version__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12717 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/ancestor.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10670 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/archival.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7249 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/bdiff.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)      463 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/bdiff.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1767 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/bitmanipulation.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    35416 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/bookmarks.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    32260 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/branchmap.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    89418 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/bundle2.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16011 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/bundlecaches.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24962 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/bundlerepo.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      788 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cacheutil.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.218632 mercurial-6.4rc0/mercurial/cext/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3638 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/base85.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)      145 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/base85.pyi
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7484 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/bdiff.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)      348 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/bdiff.pyi
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11094 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/charencode.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2198 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/charencode.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7224 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/dirs.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26543 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/manifest.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4542 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/mpatch.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)      193 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/mpatch.pyi
--rw-r--r--   0 alphare   (1000) alphare   (1000)    29410 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/osutil.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)      610 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/osutil.pyi
--rw-r--r--   0 alphare   (1000) alphare   (1000)    34935 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/parsers.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3107 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/parsers.pyi
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17426 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/pathencode.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)        8 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/py.typed
--rw-r--r--   0 alphare   (1000) alphare   (1000)    86522 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/revlog.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)      392 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/revlog.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2804 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cext/util.h
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.218632 mercurial-6.4rc0/mercurial/cffi/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cffi/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2431 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cffi/bdiff.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      717 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cffi/bdiffbuild.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1497 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cffi/mpatch.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1017 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cffi/mpatchbuild.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3864 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cffi/osutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2469 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cffi/osutilbuild.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    80539 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/changegroup.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20122 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/changelog.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26160 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/chgserver.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)   139581 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/cmdutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18319 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/color.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)   266807 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/commands.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24092 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/commandserver.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18666 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/commit.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1030 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/compat.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8656 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/config.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    53795 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/configitems.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)   103075 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/context.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    46956 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/copies.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    72638 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/crecord.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    40425 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/dagop.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15445 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/dagparser.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)   156082 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/debugcommands.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.218632 mercurial-6.4rc0/mercurial/defaultrc/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/defaultrc/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7436 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/defaultrc/mergetools.rc
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17445 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/destutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2300 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/diffhelper.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5099 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/diffutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    63927 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/dirstate.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26436 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/dirstatemap.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.218632 mercurial-6.4rc0/mercurial/dirstateutils/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/dirstateutils/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2270 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/dirstateutils/docket.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3926 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/dirstateutils/timestamp.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15148 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/dirstateutils/v2.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22406 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/discovery.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    46895 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/dispatch.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2246 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/dummycert.pem
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22710 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/encoding.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18219 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/error.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    97822 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/exchange.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4310 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/exewrapper.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    31766 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/extensions.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12044 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/exthelper.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11528 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/fancyopts.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9139 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/filelog.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    43641 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/filemerge.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18948 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/fileset.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10550 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/filesetlang.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26818 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/formatter.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17075 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/graphmod.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7283 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/grep.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11460 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hbisect.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    39685 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/help.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.218632 mercurial-6.4rc0/mercurial/helptext/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3349 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/bundlespec.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4608 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/color.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)      240 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/common.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)   127093 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/config.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1275 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/dates.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)      678 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/deprecated.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1358 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/diffs.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4385 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/environment.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2149 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/evolution.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1251 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/extensions.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2119 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/filesets.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3005 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/flags.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15214 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/glossary.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1856 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/hg-ssh.8.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3200 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/hg.1.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)      723 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/hgignore.5.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3418 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/hgignore.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)      795 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/hgrc.5.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3366 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/hgweb.txt
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.222632 mercurial-6.4rc0/mercurial/helptext/internals/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5459 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/bid-merge.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19670 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/bundle2.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3270 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/bundles.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3928 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/cbor.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1279 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/censor.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10485 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/changegroups.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3187 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/config.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24408 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/dirstate-v2.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13612 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/extensions.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11384 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/linelog.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2588 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/mergestate.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5895 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/requirements.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11319 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/revlogs.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    42319 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/wireprotocol.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    29462 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/wireprotocolrpc.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24727 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/internals/wireprotocolv2.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4513 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/merge-tools.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1467 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/pager.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3815 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/patterns.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3044 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/phases.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6980 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/revisions.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3178 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/rust.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8184 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/scripting.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7386 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/subrepos.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5975 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/templates.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2531 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/helptext/urls.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)    55483 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hg.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.222632 mercurial-6.4rc0/mercurial/hgweb/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3296 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hgweb/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9068 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hgweb/common.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18182 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hgweb/hgweb_mod.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20376 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hgweb/hgwebdir_mod.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22682 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hgweb/request.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13114 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hgweb/server.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    47598 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hgweb/webcommands.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27561 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hgweb/webutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3003 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hgweb/wsgicgi.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7020 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hgweb/wsgiheaders.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11752 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/hook.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4310 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/httpconnection.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20937 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/httppeer.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4080 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/i18n.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.222632 mercurial-6.4rc0/mercurial/interfaces/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/interfaces/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6642 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/interfaces/dirstate.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    66249 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/interfaces/repository.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1009 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/interfaces/util.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27889 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/keepalive.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15185 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/linelog.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)   146776 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/localrepo.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12020 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/lock.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    43811 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/logcmdutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5026 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/logexchange.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3936 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/loggingutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4134 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/lsprof.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2757 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/lsprofcalltree.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17155 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/mail.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    77108 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/manifest.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    53355 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/match.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17881 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/mdiff.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    92844 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/merge.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    31883 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/mergestate.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      463 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/mergeutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    33038 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/metadata.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3581 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/minifileset.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    29765 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/minirst.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8398 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/mpatch.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)      713 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/mpatch.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8293 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/namespaces.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12789 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/narrowspec.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1799 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/node.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    37622 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/obsolete.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    36632 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/obsutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26220 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/parser.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)   104081 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/patch.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12816 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/pathutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    33272 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/phases.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4716 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/policy.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24699 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/posix.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8772 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/profiling.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10401 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/progress.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.222632 mercurial-6.4rc0/mercurial/pure/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/pure/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2028 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/pure/base85.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2643 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/pure/bdiff.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2285 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/pure/charencode.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3592 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/pure/mpatch.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6042 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/pure/osutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    32278 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/pure/parsers.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1669 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/pushkey.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6075 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/pvec.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13845 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/pycompat.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6667 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/pythoncapi_compat.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3620 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/rcutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18156 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/registrar.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18832 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/repair.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4547 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/repocache.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17211 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/repoview.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4888 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/requirements.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)   123158 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlog.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.222632 mercurial-6.4rc0/mercurial/revlogutils/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2303 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlogutils/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1495 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlogutils/concurrency_checker.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9965 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlogutils/constants.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21533 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlogutils/debug.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    53081 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlogutils/deltas.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14441 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlogutils/docket.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7467 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlogutils/flagutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21951 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlogutils/nodemap.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5433 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlogutils/randomaccessfile.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3642 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlogutils/revlogv0.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    29504 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlogutils/rewrite.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6264 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revlogutils/sidedata.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    90863 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revset.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    29091 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/revsetlang.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8708 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/rewriteutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2740 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/scmposix.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    77872 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/scmutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3565 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/scmwindows.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7167 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/server.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18630 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/setdiscovery.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    40881 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/shelve.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3998 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/similar.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17294 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/simplemerge.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    34365 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/smartset.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27443 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/sparse.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23001 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/sshpeer.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    36608 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/sslutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      722 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/stack.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12263 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/state.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8014 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/statichttprepo.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    32685 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/statprof.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    25586 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/store.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    31570 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/streamclone.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9010 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/strip.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    75401 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/subrepo.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17665 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/subrepoutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11518 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/tagmerge.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30294 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/tags.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15534 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templatefilters.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30822 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templatefuncs.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    34854 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templatekw.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    39070 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templater.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.222632 mercurial-6.4rc0/mercurial/templates/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/__init__.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.222632 mercurial-6.4rc0/mercurial/templates/atom/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      321 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/bookmarkentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      372 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/bookmarks.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      315 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/branchentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      367 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/branches.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      282 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/changelog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1350 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/changelogentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      484 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/error.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      265 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/filelog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)       86 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/header.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      563 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/map
--rw-r--r--   0 alphare   (1000) alphare   (1000)      306 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/tagentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      353 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/atom/tags.tmpl
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.222632 mercurial-6.4rc0/mercurial/templates/coal/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/coal/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      549 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/coal/header.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)       45 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/coal/map
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.222632 mercurial-6.4rc0/mercurial/templates/gitweb/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1238 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/bookmarks.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1231 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/branches.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1276 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/changelog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      489 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/changelogentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2260 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/changeset.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1290 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/error.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2967 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/fileannotate.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2706 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/filecomparison.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2223 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/filediff.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2109 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/filelog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2813 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/filerevision.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      227 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/footer.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2394 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/graph.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      320 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/graphentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      527 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/header.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1181 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/help.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1645 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/helptopics.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      664 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/index.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1372 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/manifest.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17122 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/map
--rw-r--r--   0 alphare   (1000) alphare   (1000)      397 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/notfound.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1279 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/search.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1914 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/shortlog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2487 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/summary.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1208 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/gitweb/tags.tmpl
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.222632 mercurial-6.4rc0/mercurial/templates/json/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/json/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      124 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/json/changelist.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      117 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/json/graph.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6809 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/json/map
--rw-r--r--   0 alphare   (1000) alphare   (1000)      864 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/map-cmdline.bisect
--rw-r--r--   0 alphare   (1000) alphare   (1000)      854 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/map-cmdline.changelog
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1018 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/map-cmdline.compact
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3619 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/map-cmdline.default
--rw-r--r--   0 alphare   (1000) alphare   (1000)      263 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/map-cmdline.phases
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1106 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/map-cmdline.show
--rw-r--r--   0 alphare   (1000) alphare   (1000)      972 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/map-cmdline.status
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1624 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/map-cmdline.xml
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.226632 mercurial-6.4rc0/mercurial/templates/monoblue/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1465 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/bookmarks.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1457 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/branches.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1526 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/changelog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      467 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/changelogentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2622 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/changeset.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1499 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/error.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2962 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/fileannotate.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3034 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/filecomparison.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2545 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/filediff.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2177 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/filelog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2984 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/filerevision.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      486 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/footer.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2591 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/graph.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      371 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/graphentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      495 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/header.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1406 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/help.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1951 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/helptopics.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      945 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/index.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1700 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/manifest.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14563 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/map
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1657 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/notfound.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1487 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/search.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2112 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/shortlog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2854 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/summary.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1430 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/monoblue/tags.tmpl
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.226632 mercurial-6.4rc0/mercurial/templates/paper/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1447 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/bookmarks.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1440 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/branches.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2638 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/changeset.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      341 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/diffstat.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1005 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/error.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2882 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/fileannotate.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2702 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/filecomparison.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2422 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/filediff.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3124 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/filelog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      333 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/filelogentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2769 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/filerevision.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)       24 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/footer.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2806 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/graph.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      309 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/graphentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      458 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/header.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      920 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/help.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1311 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/helptopics.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      795 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/index.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1460 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/manifest.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11838 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/map
--rw-r--r--   0 alphare   (1000) alphare   (1000)      262 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/notfound.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1721 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/search.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2679 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/shortlog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      258 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/shortlogentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1407 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/paper/tags.tmpl
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.226632 mercurial-6.4rc0/mercurial/templates/raw/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)       67 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/changelog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      124 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/changeset.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)       24 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/error.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)       44 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/fileannotate.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)       27 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/filediff.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)       76 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/graph.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)       70 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/graphedge.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      240 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/graphnode.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)       30 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/index.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      172 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/logentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)       58 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/manifest.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1183 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/map
--rw-r--r--   0 alphare   (1000) alphare   (1000)       44 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/notfound.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      111 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/raw/search.tmpl
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.226632 mercurial-6.4rc0/mercurial/templates/rss/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      228 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/bookmarkentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      163 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/bookmarks.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      224 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/branchentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      158 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/branches.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      155 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/changelog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1534 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/changelogentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      241 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/error.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      174 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/filelog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      315 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/filelogentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      149 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/header.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      530 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/map
--rw-r--r--   0 alphare   (1000) alphare   (1000)      218 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/tagentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      153 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/rss/tags.tmpl
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.226632 mercurial-6.4rc0/mercurial/templates/spartan/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1044 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/branches.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1537 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/changelog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      973 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/changelogentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1764 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/changeset.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      174 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/error.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1712 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/fileannotate.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1342 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/filediff.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1415 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/filelog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      877 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/filelogentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1647 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/filerevision.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      162 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/footer.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1688 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/graph.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      320 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/graphentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      389 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/header.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      472 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/index.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      944 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/manifest.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9608 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/map
--rw-r--r--   0 alphare   (1000) alphare   (1000)      262 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/notfound.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      946 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/search.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1540 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/shortlog.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)      281 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/shortlogentry.tmpl
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1017 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/spartan/tags.tmpl
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.226632 mercurial-6.4rc0/mercurial/templates/static/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      603 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/background.png
--rw-r--r--   0 alphare   (1000) alphare   (1000)      273 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/coal-file.png
--rw-r--r--   0 alphare   (1000) alphare   (1000)      284 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/coal-folder.png
--rw-r--r--   0 alphare   (1000) alphare   (1000)      689 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/feed-icon-14x14.png
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10887 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/followlines.js
--rw-r--r--   0 alphare   (1000) alphare   (1000)      792 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/hgicon.png
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4123 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/hglogo.png
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15779 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/mercurial.js
--rw-r--r--   0 alphare   (1000) alphare   (1000)      608 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/style-extra-coal.css
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9074 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/style-gitweb.css
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10635 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/style-monoblue.css
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9313 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/style-paper.css
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2677 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templates/static/style.css
--rw-r--r--   0 alphare   (1000) alphare   (1000)    36367 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/templateutil.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.226632 mercurial-6.4rc0/mercurial/testing/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1499 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/testing/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1637 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/testing/revlog.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    47745 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/testing/storage.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.226632 mercurial-6.4rc0/mercurial/thirdparty/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/__init__.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/mercurial/thirdparty/attr/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1109 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/LICENSE
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1602 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15137 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/__init__.pyi
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4102 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/_cmp.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      357 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/_cmp.pyi
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5568 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/_compat.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      826 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/_config.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14645 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/_funcs.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    97569 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/_make.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5882 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/_next_gen.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2121 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/_version_info.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      209 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/_version_info.pyi
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3610 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/converters.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      416 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/converters.pyi
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1915 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/exceptions.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      539 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/exceptions.pyi
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1038 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/filters.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      215 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/filters.pyi
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/py.typed
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1400 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/setters.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      573 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/setters.pyi
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16793 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/validators.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2355 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/attr/validators.pyi
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/mercurial/thirdparty/cbor/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1764 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/cbor/.travis.yml
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1130 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/cbor/LICENSE.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1089 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/cbor/README.rst
--rw-r--r--   0 alphare   (1000) alphare   (1000)      141 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/cbor/__init__.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/mercurial/thirdparty/cbor/cbor2/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      224 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/cbor/cbor2/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2603 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/cbor/cbor2/compat.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11722 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/cbor/cbor2/decoder.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13687 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/cbor/cbor2/encoder.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1302 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/cbor/cbor2/types.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/mercurial/thirdparty/sha1dc/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1270 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/sha1dc/LICENSE.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5786 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/sha1dc/README.md
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6801 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/sha1dc/cext.c
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/mercurial/thirdparty/sha1dc/lib/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    57725 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/sha1dc/lib/sha1.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4368 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/sha1dc/lib/sha1.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    47913 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/sha1dc/lib/ubc_check.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1844 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/sha1dc/lib/ubc_check.h
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/mercurial/thirdparty/xdiff/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2316 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/xdiff/xdiff.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    29866 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/xdiff/xdiffi.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1683 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/xdiff/xdiffi.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1150 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/xdiff/xinclude.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1901 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/xdiff/xmacros.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13850 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/xdiff/xprepare.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1058 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/xdiff/xprepare.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2730 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/xdiff/xtypes.h
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3168 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/xdiff/xutils.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1331 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/xdiff/xutils.h
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/mercurial/thirdparty/zope/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/__init__.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2070 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/LICENSE.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3101 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1726 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/_compat.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1093 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/_flatten.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    45982 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/_zope_interface_coptimizations.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23342 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/adapter.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7526 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/advice.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/common/
--rw-r--r--   0 alphare   (1000) alphare   (1000)       61 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/common/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20067 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/common/idatetime.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4272 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/common/interfaces.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3445 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/common/mapping.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4698 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/common/sequence.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30880 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/declarations.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4015 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/document.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2039 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/exceptions.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20297 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/interface.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    43188 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/interfaces.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23084 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/registry.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2045 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/ro.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4688 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/thirdparty/zope/interface/verify.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27521 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/transaction.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7106 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/treediscovery.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      943 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/txnutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      955 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/typelib.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    84492 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/ui.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10136 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/unionrepo.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15110 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/upgrade.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/mercurial/upgrade_utils/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/upgrade_utils/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    35686 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/upgrade_utils/actions.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8754 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/upgrade_utils/auto_upgrade.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22379 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/upgrade_utils/engine.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22867 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/url.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3567 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/urllibcompat.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    95350 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/util.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/mercurial/utils/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/utils/__init__.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    37211 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/utils/cborutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    25623 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/utils/compression.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11775 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/utils/dateutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      175 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/utils/hashutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1410 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/utils/memorytop.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23010 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/utils/procutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      757 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/utils/repoviewutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3868 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/utils/resourceutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21551 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/utils/storageutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30373 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/utils/stringutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30569 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/utils/urlutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23428 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/verify.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27529 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/vfs.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22889 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/win32.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23634 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/windows.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    66136 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/wireprotoframing.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17715 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/wireprotoserver.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13261 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/wireprototypes.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21923 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/wireprotov1peer.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26898 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/wireprotov1server.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15337 2023-03-02 22:29:51.000000 mercurial-6.4rc0/mercurial/worker.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.218632 mercurial-6.4rc0/mercurial.egg-info/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1323 2023-03-02 22:30:09.000000 mercurial-6.4rc0/mercurial.egg-info/PKG-INFO
--rw-r--r--   0 alphare   (1000) alphare   (1000)    68610 2023-03-02 22:30:09.000000 mercurial-6.4rc0/mercurial.egg-info/SOURCES.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)        1 2023-03-02 22:30:09.000000 mercurial-6.4rc0/mercurial.egg-info/dependency_links.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)       40 2023-03-02 22:30:09.000000 mercurial-6.4rc0/mercurial.egg-info/top_level.txt
--rw-r--r--   0 alphare   (1000) alphare   (1000)      244 2023-03-02 22:29:51.000000 mercurial-6.4rc0/pyproject.toml
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/relnotes/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3757 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/5.1
--rw-r--r--   0 alphare   (1000) alphare   (1000)      897 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/5.2
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1233 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/5.3
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3507 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/5.4
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3504 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/5.5
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1391 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/5.6
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3078 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/5.7
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2742 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/5.8
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3417 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/5.9
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5198 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/6.0
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8465 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/6.1
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4671 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/6.2
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9264 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/6.3
--rw-r--r--   0 alphare   (1000) alphare   (1000)      630 2023-03-02 22:29:51.000000 mercurial-6.4rc0/relnotes/next
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/rust/
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/rust/.cargo/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      399 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/.cargo/config
--rw-r--r--   0 alphare   (1000) alphare   (1000)    36259 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/Cargo.lock
--rw-r--r--   0 alphare   (1000) alphare   (1000)       82 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/Cargo.toml
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4157 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/README.rst
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.230632 mercurial-6.4rc0/rust/chg/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23054 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/Cargo.lock
--rw-r--r--   0 alphare   (1000) alphare   (1000)      474 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/Cargo.toml
--rw-r--r--   0 alphare   (1000) alphare   (1000)      155 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/build.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/chg/src/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2503 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/src/attachio.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4071 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/src/clientext.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)      383 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/src/lib.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15481 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/src/locator.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2505 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/src/main.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10104 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/src/message.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2901 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/src/procutil.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2487 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/src/runcommand.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1335 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/src/sendfds.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3815 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/src/sighandlers.c
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2735 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/chg/src/uihandler.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-core/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1316 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/Cargo.toml
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.186632 mercurial-6.4rc0/rust/hg-core/examples/
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-core/examples/nodemap/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2437 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/examples/nodemap/index.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4339 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/examples/nodemap/main.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-core/src/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23431 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/ancestors.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4077 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/checkexec.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-core/src/config/
--rw-r--r--   0 alphare   (1000) alphare   (1000)        1 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/config/config.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12029 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/config/layer.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21307 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/config/mod.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2235 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/config/plain_info.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10001 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/config/values.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-core/src/copy_tracing/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4912 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/copy_tracing/tests.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5272 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/copy_tracing/tests_support.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22992 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/copy_tracing.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9183 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/dagops.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-core/src/dirstate/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13187 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/dirstate/dirs_multiset.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23661 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/dirstate/entry.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4230 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/dirstate/parsers.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4905 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/dirstate/status.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1124 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/dirstate.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-core/src/dirstate_tree/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    67100 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/dirstate_tree/dirstate_map.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    28509 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/dirstate_tree/on_disk.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2558 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/dirstate_tree/owning.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5821 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/dirstate_tree/path_with_basename.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    38403 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/dirstate_tree/status.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)       99 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/dirstate_tree.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23458 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/discovery.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7336 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/errors.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)      762 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/exit_codes.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24355 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/filepatterns.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4126 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/lib.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6596 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/lock.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3636 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/logging.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    55223 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/matchers.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3663 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/narrow.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-core/src/operations/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3364 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/operations/cat.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1080 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/operations/debugdata.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1256 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/operations/list_tracked_files.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)      409 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/operations/mod.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26827 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/repo.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6518 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/requirements.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-core/src/revlog/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8676 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/revlog/changelog.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7553 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/revlog/filelog.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17658 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/revlog/index.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6653 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/revlog/manifest.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22422 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/revlog/mod.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13553 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/revlog/node.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    35756 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/revlog/nodemap.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3648 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/revlog/nodemap_docket.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12050 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/revlog/patch.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18248 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/revlog/path_encode.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2139 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/revset.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10371 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/sparse.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1769 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/testing.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-core/src/utils/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3045 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/utils/debug.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13256 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/utils/files.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    25568 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/utils/hg_path.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7801 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/utils/path_auditor.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14848 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/utils.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6162 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/src/vfs.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-core/tests/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11317 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-core/tests/test_missing_ancestors.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-cpython/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      404 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/Cargo.toml
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-cpython/src/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8565 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/ancestors.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7156 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/cindex.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1016 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/conversion.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7114 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/copy_tracing.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2410 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/dagops.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)      822 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/debug.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hg-cpython/src/dirstate/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3383 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/dirstate/copymap.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3741 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/dirstate/dirs_multiset.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18684 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/dirstate/dirstate_map.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6905 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/dirstate/item.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10077 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/dirstate/status.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2013 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/dirstate.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5795 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/discovery.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2332 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/exceptions.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2377 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/lib.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1590 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/pybytes_deref.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4126 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/ref_sharing.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17409 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/revlog.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1481 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hg-cpython/src/utils.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hgcli/
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hgcli/.cargo/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      671 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hgcli/.cargo/config
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23621 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hgcli/Cargo.lock
--rw-r--r--   0 alphare   (1000) alphare   (1000)      819 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hgcli/Cargo.toml
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1958 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hgcli/README.md
--rw-r--r--   0 alphare   (1000) alphare   (1000)      577 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hgcli/build.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11709 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hgcli/pyoxidizer.bzl
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/hgcli/src/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1484 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/hgcli/src/main.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/rhg/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      516 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/Cargo.toml
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1741 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/README.md
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/rhg/src/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5429 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/blackbox.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7501 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/color.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/rhg/src/commands/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4086 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/commands/cat.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1059 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/commands/config.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2059 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/commands/debugdata.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1036 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/commands/debugignorerhg.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)      598 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/commands/debugrequirements.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1491 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/commands/debugrhgsparse.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3149 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/commands/files.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)      862 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/commands/root.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21984 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/commands/status.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9491 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/error.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27986 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/main.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8975 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/ui.rs
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.234632 mercurial-6.4rc0/rust/rhg/src/utils/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1756 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rust/rhg/src/utils/path_utils.rs
--rw-r--r--   0 alphare   (1000) alphare   (1000)       83 2023-03-02 22:29:51.000000 mercurial-6.4rc0/rustfmt.toml
--rw-r--r--   0 alphare   (1000) alphare   (1000)       38 2023-03-02 22:30:09.278632 mercurial-6.4rc0/setup.cfg
--rw-r--r--   0 alphare   (1000) alphare   (1000)    59222 2023-03-02 22:29:51.000000 mercurial-6.4rc0/setup.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.274632 mercurial-6.4rc0/tests/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      556 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/.balto.toml
--rw-r--r--   0 alphare   (1000) alphare   (1000)      141 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/README
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.274632 mercurial-6.4rc0/tests/artifacts/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      396 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/artifacts/PURPOSE
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.274632 mercurial-6.4rc0/tests/artifacts/cache/
--rw-r--r--   0 alphare   (1000) alphare   (1000)       33 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/artifacts/cache/big-file-churn.hg.md5
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.274632 mercurial-6.4rc0/tests/artifacts/scripts/
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     4407 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/artifacts/scripts/generate-churning-bundle.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1558 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/autodiff.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1523 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/basic_test_result.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      593 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/binfile.bin
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1103 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/blackbox-readonly-dispatch.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.274632 mercurial-6.4rc0/tests/blacklists/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      516 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/blacklists/README
--rw-r--r--   0 alphare   (1000) alphare   (1000)      992 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/blacklists/fsmonitor
--rw-r--r--   0 alphare   (1000) alphare   (1000)      443 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/blacklists/linux-vfat
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2242 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bruterebase.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.274632 mercurial-6.4rc0/tests/bundles/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1314 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/darcs1.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10686 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/hgweb+obs.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2216 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/issue4041.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4151 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/issue4438-r1.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3864 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/issue4438-r2.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2223 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/issue6528.hg-v1
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2406 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/issue6528.hg-v2
--rw-r--r--   0 alphare   (1000) alphare   (1000)    61440 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/issue6528.tar
--rw-r--r--   0 alphare   (1000) alphare   (1000)      548 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/legacy-encoding.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1844 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/rebase-revset.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1663 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/rebase.hg
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      484 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/rebase.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1768 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/remote.hg
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      520 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/remote.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      346 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/rename.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1600 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/renames.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1171 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/tampered.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)      847 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/test-invalid-branch-name.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)      302 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/test-keyword.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)      596 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/test-manifest.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)      947 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/test-merge-symlinks.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)      558 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/test-no-symlinks.hg
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1175 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/test-revlog-diff-relative-to-nullrev.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30720 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bundles/test-revlog-diff-relative-to-nullrev.tar
--rw-r--r--   0 alphare   (1000) alphare   (1000)      379 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/bzr-definitions
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1751 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/cgienv
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      343 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/check-gendoc
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2649 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/check-perf-code.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7216 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/common-pattern.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      247 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/crashgetbundler.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13103 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/drawdag.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2723 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/dumbhttp.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3302 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/dummysmtpd.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      893 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/dummyssh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     7306 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/f
--rw-r--r--   0 alphare   (1000) alphare   (1000)      281 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/failfilemerge.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3043 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/fakedirstatewritetime.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      763 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/fakemergerecord.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1197 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/fakepatchtime.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      837 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/filterpyflakes.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1004 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/filtertraceback.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3850 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/flagprocessorext.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     4760 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/fsmonitor-run-tests.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3417 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/generate-working-copy-states.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3624 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/get-with-headers.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.274632 mercurial-6.4rc0/tests/gpg/
--rw-r--r--   0 alphare   (1000) alphare   (1000)      597 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/gpg/pubring.gpg
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1248 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/gpg/secring.gpg
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1280 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/gpg/trustdb.gpg
--rw-r--r--   0 alphare   (1000) alphare   (1000)       71 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/helper-killhook.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      122 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/helper-runtests.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1975 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/helpers-testrepo.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)      592 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/heredoctest.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1807 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/hghave
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30375 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/hghave.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1288 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/hgterm.ti
--rw-r--r--   0 alphare   (1000) alphare   (1000)      712 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/hgweberror.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      229 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/histedit-helpers.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3863 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/httpserverauth.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2172 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/hypothesishelpers.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     4279 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/killdaemons.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      551 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/library-infinitepush.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)      617 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/list-tree.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      641 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/lockdelay.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1842 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/logexceptions.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      874 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/ls-l.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      907 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/md5sum.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1077 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/missing-comment.hg
--rw-r--r--   0 alphare   (1000) alphare   (1000)      324 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/mockblackbox.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      494 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/mockmakedate.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      400 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/mocktime.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)       83 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/narrow-library.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)      866 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/notcapable
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1942 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/pdiff
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.278632 mercurial-6.4rc0/tests/phabricator/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7191 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/accept-4564.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7072 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/accept-7913.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2669 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phab-conduit.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15402 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabimport-multi-drev.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    33114 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabimport-stack.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)   205871 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabread-4480.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2644 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabread-conduit-error.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3689 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabread-empty-drev.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)   229411 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabread-multi-drev.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)   121698 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabread-str-time.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27576 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-add-parent-setup.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    49804 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-add-parent.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)   152473 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-binary-renames.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    84767 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-binary.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27924 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-comment-created.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26060 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-comment-updated.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27824 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-create-alpha.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    44412 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-create-public.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    50737 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-fold-extend-end.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    57601 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-fold-extend-front.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    55187 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-fold-fold-end.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30330 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-fold-immutable.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    36865 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-fold-initial.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    37814 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-fold-no-changes.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    55587 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-fold-split-end.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    42002 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-fold-updated.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    50297 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-hash-fixes.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    57999 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-no-restack-orphan.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9076 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-skipped.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    48342 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabsend-update-alpha-create-beta.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8414 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabupdate-change-6876.json
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11184 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/phabricator/phabupdate-revs.json
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1939 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/printenv.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1443 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/printrevset.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1472 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/pullext.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      270 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/readlink.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      666 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/remotefilelog-getflogheads.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1108 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/remotefilelog-library.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1999 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/revlog-formatv0.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      537 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/revnamesext.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)   142406 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/run-tests.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      667 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/seq.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      681 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/silenttestrunner.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20194 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/simplestorerepo.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      418 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/sitecustomize.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3606 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/sshprotoext.py
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.278632 mercurial-6.4rc0/tests/sslcerts/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1824 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/sslcerts/README
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1025 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/sslcerts/client-cert.pem
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1679 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/sslcerts/client-key-decrypted.pem
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1766 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/sslcerts/client-key.pem
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1679 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/sslcerts/priv.pem
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1172 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/sslcerts/pub-expired.pem
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1172 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/sslcerts/pub-not-yet.pem
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1172 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/sslcerts/pub-other.pem
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1172 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/sslcerts/pub.pem
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.278632 mercurial-6.4rc0/tests/svn/
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5686 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/branches.svndump
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1556 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/empty.svndump
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3506 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/encoding.svndump
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7715 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/move.svndump
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5119 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/replace.svndump
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2863 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/startrev.svndump
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1489 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/svndump-branches.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      866 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/svndump-empty.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1055 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/svndump-encoding.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2316 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/svndump-move.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1496 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/svndump-replace.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      732 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/svndump-startrev.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1196 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/svndump-tags.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4518 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn/tags.svndump
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      641 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svn-safe-append.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      312 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svnurlof.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1852 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/svnxml.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      873 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-abort-checkin.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      996 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-absorb-edit-lines.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6634 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-absorb-filefixupstate.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      389 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-absorb-phase.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5855 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-absorb-rename.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      662 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-absorb-strip.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      797 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-absorb-unfinished.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14017 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-absorb.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    86954 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-acl.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6650 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-add.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3884 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-addremove-similar.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1870 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-addremove.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18133 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-alias.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3679 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-amend-subrepo.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17931 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-amend.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13052 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ancestor.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1412 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ancestor.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3805 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-annotate.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23421 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-annotate.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2610 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-arbitraryfilectx.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      665 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-archive-symlinks.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20069 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-archive.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4259 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-atomictempfile.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5098 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-audit-path.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16196 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-audit-subrepo.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7137 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-automv.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18446 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-backout.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      315 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-backwards-remove.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7260 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bad-extension.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      316 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bad-pull.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5569 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-basic.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6140 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-batching.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      360 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-batching.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5634 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bdiff.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8275 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bheads.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23161 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bisect.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20453 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bisect2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6194 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bisect3.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18291 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-blackbox.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8063 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bookflow.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6580 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bookmarks-corner-case.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5516 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bookmarks-current.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4267 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bookmarks-merge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    44556 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bookmarks-pushpull.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2533 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bookmarks-rebase.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1007 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bookmarks-strip.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    35122 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bookmarks.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10152 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-branch-change.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3189 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-branch-option.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1612 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-branch-tag-confict.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    44923 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-branches.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3274 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bugzilla.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8967 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bundle-phases.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7443 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bundle-r.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7084 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bundle-type.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2443 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bundle-vs-outgoing.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    31696 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bundle.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    43152 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bundle2-exchange.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    54392 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bundle2-format.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12377 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bundle2-multiple-changegroups.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2709 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bundle2-pushback.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20851 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-bundle2-remote-changegroup.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5637 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-byteify-strings.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2625 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-cache-abuse.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2586 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-cappedreader.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6940 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-casecollision-merge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1317 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-casecollision.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4774 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-casefolding.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2137 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-cat.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    41647 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-cbor.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15868 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-censor.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      553 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-censor2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1090 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-changelog-exec.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      353 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-cargo-lock.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      344 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-clang-format.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3619 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-code.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      808 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-commit.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1527 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-config.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      819 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-encoding.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      630 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-execute.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      282 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-format.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      930 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-help.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7070 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-interfaces.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      129 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-interfaces.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)      250 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-jshint.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1628 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-module-imports.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1341 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-py3-compat.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1357 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-pyflakes.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      672 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-pylint.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      333 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-rust-format.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      868 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-check-shbang.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15236 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-chg.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3023 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-children.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6254 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-churn.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1165 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-clone-cgi.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1110 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-clone-pull-corruption.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5762 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-clone-r.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11689 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-clone-stream-format.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    28239 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-clone-stream.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3510 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-clone-update-order.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    34119 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-clone.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24618 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-clonebundles.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1903 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-close-head.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    37292 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-commandserver.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    34068 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-commit-amend.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9765 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-commit-interactive-curses.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    41248 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-commit-interactive.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3748 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-commit-multiple.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3706 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-commit-unresolved.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21377 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-commit.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2582 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-committer.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11778 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-completion.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1289 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-config-env.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      126 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-config-env.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1847 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-config-parselist.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12114 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-config.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8500 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-conflict.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1247 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-confused-revert.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1662 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-context-metadata.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6542 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-context.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3689 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-context.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10068 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-contrib-check-code.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5067 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-contrib-check-commit.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1954 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-contrib-dumprevlog.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      272 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-contrib-emacs.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13515 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-contrib-perf.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2778 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-contrib-pull-logger.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16331 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-contrib-relnotes.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4603 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-contrib-testparseutil.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3874 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-contrib.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1240 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-authormap.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5379 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-baz.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      909 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-bzr-114.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4434 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-bzr-directories.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1056 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-bzr-ghosts.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7907 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-bzr-merges.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      829 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-bzr-treeroot.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6769 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-bzr.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2014 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-clonebranches.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3434 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-cvs-branch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5333 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-cvs-detectmerge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4820 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-cvs-synthetic.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13591 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-cvs.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1633 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-cvsnt-mergepoints.rlog
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4145 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-cvsnt-mergepoints.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2714 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-darcs.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3561 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-datesort.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23634 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-filemap.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    36476 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-git.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14524 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-hg-sink.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5365 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-hg-source.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5249 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-hg-startrev.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3143 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-hg-svn.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1419 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-identity.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10881 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-mtn.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22001 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-p4-filetypes.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4433 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-p4.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6551 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-splicemap.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3189 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-svn-branches.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9522 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-svn-encoding.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7941 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-svn-move.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11917 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-svn-sink.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9220 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-svn-source.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1736 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-svn-startrev.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1069 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-svn-tags.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2335 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-tagsbranch-topology.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4094 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert-tla.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    25882 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-convert.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)   124298 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-copies-chain-merge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11545 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-copies-in-changeset.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10489 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-copies-unrelated.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16541 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-copies.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5785 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-copy-move-merge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9637 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-copy.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15518 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-copytrace-heuristics.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1611 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-custom-filters.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1051 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-debian-packages.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2204 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-debug-revlog-stats.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      869 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-debugbackupbundle.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5472 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-debugbuilddag.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4120 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-debugbundle.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21971 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-debugcommands.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2940 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-debugextensions.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      606 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-debugindexdot.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      388 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-debugrename.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4703 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-default-push.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5663 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-demandimport.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21614 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-devel-warnings.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1124 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-antipatience.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4788 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-binary-file.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7578 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-change.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11791 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-color.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      795 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-copy-depth.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1056 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-hashes.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8194 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-ignore-whitespace.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4513 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-indent-heuristic.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      459 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-issue2761.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      445 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-newlines.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      902 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-reverse.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      943 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-subdir.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8479 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-unified.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6296 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diff-upgrade.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1485 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diffdir.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6598 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-diffstat.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4906 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-directaccess.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      604 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-dirs.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      305 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-dirstate-backup.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6633 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-dirstate-race.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2733 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-dirstate-race2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9345 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-dirstate-read-race.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12104 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-dirstate-status-write-race.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12203 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-dirstate.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      937 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-dispatch.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      466 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-dispatch.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6044 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-dispatch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1013 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-docker-packaging.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5899 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-doctest.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1800 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-double-merge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4477 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-drawdag.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1185 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-duplicateoptions.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1440 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-editor-filename.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      397 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-empty-dir.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1108 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-empty-file.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3167 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-empty-group.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      572 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-empty-manifest-index.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      674 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-empty.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1360 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-encode.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5481 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-encoding-align.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2346 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-encoding-func.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22566 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-encoding-textwrap.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7950 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-encoding.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2455 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-eol-add.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2836 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-eol-clone.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5709 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-eol-hook.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7155 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-eol-patch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      574 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-eol-tag.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5950 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-eol-update.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12586 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-eol.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1523 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-eolfilename.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2664 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-excessive-merge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19298 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-multi-source.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9663 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4085 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8626 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A3.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4371 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A4.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4892 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A5.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4905 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A6.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2486 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A7.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2534 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4445 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2931 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B3.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5076 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B4.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5821 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B5.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4175 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B6.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2577 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B7.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6366 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-C1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7100 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-C2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8406 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-C3.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4994 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-C4.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7261 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-D1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4077 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-D2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3309 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-D3.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5978 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-D4.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      558 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-execute-bit.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10130 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-export.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2952 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-extdata.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15703 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-extdiff.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4177 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-extension-timing.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    66612 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-extension.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2867 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-extensions-afterloaded.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2033 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-extensions-wrapfunction.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      600 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-extensions-wrapfunction.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)      415 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-extra-filelog-entry.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2828 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fastannotate-corrupt.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      347 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fastannotate-diffopts.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15037 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fastannotate-hg.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3473 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fastannotate-perfhack.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5507 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fastannotate-protocol.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4254 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fastannotate-renames.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5097 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fastannotate-revmap.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5060 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fastannotate.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11832 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fastexport.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13057 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fetch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3417 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-filebranch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6905 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-filecache.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1108 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-filecache.py.out
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1615 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-filelog.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)       86 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-filelog.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6549 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fileset-generated.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19138 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fileset.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      755 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fix-clang-format.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3111 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fix-metadata.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1163 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fix-pickle.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12446 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fix-topology.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    49587 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fix.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8391 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-flagprocessor.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3836 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-flags.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15010 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fncache.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2126 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-fuzz-targets.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)       84 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc-da.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      310 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc-de.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)       84 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc-el.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)       84 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc-fr.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)       84 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc-it.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1426 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc-ja.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)       87 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc-pt_BR.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      471 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc-ro.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)       84 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc-ru.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)       84 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc-sv.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)       87 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc-zh_CN.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)       87 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc-zh_TW.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1150 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gendoc.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    32322 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-generaldelta.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14689 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-getbundle.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11999 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-git-export.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10580 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-git-interop.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8772 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-githelp.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16188 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-globalopts.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)   150556 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-glog-beautifygraph.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1784 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-glog-topological.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)   103725 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-glog.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1181 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-gpg.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18653 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-graft-interrupted.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18392 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-graft-rename.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23358 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-graft.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    38658 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-grep.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10253 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hardlinks.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2003 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hashutil.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9357 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-help-hide.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)   128642 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-help.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1643 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hg-parseurl.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1128 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hghave.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12337 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgignore.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1081 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgk.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8333 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgrc.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18885 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-annotate-whitespace.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5615 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-auth.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5923 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-auth.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)      788 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-bundle.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    75077 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-commands.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4853 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-csp.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15593 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-descend-empties.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    33421 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-diffs.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11671 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-empty.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    55770 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-filelog.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2586 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-head.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    52934 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-json.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3974 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-no-path-info.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4554 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-no-request-uri.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2682 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-non-interactive.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7427 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-raw.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7184 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-removed.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    66313 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb-symrev.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    25486 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgweb.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1310 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgwebdir-gc.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1135 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgwebdir-paths.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    55395 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgwebdir.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1650 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hgwebdirsym.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    38679 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-highlight.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16047 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-arguments.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7495 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-base.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4868 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-bookmark-motion.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14894 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-commute.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4253 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-drop.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13888 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-edit.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8748 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-fold-non-commute.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15025 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-fold.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2109 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-merge-tools.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2109 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-no-backup.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6771 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-no-change.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4855 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-non-commute-abort.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8643 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-non-commute.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16204 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-obsolete.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4253 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-outgoing.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1658 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-histedit-templates.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    39716 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hook.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3424 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hooklib-changeset_obsoleted.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2586 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hooklib-changeset_published.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1332 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hooklib-enforce_draft_commits.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2383 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hooklib-reject_merge_commits.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1443 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hooklib-reject_new_heads.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    73170 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-http-bad-server.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3037 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-http-branchmap.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15583 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-http-bundle1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4808 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-http-clone-r.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    36449 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-http-permissions.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26308 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-http-protocol.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6588 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-http-proxy.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24997 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-http.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26348 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-https.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    55194 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-hybridencode.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2011 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-i18n.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3622 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-identify.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1997 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-impexp-branch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9395 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-import-bypass.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2458 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-import-context.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3704 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-import-eol.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20483 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-import-git.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4326 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-import-merge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1410 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-import-unknown.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    46738 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-import.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4550 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-imports-checker.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12486 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-incoming-outgoing.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11558 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-infinitepush-bundlestore.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11925 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-infinitepush-ci.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5503 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-infinitepush.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5190 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-inherit-mode.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8091 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-init.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11932 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-install.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      315 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue1089.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      758 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue1102.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1942 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue1175.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2172 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue1306.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      384 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue1438.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1186 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue1502.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1637 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue1802.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1124 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue1877.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1192 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue1993.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1580 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue2137.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10113 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue3084.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      539 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue4074.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1471 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue522.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2023 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue586.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      658 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue5979.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      634 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue612.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      766 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue619.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19399 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue6528.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2291 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue660.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      964 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue6642.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2935 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue672.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      742 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-issue842.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1232 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-journal-exists.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4778 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-journal-share.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9065 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-journal.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    32361 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-keyword.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1278 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-known.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7997 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-largefiles-cache.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    33975 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-largefiles-misc.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2057 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-largefiles-small-disk.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26281 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-largefiles-update.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13520 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-largefiles-wireproto.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    51951 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-largefiles.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1032 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-legacy-exit-code.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13714 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-lfconvert.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2848 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-lfs-bundle.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11706 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-lfs-largefiles.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1190 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-lfs-pointer.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      850 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-lfs-pointer.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30811 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-lfs-serve-access.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27515 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-lfs-serve.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    36644 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-lfs-test-server.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    42071 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-lfs.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7649 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-linelog.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7590 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-linerange.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      122 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-locale.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2323 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-locate.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4245 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-lock-badness.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6026 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-lock.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4833 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-log-bookmark.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1642 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-log-exthook.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18865 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-log-linerange.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    68329 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-log.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14206 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-logexchange.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3530 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-logtoprocess.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10794 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-lrucachedict.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3199 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mac-packages.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      980 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mactext.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2382 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mailmap.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      752 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-manifest-merging.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15640 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-manifest.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12481 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-manifest.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    44127 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-match.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      567 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mdiff.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    40965 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-changedelete.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2313 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-closedheads.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1918 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-combination-exec-bytes.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2274 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-combination-file-content.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1676 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-combination-misc.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5133 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-commit.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    32155 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-criss-cross.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4851 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-default.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8918 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-exec.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    34758 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-force.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4777 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-halt.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3361 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-internal-tools-pattern.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3449 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-local.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10097 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-no-file-change.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9347 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-partial-tool.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2360 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-remove.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1369 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-revert.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1917 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-revert2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3860 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-subrepos.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1554 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-symlinks.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    50588 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-tools.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13943 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge-types.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11059 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1499 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge10.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1215 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1897 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge4.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      853 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge5.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1940 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge6.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3847 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge7.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      727 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge8.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1735 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-merge9.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1254 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-minifileset.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5522 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-minirst.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21558 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-minirst.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1288 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-missing-capability.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4378 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-eol.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4771 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-git.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10778 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-guards.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17910 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-header-date.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20216 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-header-from.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3470 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-merge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3570 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-missingfiles.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2933 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-pull-from-bundle.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4092 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qclone-http.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3561 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qdelete.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2507 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qdiff.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4831 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qfold.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1464 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qgoto.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      772 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qimport-fail-cleanup.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7753 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qimport.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8431 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qnew.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5559 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qpush-exact.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9769 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qpush-fail.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2771 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qqueue.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8592 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qrefresh-interactive.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7908 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qrefresh-replace-log-message.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8796 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qrefresh.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1862 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qrename.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      256 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-qsave.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4935 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-safety.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1054 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-subrepo-svn.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15369 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-subrepo.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1835 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq-symlinks.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    31781 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mq.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22377 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-mv-cp-st-diff.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1883 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-acl.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      803 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-archive.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3683 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-clone-no-ellipsis.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2035 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-clone-non-narrow-server.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4410 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-clone-nonlinear.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2308 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-clone-stream.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7096 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-clone.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2938 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-commit.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1938 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-copies.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1644 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-debugcommands.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      910 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-debugrebuilddirstate.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5903 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-exchange-merges.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5948 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-exchange.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5239 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-expanddirstate.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4500 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-merge-outside.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4157 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-merge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1792 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-patch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10109 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-patterns.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3580 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-pull.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2756 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-rebase.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10763 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-shallow-merges.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3156 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-shallow.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4853 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-share.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2136 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-sparse.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5180 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-strip.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5863 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-trackedcmd.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1836 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-update.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9376 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-widen-no-ellipsis.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8778 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow-widen.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16779 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-narrow.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      559 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-nested-repo.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12402 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-newbranch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1682 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-newcgi.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1463 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-newercgi.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1259 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-no-symlinks.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2482 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-nointerrupt.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5530 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-notify-changegroup.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    26430 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-notify.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15592 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-obshistory.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    93773 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-obsmarker-template.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4312 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-obsmarkers-effectflag.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1209 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-obsolete-bounds-checking.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    95912 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-obsolete-bundle-strip.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5687 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-obsolete-changeset-exchange.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6138 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-obsolete-check-push.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7942 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-obsolete-checkheads.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24306 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-obsolete-distributed.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    23743 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-obsolete-divergent.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4876 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-obsolete-tag-cache.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    69008 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-obsolete.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2056 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-oldcgi.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3471 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-origbackup-conflict.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7516 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pager-legacy.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11338 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pager.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3138 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-parents.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9312 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-parse-date.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7553 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-parseindex.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10978 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-parseindex2.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1694 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-patch-offset.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2627 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-patch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4725 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-patchbomb-bookmark.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2574 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-patchbomb-tls.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    97644 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-patchbomb.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2592 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pathconflicts-basic.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5032 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pathconflicts-merge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3977 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pathconflicts-update.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6697 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pathencode.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13367 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-paths.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3495 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pending.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1105 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-permissions.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    42259 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-persistent-nodemap.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    35925 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-phabricator.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4034 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-phase-archived.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    43157 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-phases-exchange.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30068 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-phases.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4913 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-profile.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    17423 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-progress.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6790 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-propertycache.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2213 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-propertycache.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5716 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pull-branch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6939 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pull-bundle.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2567 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pull-http.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3488 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pull-network.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      505 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pull-permission.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1598 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pull-pull-corruption.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4647 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pull-r.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6763 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pull-update.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      220 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-purge-ignored-directory.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6620 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-purge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2742 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-cgi.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2138 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-multibranches-E1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2513 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-multibranches-E2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2286 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-multibranches-E3.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1995 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-partial-C1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2050 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-partial-C2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1910 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-partial-C3.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1953 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-partial-C4.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1601 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-pruned-B1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2148 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-pruned-B2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2113 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-pruned-B3.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2073 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-pruned-B4.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2324 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-pruned-B5.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1932 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-pruned-B6.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1928 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-pruned-B7.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2691 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-pruned-B8.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1590 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-superceed-A1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2164 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-superceed-A2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2238 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-superceed-A3.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1709 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-superceed-A4.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1707 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-superceed-A5.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2653 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-superceed-A6.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2655 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-superceed-A7.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1954 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-superceed-A8.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1860 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2437 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2958 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D3.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3248 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D4.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3091 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D5.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2070 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D6.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2501 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D7.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16504 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-http.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    46216 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-race.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18907 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push-warn.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9108 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-push.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1659 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-pushvars.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10654 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-qrecord.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3897 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-racy-mutations.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2373 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rank.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11362 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-abort.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2630 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-backup.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7413 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-base-flag.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5506 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-bookmarks.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1156 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-brute-force.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9101 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-cache.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4409 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-check-restore.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15767 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-collapse.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12666 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-conflicts.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9743 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-dest.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5607 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-detach.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1181 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-empty-successor.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4515 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-emptycommit.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24186 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-inmemory.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11860 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-interruptions.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1923 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-issue-noparam-single-rev.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1979 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-legacy.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4224 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-mq-skip.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7337 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-mq.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12843 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-named-branches.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9602 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-newancestor.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19870 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-obsolete.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8453 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-obsolete2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15338 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-obsolete3.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11805 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-obsolete4.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10520 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-parameters.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2414 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-partial.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9707 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-pull.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9804 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-rename.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    21542 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-scenario-global.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4185 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-templates.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3596 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebase-transaction.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3302 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rebuildstate.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2792 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-record.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8961 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-releasenotes-formatting.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5255 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-releasenotes-merging.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4544 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-releasenotes-parsing.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2723 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-relink.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3307 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remote-hidden.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      943 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-bad-configs.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    13385 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-bgprefetch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      720 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-blame.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2569 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-bundle2-legacy.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2488 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-bundle2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2517 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-bundles.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4682 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-cacheprocess.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2950 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-clone-tree.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2989 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-clone.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2929 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-corrupt-cache.t
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)    13117 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-datapack.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3799 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-gc.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5032 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-gcrepack.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1013 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-hgweb.t
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)    10399 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-histpack.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3399 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-http.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1002 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-keepset.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5647 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-linknodes.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5284 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-local.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2635 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-log.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1718 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-partial-shallow.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1237 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-permissions.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8432 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-prefetch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2227 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-pull-noshallow.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5932 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-push-pull.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14742 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-repack-fast.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18642 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-repack.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      639 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-share.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2988 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-sparse.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2005 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-strip.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2088 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-tags.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1030 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remotefilelog-wireproto.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18551 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-remove.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7390 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-removeemptydirs.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2525 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rename-after-merge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8079 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rename-dir-merge.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5859 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rename-merge1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    30910 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rename-merge2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3215 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rename-rev.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15409 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rename.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4406 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-repair-strip.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6043 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-repo-compengines.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3382 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-repo-filters-tiptoe.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2909 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-requires.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22311 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-resolve.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      312 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revert-flags.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1161 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revert-interactive-curses.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9633 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revert-interactive.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      345 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revert-unknown.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    32483 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revert.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      649 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revisions.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1944 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revlog-ancestry.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      298 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revlog-ancestry.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12412 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revlog-delta-find.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      685 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revlog-group-emptyiter.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1097 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revlog-mmapindex.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      511 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revlog-packentry.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16442 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revlog-raw.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      154 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revlog-raw.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2918 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revlog-v2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3265 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revlog.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      880 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revset-dirstate-parents.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10504 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revset-legacy-lookup.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2483 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revset-outgoing.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    55347 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revset.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    34705 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-revset2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      768 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rhg-no-generaldelta.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2613 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rhg-sparse-narrow.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10600 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rhg.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    12185 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rollback.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2975 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-run-tests.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    54543 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-run-tests.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5485 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rust-ancestor.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4185 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rust-discovery.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1881 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-rust-revlog.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1484 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-schemes.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3083 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-serve.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1931 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-server-view.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    60184 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-setdiscovery.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8770 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-share-bookmarks.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19132 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-share-safe.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7567 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-share.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    38022 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-shelve.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    25147 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-shelve2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4414 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-show-stack.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5189 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-show-work.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3946 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-show.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14157 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sidedata-exchange.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4210 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sidedata.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3274 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-simple-update.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3059 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-simplekeyvaluefile.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    11514 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-simplemerge.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2837 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-single-head-obsolescence-named-branch-A1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2815 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-single-head-obsolescence-named-branch-A2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3029 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-single-head-obsolescence-named-branch-A3.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2962 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-single-head-obsolescence-named-branch-A4.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2811 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-single-head-obsolescence-named-branch-A5.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10780 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-single-head.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1239 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sparse-clear.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1582 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sparse-clone.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1266 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sparse-fsmonitor.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3685 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sparse-import.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4696 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sparse-merges.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5708 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sparse-profiles.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1592 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sparse-requirement.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14311 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sparse-revlog.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1747 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sparse-verbose-json.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      454 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sparse-with-safe-share.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9632 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sparse.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27906 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-split.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3352 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sqlitestore.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      565 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ssh-batch.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    16458 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ssh-bundle1.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4591 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ssh-clone-r.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    46502 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ssh-proto-unbundle.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    38702 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ssh-proto.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1940 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ssh-repoerror.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    20923 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ssh.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1517 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-sshserver.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4720 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-stack.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4376 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-state-extension.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8135 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-static-http.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14673 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-status-color.t
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      937 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-status-inprocess.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)       62 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-status-inprocess.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6343 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-status-rev.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4065 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-status-terse.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5838 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-status-tracked-key.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18952 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-status.t
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     9417 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-stdio.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3892 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-storage.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6139 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-stream-bundle-v2.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      451 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-strict.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1436 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-strip-branch-cache.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5565 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-strip-cross.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    43035 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-strip.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    43874 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-subrepo-deep-nested-change.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    29361 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-subrepo-git.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3694 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-subrepo-missing.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1236 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-subrepo-paths.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    24140 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-subrepo-recursion.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6915 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-subrepo-relative-path.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18346 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-subrepo-svn.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    53049 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-subrepo.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1518 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-symlink-os-yes-fs-no.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      416 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-symlink-os-yes-fs-no.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1947 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-symlink-placeholder.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5186 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-symlinks.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    25927 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-tag.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    32700 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-tags.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    25985 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-template-basic.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    43113 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-template-functions.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6671 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-template-graph.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    32964 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-template-keywords.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    55583 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-template-map.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2905 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-tools.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5387 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-transaction-rollback-on-revlog-split.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2713 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-transaction-rollback-on-sigpipe.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6387 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-transaction-safety.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     6552 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-transaction-wc-rollback-race.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    27390 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-transplant.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     9293 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-treediscovery-legacy.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19979 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-treediscovery.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    25716 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-treemanifest.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8794 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-trusted.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4672 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-trusted.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)      967 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ui-color.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)       56 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ui-color.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4831 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ui-config.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1575 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ui-config.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1632 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ui-verbosity.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4290 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-ui-verbosity.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8865 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-unamend.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1397 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-unbundlehash.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15437 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-uncommit.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2237 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-unified-test.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3655 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-unionrepo.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      900 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-unrelated-pull.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     5447 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-up-local-change.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3456 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-update-atomic.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    18603 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-update-branches.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1285 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-update-dest.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)      857 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-update-issue1456.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2410 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-update-names.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1714 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-update-reverse.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    83006 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-upgrade-repo.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1930 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-url-download.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     7801 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-url-rev.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14253 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-url.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      540 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-username-newline.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     4262 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-util.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19219 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-verify-repo-operations.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10418 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-verify.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22413 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-walk.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2028 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-walkrepo.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1157 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-websub.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8428 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-win32text.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    22957 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-wireproto-clientreactor.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     8572 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-wireproto-framing.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)    28449 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-wireproto-serverreactor.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2583 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-wireproto.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)       51 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-wireproto.py.out
--rw-r--r--   0 alphare   (1000) alphare   (1000)    15625 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-wireproto.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3850 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-worker.t
--rw-r--r--   0 alphare   (1000) alphare   (1000)    19492 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-wsgirequest.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      264 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/test-xdg.t
-drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-03-02 22:30:09.278632 mercurial-6.4rc0/tests/testlib/
--rw-r--r--   0 alphare   (1000) alphare   (1000)    14930 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/badserverext.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      106 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/common.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)      819 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/crash_transaction_late.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3631 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/exchange-obsmarker-util.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1024 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/ext-phase-report.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     1565 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/ext-sidedata-2.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2716 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/ext-sidedata-3.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      529 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/ext-sidedata-4.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2438 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/ext-sidedata-5.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     3558 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/ext-sidedata.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      667 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/ext-stream-clone-steps.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2433 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/merge-combination-util.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)      244 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/obsmarker-common.sh
--rw-r--r--   0 alphare   (1000) alphare   (1000)    10380 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/persistent-nodemap-race-ext.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      998 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/push-checkheads-util.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3790 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/sigpipe-remote.py
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      395 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/sigpipe-worker.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)     2226 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/stream_clone_setup.sh
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)      948 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/testlib/wait-on-file
--rwxr-xr-x   0 alphare   (1000) alphare   (1000)     6664 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/tinyproxy.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      146 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/unwrap-message-id.py
--rw-r--r--   0 alphare   (1000) alphare   (1000)      795 2023-03-02 22:29:51.000000 mercurial-6.4rc0/tests/wireprotohelpers.sh
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.604413 mercurial-6.5rc0/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      206 2023-06-22 12:24:20.000000 mercurial-6.5rc0/.arcconfig
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      343 2023-06-22 12:24:20.000000 mercurial-6.5rc0/.clang-format
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      348 2023-06-22 12:24:20.000000 mercurial-6.5rc0/.editorconfig
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       76 2023-06-22 12:24:20.000000 mercurial-6.5rc0/.gitattributes
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.516414 mercurial-6.5rc0/.gitlab/
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.520413 mercurial-6.5rc0/.gitlab/merge_request_templates/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      550 2023-06-22 12:24:20.000000 mercurial-6.5rc0/.gitlab/merge_request_templates/Default.md
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1086 2023-06-22 12:24:20.000000 mercurial-6.5rc0/.hgignore
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   141872 2023-06-22 12:24:45.000000 mercurial-6.5rc0/.hgsigs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12330 2023-06-22 12:24:45.000000 mercurial-6.5rc0/.hgtags
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      614 2023-06-22 12:24:20.000000 mercurial-6.5rc0/.jshintrc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      600 2023-06-22 12:24:20.000000 mercurial-6.5rc0/CONTRIBUTING
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1663 2023-06-22 12:24:20.000000 mercurial-6.5rc0/CONTRIBUTORS
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18092 2023-06-22 12:24:20.000000 mercurial-6.5rc0/COPYING
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    87379 2023-06-22 12:24:49.000000 mercurial-6.5rc0/MANIFEST.in
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9762 2023-06-22 12:24:20.000000 mercurial-6.5rc0/Makefile
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1323 2023-06-22 12:24:49.604413 mercurial-6.5rc0/PKG-INFO
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      958 2023-06-22 12:24:20.000000 mercurial-6.5rc0/README.rst
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.520413 mercurial-6.5rc0/contrib/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3219 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/Makefile.python
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4067 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/all-revsets.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      397 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/asv.conf.json
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.520413 mercurial-6.5rc0/contrib/automation/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9805 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/README.rst
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1724 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/automation.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.520413 mercurial-6.5rc0/contrib/automation/hgautomation/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1508 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/hgautomation/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    41049 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/hgautomation/aws.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14557 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/hgautomation/cli.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18087 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/hgautomation/linux.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      551 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/hgautomation/pypi.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2144 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/hgautomation/ssh.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2474 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/hgautomation/try_server.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17472 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/hgautomation/windows.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2081 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/hgautomation/winrm.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13276 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/linux-requirements-py3.5.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21872 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/linux-requirements-py3.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      622 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/linux-requirements.txt.in
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15975 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/requirements.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       28 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/automation/requirements.txt.in
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1711 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/base-revsets.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15235 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/bash_completion
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2142 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/bdiff-torture.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.520413 mercurial-6.5rc0/contrib/benchmarks/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3952 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/benchmarks/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      614 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/benchmarks/perf.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1599 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/benchmarks/revset.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)    11670 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/byteify-strings.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      895 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/casesmash.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3627 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/catapipe.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)    35048 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/check-code.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3217 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/check-commit
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     5613 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/check-config.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3259 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/check-py3-compat.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     6143 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/check-pytype.sh
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/chg/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      895 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/chg/Makefile
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1223 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/chg/README
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1231 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/chg/chg.1
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15594 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/chg/chg.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15997 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/chg/hgclient.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      866 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/chg/hgclient.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5881 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/chg/procutil.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      528 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/chg/procutil.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4406 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/chg/util.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      855 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/chg/util.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      367 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/clang-format-ignorelist
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1179 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/debugcmdserver.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1452 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/debugshell.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.516414 mercurial-6.5rc0/contrib/docker/
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/docker/apache-server/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      520 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/docker/apache-server/Dockerfile
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5211 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/docker/apache-server/README.rst
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2154 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/docker/apache-server/entrypoint.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       67 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/docker/apache-server/hgwebconfig
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      713 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/docker/apache-server/vhost.conf
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1351 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/dumprevlog
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1420 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/editmerge
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      102 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/editmergeps.bat
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1616 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/editmergeps.ps1
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/examples/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      496 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/examples/fix.hgrc
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/fuzz/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12668 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/FuzzedDataProvider.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4947 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/Makefile
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      894 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/README.rst
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      969 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/bdiff.cc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1220 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/dirs.cc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      661 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/dirs_corpus.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1062 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/dirstate.cc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      479 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/dirstate_corpus.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1394 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/fm1readmarkers.cc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1958 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/fm1readmarkers_corpus.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1851 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/fncache.cc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1002 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/fuzzutil.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1398 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/jsonescapeu8fast.cc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2075 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/manifest.cc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1383 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/manifest_corpus.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3078 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/mpatch.cc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23524 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/mpatch_corpus.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1752 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/pyutil.cc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      228 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/pyutil.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1659 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/revlog.cc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      812 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/revlog_corpus.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1515 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/standalone_fuzz_target_runner.cc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1422 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/fuzz/xdiff.cc
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     4284 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/genosxversion.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4499 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/heptapod-ci.yml
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3541 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/hg-ssh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3652 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/hg-test-mode.el
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4020 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/hgclient.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)   113188 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/hgk
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2903 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/hgperf
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/hgsh/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      160 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/hgsh/Makefile
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8745 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/hgsh/hgsh.c
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      669 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/hgweb.fcgi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      678 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/hgweb.wsgi
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)    27373 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/import-checker.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10848 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/install-windows-dependencies.ps1
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8847 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/logo-droplets.svg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1006 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/memory.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    44271 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/mercurial.el
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/merge-lists/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14485 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/merge-lists/Cargo.lock
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      599 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/merge-lists/Cargo.toml
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/merge-lists/src/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10241 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/merge-lists/src/main.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/merge-lists/tests/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3310 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/merge-lists/tests/test-merge-lists.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12462 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/mq.el
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/nix/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2485 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/nix/flake.lock
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4948 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/nix/flake.nix
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/packaging/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4059 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/Makefile
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1123 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/build-linux-wheels.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2667 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/builddeb
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     4530 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/buildrpm
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/packaging/debian/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      161 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/debian/cacerts.rc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      164 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/debian/changelog
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        2 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/debian/compat
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1224 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/debian/control
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1072 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/debian/copyright
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       62 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/debian/default-tools.rc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       38 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/debian/hgkpath.rc
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     4475 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/debian/rules
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/packaging/docker/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      298 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/docker/debian.template
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      275 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/docker/fedora.template
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      361 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/docker/rhel7
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      438 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/docker/rhel8
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      572 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/docker/rhel9
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      365 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/docker/ubuntu.template
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1462 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/dockerdeb
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1411 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/dockerrpm
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3501 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/hg-docker
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/packaging/hgpackaging/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/hgpackaging/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4074 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/hgpackaging/cli.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3728 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/hgpackaging/downloads.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4168 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/hgpackaging/inno.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5183 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/hgpackaging/pyoxidizer.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5918 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/hgpackaging/util.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2688 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/hgpackaging/wix.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/packaging/inno/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2424 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/inno/mercurial.iss
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5329 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/inno/modpath.iss
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1541 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/inno/readme.rst
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       59 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/linux-wheel-centos5-blacklist
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/packaging/macosx/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1857 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/macosx/Readme.html
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      794 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/macosx/Welcome.html
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      805 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/macosx/distribution.xml
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4843 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/mercurial.spec
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1312 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/packagelib.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1720 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/packaging.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2065 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/requirements-macos.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      545 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/requirements-macos.txt.in
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    24492 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/requirements-windows-py3.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      507 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/requirements-windows.txt.in
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5151 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/requirements.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      122 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/requirements.txt.in
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/packaging/wix/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1792 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/wix/COPYING.rtf
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      135 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/wix/defines.wxi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      538 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/wix/guids.wxi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5648 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/wix/mercurial.wxs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1949 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/packaging/wix/readme.rst
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/perf-utils/
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     5919 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/perf-utils/compare-discovery-case
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2659 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/perf-utils/discovery-helper.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3258 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/perf-utils/perf-revlog-write-plot.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     5321 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/perf-utils/search-discovery-case
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6001 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/perf-utils/subsetmaker.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   130646 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/perf.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2439 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/phab-clean.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1315 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/phab-refresh-stack.sh
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/plan9/
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1050 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/plan9/9diff
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      277 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/plan9/9mail
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1761 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/plan9/README
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/plan9/hgrc.d/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      192 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/plan9/hgrc.d/9diff.rc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       97 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/plan9/hgrc.d/9mail.rc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      128 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/plan9/hgrc.d/factotum.rc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      742 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/plan9/mkfile
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      478 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/plan9/proto
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4269 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/pull_logger.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9205 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/pylintrc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      594 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-hook-examples.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.524413 mercurial-6.5rc0/contrib/python-zstandard/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1484 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/LICENSE
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      139 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/MANIFEST.in
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    35617 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/NEWS.rst
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    62506 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/README.rst
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.528413 mercurial-6.5rc0/contrib/python-zstandard/c-ext/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23805 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/bufferutil.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11571 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressionchunker.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11668 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressiondict.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17529 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressionparams.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18152 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressionreader.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10884 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressionwriter.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6748 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressobj.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    45707 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressor.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7048 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressoriterator.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4761 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/constants.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18046 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/decompressionreader.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9111 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/decompressionwriter.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5427 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/decompressobj.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    51907 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/decompressor.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7385 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/decompressoriterator.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4288 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/frameparams.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8819 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/c-ext/python-zstandard.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7177 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/make_cffi.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3335 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/setup.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6359 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/setup_zstd.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.528413 mercurial-6.5rc0/contrib/python-zstandard/tests/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/tests/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5825 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/tests/common.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5171 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/tests/test_buffer_util.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    60810 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/tests/test_compressor.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29165 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/tests/test_compressor_fuzzing.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9071 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/tests/test_data_structures.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2962 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/tests/test_data_structures_fuzzing.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    54630 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/tests/test_decompressor.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19315 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/tests/test_decompressor_fuzzing.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      274 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/tests/test_estimate_sizes.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1900 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/tests/test_module_attributes.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2892 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/tests/test_train_dictionary.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.528413 mercurial-6.5rc0/contrib/python-zstandard/zstandard/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2390 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstandard/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    83092 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstandard/cffi.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.528413 mercurial-6.5rc0/contrib/python-zstandard/zstd/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18091 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/COPYING
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1530 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/LICENSE
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.528413 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18345 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/bitstream.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5545 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/compiler.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4479 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/cpu.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1912 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/debug.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4960 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/debug.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9554 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/entropy_common.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2873 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/error_private.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2305 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/error_private.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    33031 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/fse.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11202 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/fse_decompress.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19952 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/huf.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14933 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/mem.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11059 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/pool.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2544 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/pool.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6667 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/pythoncapi_compat.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2819 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/threading.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5286 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/threading.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29099 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/xxhash.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12781 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/xxhash.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2673 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/zstd_common.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3751 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/zstd_errors.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12480 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/common/zstd_internal.h
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.528413 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27542 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/fse_compress.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8544 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/hist.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4504 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/hist.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    32772 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/huf_compress.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   172484 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_compress.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    40937 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_compress_internal.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5855 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_compress_literals.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1224 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_compress_literals.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19037 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_compress_sequences.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1910 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_compress_sequences.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19166 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_cwksp.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    25278 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_double_fast.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1283 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_double_fast.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21936 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_fast.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1203 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_fast.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    51720 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_lazy.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2745 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_lazy.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23858 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_ldm.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3850 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_ldm.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    57582 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_opt.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2016 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_opt.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    92625 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstdmt_compress.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9112 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstdmt_compress.h
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.528413 mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    50486 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/huf_decompress.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8874 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/zstd_ddict.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1308 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/zstd_ddict.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    72690 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    56849 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress_block.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2030 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress_block.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6992 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress_internal.h
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.528413 mercurial-6.5rc0/contrib/python-zstandard/zstd/deprecated/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11500 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/deprecated/zbuff.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1003 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/deprecated/zbuff_common.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5334 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/deprecated/zbuff_compress.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1919 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/deprecated/zbuff_decompress.c
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.528413 mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    42155 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/cover.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4569 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/cover.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    54649 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/divsufsort.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2419 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/divsufsort.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    28051 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/fastcover.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    43760 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/zdict.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17203 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/zdict.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   119972 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd/zstd.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9897 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python-zstandard/zstd.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4572 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python3-ratchet.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17216 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/python3-whitelist
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6342 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/relnotes
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)    10429 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/revsetbenchmarks.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      853 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/setup-pytype.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      679 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/showstack.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4007 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/simplemerge
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18553 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/synthrepo.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1581 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/tcsh_completion
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1955 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/tcsh_completion_build.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19926 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/testparseutil.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1403 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/undumprevlog
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.528413 mercurial-6.5rc0/contrib/vagrant/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       80 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/vagrant/README.md
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      415 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/vagrant/Vagrantfile
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      292 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/vagrant/provision.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      314 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/vagrant/run-tests.sh
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.528413 mercurial-6.5rc0/contrib/vim/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      859 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/vim/HGAnnotate.vim
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3533 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/vim/hg-menu.vim
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    58353 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/vim/hgcommand.vim
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1415 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/vim/hgtest.vim
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4024 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/vim/patchreview.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27369 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/vim/patchreview.vim
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.532414 mercurial-6.5rc0/contrib/win32/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4670 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/win32/ReadMe.html
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      267 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/win32/buildlocal.bat
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      509 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/win32/hg.bat
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4885 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/win32/hgwebdir_wsgi.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2238 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/win32/mercurial.ico
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2416 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/win32/mercurial.ini
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      248 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/win32/postinstall.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1227 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/xml.rnc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    48881 2023-06-22 12:24:20.000000 mercurial-6.5rc0/contrib/zsh_completion
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.532414 mercurial-6.5rc0/doc/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1475 2023-06-22 12:24:20.000000 mercurial-6.5rc0/doc/Makefile
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      416 2023-06-22 12:24:20.000000 mercurial-6.5rc0/doc/README
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     6306 2023-06-22 12:24:20.000000 mercurial-6.5rc0/doc/check-seclevel.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1920 2023-06-22 12:24:20.000000 mercurial-6.5rc0/doc/docchecker
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)    11089 2023-06-22 12:24:20.000000 mercurial-6.5rc0/doc/gendoc.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2489 2023-06-22 12:24:46.000000 mercurial-6.5rc0/doc/hg-ssh.8
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5003 2023-06-22 12:24:47.000000 mercurial-6.5rc0/doc/hg-ssh.8.html
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   493900 2023-06-22 12:24:47.000000 mercurial-6.5rc0/doc/hg.1
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   787142 2023-06-22 12:24:48.000000 mercurial-6.5rc0/doc/hg.1.html
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4995 2023-06-22 12:24:47.000000 mercurial-6.5rc0/doc/hgignore.5
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8114 2023-06-22 12:24:48.000000 mercurial-6.5rc0/doc/hgignore.5.html
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    33848 2023-06-22 12:24:20.000000 mercurial-6.5rc0/doc/hgmanpage.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   134823 2023-06-22 12:24:47.000000 mercurial-6.5rc0/doc/hgrc.5
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   198037 2023-06-22 12:24:48.000000 mercurial-6.5rc0/doc/hgrc.5.html
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1998 2023-06-22 12:24:20.000000 mercurial-6.5rc0/doc/runrst
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5415 2023-06-22 12:24:20.000000 mercurial-6.5rc0/doc/style.css
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1672 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hg
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.532414 mercurial-6.5rc0/hgdemandimport/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2585 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgdemandimport/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5451 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgdemandimport/demandimportpy3.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1645 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgdemandimport/tracing.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1226 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgeditor
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.532414 mercurial-6.5rc0/hgext/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       67 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    41869 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/absorb.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14438 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/acl.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2349 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/amend.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4171 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/automv.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3128 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/beautifygraph.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6906 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/blackbox.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3766 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/bookflow.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    42492 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/bugzilla.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3973 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/censor.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2362 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/children.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7762 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/churn.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    38184 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/clonebundles.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2717 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/closehead.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2404 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/commitextras.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.532414 mercurial-6.5rc0/hgext/convert/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23862 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12483 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/bzr.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17626 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/common.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22644 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/convcmd.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11351 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/cvs.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    36291 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/cvsps.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7837 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/darcs.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18068 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/filemap.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17697 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/git.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13259 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/gnuarch.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    25346 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/hg.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13877 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/monotone.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13026 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/p4.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    61956 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/subversion.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5365 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/convert/transport.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16679 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/eol.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    25435 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/extdiff.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4948 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/factotum.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext/fastannotate/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6532 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fastannotate/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12154 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fastannotate/commands.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    31416 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fastannotate/context.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      374 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fastannotate/error.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5879 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fastannotate/formatter.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8054 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fastannotate/protocol.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8726 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fastannotate/revmap.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4124 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fastannotate/support.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6975 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fastexport.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6520 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fetch.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    37275 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fix.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext/fsmonitor/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    33169 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fsmonitor/__init__.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext/fsmonitor/pywatchman/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    38268 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fsmonitor/pywatchman/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    32099 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fsmonitor/pywatchman/bser.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2665 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fsmonitor/pywatchman/capabilities.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2043 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fsmonitor/pywatchman/compat.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2822 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fsmonitor/pywatchman/encoding.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3650 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fsmonitor/pywatchman/load.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18028 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fsmonitor/pywatchman/pybser.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4744 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fsmonitor/state.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3883 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/fsmonitor/watchmanclient.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext/git/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1105 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/git/TODO.md
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11921 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/git/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11722 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/git/dirstate.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18158 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/git/gitlog.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      988 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/git/gitutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11605 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/git/index.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12250 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/git/manifest.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    33129 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/githelp.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11271 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/gpg.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3360 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/graphlog.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12065 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/hgk.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext/highlight/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3612 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/highlight/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3129 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/highlight/highlight.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    87676 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/histedit.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext/hooklib/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      999 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/hooklib/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3967 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/hooklib/changeset_obsoleted.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3766 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/hooklib/changeset_published.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1374 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/hooklib/enforce_draft_commits.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1335 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/hooklib/reject_merge_commits.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1233 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/hooklib/reject_new_heads.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext/infinitepush/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      943 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/infinitepush/README
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    46819 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/infinitepush/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3640 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/infinitepush/bundleparts.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1221 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/infinitepush/common.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3473 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/infinitepush/fileindexapi.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2066 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/infinitepush/indexapi.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1076 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/infinitepush/schema.sql
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9883 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/infinitepush/sqlindexapi.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6241 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/infinitepush/store.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20494 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/journal.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    30687 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/keyword.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext/largefiles/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      172 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/largefiles/CONTRIBUTORS
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6901 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/largefiles/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6612 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/largefiles/basestore.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22797 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/largefiles/lfcommands.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    26976 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/largefiles/lfutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2498 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/largefiles/localstore.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    64251 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/largefiles/overrides.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7703 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/largefiles/proto.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5159 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/largefiles/remotestore.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18933 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/largefiles/reposetup.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2663 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/largefiles/storefactory.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1572 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/largefiles/wirestore.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext/lfs/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7670 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/lfs/TODO.rst
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14598 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/lfs/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29006 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/lfs/blobstore.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2847 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/lfs/pointer.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12003 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/lfs/wireprotolfsserver.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17138 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/lfs/wrapper.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2862 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/logtoprocess.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   146637 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/mq.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext/narrow/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      782 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/narrow/TODO.rst
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2378 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/narrow/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11300 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/narrow/narrowbundle2.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    24695 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/narrow/narrowcommands.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2519 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/narrow/narrowdirstate.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      898 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/narrow/narrowrepo.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1481 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/narrow/narrowtemplates.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4839 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/narrow/narrowwirepeer.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20518 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/notify.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2602 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/pager.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    31840 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/patchbomb.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    82651 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/phabricator.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1747 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/purge.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    83930 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/rebase.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5155 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/record.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22314 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/releasenotes.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6775 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/relink.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext/remotefilelog/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6096 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/README.md
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    42043 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18524 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/basepack.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15838 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/basestore.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2429 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/connectionpool.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      966 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/constants.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13166 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/contentstore.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15846 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/datapack.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13599 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/debugcommands.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22766 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/fileserverclient.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19110 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/historypack.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5241 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/metadatastore.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19317 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/remotefilectx.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15742 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/remotefilelog.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14660 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/remotefilelogserver.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    31000 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/repack.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11103 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/shallowbundle.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11964 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/shallowrepo.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      452 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/shallowstore.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15312 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/shallowutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      586 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotefilelog/shallowverifier.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13853 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/remotenames.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5338 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/schemes.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7884 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/share.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16293 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/show.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12320 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/sparse.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6905 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/split.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    40162 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/sqlitestore.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      914 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/strip.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    30733 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/transplant.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10328 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/uncommit.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7071 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/win32mbcs.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7628 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/win32text.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext/zeroconf/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    61582 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/zeroconf/Zeroconf.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6996 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext/zeroconf/__init__.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.536414 mercurial-6.5rc0/hgext3rd/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      119 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgext3rd/__init__.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      685 2023-06-22 12:24:20.000000 mercurial-6.5rc0/hgweb.cgi
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.540413 mercurial-6.5rc0/i18n/
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     7524 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/check-translation.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   528626 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/da.po
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   784964 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/de.po
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   252621 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/el.po
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   334018 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/fr.po
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     5323 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/hggettext
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   415076 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/it.po
+-rw-r--r--   0 alphare   (1000) alphare   (1000)  1514529 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/ja.po
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1065 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/polib.LICENSE
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    62021 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/polib.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3205 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/posplit
+-rw-r--r--   0 alphare   (1000) alphare   (1000)  1520527 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/pt_BR.po
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   427542 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/ro.po
+-rw-r--r--   0 alphare   (1000) alphare   (1000)  1285212 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/ru.po
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   580645 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/sv.po
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   269346 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/zh_CN.po
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   323995 2023-06-22 12:24:20.000000 mercurial-6.5rc0/i18n/zh_TW.po
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.548413 mercurial-6.5rc0/mercurial/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      377 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      215 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/__main__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       61 2023-06-22 12:24:49.000000 mercurial-6.5rc0/mercurial/__version__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12717 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/ancestor.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10670 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/archival.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7249 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/bdiff.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      463 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/bdiff.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1767 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/bitmanipulation.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    35416 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/bookmarks.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    32260 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/branchmap.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    91852 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/bundle2.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17895 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/bundlecaches.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    25009 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/bundlerepo.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      788 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cacheutil.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.548413 mercurial-6.5rc0/mercurial/cext/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3638 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/base85.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      145 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/base85.pyi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7484 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/bdiff.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      348 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/bdiff.pyi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11094 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/charencode.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2198 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/charencode.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7338 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/dirs.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    26543 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/manifest.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4542 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/mpatch.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      193 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/mpatch.pyi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29410 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/osutil.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      610 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/osutil.pyi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    34935 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/parsers.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3107 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/parsers.pyi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17426 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/pathencode.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        8 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/py.typed
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    86522 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/revlog.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      392 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/revlog.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2804 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cext/util.h
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.548413 mercurial-6.5rc0/mercurial/cffi/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cffi/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2431 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cffi/bdiff.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      717 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cffi/bdiffbuild.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1497 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cffi/mpatch.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1017 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cffi/mpatchbuild.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3864 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cffi/osutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2469 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cffi/osutilbuild.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    80539 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/changegroup.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20180 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/changelog.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    26157 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/chgserver.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   139521 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/cmdutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18319 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/color.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   268513 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/commands.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    24088 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/commandserver.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18666 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/commit.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1030 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/compat.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8656 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/config.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    54277 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/configitems.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   103075 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/context.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    46956 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/copies.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    72639 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/crecord.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    40425 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/dagop.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15445 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/dagparser.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   158588 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/debugcommands.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.548413 mercurial-6.5rc0/mercurial/defaultrc/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/defaultrc/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7436 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/defaultrc/mergetools.rc
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17445 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/destutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2300 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/diffhelper.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5099 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/diffutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    64111 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/dirstate.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29095 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/dirstatemap.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.548413 mercurial-6.5rc0/mercurial/dirstateutils/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/dirstateutils/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2270 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/dirstateutils/docket.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3926 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/dirstateutils/timestamp.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15148 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/dirstateutils/v2.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22399 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/discovery.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    47133 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/dispatch.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2246 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/dummycert.pem
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22740 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/encoding.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18449 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/error.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    98707 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/exchange.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4310 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/exewrapper.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    31766 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/extensions.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12044 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/exthelper.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11528 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/fancyopts.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9542 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/filelog.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    43641 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/filemerge.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18948 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/fileset.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10550 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/filesetlang.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    26818 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/formatter.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17075 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/graphmod.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7283 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/grep.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11460 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hbisect.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    39684 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/help.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.548413 mercurial-6.5rc0/mercurial/helptext/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3796 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/bundlespec.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4608 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/color.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      240 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/common.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   127395 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/config.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1275 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/dates.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      678 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/deprecated.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1358 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/diffs.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4385 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/environment.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2149 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/evolution.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1251 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/extensions.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2119 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/filesets.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3005 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/flags.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15214 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/glossary.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1856 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/hg-ssh.8.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3200 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/hg.1.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      723 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/hgignore.5.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3418 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/hgignore.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      795 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/hgrc.5.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3366 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/hgweb.txt
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.548413 mercurial-6.5rc0/mercurial/helptext/internals/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5459 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/bid-merge.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19670 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/bundle2.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3270 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/bundles.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3928 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/cbor.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1279 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/censor.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10485 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/changegroups.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3187 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/config.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    24408 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/dirstate-v2.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13612 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/extensions.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11384 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/linelog.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2588 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/mergestate.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5895 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/requirements.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11319 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/revlogs.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    42319 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/wireprotocol.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29462 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/wireprotocolrpc.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    24727 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/internals/wireprotocolv2.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4513 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/merge-tools.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1467 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/pager.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4175 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/patterns.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3044 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/phases.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6980 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/revisions.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3204 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/rust.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8184 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/scripting.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7386 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/subrepos.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5975 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/templates.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2531 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/helptext/urls.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    55643 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hg.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.552414 mercurial-6.5rc0/mercurial/hgweb/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3296 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hgweb/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9745 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hgweb/common.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18593 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hgweb/hgweb_mod.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20376 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hgweb/hgwebdir_mod.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22682 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hgweb/request.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13111 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hgweb/server.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    47598 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hgweb/webcommands.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27560 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hgweb/webutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3003 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hgweb/wsgicgi.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7020 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hgweb/wsgiheaders.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11926 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/hook.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4310 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/httpconnection.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21656 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/httppeer.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4080 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/i18n.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.552414 mercurial-6.5rc0/mercurial/interfaces/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/interfaces/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6642 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/interfaces/dirstate.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    66882 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/interfaces/repository.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1009 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/interfaces/util.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27889 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/keepalive.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15185 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/linelog.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   148306 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/localrepo.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12015 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/lock.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    43811 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/logcmdutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5026 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/logexchange.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3936 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/loggingutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4134 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/lsprof.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2757 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/lsprofcalltree.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17168 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/mail.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    77422 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/manifest.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    54475 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/match.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17880 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/mdiff.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    92844 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/merge.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    31883 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/mergestate.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      463 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/mergeutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    33038 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/metadata.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3581 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/minifileset.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29765 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/minirst.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8398 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/mpatch.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      713 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/mpatch.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8293 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/namespaces.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12789 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/narrowspec.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1799 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/node.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    37622 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/obsolete.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    36632 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/obsutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    26220 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/parser.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   104079 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/patch.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12816 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/pathutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    33339 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/phases.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4716 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/policy.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    24699 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/posix.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8772 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/profiling.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10401 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/progress.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.552414 mercurial-6.5rc0/mercurial/pure/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/pure/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2028 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/pure/base85.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2643 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/pure/bdiff.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2285 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/pure/charencode.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3592 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/pure/mpatch.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6042 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/pure/osutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    32278 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/pure/parsers.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1669 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/pushkey.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6075 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/pvec.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13845 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/pycompat.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6667 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/pythoncapi_compat.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3620 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/rcutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18156 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/registrar.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19008 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/repair.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4547 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/repocache.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17211 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/repoview.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4888 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/requirements.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   128468 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlog.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.552414 mercurial-6.5rc0/mercurial/revlogutils/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2303 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlogutils/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1495 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlogutils/concurrency_checker.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9965 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlogutils/constants.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21363 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlogutils/debug.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    57626 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlogutils/deltas.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14441 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlogutils/docket.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7619 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlogutils/flagutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21954 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlogutils/nodemap.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5433 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlogutils/randomaccessfile.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3642 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlogutils/revlogv0.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29232 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlogutils/rewrite.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6264 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revlogutils/sidedata.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    91051 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revset.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29091 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/revsetlang.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9155 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/rewriteutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2740 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/scmposix.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    78185 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/scmutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3565 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/scmwindows.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7167 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/server.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18630 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/setdiscovery.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    40880 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/shelve.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3998 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/similar.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17294 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/simplemerge.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    34361 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/smartset.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27443 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/sparse.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23534 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/sshpeer.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    36706 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/sslutil.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.552414 mercurial-6.5rc0/mercurial/stabletailgraph/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/stabletailgraph/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5507 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/stabletailgraph/stabletailsort.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      722 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/stack.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12263 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/state.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8146 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/statichttprepo.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    32744 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/statprof.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    37043 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/store.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    39403 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/streamclone.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9009 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/strip.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    75401 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/subrepo.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17661 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/subrepoutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11518 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/tagmerge.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    30294 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/tags.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15532 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templatefilters.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    30828 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templatefuncs.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    34854 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templatekw.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    39070 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templater.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.552414 mercurial-6.5rc0/mercurial/templates/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/__init__.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.552414 mercurial-6.5rc0/mercurial/templates/atom/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      321 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/bookmarkentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      372 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/bookmarks.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      315 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/branchentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      367 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/branches.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      282 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/changelog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1350 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/changelogentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      484 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/error.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      265 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/filelog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       86 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/header.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      563 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/map
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      306 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/tagentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      353 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/atom/tags.tmpl
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.552414 mercurial-6.5rc0/mercurial/templates/coal/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/coal/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      549 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/coal/header.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       45 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/coal/map
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.552414 mercurial-6.5rc0/mercurial/templates/gitweb/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1238 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/bookmarks.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1231 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/branches.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1276 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/changelog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      489 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/changelogentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2260 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/changeset.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1290 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/error.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2967 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/fileannotate.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2706 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/filecomparison.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2223 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/filediff.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2109 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/filelog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2813 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/filerevision.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      227 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/footer.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2394 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/graph.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      320 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/graphentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      527 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/header.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1181 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/help.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1645 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/helptopics.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      664 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/index.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1372 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/manifest.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17122 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/map
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      397 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/notfound.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1279 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/search.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1914 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/shortlog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2487 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/summary.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1208 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/gitweb/tags.tmpl
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.552414 mercurial-6.5rc0/mercurial/templates/json/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/json/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      124 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/json/changelist.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      117 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/json/graph.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6862 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/json/map
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      864 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/map-cmdline.bisect
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      854 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/map-cmdline.changelog
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1018 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/map-cmdline.compact
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3619 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/map-cmdline.default
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      263 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/map-cmdline.phases
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1106 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/map-cmdline.show
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      972 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/map-cmdline.status
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1624 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/map-cmdline.xml
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.552414 mercurial-6.5rc0/mercurial/templates/monoblue/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1465 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/bookmarks.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1457 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/branches.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1526 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/changelog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      467 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/changelogentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2622 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/changeset.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1499 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/error.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2962 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/fileannotate.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3034 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/filecomparison.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2545 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/filediff.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2177 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/filelog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2984 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/filerevision.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      486 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/footer.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2591 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/graph.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      371 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/graphentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      495 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/header.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1406 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/help.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1951 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/helptopics.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      945 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/index.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1700 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/manifest.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14563 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/map
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1657 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/notfound.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1487 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/search.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2112 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/shortlog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2854 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/summary.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1430 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/monoblue/tags.tmpl
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/templates/paper/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1447 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/bookmarks.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1440 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/branches.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2638 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/changeset.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      341 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/diffstat.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1005 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/error.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2882 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/fileannotate.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2702 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/filecomparison.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2422 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/filediff.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3124 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/filelog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      333 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/filelogentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2769 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/filerevision.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       24 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/footer.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2806 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/graph.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      309 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/graphentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      458 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/header.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      920 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/help.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1311 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/helptopics.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      795 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/index.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1460 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/manifest.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11838 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/map
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      262 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/notfound.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1721 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/search.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2679 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/shortlog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      258 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/shortlogentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1407 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/paper/tags.tmpl
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/templates/raw/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       67 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/changelog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      124 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/changeset.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       24 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/error.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       44 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/fileannotate.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       27 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/filediff.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       76 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/graph.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       70 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/graphedge.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      240 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/graphnode.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       30 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/index.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      172 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/logentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       58 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/manifest.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1183 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/map
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       44 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/notfound.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      111 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/raw/search.tmpl
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/templates/rss/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      228 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/bookmarkentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      163 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/bookmarks.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      224 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/branchentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      158 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/branches.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      155 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/changelog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1534 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/changelogentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      241 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/error.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      174 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/filelog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      315 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/filelogentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      149 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/header.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      530 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/map
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      218 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/tagentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      153 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/rss/tags.tmpl
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/templates/spartan/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1044 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/branches.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1537 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/changelog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      973 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/changelogentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1764 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/changeset.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      174 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/error.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1712 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/fileannotate.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1342 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/filediff.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1415 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/filelog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      877 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/filelogentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1647 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/filerevision.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      162 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/footer.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1688 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/graph.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      320 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/graphentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      389 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/header.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      472 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/index.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      944 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/manifest.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9608 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/map
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      262 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/notfound.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      946 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/search.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1540 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/shortlog.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      281 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/shortlogentry.tmpl
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1017 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/spartan/tags.tmpl
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/templates/static/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      603 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/background.png
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      273 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/coal-file.png
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      284 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/coal-folder.png
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      689 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/feed-icon-14x14.png
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10887 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/followlines.js
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      792 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/hgicon.png
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4123 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/hglogo.png
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15779 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/mercurial.js
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      608 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/style-extra-coal.css
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9074 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/style-gitweb.css
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10635 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/style-monoblue.css
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9313 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/style-paper.css
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2677 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templates/static/style.css
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    36361 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/templateutil.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/testing/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1499 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/testing/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1637 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/testing/revlog.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    47745 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/testing/storage.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/thirdparty/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/__init__.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/thirdparty/attr/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1109 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/LICENSE
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1602 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15137 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/__init__.pyi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4102 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/_cmp.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      357 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/_cmp.pyi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5568 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/_compat.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      826 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/_config.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14645 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/_funcs.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    97569 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/_make.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5882 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/_next_gen.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2121 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/_version_info.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      209 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/_version_info.pyi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3610 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/converters.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      416 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/converters.pyi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1915 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/exceptions.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      539 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/exceptions.pyi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1038 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/filters.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      215 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/filters.pyi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/py.typed
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1400 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/setters.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      573 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/setters.pyi
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16793 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/validators.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2355 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/attr/validators.pyi
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/thirdparty/cbor/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1764 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/cbor/.travis.yml
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1130 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/cbor/LICENSE.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1089 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/cbor/README.rst
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      141 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/cbor/__init__.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/thirdparty/cbor/cbor2/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      224 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/cbor/cbor2/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2603 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/cbor/cbor2/compat.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11722 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/cbor/cbor2/decoder.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13687 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/cbor/cbor2/encoder.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1302 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/cbor/cbor2/types.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/thirdparty/sha1dc/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1270 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/sha1dc/LICENSE.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5786 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/sha1dc/README.md
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6801 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/sha1dc/cext.c
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/thirdparty/sha1dc/lib/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    57925 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/sha1dc/lib/sha1.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4368 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/sha1dc/lib/sha1.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    47913 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/sha1dc/lib/ubc_check.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1844 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/sha1dc/lib/ubc_check.h
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.556414 mercurial-6.5rc0/mercurial/thirdparty/xdiff/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2316 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/xdiff/xdiff.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29866 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/xdiff/xdiffi.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1683 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/xdiff/xdiffi.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1150 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/xdiff/xinclude.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1901 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/xdiff/xmacros.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13850 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/xdiff/xprepare.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1058 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/xdiff/xprepare.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2730 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/xdiff/xtypes.h
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3168 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/xdiff/xutils.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1331 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/xdiff/xutils.h
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/mercurial/thirdparty/zope/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/__init__.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2070 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/LICENSE.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3101 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1726 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/_compat.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1093 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/_flatten.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    45982 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/_zope_interface_coptimizations.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23342 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/adapter.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7526 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/advice.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/common/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       61 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/common/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20067 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/common/idatetime.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4272 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/common/interfaces.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3445 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/common/mapping.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4698 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/common/sequence.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    30880 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/declarations.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4015 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/document.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2039 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/exceptions.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20297 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/interface.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    43188 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/interfaces.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23084 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/registry.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2045 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/ro.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4688 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/thirdparty/zope/interface/verify.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    33512 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/transaction.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7106 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/treediscovery.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      943 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/txnutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      955 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/typelib.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    84687 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/ui.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10183 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/unionrepo.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15110 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/upgrade.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/mercurial/upgrade_utils/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/upgrade_utils/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    35565 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/upgrade_utils/actions.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8754 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/upgrade_utils/auto_upgrade.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21033 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/upgrade_utils/engine.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22910 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/url.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3567 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/urllibcompat.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    95590 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/util.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/mercurial/utils/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/utils/__init__.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    37211 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/utils/cborutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    25623 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/utils/compression.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11775 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/utils/dateutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      175 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/utils/hashutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1410 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/utils/memorytop.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23010 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/utils/procutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      757 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/utils/repoviewutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3868 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/utils/resourceutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21551 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/utils/storageutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    30373 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/utils/stringutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    31170 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/utils/urlutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23728 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/verify.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27605 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/vfs.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22889 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/win32.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23634 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/windows.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    66136 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/wireprotoframing.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17968 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/wireprotoserver.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13261 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/wireprototypes.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22517 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/wireprotov1peer.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29359 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/wireprotov1server.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15337 2023-06-22 12:24:20.000000 mercurial-6.5rc0/mercurial/worker.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.548413 mercurial-6.5rc0/mercurial.egg-info/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1323 2023-06-22 12:24:49.000000 mercurial-6.5rc0/mercurial.egg-info/PKG-INFO
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    69170 2023-06-22 12:24:49.000000 mercurial-6.5rc0/mercurial.egg-info/SOURCES.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        1 2023-06-22 12:24:49.000000 mercurial-6.5rc0/mercurial.egg-info/dependency_links.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       40 2023-06-22 12:24:49.000000 mercurial-6.5rc0/mercurial.egg-info/top_level.txt
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      244 2023-06-22 12:24:20.000000 mercurial-6.5rc0/pyproject.toml
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/relnotes/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3757 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/5.1
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      897 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/5.2
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1233 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/5.3
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3507 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/5.4
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3504 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/5.5
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1391 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/5.6
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3078 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/5.7
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2742 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/5.8
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3417 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/5.9
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5198 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/6.0
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8465 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/6.1
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4671 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/6.2
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9264 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/6.3
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11390 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/6.4
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4132 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/6.5
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      295 2023-06-22 12:24:20.000000 mercurial-6.5rc0/relnotes/next
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/rust/
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/rust/.cargo/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      399 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/.cargo/config
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    35797 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/Cargo.lock
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       82 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/Cargo.toml
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5381 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/README.rst
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/rust/chg/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23054 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/Cargo.lock
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      474 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/Cargo.toml
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      155 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/build.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/rust/chg/src/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2503 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/src/attachio.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4071 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/src/clientext.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      383 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/src/lib.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15481 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/src/locator.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2505 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/src/main.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10104 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/src/message.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2901 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/src/procutil.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2487 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/src/runcommand.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1335 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/src/sendfds.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3815 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/src/sighandlers.c
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2735 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/chg/src/uihandler.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       16 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/clippy.toml
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/rust/hg-core/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1197 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/Cargo.toml
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.520413 mercurial-6.5rc0/rust/hg-core/examples/
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/rust/hg-core/examples/nodemap/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2437 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/examples/nodemap/index.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4339 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/examples/nodemap/main.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/rust/hg-core/src/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23431 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/ancestors.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4092 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/checkexec.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/rust/hg-core/src/config/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)        1 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/config/config.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12029 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/config/layer.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21307 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/config/mod.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2235 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/config/plain_info.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10001 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/config/values.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/rust/hg-core/src/copy_tracing/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4912 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/copy_tracing/tests.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5272 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/copy_tracing/tests_support.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22992 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/copy_tracing.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9183 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/dagops.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.560413 mercurial-6.5rc0/rust/hg-core/src/dirstate/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13187 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/dirstate/dirs_multiset.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23661 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/dirstate/entry.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4762 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/dirstate/parsers.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4905 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/dirstate/status.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1124 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/dirstate.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/hg-core/src/dirstate_tree/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    67100 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/dirstate_tree/dirstate_map.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    28523 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/dirstate_tree/on_disk.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2319 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/dirstate_tree/owning.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5821 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/dirstate_tree/path_with_basename.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    38397 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/dirstate_tree/status.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       99 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/dirstate_tree.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23458 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/discovery.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7336 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/errors.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      762 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/exit_codes.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    24595 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/filepatterns.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3999 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/lib.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6596 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/lock.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3636 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/logging.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    56381 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/matchers.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3663 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/narrow.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/hg-core/src/operations/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3364 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/operations/cat.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1080 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/operations/debugdata.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1256 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/operations/list_tracked_files.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      409 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/operations/mod.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    28814 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/repo.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6518 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/requirements.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/hg-core/src/revlog/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11236 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/revlog/changelog.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7553 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/revlog/filelog.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17658 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/revlog/index.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6653 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/revlog/manifest.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23733 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/revlog/mod.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13553 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/revlog/node.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    35726 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/revlog/nodemap.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3648 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/revlog/nodemap_docket.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12050 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/revlog/patch.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18978 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/revlog/path_encode.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2139 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/revset.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10371 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/sparse.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1769 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/testing.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/hg-core/src/utils/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3045 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/utils/debug.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13256 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/utils/files.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    25851 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/utils/hg_path.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7801 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/utils/path_auditor.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15982 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/utils.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6554 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/src/vfs.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/hg-core/tests/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11317 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-core/tests/test_missing_ancestors.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/hg-cpython/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      404 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/Cargo.toml
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/hg-cpython/src/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8565 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/ancestors.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7156 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/cindex.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1016 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/conversion.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7114 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/copy_tracing.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2410 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/dagops.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      822 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/debug.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/hg-cpython/src/dirstate/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3383 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/dirstate/copymap.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3301 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/dirstate/dirs_multiset.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18684 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/dirstate/dirstate_map.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6905 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/dirstate/item.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10077 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/dirstate/status.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2013 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/dirstate.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5795 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/discovery.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2332 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/exceptions.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2377 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/lib.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1590 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/pybytes_deref.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4126 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/ref_sharing.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17409 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/revlog.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1481 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hg-cpython/src/utils.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/hgcli/
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/hgcli/.cargo/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      671 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hgcli/.cargo/config
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23621 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hgcli/Cargo.lock
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      819 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hgcli/Cargo.toml
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1958 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hgcli/README.md
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      577 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hgcli/build.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11709 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hgcli/pyoxidizer.bzl
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/hgcli/src/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1484 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/hgcli/src/main.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/rhg/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      514 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/Cargo.toml
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1741 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/README.md
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/rhg/src/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5363 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/blackbox.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7501 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/color.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/rhg/src/commands/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4086 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/commands/cat.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1059 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/commands/config.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2059 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/commands/debugdata.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1036 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/commands/debugignorerhg.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      598 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/commands/debugrequirements.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1491 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/commands/debugrhgsparse.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3310 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/commands/files.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      862 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/commands/root.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22682 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/commands/status.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9491 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/error.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    28326 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/main.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9303 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/ui.rs
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.564413 mercurial-6.5rc0/rust/rhg/src/utils/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1756 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rust/rhg/src/utils/path_utils.rs
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       83 2023-06-22 12:24:20.000000 mercurial-6.5rc0/rustfmt.toml
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       38 2023-06-22 12:24:49.604413 mercurial-6.5rc0/setup.cfg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    59255 2023-06-22 12:24:20.000000 mercurial-6.5rc0/setup.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.600413 mercurial-6.5rc0/tests/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      556 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/.balto.toml
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      141 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/README
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.600413 mercurial-6.5rc0/tests/artifacts/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      396 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/artifacts/PURPOSE
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.600413 mercurial-6.5rc0/tests/artifacts/cache/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       33 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/artifacts/cache/big-file-churn.hg.md5
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.600413 mercurial-6.5rc0/tests/artifacts/scripts/
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     4407 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/artifacts/scripts/generate-churning-bundle.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1558 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/autodiff.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1523 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/basic_test_result.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      593 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/binfile.bin
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1103 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/blackbox-readonly-dispatch.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.600413 mercurial-6.5rc0/tests/blacklists/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      516 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/blacklists/README
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      992 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/blacklists/fsmonitor
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      443 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/blacklists/linux-vfat
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      268 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/blacklists/nix
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2242 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bruterebase.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.600413 mercurial-6.5rc0/tests/bundles/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1314 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/darcs1.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10686 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/hgweb+obs.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2216 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/issue4041.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4151 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/issue4438-r1.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3864 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/issue4438-r2.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2223 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/issue6528.hg-v1
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2406 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/issue6528.hg-v2
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    61440 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/issue6528.tar
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      548 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/legacy-encoding.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1844 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/rebase-revset.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1663 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/rebase.hg
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      484 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/rebase.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1768 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/remote.hg
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      520 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/remote.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      346 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/rename.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1600 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/renames.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1171 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/tampered.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      847 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/test-invalid-branch-name.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      302 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/test-keyword.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      596 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/test-manifest.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      947 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/test-merge-symlinks.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      558 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/test-no-symlinks.hg
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1175 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/test-revlog-diff-relative-to-nullrev.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    30720 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bundles/test-revlog-diff-relative-to-nullrev.tar
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      379 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/bzr-definitions
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1751 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/cgienv
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      343 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/check-gendoc
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2649 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/check-perf-code.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7538 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/common-pattern.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      247 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/crashgetbundler.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13103 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/drawdag.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2723 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/dumbhttp.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3302 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/dummysmtpd.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      893 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/dummyssh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     7306 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/f
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      281 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/failfilemerge.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3043 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/fakedirstatewritetime.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      763 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/fakemergerecord.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1197 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/fakepatchtime.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      838 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/filterpyflakes.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1004 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/filtertraceback.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3850 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/flagprocessorext.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     4760 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/fsmonitor-run-tests.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3417 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/generate-working-copy-states.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3624 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/get-with-headers.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.600413 mercurial-6.5rc0/tests/gpg/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      597 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/gpg/pubring.gpg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1248 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/gpg/secring.gpg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1280 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/gpg/trustdb.gpg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      122 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/helper-runtests.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1975 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/helpers-testrepo.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      592 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/heredoctest.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1807 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/hghave
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    30375 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/hghave.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1288 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/hgterm.ti
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      712 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/hgweberror.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      229 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/histedit-helpers.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3863 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/httpserverauth.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2172 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/hypothesishelpers.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     4279 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/killdaemons.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      597 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/library-infinitepush.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      617 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/list-tree.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      641 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/lockdelay.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1842 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/logexceptions.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      874 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/ls-l.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      907 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/md5sum.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1077 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/missing-comment.hg
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      324 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/mockblackbox.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      494 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/mockmakedate.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      400 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/mocktime.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       83 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/narrow-library.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      878 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/notcapable
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1942 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/pdiff
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.600413 mercurial-6.5rc0/tests/phabricator/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7191 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/accept-4564.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7072 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/accept-7913.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2669 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phab-conduit.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15402 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabimport-multi-drev.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    33114 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabimport-stack.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   205871 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabread-4480.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2644 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabread-conduit-error.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3689 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabread-empty-drev.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   229411 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabread-multi-drev.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   121698 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabread-str-time.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27576 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-add-parent-setup.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    49804 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-add-parent.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   152473 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-binary-renames.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    84767 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-binary.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27924 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-comment-created.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    26060 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-comment-updated.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27824 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-create-alpha.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    44412 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-create-public.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    50737 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-fold-extend-end.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    57601 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-fold-extend-front.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    55187 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-fold-fold-end.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    30330 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-fold-immutable.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    36865 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-fold-initial.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    37814 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-fold-no-changes.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    55587 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-fold-split-end.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    42002 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-fold-updated.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    50297 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-hash-fixes.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    57999 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-no-restack-orphan.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9076 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-skipped.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    48342 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabsend-update-alpha-create-beta.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8414 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabupdate-change-6876.json
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11184 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/phabricator/phabupdate-revs.json
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1939 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/printenv.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1443 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/printrevset.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1472 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/pullext.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      270 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/readlink.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      666 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/remotefilelog-getflogheads.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1108 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/remotefilelog-library.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1999 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/revlog-formatv0.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      537 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/revnamesext.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)   142061 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/run-tests.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      667 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/seq.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      681 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/silenttestrunner.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20200 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/simplestorerepo.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      418 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/sitecustomize.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3606 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/sshprotoext.py
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.600413 mercurial-6.5rc0/tests/sslcerts/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1824 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/sslcerts/README
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1025 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/sslcerts/client-cert.pem
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1679 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/sslcerts/client-key-decrypted.pem
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1766 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/sslcerts/client-key.pem
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1679 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/sslcerts/priv.pem
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1172 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/sslcerts/pub-expired.pem
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1172 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/sslcerts/pub-not-yet.pem
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1172 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/sslcerts/pub-other.pem
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1172 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/sslcerts/pub.pem
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.604413 mercurial-6.5rc0/tests/svn/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5686 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/branches.svndump
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1556 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/empty.svndump
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3506 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/encoding.svndump
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7715 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/move.svndump
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5119 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/replace.svndump
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2863 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/startrev.svndump
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1489 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/svndump-branches.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      866 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/svndump-empty.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1055 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/svndump-encoding.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     2316 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/svndump-move.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1496 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/svndump-replace.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      732 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/svndump-startrev.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1196 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/svndump-tags.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4518 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn/tags.svndump
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      641 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svn-safe-append.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      312 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svnurlof.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1852 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/svnxml.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      873 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-abort-checkin.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      996 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-absorb-edit-lines.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6634 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-absorb-filefixupstate.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      389 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-absorb-phase.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5855 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-absorb-rename.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      662 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-absorb-strip.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      797 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-absorb-unfinished.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14017 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-absorb.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    86954 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-acl.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6650 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-add.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3884 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-addremove-similar.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1870 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-addremove.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18133 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-alias.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3679 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-amend-subrepo.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17931 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-amend.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13052 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ancestor.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1412 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ancestor.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3805 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-annotate.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23421 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-annotate.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2610 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-arbitraryfilectx.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      665 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-archive-symlinks.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20069 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-archive.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4259 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-atomictempfile.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5098 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-audit-path.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16196 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-audit-subrepo.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7137 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-automv.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18446 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-backout.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      315 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-backwards-remove.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6651 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bad-extension.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      316 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bad-pull.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5569 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-basic.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6140 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-batching.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      360 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-batching.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5634 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bdiff.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8275 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bheads.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23161 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bisect.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20453 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bisect2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6194 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bisect3.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18633 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-blackbox.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8063 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bookflow.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6580 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bookmarks-corner-case.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5516 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bookmarks-current.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4267 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bookmarks-merge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    44556 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bookmarks-pushpull.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2533 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bookmarks-rebase.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1007 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bookmarks-strip.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    35122 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bookmarks.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10152 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-branch-change.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3189 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-branch-option.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1612 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-branch-tag-confict.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    44923 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-branches.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3274 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bugzilla.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6818 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bundle-phase-internal.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9237 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bundle-phases.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7443 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bundle-r.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17305 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bundle-type.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2443 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bundle-vs-outgoing.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    31696 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bundle.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    43152 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bundle2-exchange.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    54392 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bundle2-format.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14608 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bundle2-multiple-changegroups.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2709 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bundle2-pushback.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20851 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-bundle2-remote-changegroup.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5637 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-byteify-strings.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2625 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-cache-abuse.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2586 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-cappedreader.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6940 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-casecollision-merge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1317 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-casecollision.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4774 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-casefolding.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2137 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-cat.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    41647 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-cbor.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15868 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-censor.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      553 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-censor2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1090 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-changelog-exec.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      353 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-cargo-lock.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      344 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-clang-format.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3636 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-code.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      808 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-commit.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1527 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-config.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      819 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-encoding.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      630 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-execute.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      282 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-format.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      930 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-help.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7070 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-interfaces.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      129 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-interfaces.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      250 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-jshint.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1628 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-module-imports.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1341 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-py3-compat.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1357 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-pyflakes.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      672 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-pylint.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      333 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-rust-format.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      868 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-check-shbang.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15862 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-chg.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3023 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-children.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6254 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-churn.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1165 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-clone-cgi.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1110 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-clone-pull-corruption.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5762 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-clone-r.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11689 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-clone-stream-format.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5588 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-clone-stream-revlog-split.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    34635 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-clone-stream.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3510 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-clone-update-order.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    34101 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-clone.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16954 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-clonebundles-autogen.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    30718 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-clonebundles.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1903 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-close-head.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    37292 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-commandserver.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    34068 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-commit-amend.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9765 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-commit-interactive-curses.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    41248 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-commit-interactive.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3748 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-commit-multiple.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3706 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-commit-unresolved.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21377 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-commit.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2582 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-committer.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11965 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-completion.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1289 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-config-env.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      126 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-config-env.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1847 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-config-parselist.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12114 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-config.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8500 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-conflict.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1247 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-confused-revert.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1662 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-context-metadata.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6542 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-context.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3689 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-context.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10068 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-contrib-check-code.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5067 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-contrib-check-commit.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1954 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-contrib-dumprevlog.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      272 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-contrib-emacs.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13817 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-contrib-perf.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2778 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-contrib-pull-logger.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16331 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-contrib-relnotes.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4603 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-contrib-testparseutil.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3874 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-contrib.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1240 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-authormap.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5379 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-baz.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      909 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-bzr-114.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4434 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-bzr-directories.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1056 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-bzr-ghosts.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7907 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-bzr-merges.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      829 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-bzr-treeroot.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6769 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-bzr.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2014 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-clonebranches.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3434 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-cvs-branch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5333 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-cvs-detectmerge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4820 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-cvs-synthetic.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13591 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-cvs.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1633 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-cvsnt-mergepoints.rlog
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4145 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-cvsnt-mergepoints.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2714 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-darcs.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3561 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-datesort.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23634 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-filemap.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    36476 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-git.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14524 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-hg-sink.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5365 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-hg-source.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5249 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-hg-startrev.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3143 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-hg-svn.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1419 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-identity.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10881 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-mtn.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22001 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-p4-filetypes.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4433 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-p4.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6551 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-splicemap.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3189 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-svn-branches.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9522 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-svn-encoding.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7941 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-svn-move.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11917 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-svn-sink.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9220 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-svn-source.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1736 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-svn-startrev.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1069 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-svn-tags.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2335 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-tagsbranch-topology.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4094 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert-tla.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    25873 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-convert.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   124298 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-copies-chain-merge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11545 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-copies-in-changeset.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10489 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-copies-unrelated.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16541 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-copies.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5785 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-copy-move-merge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9637 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-copy.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15518 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-copytrace-heuristics.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1611 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-custom-filters.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1051 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-debian-packages.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2126 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-debug-revlog-stats.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      869 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-debugbackupbundle.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5472 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-debugbuilddag.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4120 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-debugbundle.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21980 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-debugcommands.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2940 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-debugextensions.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      606 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-debugindexdot.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      388 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-debugrename.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4703 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-default-push.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5663 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-demandimport.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21614 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-devel-warnings.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1124 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-antipatience.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4788 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-binary-file.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7578 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-change.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11791 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-color.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      795 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-copy-depth.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1056 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-hashes.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8194 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-ignore-whitespace.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4513 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-indent-heuristic.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      459 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-issue2761.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      445 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-newlines.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      902 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-reverse.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      943 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-subdir.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8479 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-unified.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6296 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diff-upgrade.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1485 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diffdir.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6598 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-diffstat.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4906 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-directaccess.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      604 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-dirs.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      305 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-dirstate-backup.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6633 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-dirstate-race.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2733 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-dirstate-race2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9211 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-dirstate-read-race.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12104 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-dirstate-status-write-race.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1214 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-dirstate-version-fallback.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12203 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-dirstate.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      937 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-dispatch.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      466 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-dispatch.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6044 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-dispatch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1013 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-docker-packaging.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5899 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-doctest.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1800 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-double-merge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4477 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-drawdag.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1185 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-duplicateoptions.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1440 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-editor-filename.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      397 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-empty-dir.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1108 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-empty-file.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3167 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-empty-group.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      572 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-empty-manifest-index.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      653 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-empty.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1360 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-encode.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5481 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-encoding-align.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2346 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-encoding-func.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22566 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-encoding-textwrap.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7950 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-encoding.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2455 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-eol-add.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2836 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-eol-clone.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5709 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-eol-hook.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7155 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-eol-patch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      574 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-eol-tag.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5950 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-eol-update.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12586 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-eol.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1523 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-eolfilename.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2664 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-excessive-merge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19298 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-multi-source.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9663 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4085 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8626 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A3.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4371 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A4.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4892 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A5.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4905 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A6.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2486 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A7.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2534 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4445 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2931 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B3.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5076 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B4.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5821 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B5.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4175 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B6.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2577 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B7.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6366 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-C1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7100 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-C2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8406 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-C3.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4994 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-C4.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7261 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-D1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4077 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-D2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3309 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-D3.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5978 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-D4.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      558 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-execute-bit.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10130 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-export.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2952 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-extdata.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15703 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-extdiff.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4177 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-extension-timing.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    66612 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-extension.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2867 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-extensions-afterloaded.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2033 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-extensions-wrapfunction.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      600 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-extensions-wrapfunction.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      415 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-extra-filelog-entry.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2828 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fastannotate-corrupt.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      347 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fastannotate-diffopts.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15037 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fastannotate-hg.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3473 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fastannotate-perfhack.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5507 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fastannotate-protocol.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4254 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fastannotate-renames.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5097 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fastannotate-revmap.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5060 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fastannotate.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11832 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fastexport.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13057 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fetch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3417 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-filebranch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6905 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-filecache.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1108 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-filecache.py.out
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     1615 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-filelog.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       86 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-filelog.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6549 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fileset-generated.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19138 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fileset.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      755 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fix-clang-format.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3111 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fix-metadata.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1163 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fix-pickle.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12446 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fix-topology.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    49672 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fix.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8391 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-flagprocessor.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3836 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-flags.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15044 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fncache.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2126 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-fuzz-targets.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       84 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc-da.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      310 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc-de.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       84 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc-el.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       84 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc-fr.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       84 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc-it.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1426 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc-ja.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       87 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc-pt_BR.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      471 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc-ro.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       84 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc-ru.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       84 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc-sv.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       87 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc-zh_CN.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       87 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc-zh_TW.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1150 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gendoc.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    32322 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-generaldelta.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14689 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-getbundle.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11999 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-git-export.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10580 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-git-interop.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8772 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-githelp.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16188 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-globalopts.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   150556 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-glog-beautifygraph.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1784 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-glog-topological.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   103725 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-glog.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1181 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-gpg.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18653 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-graft-interrupted.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18392 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-graft-rename.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23358 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-graft.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    38658 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-grep.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10014 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hardlinks.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2003 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hashutil.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9357 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-help-hide.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)   129090 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-help.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1643 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hg-parseurl.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1128 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hghave.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12337 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgignore.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1081 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgk.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8324 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgrc.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18885 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-annotate-whitespace.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5615 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-auth.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5923 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-auth.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      788 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-bundle.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    75077 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-commands.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4853 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-csp.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15593 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-descend-empties.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    33421 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-diffs.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11671 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-empty.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    55770 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-filelog.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2586 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-head.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    53176 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-json.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3974 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-no-path-info.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4554 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-no-request-uri.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2682 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-non-interactive.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7427 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-raw.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7184 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-removed.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    66313 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb-symrev.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    25486 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgweb.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1310 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgwebdir-gc.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1135 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgwebdir-paths.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    55395 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgwebdir.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1650 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hgwebdirsym.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    38679 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-highlight.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16047 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-arguments.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7495 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-base.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4868 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-bookmark-motion.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14894 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-commute.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4253 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-drop.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13888 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-edit.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8748 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-fold-non-commute.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15025 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-fold.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2109 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-merge-tools.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2109 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-no-backup.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6771 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-no-change.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4855 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-non-commute-abort.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8643 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-non-commute.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16204 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-obsolete.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4253 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-outgoing.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1658 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-histedit-templates.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    40035 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hook.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3424 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hooklib-changeset_obsoleted.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2586 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hooklib-changeset_published.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1332 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hooklib-enforce_draft_commits.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2383 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hooklib-reject_merge_commits.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1443 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hooklib-reject_new_heads.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    50685 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-http-bad-server.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3037 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-http-branchmap.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15583 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-http-bundle1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4808 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-http-clone-r.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    36449 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-http-permissions.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    26308 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-http-protocol.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6588 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-http-proxy.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    24997 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-http.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    26423 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-https.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    55194 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-hybridencode.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2011 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-i18n.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3622 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-identify.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1997 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-impexp-branch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9395 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-import-bypass.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2458 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-import-context.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3704 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-import-eol.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20483 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-import-git.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4326 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-import-merge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1410 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-import-unknown.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    46738 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-import.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4550 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-imports-checker.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12486 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-incoming-outgoing.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    35590 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-infinitepush-bundlestore.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20459 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-infinitepush-ci.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    24421 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-infinitepush.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5198 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-inherit-mode.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8091 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-init.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11932 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-install.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      315 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue1089.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      758 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue1102.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1942 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue1175.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2172 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue1306.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      384 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue1438.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1186 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue1502.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1637 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue1802.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1124 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue1877.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1192 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue1993.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1580 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue2137.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10113 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue3084.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      539 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue4074.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1471 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue522.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2023 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue586.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      658 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue5979.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      634 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue612.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      766 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue619.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19189 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue6528.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2291 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue660.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      964 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue6642.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2935 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue672.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      742 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-issue842.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1223 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-journal-exists.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4778 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-journal-share.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9065 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-journal.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    32361 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-keyword.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1278 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-known.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7959 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-largefiles-cache.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    33975 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-largefiles-misc.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2057 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-largefiles-small-disk.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    26281 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-largefiles-update.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13520 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-largefiles-wireproto.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    51951 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-largefiles.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1032 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-legacy-exit-code.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13714 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-lfconvert.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2848 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-lfs-bundle.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11706 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-lfs-largefiles.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1190 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-lfs-pointer.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      850 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-lfs-pointer.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29196 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-lfs-serve-access.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27622 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-lfs-serve.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    36644 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-lfs-test-server.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    42071 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-lfs.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7649 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-linelog.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7590 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-linerange.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      122 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-locale.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2323 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-locate.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4236 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-lock-badness.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6026 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-lock.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4833 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-log-bookmark.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1642 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-log-exthook.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18865 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-log-linerange.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    68329 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-log.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14206 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-logexchange.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3530 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-logtoprocess.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10794 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-lrucachedict.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3199 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mac-packages.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      980 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mactext.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2382 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mailmap.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      752 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-manifest-merging.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15640 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-manifest.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12481 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-manifest.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    46063 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-match.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      567 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mdiff.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    40965 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-changedelete.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2313 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-closedheads.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1918 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-combination-exec-bytes.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2274 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-combination-file-content.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1676 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-combination-misc.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5133 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-commit.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    32155 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-criss-cross.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4851 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-default.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8918 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-exec.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    34758 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-force.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4777 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-halt.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3361 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-internal-tools-pattern.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3449 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-local.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10097 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-no-file-change.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9347 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-partial-tool.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2360 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-remove.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1369 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-revert.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1917 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-revert2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3860 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-subrepos.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1554 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-symlinks.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    50588 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-tools.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13943 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge-types.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11059 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1499 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge10.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1215 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1897 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge4.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      853 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge5.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1940 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge6.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3847 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge7.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      727 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge8.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1735 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-merge9.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1254 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-minifileset.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5523 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-minirst.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21558 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-minirst.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1288 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-missing-capability.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4378 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-eol.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4771 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-git.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10778 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-guards.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17910 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-header-date.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20216 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-header-from.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3470 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-merge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3570 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-missingfiles.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2933 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-pull-from-bundle.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4092 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qclone-http.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3561 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qdelete.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2507 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qdiff.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4831 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qfold.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1464 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qgoto.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      772 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qimport-fail-cleanup.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7753 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qimport.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8431 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qnew.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5559 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qpush-exact.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9769 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qpush-fail.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2771 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qqueue.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8592 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qrefresh-interactive.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7908 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qrefresh-replace-log-message.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8796 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qrefresh.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1862 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qrename.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      256 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-qsave.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4935 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-safety.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1054 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-subrepo-svn.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15369 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-subrepo.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1835 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq-symlinks.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    31781 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mq.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22377 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-mv-cp-st-diff.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1883 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-acl.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      803 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-archive.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3683 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-clone-no-ellipsis.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2035 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-clone-non-narrow-server.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4410 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-clone-nonlinear.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2308 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-clone-stream.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7096 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-clone.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2938 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-commit.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1938 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-copies.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1644 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-debugcommands.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      910 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-debugrebuilddirstate.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5903 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-exchange-merges.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5948 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-exchange.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5239 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-expanddirstate.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4500 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-merge-outside.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4157 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-merge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1792 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-patch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10109 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-patterns.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3580 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-pull.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2756 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-rebase.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10763 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-shallow-merges.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3156 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-shallow.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4853 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-share.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2136 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-sparse.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5180 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-strip.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5863 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-trackedcmd.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1836 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-update.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9376 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-widen-no-ellipsis.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8778 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow-widen.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16626 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-narrow.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      559 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-nested-repo.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12402 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-newbranch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1682 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-newcgi.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1463 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-newercgi.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1259 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-no-symlinks.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2482 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-nointerrupt.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5530 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-notify-changegroup.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    26430 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-notify.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15592 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-obshistory.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    93773 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-obsmarker-template.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4312 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-obsmarkers-effectflag.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1209 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-obsolete-bounds-checking.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    95912 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-obsolete-bundle-strip.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5687 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-obsolete-changeset-exchange.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6138 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-obsolete-check-push.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7942 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-obsolete-checkheads.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    24306 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-obsolete-distributed.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23743 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-obsolete-divergent.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4876 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-obsolete-tag-cache.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    69008 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-obsolete.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2056 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-oldcgi.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3471 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-origbackup-conflict.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7516 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pager-legacy.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11338 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pager.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3138 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-parents.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9312 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-parse-date.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7553 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-parseindex.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10978 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-parseindex2.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1694 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-patch-offset.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2627 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-patch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4725 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-patchbomb-bookmark.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2574 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-patchbomb-tls.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    97644 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-patchbomb.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2592 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pathconflicts-basic.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5032 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pathconflicts-merge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3977 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pathconflicts-update.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6697 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pathencode.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13367 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-paths.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3495 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pending.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1078 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-permissions.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9380 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-persistent-nodemap-stream-clone.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    32879 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-persistent-nodemap.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    35925 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-phabricator.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5575 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-phase-archived.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    43157 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-phases-exchange.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    30068 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-phases.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4913 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-profile.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    17423 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-progress.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6790 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-propertycache.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2213 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-propertycache.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5716 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pull-branch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6939 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pull-bundle.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2567 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pull-http.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3488 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pull-network.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      505 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pull-permission.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1598 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pull-pull-corruption.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4647 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pull-r.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6763 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pull-update.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4425 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pullling-to-general-delta.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      220 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-purge-ignored-directory.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6620 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-purge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2742 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-cgi.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2138 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-multibranches-E1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2513 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-multibranches-E2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2286 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-multibranches-E3.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1995 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-partial-C1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2050 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-partial-C2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1910 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-partial-C3.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1953 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-partial-C4.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1601 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-pruned-B1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2148 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-pruned-B2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2113 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-pruned-B3.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2073 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-pruned-B4.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2324 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-pruned-B5.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1932 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-pruned-B6.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1928 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-pruned-B7.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2691 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-pruned-B8.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1590 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-superceed-A1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2164 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-superceed-A2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2238 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-superceed-A3.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1709 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-superceed-A4.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1707 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-superceed-A5.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2653 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-superceed-A6.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2655 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-superceed-A7.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1954 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-superceed-A8.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1860 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2437 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2958 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D3.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3248 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D4.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3091 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D5.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2070 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D6.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2501 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D7.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16504 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-http.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    46418 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-race.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18901 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push-warn.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9108 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-push.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1659 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-pushvars.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10654 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-qrecord.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3897 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-racy-mutations.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2373 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rank.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11335 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-abort.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2630 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-backup.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7413 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-base-flag.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5506 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-bookmarks.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1156 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-brute-force.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9101 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-cache.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4409 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-check-restore.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15767 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-collapse.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12594 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-conflicts.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9743 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-dest.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5607 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-detach.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2377 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-dry-run.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1181 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-empty-successor.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4515 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-emptycommit.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    24186 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-inmemory.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11860 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-interruptions.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1923 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-issue-noparam-single-rev.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1979 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-legacy.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4224 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-mq-skip.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7337 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-mq.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12843 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-named-branches.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9602 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-newancestor.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19870 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-obsolete.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8453 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-obsolete2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15338 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-obsolete3.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11805 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-obsolete4.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10520 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-parameters.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2414 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-partial.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9707 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-pull.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9804 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-rename.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    21542 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-scenario-global.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4185 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-templates.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3596 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebase-transaction.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3302 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rebuildstate.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2792 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-record.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8961 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-releasenotes-formatting.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5255 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-releasenotes-merging.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4544 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-releasenotes-parsing.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2723 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-relink.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12085 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remote-hidden.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      943 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-bad-configs.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13385 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-bgprefetch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      720 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-blame.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2569 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-bundle2-legacy.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2488 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-bundle2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2517 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-bundles.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4682 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-cacheprocess.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2950 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-clone-tree.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2989 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-clone.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2929 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-corrupt-cache.t
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)    13117 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-datapack.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3799 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-gc.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5032 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-gcrepack.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1013 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-hgweb.t
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)    10399 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-histpack.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3399 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-http.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1002 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-keepset.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5647 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-linknodes.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5284 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-local.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2635 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-log.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1718 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-partial-shallow.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1237 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-permissions.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8432 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-prefetch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2227 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-pull-noshallow.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5932 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-push-pull.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14742 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-repack-fast.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18642 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-repack.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      639 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-share.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2988 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-sparse.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2005 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-strip.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2088 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-tags.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1030 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remotefilelog-wireproto.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18551 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-remove.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7390 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-removeemptydirs.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2525 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rename-after-merge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8079 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rename-dir-merge.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5859 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rename-merge1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    30910 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rename-merge2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3215 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rename-rev.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15409 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rename.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4361 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-repair-strip.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6043 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-repo-compengines.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3382 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-repo-filters-tiptoe.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2909 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-requires.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22311 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-resolve.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      312 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revert-flags.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1161 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revert-interactive-curses.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9633 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revert-interactive.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      345 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revert-unknown.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    32483 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revert.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      649 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revisions.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1944 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revlog-ancestry.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      298 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revlog-ancestry.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13841 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revlog-delta-find.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      685 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revlog-group-emptyiter.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1097 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revlog-mmapindex.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      511 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revlog-packentry.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16442 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revlog-raw.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      154 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revlog-raw.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2918 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revlog-v2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3265 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revlog.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      880 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revset-dirstate-parents.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10504 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revset-legacy-lookup.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2483 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revset-outgoing.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    55347 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revset.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    34705 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-revset2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      768 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rhg-no-generaldelta.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2613 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rhg-sparse-narrow.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10909 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rhg.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    12189 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rollback.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2975 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-run-tests.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    54543 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-run-tests.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5485 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rust-ancestor.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4185 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rust-discovery.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1881 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-rust-revlog.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1484 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-schemes.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3074 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-serve.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1931 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-server-view.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    60184 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-setdiscovery.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8770 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-share-bookmarks.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19132 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-share-safe.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7567 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-share.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    38022 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-shelve.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    25147 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-shelve2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4414 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-show-stack.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5189 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-show-work.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3946 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-show.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14157 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sidedata-exchange.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4210 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sidedata.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3274 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-simple-update.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3059 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-simplekeyvaluefile.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11514 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-simplemerge.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2837 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-single-head-obsolescence-named-branch-A1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2815 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-single-head-obsolescence-named-branch-A2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3029 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-single-head-obsolescence-named-branch-A3.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2962 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-single-head-obsolescence-named-branch-A4.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2811 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-single-head-obsolescence-named-branch-A5.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10780 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-single-head.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1239 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sparse-clear.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1582 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sparse-clone.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1266 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sparse-fsmonitor.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3685 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sparse-import.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4696 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sparse-merges.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5708 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sparse-profiles.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1592 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sparse-requirement.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14311 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sparse-revlog.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1747 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sparse-verbose-json.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      454 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sparse-with-safe-share.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9632 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sparse.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27906 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-split.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3352 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sqlitestore.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      565 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ssh-batch.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    16440 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ssh-bundle1.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4591 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ssh-clone-r.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    46502 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ssh-proto-unbundle.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    38702 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ssh-proto.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1913 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ssh-repoerror.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    20914 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ssh.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1517 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-sshserver.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22625 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-stabletailgraph.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4720 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-stack.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4376 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-state-extension.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8135 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-static-http.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14673 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-status-color.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      621 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-status-committed-and-ignored.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      751 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-status-eacces.t
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      937 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-status-inprocess.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       62 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-status-inprocess.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6343 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-status-rev.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4065 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-status-terse.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5838 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-status-tracked-key.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19609 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-status.t
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     9417 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-stdio.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3892 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-storage.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    11369 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-stream-bundle-v2.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      451 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-strict.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1436 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-strip-branch-cache.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5565 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-strip-cross.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    43035 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-strip.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    43874 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-subrepo-deep-nested-change.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    29361 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-subrepo-git.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3694 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-subrepo-missing.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1236 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-subrepo-paths.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    24140 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-subrepo-recursion.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6915 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-subrepo-relative-path.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18346 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-subrepo-svn.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    53049 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-subrepo.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1518 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-symlink-os-yes-fs-no.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      416 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-symlink-os-yes-fs-no.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1947 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-symlink-placeholder.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5186 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-symlinks.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    25927 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-tag.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    32700 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-tags.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    25985 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-template-basic.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    43113 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-template-functions.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6671 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-template-graph.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    32964 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-template-keywords.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    55565 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-template-map.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2905 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-tools.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    13384 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-transaction-rollback-on-revlog-split.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2713 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-transaction-rollback-on-sigpipe.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6387 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-transaction-safety.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     6552 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-transaction-wc-rollback-race.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27390 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-transplant.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     9293 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-treediscovery-legacy.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19979 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-treediscovery.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    27533 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-treemanifest.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8794 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-trusted.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4672 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-trusted.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      967 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ui-color.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       56 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ui-color.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4831 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ui-config.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1575 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ui-config.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1632 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ui-verbosity.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4290 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-ui-verbosity.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8865 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-unamend.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1397 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-unbundlehash.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15437 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-uncommit.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2237 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-unified-test.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3655 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-unionrepo.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      900 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-unrelated-pull.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     5447 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-up-local-change.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3456 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-update-atomic.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    18603 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-update-branches.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1285 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-update-dest.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      857 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-update-issue1456.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2410 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-update-names.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1714 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-update-reverse.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    83028 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-upgrade-repo.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1930 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-url-download.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     7801 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-url-rev.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14253 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-url.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      540 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-username-newline.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     4262 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-util.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19219 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-verify-repo-operations.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10418 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-verify.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    23519 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-walk.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2028 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-walkrepo.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1157 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-websub.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8428 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-win32text.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    22957 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-wireproto-clientreactor.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     8572 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-wireproto-framing.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    28449 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-wireproto-serverreactor.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2583 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-wireproto.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)       51 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-wireproto.py.out
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    15625 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-wireproto.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3850 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-worker.t
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    19492 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-wsgirequest.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      264 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/test-xdg.t
+drwxr-xr-x   0 alphare   (1000) alphare   (1000)        0 2023-06-22 12:24:49.604413 mercurial-6.5rc0/tests/testlib/
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    14930 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/badserverext.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      106 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/common.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      819 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/crash_transaction_late.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3631 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/exchange-obsmarker-util.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1024 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/ext-phase-report.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1565 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/ext-sidedata-2.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2716 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/ext-sidedata-3.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      529 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/ext-sidedata-4.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2438 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/ext-sidedata-5.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     3558 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/ext-sidedata.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     1193 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/ext-stream-clone-steps.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2433 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/merge-combination-util.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      244 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/obsmarker-common.sh
+-rw-r--r--   0 alphare   (1000) alphare   (1000)    10381 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/persistent-nodemap-race-ext.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      998 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/push-checkheads-util.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     3790 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/sigpipe-remote.py
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      395 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/sigpipe-worker.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)     2226 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/stream_clone_setup.sh
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)      948 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/testlib/wait-on-file
+-rwxr-xr-x   0 alphare   (1000) alphare   (1000)     6664 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/tinyproxy.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      146 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/unwrap-message-id.py
+-rw-r--r--   0 alphare   (1000) alphare   (1000)      795 2023-06-22 12:24:20.000000 mercurial-6.5rc0/tests/wireprotohelpers.sh
```

### Comparing `mercurial-6.4rc0/.gitlab/merge_request_templates/Default.md` & `mercurial-6.5rc0/.gitlab/merge_request_templates/Default.md`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/.hgignore` & `mercurial-6.5rc0/.hgignore`

 * *Files 7% similar despite different names*

```diff
@@ -15,14 +15,15 @@
 *.pyo
 *$py.class
 *.swp
 *.prof
 *.zip
 \#*\#
 .\#*
+result/
 tests/artifacts/cache/big-file-churn.hg
 tests/.coverage*
 tests/.testtimes*
 # the file is written in the CWD when run-tests is run.
 .testtimes
 tests/.hypothesis
 tests/hypothesis-generated
```

### Comparing `mercurial-6.4rc0/.hgsigs` & `mercurial-6.5rc0/.hgsigs`

 * *Files 3% similar despite different names*

```diff
@@ -235,7 +235,14 @@
 b5c8524827d20fe2e0ca8fb1234a0fe35a1a36c7 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmMQxRoZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVm2gC/9HikIaOE49euIoLj6ctYsJY9PSQK4Acw7BXvdsTVMmW27o87NxH75bGBbmPQ57X1iuKLCQ1RoU3p2Eh1gPbkIsouWO3enBIfsFmkPtWQz28zpCrI9CUXg2ug4PGFPN9XyxNmhJ7vJ4Cst2tRxz9PBKUBO2EXJN1UKIdMvurIeT2sQrDQf1ePc85QkXx79231wZyF98smnV7UYU9ZPFnAzfcuRzdFn7UmH3KKxHTZQ6wAevj/fJXf5NdTlqbeNmq/t75/nGKXSFPWtRGfFs8JHGkkLgBiTJVsHYSqcnKNdVldIFUoJP4c2/SPyoBkqNvoIrr73XRo8tdDF1iY4ddmhHMSmKgSRqLnIEgew3Apa/IwPdolg+lMsOtcjgz4CB9agJ+O0+rdZd2ZUBNMN0nBSUh+lrkMjat8TJAlvut9h/6HAe4Dz8WheoWol8f8t1jLOJvbdvsMYi+Hf9CZjp7PlHT9y/TnDarcw2YIrf6Bv+Fm14ZDelu9VlF2zR1X8cofY=
 dbdee8ac3e3fcdda1fa55b90c0a235125b7f8e6f 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmM77dQZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZViOTC/sEPicecV3h3v47VAIUigyKNWpcJ+epbRRaH6gqHTkexvULOPL6nJrdfBHkNry1KRtOcjaxQvtWZM+TRCfqsE++Q3ZYakRpWKontb/8xQSbmENvbnElLh6k0STxN/JVc480us7viDG5pHS9DLsgbkHmdCv5KdmSE0hphRrWX+5X7RTqpAfCgdwTkacB5Geu9QfRnuYjz6lvqbs5ITKtBGUYbg3hKzw2894FHtMqV6qa5rk1ZMmVDbQfKQaMVG41UWNoN7bLESi69EmF4q5jsXdIbuBy0KtNXmB+gdAaHN03B5xtc+IsQZOTHEUNlMgov3yEVTcA6fSG9/Z+CMsdCbyQxqkwakbwWS1L2WcAsrkHyafvbNdR2FU34iYRWOck8IUg2Ffv7UFrHabJDy+nY7vcTLb0f7lV4jLXMWEt1hvXWMYek6Y4jtWahg6fjmAdD3Uf4BMfsTdnQKPvJpWXx303jnST3xvFvuqbbbDlhLfAB9M6kxVntvCVkMlMpe39+gM=
 a3356ab610fc50000cf0ba55c424a4d96da11db7 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmNWr44ZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVjalC/9ddIeZ1qc3ykUZb+vKw+rZ6WS0rnDgrfFYBQFooK106lB+IC2PlghXSrY2hXn/7Dk95bK90S9AO4TFidDPiRYuBYdXR+G+CzmYFtCQzGBgGyrWgpUYsZUeA3VNqZ+Zbwn/vRNiFVNDsrFudjE6xEwaYdepmoXJsv3NdgZME7T0ZcDIujIa7ihiXvGFPVzMyF/VZg4QvdmerC4pvkeKC3KRNjhBkMQbf0GtQ4kpgMFBj5bmgXbq9rftL5yYy+rDiRQ0qzpOMHbdxvSZjPhK/do5M3rt2cjPxtF+7R3AHxQ6plOf0G89BONYebopY92OIyA3Qg9d/zIKDmibhgyxj4G9YU3+38gPEpsNeEw0fkyxhQbCY3QpNX4JGFaxq5GVCUywvVIuqoiOcQeXlTDN70zhAQHUx0rcGe1Lc6I+rT6Y2lNjJIdiCiMAWIl0D+4SVrLqdMYdSMXcBajTxOudb9KZnu03zNMXuLb8FFk1lFzkY7AcWA++d02f15P3sVZsDXE=
 04f1dba53c961dfdb875c8469adc96fa999cfbed 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmNyC5sZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVqF+C/4uLaV/4nizZkWD3PjU1WyFYDg4bWDFOHb+PWuQ/3uoHXu1/EaYRnqmcDyOSJ99aXZBQ78rm9xhjxdmbklZ4ll1EGkqfTiYH+ld+rqE8iaqlc/DVy7pFXaenYwxletzO1OezzwF4XDLi6hcqzY9CXA3NM40vf6W4Rs5bEIi4eSbgJSNB1ll6ZzjvkU5bWTUoxSH+fxIJUuo27El2etdlKFQkS3/oTzWHejpVn6SQ1KyojTHMQBDRK4rqJBISp3gTf4TEezb0q0HTutJYDFdQNIRqx7V1Ao4Ei+YNbenJzcWJOA/2uk4V0AvZ4tnjgAzBYKwvIL1HfoQ0OmILeXjlVzV7Xu0G57lavum0sKkz/KZLKyYhKQHjYQLE7YMSM2y6/UEoFNN577vB47CHUq446PSMb8dGs2rmj66rj4iz5ml0yX+V9O2PpmIKoPAu1Y5/6zB9rCL76MRx182IW2m3rm4lsTfXPBPtea/OFt6ylxqCJRxaA0pht4FiAOvicPKXh4=
 c890d8b8bc59b18e5febf60caada629df5356ee2 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmN48sEZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVqwwC/9GkaE5adkLaJBZeRqfLL710ZPMAttiPhLAYl9YcUeUjw2rTU1bxxUks0oSfW4J0AaJLscl+pG4zZW8FN2MXY3njdcpAA/bv4nb+rq50Mdm0mD3iLOyKbIDQbUoYe7YpIPbpyuf8G/y4R1IXiLJjK329vzIsHkqyKPwUzxvyfZkjg6Lx00RRcfWrosb2Jb0+EhP9Yi7tjJmNWjsaTb8Ufp+ImYAL3qcDErkqb6wJCGAM0AwVfAJ7MZz3v3E56n1HTPhNqf8UvfR4URsuDlk56mP4do/QThC7dANiKeWrFJSBPu8uSpaHzUk1XCat0RHK03DMr15Ln1YCEhTmaedHr2rtp0fgGqaMH1jLZt0+9fiPaaYjck7Y+aagdc3bt1VhqtClbCJz5KWynpCLrn8MX40QmXuwly+KHzMuPQ6i0ui95ifgtrW7/Zd7uI7mYZ2zUeFUZPnL9XmGpFI595N8TjoPuFeO/ea4OQbLUY+lmmgZQrWoTpc5LDUyFXSFzJS2bU=
 59466b13a3ae0e29a5d4f485393e516cfbb057d0 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmO1XgoZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVn8nDACU04KbPloLl+if6DQYreESnF9LU8C+qnLC/j5RRuaFNh/ec6C3DzLWqWdmnWA/siV3nUR1bXHfTui95azxJfYvWoXH2R2yam+YhE256B4rDDYWS1LI9kNNM+A33xcPS2HxVowkByhjB5FPKR6I90dX42BYJpTS5s/VPx63wXLznjFWuD7XJ3P0VI7D72j/+6EQCmHaAUEE5bO00Ob2JxmzJlaP+02fYc814PAONE2/ocfR0aExAVS3VA+SJGXnXTVpoaHr7NJKC2sBLFsdnhIRwtCf3rtGEvIJ5v2U2xx0ZEz/mimtGzW5ovkthobV4mojk0DRz7xBtA96pOGSRTD8QndIsdMCUipo8zZ/AGAMByCtsQOX7OYhR6gp+I6+iPh8fTR5oCbkO7cizDDQtXcrR5OT/BDH9xkAF1ghNL8o23a09/wfZ9NPg5zrh/4T/dFfoe2COlkAJJ1ttDPYyQkCfMsoWm3OXk6xJ3ExVbwkZzUDQSzsxGS+oxbFDWJZ64Q=
 8830004967ad865ead89c28a410405a6e71e0796 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmQAsOQZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVl7XC/0W+Wd4gzMUbaot+NVIZTpubNw3KHBDXrlMgwQgCDg7qcqJnVuT1NNEy5sRELjZOO0867k+pBchZaxdmAiFwY1W76+7nwiLBqfCkYgYY0iQe48JHTq9kCgohvx9PSEVbUsScmqAQImd5KzErjhsLj8D2FiFIrcMyqsCBq4ZPs0Ey7lVKu6q3z5eDjlrxUIr0up6yKvgBxhY0GxyTp6DGoinzlFMEadiJlsvlwO4C6UpzKiCGMeKNT5xHK/Hx3ChrOH2Yuu1fHaPLJ+ZpXjR33ileVYlkQrh1D6fWHXcP7ZuwsEKREtgsw1YjYczGFwmhBO362bNi5wy33mBtCvcIAqpsI0rMrExs66qqbfyG+Yp1dvkgzUfdhbYFHA+mvg3/YTSD9dLKzzsb69LM87+dvcLqhBJ0nEAuBmAzU5ECkoArbiwMT96NhhjLPRmJJdHNo0IDos/LBGTgkOZ6iqIx8Xm/tgjBjFJG8B+IVy3laNgun4AZ9Ejc3ahIfhJUIo2j8o=
+05de4896508e8ec387b33eb30d8aab78d1c8e9e4 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmQBI2AZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVrRZC/wJyPOJoxpjEJZaRoBmWtkOlf0Y0TyEb6wd8tZIVALNDYZMSMqT7UBjFmaZijOYndUW7ZCj1hKShaIw80vY/hjJ3KZMODY9t91SOwmrVaGrCUeF1tXkuhEgwxfkekPWLxYYc688gLb6oc3FBm//lucNGrOWBXw6yhm1dUcndHXXpafjJslKAHwJN7vI5q69SxvS6SlJUzh/RFWYLnbZ2Qi35ixkU12FZiYVzxDl2i7XbhVoT5mit6VTU7Wh4BMSYuorAv937sF9Y6asE7sQUYHC2C2qjp8S5uFXV/IrhCPbJyWVc4ymPm58Eh6SmItC9zHDviFF9aFoZMK/lfK3Dqumu3T9x6ZYcxulpjNsM0/yv9OiiWbw33PnNb74A9uwrxZHB3XexXiigBUlUzO4lJQ5Oe1rhpPfPPRVyxaeZ8/cPmoJjCuwoiG0YtUeNH5PkHi05O0/hLR9PftDY8oMyzOBErSqjMjZ6OTkFFgk3dI9rHU72C1KL9Jh5uHwEQchBmg=
+f14864fffdcab725d9eac6d4f4c07be05a35f59a 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmQc3KUZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVnYZDACh1Bcj8Yu3t8pO22SKWJnz8Ndw9Hvw+ifLaRxFUxKtqUYvy3CIl2qt8k7V13M25qw0061SKgcvNdjtkOhdmtFHNAbqryy0nK9oSZ2GfndmJfMxm9ixF/CcHrx+MmsklEz2woApViHW5PrmgKvZNsStQ5NM457Yx3B4nsT9b8t03NzdNiZRM+RZOkZ+4OdSbiB6hYuTqEFIi2YM+gfVM5Z7H8sEFBkUCtuwUjFGaWThZGGhAcqD5E7p/Lkjv4e4tzyHOzHDgdd+OCAkcbib6/E3Q1MlQ1x7CKpJ190T8R35CzAIMBVoTSI+Ov7OKw1OfGdeCvMVJsKUvqY3zrPawmJB6pG7GoVPEu5pU65H51U3Plq3GhsekUrKWY/BSHV9FOqpKZdnxOAllfWcjLYpbC/fM3l8uuQVcPAs89GvWKnDuE/NWCDYzDAYE++s/H4tP3Chv6yQbPSv/lbccst7OfLLDtXgRHIyEWLo392X3mWzhrkNtfJkBdi39uH9Aoh7pN0=
+83ea6ce48b4fd09fb79c4e34cc5750c805699a53 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmQ3860ZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVk3gDACIIcQxKfis/r5UNj7SqyFhQxUCo8Njp7zdLFv3CSWFdFiOpQONI7Byt9KjwedUkUK9tqdb03V7W32ZSBTrNLM11uHY9E5Aknjoza4m+aIGbamEVRWIIHXjUZEMKS9QcY8ElbDvvPu/xdZjyTEjNNiuByUpPUcJXVzpKrHm8Wy3GWDliYBuu68mzFIX3JnZKscdK4EjCAfDysSwwfLeBMpd0Rk+SgwjDwyPWAAyU3yDPNmlUn8qTGHjXxU3vsHCXpoJWkfKmQ9n++23WEpM9vC8zx2TIy70+gFUvKG77+Ucv+djQxHRv0L6L5qUSBJukD3R3nml1xu6pUeioBHepRmTUWgPbHa/gQ+J2Pw+rPCK51x0EeT0SJjxUR2mmMLbk8N2efM35lEjF/sNxotTq17Sv9bjwXhue6BURxpQDEyOuSaS0IlF56ndXtE/4FX3H6zgU1+3jw5iBWajr1E04QjPlSOJO7nIKYM9Jq3VpHR7MiFwfT46pJEfw9pNgZX2b8o=
+f952be90b0514a576dcc8bbe758ce3847faba9bb 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmQ+ZaoZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVuDOC/90SQ3UjXmByAaT5qr4bd3sVGt12lXlaKdyDxY0JMSKyHMUnb4YltHzNFxiUku10aRsRvJt5denTGeaOvAYbbXE7nbZJuyLD9rvfFTCe6EVx7kymCBwSbobKMzD79QHAFU7xu036gs7rmwyc++F4JF4IOrT4bjSYY5/8g0uLAHUexnn49QfQ5OYr325qShDFLjUZ7aH0yxA/gEr2MfXQmbIEc0eJJQXD1EhDkpSJFNIKzwWMOT1AhFk8kTlDqqbPnW7sDxTW+v/gGjAFYLHi8GMLEyrBQdEqytN7Pl9XOPXt/8RaDfIzYfl0OHxh2l1Y1MuH/PHrWO4PBPsr82QI2mxufYKuujpFMPr4PxXXl2g31OKhI8jJj+bHr62kGIOJCxZ8EPPGKXPGyoOuIVa0MeHmXxjb9kkj0SALjlaUvZrSENzRTsQXDNHQa+iDaITKLmItvLsaTEz9DJzGmI20shtJYcx4lqHsTgtMZfOtR5tmUknAFUUBZfUwvwULD4LmNI=
+fc445f8abcf90b33db7c463816a1b3560681767f 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmRTok8ZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVpZ5DACBv33k//ovzSbyH5/q+Xhk3TqNRY8IDOjoEhvDyu0bJHsvygOGXLUtHpQPth1RA4/c+AVNJrUeFvT02sLqqP2d9oSA9HEAYpOuzwgr1A+1o+Q2GyfD4cElP6KfiEe8oyFVOB0rfBgWNei1C0nnrhChQr5dOPR63uAFhHzkEsgsTFS7ONxZ1DHbe7gRV8OMMf1MatAtRzRexQJCqyNv7WodQdrKtjHqPKtlWl20dbwTHhzeiZbtjiTe0CVXVsOqnA1DQkO/IaiKQrn3zWdGY5ABbqQ1K0ceLcej4NFOeLo9ZrShndU3BuFUa9Dq9bnPYOI9wMqGoDh/GdTZkZEzBy5PTokY3AJHblbub49pi8YTenFcPdtd/v71AaNi3TKa45ZNhYVkPmRETYweHkLs3CIrSyeiBwU4RGuQZVD/GujAQB5yhk0w+LPMzBsHruD4vsgXwIraCzQIIJTjgyxKuAJGdGNUFYyxEpUkgz5G6MFrBKe8HO69y3Pm/qDNZ2maV8k=
+da372c745e0f053bb7a64e74cccd15810d96341d 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmSB7WkZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVoy+C/4zwO+Wxc3wr0aEzjVqAss7FuGS5e66H+0T3WzVgKIRMqiiOmUmmiNf+XloXlX4TOwoh9j9GNEpoZfV6TSwFSqV0LALaVIRRwrkJBDhnqw4eNBZbK5aBWNa2/21dkHecxF4KG3ai9kLwy2mtHxkDIy8T2LPvdx8pfNcYT4PZ19x2itqZLouBJqiZYehsqeMLNF2vRqkq+rQ+D2sFGLljgPo0JlpkOZ4IL7S/cqTOBG1sQ6KJK+hAE1kF1lhvK796VhKKXVnWVgqJLyg7ZI6168gxeFv5cyCtb+FUXJJ/5SOkxaCKJf3mg3DIYi3G7xjwB5CfUGW8A2qexgEjXeV42Mu7/Mkmn/aeTdL0UcRK3oBVHJwqt/fJlGFqVWt4/9g9KW5mJvTDQYBo/zjLyvKFEbnSLzhEP+9SvthCrtX0UYkKxOGi2M2Z7e9wgBB0gY8a36kA739lkNu6r3vH/FVh0aPTMWukLToELS90WgfViNr16lDnCeDjMgg97OKxWdOW6U=
+271a4ab29605ffa0bae5d3208eaa21a95427ff92 0 iQHNBAABCgA3FiEEH2b4zfZU6QXBHaBhoR4BzQ4F2VYFAmSUEeMZHGFscGhhcmVAcmFwaGFlbGdvbWVzLmRldgAKCRChHgHNDgXZVlJnC/98qGmpi0gHbsoCPfoxgV2uSE4XAXZXPvbHqKAVUVJbkQoS0L2jighUArPZsduRjD+nSf/jO951/DmnxIwXfF5qA2dP1eBnjSmXS3xslmqD7nUw+pP8mKUQvXky+AbiL5onWw4gRtsqTZg4DYnPMeaE/eIUy/j60kXsf6gaDkQSAF/+9vB5UcVI1z7gKY/nE5pGW6cS9kPd/BEg2icficaOHXcetQFi53Gcy5kLEaYc9f8RUrvc0Z9jDkZSlmTHfTLOY+1hlFZ2FRAvL1Ikh7Ks+85LWuqs1ZYIdB6ucudhLW1dGd/ZyD0iU82e0XrU/tm6oDBdeSFOy1AAXN5pern18VcPeaT/zGgN7DG1LW9jISbYFzLwvHwzTMKSVgq4HSfeTHiSKoWp0qAbcFHUYfC4L1Heqd/UfzVN/1/9eSj69Hbjff8+E6OOF15Ky2gtr8PSyP7WIu9rTueUUoWIMG99btq5OYvEbmWgHuHIcJBUEJOalvhrZePbTW3v22Eh45M=
```

### Comparing `mercurial-6.4rc0/.hgtags` & `mercurial-6.5rc0/.hgtags`

 * *Files 5% similar despite different names*

```diff
@@ -251,7 +251,14 @@
 04f1dba53c961dfdb875c8469adc96fa999cfbed 6.3.0
 04f1dba53c961dfdb875c8469adc96fa999cfbed 6.3
 04f1dba53c961dfdb875c8469adc96fa999cfbed 6.3.0
 0000000000000000000000000000000000000000 6.3.0
 c890d8b8bc59b18e5febf60caada629df5356ee2 6.3.1
 59466b13a3ae0e29a5d4f485393e516cfbb057d0 6.3.2
 8830004967ad865ead89c28a410405a6e71e0796 6.3.3
+05de4896508e8ec387b33eb30d8aab78d1c8e9e4 6.4rc0
+f14864fffdcab725d9eac6d4f4c07be05a35f59a 6.4
+83ea6ce48b4fd09fb79c4e34cc5750c805699a53 6.4.1
+f952be90b0514a576dcc8bbe758ce3847faba9bb 6.4.2
+fc445f8abcf90b33db7c463816a1b3560681767f 6.4.3
+da372c745e0f053bb7a64e74cccd15810d96341d 6.4.4
+271a4ab29605ffa0bae5d3208eaa21a95427ff92 6.4.5
```

### Comparing `mercurial-6.4rc0/.jshintrc` & `mercurial-6.5rc0/.jshintrc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/CONTRIBUTING` & `mercurial-6.5rc0/CONTRIBUTING`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/CONTRIBUTORS` & `mercurial-6.5rc0/CONTRIBUTORS`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/COPYING` & `mercurial-6.5rc0/COPYING`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/MANIFEST.in` & `mercurial-6.5rc0/MANIFEST.in`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,11 @@
 include .arcconfig
 include .clang-format
 include .editorconfig
+include .gitattributes
 include .gitlab/merge_request_templates/Default.md
 include .hgignore
 include .hgsigs
 include .hgtags
 include .jshintrc
 include CONTRIBUTING
 include CONTRIBUTORS
@@ -107,14 +108,16 @@
 include contrib/memory.py
 include contrib/mercurial.el
 include contrib/merge-lists/Cargo.lock
 include contrib/merge-lists/Cargo.toml
 include contrib/merge-lists/src/main.rs
 include contrib/merge-lists/tests/test-merge-lists.rs
 include contrib/mq.el
+include contrib/nix/flake.lock
+include contrib/nix/flake.nix
 include contrib/packaging/Makefile
 include contrib/packaging/build-linux-wheels.sh
 include contrib/packaging/builddeb
 include contrib/packaging/buildrpm
 include contrib/packaging/debian/cacerts.rc
 include contrib/packaging/debian/changelog
 include contrib/packaging/debian/compat
@@ -501,14 +504,15 @@
 include i18n/pt_BR.po
 include i18n/ro.po
 include i18n/ru.po
 include i18n/sv.po
 include i18n/zh_CN.po
 include i18n/zh_TW.po
 include mercurial/__init__.py
+include mercurial/__main__.py
 include mercurial/ancestor.py
 include mercurial/archival.py
 include mercurial/bdiff.c
 include mercurial/bdiff.h
 include mercurial/bitmanipulation.h
 include mercurial/bookmarks.py
 include mercurial/branchmap.py
@@ -731,14 +735,16 @@
 include mercurial/shelve.py
 include mercurial/similar.py
 include mercurial/simplemerge.py
 include mercurial/smartset.py
 include mercurial/sparse.py
 include mercurial/sshpeer.py
 include mercurial/sslutil.py
+include mercurial/stabletailgraph/__init__.py
+include mercurial/stabletailgraph/stabletailsort.py
 include mercurial/stack.py
 include mercurial/state.py
 include mercurial/statichttprepo.py
 include mercurial/statprof.py
 include mercurial/store.py
 include mercurial/streamclone.py
 include mercurial/strip.py
@@ -1044,14 +1050,16 @@
 include relnotes/5.7
 include relnotes/5.8
 include relnotes/5.9
 include relnotes/6.0
 include relnotes/6.1
 include relnotes/6.2
 include relnotes/6.3
+include relnotes/6.4
+include relnotes/6.5
 include relnotes/next
 include rust/.cargo/config
 include rust/Cargo.lock
 include rust/Cargo.toml
 include rust/README.rst
 include rust/chg/Cargo.lock
 include rust/chg/Cargo.toml
@@ -1063,14 +1071,15 @@
 include rust/chg/src/main.rs
 include rust/chg/src/message.rs
 include rust/chg/src/procutil.rs
 include rust/chg/src/runcommand.rs
 include rust/chg/src/sendfds.c
 include rust/chg/src/sighandlers.c
 include rust/chg/src/uihandler.rs
+include rust/clippy.toml
 include rust/hg-core/Cargo.toml
 include rust/hg-core/examples/nodemap/index.rs
 include rust/hg-core/examples/nodemap/main.rs
 include rust/hg-core/src/ancestors.rs
 include rust/hg-core/src/checkexec.rs
 include rust/hg-core/src/config/config.rs
 include rust/hg-core/src/config/layer.rs
@@ -1181,14 +1190,15 @@
 include tests/autodiff.py
 include tests/basic_test_result.py
 include tests/binfile.bin
 include tests/blackbox-readonly-dispatch.py
 include tests/blacklists/README
 include tests/blacklists/fsmonitor
 include tests/blacklists/linux-vfat
+include tests/blacklists/nix
 include tests/bruterebase.py
 include tests/bundles/darcs1.hg
 include tests/bundles/hgweb+obs.hg
 include tests/bundles/issue4041.hg
 include tests/bundles/issue4438-r1.hg
 include tests/bundles/issue4438-r2.hg
 include tests/bundles/issue6528.hg-v1
@@ -1230,15 +1240,14 @@
 include tests/flagprocessorext.py
 include tests/fsmonitor-run-tests.py
 include tests/generate-working-copy-states.py
 include tests/get-with-headers.py
 include tests/gpg/pubring.gpg
 include tests/gpg/secring.gpg
 include tests/gpg/trustdb.gpg
-include tests/helper-killhook.py
 include tests/helper-runtests.sh
 include tests/helpers-testrepo.sh
 include tests/heredoctest.py
 include tests/hghave
 include tests/hghave.py
 include tests/hgterm.ti
 include tests/hgweberror.py
@@ -1379,14 +1388,15 @@
 include tests/test-bookmarks-strip.t
 include tests/test-bookmarks.t
 include tests/test-branch-change.t
 include tests/test-branch-option.t
 include tests/test-branch-tag-confict.t
 include tests/test-branches.t
 include tests/test-bugzilla.t
+include tests/test-bundle-phase-internal.t
 include tests/test-bundle-phases.t
 include tests/test-bundle-r.t
 include tests/test-bundle-type.t
 include tests/test-bundle-vs-outgoing.t
 include tests/test-bundle.t
 include tests/test-bundle2-exchange.t
 include tests/test-bundle2-format.t
@@ -1425,17 +1435,19 @@
 include tests/test-chg.t
 include tests/test-children.t
 include tests/test-churn.t
 include tests/test-clone-cgi.t
 include tests/test-clone-pull-corruption.t
 include tests/test-clone-r.t
 include tests/test-clone-stream-format.t
+include tests/test-clone-stream-revlog-split.t
 include tests/test-clone-stream.t
 include tests/test-clone-update-order.t
 include tests/test-clone.t
+include tests/test-clonebundles-autogen.t
 include tests/test-clonebundles.t
 include tests/test-close-head.t
 include tests/test-commandserver.t
 include tests/test-commit-amend.t
 include tests/test-commit-interactive-curses.t
 include tests/test-commit-interactive.t
 include tests/test-commit-multiple.t
@@ -1538,14 +1550,15 @@
 include tests/test-directaccess.t
 include tests/test-dirs.py
 include tests/test-dirstate-backup.t
 include tests/test-dirstate-race.t
 include tests/test-dirstate-race2.t
 include tests/test-dirstate-read-race.t
 include tests/test-dirstate-status-write-race.t
+include tests/test-dirstate-version-fallback.t
 include tests/test-dirstate.t
 include tests/test-dispatch.py
 include tests/test-dispatch.py.out
 include tests/test-dispatch.t
 include tests/test-docker-packaging.t
 include tests/test-doctest.py
 include tests/test-double-merge.t
@@ -1935,14 +1948,15 @@
 include tests/test-pathconflicts-basic.t
 include tests/test-pathconflicts-merge.t
 include tests/test-pathconflicts-update.t
 include tests/test-pathencode.py
 include tests/test-paths.t
 include tests/test-pending.t
 include tests/test-permissions.t
+include tests/test-persistent-nodemap-stream-clone.t
 include tests/test-persistent-nodemap.t
 include tests/test-phabricator.t
 include tests/test-phase-archived.t
 include tests/test-phases-exchange.t
 include tests/test-phases.t
 include tests/test-profile.t
 include tests/test-progress.t
@@ -1952,14 +1966,15 @@
 include tests/test-pull-bundle.t
 include tests/test-pull-http.t
 include tests/test-pull-network.t
 include tests/test-pull-permission.t
 include tests/test-pull-pull-corruption.t
 include tests/test-pull-r.t
 include tests/test-pull-update.t
+include tests/test-pullling-to-general-delta.t
 include tests/test-purge-ignored-directory.t
 include tests/test-purge.t
 include tests/test-push-cgi.t
 include tests/test-push-checkheads-multibranches-E1.t
 include tests/test-push-checkheads-multibranches-E2.t
 include tests/test-push-checkheads-multibranches-E3.t
 include tests/test-push-checkheads-partial-C1.t
@@ -2004,14 +2019,15 @@
 include tests/test-rebase-brute-force.t
 include tests/test-rebase-cache.t
 include tests/test-rebase-check-restore.t
 include tests/test-rebase-collapse.t
 include tests/test-rebase-conflicts.t
 include tests/test-rebase-dest.t
 include tests/test-rebase-detach.t
+include tests/test-rebase-dry-run.t
 include tests/test-rebase-empty-successor.t
 include tests/test-rebase-emptycommit.t
 include tests/test-rebase-inmemory.t
 include tests/test-rebase-interruptions.t
 include tests/test-rebase-issue-noparam-single-rev.t
 include tests/test-rebase-legacy.t
 include tests/test-rebase-mq-skip.t
@@ -2151,18 +2167,21 @@
 include tests/test-ssh-bundle1.t
 include tests/test-ssh-clone-r.t
 include tests/test-ssh-proto-unbundle.t
 include tests/test-ssh-proto.t
 include tests/test-ssh-repoerror.t
 include tests/test-ssh.t
 include tests/test-sshserver.py
+include tests/test-stabletailgraph.t
 include tests/test-stack.t
 include tests/test-state-extension.t
 include tests/test-static-http.t
 include tests/test-status-color.t
+include tests/test-status-committed-and-ignored.t
+include tests/test-status-eacces.t
 include tests/test-status-inprocess.py
 include tests/test-status-inprocess.py.out
 include tests/test-status-rev.t
 include tests/test-status-terse.t
 include tests/test-status-tracked-key.t
 include tests/test-status.t
 include tests/test-stdio.py
```

### Comparing `mercurial-6.4rc0/Makefile` & `mercurial-6.5rc0/Makefile`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/PKG-INFO` & `mercurial-6.5rc0/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mercurial
-Version: 6.4rc0
+Version: 6.5rc0
 Summary: Fast scalable distributed SCM (revision control, version control) system
 Home-page: https://mercurial-scm.org/
 Download-URL: https://mercurial-scm.org/release/
 Author: Olivia Mackall and many others
 Author-email: mercurial@mercurial-scm.org
 License: GNU GPLv2 or any later version
 Classifier: Development Status :: 6 - Mature
```

### Comparing `mercurial-6.4rc0/README.rst` & `mercurial-6.5rc0/README.rst`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/Makefile.python` & `mercurial-6.5rc0/contrib/Makefile.python`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/all-revsets.txt` & `mercurial-6.5rc0/contrib/all-revsets.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/README.rst` & `mercurial-6.5rc0/contrib/automation/README.rst`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/automation.py` & `mercurial-6.5rc0/contrib/automation/automation.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/hgautomation/__init__.py` & `mercurial-6.5rc0/contrib/automation/hgautomation/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/hgautomation/aws.py` & `mercurial-6.5rc0/contrib/automation/hgautomation/aws.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/hgautomation/cli.py` & `mercurial-6.5rc0/contrib/automation/hgautomation/cli.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/hgautomation/linux.py` & `mercurial-6.5rc0/contrib/automation/hgautomation/linux.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/hgautomation/pypi.py` & `mercurial-6.5rc0/contrib/automation/hgautomation/pypi.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/hgautomation/ssh.py` & `mercurial-6.5rc0/contrib/automation/hgautomation/ssh.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/hgautomation/try_server.py` & `mercurial-6.5rc0/contrib/automation/hgautomation/try_server.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/hgautomation/windows.py` & `mercurial-6.5rc0/contrib/automation/hgautomation/windows.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/hgautomation/winrm.py` & `mercurial-6.5rc0/contrib/automation/hgautomation/winrm.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/linux-requirements-py3.5.txt` & `mercurial-6.5rc0/contrib/automation/linux-requirements-py3.5.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/linux-requirements-py3.txt` & `mercurial-6.5rc0/contrib/automation/linux-requirements-py3.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/linux-requirements.txt.in` & `mercurial-6.5rc0/contrib/automation/linux-requirements.txt.in`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/automation/requirements.txt` & `mercurial-6.5rc0/contrib/automation/requirements.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/base-revsets.txt` & `mercurial-6.5rc0/contrib/base-revsets.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/bash_completion` & `mercurial-6.5rc0/contrib/bash_completion`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/bdiff-torture.py` & `mercurial-6.5rc0/contrib/bdiff-torture.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/benchmarks/__init__.py` & `mercurial-6.5rc0/contrib/benchmarks/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/benchmarks/perf.py` & `mercurial-6.5rc0/contrib/benchmarks/perf.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/benchmarks/revset.py` & `mercurial-6.5rc0/contrib/benchmarks/revset.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/byteify-strings.py` & `mercurial-6.5rc0/contrib/byteify-strings.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/casesmash.py` & `mercurial-6.5rc0/contrib/casesmash.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/catapipe.py` & `mercurial-6.5rc0/contrib/catapipe.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/check-code.py` & `mercurial-6.5rc0/contrib/check-code.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/check-commit` & `mercurial-6.5rc0/contrib/check-commit`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/check-config.py` & `mercurial-6.5rc0/contrib/check-config.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/check-py3-compat.py` & `mercurial-6.5rc0/contrib/check-py3-compat.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/check-pytype.sh` & `mercurial-6.5rc0/contrib/check-pytype.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/chg/Makefile` & `mercurial-6.5rc0/contrib/chg/Makefile`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/chg/README` & `mercurial-6.5rc0/contrib/chg/README`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/chg/chg.1` & `mercurial-6.5rc0/contrib/chg/chg.1`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/chg/chg.c` & `mercurial-6.5rc0/contrib/chg/chg.c`

 * *Files 8% similar despite different names*

```diff
@@ -27,14 +27,16 @@
 #include "procutil.h"
 #include "util.h"
 
 #ifndef PATH_MAX
 #define PATH_MAX 4096
 #endif
 
+extern char **environ;
+
 struct cmdserveropts {
 	char sockname[PATH_MAX];
 	char initsockname[PATH_MAX];
 	char redirectsockname[PATH_MAX];
 	size_t argsize;
 	const char **args;
 };
@@ -234,15 +236,14 @@
 	}
 	return hgcmd;
 }
 
 static void execcmdserver(const struct cmdserveropts *opts)
 {
 	const char *hgcmd = gethgcmd();
-
 	const char *baseargv[] = {
 	    hgcmd,     "serve",     "--no-profile",     "--cmdserver",
 	    "chgunix", "--address", opts->initsockname, "--daemon-postexec",
 	    "chdir:/",
 	};
 	size_t baseargvsize = sizeof(baseargv) / sizeof(baseargv[0]);
 	size_t argsize = baseargvsize + opts->argsize + 1;
@@ -480,15 +481,15 @@
 static void execoriginalhg(const char *argv[])
 {
 	debugmsg("execute original hg");
 	if (execvp(gethgcmd(), (char **)argv) < 0)
 		abortmsgerrno("failed to exec original hg");
 }
 
-int main(int argc, const char *argv[], const char *envp[])
+int main(int argc, const char *argv[])
 {
 	if (getenv("CHGDEBUG"))
 		enabledebugmsg();
 
 	if (!getenv("HGPLAIN") && isatty(fileno(stderr)))
 		enablecolor();
 
@@ -509,21 +510,34 @@
 	if (argc == 2) {
 		if (strcmp(argv[1], "--kill-chg-daemon") == 0) {
 			killcmdserver(&opts);
 			return 0;
 		}
 	}
 
+	/* Set $CHGHG to the path of the hg executable we intend to use. This
+	 * is a no-op if $CHGHG was expliclty specified, but otherwise this
+	 * ensures that we will spawn a new command server if we connect to an
+	 * existing one running from a different executable. This should only
+	 * only be needed when chg is built with HGPATHREL since otherwise the
+	 * hg executable used when CHGHG is absent should be deterministic.
+	 * */
+	if (setenv("CHGHG", gethgcmd(), 1) != 0)
+		abortmsgerrno("failed to setenv");
+
 	hgclient_t *hgc;
 	size_t retry = 0;
 	while (1) {
 		hgc = connectcmdserver(&opts);
 		if (!hgc)
 			abortmsg("cannot open hg client");
-		hgc_setenv(hgc, envp);
+		/* Use `environ(7)` instead of the optional `envp` argument to
+		 * `main` because `envp` does not update when the environment
+		 * changes, but `environ` does. */
+		hgc_setenv(hgc, (const char *const *)environ);
 		const char **insts = hgc_validate(hgc, argv + 1, argc - 1);
 		int needreconnect = runinstructions(&opts, insts);
 		free(insts);
 		if (!needreconnect)
 			break;
 		hgc_close(hgc);
 		if (++retry > 10)
```

### Comparing `mercurial-6.4rc0/contrib/chg/hgclient.c` & `mercurial-6.5rc0/contrib/chg/hgclient.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/chg/hgclient.h` & `mercurial-6.5rc0/contrib/chg/hgclient.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/chg/procutil.c` & `mercurial-6.5rc0/contrib/chg/procutil.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/chg/procutil.h` & `mercurial-6.5rc0/contrib/chg/procutil.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/chg/util.c` & `mercurial-6.5rc0/contrib/chg/util.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/chg/util.h` & `mercurial-6.5rc0/contrib/chg/util.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/debugcmdserver.py` & `mercurial-6.5rc0/contrib/debugcmdserver.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/debugshell.py` & `mercurial-6.5rc0/contrib/debugshell.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/docker/apache-server/Dockerfile` & `mercurial-6.5rc0/contrib/docker/apache-server/Dockerfile`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/docker/apache-server/README.rst` & `mercurial-6.5rc0/contrib/docker/apache-server/README.rst`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/docker/apache-server/entrypoint.sh` & `mercurial-6.5rc0/contrib/docker/apache-server/entrypoint.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/docker/apache-server/vhost.conf` & `mercurial-6.5rc0/contrib/docker/apache-server/vhost.conf`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/dumprevlog` & `mercurial-6.5rc0/contrib/dumprevlog`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/editmerge` & `mercurial-6.5rc0/contrib/editmerge`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/editmergeps.ps1` & `mercurial-6.5rc0/contrib/editmergeps.ps1`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/FuzzedDataProvider.h` & `mercurial-6.5rc0/contrib/fuzz/FuzzedDataProvider.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/Makefile` & `mercurial-6.5rc0/contrib/fuzz/Makefile`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/README.rst` & `mercurial-6.5rc0/contrib/fuzz/README.rst`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/bdiff.cc` & `mercurial-6.5rc0/contrib/fuzz/bdiff.cc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/dirs.cc` & `mercurial-6.5rc0/contrib/fuzz/dirs.cc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/dirs_corpus.py` & `mercurial-6.5rc0/contrib/fuzz/dirs_corpus.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/dirstate.cc` & `mercurial-6.5rc0/contrib/fuzz/dirstate.cc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/fm1readmarkers.cc` & `mercurial-6.5rc0/contrib/fuzz/fm1readmarkers.cc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/fm1readmarkers_corpus.py` & `mercurial-6.5rc0/contrib/fuzz/fm1readmarkers_corpus.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/fncache.cc` & `mercurial-6.5rc0/contrib/fuzz/fncache.cc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/fuzzutil.h` & `mercurial-6.5rc0/contrib/fuzz/fuzzutil.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/jsonescapeu8fast.cc` & `mercurial-6.5rc0/contrib/fuzz/jsonescapeu8fast.cc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/manifest.cc` & `mercurial-6.5rc0/contrib/fuzz/manifest.cc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/manifest_corpus.py` & `mercurial-6.5rc0/contrib/fuzz/manifest_corpus.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/mpatch.cc` & `mercurial-6.5rc0/contrib/fuzz/mpatch.cc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/mpatch_corpus.py` & `mercurial-6.5rc0/contrib/fuzz/mpatch_corpus.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/pyutil.cc` & `mercurial-6.5rc0/contrib/fuzz/pyutil.cc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/revlog.cc` & `mercurial-6.5rc0/contrib/fuzz/revlog.cc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/revlog_corpus.py` & `mercurial-6.5rc0/contrib/fuzz/revlog_corpus.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/standalone_fuzz_target_runner.cc` & `mercurial-6.5rc0/contrib/fuzz/standalone_fuzz_target_runner.cc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/fuzz/xdiff.cc` & `mercurial-6.5rc0/contrib/fuzz/xdiff.cc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/genosxversion.py` & `mercurial-6.5rc0/contrib/genosxversion.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/heptapod-ci.yml` & `mercurial-6.5rc0/contrib/heptapod-ci.yml`

 * *Files 1% similar despite different names*

```diff
@@ -22,14 +22,15 @@
       - hg -R /tmp/mercurial-ci/ update `hg log --rev '.' --template '{node}'`
       - cd /tmp/mercurial-ci/
       - ls -1 tests/test-check-*.* > /tmp/check-tests.txt
       - black --version
       - clang-format --version
     script:
         - echo "python used, $PYTHON"
+        - $PYTHON --version
         - echo "$RUNTEST_ARGS"
         - HGTESTS_ALLOW_NETIO="$TEST_HGTESTS_ALLOW_NETIO" HGMODULEPOLICY="$TEST_HGMODULEPOLICY" "$PYTHON" tests/run-tests.py --color=always $RUNTEST_ARGS
 
 checks:
     <<: *runtests
     variables:
         RUNTEST_ARGS: "--time --test-list /tmp/check-tests.txt"
```

### Comparing `mercurial-6.4rc0/contrib/hg-ssh` & `mercurial-6.5rc0/contrib/hg-ssh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/hg-test-mode.el` & `mercurial-6.5rc0/contrib/hg-test-mode.el`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/hgclient.py` & `mercurial-6.5rc0/contrib/hgclient.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/hgk` & `mercurial-6.5rc0/contrib/hgk`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/hgperf` & `mercurial-6.5rc0/contrib/hgperf`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/hgsh/hgsh.c` & `mercurial-6.5rc0/contrib/hgsh/hgsh.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/hgweb.fcgi` & `mercurial-6.5rc0/contrib/hgweb.fcgi`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/hgweb.wsgi` & `mercurial-6.5rc0/contrib/hgweb.wsgi`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/import-checker.py` & `mercurial-6.5rc0/contrib/import-checker.py`

 * *Files 0% similar despite different names*

```diff
@@ -40,14 +40,15 @@
     'mercurial.pure.bdiff',
     'mercurial.pure.mpatch',
     'mercurial.pure.osutil',
     'mercurial.pure.parsers',
     # third-party imports should be directly imported
     'mercurial.thirdparty',
     'mercurial.thirdparty.attr',
+    'mercurial.thirdparty.jaraco.collections',
     'mercurial.thirdparty.zope',
     'mercurial.thirdparty.zope.interface',
     'typing',
     'xml.etree.ElementTree',
 )
 
 # Allow list of symbols that can be directly imported.
@@ -228,14 +229,15 @@
     for m in ['msvcrt', '_winreg']:
         yield m
     yield '__builtin__'
     yield 'builtins'  # python3 only
     yield 'importlib.abc'  # python3 only
     yield 'importlib.machinery'  # python3 only
     yield 'importlib.util'  # python3 only
+    yield 'packaging.version'
     for m in 'fcntl', 'grp', 'pwd', 'termios':  # Unix only
         yield m
     for m in 'cPickle', 'datetime':  # in Python (not C) on PyPy
         yield m
     for m in ['cffi']:
         yield m
     stdlib_prefixes = {sys.prefix, sys.exec_prefix}
```

### Comparing `mercurial-6.4rc0/contrib/install-windows-dependencies.ps1` & `mercurial-6.5rc0/contrib/install-windows-dependencies.ps1`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/logo-droplets.svg` & `mercurial-6.5rc0/contrib/logo-droplets.svg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/memory.py` & `mercurial-6.5rc0/contrib/memory.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/mercurial.el` & `mercurial-6.5rc0/contrib/mercurial.el`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/merge-lists/Cargo.lock` & `mercurial-6.5rc0/contrib/merge-lists/Cargo.lock`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/merge-lists/Cargo.toml` & `mercurial-6.5rc0/contrib/merge-lists/Cargo.toml`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/merge-lists/src/main.rs` & `mercurial-6.5rc0/contrib/merge-lists/src/main.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/merge-lists/tests/test-merge-lists.rs` & `mercurial-6.5rc0/contrib/merge-lists/tests/test-merge-lists.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/mq.el` & `mercurial-6.5rc0/contrib/mq.el`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/Makefile` & `mercurial-6.5rc0/contrib/packaging/Makefile`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/build-linux-wheels.sh` & `mercurial-6.5rc0/contrib/packaging/build-linux-wheels.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/builddeb` & `mercurial-6.5rc0/contrib/packaging/builddeb`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/buildrpm` & `mercurial-6.5rc0/contrib/packaging/buildrpm`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/debian/control` & `mercurial-6.5rc0/contrib/packaging/debian/control`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/debian/copyright` & `mercurial-6.5rc0/contrib/packaging/debian/copyright`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/debian/rules` & `mercurial-6.5rc0/contrib/packaging/debian/rules`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/docker/rhel9` & `mercurial-6.5rc0/contrib/packaging/docker/rhel9`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/dockerdeb` & `mercurial-6.5rc0/contrib/packaging/dockerdeb`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/dockerrpm` & `mercurial-6.5rc0/contrib/packaging/dockerrpm`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/hg-docker` & `mercurial-6.5rc0/contrib/packaging/hg-docker`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/hgpackaging/cli.py` & `mercurial-6.5rc0/contrib/packaging/hgpackaging/cli.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/hgpackaging/downloads.py` & `mercurial-6.5rc0/contrib/packaging/hgpackaging/downloads.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/hgpackaging/inno.py` & `mercurial-6.5rc0/contrib/packaging/hgpackaging/inno.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/hgpackaging/pyoxidizer.py` & `mercurial-6.5rc0/contrib/packaging/hgpackaging/pyoxidizer.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/hgpackaging/util.py` & `mercurial-6.5rc0/contrib/packaging/hgpackaging/util.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/hgpackaging/wix.py` & `mercurial-6.5rc0/contrib/packaging/hgpackaging/wix.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/inno/mercurial.iss` & `mercurial-6.5rc0/contrib/packaging/inno/mercurial.iss`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/inno/modpath.iss` & `mercurial-6.5rc0/contrib/packaging/inno/modpath.iss`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/inno/readme.rst` & `mercurial-6.5rc0/contrib/packaging/inno/readme.rst`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/macosx/Readme.html` & `mercurial-6.5rc0/contrib/packaging/macosx/Readme.html`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/macosx/Welcome.html` & `mercurial-6.5rc0/contrib/packaging/macosx/Welcome.html`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/macosx/distribution.xml` & `mercurial-6.5rc0/contrib/packaging/macosx/distribution.xml`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/mercurial.spec` & `mercurial-6.5rc0/contrib/packaging/mercurial.spec`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/packagelib.sh` & `mercurial-6.5rc0/contrib/packaging/packagelib.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/packaging.py` & `mercurial-6.5rc0/contrib/packaging/packaging.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/requirements-macos.txt` & `mercurial-6.5rc0/contrib/packaging/requirements-macos.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/requirements-macos.txt.in` & `mercurial-6.5rc0/contrib/packaging/requirements-macos.txt.in`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/requirements-windows-py3.txt` & `mercurial-6.5rc0/contrib/packaging/requirements-windows-py3.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/requirements.txt` & `mercurial-6.5rc0/contrib/packaging/requirements.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/wix/COPYING.rtf` & `mercurial-6.5rc0/contrib/packaging/wix/COPYING.rtf`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/wix/guids.wxi` & `mercurial-6.5rc0/contrib/packaging/wix/guids.wxi`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/wix/mercurial.wxs` & `mercurial-6.5rc0/contrib/packaging/wix/mercurial.wxs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/packaging/wix/readme.rst` & `mercurial-6.5rc0/contrib/packaging/wix/readme.rst`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/perf-utils/compare-discovery-case` & `mercurial-6.5rc0/contrib/perf-utils/compare-discovery-case`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/perf-utils/discovery-helper.sh` & `mercurial-6.5rc0/contrib/perf-utils/discovery-helper.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/perf-utils/perf-revlog-write-plot.py` & `mercurial-6.5rc0/contrib/perf-utils/perf-revlog-write-plot.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/perf-utils/search-discovery-case` & `mercurial-6.5rc0/contrib/perf-utils/search-discovery-case`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/perf-utils/subsetmaker.py` & `mercurial-6.5rc0/contrib/perf-utils/subsetmaker.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/perf.py` & `mercurial-6.5rc0/contrib/perf.py`

 * *Files 2% similar despite different names*

```diff
@@ -528,18 +528,24 @@
 # list of stop condition (elapsed time, minimal run count)
 DEFAULTLIMITS = (
     (3.0, 100),
     (10.0, 3),
 )
 
 
+@contextlib.contextmanager
+def noop_context():
+    yield
+
+
 def _timer(
     fm,
     func,
     setup=None,
+    context=noop_context,
     title=None,
     displayall=False,
     limits=DEFAULTLIMITS,
     prerun=0,
     profiler=None,
 ):
     gc.collect()
@@ -547,22 +553,24 @@
     begin = util.timer()
     count = 0
     if profiler is None:
         profiler = NOOPCTX
     for i in range(prerun):
         if setup is not None:
             setup()
-        func()
+        with context():
+            func()
     keepgoing = True
     while keepgoing:
         if setup is not None:
             setup()
-        with profiler:
-            with timeone() as item:
-                r = func()
+        with context():
+            with profiler:
+                with timeone() as item:
+                    r = func()
         profiler = NOOPCTX
         count += 1
         results.append(item[0])
         cstop = util.timer()
         # Look for a stop condition.
         elapsed = cstop - begin
         for t, mincount in limits:
@@ -1896,14 +1904,209 @@
             os.environ['HGRCPATH'] = r' '
             os.system("%s version -q > NUL" % sys.argv[0])
 
     timer(d)
     fm.end()
 
 
+def _find_stream_generator(version):
+    """find the proper generator function for this stream version"""
+    import mercurial.streamclone
+
+    available = {}
+
+    # try to fetch a v1 generator
+    generatev1 = getattr(mercurial.streamclone, "generatev1", None)
+    if generatev1 is not None:
+
+        def generate(repo):
+            entries, bytes, data = generatev2(repo, None, None, True)
+            return data
+
+        available[b'v1'] = generatev1
+    # try to fetch a v2 generator
+    generatev2 = getattr(mercurial.streamclone, "generatev2", None)
+    if generatev2 is not None:
+
+        def generate(repo):
+            entries, bytes, data = generatev2(repo, None, None, True)
+            return data
+
+        available[b'v2'] = generate
+    # try to fetch a v3 generator
+    generatev3 = getattr(mercurial.streamclone, "generatev3", None)
+    if generatev3 is not None:
+
+        def generate(repo):
+            entries, bytes, data = generatev3(repo, None, None, True)
+            return data
+
+        available[b'v3-exp'] = generate
+
+    # resolve the request
+    if version == b"latest":
+        # latest is the highest non experimental version
+        latest_key = max(v for v in available if b'-exp' not in v)
+        return available[latest_key]
+    elif version in available:
+        return available[version]
+    else:
+        msg = b"unkown or unavailable version: %s"
+        msg %= version
+        hint = b"available versions: %s"
+        hint %= b', '.join(sorted(available))
+        raise error.Abort(msg, hint=hint)
+
+
+@command(
+    b'perf::stream-locked-section',
+    [
+        (
+            b'',
+            b'stream-version',
+            b'latest',
+            b'stream version to use ("v1", "v2", "v3" or "latest", (the default))',
+        ),
+    ]
+    + formatteropts,
+)
+def perf_stream_clone_scan(ui, repo, stream_version, **opts):
+    """benchmark the initial, repo-locked, section of a stream-clone"""
+
+    opts = _byteskwargs(opts)
+    timer, fm = gettimer(ui, opts)
+
+    # deletion of the generator may trigger some cleanup that we do not want to
+    # measure
+    result_holder = [None]
+
+    def setupone():
+        result_holder[0] = None
+
+    generate = _find_stream_generator(stream_version)
+
+    def runone():
+        # the lock is held for the duration the initialisation
+        result_holder[0] = generate(repo)
+
+    timer(runone, setup=setupone, title=b"load")
+    fm.end()
+
+
+@command(
+    b'perf::stream-generate',
+    [
+        (
+            b'',
+            b'stream-version',
+            b'latest',
+            b'stream version to us ("v1", "v2" or "latest", (the default))',
+        ),
+    ]
+    + formatteropts,
+)
+def perf_stream_clone_generate(ui, repo, stream_version, **opts):
+    """benchmark the full generation of a stream clone"""
+
+    opts = _byteskwargs(opts)
+    timer, fm = gettimer(ui, opts)
+
+    # deletion of the generator may trigger some cleanup that we do not want to
+    # measure
+
+    generate = _find_stream_generator(stream_version)
+
+    def runone():
+        # the lock is held for the duration the initialisation
+        for chunk in generate(repo):
+            pass
+
+    timer(runone, title=b"generate")
+    fm.end()
+
+
+@command(
+    b'perf::stream-consume',
+    formatteropts,
+)
+def perf_stream_clone_consume(ui, repo, filename, **opts):
+    """benchmark the full application of a stream clone
+
+    This include the creation of the repository
+    """
+    # try except to appease check code
+    msg = b"mercurial too old, missing necessary module: %s"
+    try:
+        from mercurial import bundle2
+    except ImportError as exc:
+        msg %= _bytestr(exc)
+        raise error.Abort(msg)
+    try:
+        from mercurial import exchange
+    except ImportError as exc:
+        msg %= _bytestr(exc)
+        raise error.Abort(msg)
+    try:
+        from mercurial import hg
+    except ImportError as exc:
+        msg %= _bytestr(exc)
+        raise error.Abort(msg)
+    try:
+        from mercurial import localrepo
+    except ImportError as exc:
+        msg %= _bytestr(exc)
+        raise error.Abort(msg)
+
+    opts = _byteskwargs(opts)
+    timer, fm = gettimer(ui, opts)
+
+    # deletion of the generator may trigger some cleanup that we do not want to
+    # measure
+    if not (os.path.isfile(filename) and os.access(filename, os.R_OK)):
+        raise error.Abort("not a readable file: %s" % filename)
+
+    run_variables = [None, None]
+
+    @contextlib.contextmanager
+    def context():
+        with open(filename, mode='rb') as bundle:
+            with tempfile.TemporaryDirectory() as tmp_dir:
+                tmp_dir = fsencode(tmp_dir)
+                run_variables[0] = bundle
+                run_variables[1] = tmp_dir
+                yield
+                run_variables[0] = None
+                run_variables[1] = None
+
+    def runone():
+        bundle = run_variables[0]
+        tmp_dir = run_variables[1]
+        # only pass ui when no srcrepo
+        localrepo.createrepository(
+            repo.ui, tmp_dir, requirements=repo.requirements
+        )
+        target = hg.repository(repo.ui, tmp_dir)
+        gen = exchange.readbundle(target.ui, bundle, bundle.name)
+        # stream v1
+        if util.safehasattr(gen, 'apply'):
+            gen.apply(target)
+        else:
+            with target.transaction(b"perf::stream-consume") as tr:
+                bundle2.applybundle(
+                    target,
+                    gen,
+                    tr,
+                    source=b'unbundle',
+                    url=filename,
+                )
+
+    timer(runone, context=context, title=b"consume")
+    fm.end()
+
+
 @command(b'perf::parents|perfparents', formatteropts)
 def perfparents(ui, repo, **opts):
     """benchmark the time necessary to fetch one changeset's parents.
 
     The fetch is done using the `node identifier`, traversing all object layers
     from the repository object. The first N revisions will be used for this
     benchmark. N is controlled by the ``perf.parentscount`` config option
```

### Comparing `mercurial-6.4rc0/contrib/phab-clean.py` & `mercurial-6.5rc0/contrib/phab-clean.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/phab-refresh-stack.sh` & `mercurial-6.5rc0/contrib/phab-refresh-stack.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/plan9/9diff` & `mercurial-6.5rc0/contrib/plan9/9diff`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/plan9/README` & `mercurial-6.5rc0/contrib/plan9/README`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/plan9/mkfile` & `mercurial-6.5rc0/contrib/plan9/mkfile`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/pull_logger.py` & `mercurial-6.5rc0/contrib/pull_logger.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/pylintrc` & `mercurial-6.5rc0/contrib/pylintrc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-hook-examples.py` & `mercurial-6.5rc0/contrib/python-hook-examples.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/LICENSE` & `mercurial-6.5rc0/contrib/python-zstandard/LICENSE`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/NEWS.rst` & `mercurial-6.5rc0/contrib/python-zstandard/NEWS.rst`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/README.rst` & `mercurial-6.5rc0/contrib/python-zstandard/README.rst`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/bufferutil.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/bufferutil.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressionchunker.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressionchunker.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressiondict.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressiondict.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressionparams.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressionparams.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressionreader.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressionreader.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressionwriter.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressionwriter.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressobj.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressobj.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressor.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressor.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/compressoriterator.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/compressoriterator.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/constants.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/constants.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/decompressionreader.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/decompressionreader.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/decompressionwriter.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/decompressionwriter.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/decompressobj.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/decompressobj.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/decompressor.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/decompressor.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/decompressoriterator.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/decompressoriterator.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/frameparams.c` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/frameparams.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/c-ext/python-zstandard.h` & `mercurial-6.5rc0/contrib/python-zstandard/c-ext/python-zstandard.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/make_cffi.py` & `mercurial-6.5rc0/contrib/python-zstandard/make_cffi.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/setup.py` & `mercurial-6.5rc0/contrib/python-zstandard/setup.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/setup_zstd.py` & `mercurial-6.5rc0/contrib/python-zstandard/setup_zstd.py`

 * *Files 4% similar despite different names*

```diff
@@ -141,16 +141,24 @@
             sources.update(
                 [os.path.join(actual_root, p) for p in zstd_sources_legacy]
             )
     sources = list(sources)
 
     include_dirs = set([os.path.join(actual_root, d) for d in ext_includes])
     if not system_zstd:
-        include_dirs.update(
-            [os.path.join(actual_root, d) for d in zstd_includes]
+        from distutils import sysconfig
+        from shlex import quote
+
+        includes = []
+        for incdir in [os.path.join(actual_root, d) for d in zstd_includes]:
+            includes.append('-I' + quote(incdir))
+            include_dirs.add(incdir)
+        config_vars = sysconfig.get_config_vars()
+        config_vars['CFLAGS'] = ' '.join(
+            includes + [config_vars.get('CFLAGS', '')]
         )
         if support_legacy:
             include_dirs.update(
                 [os.path.join(actual_root, d) for d in zstd_includes_legacy]
             )
     include_dirs = list(include_dirs)
```

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/tests/common.py` & `mercurial-6.5rc0/contrib/python-zstandard/tests/common.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/tests/test_buffer_util.py` & `mercurial-6.5rc0/contrib/python-zstandard/tests/test_buffer_util.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/tests/test_compressor.py` & `mercurial-6.5rc0/contrib/python-zstandard/tests/test_compressor.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/tests/test_compressor_fuzzing.py` & `mercurial-6.5rc0/contrib/python-zstandard/tests/test_compressor_fuzzing.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/tests/test_data_structures.py` & `mercurial-6.5rc0/contrib/python-zstandard/tests/test_data_structures.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/tests/test_data_structures_fuzzing.py` & `mercurial-6.5rc0/contrib/python-zstandard/tests/test_data_structures_fuzzing.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/tests/test_decompressor.py` & `mercurial-6.5rc0/contrib/python-zstandard/tests/test_decompressor.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/tests/test_decompressor_fuzzing.py` & `mercurial-6.5rc0/contrib/python-zstandard/tests/test_decompressor_fuzzing.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/tests/test_module_attributes.py` & `mercurial-6.5rc0/contrib/python-zstandard/tests/test_module_attributes.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/tests/test_train_dictionary.py` & `mercurial-6.5rc0/contrib/python-zstandard/tests/test_train_dictionary.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstandard/__init__.py` & `mercurial-6.5rc0/contrib/python-zstandard/zstandard/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstandard/cffi.py` & `mercurial-6.5rc0/contrib/python-zstandard/zstandard/cffi.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/COPYING` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/COPYING`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/LICENSE` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/LICENSE`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/bitstream.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/bitstream.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/compiler.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/compiler.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/cpu.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/cpu.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/debug.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/debug.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/debug.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/debug.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/entropy_common.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/entropy_common.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/error_private.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/error_private.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/error_private.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/error_private.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/fse.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/fse.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/fse_decompress.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/fse_decompress.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/huf.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/huf.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/mem.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/mem.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/pool.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/pool.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/pool.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/pool.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/pythoncapi_compat.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/pythoncapi_compat.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/threading.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/threading.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/threading.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/threading.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/xxhash.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/xxhash.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/xxhash.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/xxhash.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/zstd_common.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/zstd_common.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/zstd_errors.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/zstd_errors.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/common/zstd_internal.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/common/zstd_internal.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/fse_compress.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/fse_compress.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/hist.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/hist.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/hist.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/hist.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/huf_compress.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/huf_compress.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_compress.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_compress.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_compress_internal.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_compress_internal.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_compress_literals.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_compress_literals.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_compress_literals.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_compress_literals.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_compress_sequences.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_compress_sequences.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_compress_sequences.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_compress_sequences.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_cwksp.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_cwksp.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_double_fast.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_double_fast.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_double_fast.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_double_fast.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_fast.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_fast.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_fast.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_fast.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_lazy.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_lazy.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_lazy.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_lazy.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_ldm.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_ldm.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_ldm.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_ldm.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_opt.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_opt.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstd_opt.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstd_opt.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstdmt_compress.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstdmt_compress.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/compress/zstdmt_compress.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/compress/zstdmt_compress.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/huf_decompress.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/huf_decompress.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/zstd_ddict.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/zstd_ddict.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/zstd_ddict.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/zstd_ddict.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress_block.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress_block.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress_block.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress_block.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress_internal.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/decompress/zstd_decompress_internal.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/deprecated/zbuff.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/deprecated/zbuff.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/deprecated/zbuff_common.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/deprecated/zbuff_common.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/deprecated/zbuff_compress.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/deprecated/zbuff_compress.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/deprecated/zbuff_decompress.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/deprecated/zbuff_decompress.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/cover.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/cover.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/cover.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/cover.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/divsufsort.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/divsufsort.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/divsufsort.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/divsufsort.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/fastcover.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/fastcover.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/zdict.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/zdict.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/dictBuilder/zdict.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/dictBuilder/zdict.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd/zstd.h` & `mercurial-6.5rc0/contrib/python-zstandard/zstd/zstd.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python-zstandard/zstd.c` & `mercurial-6.5rc0/contrib/python-zstandard/zstd.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python3-ratchet.py` & `mercurial-6.5rc0/contrib/python3-ratchet.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/python3-whitelist` & `mercurial-6.5rc0/contrib/python3-whitelist`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/relnotes` & `mercurial-6.5rc0/contrib/relnotes`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/revsetbenchmarks.py` & `mercurial-6.5rc0/contrib/revsetbenchmarks.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/setup-pytype.sh` & `mercurial-6.5rc0/contrib/setup-pytype.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/showstack.py` & `mercurial-6.5rc0/contrib/showstack.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/simplemerge` & `mercurial-6.5rc0/contrib/simplemerge`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/synthrepo.py` & `mercurial-6.5rc0/contrib/synthrepo.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/tcsh_completion` & `mercurial-6.5rc0/contrib/tcsh_completion`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/tcsh_completion_build.sh` & `mercurial-6.5rc0/contrib/tcsh_completion_build.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/testparseutil.py` & `mercurial-6.5rc0/contrib/testparseutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/undumprevlog` & `mercurial-6.5rc0/contrib/undumprevlog`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/vim/HGAnnotate.vim` & `mercurial-6.5rc0/contrib/vim/HGAnnotate.vim`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/vim/hg-menu.vim` & `mercurial-6.5rc0/contrib/vim/hg-menu.vim`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/vim/hgcommand.vim` & `mercurial-6.5rc0/contrib/vim/hgcommand.vim`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/vim/hgtest.vim` & `mercurial-6.5rc0/contrib/vim/hgtest.vim`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/vim/patchreview.txt` & `mercurial-6.5rc0/contrib/vim/patchreview.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/vim/patchreview.vim` & `mercurial-6.5rc0/contrib/vim/patchreview.vim`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/win32/ReadMe.html` & `mercurial-6.5rc0/contrib/win32/ReadMe.html`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/win32/hgwebdir_wsgi.py` & `mercurial-6.5rc0/contrib/win32/hgwebdir_wsgi.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/win32/mercurial.ico` & `mercurial-6.5rc0/contrib/win32/mercurial.ico`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/win32/mercurial.ini` & `mercurial-6.5rc0/contrib/win32/mercurial.ini`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/xml.rnc` & `mercurial-6.5rc0/contrib/xml.rnc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/contrib/zsh_completion` & `mercurial-6.5rc0/contrib/zsh_completion`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/doc/Makefile` & `mercurial-6.5rc0/doc/Makefile`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/doc/check-seclevel.py` & `mercurial-6.5rc0/doc/check-seclevel.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/doc/docchecker` & `mercurial-6.5rc0/doc/docchecker`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/doc/gendoc.py` & `mercurial-6.5rc0/doc/gendoc.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/doc/hg-ssh.8` & `mercurial-6.5rc0/doc/hg-ssh.8`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/doc/hg-ssh.8.html` & `mercurial-6.5rc0/doc/hg-ssh.8.html`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/doc/hg.1` & `mercurial-6.5rc0/doc/hg.1`

 * *Files 0% similar despite different names*

```diff
@@ -799,14 +799,20 @@
 If multiple sources are specified, they will be pulled sequentially as if
 the command was run multiple time. If \-\-update is specify and the command
 will stop at the first failed \-\-update.
 .sp
 Specifying bookmark as \fB.\fP is equivalent to specifying the active
 bookmark\(aqs name.
 .sp
+One can use the \fI\-\-remote\-hidden\fP flag to pull changesets
+hidden on the remote. This flag is "best effort", and will only
+work if the server supports the feature and is configured to
+allow the user to access hidden changesets. This option is
+experimental and backwards compatibility is not garanteed.
+.sp
 Returns 0 on success, 1 if an update had unresolved files.
 .sp
 Options:
 .INDENT 0.0
 .TP
 .B \-u,  \-\-update
 .
@@ -828,14 +834,18 @@
 .
 bookmark to pull
 .TP
 .BI \-b,  \-\-branch \ <BRANCH[+]>
 .
 a specific branch you would like to pull
 .TP
+.B \-\-remote\-hidden
+.
+include changesets hidden on the remote (EXPERIMENTAL)
+.TP
 .BI \-e,  \-\-ssh \ <CMD>
 .
 specify ssh command to use
 .TP
 .BI \-\-remotecmd \ <CMD>
 .
 specify hg command to run on the remote side
@@ -1056,15 +1066,15 @@
 .TP
 .BI \-\-style \ <STYLE>
 .
 template style to use
 .TP
 .B \-6,  \-\-ipv6
 .
-use IPv6 in addition to IPv4
+use IPv6 instead of IPv4
 .TP
 .BI \-\-certificate \ <FILE>
 .
 SSL certificate file
 .TP
 .B \-\-print\-url
 .
@@ -6055,14 +6065,18 @@
 .TP
 .B \fBnone\fP
 .sp
 No compression is performed.
 .sp
 Use this compression engine to explicitly disable compression.
 .UNINDENT
+.sp
+The compression engines can be prepended with \fBstream\fP to create a streaming bundle.
+These are bundles that are extremely efficient to produce and consume,
+but do not have guaranteed compatibility with older clients.
 .SS Available Options
 .sp
 The following options exist:
 .INDENT 0.0
 .TP
 .B changegroup
 .
@@ -6105,14 +6119,23 @@
 .sp
 Produce a \fBv2\fP bundle with zstandard compression using default
 settings.
 .TP
 .B \fBzstd\-v1\fP
 .sp
 This errors because \fBzstd\fP is not supported for \fBv1\fP types.
+.TP
+.B \fBnone\-streamv2\fP
+.sp
+Produce a \fBv2\fP streaming bundle with no compression.
+.TP
+.B \fBzstd\-v2;obsolescence=true;phases=true\fP
+.sp
+Produce a \fBv2\fP bundle with zstandard compression which includes
+obsolescence markers and phases.
 .UNINDENT
 .SH COLORIZING OUTPUTS
 .sp
 Mercurial colorizes output from several commands.
 .sp
 For example, the diff command shows additions in green and deletions
 in red, while the status command shows modified files in magenta. Many
@@ -8559,15 +8582,16 @@
 .RE
 .sp
 To use a plain path name without any pattern matching, start it with
 \fBpath:\fP. These path names must completely match starting at the
 current repository root, and when the path points to a directory, it is matched
 recursively. To match all files in a directory non\-recursively (not including
 any files in subdirectories), \fBrootfilesin:\fP can be used, specifying an
-absolute path (relative to the repository root).
+absolute path (relative to the repository root). To match a single file exactly,
+relative to the repository root, you can use \fBfilepath:\fP.
 .sp
 To use an extended glob, start a name with \fBglob:\fP. Globs are rooted
 at the current directory; a glob such as \fB*.c\fP will only match files
 in the current directory ending with \fB.c\fP. \fBrootglob:\fP can be used
 instead of \fBglob:\fP for a glob that is rooted at the root of the
 repository.
 .sp
@@ -8593,19 +8617,23 @@
 under matched directories are treated as matched.
 For \fB\-I\fP and \fB\-X\fP options, \fBglob:\fP will match directories recursively.
 .sp
 Plain examples:
 .sp
 .nf
 .ft C
-path:foo/bar        a name bar in a directory named foo in the root
-                    of the repository
-path:path:name      a file or directory named "path:name"
-rootfilesin:foo/bar the files in a directory called foo/bar, but not any files
-                    in its subdirectories and not a file bar in directory foo
+path:foo/bar                  a name bar in a directory named foo in the root
+                              of the repository
+path:some/path                a file or directory named "some/path"
+filepath:some/path/to/a/file  exactly a single file named
+                              "some/path/to/a/file", relative to the root
+                              of the repository
+rootfilesin:foo/bar           the files in a directory called foo/bar, but
+                              not any files in its subdirectories and not
+                              a file bar in directory foo
 .ft P
 .fi
 .sp
 Glob examples:
 .sp
 .nf
 .ft C
@@ -9629,16 +9657,17 @@
 that, or ask their team to add support for hg+Rust!
 .SS From source
 .sp
 Please refer to the \fIrust/README.rst\fP file in the Mercurial repository for
 instructions on how to install from source.
 .SS MSRV
 .sp
-The minimum supported Rust version is currently 1.61.0. The project\(aqs policy is
-to follow the version from Debian testing, to make the distributions\(aq job easier.
+The minimum supported Rust version is defined in \fIrust/clippy.toml\fP.
+The project\(aqs policy is to keep it at or below the version from Debian testing,
+to make the distributions\(aq job easier.
 .SS rhg
 .sp
 There exists an experimental pure\-Rust version of Mercurial called \fIrhg\fP with a
 fallback mechanism for unsupported invocations. It allows for much faster
 execution of certain commands while adding no discernable overhead for the rest.
 .sp
 The only way of trying it out is by building it from source. Please refer to
@@ -10526,16 +10555,16 @@
 .TP
 .B configint(section, name[, default])
 .
 Returns the requested hgrc config option as an integer.
 .TP
 .B date(date[, fmt])
 .
-Format a date. See \%\fBhg help dates\fP\: for formatting
-strings. The default is a Unix date format, including the timezone:
+Format a date. The format string uses the Python strftime format.
+The default is a Unix date format, including the timezone:
 "Mon Sep 04 15:13:13 2006 0700".
 .TP
 .B dict([[key=]value...])
 .
 Construct a dict from key\-value pairs. A key may be omitted if
 a value expression can provide an unambiguous name.
 .TP
@@ -12319,16 +12348,18 @@
 operator could use a dynamic service for retrieving bundle data. However,
 static file hosting services are simple and scalable and should be sufficient
 for most needs.
 .sp
 Bundle files can be generated with the \%\fBhg bundle\fP\: command. Typically
 \%\fBhg bundle \-\-all\fP\: is used to produce a bundle of the entire repository.
 .sp
-\%\fBhg debugcreatestreamclonebundle\fP\: can be used to produce a special
-\fIstreaming clonebundle\fP. These are bundle files that are extremely efficient
+The bundlespec option \fIstream\fP (see \%\fBhg help bundlespec\fP\:)
+can be used to produce a special \fIstreaming clonebundle\fP, typically using
+\%\fBhg bundle \-\-all \-\-type="none\-streamv2"\fP\:.
+These are bundle files that are extremely efficient
 to produce and consume (read: fast). However, they are larger than
 traditional bundle formats and require that clients support the exact set
 of repository data store formats in use by the repository that created them.
 Typically, a newer server can serve data that is compatible with older clients.
 However, \fIstreaming clone bundles\fP don\(aqt have this guarantee. \fBServer
 operators need to be aware that newer versions of Mercurial may produce
 streaming clone bundles incompatible with older Mercurial versions.\fP
@@ -12451,14 +12482,169 @@
 hosting service as an extension of the Mercurial server in terms of
 availability and service level agreements: if the bundle hosting service goes
 down, so does the ability for clients to clone. Note: clients will see a
 message informing them how to bypass the clone bundles facility when a failure
 occurs. So server operators should prepare for some people to follow these
 instructions when a failure occurs, thus driving more load to the original
 Mercurial server when the bundle hosting service fails.
+.SS inline clonebundles
+.sp
+It is possible to transmit clonebundles inline in case repositories are
+accessed over SSH. This avoids having to setup an external HTTPS server
+and results in the same access control as already present for the SSH setup.
+.sp
+Inline clonebundles should be placed into the \fI.hg/bundle\-cache\fP directory.
+A clonebundle at \fI.hg/bundle\-cache/mybundle.bundle\fP is referred to
+in the \fIclonebundles.manifest\fP file as \fIpeer\-bundle\-cache://mybundle.bundle\fP.
+.SS auto\-generation of clone bundles
+.sp
+It is possible to set Mercurial to automatically re\-generate clone bundles when
+enough new content is available.
+.sp
+Mercurial will take care of the process asynchronously. The defined list of
+bundle\-type will be generated, uploaded, and advertised. Older bundles will get
+decommissioned as newer ones replace them.
+.SS Bundles Generation:
+.sp
+The extension can generate multiple variants of the clone bundle. Each
+different variant will be defined by the "bundle\-spec" they use:
+.sp
+.nf
+.ft C
+[clone\-bundles]
+auto\-generate.formats= zstd\-v2, gzip\-v2
+.ft P
+.fi
+.sp
+See \fIhg help bundlespec\fP for details about available options.
+.sp
+By default, new bundles are generated when 5% of the repository contents or at
+least 1000 revisions are not contained in the cached bundles. This option can
+be controlled by the \fIclone\-bundles.trigger.below\-bundled\-ratio\fP option
+(default 0.95) and the \fIclone\-bundles.trigger.revs\fP option (default 1000):
+.sp
+.nf
+.ft C
+[clone\-bundles]
+trigger.below\-bundled\-ratio=0.95
+trigger.revs=1000
+.ft P
+.fi
+.sp
+This logic can be manually triggered using the \fIadmin::clone\-bundles\-refresh\fP
+command, or automatically on each repository change if
+\fIclone\-bundles.auto\-generate.on\-change\fP is set to \fIyes\fP.
+.INDENT 0.0
+.INDENT 3.5
+.sp
+[clone\-bundles]
+auto\-generate.on\-change=yes
+auto\-generate.formats= zstd\-v2, gzip\-v2
+.UNINDENT
+.UNINDENT
+.SS Automatic Inline serving
+.sp
+The simplest way to serve the generated bundle is through the Mercurial
+protocol. However it is not the most efficient as request will still be served
+by that main server. It is useful in case where authentication is complexe or
+when an efficient mirror system is already in use anyway. See the \fIinline
+clonebundles\fP section above for details about inline clonebundles
+.sp
+To automatically serve generated bundle through inline clonebundle, simply set
+the following option:
+.sp
+.nf
+.ft C
+auto\-generate.serve\-inline=yes
+.ft P
+.fi
+.sp
+Enabling this option disable the managed upload and serving explained below.
+.SS Bundles Upload and Serving:
+.sp
+This is the most efficient way to serve automatically generated clone bundles,
+but requires some setup.
+.sp
+The generated bundles need to be made available to users through a "public" URL.
+This should be donne through \fIclone\-bundles.upload\-command\fP configuration. The
+value of this command should be a shell command. It will have access to the
+bundle file path through the \fI$HGCB_BUNDLE_PATH\fP variable. And the expected
+basename in the "public" URL is accessible at:
+.sp
+.nf
+.ft C
+[clone\-bundles]
+upload\-command=sftp put $HGCB_BUNDLE_PATH       sftp://bundles.host/clone\-bundles/$HGCB_BUNDLE_BASENAME
+.ft P
+.fi
+.sp
+If the file was already uploaded, the command must still succeed.
+.sp
+After upload, the file should be available at an url defined by
+\fIclone\-bundles.url\-template\fP.
+.INDENT 0.0
+.INDENT 3.5
+.sp
+[clone\-bundles]
+url\-template=https://bundles.host/cache/clone\-bundles/{basename}
+.UNINDENT
+.UNINDENT
+.SS Old bundles cleanup:
+.sp
+When new bundles are generated, the older ones are no longer necessary and can
+be removed from storage. This is done through the \fIclone\-bundles.delete\-command\fP
+configuration. The command is given the url of the artifact to delete through
+the \fI$HGCB_BUNDLE_URL\fP environment variable.
+.INDENT 0.0
+.INDENT 3.5
+.sp
+[clone\-bundles]
+delete\-command=sftp rm sftp://bundles.host/clone\-bundles/$HGCB_BUNDLE_BASENAME
+.UNINDENT
+.UNINDENT
+.sp
+If the file was already deleted, the command must still succeed.
+.SS Commands
+.SS Uncategorized commands
+.SS admin::clone\-bundles\-clear
+.sp
+remove existing clone bundle caches:
+.sp
+.nf
+.ft C
+hg admin::clone\-bundles\-clear
+.ft P
+.fi
+.sp
+See \fIhg help admin::clone\-bundles\-refresh\fP for details on how to regenerate
+them.
+.sp
+This command will only affect bundles currently available, it will not
+affect bundles being asynchronously generated.
+.SS admin::clone\-bundles\-refresh
+.sp
+generate clone bundles according to the configuration:
+.sp
+.nf
+.ft C
+hg admin::clone\-bundles\-refresh
+.ft P
+.fi
+.sp
+This runs the logic for automatic generation, removing outdated bundles and
+generating new ones if necessary. See \%\fBhg help \-e clone\-bundles\fP\: for
+details about how to configure this feature.
+.sp
+Options:
+.INDENT 0.0
+.TP
+.B \-\-background
+.
+start bundle generation in the background
+.UNINDENT
 .SS closehead
 .sp
 close arbitrary heads without checking them out first
 .SS Commands
 .SS Change manipulation
 .SS close\-head
 .sp
@@ -13647,14 +13833,21 @@
 .SS fix
 .sp
 rewrite file content in changesets or working copy (EXPERIMENTAL)
 .sp
 Provides a command that runs configured tools on the contents of modified files,
 writing back any fixes to the working copy or replacing changesets.
 .sp
+Fixer tools are run in the repository\(aqs root directory. This allows them to read
+configuration files from the working copy, or even write to the working copy.
+The working copy is not updated to match the revision being fixed. In fact,
+several revisions may be fixed in parallel. Writes to the working copy are not
+amended into the revision being fixed; fixer tools MUST always read content to
+be fixed from stdin, and write fixed file content back to stdout.
+.sp
 Here is an example configuration that causes \%\fBhg fix\fP\: to apply automatic
 formatting fixes to modified lines in C++ code:
 .sp
 .nf
 .ft C
 [fix]
 clang\-format:command=clang\-format \-\-assume\-filename={rootpath}
@@ -13783,34 +13976,28 @@
   made obsolete. Provides a boolean "$HG_WDIRWRITTEN" to indicate whether any
   files in the working copy were updated. Provides a list "$HG_METADATA"
   mapping fixer tool names to lists of metadata values returned from
   executions that modified a file. This aggregates the same metadata
   previously passed to the "postfixfile" hook.
 .ft P
 .fi
-.sp
-Fixer tools are run in the repository\(aqs root directory. This allows them to read
-configuration files from the working copy, or even write to the working copy.
-The working copy is not updated to match the revision being fixed. In fact,
-several revisions may be fixed in parallel. Writes to the working copy are not
-amended into the revision being fixed; fixer tools should always write fixed
-file content back to stdout as documented above.
 .SS Commands
 .SS File content management
 .SS fix
 .sp
 rewrite file content in changesets or working directory:
 .sp
 .nf
 .ft C
 hg fix [OPTION]... [FILE]...
 .ft P
 .fi
 .sp
-Runs any configured tools to fix the content of files. Only affects files
+Runs any configured tools to fix the content of files. (See
+\%\fBhg help \-e fix\fP\: for details about configuring tools.) Only affects files
 with changes, unless file arguments are provided. Only affects changed lines
 of files, unless the \-\-whole flag is used. Some tools may always affect the
 whole file regardless of \-\-whole.
 .sp
 If \-\-working\-dir is used, files with uncommitted changes in the working copy
 will be fixed. Note that no backup are made.
 .sp
```

### Comparing `mercurial-6.4rc0/doc/hg.1.html` & `mercurial-6.5rc0/doc/hg.1.html`

 * *Files 1% similar despite different names*

#### Comparing `mercurial-6.4rc0/doc/hg.1.html` & `mercurial-6.5rc0/doc/hg.1.html`

```diff
@@ -1567,14 +1567,23 @@
 will stop at the first failed --update.</p>
             <p>
               Specifying bookmark as
               <tt class="docutils literal">.</tt>
               is equivalent to specifying the active
 bookmark's name.
             </p>
+            <div class="verbose docutils container">
+              One can use the
+              <cite>--remote-hidden</cite>
+              flag to pull changesets
+hidden on the remote. This flag is &quot;best effort&quot;, and will only
+work if the server supports the feature and is configured to
+allow the user to access hidden changesets. This option is
+experimental and backwards compatibility is not garanteed.
+            </div>
             <p>Returns 0 on success, 1 if an update had unresolved files.</p>
             <p>Options:</p>
             <table class="docutils option-list" frame="void" rules="none">
               <col class="option"/>
               <col class="description"/>
               <tbody valign="top">
                 <tr>
@@ -1652,14 +1661,25 @@
                 <tr>
                   <td/>
                   <td>a specific branch you would like to pull</td>
                 </tr>
                 <tr>
                   <td class="option-group" colspan="2">
                     <kbd>
+                      <span class="option">--remote-hidden</span>
+                    </kbd>
+                  </td>
+                </tr>
+                <tr>
+                  <td/>
+                  <td>include changesets hidden on the remote (EXPERIMENTAL)</td>
+                </tr>
+                <tr>
+                  <td class="option-group" colspan="2">
+                    <kbd>
                       <span class="option">-e</span>
                       ,
                       <span class="option">
                         --ssh
                         <var>&lt;CMD&gt;</var>
                       </span>
                     </kbd>
@@ -2163,15 +2183,15 @@
                   <td class="option-group">
                     <kbd>
                       <span class="option">-6</span>
                       ,
                       <span class="option">--ipv6</span>
                     </kbd>
                   </td>
-                  <td>use IPv6 in addition to IPv4</td>
+                  <td>use IPv6 instead of IPv4</td>
                 </tr>
                 <tr>
                   <td class="option-group" colspan="2">
                     <kbd>
                       <span class="option">
                         --certificate
                         <var>&lt;FILE&gt;</var>
@@ -10625,14 +10645,21 @@
               <tt class="docutils literal">none</tt>
             </dt>
             <dd>
               <p class="first">No compression is performed.</p>
               <p class="last">Use this compression engine to explicitly disable compression.</p>
             </dd>
           </dl>
+          <p>
+            The compression engines can be prepended with
+            <tt class="docutils literal">stream</tt>
+            to create a streaming bundle.
+These are bundles that are extremely efficient to produce and consume,
+but do not have guaranteed compatibility with older clients.
+          </p>
         </div>
         <div class="section" id="available-options">
           <h2>Available Options</h2>
           <p>The following options exist:</p>
           <dl class="docutils">
             <dt>changegroup</dt>
             <dd>Include the changegroup data in the bundle (default to True).</dd>
@@ -10690,14 +10717,35 @@
             <dd>
               This errors because
               <tt class="docutils literal">zstd</tt>
               is not supported for
               <tt class="docutils literal">v1</tt>
               types.
             </dd>
+            <dt>
+              <tt class="docutils literal">
+                <span class="pre">none-streamv2</span>
+              </tt>
+            </dt>
+            <dd>
+              Produce a
+              <tt class="docutils literal">v2</tt>
+              streaming bundle with no compression.
+            </dd>
+            <dt>
+              <tt class="docutils literal">
+                <span class="pre">zstd-v2;obsolescence=true;phases=true</span>
+              </tt>
+            </dt>
+            <dd>
+              Produce a
+              <tt class="docutils literal">v2</tt>
+              bundle with zstandard compression which includes
+obsolescence markers and phases.
+            </dd>
           </dl>
         </div>
       </div>
       <div class="section" id="colorizing-outputs">
         <span id="color"/>
         <h1>
           <a class="toc-backref" href="#contents">Colorizing Outputs</a>
@@ -13744,15 +13792,18 @@
           <tt class="docutils literal">path:</tt>
           . These path names must completely match starting at the
 current repository root, and when the path points to a directory, it is matched
 recursively. To match all files in a directory non-recursively (not including
 any files in subdirectories),
           <tt class="docutils literal">rootfilesin:</tt>
           can be used, specifying an
-absolute path (relative to the repository root).
+absolute path (relative to the repository root). To match a single file exactly,
+relative to the repository root, you can use
+          <tt class="docutils literal">filepath:</tt>
+          .
         </p>
         <p>
           To use an extended glob, start a name with
           <tt class="docutils literal">glob:</tt>
           . Globs are rooted
 at the current directory; a glob such as
           <tt class="docutils literal">*.c</tt>
@@ -13831,19 +13882,23 @@
             <span class="pre">-X</span>
           </tt>
           options,
           <tt class="docutils literal">glob:</tt>
           will match directories recursively.
         </p>
         <p>Plain examples:</p>
-        <pre class="literal-block">path:foo/bar        a name bar in a directory named foo in the root
-                    of the repository
-path:path:name      a file or directory named &quot;path:name&quot;
-rootfilesin:foo/bar the files in a directory called foo/bar, but not any files
-                    in its subdirectories and not a file bar in directory foo</pre>
+        <pre class="literal-block">path:foo/bar                  a name bar in a directory named foo in the root
+                              of the repository
+path:some/path                a file or directory named &quot;some/path&quot;
+filepath:some/path/to/a/file  exactly a single file named
+                              &quot;some/path/to/a/file&quot;, relative to the root
+                              of the repository
+rootfilesin:foo/bar           the files in a directory called foo/bar, but
+                              not any files in its subdirectories and not
+                              a file bar in directory foo</pre>
         <p>Glob examples:</p>
         <pre class="literal-block">glob:*.c       any name ending in &quot;.c&quot; in the current directory
 *.c            any name ending in &quot;.c&quot; in the current directory
 **.c           any name ending in &quot;.c&quot; in any subdirectory of the
                current directory including itself.
 foo/*          any file in directory foo
 foo/**         any file in directory foo plus all its subdirectories,
@@ -15224,16 +15279,21 @@
               file in the Mercurial repository for
 instructions on how to install from source.
             </p>
           </div>
         </div>
         <div class="section" id="msrv">
           <h2>MSRV</h2>
-          <p>The minimum supported Rust version is currently 1.61.0. The project's policy is
-to follow the version from Debian testing, to make the distributions' job easier.</p>
+          <p>
+            The minimum supported Rust version is defined in
+            <cite>rust/clippy.toml</cite>
+            .
+The project's policy is to keep it at or below the version from Debian testing,
+to make the distributions' job easier.
+          </p>
         </div>
         <div class="section" id="rhg-1">
           <h2>rhg</h2>
           <p>
             There exists an experimental pure-Rust version of Mercurial called
             <cite>rhg</cite>
             with a
@@ -16558,23 +16618,17 @@
                 <td class="field-body">Returns the requested hgrc config option as an integer.</td>
               </tr>
               <tr class="field">
                 <th class="field-name" colspan="2">date(date[, fmt]):</th>
               </tr>
               <tr class="field">
                 <td/>
-                <td class="field-body">
-                  Format a date. See
-                  <a class="reference external" href="hg.1.html#dates">
-                    <tt class="docutils literal">hg help dates</tt>
-                  </a>
-                  for formatting
-strings. The default is a Unix date format, including the timezone:
-&quot;Mon Sep 04 15:13:13 2006 0700&quot;.
-                </td>
+                <td class="field-body">Format a date. The format string uses the Python strftime format.
+The default is a Unix date format, including the timezone:
+&quot;Mon Sep 04 15:13:13 2006 0700&quot;.</td>
               </tr>
               <tr class="field">
                 <th class="field-name" colspan="2">dict([[key=]value...]):</th>
               </tr>
               <tr class="field">
                 <td/>
                 <td class="field-body">Construct a dict from key-value pairs. A key may be omitted if
@@ -19149,20 +19203,33 @@
                 hg bundle
                 <span class="pre">--all</span>
               </tt>
             </a>
             is used to produce a bundle of the entire repository.
           </p>
           <p>
-            <a class="reference external" href="hg.1.html#debugcreatestreamclonebundle">
-              <tt class="docutils literal">hg debugcreatestreamclonebundle</tt>
+            The bundlespec option
+            <cite>stream</cite>
+            (see
+            <a class="reference external" href="hg.1.html#bundlespec">
+              <tt class="docutils literal">hg help bundlespec</tt>
             </a>
-            can be used to produce a special
+            )
+can be used to produce a special
             <em>streaming clonebundle</em>
-            . These are bundle files that are extremely efficient
+            , typically using
+            <a class="reference external" href="hg.1.html#bundle">
+              <tt class="docutils literal">
+                hg bundle
+                <span class="pre">--all</span>
+                <span class="pre">--type=&quot;none-streamv2&quot;</span>
+              </tt>
+            </a>
+            .
+These are bundle files that are extremely efficient
 to produce and consume (read: fast). However, they are larger than
 traditional bundle formats and require that clients support the exact set
 of repository data store formats in use by the repository that created them.
 Typically, a newer server can serve data that is compatible with older clients.
 However,
             <em>streaming clone bundles</em>
             don't have this guarantee.
@@ -19310,21 +19377,194 @@
 hosting service as an extension of the Mercurial server in terms of
 availability and service level agreements: if the bundle hosting service goes
 down, so does the ability for clients to clone. Note: clients will see a
 message informing them how to bypass the clone bundles facility when a failure
 occurs. So server operators should prepare for some people to follow these
 instructions when a failure occurs, thus driving more load to the original
 Mercurial server when the bundle hosting service fails.</p>
+          <div class="section" id="inline-clonebundles">
+            <h3>inline clonebundles</h3>
+            <p>It is possible to transmit clonebundles inline in case repositories are
+accessed over SSH. This avoids having to setup an external HTTPS server
+and results in the same access control as already present for the SSH setup.</p>
+            <p>
+              Inline clonebundles should be placed into the
+              <cite>.hg/bundle-cache</cite>
+              directory.
+A clonebundle at
+              <cite>.hg/bundle-cache/mybundle.bundle</cite>
+              is referred to
+in the
+              <cite>clonebundles.manifest</cite>
+              file as
+              <cite>peer-bundle-cache://mybundle.bundle</cite>
+              .
+            </p>
+          </div>
+          <div class="section" id="auto-generation-of-clone-bundles">
+            <h3>auto-generation of clone bundles</h3>
+            <p>It is possible to set Mercurial to automatically re-generate clone bundles when
+enough new content is available.</p>
+            <p>Mercurial will take care of the process asynchronously. The defined list of
+bundle-type will be generated, uploaded, and advertised. Older bundles will get
+decommissioned as newer ones replace them.</p>
+            <div class="section" id="bundles-generation">
+              <h4>Bundles Generation:</h4>
+              <p>The extension can generate multiple variants of the clone bundle. Each
+different variant will be defined by the &quot;bundle-spec&quot; they use:</p>
+              <pre class="literal-block">[clone-bundles]
+auto-generate.formats= zstd-v2, gzip-v2</pre>
+              <p>
+                See
+                <cite>hg help bundlespec</cite>
+                for details about available options.
+              </p>
+              <p>
+                By default, new bundles are generated when 5% of the repository contents or at
+least 1000 revisions are not contained in the cached bundles. This option can
+be controlled by the
+                <cite>clone-bundles.trigger.below-bundled-ratio</cite>
+                option
+(default 0.95) and the
+                <cite>clone-bundles.trigger.revs</cite>
+                option (default 1000):
+              </p>
+              <pre class="literal-block">[clone-bundles]
+trigger.below-bundled-ratio=0.95
+trigger.revs=1000</pre>
+              <p>
+                This logic can be manually triggered using the
+                <cite>admin::clone-bundles-refresh</cite>
+                command, or automatically on each repository change if
+                <cite>clone-bundles.auto-generate.on-change</cite>
+                is set to
+                <cite>yes</cite>
+                .
+              </p>
+              <blockquote>[clone-bundles]
+auto-generate.on-change=yes
+auto-generate.formats= zstd-v2, gzip-v2</blockquote>
+            </div>
+            <div class="section" id="automatic-inline-serving">
+              <h4>Automatic Inline serving</h4>
+              <p>
+                The simplest way to serve the generated bundle is through the Mercurial
+protocol. However it is not the most efficient as request will still be served
+by that main server. It is useful in case where authentication is complexe or
+when an efficient mirror system is already in use anyway. See the
+                <cite>inline
+clonebundles</cite>
+                section above for details about inline clonebundles
+              </p>
+              <p>To automatically serve generated bundle through inline clonebundle, simply set
+the following option:</p>
+              <pre class="literal-block">auto-generate.serve-inline=yes</pre>
+              <p>Enabling this option disable the managed upload and serving explained below.</p>
+            </div>
+            <div class="section" id="bundles-upload-and-serving">
+              <h4>Bundles Upload and Serving:</h4>
+              <p>This is the most efficient way to serve automatically generated clone bundles,
+but requires some setup.</p>
+              <p>
+                The generated bundles need to be made available to users through a &quot;public&quot; URL.
+This should be donne through
+                <cite>clone-bundles.upload-command</cite>
+                configuration. The
+value of this command should be a shell command. It will have access to the
+bundle file path through the
+                <cite>$HGCB_BUNDLE_PATH</cite>
+                variable. And the expected
+basename in the &quot;public&quot; URL is accessible at:
+              </p>
+              <pre class="literal-block">[clone-bundles]
+upload-command=sftp put $HGCB_BUNDLE_PATH       sftp://bundles.host/clone-bundles/$HGCB_BUNDLE_BASENAME</pre>
+              <p>If the file was already uploaded, the command must still succeed.</p>
+              <p>
+                After upload, the file should be available at an url defined by
+                <cite>clone-bundles.url-template</cite>
+                .
+              </p>
+              <blockquote>[clone-bundles]
+url-template=https://bundles.host/cache/clone-bundles/{basename}</blockquote>
+            </div>
+            <div class="section" id="old-bundles-cleanup">
+              <h4>Old bundles cleanup:</h4>
+              <p>
+                When new bundles are generated, the older ones are no longer necessary and can
+be removed from storage. This is done through the
+                <cite>clone-bundles.delete-command</cite>
+                configuration. The command is given the url of the artifact to delete through
+the
+                <cite>$HGCB_BUNDLE_URL</cite>
+                environment variable.
+              </p>
+              <blockquote>[clone-bundles]
+delete-command=sftp rm sftp://bundles.host/clone-bundles/$HGCB_BUNDLE_BASENAME</blockquote>
+              <p>If the file was already deleted, the command must still succeed.</p>
+            </div>
+          </div>
+          <div class="section" id="commands-8">
+            <h3>Commands</h3>
+            <div class="section" id="uncategorized-commands-1">
+              <h4>Uncategorized commands</h4>
+              <div class="section" id="admin-clone-bundles-clear">
+                <h5>admin::clone-bundles-clear</h5>
+                <p>remove existing clone bundle caches:</p>
+                <pre class="literal-block">hg admin::clone-bundles-clear</pre>
+                <p>
+                  See
+                  <cite>hg help admin::clone-bundles-refresh</cite>
+                  for details on how to regenerate
+them.
+                </p>
+                <p>This command will only affect bundles currently available, it will not
+affect bundles being asynchronously generated.</p>
+              </div>
+              <div class="section" id="admin-clone-bundles-refresh">
+                <h5>admin::clone-bundles-refresh</h5>
+                <p>generate clone bundles according to the configuration:</p>
+                <pre class="literal-block">hg admin::clone-bundles-refresh</pre>
+                <p>
+                  This runs the logic for automatic generation, removing outdated bundles and
+generating new ones if necessary. See
+                  <a class="reference external" href="hg.1.html#-e">
+                    <tt class="docutils literal">
+                      hg help
+                      <span class="pre">-e</span>
+                      <span class="pre">clone-bundles</span>
+                    </tt>
+                  </a>
+                  for
+details about how to configure this feature.
+                </p>
+                <p>Options:</p>
+                <table class="docutils option-list" frame="void" rules="none">
+                  <col class="option"/>
+                  <col class="description"/>
+                  <tbody valign="top">
+                    <tr>
+                      <td class="option-group">
+                        <kbd>
+                          <span class="option">--background</span>
+                        </kbd>
+                      </td>
+                      <td>start bundle generation in the background</td>
+                    </tr>
+                  </tbody>
+                </table>
+              </div>
+            </div>
+          </div>
         </div>
         <div class="section" id="closehead">
           <h2>
             <a class="toc-backref" href="#toc-entry-49">closehead</a>
           </h2>
           <p>close arbitrary heads without checking them out first</p>
-          <div class="section" id="commands-8">
+          <div class="section" id="commands-9">
             <h3>Commands</h3>
             <div class="section" id="change-manipulation-1">
               <h4>Change manipulation</h4>
               <div class="section" id="close-head">
                 <h5>close-head</h5>
                 <p>close the given head revisions:</p>
                 <pre class="literal-block">hg close-head [OPTION]... [REV]...</pre>
@@ -19439,17 +19679,17 @@
           <p>adds a new flag extras to commit (ADVANCED)</p>
         </div>
         <div class="section" id="convert">
           <h2>
             <a class="toc-backref" href="#toc-entry-51">convert</a>
           </h2>
           <p>import revisions from foreign VCS repositories into Mercurial</p>
-          <div class="section" id="commands-9">
+          <div class="section" id="commands-10">
             <h3>Commands</h3>
-            <div class="section" id="uncategorized-commands-1">
+            <div class="section" id="uncategorized-commands-2">
               <h4>Uncategorized commands</h4>
               <div class="section" id="convert-1">
                 <h5>convert</h5>
                 <p>convert a foreign SCM repository to a Mercurial one.:</p>
                 <pre class="literal-block">hg convert [OPTION]... SOURCE [DEST [REVMAP]]</pre>
                 <p>Accepted source formats [identifiers]:</p>
                 <ul class="simple">
@@ -20789,15 +21029,15 @@
             <a class="reference external" href="hg.1.html#diff">
               <tt class="docutils literal">hg diff</tt>
             </a>
             command. The extdiff extension makes snapshots of only
 needed files, so running the external diff program will actually be
 pretty fast (at least faster than having to compare the entire tree).
           </p>
-          <div class="section" id="commands-10">
+          <div class="section" id="commands-11">
             <h3>Commands</h3>
             <div class="section" id="file-content-management-1">
               <h4>File content management</h4>
               <div class="section" id="extdiff-1">
                 <h5>extdiff</h5>
                 <p>use external program to diff repository (or selected files):</p>
                 <pre class="literal-block">hg extdiff [OPT]... [FILE]...</pre>
@@ -21095,27 +21335,27 @@
 # use unfiltered repo for better performance.
 unfilteredrepo = True
 
 # sacrifice correctness in some corner cases for performance. it does not
 # affect the correctness of the annotate cache being built. the option
 # is experimental and may disappear in the future (default: False)
 perfhack = True</pre>
-          <div class="section" id="commands-11">
+          <div class="section" id="commands-12">
             <h3>Commands</h3>
-            <div class="section" id="uncategorized-commands-2">
+            <div class="section" id="uncategorized-commands-3">
               <h4>Uncategorized commands</h4>
             </div>
           </div>
         </div>
         <div class="section" id="fastexport">
           <h2>
             <a class="toc-backref" href="#toc-entry-56">fastexport</a>
           </h2>
           <p>export repositories as git fast-import stream</p>
-          <div class="section" id="commands-12">
+          <div class="section" id="commands-13">
             <h3>Commands</h3>
             <div class="section" id="change-import-export-1">
               <h4>Change import/export</h4>
               <div class="section" id="fastexport-1">
                 <h5>fastexport</h5>
                 <p>export repository as git fast-import stream:</p>
                 <pre class="literal-block">hg fastexport [OPTION]... [REV]...</pre>
@@ -21199,15 +21439,15 @@
           </div>
         </div>
         <div class="section" id="fetch">
           <h2>
             <a class="toc-backref" href="#toc-entry-57">fetch</a>
           </h2>
           <p>pull, update and merge in one command (DEPRECATED)</p>
-          <div class="section" id="commands-13">
+          <div class="section" id="commands-14">
             <h3>Commands</h3>
             <div class="section" id="remote-repository-management-1">
               <h4>Remote repository management</h4>
               <div class="section" id="fetch-1">
                 <h5>fetch</h5>
                 <p>pull changes from a remote repository, merge new changes if needed.:</p>
                 <pre class="literal-block">hg fetch [SOURCE]</pre>
@@ -21388,14 +21628,20 @@
         <div class="section" id="fix">
           <h2>
             <a class="toc-backref" href="#toc-entry-58">fix</a>
           </h2>
           <p>rewrite file content in changesets or working copy (EXPERIMENTAL)</p>
           <p>Provides a command that runs configured tools on the contents of modified files,
 writing back any fixes to the working copy or replacing changesets.</p>
+          <p>Fixer tools are run in the repository's root directory. This allows them to read
+configuration files from the working copy, or even write to the working copy.
+The working copy is not updated to match the revision being fixed. In fact,
+several revisions may be fixed in parallel. Writes to the working copy are not
+amended into the revision being fixed; fixer tools MUST always read content to
+be fixed from stdin, and write fixed file content back to stdout.</p>
           <p>
             Here is an example configuration that causes
             <a class="reference external" href="hg.1.html#fix">
               <tt class="docutils literal">hg fix</tt>
             </a>
             to apply automatic
 formatting fixes to modified lines in C++ code:
@@ -21501,32 +21747,36 @@
   Run once after all files and revisions have been handled. Provides
   &quot;$HG_REPLACEMENTS&quot; with information about what revisions were created and
   made obsolete. Provides a boolean &quot;$HG_WDIRWRITTEN&quot; to indicate whether any
   files in the working copy were updated. Provides a list &quot;$HG_METADATA&quot;
   mapping fixer tool names to lists of metadata values returned from
   executions that modified a file. This aggregates the same metadata
   previously passed to the &quot;postfixfile&quot; hook.</pre>
-          <p>Fixer tools are run in the repository's root directory. This allows them to read
-configuration files from the working copy, or even write to the working copy.
-The working copy is not updated to match the revision being fixed. In fact,
-several revisions may be fixed in parallel. Writes to the working copy are not
-amended into the revision being fixed; fixer tools should always write fixed
-file content back to stdout as documented above.</p>
-          <div class="section" id="commands-14">
+          <div class="section" id="commands-15">
             <h3>Commands</h3>
             <div class="section" id="file-content-management-2">
               <h4>File content management</h4>
               <div class="section" id="fix-1">
                 <h5>fix</h5>
                 <p>rewrite file content in changesets or working directory:</p>
                 <pre class="literal-block">hg fix [OPTION]... [FILE]...</pre>
-                <p>Runs any configured tools to fix the content of files. Only affects files
+                <p>
+                  Runs any configured tools to fix the content of files. (See
+                  <a class="reference external" href="hg.1.html#-e">
+                    <tt class="docutils literal">
+                      hg help
+                      <span class="pre">-e</span>
+                      fix
+                    </tt>
+                  </a>
+                  for details about configuring tools.) Only affects files
 with changes, unless file arguments are provided. Only affects changed lines
 of files, unless the --whole flag is used. Some tools may always affect the
-whole file regardless of --whole.</p>
+whole file regardless of --whole.
+                </p>
                 <p>If --working-dir is used, files with uncommitted changes in the working copy
 will be fixed. Note that no backup are made.</p>
                 <p>If revisions are specified with --source, those revisions and their
 descendants will be checked, and they may be replaced with new revisions
 that have fixed file content. By automatically including the descendants,
 no merging, rebasing, or evolution will be required. If an ancestor of the
 working copy is included, then the working copy itself will also be fixed,
@@ -21709,15 +21959,15 @@
           </h2>
           <p>try mapping git commands to Mercurial commands</p>
           <p>Tries to map a given git command to a Mercurial command:</p>
           <blockquote>$ hg githelp -- git checkout master
 hg update master</blockquote>
           <p>If an unknown command or parameter combination is detected, an error is
 produced.</p>
-          <div class="section" id="commands-15">
+          <div class="section" id="commands-16">
             <h3>Commands</h3>
             <div class="section" id="help-2">
               <h4>Help</h4>
               <div class="section" id="githelp-1">
                 <h5>githelp</h5>
                 <p>suggests the Mercurial equivalent of the given git command:</p>
                 <pre class="literal-block">hg githelp</pre>
@@ -21729,15 +21979,15 @@
           </div>
         </div>
         <div class="section" id="gpg">
           <h2>
             <a class="toc-backref" href="#toc-entry-62">gpg</a>
           </h2>
           <p>commands to sign and verify changesets</p>
-          <div class="section" id="commands-16">
+          <div class="section" id="commands-17">
             <h3>Commands</h3>
             <div class="section" id="signing-changes-gpg">
               <h4>Signing changes (GPG)</h4>
               <div class="section" id="sigcheck">
                 <h5>sigcheck</h5>
                 <p>verify all the signatures there may be for a particular revision:</p>
                 <pre class="literal-block">hg sigcheck REV</pre>
@@ -21896,15 +22146,15 @@
               </tt>
             </a>
             instead.
           </p>
           <p>This extension adds a --graph option to the incoming, outgoing and log
 commands. When this options is given, an ASCII representation of the
 revision graph is also shown.</p>
-          <div class="section" id="commands-17">
+          <div class="section" id="commands-18">
             <h3>Commands</h3>
             <div class="section" id="change-navigation-2">
               <h4>Change navigation</h4>
               <div class="section" id="glog">
                 <h5>glog</h5>
                 <p>show revision history alongside an ASCII revision graph:</p>
                 <pre class="literal-block">hg glog [OPTION]... [FILE]</pre>
@@ -22248,15 +22498,15 @@
 path = /location/of/hgk</pre>
           <p>hgk can make use of the extdiff extension to visualize revisions.
 Assuming you had already configured extdiff vdiff command, just add:</p>
           <pre class="literal-block">[hgk]
 vdiff=vdiff</pre>
           <p>Revisions context menu will now display additional entries to fire
 vdiff on hovered and selected revisions.</p>
-          <div class="section" id="commands-18">
+          <div class="section" id="commands-19">
             <h3>Commands</h3>
             <div class="section" id="change-navigation-3">
               <h4>Change navigation</h4>
               <div class="section" id="view">
                 <h5>view</h5>
                 <p>start interactive history viewer:</p>
                 <pre class="literal-block">hg view [-l LIMIT] [REVRANGE]</pre>
@@ -22282,15 +22532,15 @@
                       <td/>
                       <td>limit number of changes displayed</td>
                     </tr>
                   </tbody>
                 </table>
               </div>
             </div>
-            <div class="section" id="uncategorized-commands-3">
+            <div class="section" id="uncategorized-commands-4">
               <h4>Uncategorized commands</h4>
             </div>
           </div>
         </div>
         <div class="section" id="highlight">
           <h2>
             <a class="toc-backref" href="#toc-entry-65">highlight</a>
@@ -22551,15 +22801,15 @@
 performance purposes, you can configure histedit to use a single transaction
 across the entire histedit. WARNING: This setting introduces a significant risk
 of losing the work you've done in a histedit if the histedit aborts
 unexpectedly:</p>
             <pre class="literal-block">[histedit]
 singletransaction = True</pre>
           </div>
-          <div class="section" id="commands-19">
+          <div class="section" id="commands-20">
             <h3>Commands</h3>
             <div class="section" id="change-manipulation-2">
               <h4>Change manipulation</h4>
               <div class="section" id="histedit-1">
                 <h5>histedit</h5>
                 <p>interactively edit changeset history:</p>
                 <pre class="literal-block">hg histedit [OPTIONS] ([ANCESTOR] | --outgoing [URL])</pre>
@@ -22893,15 +23143,15 @@
           <p>track previous positions of bookmarks (EXPERIMENTAL)</p>
           <p>
             This extension adds a new command:
             <cite>hg journal</cite>
             , which shows you where
 bookmarks were previously located.
           </p>
-          <div class="section" id="commands-20">
+          <div class="section" id="commands-21">
             <h3>Commands</h3>
             <div class="section" id="change-organization-1">
               <h4>Change organization</h4>
               <div class="section" id="journal-1">
                 <h5>journal</h5>
                 <p>show the previous position of bookmarks and the working copy:</p>
                 <pre class="literal-block">hg journal [OPTION]... [BOOKMARKNAME]</pre>
@@ -23143,17 +23393,17 @@
               <tt class="docutils literal">hg kwexpand</tt>
             </a>
             .
           </p>
           <p>Expansions spanning more than one line and incremental expansions,
 like CVS' $Log$, are not supported. A keyword template map &quot;Log =
 {desc}&quot; expands to the first line of the changeset description.</p>
-          <div class="section" id="commands-21">
+          <div class="section" id="commands-22">
             <h3>Commands</h3>
-            <div class="section" id="uncategorized-commands-4">
+            <div class="section" id="uncategorized-commands-5">
               <h4>Uncategorized commands</h4>
               <div class="section" id="kwdemo">
                 <h5>kwdemo</h5>
                 <p>print [keywordmaps] configuration and an expansion example:</p>
                 <pre class="literal-block">hg kwdemo [-d] [-f RCFILE] [TEMPLATEMAP]...</pre>
                 <p>Show current, custom, or default keyword template maps and their
 expansions.</p>
@@ -23523,17 +23773,17 @@
 largefile. To add the first largefile to a repository, you must
 explicitly do so with the --large flag passed to the
             <a class="reference external" href="hg.1.html#add">
               <tt class="docutils literal">hg add</tt>
             </a>
             command.
           </p>
-          <div class="section" id="commands-22">
+          <div class="section" id="commands-23">
             <h3>Commands</h3>
-            <div class="section" id="uncategorized-commands-5">
+            <div class="section" id="uncategorized-commands-6">
               <h4>Uncategorized commands</h4>
               <div class="section" id="lfconvert">
                 <h5>lfconvert</h5>
                 <p>convert a normal repository to a largefiles repository:</p>
                 <pre class="literal-block">hg lfconvert SOURCE DEST [FILE ...]</pre>
                 <p>
                   Convert repository SOURCE to a new repository DEST, identical to
@@ -23836,17 +24086,17 @@
 
 # how many times to retry before giving up on transferring an object
 retry = 5
 
 # the local directory to store lfs files for sharing across local clones.
 # If not set, the cache is located in an OS specific cache location.
 usercache = /path/to/global/cache</pre>
-          <div class="section" id="commands-23">
+          <div class="section" id="commands-24">
             <h3>Commands</h3>
-            <div class="section" id="uncategorized-commands-6">
+            <div class="section" id="uncategorized-commands-7">
               <h4>Uncategorized commands</h4>
             </div>
           </div>
         </div>
         <div class="section" id="logtoprocess">
           <h2>
             <a class="toc-backref" href="#toc-entry-73">logtoprocess</a>
@@ -23951,15 +24201,15 @@
           <pre class="literal-block">[mq]
 keepchanges = True</pre>
           <p>make them behave as if --keep-changes were passed, and non-conflicting
 local changes will be tolerated and preserved. If incompatible options
 such as -f/--force or --exact are passed, this setting is ignored.</p>
           <p>This extension used to provide a strip command. This command now lives
 in the strip extension.</p>
-          <div class="section" id="commands-24">
+          <div class="section" id="commands-25">
             <h3>Commands</h3>
             <div class="section" id="repository-creation-1">
               <h4>Repository creation</h4>
               <div class="section" id="qclone">
                 <h5>qclone</h5>
                 <p>clone main and patch repository at same time:</p>
                 <pre class="literal-block">hg qclone [OPTION]... SOURCE [DEST]</pre>
@@ -25948,15 +26198,15 @@
           </div>
         </div>
         <div class="section" id="narrow">
           <h2>
             <a class="toc-backref" href="#toc-entry-75">narrow</a>
           </h2>
           <p>create clones which fetch history data for subset of files (EXPERIMENTAL)</p>
-          <div class="section" id="commands-25">
+          <div class="section" id="commands-26">
             <h3>Commands</h3>
             <div class="section" id="repository-maintenance-4">
               <h4>Repository maintenance</h4>
               <div class="section" id="tracked">
                 <h5>tracked</h5>
                 <p>show or change the current narrowspec:</p>
                 <pre class="literal-block">hg tracked [OPTIONS]... [REMOTE]</pre>
@@ -26528,15 +26778,15 @@
                           ifeq(branch, 'default', '', branch|upper),
                           flags)}&quot;</pre>
           <p>
             You can set patchbomb to always ask for confirmation by setting
             <tt class="docutils literal">patchbomb.confirm</tt>
             to true.
           </p>
-          <div class="section" id="commands-26">
+          <div class="section" id="commands-27">
             <h3>Commands</h3>
             <div class="section" id="change-import-export-3">
               <h4>Change import/export</h4>
               <div class="section" id="email">
                 <h5>email</h5>
                 <p>send changesets by email:</p>
                 <pre class="literal-block">hg email [OPTION]... [DEST]...</pre>
@@ -27089,15 +27339,15 @@
 
 [auth]
 example.schemes = https
 example.prefix = phab.example.com
 
 # API token. Get it from https://$HOST/conduit/login/
 example.phabtoken = cli-xxxxxxxxxxxxxxxxxxxxxxxxxxxx</pre>
-          <div class="section" id="commands-27">
+          <div class="section" id="commands-28">
             <h3>Commands</h3>
             <div class="section" id="change-import-export-4">
               <h4>Change import/export</h4>
               <div class="section" id="phabimport">
                 <h5>phabimport</h5>
                 <p>import patches from Phabricator for the specified Differential Revisions:</p>
                 <pre class="literal-block">hg phabimport DREVSPEC... [OPTIONS]</pre>
@@ -27515,15 +27765,15 @@
                       <td/>
                       <td>Path to a vcr file. If nonexistent, will record a new vcr transcript, otherwise will mock all http requests using the specified vcr file. (ADVANCED)</td>
                     </tr>
                   </tbody>
                 </table>
               </div>
             </div>
-            <div class="section" id="uncategorized-commands-7">
+            <div class="section" id="uncategorized-commands-8">
               <h4>Uncategorized commands</h4>
             </div>
           </div>
         </div>
         <div class="section" id="purge-1">
           <h2>
             <a class="toc-backref" href="#toc-entry-80">purge</a>
@@ -27553,15 +27803,15 @@
           <p>command to move sets of revisions to a different ancestor</p>
           <p>This extension lets you rebase changesets in an existing Mercurial
 repository.</p>
           <p>
             For more information:
             <a class="reference external" href="https://mercurial-scm.org/wiki/RebaseExtension">https://mercurial-scm.org/wiki/RebaseExtension</a>
           </p>
-          <div class="section" id="commands-28">
+          <div class="section" id="commands-29">
             <h3>Commands</h3>
             <div class="section" id="change-manipulation-4">
               <h4>Change manipulation</h4>
               <div class="section" id="rebase-1">
                 <h5>rebase</h5>
                 <p>move changeset (and descendants) to a different branch:</p>
                 <pre class="literal-block">hg rebase [[-s REV]... | [-b REV]... | [-r REV]...] [-d REV] [OPTION]...</pre>
@@ -28038,15 +28288,15 @@
               <tt class="docutils literal">
                 hg commit
                 <span class="pre">--interactive</span>
               </tt>
             </a>
             .
           </p>
-          <div class="section" id="commands-29">
+          <div class="section" id="commands-30">
             <h3>Commands</h3>
             <div class="section" id="change-creation-4">
               <h4>Change creation</h4>
               <div class="section" id="qrecord">
                 <h5>qrecord</h5>
                 <p>interactively record a new patch:</p>
                 <pre class="literal-block">hg qrecord [OPTION]... PATCH [FILE]...</pre>
@@ -28354,15 +28604,15 @@
 The
             <a class="reference external" href="hg.1.html#releasenotes">
               <tt class="docutils literal">hg releasenotes</tt>
             </a>
             command provided by this extension makes the
 process simpler by automating it.
           </p>
-          <div class="section" id="commands-30">
+          <div class="section" id="commands-31">
             <h3>Commands</h3>
             <div class="section" id="change-navigation-4">
               <h4>Change navigation</h4>
               <div class="section" id="releasenotes-1">
                 <h5>releasenotes</h5>
                 <p>parse release notes from commit messages into an output file:</p>
                 <pre class="literal-block">hg releasenotes [-r REV] [-c] FILE</pre>
@@ -28492,25 +28742,25 @@
                       </td>
                       <td>list the available admonitions with their title</td>
                     </tr>
                   </tbody>
                 </table>
               </div>
             </div>
-            <div class="section" id="uncategorized-commands-8">
+            <div class="section" id="uncategorized-commands-9">
               <h4>Uncategorized commands</h4>
             </div>
           </div>
         </div>
         <div class="section" id="relink">
           <h2>
             <a class="toc-backref" href="#toc-entry-84">relink</a>
           </h2>
           <p>recreates hardlinks between repository clones</p>
-          <div class="section" id="commands-31">
+          <div class="section" id="commands-32">
             <h3>Commands</h3>
             <div class="section" id="repository-maintenance-5">
               <h4>Repository maintenance</h4>
               <div class="section" id="relink-1">
                 <h5>relink</h5>
                 <p>recreate hardlinks between two repositories:</p>
                 <pre class="literal-block">hg relink [ORIGIN]</pre>
@@ -28741,15 +28991,15 @@
               <dt>
                 <tt class="docutils literal">remotefilelog.validatecachelog</tt>
                 if set, check cache entries for
               </dt>
               <dd>corruption before returning metadata</dd>
             </dl>
           </blockquote>
-          <div class="section" id="commands-32">
+          <div class="section" id="commands-33">
             <h3>Commands</h3>
             <div class="section" id="repository-maintenance-6">
               <h4>Repository maintenance</h4>
               <div class="section" id="prefetch">
                 <h5>prefetch</h5>
                 <p>prefetch file revisions from the server:</p>
                 <pre class="literal-block">hg prefetch [OPTIONS] [FILE...]</pre>
@@ -28836,15 +29086,15 @@
                       <td>exclude names matching the given patterns</td>
                     </tr>
                   </tbody>
                 </table>
                 <p>[+] marked option can be specified multiple times</p>
               </div>
             </div>
-            <div class="section" id="uncategorized-commands-9">
+            <div class="section" id="uncategorized-commands-10">
               <h4>Uncategorized commands</h4>
               <div class="section" id="gc">
                 <h5>gc</h5>
                 <p>garbage collect the client and server filelog caches:</p>
                 <pre class="literal-block">hg gc [REPO...]</pre>
                 <p>garbage collect the client and server filelog caches</p>
               </div>
@@ -28964,17 +29214,17 @@
 py = http://hg.python.org/
 bb = https://bitbucket.org/
 bb+ssh = ssh://hg@bitbucket.org/
 gcode = https://{1}.googlecode.com/hg/
 kiln = https://{1}.kilnhg.com/Repo/</pre>
           <p>You can override a predefined scheme by defining a new scheme with the
 same name.</p>
-          <div class="section" id="commands-33">
+          <div class="section" id="commands-34">
             <h3>Commands</h3>
-            <div class="section" id="uncategorized-commands-10">
+            <div class="section" id="uncategorized-commands-11">
               <h4>Uncategorized commands</h4>
             </div>
           </div>
         </div>
         <div class="section" id="share">
           <h2>
             <a class="toc-backref" href="#toc-entry-88">share</a>
@@ -29087,15 +29337,15 @@
 the config option.
               </p>
               <p>For enabling this in existing shares, enable the config option and reshare.</p>
               <p>For resharing existing shares, make sure your working directory is clean
 and there are no untracked files, delete that share and create a new share.</p>
             </div>
           </div>
-          <div class="section" id="commands-34">
+          <div class="section" id="commands-35">
             <h3>Commands</h3>
             <div class="section" id="repository-creation-2">
               <h4>Repository creation</h4>
               <div class="section" id="share-1">
                 <h5>share</h5>
                 <p>create a new shared repository:</p>
                 <pre class="literal-block">hg share [-U] [-B] SOURCE [DEST]</pre>
@@ -29174,15 +29424,15 @@
               <tt class="docutils literal">hg show</tt>
             </a>
             command, which provides a central
 command for displaying commonly-accessed repository data and views of that
 data.
           </p>
           <p>The following config options can influence operation.</p>
-          <div class="section" id="commands-35">
+          <div class="section" id="commands-36">
             <h3>
               <tt class="docutils literal">commands</tt>
             </h3>
             <dl class="docutils">
               <dt>
                 <tt class="docutils literal">show.aliasprefix</tt>
               </dt>
@@ -29201,15 +29451,15 @@
                   .
                 </p>
                 <p class="last">Aliases that would conflict with existing registrations will not be
 performed.</p>
               </dd>
             </dl>
           </div>
-          <div class="section" id="commands-36">
+          <div class="section" id="commands-37">
             <h3>Commands</h3>
             <div class="section" id="change-navigation-5">
               <h4>Change navigation</h4>
               <div class="section" id="show-1">
                 <h5>show</h5>
                 <p>show various repository information:</p>
                 <pre class="literal-block">hg show VIEW</pre>
@@ -29358,27 +29608,27 @@
             <pre class="literal-block">[include]
 backend/**
 tools/**
 
 [exclude]
 tools/tests/**</pre>
           </div>
-          <div class="section" id="commands-37">
+          <div class="section" id="commands-38">
             <h3>Commands</h3>
-            <div class="section" id="uncategorized-commands-11">
+            <div class="section" id="uncategorized-commands-12">
               <h4>Uncategorized commands</h4>
             </div>
           </div>
         </div>
         <div class="section" id="split">
           <h2>
             <a class="toc-backref" href="#toc-entry-91">split</a>
           </h2>
           <p>command to split a changeset into smaller ones (EXPERIMENTAL)</p>
-          <div class="section" id="commands-38">
+          <div class="section" id="commands-39">
             <h3>Commands</h3>
             <div class="section" id="change-manipulation-5">
               <h4>Change manipulation</h4>
               <div class="section" id="split-1">
                 <h5>split</h5>
                 <p>split a changeset into smaller ones:</p>
                 <pre class="literal-block">hg split [--no-rebase] [[-r] REV]</pre>
@@ -29516,15 +29766,15 @@
             <a class="toc-backref" href="#toc-entry-94">transplant</a>
           </h2>
           <p>command to transplant changesets from another branch</p>
           <p>This extension allows you to transplant changes to another parent revision,
 possibly in another repository. The transplant is done using 'diff' patches.</p>
           <p>Transplanted patches are recorded in .hg/transplant/transplants, as a
 map from a changeset hash to its hash in the source repository.</p>
-          <div class="section" id="commands-39">
+          <div class="section" id="commands-40">
             <h3>Commands</h3>
             <div class="section" id="change-manipulation-6">
               <h4>Change manipulation</h4>
               <div class="section" id="transplant-1">
                 <h5>transplant</h5>
                 <p>transplant changesets from another branch:</p>
                 <pre class="literal-block">hg transplant [-s REPO] [-b BRANCH [-a]] [-p REV] [-m REV] [REV]...</pre>
@@ -29739,15 +29989,15 @@
             <a class="toc-backref" href="#toc-entry-95">uncommit</a>
           </h2>
           <p>uncommit part or all of a local changeset (EXPERIMENTAL)</p>
           <p>This command undoes the effect of a local commit, returning the affected
 files to their uncommitted state. This means that files modified, added or
 removed in the changeset will be left unchanged, and so will remain modified,
 added and removed in the working directory.</p>
-          <div class="section" id="commands-40">
+          <div class="section" id="commands-41">
             <h3>Commands</h3>
             <div class="section" id="change-manipulation-7">
               <h4>Change manipulation</h4>
               <div class="section" id="unamend">
                 <h5>unamend</h5>
                 <p>undo the most recent amend operation on a current changeset:</p>
                 <pre class="literal-block">hg unamend</pre>
```

### Comparing `mercurial-6.4rc0/doc/hgignore.5` & `mercurial-6.5rc0/doc/hgignore.5`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/doc/hgignore.5.html` & `mercurial-6.5rc0/doc/hgignore.5.html`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/doc/hgmanpage.py` & `mercurial-6.5rc0/doc/hgmanpage.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/doc/hgrc.5` & `mercurial-6.5rc0/doc/hgrc.5`

 * *Files 1% similar despite different names*

```diff
@@ -1670,14 +1670,21 @@
 .B \fBpretag\fP
 .sp
 Run before creating a tag. Exit status 0 allows the tag to be
 created. A non\-zero status will cause the tag to fail. The ID of the
 changeset to tag is in \fB$HG_NODE\fP. The name of tag is in \fB$HG_TAG\fP. The
 tag is local if \fB$HG_LOCAL=1\fP, or in the repository if \fB$HG_LOCAL=0\fP.
 .TP
+.B \fBpretransmit\-inline\-clone\-bundle\fP
+.sp
+Run before transferring an inline clonebundle to the peer.
+If the exit status is 0, the inline clonebundle will be allowed to be
+transferred. A non\-zero status will cause the transfer to fail.
+The path of the inline clonebundle is in \fB$HG_CLONEBUNDLEPATH\fP.
+.TP
 .B \fBpretxnopen\fP
 .sp
 Run before any new repository transaction is open. The reason for the
 transaction will be in \fB$HG_TXNNAME\fP, and a unique identifier for the
 transaction will be in \fB$HG_TXNID\fP. A non\-zero status will prevent the
 transaction from being opened.
 .TP
```

### Comparing `mercurial-6.4rc0/doc/hgrc.5.html` & `mercurial-6.5rc0/doc/hgrc.5.html`

 * *Files 1% similar despite different names*

#### Comparing `mercurial-6.4rc0/doc/hgrc.5.html` & `mercurial-6.5rc0/doc/hgrc.5.html`

```diff
@@ -2966,14 +2966,27 @@
 tag is local if
               <tt class="docutils literal">$HG_LOCAL=1</tt>
               , or in the repository if
               <tt class="docutils literal">$HG_LOCAL=0</tt>
               .
             </dd>
             <dt>
+              <tt class="docutils literal">
+                <span class="pre">pretransmit-inline-clone-bundle</span>
+              </tt>
+            </dt>
+            <dd>
+              Run before transferring an inline clonebundle to the peer.
+If the exit status is 0, the inline clonebundle will be allowed to be
+transferred. A non-zero status will cause the transfer to fail.
+The path of the inline clonebundle is in
+              <tt class="docutils literal">$HG_CLONEBUNDLEPATH</tt>
+              .
+            </dd>
+            <dt>
               <tt class="docutils literal">pretxnopen</tt>
             </dt>
             <dd>
               Run before any new repository transaction is open. The reason for the
 transaction will be in
               <tt class="docutils literal">$HG_TXNNAME</tt>
               , and a unique identifier for the
```

### Comparing `mercurial-6.4rc0/doc/runrst` & `mercurial-6.5rc0/doc/runrst`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/doc/style.css` & `mercurial-6.5rc0/doc/style.css`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hg` & `mercurial-6.5rc0/hg`

 * *Files 16% similar despite different names*

```diff
@@ -34,26 +34,26 @@
                 appdata,
                 'Python',
                 'Python%d%d' % (vi[0], vi[1]),
                 'site-packages',
             )
         )
 
-from hgdemandimport import tracing
+try:
+    from hgdemandimport import tracing
+except ImportError:
+    sys.stderr.write(
+        "abort: couldn't find mercurial libraries in [%s]\n"
+        % ' '.join(sys.path)
+    )
+    sys.stderr.write("(check your install and PYTHONPATH)\n")
+    sys.exit(-1)
 
 with tracing.log('hg script'):
     # enable importing on demand to reduce startup time
-    try:
-        import hgdemandimport
+    import hgdemandimport
 
-        hgdemandimport.enable()
-    except ImportError:
-        sys.stderr.write(
-            "abort: couldn't find mercurial libraries in [%s]\n"
-            % ' '.join(sys.path)
-        )
-        sys.stderr.write("(check your install and PYTHONPATH)\n")
-        sys.exit(-1)
+    hgdemandimport.enable()
 
     from mercurial import dispatch
 
     dispatch.run()
```

### Comparing `mercurial-6.4rc0/hgdemandimport/__init__.py` & `mercurial-6.5rc0/hgdemandimport/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgdemandimport/demandimportpy3.py` & `mercurial-6.5rc0/hgdemandimport/demandimportpy3.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgdemandimport/tracing.py` & `mercurial-6.5rc0/hgdemandimport/tracing.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgeditor` & `mercurial-6.5rc0/hgeditor`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/absorb.py` & `mercurial-6.5rc0/hgext/absorb.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/acl.py` & `mercurial-6.5rc0/hgext/acl.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/amend.py` & `mercurial-6.5rc0/hgext/amend.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/automv.py` & `mercurial-6.5rc0/hgext/automv.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/beautifygraph.py` & `mercurial-6.5rc0/hgext/beautifygraph.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/blackbox.py` & `mercurial-6.5rc0/hgext/blackbox.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/bookflow.py` & `mercurial-6.5rc0/hgext/bookflow.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/bugzilla.py` & `mercurial-6.5rc0/hgext/bugzilla.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/censor.py` & `mercurial-6.5rc0/hgext/censor.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/children.py` & `mercurial-6.5rc0/hgext/children.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/churn.py` & `mercurial-6.5rc0/hgext/churn.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/closehead.py` & `mercurial-6.5rc0/hgext/closehead.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/commitextras.py` & `mercurial-6.5rc0/hgext/commitextras.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/__init__.py` & `mercurial-6.5rc0/hgext/convert/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/bzr.py` & `mercurial-6.5rc0/hgext/convert/bzr.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/common.py` & `mercurial-6.5rc0/hgext/convert/common.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/convcmd.py` & `mercurial-6.5rc0/hgext/convert/convcmd.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/cvs.py` & `mercurial-6.5rc0/hgext/convert/cvs.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/cvsps.py` & `mercurial-6.5rc0/hgext/convert/cvsps.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/darcs.py` & `mercurial-6.5rc0/hgext/convert/darcs.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/filemap.py` & `mercurial-6.5rc0/hgext/convert/filemap.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/git.py` & `mercurial-6.5rc0/hgext/convert/git.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/gnuarch.py` & `mercurial-6.5rc0/hgext/convert/gnuarch.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/hg.py` & `mercurial-6.5rc0/hgext/convert/hg.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/monotone.py` & `mercurial-6.5rc0/hgext/convert/monotone.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/p4.py` & `mercurial-6.5rc0/hgext/convert/p4.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/subversion.py` & `mercurial-6.5rc0/hgext/convert/subversion.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/convert/transport.py` & `mercurial-6.5rc0/hgext/convert/transport.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/eol.py` & `mercurial-6.5rc0/hgext/eol.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/extdiff.py` & `mercurial-6.5rc0/hgext/extdiff.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/factotum.py` & `mercurial-6.5rc0/hgext/factotum.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fastannotate/__init__.py` & `mercurial-6.5rc0/hgext/fastannotate/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fastannotate/commands.py` & `mercurial-6.5rc0/hgext/fastannotate/commands.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fastannotate/context.py` & `mercurial-6.5rc0/hgext/fastannotate/context.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fastannotate/formatter.py` & `mercurial-6.5rc0/hgext/fastannotate/formatter.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fastannotate/protocol.py` & `mercurial-6.5rc0/hgext/fastannotate/protocol.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fastannotate/revmap.py` & `mercurial-6.5rc0/hgext/fastannotate/revmap.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fastannotate/support.py` & `mercurial-6.5rc0/hgext/fastannotate/support.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fastexport.py` & `mercurial-6.5rc0/hgext/fastexport.py`

 * *Files 1% similar despite different names*

```diff
@@ -65,18 +65,18 @@
 
 
 def convert_to_git_ref(branch):
     # XXX filter/map depending on git restrictions
     return b"refs/heads/" + branch
 
 
-def write_data(buf, data, skip_newline):
+def write_data(buf, data, add_newline=False):
     buf.append(b"data %d\n" % len(data))
     buf.append(data)
-    if not skip_newline or data[-1:] != b"\n":
+    if add_newline or data[-1:] != b"\n":
         buf.append(b"\n")
 
 
 def export_commit(ui, repo, rev, marks, authormap):
     ctx = repo[rev]
     revid = ctx.hex()
     if revid in marks:
@@ -99,15 +99,15 @@
         filectx = ctx.filectx(fname)
         filerev = hex(filectx.filenode())
         if filerev not in marks:
             mark = len(marks) + 1
             marks[filerev] = mark
             data = filectx.data()
             buf = [b"blob\n", b"mark :%d\n" % mark]
-            write_data(buf, data, False)
+            write_data(buf, data, True)
             ui.write(*buf, keepprogressbar=True)
             del buf
 
     # Assign a mark for the current revision for references by
     # latter merge commits.
     mark = len(marks) + 1
     marks[revid] = mark
@@ -118,15 +118,15 @@
         b"mark :%d\n" % mark,
         b"committer %s %s\n"
         % (
             convert_to_git_user(authormap, ctx.user(), revid),
             convert_to_git_date(ctx.date()),
         ),
     ]
-    write_data(buf, ctx.description(), True)
+    write_data(buf, ctx.description())
     if parents:
         buf.append(b"from :%d\n" % marks[parents[0].hex()])
     if len(parents) == 2:
         buf.append(b"merge :%d\n" % marks[parents[1].hex()])
         p0ctx = repo[parents[0]]
         files = ctx.manifest().diff(p0ctx.manifest())
     else:
```

### Comparing `mercurial-6.4rc0/hgext/fetch.py` & `mercurial-6.5rc0/hgext/fetch.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fix.py` & `mercurial-6.5rc0/hgext/fix.py`

 * *Files 0% similar despite different names*

```diff
@@ -5,14 +5,21 @@
 # This software may be used and distributed according to the terms of the
 # GNU General Public License version 2 or any later version.
 """rewrite file content in changesets or working copy (EXPERIMENTAL)
 
 Provides a command that runs configured tools on the contents of modified files,
 writing back any fixes to the working copy or replacing changesets.
 
+Fixer tools are run in the repository's root directory. This allows them to read
+configuration files from the working copy, or even write to the working copy.
+The working copy is not updated to match the revision being fixed. In fact,
+several revisions may be fixed in parallel. Writes to the working copy are not
+amended into the revision being fixed; fixer tools MUST always read content to
+be fixed from stdin, and write fixed file content back to stdout.
+
 Here is an example configuration that causes :hg:`fix` to apply automatic
 formatting fixes to modified lines in C++ code::
 
   [fix]
   clang-format:command=clang-format --assume-filename={rootpath}
   clang-format:linerange=--lines={first}:{last}
   clang-format:pattern=set:**.cpp or **.hpp
@@ -109,21 +116,14 @@
     Run once after all files and revisions have been handled. Provides
     "$HG_REPLACEMENTS" with information about what revisions were created and
     made obsolete. Provides a boolean "$HG_WDIRWRITTEN" to indicate whether any
     files in the working copy were updated. Provides a list "$HG_METADATA"
     mapping fixer tool names to lists of metadata values returned from
     executions that modified a file. This aggregates the same metadata
     previously passed to the "postfixfile" hook.
-
-Fixer tools are run in the repository's root directory. This allows them to read
-configuration files from the working copy, or even write to the working copy.
-The working copy is not updated to match the revision being fixed. In fact,
-several revisions may be fixed in parallel. Writes to the working copy are not
-amended into the revision being fixed; fixer tools should always write fixed
-file content back to stdout as documented above.
 """
 
 
 import collections
 import itertools
 import os
 import re
@@ -235,15 +235,16 @@
     [allopt, baseopt, revopt, sourceopt, wdiropt, wholeopt],
     usage,
     helpcategory=command.CATEGORY_FILE_CONTENTS,
 )
 def fix(ui, repo, *pats, **opts):
     """rewrite file content in changesets or working directory
 
-    Runs any configured tools to fix the content of files. Only affects files
+    Runs any configured tools to fix the content of files. (See
+    :hg:`help -e fix` for details about configuring tools.) Only affects files
     with changes, unless file arguments are provided. Only affects changed lines
     of files, unless the --whole flag is used. Some tools may always affect the
     whole file regardless of --whole.
 
     If --working-dir is used, files with uncommitted changes in the working copy
     will be fixed. Note that no backup are made.
```

### Comparing `mercurial-6.4rc0/hgext/fsmonitor/__init__.py` & `mercurial-6.5rc0/hgext/fsmonitor/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fsmonitor/pywatchman/__init__.py` & `mercurial-6.5rc0/hgext/fsmonitor/pywatchman/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fsmonitor/pywatchman/bser.c` & `mercurial-6.5rc0/hgext/fsmonitor/pywatchman/bser.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fsmonitor/pywatchman/capabilities.py` & `mercurial-6.5rc0/hgext/fsmonitor/pywatchman/capabilities.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fsmonitor/pywatchman/compat.py` & `mercurial-6.5rc0/hgext/fsmonitor/pywatchman/compat.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fsmonitor/pywatchman/encoding.py` & `mercurial-6.5rc0/hgext/fsmonitor/pywatchman/encoding.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fsmonitor/pywatchman/load.py` & `mercurial-6.5rc0/hgext/fsmonitor/pywatchman/load.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fsmonitor/pywatchman/pybser.py` & `mercurial-6.5rc0/hgext/fsmonitor/pywatchman/pybser.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fsmonitor/state.py` & `mercurial-6.5rc0/hgext/fsmonitor/state.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/fsmonitor/watchmanclient.py` & `mercurial-6.5rc0/hgext/fsmonitor/watchmanclient.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/git/TODO.md` & `mercurial-6.5rc0/hgext/git/TODO.md`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/git/__init__.py` & `mercurial-6.5rc0/hgext/git/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/git/dirstate.py` & `mercurial-6.5rc0/hgext/git/dirstate.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/git/gitlog.py` & `mercurial-6.5rc0/hgext/git/gitlog.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/git/gitutil.py` & `mercurial-6.5rc0/hgext/git/gitutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/git/index.py` & `mercurial-6.5rc0/hgext/git/index.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/git/manifest.py` & `mercurial-6.5rc0/hgext/git/manifest.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/githelp.py` & `mercurial-6.5rc0/hgext/githelp.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/gpg.py` & `mercurial-6.5rc0/hgext/gpg.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/graphlog.py` & `mercurial-6.5rc0/hgext/graphlog.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/hgk.py` & `mercurial-6.5rc0/hgext/hgk.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/highlight/__init__.py` & `mercurial-6.5rc0/hgext/highlight/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/highlight/highlight.py` & `mercurial-6.5rc0/hgext/highlight/highlight.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/histedit.py` & `mercurial-6.5rc0/hgext/histedit.py`

 * *Files 1% similar despite different names*

```diff
@@ -1423,19 +1423,19 @@
 
     def render_string(self, win, output, diffcolors=False):
         maxy, maxx = win.getmaxyx()
         length = min(maxy - 1, len(output))
         for y in range(0, length):
             line = output[y]
             if diffcolors:
-                if line and line[0] == b'+':
+                if line.startswith(b'+'):
                     win.addstr(
                         y, 0, line, curses.color_pair(COLOR_DIFF_ADD_LINE)
                     )
-                elif line and line[0] == b'-':
+                elif line.startswith(b'-'):
                     win.addstr(
                         y, 0, line, curses.color_pair(COLOR_DIFF_DEL_LINE)
                     )
                 elif line.startswith(b'@@ '):
                     win.addstr(y, 0, line, curses.color_pair(COLOR_DIFF_OFFSET))
                 else:
                     win.addstr(y, 0, line)
```

### Comparing `mercurial-6.4rc0/hgext/hooklib/__init__.py` & `mercurial-6.5rc0/hgext/hooklib/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/hooklib/changeset_obsoleted.py` & `mercurial-6.5rc0/hgext/hooklib/changeset_obsoleted.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/hooklib/changeset_published.py` & `mercurial-6.5rc0/hgext/hooklib/changeset_published.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/hooklib/enforce_draft_commits.py` & `mercurial-6.5rc0/hgext/hooklib/enforce_draft_commits.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/hooklib/reject_merge_commits.py` & `mercurial-6.5rc0/hgext/hooklib/reject_merge_commits.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/hooklib/reject_new_heads.py` & `mercurial-6.5rc0/hgext/hooklib/reject_new_heads.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/infinitepush/README` & `mercurial-6.5rc0/hgext/infinitepush/README`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/infinitepush/__init__.py` & `mercurial-6.5rc0/hgext/infinitepush/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -150,14 +150,26 @@
 testedwith = b'ships-with-hg-core'
 
 configtable = {}
 configitem = registrar.configitem(configtable)
 
 configitem(
     b'infinitepush',
+    b'deprecation-message',
+    default=True,
+)
+
+configitem(
+    b'infinitepush',
+    b'deprecation-abort',
+    default=True,
+)
+
+configitem(
+    b'infinitepush',
     b'server',
     default=False,
 )
 configitem(
     b'infinitepush',
     b'storetype',
     default=b'',
@@ -313,27 +325,45 @@
             )
 
 
 def _isserver(ui):
     return ui.configbool(b'infinitepush', b'server')
 
 
+WARNING_MSG = b"""IMPORTANT: if you use this extension, please contact
+mercurial-devel@mercurial-scm.org IMMEDIATELY. This extension is believed to be
+unused and barring learning of users of this functionality, we drop this
+extension in Mercurial 6.6.
+"""
+
+
 def reposetup(ui, repo):
+    if ui.configbool(b'infinitepush', b'deprecation-message'):
+        ui.write_err(WARNING_MSG)
+    if ui.configbool(b'infinitepush', b'deprecation-abort'):
+        msg = b"USING EXTENSION INFINITE PUSH DESPITE PENDING DROP"
+        hint = b"contact mercurial-devel@mercurial-scm.org"
+        raise error.Abort(msg, hint=hint)
     if _isserver(ui) and repo.local():
         repo.bundlestore = bundlestore(repo)
 
 
 def extsetup(ui):
     commonsetup(ui)
     if _isserver(ui):
         serverextsetup(ui)
     else:
         clientextsetup(ui)
 
 
+def uipopulate(ui):
+    if not ui.hasconfig(b"experimental", b"changegroup3"):
+        ui.setconfig(b"experimental", b"changegroup3", False, b"infinitepush")
+
+
 def commonsetup(ui):
     wireprotov1server.commands[b'listkeyspatterns'] = (
         wireprotolistkeyspatterns,
         b'namespace patterns',
     )
     scratchbranchpat = ui.config(b'infinitepush', b'branchpattern')
     if scratchbranchpat:
```

### Comparing `mercurial-6.4rc0/hgext/infinitepush/bundleparts.py` & `mercurial-6.5rc0/hgext/infinitepush/bundleparts.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/infinitepush/common.py` & `mercurial-6.5rc0/hgext/infinitepush/common.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/infinitepush/fileindexapi.py` & `mercurial-6.5rc0/hgext/infinitepush/fileindexapi.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/infinitepush/indexapi.py` & `mercurial-6.5rc0/hgext/infinitepush/indexapi.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/infinitepush/schema.sql` & `mercurial-6.5rc0/hgext/infinitepush/schema.sql`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/infinitepush/sqlindexapi.py` & `mercurial-6.5rc0/hgext/infinitepush/sqlindexapi.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/infinitepush/store.py` & `mercurial-6.5rc0/hgext/infinitepush/store.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/journal.py` & `mercurial-6.5rc0/hgext/journal.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/keyword.py` & `mercurial-6.5rc0/hgext/keyword.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/largefiles/__init__.py` & `mercurial-6.5rc0/hgext/largefiles/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/largefiles/basestore.py` & `mercurial-6.5rc0/hgext/largefiles/basestore.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/largefiles/lfcommands.py` & `mercurial-6.5rc0/hgext/largefiles/lfcommands.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/largefiles/lfutil.py` & `mercurial-6.5rc0/hgext/largefiles/lfutil.py`

 * *Files 1% similar despite different names*

```diff
@@ -547,18 +547,18 @@
 def unixpath(path):
     '''Return a version of path normalized for use with the lfdirstate.'''
     return util.pconvert(os.path.normpath(path))
 
 
 def islfilesrepo(repo):
     '''Return true if the repo is a largefile repo.'''
-    if b'largefiles' in repo.requirements and any(
-        shortnameslash in f[1] for f in repo.store.datafiles()
-    ):
-        return True
+    if b'largefiles' in repo.requirements:
+        for entry in repo.store.data_entries():
+            if entry.is_revlog and shortnameslash in entry.target_id:
+                return True
 
     return any(openlfdirstate(repo.ui, repo, False))
 
 
 class storeprotonotcapable(Exception):
     def __init__(self, storetypes):
         self.storetypes = storetypes
```

### Comparing `mercurial-6.4rc0/hgext/largefiles/localstore.py` & `mercurial-6.5rc0/hgext/largefiles/localstore.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/largefiles/overrides.py` & `mercurial-6.5rc0/hgext/largefiles/overrides.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/largefiles/proto.py` & `mercurial-6.5rc0/hgext/largefiles/proto.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/largefiles/remotestore.py` & `mercurial-6.5rc0/hgext/largefiles/remotestore.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/largefiles/reposetup.py` & `mercurial-6.5rc0/hgext/largefiles/reposetup.py`

 * *Files 1% similar despite different names*

```diff
@@ -453,17 +453,22 @@
             lfutil.getlfilestoupload(pushop.repo, lfrevs, addfunc)
             lfcommands.uploadlfiles(ui, pushop.repo, pushop.remote, toupload)
 
     repo.prepushoutgoinghooks.add(b"largefiles", prepushoutgoinghook)
 
     def checkrequireslfiles(ui, repo, **kwargs):
         with repo.lock():
-            if b'largefiles' not in repo.requirements and any(
-                lfutil.shortname + b'/' in f[1] for f in repo.store.datafiles()
-            ):
-                repo.requirements.add(b'largefiles')
-                scmutil.writereporequirements(repo)
+            if b'largefiles' in repo.requirements:
+                return
+            marker = lfutil.shortnameslash
+            for entry in repo.store.data_entries():
+                # XXX note that this match is not rooted and can wrongly match
+                # directory ending with ".hglf"
+                if entry.is_revlog and marker in entry.target_id:
+                    repo.requirements.add(b'largefiles')
+                    scmutil.writereporequirements(repo)
+                    break
 
     ui.setconfig(
         b'hooks', b'changegroup.lfiles', checkrequireslfiles, b'largefiles'
     )
     ui.setconfig(b'hooks', b'commit.lfiles', checkrequireslfiles, b'largefiles')
```

### Comparing `mercurial-6.4rc0/hgext/largefiles/storefactory.py` & `mercurial-6.5rc0/hgext/largefiles/storefactory.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/largefiles/wirestore.py` & `mercurial-6.5rc0/hgext/largefiles/wirestore.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/lfs/TODO.rst` & `mercurial-6.5rc0/hgext/lfs/TODO.rst`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/lfs/__init__.py` & `mercurial-6.5rc0/hgext/lfs/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/lfs/blobstore.py` & `mercurial-6.5rc0/hgext/lfs/blobstore.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/lfs/pointer.py` & `mercurial-6.5rc0/hgext/lfs/pointer.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/lfs/wireprotolfsserver.py` & `mercurial-6.5rc0/hgext/lfs/wireprotolfsserver.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/lfs/wrapper.py` & `mercurial-6.5rc0/hgext/lfs/wrapper.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/logtoprocess.py` & `mercurial-6.5rc0/hgext/logtoprocess.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/mq.py` & `mercurial-6.5rc0/hgext/mq.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/narrow/TODO.rst` & `mercurial-6.5rc0/hgext/narrow/TODO.rst`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/narrow/__init__.py` & `mercurial-6.5rc0/hgext/narrow/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/narrow/narrowbundle2.py` & `mercurial-6.5rc0/hgext/narrow/narrowbundle2.py`

 * *Files 2% similar despite different names*

```diff
@@ -2,32 +2,31 @@
 #
 # Copyright 2017 Google, Inc.
 #
 # This software may be used and distributed according to the terms of the
 # GNU General Public License version 2 or any later version.
 
 
-import errno
 import struct
 
 from mercurial.i18n import _
 from mercurial import (
     bundle2,
     changegroup,
     error,
     exchange,
     localrepo,
     narrowspec,
     repair,
     requirements,
     scmutil,
+    transaction,
     util,
     wireprototypes,
 )
-from mercurial.utils import stringutil
 
 _NARROWACL_SECTION = b'narrowacl'
 _CHANGESPECPART = b'narrow:changespec'
 _RESSPECS = b'narrow:responsespec'
 _SPECPART = b'narrow:spec'
 _SPECPART_INCLUDE = b'include'
 _SPECPART_EXCLUDE = b'exclude'
@@ -291,24 +290,15 @@
             else:
                 gen.apply(
                     repo, b'strip', b'bundle:' + vfs.join(chgrpfile), True
                 )
     finally:
         f.close()
 
-    # remove undo files
-    for undovfs, undofile in repo.undofiles():
-        try:
-            undovfs.unlink(undofile)
-        except OSError as e:
-            if e.errno != errno.ENOENT:
-                ui.warn(
-                    _(b'error removing %s: %s\n')
-                    % (undovfs.join(undofile), stringutil.forcebytestr(e))
-                )
+    transaction.cleanup_undo_files(repo.ui.warn, repo.vfs_map)
 
     # Remove partial backup only if there were no exceptions
     op._widen_uninterr.__exit__(None, None, None)
     vfs.unlink(chgrpfile)
 
 
 def setup():
```

### Comparing `mercurial-6.4rc0/hgext/narrow/narrowcommands.py` & `mercurial-6.5rc0/hgext/narrow/narrowcommands.py`

 * *Files 2% similar despite different names*

```diff
@@ -284,32 +284,35 @@
                 ui.status(_(b'moving unwanted changesets to backup\n'))
             else:
                 ui.status(_(b'deleting unwanted changesets\n'))
             with ui.configoverride(overrides, b'narrow'):
                 repair.strip(ui, unfi, tostrip, topic=b'narrow', backup=backup)
 
         todelete = []
-        for t, f, size in repo.store.datafiles():
-            if f.startswith(b'data/'):
-                file = f[5:-2]
-                if not newmatch(file):
-                    todelete.append(f)
-            elif f.startswith(b'meta/'):
-                dir = f[5:-13]
+        for entry in repo.store.data_entries():
+            if not entry.is_revlog:
+                continue
+            if entry.is_filelog:
+                if not newmatch(entry.target_id):
+                    for file_ in entry.files():
+                        todelete.append(file_.unencoded_path)
+            elif entry.is_manifestlog:
+                dir = entry.target_id
                 dirs = sorted(pathutil.dirs({dir})) + [dir]
                 include = True
                 for d in dirs:
                     visit = newmatch.visitdir(d)
                     if not visit:
                         include = False
                         break
                     if visit == b'all':
                         break
                 if not include:
-                    todelete.append(f)
+                    for file_ in entry.files():
+                        todelete.append(file_.unencoded_path)
 
         repo.destroying()
 
         with repo.transaction(b'narrowing'):
             # Update narrowspec before removing revlogs, so repo won't be
             # corrupt in case of crash
             repo.setnarrowpats(newincludes, newexcludes)
@@ -640,15 +643,15 @@
                         suggestedremovals.append(include)
                 if suggestedremovals:
                     for s in suggestedremovals:
                         ui.status(b'%s\n' % s)
                     if (
                         ui.promptchoice(
                             _(
-                                b'remove these unused includes (yn)?'
+                                b'remove these unused includes (Yn)?'
                                 b'$$ &Yes $$ &No'
                             )
                         )
                         == 0
                     ):
                         removedincludes.update(suggestedremovals)
                         narrowing = True
```

### Comparing `mercurial-6.4rc0/hgext/narrow/narrowdirstate.py` & `mercurial-6.5rc0/hgext/narrow/narrowdirstate.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/narrow/narrowrepo.py` & `mercurial-6.5rc0/hgext/narrow/narrowrepo.py`

 * *Files 6% similar despite different names*

```diff
@@ -15,14 +15,14 @@
     """Enables narrow clone functionality on a single local repository."""
 
     class narrowrepository(repo.__class__):
         def _makedirstate(self):
             dirstate = super(narrowrepository, self)._makedirstate()
             return narrowdirstate.wrapdirstate(self, dirstate)
 
-        def peer(self, path=None):
-            peer = super(narrowrepository, self).peer(path=path)
+        def peer(self, *args, **kwds):
+            peer = super(narrowrepository, self).peer(*args, **kwds)
             peer._caps.add(wireprototypes.NARROWCAP)
             peer._caps.add(wireprototypes.ELLIPSESCAP)
             return peer
 
     repo.__class__ = narrowrepository
```

### Comparing `mercurial-6.4rc0/hgext/narrow/narrowtemplates.py` & `mercurial-6.5rc0/hgext/narrow/narrowtemplates.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/narrow/narrowwirepeer.py` & `mercurial-6.5rc0/hgext/narrow/narrowwirepeer.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/notify.py` & `mercurial-6.5rc0/hgext/notify.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/pager.py` & `mercurial-6.5rc0/hgext/pager.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/patchbomb.py` & `mercurial-6.5rc0/hgext/patchbomb.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/phabricator.py` & `mercurial-6.5rc0/hgext/phabricator.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/purge.py` & `mercurial-6.5rc0/hgext/purge.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/rebase.py` & `mercurial-6.5rc0/hgext/rebase.py`

 * *Files 1% similar despite different names*

```diff
@@ -48,14 +48,15 @@
     rewriteutil,
     scmutil,
     smartset,
     state as statemod,
     util,
 )
 
+
 # The following constants are used throughout the rebase module. The ordering of
 # their values must be maintained.
 
 # Indicates that a revision needs to be rebased
 revtodo = -1
 revtodostr = b'-1'
 
@@ -80,23 +81,14 @@
 testedwith = b'ships-with-hg-core'
 
 
 def _nothingtorebase():
     return 1
 
 
-def _savegraft(ctx, extra):
-    s = ctx.extra().get(b'source', None)
-    if s is not None:
-        extra[b'source'] = s
-    s = ctx.extra().get(b'intermediate-source', None)
-    if s is not None:
-        extra[b'intermediate-source'] = s
-
-
 def _savebranch(ctx, extra):
     extra[b'branch'] = ctx.branch()
 
 
 def _destrebase(repo, sourceset, destspace=None):
     """small wrapper around destmerge to pass the right extra args
 
@@ -189,15 +181,15 @@
         self.skipped = set()
 
         self.collapsef = opts.get('collapse', False)
         self.collapsemsg = cmdutil.logmessage(ui, pycompat.byteskwargs(opts))
         self.date = opts.get('date', None)
 
         e = opts.get('extrafn')  # internal, used by e.g. hgsubversion
-        self.extrafns = [_savegraft]
+        self.extrafns = [rewriteutil.preserve_extras_on_rebase]
         if e:
             self.extrafns = [e]
 
         self.backupf = ui.configbool(b'rewrite', b'backup-bundle')
         self.keepf = opts.get('keep', False)
         self.keepbranchesf = opts.get('keepbranches', False)
         self.skipemptysuccessorf = rewriteutil.skip_empty_successor(
@@ -834,29 +826,34 @@
                         b"warning: new changesets detected on "
                         b"destination branch, can't strip\n"
                     )
                 )
                 cleanup = False
 
             if cleanup:
+
                 if rebased:
                     strippoints = [
                         c.node() for c in repo.set(b'roots(%ld)', rebased)
                     ]
 
                 updateifonnodes = set(rebased)
                 updateifonnodes.update(self.destmap.values())
 
-                if not dryrun and not confirm:
+                if not confirm:
+                    # note: when dry run is set the `rebased` and `destmap`
+                    # variables seem to contain "bad" contents, so do not
+                    # rely on them. As dryrun does not need this part of
+                    # the cleanup, this is "fine"
                     updateifonnodes.add(self.originalwd)
 
                 shouldupdate = repo[b'.'].rev() in updateifonnodes
 
                 # Update away from the rebase if necessary
-                if shouldupdate:
+                if not dryrun and shouldupdate:
                     mergemod.clean_update(repo[self.originalwd])
 
                 # Strip from the first rebased revision
                 if rebased:
                     repair.strip(repo.ui, repo, strippoints, backup=backup)
 
             if self.activebookmark and self.activebookmark in repo._bookmarks:
```

### Comparing `mercurial-6.4rc0/hgext/record.py` & `mercurial-6.5rc0/hgext/record.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/releasenotes.py` & `mercurial-6.5rc0/hgext/releasenotes.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/relink.py` & `mercurial-6.5rc0/hgext/relink.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/README.md` & `mercurial-6.5rc0/hgext/remotefilelog/README.md`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/__init__.py` & `mercurial-6.5rc0/hgext/remotefilelog/__init__.py`

 * *Files 1% similar despite different names*

```diff
@@ -404,17 +404,15 @@
         )
 
         def canperformstreamclone(orig, pullop, bundle2=False):
             # remotefilelog is currently incompatible with the
             # bundle2 flavor of streamclones, so force us to use
             # v1 instead.
             if b'v2' in pullop.remotebundle2caps.get(b'stream', []):
-                pullop.remotebundle2caps[b'stream'] = [
-                    c for c in pullop.remotebundle2caps[b'stream'] if c != b'v2'
-                ]
+                pullop.remotebundle2caps[b'stream'] = []
             if bundle2:
                 return False, None
             supported, requirements = orig(pullop, bundle2=bundle2)
             if requirements is not None:
                 requirements.add(constants.SHALLOWREPO_REQUIREMENT)
             return supported, requirements
```

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/basepack.py` & `mercurial-6.5rc0/hgext/remotefilelog/basepack.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/basestore.py` & `mercurial-6.5rc0/hgext/remotefilelog/basestore.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/connectionpool.py` & `mercurial-6.5rc0/hgext/remotefilelog/connectionpool.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/constants.py` & `mercurial-6.5rc0/hgext/remotefilelog/constants.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/contentstore.py` & `mercurial-6.5rc0/hgext/remotefilelog/contentstore.py`

 * *Files 0% similar despite different names*

```diff
@@ -371,15 +371,15 @@
                 break
             if linkrev > endlinkrev:
                 continue
             node = rl.node(rev)
             ledger.markdataentry(self, treename, node)
             ledger.markhistoryentry(self, treename, node)
 
-        for t, path, size in self._store.datafiles():
+        for t, path, size in self._store.data_entries():
             if path[:5] != b'meta/' or path[-2:] != b'.i':
                 continue
 
             treename = path[5 : -len(b'/00manifest')]
 
             rl = revlog.revlog(self._svfs, indexfile=path[:-2])
             for rev in range(len(rl) - 1, -1, -1):
```

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/datapack.py` & `mercurial-6.5rc0/hgext/remotefilelog/datapack.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/debugcommands.py` & `mercurial-6.5rc0/hgext/remotefilelog/debugcommands.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/fileserverclient.py` & `mercurial-6.5rc0/hgext/remotefilelog/fileserverclient.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/historypack.py` & `mercurial-6.5rc0/hgext/remotefilelog/historypack.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/metadatastore.py` & `mercurial-6.5rc0/hgext/remotefilelog/metadatastore.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/remotefilectx.py` & `mercurial-6.5rc0/hgext/remotefilelog/remotefilectx.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/remotefilelog.py` & `mercurial-6.5rc0/hgext/remotefilelog/remotefilelog.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/remotefilelogserver.py` & `mercurial-6.5rc0/hgext/remotefilelog/remotefilelogserver.py`

 * *Files 9% similar despite different names*

```diff
@@ -141,15 +141,17 @@
 
     wireprotov1server.commands[b'stream_out_shallow'] = (
         stream_out_shallow,
         b'*',
     )
 
     # don't clone filelogs to shallow clients
-    def _walkstreamfiles(orig, repo, matcher=None):
+    def _walkstreamfiles(
+        orig, repo, matcher=None, phase=False, obsolescence=False
+    ):
         if state.shallowremote:
             # if we are shallow ourselves, stream our local commits
             if shallowutil.isenabled(repo):
                 striplen = len(repo.store.path) + 1
                 readdir = repo.store.rawvfs.readdir
                 visit = [os.path.join(repo.store.path, b'data')]
                 while visit:
@@ -158,48 +160,55 @@
                         fp = p + b'/' + f
                         if kind == stat.S_IFREG:
                             if not fp.endswith(b'.i') and not fp.endswith(
                                 b'.d'
                             ):
                                 n = util.pconvert(fp[striplen:])
                                 d = store.decodedir(n)
-                                t = store.FILETYPE_OTHER
-                                yield (t, d, st.st_size)
+                                yield store.SimpleStoreEntry(
+                                    entry_path=d,
+                                    is_volatile=False,
+                                    file_size=st.st_size,
+                                )
+
                         if kind == stat.S_IFDIR:
                             visit.append(fp)
 
             if scmutil.istreemanifest(repo):
-                for (t, u, s) in repo.store.datafiles():
-                    if u.startswith(b'meta/') and (
-                        u.endswith(b'.i') or u.endswith(b'.d')
-                    ):
-                        yield (t, u, s)
+                for entry in repo.store.data_entries():
+                    if not entry.is_revlog:
+                        continue
+                    if entry.is_manifestlog:
+                        yield entry
 
             # Return .d and .i files that do not match the shallow pattern
             match = state.match
             if match and not match.always():
-                for (t, u, s) in repo.store.datafiles():
-                    f = u[5:-2]  # trim data/...  and .i/.d
-                    if not state.match(f):
-                        yield (t, u, s)
+                for entry in repo.store.data_entries():
+                    if not entry.is_revlog:
+                        continue
+                    if not state.match(entry.target_id):
+                        yield entry
 
-            for x in repo.store.topfiles():
+            for x in repo.store.top_entries():
                 if state.noflatmf and x[1][:11] == b'00manifest.':
                     continue
                 yield x
 
         elif shallowutil.isenabled(repo):
             # don't allow cloning from a shallow repo to a full repo
             # since it would require fetching every version of every
             # file in order to create the revlogs.
             raise error.Abort(
                 _(b"Cannot clone from a shallow repo to a full repo.")
             )
         else:
-            for x in orig(repo, matcher):
+            for x in orig(
+                repo, matcher, phase=phase, obsolescence=obsolescence
+            ):
                 yield x
 
     extensions.wrapfunction(streamclone, b'_walkstreamfiles', _walkstreamfiles)
 
     # expose remotefilelog capabilities
     def _capabilities(orig, repo, proto):
         caps = orig(repo, proto)
```

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/repack.py` & `mercurial-6.5rc0/hgext/remotefilelog/repack.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/shallowbundle.py` & `mercurial-6.5rc0/hgext/remotefilelog/shallowbundle.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/shallowrepo.py` & `mercurial-6.5rc0/hgext/remotefilelog/shallowrepo.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/shallowutil.py` & `mercurial-6.5rc0/hgext/remotefilelog/shallowutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotefilelog/shallowverifier.py` & `mercurial-6.5rc0/hgext/remotefilelog/shallowverifier.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/remotenames.py` & `mercurial-6.5rc0/hgext/remotenames.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/schemes.py` & `mercurial-6.5rc0/hgext/schemes.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/share.py` & `mercurial-6.5rc0/hgext/share.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/show.py` & `mercurial-6.5rc0/hgext/show.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/sparse.py` & `mercurial-6.5rc0/hgext/sparse.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/split.py` & `mercurial-6.5rc0/hgext/split.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/sqlitestore.py` & `mercurial-6.5rc0/hgext/sqlitestore.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/strip.py` & `mercurial-6.5rc0/hgext/strip.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/transplant.py` & `mercurial-6.5rc0/hgext/transplant.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/uncommit.py` & `mercurial-6.5rc0/hgext/uncommit.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/win32mbcs.py` & `mercurial-6.5rc0/hgext/win32mbcs.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/win32text.py` & `mercurial-6.5rc0/hgext/win32text.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/zeroconf/Zeroconf.py` & `mercurial-6.5rc0/hgext/zeroconf/Zeroconf.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgext/zeroconf/__init__.py` & `mercurial-6.5rc0/hgext/zeroconf/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/hgweb.cgi` & `mercurial-6.5rc0/hgweb.cgi`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/check-translation.py` & `mercurial-6.5rc0/i18n/check-translation.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/da.po` & `mercurial-6.5rc0/i18n/da.po`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/de.po` & `mercurial-6.5rc0/i18n/de.po`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/el.po` & `mercurial-6.5rc0/i18n/el.po`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/fr.po` & `mercurial-6.5rc0/i18n/fr.po`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/hggettext` & `mercurial-6.5rc0/i18n/hggettext`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/it.po` & `mercurial-6.5rc0/i18n/it.po`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/ja.po` & `mercurial-6.5rc0/i18n/ja.po`

 * *Files 0% similar despite different names*

```diff
@@ -37060,16 +37060,16 @@
 msgid "TLS 1.1 not supported by this Python"
 msgstr "利用中の Python では TLS 1.1 が未サポートです"
 
 msgid "TLS 1.2 not supported by this Python"
 msgstr "利用中の Python では TLS 1.2 が未サポートです"
 
 #, python-format
-msgid "invalid value for serverexactprotocol: %s"
-msgstr "不正な serverexactprotocol 指定値: %s"
+msgid "invalid value for server-insecure-exact-protocol: %s"
+msgstr "不正な server-insecure-exact-protocol 指定値: %s"
 
 #, python-format
 msgid "too many wildcards in certificate DNS name: %s"
 msgstr "証明書 DNS 名称中のワイルドカード過多: %s"
 
 msgid "no certificate received"
 msgstr "証明書が指定されていません"
```

### Comparing `mercurial-6.4rc0/i18n/polib.LICENSE` & `mercurial-6.5rc0/i18n/polib.LICENSE`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/polib.py` & `mercurial-6.5rc0/i18n/polib.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/posplit` & `mercurial-6.5rc0/i18n/posplit`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/pt_BR.po` & `mercurial-6.5rc0/i18n/pt_BR.po`

 * *Files 0% similar despite different names*

```diff
@@ -38338,16 +38338,16 @@
 msgid "TLS 1.1 not supported by this Python"
 msgstr "TLS 1.1 não é suportado por esta versão do Python"
 
 msgid "TLS 1.2 not supported by this Python"
 msgstr "TLS 1.2 não é suportado por esta versão do Python"
 
 #, python-format
-msgid "invalid value for serverexactprotocol: %s"
-msgstr "valor inválido para serverexactprotocol: %s"
+msgid "invalid value for server-insecure-exact-protocol: %s"
+msgstr "valor inválido para server-insecure-exact-protocol: %s"
 
 #, python-format
 msgid "too many wildcards in certificate DNS name: %s"
 msgstr "excesso de caracteres curinga no nome DNS do certificado: %s"
 
 msgid "no certificate received"
 msgstr "nenhum certificado recebido"
```

### Comparing `mercurial-6.4rc0/i18n/ro.po` & `mercurial-6.5rc0/i18n/ro.po`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/ru.po` & `mercurial-6.5rc0/i18n/ru.po`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/sv.po` & `mercurial-6.5rc0/i18n/sv.po`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/zh_CN.po` & `mercurial-6.5rc0/i18n/zh_CN.po`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/i18n/zh_TW.po` & `mercurial-6.5rc0/i18n/zh_TW.po`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/ancestor.py` & `mercurial-6.5rc0/mercurial/ancestor.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/archival.py` & `mercurial-6.5rc0/mercurial/archival.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/bdiff.c` & `mercurial-6.5rc0/mercurial/bdiff.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/bitmanipulation.h` & `mercurial-6.5rc0/mercurial/bitmanipulation.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/bookmarks.py` & `mercurial-6.5rc0/mercurial/bookmarks.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/branchmap.py` & `mercurial-6.5rc0/mercurial/branchmap.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/bundle2.py` & `mercurial-6.5rc0/mercurial/bundle2.py`

 * *Files 2% similar despite different names*

```diff
@@ -1230,15 +1230,15 @@
     def _payloadchunks(self):
         """yield chunks of a the part payload
 
         Exists to handle the different methods to provide data to a part."""
         # we only support fixed size data now.
         # This will be improved in the future.
         if util.safehasattr(self.data, 'next') or util.safehasattr(
-            self.data, b'__next__'
+            self.data, '__next__'
         ):
             buff = util.chunkbuffer(self.data)
             chunk = buff.read(preferedchunksize)
             while chunk:
                 yield chunk
                 chunk = buff.read(preferedchunksize)
         elif len(self.data):
@@ -1377,15 +1377,15 @@
 
 class unbundlepart(unpackermixin):
     """a bundle part read from a bundle"""
 
     def __init__(self, ui, header, fp):
         super(unbundlepart, self).__init__(fp)
         self._seekable = util.safehasattr(fp, 'seek') and util.safehasattr(
-            fp, b'tell'
+            fp, 'tell'
         )
         self.ui = ui
         # unbundle state attr
         self._headerdata = header
         self._headeroffset = 0
         self._initialized = False
         self.consumed = False
@@ -1667,14 +1667,18 @@
         featuresupported = repo.ui.configbool(b'server', b'bundle2.stream')
 
         if not streamsupported or not featuresupported:
             caps.pop(b'stream')
     # Else always advertise support on client, because payload support
     # should always be advertised.
 
+    if repo.ui.configbool(b'experimental', b'stream-v3'):
+        if b'stream' in caps:
+            caps[b'stream'] += (b'v3-exp',)
+
     # b'rev-branch-cache is no longer advertised, but still supported
     # for legacy clients.
 
     return caps
 
 
 def bundle2caps(remote):
@@ -1699,14 +1703,15 @@
     filename,
     bundletype,
     outgoing,
     opts,
     vfs=None,
     compression=None,
     compopts=None,
+    allow_internal=False,
 ):
     if bundletype.startswith(b'HG10'):
         cg = changegroup.makechangegroup(repo, outgoing, b'01', source)
         return writebundle(
             ui,
             cg,
             filename,
@@ -1714,17 +1719,29 @@
             vfs=vfs,
             compression=compression,
             compopts=compopts,
         )
     elif not bundletype.startswith(b'HG20'):
         raise error.ProgrammingError(b'unknown bundle type: %s' % bundletype)
 
+    # enforce that no internal phase are to be bundled
+    bundled_internal = repo.revs(b"%ln and _internal()", outgoing.ancestorsof)
+    if bundled_internal and not allow_internal:
+        count = len(repo.revs(b'%ln and _internal()', outgoing.missing))
+        msg = "backup bundle would contains %d internal changesets"
+        msg %= count
+        raise error.ProgrammingError(msg)
+
     caps = {}
     if opts.get(b'obsolescence', False):
         caps[b'obsmarkers'] = (b'V1',)
+    if opts.get(b'streamv2'):
+        caps[b'stream'] = [b'v2']
+    elif opts.get(b'streamv3-exp'):
+        caps[b'stream'] = [b'v3-exp']
     bundle = bundle20(ui, caps)
     bundle.setcompression(compression, compopts)
     _addpartsfromopts(ui, repo, bundle, source, outgoing, opts)
     chunkiter = bundle.getchunks()
 
     return changegroup.writechunks(ui, chunkiter, filename, vfs=vfs)
 
@@ -1746,26 +1763,33 @@
         cg = changegroup.makechangegroup(repo, outgoing, cgversion, source)
         part = bundler.newpart(b'changegroup', data=cg.getchunks())
         part.addparam(b'version', cg.version)
         if b'clcount' in cg.extras:
             part.addparam(
                 b'nbchanges', b'%d' % cg.extras[b'clcount'], mandatory=False
             )
-        if opts.get(b'phases') and repo.revs(
-            b'%ln and secret()', outgoing.ancestorsof
-        ):
-            part.addparam(
-                b'targetphase', b'%d' % phases.secret, mandatory=False
-            )
+        if opts.get(b'phases'):
+            target_phase = phases.draft
+            for head in outgoing.ancestorsof:
+                target_phase = max(target_phase, repo[head].phase())
+            if target_phase > phases.draft:
+                part.addparam(
+                    b'targetphase',
+                    b'%d' % target_phase,
+                    mandatory=False,
+                )
     if repository.REPO_FEATURE_SIDE_DATA in repo.features:
         part.addparam(b'exp-sidedata', b'1')
 
     if opts.get(b'streamv2', False):
         addpartbundlestream2(bundler, repo, stream=True)
 
+    if opts.get(b'streamv3-exp', False):
+        addpartbundlestream2(bundler, repo, stream=True)
+
     if opts.get(b'tagsfnodescache', True):
         addparttagsfnodescache(repo, bundler, outgoing)
 
     if opts.get(b'revbranchcache', True):
         addpartrevbranchcache(repo, bundler, outgoing)
 
     if opts.get(b'obsolescence', False):
@@ -1864,25 +1888,33 @@
 
 
 def addpartbundlestream2(bundler, repo, **kwargs):
     if not kwargs.get('stream', False):
         return
 
     if not streamclone.allowservergeneration(repo):
-        raise error.Abort(
-            _(
-                b'stream data requested but server does not allow '
-                b'this feature'
-            ),
-            hint=_(
-                b'well-behaved clients should not be '
-                b'requesting stream data from servers not '
-                b'advertising it; the client may be buggy'
-            ),
-        )
+        msg = _(b'stream data requested but server does not allow this feature')
+        hint = _(b'the client seems buggy')
+        raise error.Abort(msg, hint=hint)
+    if not (b'stream' in bundler.capabilities):
+        msg = _(
+            b'stream data requested but supported streaming clone versions were not specified'
+        )
+        hint = _(b'the client seems buggy')
+        raise error.Abort(msg, hint=hint)
+    client_supported = set(bundler.capabilities[b'stream'])
+    server_supported = set(getrepocaps(repo, role=b'client').get(b'stream', []))
+    common_supported = client_supported & server_supported
+    if not common_supported:
+        msg = _(b'no common supported version with the client: %s; %s')
+        str_server = b','.join(sorted(server_supported))
+        str_client = b','.join(sorted(client_supported))
+        msg %= (str_server, str_client)
+        raise error.Abort(msg)
+    version = max(common_supported)
 
     # Stream clones don't compress well. And compression undermines a
     # goal of stream clones, which is to be fast. Communicate the desire
     # to avoid compression to consumers of the bundle.
     bundler.prefercompressed = False
 
     # get the includes and excludes
@@ -1905,23 +1937,32 @@
                     b'server has obsolescence markers, but client '
                     b'cannot receive them via stream clone'
                 )
             )
         elif repo.obsstore._version in remoteversions:
             includeobsmarkers = True
 
-    filecount, bytecount, it = streamclone.generatev2(
-        repo, includepats, excludepats, includeobsmarkers
-    )
-    requirements = streamclone.streamed_requirements(repo)
-    requirements = _formatrequirementsspec(requirements)
-    part = bundler.newpart(b'stream2', data=it)
-    part.addparam(b'bytecount', b'%d' % bytecount, mandatory=True)
-    part.addparam(b'filecount', b'%d' % filecount, mandatory=True)
-    part.addparam(b'requirements', requirements, mandatory=True)
+    if version == b"v2":
+        filecount, bytecount, it = streamclone.generatev2(
+            repo, includepats, excludepats, includeobsmarkers
+        )
+        requirements = streamclone.streamed_requirements(repo)
+        requirements = _formatrequirementsspec(requirements)
+        part = bundler.newpart(b'stream2', data=it)
+        part.addparam(b'bytecount', b'%d' % bytecount, mandatory=True)
+        part.addparam(b'filecount', b'%d' % filecount, mandatory=True)
+        part.addparam(b'requirements', requirements, mandatory=True)
+    elif version == b"v3-exp":
+        it = streamclone.generatev3(
+            repo, includepats, excludepats, includeobsmarkers
+        )
+        requirements = streamclone.streamed_requirements(repo)
+        requirements = _formatrequirementsspec(requirements)
+        part = bundler.newpart(b'stream3-exp', data=it)
+        part.addparam(b'requirements', requirements, mandatory=True)
 
 
 def buildobsmarkerspart(bundler, markers, mandatory=True):
     """add an obsmarker part to the bundler with <markers>
 
     No part is created if markers is empty.
     Raises ValueError if the bundler doesn't support any known obsmarker format.
@@ -2569,14 +2610,28 @@
         msg = _(b'cannot apply stream clone to non empty repository')
         raise error.Abort(msg)
 
     repo.ui.debug(b'applying stream bundle\n')
     streamclone.applybundlev2(repo, part, filecount, bytecount, requirements)
 
 
+@parthandler(b'stream3-exp', (b'requirements',))
+def handlestreamv3bundle(op, part):
+    requirements = urlreq.unquote(part.params[b'requirements'])
+    requirements = requirements.split(b',') if requirements else []
+
+    repo = op.repo
+    if len(repo):
+        msg = _(b'cannot apply stream clone to non empty repository')
+        raise error.Abort(msg)
+
+    repo.ui.debug(b'applying stream bundle\n')
+    streamclone.applybundlev3(repo, part, requirements)
+
+
 def widen_bundle(
     bundler, repo, oldmatcher, newmatcher, common, known, cgversion, ellipses
 ):
     """generates bundle2 for widening a narrow clone
 
     bundler is the bundle to which data should be added
     repo is the localrepository instance
```

### Comparing `mercurial-6.4rc0/mercurial/bundlecaches.py` & `mercurial-6.5rc0/mercurial/bundlecaches.py`

 * *Files 8% similar despite different names*

```diff
@@ -19,15 +19,49 @@
     sslutil,
     util,
 )
 from .utils import stringutil
 
 urlreq = util.urlreq
 
+BUNDLE_CACHE_DIR = b'bundle-cache'
 CB_MANIFEST_FILE = b'clonebundles.manifest'
+CLONEBUNDLESCHEME = b"peer-bundle-cache://"
+
+
+def get_manifest(repo):
+    """get the bundle manifest to be served to a client from a server"""
+    raw_text = repo.vfs.tryread(CB_MANIFEST_FILE)
+    entries = [e.split(b' ', 1) for e in raw_text.splitlines()]
+
+    new_lines = []
+    for e in entries:
+        url = alter_bundle_url(repo, e[0])
+        if len(e) == 1:
+            line = url + b'\n'
+        else:
+            line = b"%s %s\n" % (url, e[1])
+        new_lines.append(line)
+    return b''.join(new_lines)
+
+
+def alter_bundle_url(repo, url):
+    """a function that exist to help extension and hosting to alter the url
+
+    This will typically be used to inject authentication information in the url
+    of cached bundles."""
+    return url
+
+
+SUPPORTED_CLONEBUNDLE_SCHEMES = [
+    b"http://",
+    b"https://",
+    b"largefile://",
+    CLONEBUNDLESCHEME,
+]
 
 
 @attr.s
 class bundlespec:
     compression = attr.ib()
     wirecompression = attr.ib()
     version = attr.ib()
@@ -51,19 +85,26 @@
     def set_param(self, key, value, overwrite=True):
         """Set a bundle parameter value.
 
         Will only overwrite if overwrite is true"""
         if overwrite or key not in self._explicit_params:
             self._explicit_params[key] = value
 
+    def as_spec(self):
+        parts = [b"%s-%s" % (self.compression, self.version)]
+        for param in sorted(self._explicit_params.items()):
+            parts.append(b'%s=%s' % param)
+        return b';'.join(parts)
+
 
 # Maps bundle version human names to changegroup versions.
 _bundlespeccgversions = {
     b'v1': b'01',
     b'v2': b'02',
+    b'v3': b'03',
     b'packed1': b's1',
     b'bundle2': b'02',  # legacy
 }
 
 # Maps bundle version with content opts to choose which part to bundle
 _bundlespeccontentopts = {
     b'v1': {
@@ -78,23 +119,40 @@
         b'changegroup': True,
         b'cg.version': b'02',
         b'obsolescence': False,
         b'phases': False,
         b'tagsfnodescache': True,
         b'revbranchcache': True,
     },
+    b'v3': {
+        b'changegroup': True,
+        b'cg.version': b'03',
+        b'obsolescence': False,
+        b'phases': True,
+        b'tagsfnodescache': True,
+        b'revbranchcache': True,
+    },
     b'streamv2': {
         b'changegroup': False,
         b'cg.version': b'02',
         b'obsolescence': False,
         b'phases': False,
         b"streamv2": True,
         b'tagsfnodescache': False,
         b'revbranchcache': False,
     },
+    b'streamv3-exp': {
+        b'changegroup': False,
+        b'cg.version': b'03',
+        b'obsolescence': False,
+        b'phases': False,
+        b"streamv3-exp": True,
+        b'tagsfnodescache': False,
+        b'revbranchcache': False,
+    },
     b'packed1': {
         b'cg.version': b's1',
     },
     b'bundle2': {  # legacy
         b'cg.version': b'02',
     },
 }
@@ -256,27 +314,27 @@
         if missingreqs:
             raise error.UnsupportedBundleSpecification(
                 _(b'missing support for repository features: %s')
                 % b', '.join(sorted(missingreqs))
             )
 
     # Compute contentopts based on the version
-    if b"stream" in params and params[b"stream"] == b"v2":
-        # That case is fishy as this mostly derails the version selection
+    if b"stream" in params:
+        # This case is fishy as this mostly derails the version selection
         # mechanism. `stream` bundles are quite specific and used differently
         # as "normal" bundles.
         #
-        # So we are pinning this to "v2", as this will likely be
-        # compatible forever. (see the next conditional).
-        #
         # (we should probably define a cleaner way to do this and raise a
-        # warning when the old way is encounter)
-        version = b"streamv2"
+        # warning when the old way is encountered)
+        if params[b"stream"] == b"v2":
+            version = b"streamv2"
+        if params[b"stream"] == b"v3-exp":
+            version = b"streamv3-exp"
     contentopts = _bundlespeccontentopts.get(version, {}).copy()
-    if version == b"streamv2":
+    if version == b"streamv2" or version == b"streamv3-exp":
         # streamv2 have been reported as "v2" for a while.
         version = b"v2"
 
     engine = util.compengines.forbundlename(compression)
     compression, wirecompression = engine.bundletype()
     wireversion = _bundlespeccontentopts[version][b'cg.version']
 
@@ -326,85 +384,96 @@
     if bundlespec.wirecompression == b'UN' and bundlespec.wireversion == b's1':
         return True
 
     # Stream clone v2
     if (
         bundlespec.wirecompression == b'UN'
         and bundlespec.wireversion == b'02'
-        and bundlespec.contentopts.get(b'streamv2')
+        and (
+            bundlespec.contentopts.get(b'streamv2')
+            or bundlespec.contentopts.get(b'streamv3-exp')
+        )
     ):
         return True
 
     return False
 
 
-def filterclonebundleentries(repo, entries, streamclonerequested=False):
+def filterclonebundleentries(
+    repo, entries, streamclonerequested=False, pullbundles=False
+):
     """Remove incompatible clone bundle manifest entries.
 
     Accepts a list of entries parsed with ``parseclonebundlesmanifest``
     and returns a new list consisting of only the entries that this client
     should be able to apply.
 
     There is no guarantee we'll be able to apply all returned entries because
     the metadata we use to filter on may be missing or wrong.
     """
     newentries = []
     for entry in entries:
+        url = entry.get(b'URL')
+        if not pullbundles and not any(
+            [url.startswith(scheme) for scheme in SUPPORTED_CLONEBUNDLE_SCHEMES]
+        ):
+            repo.ui.debug(
+                b'filtering %s because not a supported clonebundle scheme\n'
+                % url
+            )
+            continue
+
         spec = entry.get(b'BUNDLESPEC')
         if spec:
             try:
                 bundlespec = parsebundlespec(repo, spec, strict=True)
 
                 # If a stream clone was requested, filter out non-streamclone
                 # entries.
                 if streamclonerequested and not isstreamclonespec(bundlespec):
                     repo.ui.debug(
-                        b'filtering %s because not a stream clone\n'
-                        % entry[b'URL']
+                        b'filtering %s because not a stream clone\n' % url
                     )
                     continue
 
             except error.InvalidBundleSpecification as e:
                 repo.ui.debug(stringutil.forcebytestr(e) + b'\n')
                 continue
             except error.UnsupportedBundleSpecification as e:
                 repo.ui.debug(
                     b'filtering %s because unsupported bundle '
-                    b'spec: %s\n' % (entry[b'URL'], stringutil.forcebytestr(e))
+                    b'spec: %s\n' % (url, stringutil.forcebytestr(e))
                 )
                 continue
         # If we don't have a spec and requested a stream clone, we don't know
         # what the entry is so don't attempt to apply it.
         elif streamclonerequested:
             repo.ui.debug(
                 b'filtering %s because cannot determine if a stream '
-                b'clone bundle\n' % entry[b'URL']
+                b'clone bundle\n' % url
             )
             continue
 
         if b'REQUIRESNI' in entry and not sslutil.hassni:
-            repo.ui.debug(
-                b'filtering %s because SNI not supported\n' % entry[b'URL']
-            )
+            repo.ui.debug(b'filtering %s because SNI not supported\n' % url)
             continue
 
         if b'REQUIREDRAM' in entry:
             try:
                 requiredram = util.sizetoint(entry[b'REQUIREDRAM'])
             except error.ParseError:
                 repo.ui.debug(
-                    b'filtering %s due to a bad REQUIREDRAM attribute\n'
-                    % entry[b'URL']
+                    b'filtering %s due to a bad REQUIREDRAM attribute\n' % url
                 )
                 continue
             actualram = repo.ui.estimatememory()
             if actualram is not None and actualram * 0.66 < requiredram:
                 repo.ui.debug(
                     b'filtering %s as it needs more than 2/3 of system memory\n'
-                    % entry[b'URL']
+                    % url
                 )
                 continue
 
         newentries.append(entry)
 
     return newentries
```

### Comparing `mercurial-6.4rc0/mercurial/bundlerepo.py` & `mercurial-6.5rc0/mercurial/bundlerepo.py`

 * *Files 1% similar despite different names*

```diff
@@ -480,16 +480,16 @@
             self.vfs.unlink(self.tempfile)
         if self._tempparent:
             shutil.rmtree(self._tempparent, True)
 
     def cancopy(self):
         return False
 
-    def peer(self, path=None):
-        return bundlepeer(self, path=path)
+    def peer(self, path=None, remotehidden=False):
+        return bundlepeer(self, path=path, remotehidden=remotehidden)
 
     def getcwd(self):
         return encoding.getcwd()  # always outside the repo
 
     # Check if parents exist in localrepo before setting
     def setparents(self, p1, p2=None):
         if p2 is None:
```

### Comparing `mercurial-6.4rc0/mercurial/cacheutil.py` & `mercurial-6.5rc0/mercurial/cacheutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/base85.c` & `mercurial-6.5rc0/mercurial/cext/base85.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/bdiff.c` & `mercurial-6.5rc0/mercurial/cext/bdiff.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/charencode.c` & `mercurial-6.5rc0/mercurial/cext/charencode.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/charencode.h` & `mercurial-6.5rc0/mercurial/cext/charencode.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/dirs.c` & `mercurial-6.5rc0/mercurial/cext/dirs.c`

 * *Files 2% similar despite different names*

```diff
@@ -9,15 +9,19 @@
 
 #define PY_SSIZE_T_CLEAN
 #include <Python.h>
 #include <string.h>
 
 #include "util.h"
 
+#if PY_VERSION_HEX >= 0x030C00A5
+#define PYLONG_VALUE(o) ((PyLongObject *)o)->long_value.ob_digit[0]
+#else
 #define PYLONG_VALUE(o) ((PyLongObject *)o)->ob_digit[0]
+#endif
 
 /*
  * This is a multiset of directory names, built from the files that
  * appear in a dirstate or manifest.
  *
  * A few implementation notes:
  *
```

### Comparing `mercurial-6.4rc0/mercurial/cext/manifest.c` & `mercurial-6.5rc0/mercurial/cext/manifest.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/mpatch.c` & `mercurial-6.5rc0/mercurial/cext/mpatch.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/osutil.c` & `mercurial-6.5rc0/mercurial/cext/osutil.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/osutil.pyi` & `mercurial-6.5rc0/mercurial/cext/osutil.pyi`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/parsers.c` & `mercurial-6.5rc0/mercurial/cext/parsers.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/parsers.pyi` & `mercurial-6.5rc0/mercurial/cext/parsers.pyi`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/pathencode.c` & `mercurial-6.5rc0/mercurial/cext/pathencode.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/revlog.c` & `mercurial-6.5rc0/mercurial/cext/revlog.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cext/util.h` & `mercurial-6.5rc0/mercurial/cext/util.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cffi/bdiff.py` & `mercurial-6.5rc0/mercurial/cffi/bdiff.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cffi/bdiffbuild.py` & `mercurial-6.5rc0/mercurial/cffi/bdiffbuild.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cffi/mpatch.py` & `mercurial-6.5rc0/mercurial/cffi/mpatch.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cffi/mpatchbuild.py` & `mercurial-6.5rc0/mercurial/cffi/mpatchbuild.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cffi/osutil.py` & `mercurial-6.5rc0/mercurial/cffi/osutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/cffi/osutilbuild.py` & `mercurial-6.5rc0/mercurial/cffi/osutilbuild.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/changegroup.py` & `mercurial-6.5rc0/mercurial/changegroup.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/changelog.py` & `mercurial-6.5rc0/mercurial/changelog.py`

 * *Files 1% similar despite different names*

```diff
@@ -477,15 +477,15 @@
         elif self._delaybuf:
             fp = self.opener(self._indexfile, b'a', checkambig=True)
             fp.write(b"".join(self._delaybuf))
             fp.close()
             self._delaybuf = None
         self._divert = False
         # split when we're done
-        self._enforceinlinesize(tr)
+        self._enforceinlinesize(tr, side_write=False)
 
     def _writepending(self, tr):
         """create a file containing the unfinalized state for
         pretxnchangegroup"""
         if self._docket:
             return self._docket.write(tr, pending=True)
         if self._delaybuf:
@@ -508,17 +508,17 @@
             self._segmentfile_sidedata.opener = self.opener
 
         if self._divert:
             return True
 
         return False
 
-    def _enforceinlinesize(self, tr):
+    def _enforceinlinesize(self, tr, side_write=True):
         if not self._delayed:
-            revlog.revlog._enforceinlinesize(self, tr)
+            revlog.revlog._enforceinlinesize(self, tr, side_write=side_write)
 
     def read(self, nodeorrev):
         """Obtain data from a parsed changelog revision.
 
         Returns a 6-tuple of:
 
            - manifest node in binary
```

### Comparing `mercurial-6.4rc0/mercurial/chgserver.py` & `mercurial-6.5rc0/mercurial/chgserver.py`

 * *Files 1% similar despite different names*

```diff
@@ -232,15 +232,15 @@
             # fallback to the original system method if
             #  a. the output stream is not stdout (e.g. stderr, cStringIO),
             #  b. or stdout is redirected by protectfinout(),
             # because the chg client is not aware of these situations and
             # will behave differently (i.e. write to stdout).
             if (
                 out is not self.fout
-                or not util.safehasattr(self.fout, b'fileno')
+                or not util.safehasattr(self.fout, 'fileno')
                 or self.fout.fileno() != procutil.stdout.fileno()
                 or self._finoutredirected
             ):
                 return procutil.system(cmd, environ=environ, cwd=cwd, out=out)
             self.flush()
             return self._csystem(cmd, procutil.shellenviron(environ), cwd)
 
@@ -258,15 +258,15 @@
 
 def _loadnewui(srcui, args, cdebug):
     from . import dispatch  # avoid cycle
 
     newui = srcui.__class__.load()
     for a in [b'fin', b'fout', b'ferr', b'environ']:
         setattr(newui, a, getattr(srcui, a))
-    if util.safehasattr(srcui, b'_csystem'):
+    if util.safehasattr(srcui, '_csystem'):
         newui._csystem = srcui._csystem
 
     # command line args
     options = dispatch._earlyparseopts(newui, args)
     dispatch._parseconfig(newui, options[b'config'])
 
     # stolen from tortoisehg.util.copydynamicconfig()
@@ -599,15 +599,15 @@
             b'runcommand': runcommand,
             b'setenv': setenv,
             b'setumask': setumask,
             b'setumask2': setumask2,
         }
     )
 
-    if util.safehasattr(procutil, b'setprocname'):
+    if util.safehasattr(procutil, 'setprocname'):
 
         def setprocname(self):
             """Change process title"""
             name = self._readstr()
             self.ui.log(b'chgserver', b'setprocname: %r\n', name)
             procutil.setprocname(name)
```

### Comparing `mercurial-6.4rc0/mercurial/cmdutil.py` & `mercurial-6.5rc0/mercurial/cmdutil.py`

 * *Files 0% similar despite different names*

```diff
@@ -1446,15 +1446,15 @@
                 r = filelog
 
         # Not all storage may be revlogs. If requested, try to return an actual
         # revlog instance.
         if returnrevlog:
             if isinstance(r, revlog.revlog):
                 pass
-            elif util.safehasattr(r, b'_revlog'):
+            elif util.safehasattr(r, '_revlog'):
                 r = r._revlog  # pytype: disable=attribute-error
             elif r is not None:
                 raise error.InputError(
                     _(b'%r does not appear to be a revlog') % r
                 )
 
     if not r:
@@ -2750,29 +2750,28 @@
     fm.context(ctx=ctx)
     fm.write(b'data', b'%s', data)
     fm.data(path=path)
 
 
 def cat(ui, repo, ctx, matcher, basefm, fntemplate, prefix, **opts):
     err = 1
-    opts = pycompat.byteskwargs(opts)
 
     def write(path):
         filename = None
         if fntemplate:
             filename = makefilename(
                 ctx, fntemplate, pathname=os.path.join(prefix, path)
             )
             # attempt to create the directory if it does not already exist
             try:
                 os.makedirs(os.path.dirname(filename))
             except OSError:
                 pass
         with formatter.maybereopen(basefm, filename) as fm:
-            _updatecatformatter(fm, ctx, matcher, path, opts.get(b'decode'))
+            _updatecatformatter(fm, ctx, matcher, path, opts.get('decode'))
 
     # Automation often uses hg cat on single files, so special case it
     # for performance to avoid the cost of parsing the manifest.
     if len(matcher.files()) == 1 and not matcher.anypats():
         file = matcher.files()[0]
         mfl = repo.manifestlog
         mfnode = ctx.manifestnode()
@@ -2799,15 +2798,15 @@
             submatch = matchmod.subdirmatcher(subpath, matcher)
             subprefix = os.path.join(prefix, subpath)
             if not sub.cat(
                 submatch,
                 basefm,
                 fntemplate,
                 subprefix,
-                **pycompat.strkwargs(opts),
+                **opts,
             ):
                 err = 0
         except error.RepoLookupError:
             ui.status(
                 _(b"skipping missing subrepository: %s\n") % uipathfn(subpath)
             )
```

### Comparing `mercurial-6.4rc0/mercurial/color.py` & `mercurial-6.5rc0/mercurial/color.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/commands.py` & `mercurial-6.5rc0/mercurial/commands.py`

 * *Files 0% similar despite different names*

```diff
@@ -65,14 +65,15 @@
     util,
     verify as verifymod,
     vfs as vfsmod,
     wireprotoserver,
 )
 from .utils import (
     dateutil,
+    procutil,
     stringutil,
     urlutil,
 )
 
 table = {}
 table.update(debugcommandsmod.command._table)
 
@@ -1661,14 +1662,22 @@
             missing.update(outgoing.missing)
             excluded.update(outgoing.excluded)
 
     if not missing:
         scmutil.nochangesfound(ui, repo, not base and excluded)
         return 1
 
+    # internal changeset are internal implementation details that should not
+    # leave the repository. Bundling with `hg bundle` create such risk.
+    bundled_internal = repo.revs(b"%ln and _internal()", missing)
+    if bundled_internal:
+        msg = _(b"cannot bundle internal changesets")
+        hint = _(b"%d internal changesets selected") % len(bundled_internal)
+        raise error.Abort(msg, hint=hint)
+
     if heads:
         outgoing = discovery.outgoing(
             repo, missingroots=missing, ancestorsof=heads
         )
     else:
         outgoing = discovery.outgoing(repo, missingroots=missing)
     outgoing.excluded = sorted(excluded)
@@ -1710,16 +1719,17 @@
     cfg = ui.configbool
     obsolescence_cfg = cfg(b'experimental', b'evolution.bundle-obsmarker')
     bundlespec.set_param(b'obsolescence', obsolescence_cfg, overwrite=False)
     obs_mand_cfg = cfg(b'experimental', b'evolution.bundle-obsmarker:mandatory')
     bundlespec.set_param(
         b'obsolescence-mandatory', obs_mand_cfg, overwrite=False
     )
-    phases_cfg = cfg(b'experimental', b'bundle-phases')
-    bundlespec.set_param(b'phases', phases_cfg, overwrite=False)
+    if not bundlespec.params.get(b'phases', False):
+        phases_cfg = cfg(b'experimental', b'bundle-phases')
+        bundlespec.set_param(b'phases', phases_cfg, overwrite=False)
 
     bundle2.writenewbundle(
         ui,
         repo,
         b'bundle',
         fname,
         bversion,
@@ -2494,15 +2504,15 @@
 
     This command takes effect with the next commit by default.
 
     Returns 0 on success, 1 if errors are encountered.
     """
     opts = pycompat.byteskwargs(opts)
 
-    context = repo.dirstate.changing_files
+    context = lambda repo: repo.dirstate.changing_files(repo)
     rev = opts.get(b'at_rev')
     ctx = None
     if rev:
         ctx = logcmdutil.revsingle(repo, rev)
         if ctx.rev() is not None:
 
             def context(repo):
@@ -3525,41 +3535,39 @@
 
       See :hg:`help templates.operators` for the list expansion syntax.
 
     Returns 0 if a match is found, 1 otherwise.
 
     """
     cmdutil.check_incompatible_arguments(opts, 'all_files', ['all', 'diff'])
-    opts = pycompat.byteskwargs(opts)
-    diff = opts.get(b'all') or opts.get(b'diff')
-    follow = opts.get(b'follow')
-    if opts.get(b'all_files') is None and not diff:
-        opts[b'all_files'] = True
+
+    diff = opts.get('all') or opts.get('diff')
+    follow = opts.get('follow')
+    if opts.get('all_files') is None and not diff:
+        opts['all_files'] = True
     plaingrep = (
-        opts.get(b'all_files')
-        and not opts.get(b'rev')
-        and not opts.get(b'follow')
+        opts.get('all_files') and not opts.get('rev') and not opts.get('follow')
     )
-    all_files = opts.get(b'all_files')
+    all_files = opts.get('all_files')
     if plaingrep:
-        opts[b'rev'] = [b'wdir()']
+        opts['rev'] = [b'wdir()']
 
     reflags = re.M
-    if opts.get(b'ignore_case'):
+    if opts.get('ignore_case'):
         reflags |= re.I
     try:
         regexp = util.re.compile(pattern, reflags)
     except re.error as inst:
         ui.warn(
             _(b"grep: invalid match pattern: %s\n")
             % stringutil.forcebytestr(inst)
         )
         return 1
     sep, eol = b':', b'\n'
-    if opts.get(b'print0'):
+    if opts.get('print0'):
         sep = eol = b'\0'
 
     searcher = grepmod.grepsearcher(
         ui, repo, regexp, all_files=all_files, diff=diff, follow=follow
     )
 
     getfile = searcher._getfile
@@ -3599,15 +3607,15 @@
 
             cols = [
                 (b'rev', b'%d', rev, not plaingrep, b''),
                 (
                     b'linenumber',
                     b'%d',
                     l.linenum,
-                    opts.get(b'line_number'),
+                    opts.get('line_number'),
                     b'',
                 ),
             ]
             if diff:
                 cols.append(
                     (
                         b'change',
@@ -3621,41 +3629,41 @@
                 )
             cols.extend(
                 [
                     (
                         b'user',
                         b'%s',
                         formatuser(ctx.user()),
-                        opts.get(b'user'),
+                        opts.get('user'),
                         b'',
                     ),
                     (
                         b'date',
                         b'%s',
                         fm.formatdate(ctx.date(), datefmt),
-                        opts.get(b'date'),
+                        opts.get('date'),
                         b'',
                     ),
                 ]
             )
             for name, fmt, data, cond, extra_label in cols:
                 if cond:
                     fm.plain(sep, label=b'grep.sep')
                 field = fieldnamemap.get(name, name)
                 label = extra_label + (b'grep.%s' % name)
                 fm.condwrite(cond, field, fmt, data, label=label)
-            if not opts.get(b'files_with_matches'):
+            if not opts.get('files_with_matches'):
                 fm.plain(sep, label=b'grep.sep')
-                if not opts.get(b'text') and binary():
+                if not opts.get('text') and binary():
                     fm.plain(_(b" Binary file matches"))
                 else:
                     displaymatches(fm.nested(b'texts', tmpl=b'{text}'), l)
             fm.plain(eol)
             found = True
-            if opts.get(b'files_with_matches'):
+            if opts.get('files_with_matches'):
                 break
         return found
 
     def displaymatches(fm, l):
         p = 0
         for s, e in l.findpos(regexp):
             if p < s:
@@ -3673,25 +3681,25 @@
         fm.end()
 
     found = False
 
     wopts = logcmdutil.walkopts(
         pats=pats,
         opts=opts,
-        revspec=opts[b'rev'],
-        include_pats=opts[b'include'],
-        exclude_pats=opts[b'exclude'],
+        revspec=opts['rev'],
+        include_pats=opts['include'],
+        exclude_pats=opts['exclude'],
         follow=follow,
         force_changelog_traversal=all_files,
         filter_revisions_by_pats=not all_files,
     )
     revs, makefilematcher = logcmdutil.makewalker(repo, wopts)
 
     ui.pager(b'grep')
-    fm = ui.formatter(b'grep', opts)
+    fm = ui.formatter(b'grep', pycompat.byteskwargs(opts))
     for fn, ctx, pstates, states in searcher.searchfiles(revs, makefilematcher):
         r = display(fm, fn, ctx, pstates, states)
         found = found or r
         if r and not diff and not all_files:
             searcher.skipfile(fn, ctx.rev())
     fm.end()
 
@@ -5210,19 +5218,16 @@
         fm.startitem()
         fm.condwrite(not search, b'name', namefmt, name)
         fm.condwrite(not ui.quiet, b'url', b'%s\n', hidepassword(path.rawloc))
         for subopt, value in sorted(path.suboptions.items()):
             assert subopt not in (b'name', b'url')
             if showsubopts:
                 fm.plain(b'%s:%s = ' % (name, subopt))
-            if isinstance(value, bool):
-                if value:
-                    value = b'yes'
-                else:
-                    value = b'no'
+            display = urlutil.path_suboptions_display[subopt]
+            value = display(value)
             fm.condwrite(showsubopts, subopt, b'%s\n', value)
 
     fm.end()
 
     if search and not pathitems:
         if not ui.quiet:
             ui.warn(_(b"not found!\n"))
@@ -5394,14 +5399,20 @@
         (
             b'b',
             b'branch',
             [],
             _(b'a specific branch you would like to pull'),
             _(b'BRANCH'),
         ),
+        (
+            b'',
+            b'remote-hidden',
+            False,
+            _(b"include changesets hidden on the remote (EXPERIMENTAL)"),
+        ),
     ]
     + remoteopts,
     _(b'[-u] [-f] [-r REV]... [-e CMD] [--remotecmd CMD] [SOURCE]...'),
     helpcategory=command.CATEGORY_REMOTE_REPO_MANAGEMENT,
     helpbasic=True,
 )
 def pull(ui, repo, *sources, **opts):
@@ -5431,34 +5442,46 @@
     If multiple sources are specified, they will be pulled sequentially as if
     the command was run multiple time. If --update is specify and the command
     will stop at the first failed --update.
 
     Specifying bookmark as ``.`` is equivalent to specifying the active
     bookmark's name.
 
+    .. container:: verbose
+
+        One can use the `--remote-hidden` flag to pull changesets
+        hidden on the remote. This flag is "best effort", and will only
+        work if the server supports the feature and is configured to
+        allow the user to access hidden changesets. This option is
+        experimental and backwards compatibility is not garanteed.
+
     Returns 0 on success, 1 if an update had unresolved files.
     """
 
     opts = pycompat.byteskwargs(opts)
     if ui.configbool(b'commands', b'update.requiredest') and opts.get(
         b'update'
     ):
         msg = _(b'update destination required by configuration')
         hint = _(b'use hg pull followed by hg update DEST')
         raise error.InputError(msg, hint=hint)
 
     for path in urlutil.get_pull_paths(repo, ui, sources):
         ui.status(_(b'pulling from %s\n') % urlutil.hidepassword(path.loc))
         ui.flush()
-        other = hg.peer(repo, opts, path)
+        other = hg.peer(repo, opts, path, remotehidden=opts[b'remote_hidden'])
         update_conflict = None
         try:
             branches = (path.branch, opts.get(b'branch', []))
             revs, checkout = hg.addbranchrevs(
-                repo, other, branches, opts.get(b'rev')
+                repo,
+                other,
+                branches,
+                opts.get(b'rev'),
+                remotehidden=opts[b'remote_hidden'],
             )
 
             pullopargs = {}
 
             nodes = None
             if opts.get(b'bookmark') or revs:
                 # The list of bookmark used here is the same used to actually update
@@ -6008,15 +6031,15 @@
     the same way as :hg:`copy --forget`.
 
     This command takes effect with the next commit by default.
 
     Returns 0 on success, 1 if errors are encountered.
     """
     opts = pycompat.byteskwargs(opts)
-    context = repo.dirstate.changing_files
+    context = lambda repo: repo.dirstate.changing_files(repo)
     rev = opts.get(b'at_rev')
     ctx = None
     if rev:
         ctx = logcmdutil.revsingle(repo, rev)
         if ctx.rev() is not None:
 
             def context(repo):
@@ -6598,15 +6621,15 @@
             b'cmdserver',
             b'',
             _(b'for remote clients (ADVANCED)'),
             _(b'MODE'),
         ),
         (b't', b'templates', b'', _(b'web templates to use'), _(b'TEMPLATE')),
         (b'', b'style', b'', _(b'template style to use'), _(b'STYLE')),
-        (b'6', b'ipv6', None, _(b'use IPv6 in addition to IPv4')),
+        (b'6', b'ipv6', None, _(b'use IPv6 instead of IPv4')),
         (b'', b'certificate', b'', _(b'SSL certificate file'), _(b'FILE')),
         (b'', b'print-url', None, _(b'start and print only the URL')),
     ]
     + subrepoopts,
     _(b'[OPTION]...'),
     helpcategory=command.CATEGORY_REMOTE_REPO_MANAGEMENT,
     helpbasic=True,
@@ -6643,15 +6666,33 @@
         raise error.InputError(_(b"cannot use --print-url with --verbose"))
 
     if opts[b"stdio"]:
         if repo is None:
             raise error.RepoError(
                 _(b"there is no Mercurial repository here (.hg not found)")
             )
-        s = wireprotoserver.sshserver(ui, repo)
+        accesshidden = False
+        if repo.filtername is None:
+            allow = ui.configlist(
+                b'experimental', b'server.allow-hidden-access'
+            )
+            user = procutil.getuser()
+            if allow and scmutil.ismember(ui, user, allow):
+                accesshidden = True
+            else:
+                msg = (
+                    _(
+                        b'ignoring request to access hidden changeset by '
+                        b'unauthorized user: %s\n'
+                    )
+                    % user
+                )
+                ui.warn(msg)
+
+        s = wireprotoserver.sshserver(ui, repo, accesshidden=accesshidden)
         s.serve_forever()
         return
 
     service = server.createservice(ui, repo, opts)
     return server.runservice(opts, initfn=service.init, runfn=service.run)
```

### Comparing `mercurial-6.4rc0/mercurial/commandserver.py` & `mercurial-6.5rc0/mercurial/commandserver.py`

 * *Files 0% similar despite different names*

```diff
@@ -328,15 +328,15 @@
             self.repo.invalidateall()
 
         for ui in uis:
             ui.resetstate()
             # any kind of interaction must use server channels, but chg may
             # replace channels by fully functional tty files. so nontty is
             # enforced only if cin is a channel.
-            if not util.safehasattr(self.cin, b'fileno'):
+            if not util.safehasattr(self.cin, 'fileno'):
                 ui.setconfig(b'ui', b'nontty', b'true', b'commandserver')
 
         req = dispatch.request(
             args[:],
             copiedui,
             self.repo,
             self.cin,
@@ -380,15 +380,15 @@
         hellomsg = b'capabilities: ' + b' '.join(sorted(self.capabilities))
         hellomsg += b'\n'
         hellomsg += b'encoding: ' + encoding.encoding
         hellomsg += b'\n'
         if self.cmsg:
             hellomsg += b'message-encoding: %s\n' % self.cmsg.encoding
         hellomsg += b'pid: %d' % procutil.getpid()
-        if util.safehasattr(os, b'getpgid'):
+        if util.safehasattr(os, 'getpgid'):
             hellomsg += b'\n'
             hellomsg += b'pgid: %d' % os.getpgid(0)
 
         # write the hello msg in -one- chunk
         self.cout.write(hellomsg)
 
         try:
@@ -555,15 +555,15 @@
     Listens on unix domain socket and forks server per connection
     """
 
     def __init__(self, ui, repo, opts, handler=None):
         self.ui = ui
         self.repo = repo
         self.address = opts[b'address']
-        if not util.safehasattr(socket, b'AF_UNIX'):
+        if not util.safehasattr(socket, 'AF_UNIX'):
             raise error.Abort(_(b'unsupported platform'))
         if not self.address:
             raise error.Abort(_(b'no socket path specified with --address'))
         self._servicehandler = handler or unixservicehandler(ui)
         self._sock = None
         self._mainipc = None
         self._workeripc = None
@@ -584,15 +584,15 @@
         self._sock = socket.socket(socket.AF_UNIX)
         # IPC channel from many workers to one main process; this is actually
         # a uni-directional pipe, but is backed by a DGRAM socket so each
         # message can be easily separated.
         o = socket.socketpair(socket.AF_UNIX, socket.SOCK_DGRAM)
         self._mainipc, self._workeripc = o
         self._servicehandler.bindsocket(self._sock, self.address)
-        if util.safehasattr(procutil, b'unblocksignal'):
+        if util.safehasattr(procutil, 'unblocksignal'):
             procutil.unblocksignal(signal.SIGCHLD)
         o = signal.signal(signal.SIGCHLD, self._sigchldhandler)
         self._oldsigchldhandler = o
         self._socketunlinked = False
         self._repoloader.start()
 
     def _unlinksocket(self):
```

### Comparing `mercurial-6.4rc0/mercurial/commit.py` & `mercurial-6.5rc0/mercurial/commit.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/compat.h` & `mercurial-6.5rc0/mercurial/compat.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/config.py` & `mercurial-6.5rc0/mercurial/config.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/configitems.py` & `mercurial-6.5rc0/mercurial/configitems.py`

 * *Files 1% similar despite different names*

```diff
@@ -612,14 +612,18 @@
     default=False,
 )
 coreconfigitem(
     b'devel',
     b'bundle2.debug',
     default=False,
 )
+# which kind of delta to put in the bundled changegroup. Possible value
+# - '': use default behavior
+# - p1: force to always use delta against p1
+# - full: force to always use full content
 coreconfigitem(
     b'devel',
     b'bundle.delta',
     default=b'',
 )
 coreconfigitem(
     b'devel',
@@ -684,17 +688,19 @@
     default=False,
 )
 coreconfigitem(
     b'devel',
     b'servercafile',
     default=b'',
 )
+# This config option is intended for use in tests only. It is a giant
+# footgun to kill security. Don't define it.
 coreconfigitem(
     b'devel',
-    b'serverexactprotocol',
+    b'server-insecure-exact-protocol',
     default=b'',
 )
 coreconfigitem(
     b'devel',
     b'serverrequirecert',
     default=False,
 )
@@ -965,15 +971,15 @@
     b'experimental',
     b'bundlecompthreads.zstd',
     default=None,
 )
 coreconfigitem(
     b'experimental',
     b'changegroup3',
-    default=False,
+    default=True,
 )
 coreconfigitem(
     b'experimental',
     b'changegroup4',
     default=False,
 )
 
@@ -1238,14 +1244,19 @@
 coreconfigitem(
     b'experimental',
     b'rust.index',
     default=False,
 )
 coreconfigitem(
     b'experimental',
+    b'server.allow-hidden-access',
+    default=list,
+)
+coreconfigitem(
+    b'experimental',
     b'server.filesdata.recommended-batch-size',
     default=50000,
 )
 coreconfigitem(
     b'experimental',
     b'server.manifestdata.recommended-batch-size',
     default=100000,
@@ -1283,14 +1294,19 @@
 coreconfigitem(
     b'experimental',
     b'sparse-read.min-gap-size',
     default=b'65K',
 )
 coreconfigitem(
     b'experimental',
+    b'stream-v3',
+    default=False,
+)
+coreconfigitem(
+    b'experimental',
     b'treemanifest',
     default=False,
 )
 coreconfigitem(
     b'experimental',
     b'update.atomic-file',
     default=False,
```

### Comparing `mercurial-6.4rc0/mercurial/context.py` & `mercurial-6.5rc0/mercurial/context.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/copies.py` & `mercurial-6.5rc0/mercurial/copies.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/crecord.py` & `mercurial-6.5rc0/mercurial/crecord.py`

 * *Files 0% similar despite different names*

```diff
@@ -569,15 +569,15 @@
     """
     curses interface to get selection of chunks, and mark the applied flags
     of the chosen chunks.
     """
     ui.write(_(b'starting interactive selection\n'))
     chunkselector = curseschunkselector(headerlist, ui, operation)
     origsigtstp = sentinel = object()
-    if util.safehasattr(signal, b'SIGTSTP'):
+    if util.safehasattr(signal, 'SIGTSTP'):
         origsigtstp = signal.getsignal(signal.SIGTSTP)
     try:
         with util.with_lc_ctype():
             curses.wrapper(chunkselector.main)
         if chunkselector.initexc is not None:
             raise chunkselector.initexc
         # ncurses does not restore signal handler for SIGTSTP
@@ -1940,15 +1940,15 @@
 
     def main(self, stdscr):
         """
         method to be wrapped by curses.wrapper() for selecting chunks.
         """
 
         origsigwinch = sentinel = object()
-        if util.safehasattr(signal, b'SIGWINCH'):
+        if util.safehasattr(signal, 'SIGWINCH'):
             origsigwinch = signal.signal(signal.SIGWINCH, self.sigwinchhandler)
         try:
             return self._main(stdscr)
         finally:
             if origsigwinch is not sentinel:
                 signal.signal(signal.SIGWINCH, origsigwinch)
 
@@ -1986,15 +1986,15 @@
         self.initcolorpair(curses.COLOR_RED, None, name=b"deletion")
         self.initcolorpair(curses.COLOR_GREEN, None, name=b"addition")
         self.initcolorpair(
             curses.COLOR_WHITE, curses.COLOR_BLUE, name=b"legend"
         )
         # newwin([height, width,] begin_y, begin_x)
         self.statuswin = curses.newwin(self.numstatuslines, 0, 0, 0)
-        self.statuswin.keypad(1)  # interpret arrow-key, etc. esc sequences
+        self.statuswin.keypad(True)  # interpret arrow-key, etc. esc sequences
 
         # figure out how much space to allocate for the chunk-pad which is
         # used for displaying the patch
 
         # stupid hack to prevent getnumlinesdisplayed from failing
         self.chunkpad = curses.newpad(1, self.xscreensize)
```

### Comparing `mercurial-6.4rc0/mercurial/dagop.py` & `mercurial-6.5rc0/mercurial/dagop.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/dagparser.py` & `mercurial-6.5rc0/mercurial/dagparser.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/debugcommands.py` & `mercurial-6.5rc0/mercurial/debugcommands.py`

 * *Files 1% similar despite different names*

```diff
@@ -46,22 +46,24 @@
     copies,
     dagparser,
     dirstateutils,
     encoding,
     error,
     exchange,
     extensions,
+    filelog,
     filemerge,
     filesetlang,
     formatter,
     hg,
     httppeer,
     localrepo,
     lock as lockmod,
     logcmdutil,
+    manifest,
     mergestate as mergestatemod,
     metadata,
     obsolete,
     obsutil,
     pathutil,
     phases,
     policy,
@@ -89,14 +91,15 @@
     util,
     verify,
     vfs as vfsmod,
     wireprotoframing,
     wireprotoserver,
 )
 from .interfaces import repository
+from .stabletailgraph import stabletailsort
 from .utils import (
     cborutil,
     compression,
     dateutil,
     procutil,
     stringutil,
     urlutil,
@@ -610,14 +613,18 @@
 
 @command(b'debugcreatestreamclonebundle', [], b'FILE')
 def debugcreatestreamclonebundle(ui, repo, fname):
     """create a stream clone bundle file
 
     Stream bundles are special bundles that are essentially archives of
     revlog files. They are commonly used for cloning very quickly.
+
+    This command creates a "version 1" stream clone, which is deprecated in
+    favor of newer versions of the stream protocol. Bundles using such newer
+     versions can be generated using the `hg bundle` command.
     """
     # TODO we may want to turn this into an abort when this functionality
     # is moved into `hg bundle`.
     if phases.hassecret(repo):
         ui.warn(
             _(
                 b'(warning: stream clone bundle will contain secret '
@@ -704,18 +711,20 @@
 
 @command(b'debugdata', cmdutil.debugrevlogopts, _(b'-c|-m|FILE REV'))
 def debugdata(ui, repo, file_, rev=None, **opts):
     """dump the contents of a data file revision"""
     opts = pycompat.byteskwargs(opts)
     if opts.get(b'changelog') or opts.get(b'manifest') or opts.get(b'dir'):
         if rev is not None:
-            raise error.CommandError(b'debugdata', _(b'invalid arguments'))
+            raise error.InputError(
+                _(b'cannot specify a revision with other arguments')
+            )
         file_, rev = None, file_
     elif rev is None:
-        raise error.CommandError(b'debugdata', _(b'invalid arguments'))
+        raise error.InputError(_(b'please specify a revision'))
     r = cmdutil.openstorage(repo, b'debugdata', file_, opts)
     try:
         ui.write(r.rawdata(r.lookup(rev)))
     except KeyError:
         raise error.Abort(_(b'invalid revision identifier %s') % rev)
 
 
@@ -799,19 +808,20 @@
     length = r.length
     generaldelta = r._generaldelta
     withsparseread = getattr(r, '_withsparseread', False)
 
     # security to avoid crash on corrupted revlogs
     total_revs = len(index)
 
+    chain_size_cache = {}
+
     def revinfo(rev):
         e = index[rev]
         compsize = e[revlog_constants.ENTRY_DATA_COMPRESSED_LENGTH]
         uncompsize = e[revlog_constants.ENTRY_DATA_UNCOMPRESSED_LENGTH]
-        chainsize = 0
 
         base = e[revlog_constants.ENTRY_DELTA_BASE]
         p1 = e[revlog_constants.ENTRY_PARENT_1]
         p2 = e[revlog_constants.ENTRY_PARENT_2]
 
         # If the parents of a revision has an empty delta, we never try to delta
         # against that parent, but directly against the delta base of that
@@ -866,19 +876,25 @@
         else:
             if base == rev:
                 deltatype = b'base'
             else:
                 deltatype = b'prev'
 
         chain = r._deltachain(rev)[0]
-        for iterrev in chain:
-            e = index[iterrev]
-            chainsize += e[revlog_constants.ENTRY_DATA_COMPRESSED_LENGTH]
+        chain_size = 0
+        for iter_rev in reversed(chain):
+            cached = chain_size_cache.get(iter_rev)
+            if cached is not None:
+                chain_size += cached
+                break
+            e = index[iter_rev]
+            chain_size += e[revlog_constants.ENTRY_DATA_COMPRESSED_LENGTH]
+        chain_size_cache[rev] = chain_size
 
-        return p1, p2, compsize, uncompsize, deltatype, chain, chainsize
+        return p1, p2, compsize, uncompsize, deltatype, chain, chain_size
 
     fm = ui.formatter(b'debugdeltachain', opts)
 
     fm.plain(
         b'    rev      p1      p2  chain# chainlen     prev   delta       '
         b'size    rawsize  chainsize     ratio   lindist extradist '
         b'extraratio'
@@ -1262,15 +1278,15 @@
         repoview.filtertable[b'debug-discovery-local-filter'] = local_func
         repo = repo.filtered(b'debug-discovery-local-filter')
 
     data = {}
     if opts.get(b'old'):
 
         def doit(pushedrevs, remoteheads, remote=remote):
-            if not util.safehasattr(remote, b'branches'):
+            if not util.safehasattr(remote, 'branches'):
                 # enable in-client legacy support
                 remote = localrepo.locallegacypeer(remote.local())
                 if remote_revs:
                     r = remote._repo.filtered(b'debug-discovery-remote-filter')
                     remote._repo = r
             common, _in, hds = treediscovery.findcommonincoming(
                 repo, remote, force=True, audit=data
@@ -1702,15 +1718,15 @@
     def makeformatname(name):
         return b'%s:' + (b' ' * (maxvariantlength - len(name)))
 
     fm = ui.formatter(b'debugformat', opts)
     if fm.isplain():
 
         def formatvalue(value):
-            if util.safehasattr(value, b'startswith'):
+            if util.safehasattr(value, 'startswith'):
                 return value
             if value:
                 return b'yes'
             else:
                 return b'no'
 
     else:
@@ -1829,15 +1845,15 @@
     }
     bundletype = btypes.get(bundletype)
     if bundletype not in bundle2.bundletypes:
         raise error.Abort(_(b'unknown bundle type specified with --type'))
     bundle2.writebundle(ui, bundle, bundlepath, bundletype)
 
 
-@command(b'debugignore', [], b'[FILE]')
+@command(b'debugignore', [], b'[FILE]...')
 def debugignore(ui, repo, *files, **opts):
     """display the combined ignore pattern and information about ignored files
 
     With no argument display the combined ignore pattern.
 
     Given space separated file names, shows if the given file is ignored and
     if so, show the ignore rule (file and line number) that matched it.
@@ -1891,15 +1907,15 @@
 def debugindex(ui, repo, file_=None, **opts):
     """dump index data for a revlog"""
     opts = pycompat.byteskwargs(opts)
     store = cmdutil.openstorage(repo, b'debugindex', file_, opts)
 
     fm = ui.formatter(b'debugindex', opts)
 
-    revlog = getattr(store, b'_revlog', store)
+    revlog = getattr(store, '_revlog', store)
 
     return revlog_debug.debug_index(
         ui,
         repo,
         formatter=fm,
         revlog=revlog,
         full_node=ui.debugflag,
@@ -1927,15 +1943,15 @@
 
 
 @command(b'debugindexstats', [])
 def debugindexstats(ui, repo):
     """show stats related to the changelog index"""
     repo.changelog.shortest(repo.nullid, 1)
     index = repo.changelog.index
-    if not util.safehasattr(index, b'stats'):
+    if not util.safehasattr(index, 'stats'):
         raise error.Abort(_(b'debugindexstats only works with native code'))
     for k, v in sorted(index.stats().items()):
         ui.write(b'%s: %d\n' % (k, v))
 
 
 @command(b'debuginstall', [] + cmdutil.formatteropts, b'', norepo=True)
 def debuginstall(ui, **opts):
@@ -2126,15 +2142,15 @@
             [e.name() for e in wirecompengines if e.wireprotosupport()],
             name=b'compengine',
             fmt=b'%s',
             sep=b', ',
         ),
     )
     re2 = b'missing'
-    if util._re2:
+    if util.has_re2():
         re2 = b'available'
     fm.plain(_(b'checking "re2" regexp engine (%s)\n') % re2)
     fm.data(re2=bool(util._re2))
 
     # templates
     p = templater.templatedir()
     fm.write(b'templatedirs', b'checking templates (%s)...\n', p or b'')
@@ -2588,64 +2604,72 @@
         completions.update(n for n in names if n.startswith(a))
     ui.write(b'\n'.join(sorted(completions)))
     ui.write(b'\n')
 
 
 @command(
     b'debugnodemap',
-    [
-        (
-            b'',
-            b'dump-new',
-            False,
-            _(b'write a (new) persistent binary nodemap on stdout'),
-        ),
-        (b'', b'dump-disk', False, _(b'dump on-disk data on stdout')),
-        (
-            b'',
-            b'check',
-            False,
-            _(b'check that the data on disk data are correct.'),
-        ),
-        (
-            b'',
-            b'metadata',
-            False,
-            _(b'display the on disk meta data for the nodemap'),
-        ),
-    ],
+    (
+        cmdutil.debugrevlogopts
+        + [
+            (
+                b'',
+                b'dump-new',
+                False,
+                _(b'write a (new) persistent binary nodemap on stdout'),
+            ),
+            (b'', b'dump-disk', False, _(b'dump on-disk data on stdout')),
+            (
+                b'',
+                b'check',
+                False,
+                _(b'check that the data on disk data are correct.'),
+            ),
+            (
+                b'',
+                b'metadata',
+                False,
+                _(b'display the on disk meta data for the nodemap'),
+            ),
+        ]
+    ),
+    _(b'-c|-m|FILE'),
 )
-def debugnodemap(ui, repo, **opts):
+def debugnodemap(ui, repo, file_=None, **opts):
     """write and inspect on disk nodemap"""
+    if opts.get('changelog') or opts.get('manifest') or opts.get('dir'):
+        if file_ is not None:
+            raise error.InputError(
+                _(b'cannot specify a file with other arguments')
+            )
+    elif file_ is None:
+        opts['changelog'] = True
+    r = cmdutil.openstorage(
+        repo.unfiltered(), b'debugnodemap', file_, pycompat.byteskwargs(opts)
+    )
+    if isinstance(r, (manifest.manifestrevlog, filelog.filelog)):
+        r = r._revlog
     if opts['dump_new']:
-        unfi = repo.unfiltered()
-        cl = unfi.changelog
-        if util.safehasattr(cl.index, "nodemap_data_all"):
-            data = cl.index.nodemap_data_all()
+        if util.safehasattr(r.index, "nodemap_data_all"):
+            data = r.index.nodemap_data_all()
         else:
-            data = nodemap.persistent_data(cl.index)
+            data = nodemap.persistent_data(r.index)
         ui.write(data)
     elif opts['dump_disk']:
-        unfi = repo.unfiltered()
-        cl = unfi.changelog
-        nm_data = nodemap.persisted_data(cl)
+        nm_data = nodemap.persisted_data(r)
         if nm_data is not None:
             docket, data = nm_data
             ui.write(data[:])
     elif opts['check']:
-        unfi = repo.unfiltered()
-        cl = unfi.changelog
-        nm_data = nodemap.persisted_data(cl)
+        nm_data = nodemap.persisted_data(r)
         if nm_data is not None:
             docket, data = nm_data
-            return nodemap.check_data(ui, cl.index, data)
+            return nodemap.check_data(ui, r.index, data)
     elif opts['metadata']:
-        unfi = repo.unfiltered()
-        cl = unfi.changelog
-        nm_data = nodemap.persisted_data(cl)
+        nm_data = nodemap.persisted_data(r)
         if nm_data is not None:
             docket, data = nm_data
             ui.write((b"uid: %s\n") % docket.uid)
             ui.write((b"tip-rev: %d\n") % docket.tip_rev)
             ui.write((b"tip-node: %s\n") % hex(docket.tip_node))
             ui.write((b"data-length: %d\n") % docket.data_length)
             ui.write((b"data-unused: %d\n") % docket.data_unused)
@@ -3541,18 +3565,20 @@
 def debugsidedata(ui, repo, file_, rev=None, **opts):
     """dump the side data for a cl/manifest/file revision
 
     Use --verbose to dump the sidedata content."""
     opts = pycompat.byteskwargs(opts)
     if opts.get(b'changelog') or opts.get(b'manifest') or opts.get(b'dir'):
         if rev is not None:
-            raise error.CommandError(b'debugdata', _(b'invalid arguments'))
+            raise error.InputError(
+                _(b'cannot specify a revision with other arguments')
+            )
         file_, rev = None, file_
     elif rev is None:
-        raise error.CommandError(b'debugdata', _(b'invalid arguments'))
+        raise error.InputError(_(b'please specify a revision'))
     r = cmdutil.openstorage(repo, b'debugdata', file_, opts)
     r = getattr(r, '_revlog', r)
     try:
         sidedata = r.sidedata(r.lookup(rev))
     except KeyError:
         raise error.Abort(_(b'invalid revision identifier %s') % rev)
     if sidedata:
@@ -3633,14 +3659,68 @@
         else:
             ui.status(_(b'full certificate chain is available\n'))
     finally:
         s.close()
 
 
 @command(
+    b'debug::stable-tail-sort',
+    [
+        (
+            b'T',
+            b'template',
+            b'{rev}\n',
+            _(b'display with template'),
+            _(b'TEMPLATE'),
+        ),
+    ],
+    b'REV',
+)
+def debug_stable_tail_sort(ui, repo, revspec, template, **opts):
+    """display the stable-tail sort of the ancestors of a given node"""
+    rev = logcmdutil.revsingle(repo, revspec).rev()
+    cl = repo.changelog
+
+    displayer = logcmdutil.maketemplater(ui, repo, template)
+    sorted_revs = stabletailsort._stable_tail_sort_naive(cl, rev)
+    for ancestor_rev in sorted_revs:
+        displayer.show(repo[ancestor_rev])
+
+
+@command(
+    b'debug::stable-tail-sort-leaps',
+    [
+        (
+            b'T',
+            b'template',
+            b'{rev}',
+            _(b'display with template'),
+            _(b'TEMPLATE'),
+        ),
+        (b's', b'specific', False, _(b'restrict to specific leaps')),
+    ],
+    b'REV',
+)
+def debug_stable_tail_sort_leaps(ui, repo, rspec, template, specific, **opts):
+    """display the leaps in the stable-tail sort of a node, one per line"""
+    rev = logcmdutil.revsingle(repo, rspec).rev()
+
+    if specific:
+        get_leaps = stabletailsort._find_specific_leaps_naive
+    else:
+        get_leaps = stabletailsort._find_all_leaps_naive
+
+    displayer = logcmdutil.maketemplater(ui, repo, template)
+    for source, target in get_leaps(repo.changelog, rev):
+        displayer.show(repo[source])
+        displayer.show(repo[target])
+        ui.write(b'\n')
+
+
+@command(
     b"debugbackupbundle",
     [
         (
             b"",
             b"recover",
             b"",
             b"brings the specified changeset back into the repository",
@@ -4501,15 +4581,15 @@
                 autoreadstderr=autoreadstderr,
             )
         elif opts[b'peer'] == b'raw':
             ui.write(_(b'using raw connection to peer\n'))
             peer = None
         else:
             ui.write(_(b'creating ssh peer from handshake results\n'))
-            peer = sshpeer.makepeer(
+            peer = sshpeer._make_peer(
                 ui,
                 url,
                 proc,
                 stdin,
                 stdout,
                 stderr,
                 autoreadstderr=autoreadstderr,
@@ -4557,15 +4637,15 @@
             peer = None
         elif opts[b'peer']:
             raise error.Abort(
                 _(b'--peer %s not supported with HTTP peers') % opts[b'peer']
             )
         else:
             peer_path = urlutil.try_path(ui, path)
-            peer = httppeer.makepeer(ui, peer_path, opener=opener)
+            peer = httppeer._make_peer(ui, peer_path, opener=opener)
 
         # We /could/ populate stdin/stdout with sock.makefile()...
     else:
         raise error.Abort(_(b'unsupported connection configuration'))
 
     batchedcommands = None
```

### Comparing `mercurial-6.4rc0/mercurial/defaultrc/mergetools.rc` & `mercurial-6.5rc0/mercurial/defaultrc/mergetools.rc`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/destutil.py` & `mercurial-6.5rc0/mercurial/destutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/diffhelper.py` & `mercurial-6.5rc0/mercurial/diffhelper.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/diffutil.py` & `mercurial-6.5rc0/mercurial/diffutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/dirstate.py` & `mercurial-6.5rc0/mercurial/dirstate.py`

 * *Files 1% similar despite different names*

```diff
@@ -196,14 +196,20 @@
         self._mapcls = dirstatemap.dirstatemap
         # Access and cache cwd early, so we don't access it for the first time
         # after a working-copy update caused it to not exist (accessing it then
         # raises an exception).
         self._cwd
 
     def refresh(self):
+        # XXX if this happens, you likely did not enter the `changing_xxx`
+        # using `repo.dirstate`, so a later `repo.dirstate` accesss might call
+        # `refresh`.
+        if self.is_changing_any:
+            msg = "refreshing the dirstate in the middle of a change"
+            raise error.ProgrammingError(msg)
         if '_branch' in vars(self):
             del self._branch
         if '_map' in vars(self) and self._map.may_need_refresh():
             self.invalidate()
 
     def prefetch_parents(self):
         """make sure the parents are loaded
@@ -1750,20 +1756,14 @@
             return [f for f in files if f in dmap]
         if match.prefix() and all(fn in dmap for fn in files):
             # fast path -- all the values are known to be files, so just return
             # that
             return list(files)
         return [f for f in dmap if match(f)]
 
-    def _actualfilename(self, tr):
-        if tr:
-            return self._pendingfilename
-        else:
-            return self._filename
-
     def all_file_names(self):
         """list all filename currently used by this dirstate
 
         This is only used to do `hg rollback` related backup in the transaction
         """
         files = [b'branch']
         if self._opener.exists(self._filename):
```

### Comparing `mercurial-6.4rc0/mercurial/dirstatemap.py` & `mercurial-6.5rc0/mercurial/dirstatemap.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,13 +1,14 @@
 # dirstatemap.py
 #
 # This software may be used and distributed according to the terms of the
 # GNU General Public License version 2 or any later version.
 
 
+import struct
 from .i18n import _
 
 from . import (
     error,
     pathutil,
     policy,
     testing,
@@ -147,17 +148,23 @@
     def docket(self):
         if not self._docket:
             if not self._use_dirstate_v2:
                 raise error.ProgrammingError(
                     b'dirstate only has a docket in v2 format'
                 )
             self._set_identity()
-            self._docket = docketmod.DirstateDocket.parse(
-                self._readdirstatefile(), self._nodeconstants
-            )
+            try:
+                self._docket = docketmod.DirstateDocket.parse(
+                    self._readdirstatefile(), self._nodeconstants
+                )
+            except struct.error:
+                self._ui.debug(b"failed to read dirstate-v2 data")
+                raise error.CorruptedDirstate(
+                    b"failed to read dirstate-v2 data"
+                )
         return self._docket
 
     def _read_v2_data(self):
         data = None
         attempts = 0
         while attempts < V2_MAX_READ_ATTEMPTS:
             attempts += 1
@@ -172,33 +179,45 @@
             assert attempts >= V2_MAX_READ_ATTEMPTS
             msg = b"dirstate read race happened %d times in a row"
             msg %= attempts
             raise error.Abort(msg)
         return self._opener.read(self.docket.data_filename())
 
     def write_v2_no_append(self, tr, st, meta, packed):
-        old_docket = self.docket
+        try:
+            old_docket = self.docket
+        except error.CorruptedDirstate:
+            # This means we've identified a dirstate-v1 file on-disk when we
+            # were expecting a dirstate-v2 docket. We've managed to recover
+            # from that unexpected situation, and now we want to write back a
+            # dirstate-v2 file to make the on-disk situation right again.
+            #
+            # This shouldn't be triggered since `self.docket` is cached and
+            # we would have called parents() or read() first, but it's here
+            # just in case.
+            old_docket = None
+
         new_docket = docketmod.DirstateDocket.with_new_uuid(
             self.parents(), len(packed), meta
         )
-        if old_docket.uuid == new_docket.uuid:
+        if old_docket is not None and old_docket.uuid == new_docket.uuid:
             raise error.ProgrammingError(b'dirstate docket name collision')
         data_filename = new_docket.data_filename()
         self._opener.write(data_filename, packed)
         # tell the transaction that we are adding a new file
         if tr is not None:
             tr.addbackup(data_filename, location=b'plain')
         # Write the new docket after the new data file has been
         # written. Because `st` was opened with `atomictemp=True`,
         # the actual `.hg/dirstate` file is only affected on close.
         st.write(new_docket.serialize())
         st.close()
         # Remove the old data file after the new docket pointing to
         # the new data file was written.
-        if old_docket.uuid:
+        if old_docket is not None and old_docket.uuid:
             data_filename = old_docket.data_filename()
             if tr is not None:
                 tr.addbackup(data_filename, location=b'plain')
             unlink = lambda _tr=None: self._opener.unlink(data_filename)
             if tr:
                 category = b"dirstate-v2-clean-" + old_docket.uuid
                 tr.addpostclose(category, unlink)
@@ -207,36 +226,48 @@
         self._docket = new_docket
 
     ### reading/setting parents
 
     def parents(self):
         if not self._parents:
             if self._use_dirstate_v2:
-                self._parents = self.docket.parents
-            else:
-                read_len = self._nodelen * 2
-                st = self._readdirstatefile(read_len)
-                l = len(st)
-                if l == read_len:
-                    self._parents = (
-                        st[: self._nodelen],
-                        st[self._nodelen : 2 * self._nodelen],
-                    )
-                elif l == 0:
-                    self._parents = (
-                        self._nodeconstants.nullid,
-                        self._nodeconstants.nullid,
-                    )
+                try:
+                    self.docket
+                except error.CorruptedDirstate as e:
+                    # fall back to dirstate-v1 if we fail to read v2
+                    self._v1_parents(e)
                 else:
-                    raise error.Abort(
-                        _(b'working directory state appears damaged!')
-                    )
+                    self._parents = self.docket.parents
+            else:
+                self._v1_parents()
 
         return self._parents
 
+    def _v1_parents(self, from_v2_exception=None):
+        read_len = self._nodelen * 2
+        st = self._readdirstatefile(read_len)
+        l = len(st)
+        if l == read_len:
+            self._parents = (
+                st[: self._nodelen],
+                st[self._nodelen : 2 * self._nodelen],
+            )
+        elif l == 0:
+            self._parents = (
+                self._nodeconstants.nullid,
+                self._nodeconstants.nullid,
+            )
+        else:
+            hint = None
+            if from_v2_exception is not None:
+                hint = _(b"falling back to dirstate-v1 from v2 also failed")
+            raise error.Abort(
+                _(b'working directory state appears damaged!'), hint
+            )
+
 
 class dirstatemap(_dirstatemapcommon):
     """Map encapsulating the dirstate's contents.
 
     The dirstate contains the following state:
 
     - `identity` is the identity of the dirstate file, which can be used to
@@ -326,28 +357,34 @@
         return copies
 
     ### disk interaction
 
     def read(self):
         testing.wait_on_cfg(self._ui, b'dirstate.pre-read-file')
         if self._use_dirstate_v2:
-
-            if not self.docket.uuid:
-                return
-            testing.wait_on_cfg(self._ui, b'dirstate.post-docket-read-file')
-            st = self._read_v2_data()
+            try:
+                self.docket
+            except error.CorruptedDirstate:
+                # fall back to dirstate-v1 if we fail to read v2
+                self._set_identity()
+                st = self._readdirstatefile()
+            else:
+                if not self.docket.uuid:
+                    return
+                testing.wait_on_cfg(self._ui, b'dirstate.post-docket-read-file')
+                st = self._read_v2_data()
         else:
             self._set_identity()
             st = self._readdirstatefile()
 
         if not st:
             return
 
         # TODO: adjust this estimate for dirstate-v2
-        if util.safehasattr(parsers, b'dict_new_presized'):
+        if util.safehasattr(parsers, 'dict_new_presized'):
             # Make an estimate of the number of files in the dirstate based on
             # its size. This trades wasting some memory for avoiding costly
             # resizes. Each entry have a prefix of 17 bytes followed by one or
             # two path names. Studies on various large-scale real-world repositories
             # found 54 bytes a reasonable upper limit for the average path names.
             # Copy entries are ignored for the sake of this estimate.
             self._map = parsers.dict_new_presized(len(st) // 71)
@@ -361,18 +398,25 @@
         # into. This means that O(number of files) GCs are unavoidable.
         # Depending on when in the process's lifetime the dirstate is parsed,
         # this can get very expensive. As a workaround, disable GC while
         # parsing the dirstate.
         #
         # (we cannot decorate the function directly since it is in a C module)
         if self._use_dirstate_v2:
-            p = self.docket.parents
-            meta = self.docket.tree_metadata
-            parse_dirstate = util.nogc(v2.parse_dirstate)
-            parse_dirstate(self._map, self.copymap, st, meta)
+            try:
+                self.docket
+            except error.CorruptedDirstate:
+                # fall back to dirstate-v1 if we fail to parse v2
+                parse_dirstate = util.nogc(parsers.parse_dirstate)
+                p = parse_dirstate(self._map, self.copymap, st)
+            else:
+                p = self.docket.parents
+                meta = self.docket.tree_metadata
+                parse_dirstate = util.nogc(v2.parse_dirstate)
+                parse_dirstate(self._map, self.copymap, st, meta)
         else:
             parse_dirstate = util.nogc(parsers.parse_dirstate)
             p = parse_dirstate(self._map, self.copymap, st)
         if not self._dirtyparents:
             self.setparents(*p)
 
         # Avoid excess attribute lookups by fast pathing certain checks
@@ -593,55 +637,71 @@
             Fills the Dirstatemap when called.
             """
             # ignore HG_PENDING because identity is used only for writing
             self._set_identity()
 
             testing.wait_on_cfg(self._ui, b'dirstate.pre-read-file')
             if self._use_dirstate_v2:
-                self.docket  # load the data if needed
-                inode = (
-                    self.identity.stat.st_ino
-                    if self.identity is not None
-                    and self.identity.stat is not None
-                    else None
-                )
-                testing.wait_on_cfg(self._ui, b'dirstate.post-docket-read-file')
-                if not self.docket.uuid:
-                    data = b''
-                    self._map = rustmod.DirstateMap.new_empty()
+                try:
+                    self.docket
+                except error.CorruptedDirstate as e:
+                    # fall back to dirstate-v1 if we fail to read v2
+                    parents = self._v1_map(e)
                 else:
-                    data = self._read_v2_data()
-                    self._map = rustmod.DirstateMap.new_v2(
-                        data,
-                        self.docket.data_size,
-                        self.docket.tree_metadata,
-                        self.docket.uuid,
-                        inode,
+                    parents = self.docket.parents
+                    inode = (
+                        self.identity.stat.st_ino
+                        if self.identity is not None
+                        and self.identity.stat is not None
+                        else None
+                    )
+                    testing.wait_on_cfg(
+                        self._ui, b'dirstate.post-docket-read-file'
                     )
-                parents = self.docket.parents
+                    if not self.docket.uuid:
+                        data = b''
+                        self._map = rustmod.DirstateMap.new_empty()
+                    else:
+                        data = self._read_v2_data()
+                        self._map = rustmod.DirstateMap.new_v2(
+                            data,
+                            self.docket.data_size,
+                            self.docket.tree_metadata,
+                            self.docket.uuid,
+                            inode,
+                        )
+                    parents = self.docket.parents
             else:
-                self._set_identity()
-                inode = (
-                    self.identity.stat.st_ino
-                    if self.identity is not None
-                    and self.identity.stat is not None
-                    else None
-                )
-                self._map, parents = rustmod.DirstateMap.new_v1(
-                    self._readdirstatefile(), inode
-                )
+                parents = self._v1_map()
 
             if parents and not self._dirtyparents:
                 self.setparents(*parents)
 
             self.__contains__ = self._map.__contains__
             self.__getitem__ = self._map.__getitem__
             self.get = self._map.get
             return self._map
 
+        def _v1_map(self, from_v2_exception=None):
+            self._set_identity()
+            inode = (
+                self.identity.stat.st_ino
+                if self.identity is not None and self.identity.stat is not None
+                else None
+            )
+            try:
+                self._map, parents = rustmod.DirstateMap.new_v1(
+                    self._readdirstatefile(), inode
+                )
+            except OSError as e:
+                if from_v2_exception is not None:
+                    raise e from from_v2_exception
+                raise
+            return parents
+
         @property
         def copymap(self):
             return self._map.copymap()
 
         def debug_iter(self, all):
             """
             Return an iterator of (filename, state, mode, size, mtime) tuples
@@ -692,17 +752,23 @@
                 p1, p2 = self.parents()
                 packed = self._map.write_v1(p1, p2)
                 st.write(packed)
                 st.close()
                 self._dirtyparents = False
                 return
 
-            # We can only append to an existing data file if there is one
             write_mode = self._write_mode
-            if self.docket.uuid is None:
+            try:
+                docket = self.docket
+            except error.CorruptedDirstate:
+                # fall back to dirstate-v1 if we fail to parse v2
+                docket = None
+
+            # We can only append to an existing data file if there is one
+            if docket is None or docket.uuid is None:
                 write_mode = WRITE_MODE_FORCE_NEW
             packed, meta, append = self._map.write_v2(write_mode)
             if append:
                 docket = self.docket
                 data_filename = docket.data_filename()
                 # We mark it for backup to make sure a future `hg rollback` (or
                 # `hg recover`?) call find the data it needs to restore a
```

### Comparing `mercurial-6.4rc0/mercurial/dirstateutils/docket.py` & `mercurial-6.5rc0/mercurial/dirstateutils/docket.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/dirstateutils/timestamp.py` & `mercurial-6.5rc0/mercurial/dirstateutils/timestamp.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/dirstateutils/v2.py` & `mercurial-6.5rc0/mercurial/dirstateutils/v2.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/discovery.py` & `mercurial-6.5rc0/mercurial/discovery.py`

 * *Files 0% similar despite different names*

```diff
@@ -100,22 +100,22 @@
     ):
         # at least one of them must not be set
         assert None in (commonheads, missingroots)
         cl = repo.changelog
         if ancestorsof is None:
             ancestorsof = cl.heads()
         if missingroots:
-            discbases = []
-            for n in missingroots:
-                discbases.extend([p for p in cl.parents(n) if p != repo.nullid])
             # TODO remove call to nodesbetween.
             # TODO populate attributes on outgoing instance instead of setting
             # discbases.
             csets, roots, heads = cl.nodesbetween(missingroots, ancestorsof)
             included = set(csets)
+            discbases = []
+            for n in csets:
+                discbases.extend([p for p in cl.parents(n) if p != repo.nullid])
             ancestorsof = heads
             commonheads = [n for n in discbases if n not in included]
         elif not commonheads:
             commonheads = [repo.nullid]
         self.commonheads = commonheads
         self.ancestorsof = ancestorsof
         self._revlog = cl
```

### Comparing `mercurial-6.4rc0/mercurial/dispatch.py` & `mercurial-6.5rc0/mercurial/dispatch.py`

 * *Files 1% similar despite different names*

```diff
@@ -103,24 +103,24 @@
             if exc is not None:
                 raise exc
 
 
 def _flushstdio(ui, err):
     status = None
     # In all cases we try to flush stdio streams.
-    if util.safehasattr(ui, b'fout'):
+    if util.safehasattr(ui, 'fout'):
         assert ui is not None  # help pytype
         assert ui.fout is not None  # help pytype
         try:
             ui.fout.flush()
         except IOError as e:
             err = e
             status = -1
 
-    if util.safehasattr(ui, b'ferr'):
+    if util.safehasattr(ui, 'ferr'):
         assert ui is not None  # help pytype
         assert ui.ferr is not None  # help pytype
         try:
             if err is not None and err.errno != errno.EPIPE:
                 ui.ferr.write(
                     b'abort: %s\n' % encoding.strtolocal(err.strerror)
                 )
@@ -327,15 +327,15 @@
     with tracing.log('dispatch._runcatch'):
 
         def catchterm(*args):
             raise error.SignalInterrupt
 
         ui = req.ui
         try:
-            for name in b'SIGBREAK', b'SIGHUP', b'SIGTERM':
+            for name in 'SIGBREAK', 'SIGHUP', 'SIGTERM':
                 num = getattr(signal, name, None)
                 if num:
                     signal.signal(num, catchterm)
         except ValueError:
             pass  # happens if called in a thread
 
         def _runcatchfunc():
@@ -363,20 +363,26 @@
                 # closely, as many shared-ssh access tools want to grant
                 # access to run *only* 'hg -R $repo serve --stdio'. We
                 # restrict to exactly that set of arguments, and prohibit
                 # any repo name that starts with '--' to prevent
                 # shenanigans wherein a user does something like pass
                 # --debugger or --config=ui.debugger=1 as a repo
                 # name. This used to actually run the debugger.
+                nbargs = 4
+                hashiddenaccess = b'--hidden' in cmdargs
+                if hashiddenaccess:
+                    nbargs += 1
                 if (
-                    len(req.args) != 4
+                    len(req.args) != nbargs
                     or req.args[0] != b'-R'
                     or req.args[1].startswith(b'--')
                     or req.args[2] != b'serve'
                     or req.args[3] != b'--stdio'
+                    or hashiddenaccess
+                    and req.args[4] != b'--hidden'
                 ):
                     raise error.Abort(
                         _(b'potentially unsafe serve --stdio invocation: %s')
                         % (stringutil.pprint(req.args),)
                     )
 
             try:
@@ -510,15 +516,15 @@
     else:
         return -1
 
 
 def aliasargs(fn, givenargs):
     args = []
     # only care about alias 'args', ignore 'args' set by extensions.wrapfunction
-    if not util.safehasattr(fn, b'_origfunc'):
+    if not util.safehasattr(fn, '_origfunc'):
         args = getattr(fn, 'args', args)
     if args:
         cmd = b' '.join(map(procutil.shellquote, args))
 
         nums = []
 
         def replacer(m):
@@ -698,15 +704,15 @@
             'norepo': True,
             'intents': set(),
             'optionalrepo': False,
             'inferrepo': False,
         }
         if name not in adefaults:
             raise AttributeError(name)
-        if self.badalias or util.safehasattr(self, b'shell'):
+        if self.badalias or util.safehasattr(self, 'shell'):
             return adefaults[name]
         return getattr(self.fn, name)
 
     def __call__(self, ui, *args, **opts):
         if self.badalias:
             hint = None
             if self.unknowncmd:
@@ -724,15 +730,15 @@
 
         ui.log(
             b'commandalias',
             b"alias '%s' expands to '%s'\n",
             self.name,
             self.definition,
         )
-        if util.safehasattr(self, b'shell'):
+        if util.safehasattr(self, 'shell'):
             return self.fn(ui, *args, **opts)
         else:
             try:
                 return util.checksignature(self.fn)(ui, *args, **opts)
             except error.SignatureError:
                 args = b' '.join([self.cmdname] + self.args)
                 ui.debug(b"alias '%s' expands to '%s'\n" % (self.name, args))
@@ -1014,15 +1020,15 @@
         aliases, entry = cmdutil.findcmd(cmd, cmdtable, strict)
     except (error.AmbiguousCommand, error.UnknownCommand):
         return
 
     cmd = aliases[0]
     fn = entry[0]
 
-    if cmd and util.safehasattr(fn, b'shell'):
+    if cmd and util.safehasattr(fn, 'shell'):
         # shell alias shouldn't receive early options which are consumed by hg
         _earlyopts, args = _earlysplitopts(args)
         d = lambda: fn(ui, *args[1:])
         return lambda: runcommand(
             lui, None, cmd, args[:1], ui, options, d, [], {}
         )
```

### Comparing `mercurial-6.4rc0/mercurial/dummycert.pem` & `mercurial-6.5rc0/mercurial/dummycert.pem`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/encoding.py` & `mercurial-6.5rc0/mercurial/encoding.py`

 * *Files 0% similar despite different names*

```diff
@@ -653,15 +653,15 @@
         try:
             s.decode('utf-8', _utf8strict)
             return s
         except UnicodeDecodeError:
             pass
 
     s = pycompat.bytestr(s)
-    r = b""
+    r = bytearray()
     pos = 0
     l = len(s)
     while pos < l:
         try:
             c = getutf8char(s, pos)
             if b"\xed\xb0\x80" <= c <= b"\xed\xb3\xbf":
                 # have to re-escape existing U+DCxx characters
@@ -669,15 +669,15 @@
                 pos += 1
             else:
                 pos += len(c)
         except UnicodeDecodeError:
             c = unichr(0xDC00 + ord(s[pos])).encode('utf-8', _utf8strict)
             pos += 1
         r += c
-    return r
+    return bytes(r)
 
 
 def fromutf8b(s):
     # type: (bytes) -> bytes
     """Given a UTF-8b string, return a local, possibly-binary string.
 
     return the original binary string. This
@@ -708,18 +708,18 @@
 
     # We could do this with the unicode type but some Python builds
     # use UTF-16 internally (issue5031) which causes non-BMP code
     # points to be escaped. Instead, we use our handy getutf8char
     # helper again to walk the string without "decoding" it.
 
     s = pycompat.bytestr(s)
-    r = b""
+    r = bytearray()
     pos = 0
     l = len(s)
     while pos < l:
         c = getutf8char(s, pos)
         pos += len(c)
         # unescape U+DCxx characters
         if b"\xed\xb0\x80" <= c <= b"\xed\xb3\xbf":
             c = pycompat.bytechr(ord(c.decode("utf-8", _utf8strict)) & 0xFF)
         r += c
-    return r
+    return bytes(r)
```

### Comparing `mercurial-6.4rc0/mercurial/error.py` & `mercurial-6.5rc0/mercurial/error.py`

 * *Files 1% similar despite different names*

```diff
@@ -151,15 +151,15 @@
     pass
 
 
 class CommandError(Exception):
     """Exception raised on errors in parsing the command line."""
 
     def __init__(self, command, message):
-        # type: (bytes, bytes) -> None
+        # type: (Optional[bytes], bytes) -> None
         self.command = command
         self.message = message
         super(CommandError, self).__init__()
 
     __bytes__ = _tobytes
 
 
@@ -646,14 +646,21 @@
 
 class CorruptedState(Exception):
     """error raised when a command is not able to read its state from file"""
 
     __bytes__ = _tobytes
 
 
+class CorruptedDirstate(Exception):
+    """error raised the dirstate appears corrupted on-disk. It may be due to
+    a dirstate version mismatch (i.e. expecting v2 and finding v1 on disk)."""
+
+    __bytes__ = _tobytes
+
+
 class PeerTransportError(Abort):
     """Transport-level I/O error when communicating with a peer repo."""
 
 
 class InMemoryMergeConflictsError(Exception):
     """Exception raised when merge conflicts arose during an in-memory merge."""
```

### Comparing `mercurial-6.4rc0/mercurial/exchange.py` & `mercurial-6.5rc0/mercurial/exchange.py`

 * *Files 1% similar despite different names*

```diff
@@ -142,14 +142,20 @@
                     )
             elif part.type == b'stream2' and version is None:
                 # A stream2 part requires to be part of a v2 bundle
                 requirements = urlreq.unquote(part.params[b'requirements'])
                 splitted = requirements.split()
                 params = bundle2._formatrequirementsparams(splitted)
                 return b'none-v2;stream=v2;%s' % params
+            elif part.type == b'stream3-exp' and version is None:
+                # A stream3 part requires to be part of a v2 bundle
+                requirements = urlreq.unquote(part.params[b'requirements'])
+                splitted = requirements.split()
+                params = bundle2._formatrequirementsparams(splitted)
+                return b'none-v2;stream=v3-exp;%s' % params
             elif part.type == b'obsmarkers':
                 params[b'obsolescence'] = b'yes'
                 if not part.mandatory:
                     params[b'obsolescence-mandatory'] = b'no'
 
         if not version:
             raise error.Abort(
@@ -1633,15 +1639,15 @@
     Returns the ``pulloperation`` created for this pull.
     """
     if opargs is None:
         opargs = {}
 
     # We allow the narrow patterns to be passed in explicitly to provide more
     # flexibility for API consumers.
-    if includepats or excludepats:
+    if includepats is not None or excludepats is not None:
         includepats = includepats or set()
         excludepats = excludepats or set()
     else:
         includepats, excludepats = repo.narrowpats
 
     narrowspec.validatepatterns(includepats)
     narrowspec.validatepatterns(excludepats)
@@ -2417,15 +2423,15 @@
         )
 
     info[b'prefercompressed'] = bundler.prefercompressed
 
     return info, bundler.getchunks()
 
 
-@getbundle2partsgenerator(b'stream2')
+@getbundle2partsgenerator(b'stream')
 def _getbundlestream2(bundler, repo, *args, **kwargs):
     return bundle2.addpartbundlestream2(bundler, repo, **kwargs)
 
 
 @getbundle2partsgenerator(b'changegroup')
 def _getbundlechangegrouppart(
     bundler,
@@ -2824,15 +2830,15 @@
         )
         return
 
     entries = bundlecaches.sortclonebundleentries(repo.ui, entries)
 
     url = entries[0][b'URL']
     repo.ui.status(_(b'applying clone bundle from %s\n') % url)
-    if trypullbundlefromurl(repo.ui, repo, url):
+    if trypullbundlefromurl(repo.ui, repo, url, remote):
         repo.ui.status(_(b'finished applying clone bundle\n'))
     # Bundle failed.
     #
     # We abort by default to avoid the thundering herd of
     # clients flooding a server that was expecting expensive
     # clone load to be offloaded.
     elif repo.ui.configbool(b'ui', b'clonebundlefallback'):
@@ -2845,19 +2851,30 @@
                 b'the server operator or disable clone '
                 b'bundles via '
                 b'"--config ui.clonebundles=false"'
             ),
         )
 
 
-def trypullbundlefromurl(ui, repo, url):
+def inline_clone_bundle_open(ui, url, peer):
+    if not peer:
+        raise error.Abort(_(b'no remote repository supplied for %s' % url))
+    clonebundleid = url[len(bundlecaches.CLONEBUNDLESCHEME) :]
+    peerclonebundle = peer.get_cached_bundle_inline(clonebundleid)
+    return util.chunkbuffer(peerclonebundle)
+
+
+def trypullbundlefromurl(ui, repo, url, peer):
     """Attempt to apply a bundle from a URL."""
     with repo.lock(), repo.transaction(b'bundleurl') as tr:
         try:
-            fh = urlmod.open(ui, url)
+            if url.startswith(bundlecaches.CLONEBUNDLESCHEME):
+                fh = inline_clone_bundle_open(ui, url, peer)
+            else:
+                fh = urlmod.open(ui, url)
             cg = readbundle(ui, fh, b'stream')
 
             if isinstance(cg, streamclone.streamcloneapplier):
                 cg.apply(repo)
             else:
                 bundle2.applybundle(repo, cg, tr, b'clonebundles', url)
             return True
```

### Comparing `mercurial-6.4rc0/mercurial/exewrapper.c` & `mercurial-6.5rc0/mercurial/exewrapper.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/extensions.py` & `mercurial-6.5rc0/mercurial/extensions.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/exthelper.py` & `mercurial-6.5rc0/mercurial/exthelper.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/fancyopts.py` & `mercurial-6.5rc0/mercurial/fancyopts.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/filelog.py` & `mercurial-6.5rc0/mercurial/filelog.py`

 * *Files 2% similar despite different names*

```diff
@@ -21,30 +21,40 @@
     constants as revlog_constants,
     rewrite,
 )
 
 
 @interfaceutil.implementer(repository.ifilestorage)
 class filelog:
-    def __init__(self, opener, path):
+    def __init__(self, opener, path, try_split=False):
         self._revlog = revlog.revlog(
             opener,
             # XXX should use the unencoded path
             target=(revlog_constants.KIND_FILELOG, path),
             radix=b'/'.join((b'data', path)),
             censorable=True,
             canonical_parent_order=False,  # see comment in revlog.py
+            try_split=try_split,
         )
         # Full name of the user visible file, relative to the repository root.
         # Used by LFS.
         self._revlog.filename = path
         self.nullid = self._revlog.nullid
         opts = opener.options
         self._fix_issue6528 = opts.get(b'issue6528.fix-incoming', True)
 
+    def get_revlog(self):
+        """return an actual revlog instance if any
+
+        This exist because a lot of code leverage the fact the underlying
+        storage is a revlog for optimization, so giving simple way to access
+        the revlog instance helps such code.
+        """
+        return self._revlog
+
     def __len__(self):
         return len(self._revlog)
 
     def __iter__(self):
         return self._revlog.__iter__()
 
     def hasnode(self, node):
@@ -252,16 +262,16 @@
 
         return self._revlog.clone(tr, destrevlog._revlog, **kwargs)
 
 
 class narrowfilelog(filelog):
     """Filelog variation to be used with narrow stores."""
 
-    def __init__(self, opener, path, narrowmatch):
-        super(narrowfilelog, self).__init__(opener, path)
+    def __init__(self, opener, path, narrowmatch, try_split=False):
+        super(narrowfilelog, self).__init__(opener, path, try_split=try_split)
         self._narrowmatch = narrowmatch
 
     def renamed(self, node):
         res = super(narrowfilelog, self).renamed(node)
 
         # Renames that come from outside the narrowspec are problematic
         # because we may lack the base text for the rename. This can result
```

### Comparing `mercurial-6.4rc0/mercurial/filemerge.py` & `mercurial-6.5rc0/mercurial/filemerge.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/fileset.py` & `mercurial-6.5rc0/mercurial/fileset.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/filesetlang.py` & `mercurial-6.5rc0/mercurial/filesetlang.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/formatter.py` & `mercurial-6.5rc0/mercurial/formatter.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/graphmod.py` & `mercurial-6.5rc0/mercurial/graphmod.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/grep.py` & `mercurial-6.5rc0/mercurial/grep.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/hbisect.py` & `mercurial-6.5rc0/mercurial/hbisect.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/help.py` & `mercurial-6.5rc0/mercurial/help.py`

 * *Files 1% similar despite different names*

```diff
@@ -806,15 +806,15 @@
             rst.append(_(b"\naliases: %s\n") % b', '.join(aliases[1:]))
         rst.append(b'\n')
 
         # description
         doc = gettext(pycompat.getdoc(entry[0]))
         if not doc:
             doc = _(b"(no help text available)")
-        if util.safehasattr(entry[0], b'definition'):  # aliased command
+        if util.safehasattr(entry[0], 'definition'):  # aliased command
             source = entry[0].source
             if entry[0].definition.startswith(b'!'):  # shell alias
                 doc = _(b'shell alias for: %s\n\n%s\n\ndefined by: %s\n') % (
                     entry[0].definition[1:],
                     doc,
                     source,
                 )
```

### Comparing `mercurial-6.4rc0/mercurial/helptext/bundlespec.txt` & `mercurial-6.5rc0/mercurial/helptext/bundlespec.txt`

 * *Files 5% similar despite different names*

```diff
@@ -63,14 +63,18 @@
 Available Compression Engines
 =============================
 
 The following bundle <compression> engines can be used:
 
 .. bundlecompressionmarker
 
+The compression engines can be prepended with ``stream`` to create a streaming bundle.
+These are bundles that are extremely efficient to produce and consume,
+but do not have guaranteed compatibility with older clients.
+
 Available Options
 =================
 
 The following options exist:
 
 changegroup
     Include the changegroup data in the bundle (default to True).
@@ -85,15 +89,14 @@
 
 phases
     Include phase information relevant to the bundled changesets.
 
 revbranchcache
     Include the "tags-fnodes" cache inside the bundle.
 
-
 tagsfnodescache
     Include the "tags-fnodes" cache inside the bundle.
 
 
 Examples
 ========
 
@@ -105,7 +108,14 @@
 
 ``zstd-v2``
     Produce a ``v2`` bundle with zstandard compression using default
     settings.
 
 ``zstd-v1``
     This errors because ``zstd`` is not supported for ``v1`` types.
+
+``none-streamv2``
+    Produce a ``v2`` streaming bundle with no compression.
+
+``zstd-v2;obsolescence=true;phases=true``
+    Produce a ``v2`` bundle with zstandard compression which includes
+    obsolescence markers and phases.
```

### Comparing `mercurial-6.4rc0/mercurial/helptext/color.txt` & `mercurial-6.5rc0/mercurial/helptext/color.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/config.txt` & `mercurial-6.5rc0/mercurial/helptext/config.txt`

 * *Files 0% similar despite different names*

```diff
@@ -1314,14 +1314,20 @@
 
 ``pretag``
   Run before creating a tag. Exit status 0 allows the tag to be
   created. A non-zero status will cause the tag to fail. The ID of the
   changeset to tag is in ``$HG_NODE``. The name of tag is in ``$HG_TAG``. The
   tag is local if ``$HG_LOCAL=1``, or in the repository if ``$HG_LOCAL=0``.
 
+``pretransmit-inline-clone-bundle``
+  Run before transferring an inline clonebundle to the peer.
+  If the exit status is 0, the inline clonebundle will be allowed to be
+  transferred. A non-zero status will cause the transfer to fail.
+  The path of the inline clonebundle is in ``$HG_CLONEBUNDLEPATH``.
+
 ``pretxnopen``
   Run before any new repository transaction is open. The reason for the
   transaction will be in ``$HG_TXNNAME``, and a unique identifier for the
   transaction will be in ``$HG_TXNID``. A non-zero status will prevent the
   transaction from being opened.
 
 ``pretxnclose``
@@ -1618,15 +1624,15 @@
     Optional. User name to authenticate with at the proxy server.
 
 ``always``
     Optional. Always use the proxy, even for localhost and any entries
     in ``http_proxy.no``. (default: False)
 
 ``http``
-----------
+--------
 
 Used to configure access to Mercurial repositories via HTTP.
 
 ``timeout``
     If set, blocking operations will timeout after that many seconds.
     (default: None)
```

### Comparing `mercurial-6.4rc0/mercurial/helptext/dates.txt` & `mercurial-6.5rc0/mercurial/helptext/dates.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/deprecated.txt` & `mercurial-6.5rc0/mercurial/helptext/deprecated.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/diffs.txt` & `mercurial-6.5rc0/mercurial/helptext/diffs.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/environment.txt` & `mercurial-6.5rc0/mercurial/helptext/environment.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/evolution.txt` & `mercurial-6.5rc0/mercurial/helptext/evolution.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/extensions.txt` & `mercurial-6.5rc0/mercurial/helptext/extensions.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/filesets.txt` & `mercurial-6.5rc0/mercurial/helptext/filesets.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/flags.txt` & `mercurial-6.5rc0/mercurial/helptext/flags.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/glossary.txt` & `mercurial-6.5rc0/mercurial/helptext/glossary.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/hg-ssh.8.txt` & `mercurial-6.5rc0/mercurial/helptext/hg-ssh.8.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/hg.1.txt` & `mercurial-6.5rc0/mercurial/helptext/hg.1.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/hgignore.5.txt` & `mercurial-6.5rc0/mercurial/helptext/hgignore.5.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/hgignore.txt` & `mercurial-6.5rc0/mercurial/helptext/hgignore.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/hgrc.5.txt` & `mercurial-6.5rc0/mercurial/helptext/hgrc.5.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/hgweb.txt` & `mercurial-6.5rc0/mercurial/helptext/hgweb.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/bid-merge.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/bid-merge.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/bundle2.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/bundle2.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/bundles.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/bundles.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/cbor.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/cbor.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/censor.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/censor.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/changegroups.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/changegroups.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/config.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/config.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/dirstate-v2.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/dirstate-v2.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/extensions.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/extensions.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/linelog.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/linelog.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/mergestate.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/mergestate.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/requirements.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/requirements.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/revlogs.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/revlogs.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/wireprotocol.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/wireprotocol.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/wireprotocolrpc.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/wireprotocolrpc.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/internals/wireprotocolv2.txt` & `mercurial-6.5rc0/mercurial/helptext/internals/wireprotocolv2.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/merge-tools.txt` & `mercurial-6.5rc0/mercurial/helptext/merge-tools.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/pager.txt` & `mercurial-6.5rc0/mercurial/helptext/pager.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/patterns.txt` & `mercurial-6.5rc0/mercurial/helptext/patterns.txt`

 * *Files 5% similar despite different names*

```diff
@@ -14,15 +14,16 @@
   Please see :hg:`help hgignore` for details.
 
 To use a plain path name without any pattern matching, start it with
 ``path:``. These path names must completely match starting at the
 current repository root, and when the path points to a directory, it is matched
 recursively. To match all files in a directory non-recursively (not including
 any files in subdirectories), ``rootfilesin:`` can be used, specifying an
-absolute path (relative to the repository root).
+absolute path (relative to the repository root). To match a single file exactly,
+relative to the repository root, you can use ``filepath:``.
 
 To use an extended glob, start a name with ``glob:``. Globs are rooted
 at the current directory; a glob such as ``*.c`` will only match files
 in the current directory ending with ``.c``. ``rootglob:`` can be used
 instead of ``glob:`` for a glob that is rooted at the root of the
 repository.
 
@@ -46,19 +47,23 @@
 All patterns, except for ``glob:`` specified in command line (not for
 ``-I`` or ``-X`` options), can match also against directories: files
 under matched directories are treated as matched.
 For ``-I`` and ``-X`` options, ``glob:`` will match directories recursively.
 
 Plain examples::
 
-  path:foo/bar        a name bar in a directory named foo in the root
-                      of the repository
-  path:path:name      a file or directory named "path:name"
-  rootfilesin:foo/bar the files in a directory called foo/bar, but not any files
-                      in its subdirectories and not a file bar in directory foo
+  path:foo/bar                  a name bar in a directory named foo in the root
+                                of the repository
+  path:some/path                a file or directory named "some/path"
+  filepath:some/path/to/a/file  exactly a single file named
+                                "some/path/to/a/file", relative to the root
+                                of the repository
+  rootfilesin:foo/bar           the files in a directory called foo/bar, but
+                                not any files in its subdirectories and not
+                                a file bar in directory foo
 
 Glob examples::
 
   glob:*.c       any name ending in ".c" in the current directory
   *.c            any name ending in ".c" in the current directory
   **.c           any name ending in ".c" in any subdirectory of the
                  current directory including itself.
```

### Comparing `mercurial-6.4rc0/mercurial/helptext/phases.txt` & `mercurial-6.5rc0/mercurial/helptext/phases.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/revisions.txt` & `mercurial-6.5rc0/mercurial/helptext/revisions.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/rust.txt` & `mercurial-6.5rc0/mercurial/helptext/rust.txt`

 * *Files 2% similar despite different names*

```diff
@@ -72,16 +72,17 @@
 
 Please refer to the `rust/README.rst` file in the Mercurial repository for
 instructions on how to install from source.
 
 MSRV
 ====
 
-The minimum supported Rust version is currently 1.61.0. The project's policy is
-to follow the version from Debian testing, to make the distributions' job easier.
+The minimum supported Rust version is defined in `rust/clippy.toml`.
+The project's policy is to keep it at or below the version from Debian testing,
+to make the distributions' job easier.
 
 rhg
 ===
 
 There exists an experimental pure-Rust version of Mercurial called `rhg` with a
 fallback mechanism for unsupported invocations. It allows for much faster
 execution of certain commands while adding no discernable overhead for the rest.
```

### Comparing `mercurial-6.4rc0/mercurial/helptext/scripting.txt` & `mercurial-6.5rc0/mercurial/helptext/scripting.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/subrepos.txt` & `mercurial-6.5rc0/mercurial/helptext/subrepos.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/templates.txt` & `mercurial-6.5rc0/mercurial/helptext/templates.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/helptext/urls.txt` & `mercurial-6.5rc0/mercurial/helptext/urls.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/hg.py` & `mercurial-6.5rc0/mercurial/hg.py`

 * *Files 2% similar despite different names*

```diff
@@ -61,18 +61,18 @@
 
 release = lock.release
 
 # shared features
 sharedbookmarks = b'bookmarks'
 
 
-def addbranchrevs(lrepo, other, branches, revs):
+def addbranchrevs(lrepo, other, branches, revs, remotehidden=False):
     if util.safehasattr(other, 'peer'):
         # a courtesy to callers using a localrepo for other
-        peer = other.peer()
+        peer = other.peer(remotehidden=remotehidden)
     else:
         peer = other
     hashbranch, branches = branches
     if not hashbranch and not branches:
         x = revs or None
         if revs:
             y = revs[0]
@@ -238,15 +238,23 @@
         intents=intents,
         createopts=createopts,
     )
     _setup_repo_or_peer(ui, repo, presetupfuncs=presetupfuncs)
     return repo.filtered(b'visible')
 
 
-def peer(uiorrepo, opts, path, create=False, intents=None, createopts=None):
+def peer(
+    uiorrepo,
+    opts,
+    path,
+    create=False,
+    intents=None,
+    createopts=None,
+    remotehidden=False,
+):
     '''return a repository peer for the specified path'''
     ui = getattr(uiorrepo, 'ui', uiorrepo)
     rui = remoteui(uiorrepo, opts)
     if util.safehasattr(path, 'url'):
         # this is already a urlutil.path object
         peer_path = path
     else:
@@ -256,29 +264,30 @@
         cls = peer_schemes[scheme]
         peer = cls.make_peer(
             rui,
             peer_path,
             create,
             intents=intents,
             createopts=createopts,
+            remotehidden=remotehidden,
         )
         _setup_repo_or_peer(rui, peer)
     else:
         # this is a repository
         repo_path = peer_path.loc  # pytype: disable=attribute-error
         if not repo_path:
             repo_path = peer_path.rawloc  # pytype: disable=attribute-error
         repo = repository(
             rui,
             repo_path,
             create,
             intents=intents,
             createopts=createopts,
         )
-        peer = repo.peer(path=peer_path)
+        peer = repo.peer(path=peer_path, remotehidden=remotehidden)
     return peer
 
 
 def defaultdest(source):
     """return default destination of clone if none is given
 
     >>> defaultdest(b'foo')
@@ -304,15 +313,15 @@
     """Returns repository object for source repository of a shared repo.
 
     If repo is not a shared repository, returns None.
     """
     if repo.sharedpath == repo.path:
         return None
 
-    if util.safehasattr(repo, b'srcrepo') and repo.srcrepo:
+    if util.safehasattr(repo, 'srcrepo') and repo.srcrepo:
         return repo.srcrepo
 
     # the sharedpath always ends in the .hg; we want the path to the repo
     source = repo.vfs.split(repo.sharedpath)[0]
     srcurl, branches = urlutil.parseurl(source)
     srcrepo = repository(repo.ui, srcurl)
     repo.srcrepo = srcrepo
@@ -1554,15 +1563,15 @@
                 )
 
     return ret
 
 
 def remoteui(src, opts):
     """build a remote ui from ui or repo and opts"""
-    if util.safehasattr(src, b'baseui'):  # looks like a repository
+    if util.safehasattr(src, 'baseui'):  # looks like a repository
         dst = src.baseui.copy()  # drop repo-specific config
         src = src.ui  # copy target options from repo
     else:  # assume it's a global ui object
         dst = src.copy()  # keep all global options
 
     # copy ssh-specific options
     for o in b'ssh', b'remotecmd':
```

### Comparing `mercurial-6.4rc0/mercurial/hgweb/__init__.py` & `mercurial-6.5rc0/mercurial/hgweb/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/hgweb/common.py` & `mercurial-6.5rc0/mercurial/hgweb/common.py`

 * *Files 6% similar despite different names*

```diff
@@ -9,21 +9,23 @@
 
 import base64
 import errno
 import mimetypes
 import os
 import stat
 
+from ..i18n import _
 from ..pycompat import (
     getattr,
     open,
 )
 from .. import (
     encoding,
     pycompat,
+    scmutil,
     templater,
     util,
 )
 
 httpserver = util.httpserver
 
 HTTP_OK = 200
@@ -34,23 +36,41 @@
 HTTP_FORBIDDEN = 403
 HTTP_NOT_FOUND = 404
 HTTP_METHOD_NOT_ALLOWED = 405
 HTTP_NOT_ACCEPTABLE = 406
 HTTP_UNSUPPORTED_MEDIA_TYPE = 415
 HTTP_SERVER_ERROR = 500
 
+ismember = scmutil.ismember
 
-def ismember(ui, username, userlist):
-    """Check if username is a member of userlist.
 
-    If userlist has a single '*' member, all users are considered members.
-    Can be overridden by extensions to provide more complex authorization
-    schemes.
-    """
-    return userlist == [b'*'] or username in userlist
+def hashiddenaccess(repo, req):
+    if bool(req.qsparams.get(b'access-hidden')):
+        # Disable this by default for now. Main risk is to get critical
+        # information exposed through this. This is expecially risky if
+        # someone decided to make a changeset secret for good reason, but
+        # its predecessors are still draft.
+        #
+        # The feature is currently experimental, so we can still decide to
+        # change the default.
+        ui = repo.ui
+        allow = ui.configlist(b'experimental', b'server.allow-hidden-access')
+        user = req.remoteuser
+        if allow and ismember(ui, user, allow):
+            return True
+        else:
+            msg = (
+                _(
+                    b'ignoring request to access hidden changeset by '
+                    b'unauthorized user: %r\n'
+                )
+                % user
+            )
+            ui.warn(msg)
+    return False
 
 
 def checkauthz(hgweb, req, op):
     """Check permission for operation based on request data (including
     authentication info). Return if op allowed, else raise an ErrorResponse
     exception."""
```

### Comparing `mercurial-6.4rc0/mercurial/hgweb/hgweb_mod.py` & `mercurial-6.5rc0/mercurial/hgweb/hgweb_mod.py`

 * *Files 4% similar despite different names*

```diff
@@ -35,14 +35,15 @@
     templateutil,
     ui as uimod,
     util,
     wireprotoserver,
 )
 
 from . import (
+    common,
     request as requestmod,
     webcommands,
     webutil,
     wsgicgi,
 )
 
 
@@ -120,14 +121,24 @@
 
     def __init__(self, app, repo, req, res):
         self.repo = repo
         self.reponame = app.reponame
         self.req = req
         self.res = res
 
+        # Only works if the filter actually support being upgraded to show
+        # visible changesets
+        current_filter = repo.filtername
+        if (
+            common.hashiddenaccess(repo, req)
+            and current_filter is not None
+            and current_filter + b'.hidden' in repoview.filtertable
+        ):
+            self.repo = self.repo.filtered(repo.filtername + b'.hidden')
+
         self.maxchanges = self.configint(b'web', b'maxchanges')
         self.stripecount = self.configint(b'web', b'stripes')
         self.maxshortchanges = self.configint(b'web', b'maxshortchanges')
         self.maxfiles = self.configint(b'web', b'maxfiles')
         self.allowpull = self.configbool(b'web', b'allow-pull')
 
         # we use untrusted=False to prevent a repo owner from using
@@ -463,15 +474,15 @@
                 # override easily enough.
                 res.status = b'200 Script output follows'
                 res.headers[b'Content-Type'] = ctype
                 return getattr(webcommands, cmd)(rctx)
 
         except (error.LookupError, error.RepoLookupError) as err:
             msg = pycompat.bytestr(err)
-            if util.safehasattr(err, b'name') and not isinstance(
+            if util.safehasattr(err, 'name') and not isinstance(
                 err, error.ManifestLookupError
             ):
                 msg = b'revision not found: %s' % err.name
 
             res.status = b'404 Not Found'
             res.headers[b'Content-Type'] = ctype
             return rctx.sendtemplate(b'error', error=msg)
```

### Comparing `mercurial-6.4rc0/mercurial/hgweb/hgwebdir_mod.py` & `mercurial-6.5rc0/mercurial/hgweb/hgwebdir_mod.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/hgweb/request.py` & `mercurial-6.5rc0/mercurial/hgweb/request.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/hgweb/server.py` & `mercurial-6.5rc0/mercurial/hgweb/server.py`

 * *Files 1% similar despite different names*

```diff
@@ -96,15 +96,15 @@
         self._log_any(self.server.errorlog, format, *args)
 
     def log_message(self, format, *args):
         self._log_any(self.server.accesslog, format, *args)
 
     def log_request(self, code='-', size='-'):
         xheaders = []
-        if util.safehasattr(self, b'headers'):
+        if util.safehasattr(self, 'headers'):
             xheaders = [
                 h for h in self.headers.items() if h[0].startswith('x-')
             ]
         self.log_message(
             '"%s" %s %s%s',
             self.requestline,
             str(code),
@@ -210,15 +210,15 @@
             self.rfile = common.continuereader(self.rfile, self.wfile.write)
 
         env['wsgi.input'] = self.rfile
         env['wsgi.errors'] = _error_logger(self)
         env['wsgi.multithread'] = isinstance(
             self.server, socketserver.ThreadingMixIn
         )
-        if util.safehasattr(socketserver, b'ForkingMixIn'):
+        if util.safehasattr(socketserver, 'ForkingMixIn'):
             env['wsgi.multiprocess'] = isinstance(
                 self.server, socketserver.ForkingMixIn
             )
         else:
             env['wsgi.multiprocess'] = False
 
         env['wsgi.run_once'] = 0
@@ -340,15 +340,15 @@
 
 try:
     import threading
 
     threading.active_count()  # silence pyflakes and bypass demandimport
     _mixin = socketserver.ThreadingMixIn
 except ImportError:
-    if util.safehasattr(os, b"fork"):
+    if util.safehasattr(os, "fork"):
         _mixin = socketserver.ForkingMixIn
     else:
 
         class _mixin:
             pass
```

### Comparing `mercurial-6.4rc0/mercurial/hgweb/webcommands.py` & `mercurial-6.5rc0/mercurial/hgweb/webcommands.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/hgweb/webutil.py` & `mercurial-6.5rc0/mercurial/hgweb/webutil.py`

 * *Files 0% similar despite different names*

```diff
@@ -207,15 +207,15 @@
             b'node': s.hex(),
             b'rev': s.rev(),
             b'user': s.user(),
             b'date': s.date(),
             b'description': s.description(),
             b'branch': s.branch(),
         }
-        if util.safehasattr(s, b'path'):
+        if util.safehasattr(s, 'path'):
             d[b'file'] = s.path()
         yield d
 
 
 def _siblings(siblings=None, hiderev=None):
     if siblings is None:
         siblings = []
```

### Comparing `mercurial-6.4rc0/mercurial/hgweb/wsgicgi.py` & `mercurial-6.5rc0/mercurial/hgweb/wsgicgi.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/hgweb/wsgiheaders.py` & `mercurial-6.5rc0/mercurial/hgweb/wsgiheaders.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/hook.py` & `mercurial-6.5rc0/mercurial/hook.py`

 * *Files 2% similar despite different names*

```diff
@@ -187,14 +187,19 @@
 
     if repo:
         cwd = repo.root
     else:
         cwd = encoding.getcwd()
     r = ui.system(cmd, environ=env, cwd=cwd, blockedtag=b'exthook-%s' % (name,))
 
+    if repo is not None and repo.currentwlock() is None:
+        repo.invalidatedirstate()
+    if repo is not None and repo.currentlock() is None:
+        repo.invalidate()
+
     duration = util.timer() - starttime
     ui.log(
         b'exthook',
         b'exthook-%s: %s finished in %0.2f seconds\n',
         name,
         cmd,
         duration,
```

### Comparing `mercurial-6.4rc0/mercurial/httpconnection.py` & `mercurial-6.5rc0/mercurial/httpconnection.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/httppeer.py` & `mercurial-6.5rc0/mercurial/httppeer.py`

 * *Files 5% similar despite different names*

```diff
@@ -61,15 +61,15 @@
 
     return result
 
 
 class _multifile:
     def __init__(self, *fileobjs):
         for f in fileobjs:
-            if not util.safehasattr(f, b'length'):
+            if not util.safehasattr(f, 'length'):
                 raise ValueError(
                     b'_multifile only supports file objects that '
                     b'have a length but this one does not:',
                     type(f),
                     f,
                 )
         self._fileobjs = fileobjs
@@ -104,15 +104,22 @@
             )
         for f in self._fileobjs:
             f.seek(0)
         self._index = 0
 
 
 def makev1commandrequest(
-    ui, requestbuilder, caps, capablefn, repobaseurl, cmd, args
+    ui,
+    requestbuilder,
+    caps,
+    capablefn,
+    repobaseurl,
+    cmd,
+    args,
+    remotehidden=False,
 ):
     """Make an HTTP request to run a command for a version 1 client.
 
     ``caps`` is a set of known server capabilities. The value may be
     None if capabilities are not yet known.
 
     ``capablefn`` is a function to evaluate a capability.
@@ -123,14 +130,16 @@
     if cmd == b'pushkey':
         args[b'data'] = b''
     data = args.pop(b'data', None)
     headers = args.pop(b'headers', {})
 
     ui.debug(b"sending %s command\n" % cmd)
     q = [(b'cmd', cmd)]
+    if remotehidden:
+        q.append(('access-hidden', '1'))
     headersize = 0
     # Important: don't use self.capable() here or else you end up
     # with infinite recursion when trying to look up capabilities
     # for the first time.
     postargsok = caps is not None and b'httppostargs' in caps
 
     # Send arguments via POST.
@@ -167,15 +176,15 @@
         # Send arguments via query string (Mercurial <1.9).
         else:
             q += sorted(args.items())
 
     qs = b'?%s' % urlreq.urlencode(q)
     cu = b"%s%s" % (repobaseurl, qs)
     size = 0
-    if util.safehasattr(data, b'length'):
+    if util.safehasattr(data, 'length'):
         size = data.length
     elif data is not None:
         size = len(data)
     if data is not None and 'Content-Type' not in headers:
         headers['Content-Type'] = 'application/mercurial-0.1'
 
     # Tell the server we accept application/mercurial-0.2 and multiple
@@ -377,21 +386,24 @@
             _(b"'%s' uses newer protocol %s") % (safeurl, subtype)
         )
 
     return respurl, proto, resp
 
 
 class httppeer(wireprotov1peer.wirepeer):
-    def __init__(self, ui, path, url, opener, requestbuilder, caps):
-        super().__init__(ui, path=path)
+    def __init__(
+        self, ui, path, url, opener, requestbuilder, caps, remotehidden=False
+    ):
+        super().__init__(ui, path=path, remotehidden=remotehidden)
         self._url = url
         self._caps = caps
         self.limitedarguments = caps is not None and b'httppostargs' not in caps
         self._urlopener = opener
         self._requestbuilder = requestbuilder
+        self._remotehidden = remotehidden
 
     def __del__(self):
         for h in self._urlopener.handlers:
             h.close()
             getattr(h, "close_all", lambda: None)()
 
     # Begin of ipeerconnection interface.
@@ -425,27 +437,35 @@
     # End of ipeerconnection interface.
 
     # Begin of ipeercommands interface.
 
     def capabilities(self):
         return self._caps
 
+    def _finish_inline_clone_bundle(self, stream):
+        # HTTP streams must hit the end to process the last empty
+        # chunk of Chunked-Encoding so the connection can be reused.
+        chunk = stream.read(1)
+        if chunk:
+            self._abort(error.ResponseError(_(b"unexpected response:"), chunk))
+
     # End of ipeercommands interface.
 
     def _callstream(self, cmd, _compressible=False, **args):
         args = pycompat.byteskwargs(args)
 
         req, cu, qs = makev1commandrequest(
             self.ui,
             self._requestbuilder,
             self._caps,
             self.capable,
             self._url,
             cmd,
             args,
+            self._remotehidden,
         )
 
         resp = sendrequest(self.ui, self._urlopener, req)
 
         self._url, ct, resp = parsev1commandresponse(
             self.ui, self._url, cu, qs, resp, _compressible
         )
@@ -588,15 +608,17 @@
         raise error.ProgrammingError(b'unexpected content-type: %s' % ct)
 
     info = {b'v1capabilities': set(rawdata.split())}
 
     return respurl, info
 
 
-def makepeer(ui, path, opener=None, requestbuilder=urlreq.request):
+def _make_peer(
+    ui, path, opener=None, requestbuilder=urlreq.request, remotehidden=False
+):
     """Construct an appropriate HTTP peer instance.
 
     ``opener`` is an ``url.opener`` that should be used to establish
     connections, perform HTTP requests.
 
     ``requestbuilder`` is the type used for constructing HTTP requests.
     It exists as an argument so extensions can override the default.
@@ -611,28 +633,36 @@
     ui.debug(b'using %s\n' % url)
 
     opener = opener or urlmod.opener(ui, authinfo)
 
     respurl, info = performhandshake(ui, url, opener, requestbuilder)
 
     return httppeer(
-        ui, path, respurl, opener, requestbuilder, info[b'v1capabilities']
+        ui,
+        path,
+        respurl,
+        opener,
+        requestbuilder,
+        info[b'v1capabilities'],
+        remotehidden=remotehidden,
     )
 
 
-def make_peer(ui, path, create, intents=None, createopts=None):
+def make_peer(
+    ui, path, create, intents=None, createopts=None, remotehidden=False
+):
     if create:
         raise error.Abort(_(b'cannot create new http repository'))
     try:
         if path.url.scheme == b'https' and not urlmod.has_https:
             raise error.Abort(
                 _(b'Python support for SSL and HTTPS is not installed')
             )
 
-        inst = makepeer(ui, path)
+        inst = _make_peer(ui, path, remotehidden=remotehidden)
 
         return inst
     except error.RepoError as httpexception:
         try:
             r = statichttprepo.make_peer(ui, b"static-" + path.loc, create)
             ui.note(_(b'(falling back to static-http)\n'))
             return r
```

### Comparing `mercurial-6.4rc0/mercurial/i18n.py` & `mercurial-6.5rc0/mercurial/i18n.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/interfaces/dirstate.py` & `mercurial-6.5rc0/mercurial/interfaces/dirstate.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/interfaces/repository.py` & `mercurial-6.5rc0/mercurial/interfaces/repository.py`

 * *Files 2% similar despite different names*

```diff
@@ -172,14 +172,20 @@
 
     def capabilities():
         """Obtain capabilities of the peer.
 
         Returns a set of string capabilities.
         """
 
+    def get_cached_bundle_inline(path):
+        """Retrieve a clonebundle across the wire.
+
+        Returns a chunkbuffer
+        """
+
     def clonebundles():
         """Obtains the clone bundles manifest for the repo.
 
         Returns the manifest as unparsed bytes.
         """
 
     def debugwireargs(one, two, three=None, four=None, five=None):
@@ -384,15 +390,15 @@
 
 @interfaceutil.implementer(ipeerbase)
 class peer:
     """Base class for peer repositories."""
 
     limitedarguments = False
 
-    def __init__(self, ui, path=None):
+    def __init__(self, ui, path=None, remotehidden=False):
         self.ui = ui
         self.path = path
 
     def capable(self, name):
         caps = self.capabilities()
         if name in caps:
             return True
@@ -1400,14 +1406,22 @@
     ):
         """Obtain information about storage for this manifest's data.
 
         See ``ifilestorage.storageinfo()`` for a description of this method.
         This one behaves the same way, except for manifest data.
         """
 
+    def get_revlog():
+        """return an actual revlog instance if any
+
+        This exist because a lot of code leverage the fact the underlying
+        storage is a revlog for optimization, so giving simple way to access
+        the revlog instance helps such code.
+        """
+
 
 class imanifestlog(interfaceutil.Interface):
     """Interface representing a collection of manifest snapshots.
 
     Represents the root manifest in a repository.
 
     Also serves as a means to access nested tree manifests and to cache
@@ -1520,14 +1534,18 @@
         """
     )
 
     filtername = interfaceutil.Attribute(
         """Name of the repoview that is active on this repo."""
     )
 
+    vfs_map = interfaceutil.Attribute(
+        """a bytes-key → vfs mapping used by transaction and others"""
+    )
+
     wvfs = interfaceutil.Attribute(
         """VFS used to access the working directory."""
     )
 
     vfs = interfaceutil.Attribute(
         """VFS rooted at the .hg directory.
 
@@ -1802,14 +1820,17 @@
 
     def invalidateall():
         pass
 
     def lock(wait=True):
         """Lock the repository store and return a lock instance."""
 
+    def currentlock():
+        """Return the lock if it's held or None."""
+
     def wlock(wait=True):
         """Lock the non-store parts of the repository."""
 
     def currentwlock():
         """Return the wlock if it's held or None."""
 
     def checkcommitpatterns(wctx, match, status, fail):
```

### Comparing `mercurial-6.4rc0/mercurial/interfaces/util.py` & `mercurial-6.5rc0/mercurial/interfaces/util.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/keepalive.py` & `mercurial-6.5rc0/mercurial/keepalive.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/linelog.py` & `mercurial-6.5rc0/mercurial/linelog.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/localrepo.py` & `mercurial-6.5rc0/mercurial/localrepo.py`

 * *Files 2% similar despite different names*

```diff
@@ -472,8703 +472,8799 @@
 00001d70: 2020 2020 2727 2770 6565 7220 666f 7220      '''peer for 
 00001d80: 6120 6c6f 6361 6c20 7265 706f 3b20 7265  a local repo; re
 00001d90: 666c 6563 7473 206f 6e6c 7920 7468 6520  flects only the 
 00001da0: 6d6f 7374 2072 6563 656e 7420 4150 4927  most recent API'
 00001db0: 2727 0a0a 2020 2020 6465 6620 5f5f 696e  ''..    def __in
 00001dc0: 6974 5f5f 2873 656c 662c 2072 6570 6f2c  it__(self, repo,
 00001dd0: 2063 6170 733d 4e6f 6e65 2c20 7061 7468   caps=None, path
-00001de0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00001df0: 7375 7065 7228 6c6f 6361 6c70 6565 722c  super(localpeer,
-00001e00: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
-00001e10: 7265 706f 2e75 692c 2070 6174 683d 7061  repo.ui, path=pa
-00001e20: 7468 290a 0a20 2020 2020 2020 2069 6620  th)..        if 
-00001e30: 6361 7073 2069 7320 4e6f 6e65 3a0a 2020  caps is None:.  
-00001e40: 2020 2020 2020 2020 2020 6361 7073 203d            caps =
-00001e50: 206d 6f64 6572 6e63 6170 732e 636f 7079   moderncaps.copy
-00001e60: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00001e70: 5f72 6570 6f20 3d20 7265 706f 2e66 696c  _repo = repo.fil
-00001e80: 7465 7265 6428 6227 7365 7276 6564 2729  tered(b'served')
-00001e90: 0a0a 2020 2020 2020 2020 6966 2072 6570  ..        if rep
-00001ea0: 6f2e 5f77 616e 7465 645f 7369 6465 6461  o._wanted_sideda
-00001eb0: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-00001ec0: 666f 726d 6174 7465 6420 3d20 6275 6e64  formatted = bund
-00001ed0: 6c65 322e 666f 726d 6174 5f72 656d 6f74  le2.format_remot
-00001ee0: 655f 7761 6e74 6564 5f73 6964 6564 6174  e_wanted_sidedat
-00001ef0: 6128 7265 706f 290a 2020 2020 2020 2020  a(repo).        
-00001f00: 2020 2020 6361 7073 2e61 6464 2862 2765      caps.add(b'e
-00001f10: 7870 2d77 616e 7465 642d 7369 6465 6461  xp-wanted-sideda
-00001f20: 7461 3d27 202b 2066 6f72 6d61 7474 6564  ta=' + formatted
-00001f30: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00001f40: 5f63 6170 7320 3d20 7265 706f 2e5f 7265  _caps = repo._re
-00001f50: 7374 7269 6374 6361 7061 6269 6c69 7469  strictcapabiliti
-00001f60: 6573 2863 6170 7329 0a0a 2020 2020 2320  es(caps)..    # 
-00001f70: 4265 6769 6e20 6f66 205f 6261 7365 7065  Begin of _basepe
-00001f80: 6572 2069 6e74 6572 6661 6365 2e0a 0a20  er interface... 
-00001f90: 2020 2064 6566 2075 726c 2873 656c 6629     def url(self)
-00001fa0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00001fb0: 2073 656c 662e 5f72 6570 6f2e 7572 6c28   self._repo.url(
-00001fc0: 290a 0a20 2020 2064 6566 206c 6f63 616c  )..    def local
-00001fd0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00001fe0: 7265 7475 726e 2073 656c 662e 5f72 6570  return self._rep
-00001ff0: 6f0a 0a20 2020 2064 6566 2063 616e 7075  o..    def canpu
-00002000: 7368 2873 656c 6629 3a0a 2020 2020 2020  sh(self):.      
-00002010: 2020 7265 7475 726e 2054 7275 650a 0a20    return True.. 
-00002020: 2020 2064 6566 2063 6c6f 7365 2873 656c     def close(sel
-00002030: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
-00002040: 2e5f 7265 706f 2e63 6c6f 7365 2829 0a0a  ._repo.close()..
-00002050: 2020 2020 2320 456e 6420 6f66 205f 6261      # End of _ba
-00002060: 7365 7065 6572 2069 6e74 6572 6661 6365  sepeer interface
-00002070: 2e0a 0a20 2020 2023 2042 6567 696e 206f  ...    # Begin o
-00002080: 6620 5f62 6173 6577 6972 6563 6f6d 6d61  f _basewirecomma
-00002090: 6e64 7320 696e 7465 7266 6163 652e 0a0a  nds interface...
-000020a0: 2020 2020 6465 6620 6272 616e 6368 6d61      def branchma
-000020b0: 7028 7365 6c66 293a 0a20 2020 2020 2020  p(self):.       
-000020c0: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-000020d0: 706f 2e62 7261 6e63 686d 6170 2829 0a0a  po.branchmap()..
-000020e0: 2020 2020 6465 6620 6361 7061 6269 6c69      def capabili
-000020f0: 7469 6573 2873 656c 6629 3a0a 2020 2020  ties(self):.    
-00002100: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00002110: 5f63 6170 730a 0a20 2020 2064 6566 2063  _caps..    def c
-00002120: 6c6f 6e65 6275 6e64 6c65 7328 7365 6c66  lonebundles(self
-00002130: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00002140: 6e20 7365 6c66 2e5f 7265 706f 2e74 7279  n self._repo.try
-00002150: 7265 6164 2862 756e 646c 6563 6163 6865  read(bundlecache
-00002160: 732e 4342 5f4d 414e 4946 4553 545f 4649  s.CB_MANIFEST_FI
-00002170: 4c45 290a 0a20 2020 2064 6566 2064 6562  LE)..    def deb
-00002180: 7567 7769 7265 6172 6773 2873 656c 662c  ugwireargs(self,
-00002190: 206f 6e65 2c20 7477 6f2c 2074 6872 6565   one, two, three
-000021a0: 3d4e 6f6e 652c 2066 6f75 723d 4e6f 6e65  =None, four=None
-000021b0: 2c20 6669 7665 3d4e 6f6e 6529 3a0a 2020  , five=None):.  
-000021c0: 2020 2020 2020 2222 2255 7365 6420 746f        """Used to
-000021d0: 2074 6573 7420 6172 6775 6d65 6e74 2070   test argument p
-000021e0: 6173 7369 6e67 206f 7665 7220 7468 6520  assing over the 
-000021f0: 7769 7265 2222 220a 2020 2020 2020 2020  wire""".        
-00002200: 7265 7475 726e 2062 2225 7320 2573 2025  return b"%s %s %
-00002210: 7320 2573 2025 7322 2025 2028 0a20 2020  s %s %s" % (.   
-00002220: 2020 2020 2020 2020 206f 6e65 2c0a 2020           one,.  
-00002230: 2020 2020 2020 2020 2020 7477 6f2c 0a20            two,. 
-00002240: 2020 2020 2020 2020 2020 2070 7963 6f6d             pycom
-00002250: 7061 742e 6279 7465 7374 7228 7468 7265  pat.bytestr(thre
-00002260: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-00002270: 7079 636f 6d70 6174 2e62 7974 6573 7472  pycompat.bytestr
-00002280: 2866 6f75 7229 2c0a 2020 2020 2020 2020  (four),.        
-00002290: 2020 2020 7079 636f 6d70 6174 2e62 7974      pycompat.byt
-000022a0: 6573 7472 2866 6976 6529 2c0a 2020 2020  estr(five),.    
-000022b0: 2020 2020 290a 0a20 2020 2064 6566 2067      )..    def g
-000022c0: 6574 6275 6e64 6c65 280a 2020 2020 2020  etbundle(.      
-000022d0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-000022e0: 736f 7572 6365 2c0a 2020 2020 2020 2020  source,.        
-000022f0: 6865 6164 733d 4e6f 6e65 2c0a 2020 2020  heads=None,.    
-00002300: 2020 2020 636f 6d6d 6f6e 3d4e 6f6e 652c      common=None,
-00002310: 0a20 2020 2020 2020 2062 756e 646c 6563  .        bundlec
-00002320: 6170 733d 4e6f 6e65 2c0a 2020 2020 2020  aps=None,.      
-00002330: 2020 7265 6d6f 7465 5f73 6964 6564 6174    remote_sidedat
-00002340: 613d 4e6f 6e65 2c0a 2020 2020 2020 2020  a=None,.        
-00002350: 2a2a 6b77 6172 6773 0a20 2020 2029 3a0a  **kwargs.    ):.
-00002360: 2020 2020 2020 2020 6368 756e 6b73 203d          chunks =
-00002370: 2065 7863 6861 6e67 652e 6765 7462 756e   exchange.getbun
-00002380: 646c 6563 6875 6e6b 7328 0a20 2020 2020  dlechunks(.     
-00002390: 2020 2020 2020 2073 656c 662e 5f72 6570         self._rep
-000023a0: 6f2c 0a20 2020 2020 2020 2020 2020 2073  o,.            s
-000023b0: 6f75 7263 652c 0a20 2020 2020 2020 2020  ource,.         
-000023c0: 2020 2068 6561 6473 3d68 6561 6473 2c0a     heads=heads,.
-000023d0: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
-000023e0: 6f6e 3d63 6f6d 6d6f 6e2c 0a20 2020 2020  on=common,.     
-000023f0: 2020 2020 2020 2062 756e 646c 6563 6170         bundlecap
-00002400: 733d 6275 6e64 6c65 6361 7073 2c0a 2020  s=bundlecaps,.  
-00002410: 2020 2020 2020 2020 2020 7265 6d6f 7465            remote
-00002420: 5f73 6964 6564 6174 613d 7265 6d6f 7465  _sidedata=remote
-00002430: 5f73 6964 6564 6174 612c 0a20 2020 2020  _sidedata,.     
-00002440: 2020 2020 2020 202a 2a6b 7761 7267 730a         **kwargs.
-00002450: 2020 2020 2020 2020 295b 315d 0a20 2020          )[1].   
-00002460: 2020 2020 2063 6220 3d20 7574 696c 2e63       cb = util.c
-00002470: 6875 6e6b 6275 6666 6572 2863 6875 6e6b  hunkbuffer(chunk
-00002480: 7329 0a0a 2020 2020 2020 2020 6966 2065  s)..        if e
-00002490: 7863 6861 6e67 652e 6275 6e64 6c65 3272  xchange.bundle2r
-000024a0: 6571 7565 7374 6564 2862 756e 646c 6563  equested(bundlec
-000024b0: 6170 7329 3a0a 2020 2020 2020 2020 2020  aps):.          
-000024c0: 2020 2320 5768 656e 2072 6571 7565 7374    # When request
-000024d0: 696e 6720 6120 6275 6e64 6c65 322c 2067  ing a bundle2, g
-000024e0: 6574 6275 6e64 6c65 2072 6574 7572 6e73  etbundle returns
-000024f0: 2061 2073 7472 6561 6d20 746f 206d 616b   a stream to mak
-00002500: 6520 7468 650a 2020 2020 2020 2020 2020  e the.          
-00002510: 2020 2320 7769 7265 206c 6576 656c 2066    # wire level f
-00002520: 756e 6374 696f 6e20 6861 7070 6965 722e  unction happier.
-00002530: 2057 6520 6e65 6564 2074 6f20 6275 696c   We need to buil
-00002540: 6420 6120 7072 6f70 6572 206f 626a 6563  d a proper objec
-00002550: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
-00002560: 6672 6f6d 2069 7420 696e 206c 6f63 616c  from it in local
-00002570: 2070 6565 722e 0a20 2020 2020 2020 2020   peer..         
-00002580: 2020 2072 6574 7572 6e20 6275 6e64 6c65     return bundle
-00002590: 322e 6765 7475 6e62 756e 646c 6572 2873  2.getunbundler(s
-000025a0: 656c 662e 7569 2c20 6362 290a 2020 2020  elf.ui, cb).    
-000025b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000025c0: 2020 2020 2020 7265 7475 726e 2063 6861        return cha
-000025d0: 6e67 6567 726f 7570 2e67 6574 756e 6275  ngegroup.getunbu
-000025e0: 6e64 6c65 7228 6227 3031 272c 2063 622c  ndler(b'01', cb,
-000025f0: 204e 6f6e 6529 0a0a 2020 2020 6465 6620   None)..    def 
-00002600: 6865 6164 7328 7365 6c66 293a 0a20 2020  heads(self):.   
-00002610: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00002620: 2e5f 7265 706f 2e68 6561 6473 2829 0a0a  ._repo.heads()..
-00002630: 2020 2020 6465 6620 6b6e 6f77 6e28 7365      def known(se
-00002640: 6c66 2c20 6e6f 6465 7329 3a0a 2020 2020  lf, nodes):.    
-00002650: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00002660: 5f72 6570 6f2e 6b6e 6f77 6e28 6e6f 6465  _repo.known(node
-00002670: 7329 0a0a 2020 2020 6465 6620 6c69 7374  s)..    def list
-00002680: 6b65 7973 2873 656c 662c 206e 616d 6573  keys(self, names
-00002690: 7061 6365 293a 0a20 2020 2020 2020 2072  pace):.        r
-000026a0: 6574 7572 6e20 7365 6c66 2e5f 7265 706f  eturn self._repo
-000026b0: 2e6c 6973 746b 6579 7328 6e61 6d65 7370  .listkeys(namesp
-000026c0: 6163 6529 0a0a 2020 2020 6465 6620 6c6f  ace)..    def lo
-000026d0: 6f6b 7570 2873 656c 662c 206b 6579 293a  okup(self, key):
-000026e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000026f0: 7365 6c66 2e5f 7265 706f 2e6c 6f6f 6b75  self._repo.looku
-00002700: 7028 6b65 7929 0a0a 2020 2020 6465 6620  p(key)..    def 
-00002710: 7075 7368 6b65 7928 7365 6c66 2c20 6e61  pushkey(self, na
-00002720: 6d65 7370 6163 652c 206b 6579 2c20 6f6c  mespace, key, ol
-00002730: 642c 206e 6577 293a 0a20 2020 2020 2020  d, new):.       
-00002740: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-00002750: 706f 2e70 7573 686b 6579 286e 616d 6573  po.pushkey(names
-00002760: 7061 6365 2c20 6b65 792c 206f 6c64 2c20  pace, key, old, 
-00002770: 6e65 7729 0a0a 2020 2020 6465 6620 7374  new)..    def st
-00002780: 7265 616d 5f6f 7574 2873 656c 6629 3a0a  ream_out(self):.
-00002790: 2020 2020 2020 2020 7261 6973 6520 6572          raise er
-000027a0: 726f 722e 4162 6f72 7428 5f28 6227 6361  ror.Abort(_(b'ca
-000027b0: 6e6e 6f74 2070 6572 666f 726d 2073 7472  nnot perform str
-000027c0: 6561 6d20 636c 6f6e 6520 6167 6169 6e73  eam clone agains
-000027d0: 7420 6c6f 6361 6c20 7065 6572 2729 290a  t local peer')).
-000027e0: 0a20 2020 2064 6566 2075 6e62 756e 646c  .    def unbundl
-000027f0: 6528 7365 6c66 2c20 6275 6e64 6c65 2c20  e(self, bundle, 
-00002800: 6865 6164 732c 2075 726c 293a 0a20 2020  heads, url):.   
-00002810: 2020 2020 2022 2222 6170 706c 7920 6120       """apply a 
-00002820: 6275 6e64 6c65 206f 6e20 6120 7265 706f  bundle on a repo
-00002830: 0a0a 2020 2020 2020 2020 5468 6973 2066  ..        This f
-00002840: 756e 6374 696f 6e20 6861 6e64 6c65 7320  unction handles 
-00002850: 7468 6520 7265 706f 206c 6f63 6b69 6e67  the repo locking
-00002860: 2069 7473 656c 662e 2222 220a 2020 2020   itself.""".    
-00002870: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00002880: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00002890: 2020 2020 2020 2020 2020 6275 6e64 6c65            bundle
-000028a0: 203d 2065 7863 6861 6e67 652e 7265 6164   = exchange.read
-000028b0: 6275 6e64 6c65 2873 656c 662e 7569 2c20  bundle(self.ui, 
-000028c0: 6275 6e64 6c65 2c20 4e6f 6e65 290a 2020  bundle, None).  
-000028d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000028e0: 7420 3d20 6578 6368 616e 6765 2e75 6e62  t = exchange.unb
-000028f0: 756e 646c 6528 7365 6c66 2e5f 7265 706f  undle(self._repo
-00002900: 2c20 6275 6e64 6c65 2c20 6865 6164 732c  , bundle, heads,
-00002910: 2062 2770 7573 6827 2c20 7572 6c29 0a20   b'push', url). 
-00002920: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00002930: 6620 7574 696c 2e73 6166 6568 6173 6174  f util.safehasat
-00002940: 7472 2872 6574 2c20 6227 6765 7463 6875  tr(ret, b'getchu
-00002950: 6e6b 7327 293a 0a20 2020 2020 2020 2020  nks'):.         
-00002960: 2020 2020 2020 2020 2020 2023 2054 6869             # Thi
-00002970: 7320 6973 2061 2062 756e 646c 6532 3020  s is a bundle20 
-00002980: 6f62 6a65 6374 2c20 7475 726e 2069 7420  object, turn it 
-00002990: 696e 746f 2061 6e20 756e 6275 6e64 6c65  into an unbundle
-000029a0: 722e 0a20 2020 2020 2020 2020 2020 2020  r..             
-000029b0: 2020 2020 2020 2023 2054 6869 7320 6c69         # This li
-000029c0: 7474 6c65 2064 616e 6365 2073 686f 756c  ttle dance shoul
-000029d0: 6420 6265 2064 726f 7070 6564 2065 7665  d be dropped eve
-000029e0: 6e74 7561 6c6c 7920 7768 656e 2074 6865  ntually when the
-000029f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002a00: 2020 2020 2023 2041 5049 2069 7320 6669       # API is fi
-00002a10: 6e61 6c6c 7920 696d 7072 6f76 6564 2e0a  nally improved..
-00002a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002a30: 2020 2020 7374 7265 616d 203d 2075 7469      stream = uti
-00002a40: 6c2e 6368 756e 6b62 7566 6665 7228 7265  l.chunkbuffer(re
-00002a50: 742e 6765 7463 6875 6e6b 7328 2929 0a20  t.getchunks()). 
-00002a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002a70: 2020 2072 6574 203d 2062 756e 646c 6532     ret = bundle2
-00002a80: 2e67 6574 756e 6275 6e64 6c65 7228 7365  .getunbundler(se
-00002a90: 6c66 2e75 692c 2073 7472 6561 6d29 0a20  lf.ui, stream). 
-00002aa0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00002ab0: 6574 7572 6e20 7265 740a 2020 2020 2020  eturn ret.      
-00002ac0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00002ad0: 6570 7469 6f6e 2061 7320 6578 633a 0a20  eption as exc:. 
-00002ae0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00002af0: 2049 6620 7468 6520 6578 6365 7074 696f   If the exceptio
-00002b00: 6e20 636f 6e74 6169 6e73 206f 7574 7075  n contains outpu
-00002b10: 7420 7361 6c76 6167 6564 2066 726f 6d20  t salvaged from 
-00002b20: 6120 6275 6e64 6c65 320a 2020 2020 2020  a bundle2.      
-00002b30: 2020 2020 2020 2020 2020 2320 7265 706c            # repl
-00002b40: 792c 2077 6520 6e65 6564 2074 6f20 6d61  y, we need to ma
-00002b50: 6b65 2073 7572 6520 6974 2069 7320 7072  ke sure it is pr
-00002b60: 696e 7465 6420 6265 666f 7265 2063 6f6e  inted before con
-00002b70: 7469 6e75 696e 670a 2020 2020 2020 2020  tinuing.        
-00002b80: 2020 2020 2020 2020 2320 746f 2066 6169          # to fai
-00002b90: 6c2e 2053 6f20 7765 2062 7569 6c64 2061  l. So we build a
-00002ba0: 2062 756e 646c 6532 2077 6974 6820 7375   bundle2 with su
-00002bb0: 6368 206f 7574 7075 7420 616e 6420 636f  ch output and co
-00002bc0: 6e73 756d 650a 2020 2020 2020 2020 2020  nsume.          
-00002bd0: 2020 2020 2020 2320 6974 2064 6972 6563        # it direc
-00002be0: 746c 792e 0a20 2020 2020 2020 2020 2020  tly..           
-00002bf0: 2020 2020 2023 0a20 2020 2020 2020 2020       #.         
-00002c00: 2020 2020 2020 2023 2054 6869 7320 6973         # This is
-00002c10: 206e 6f74 2076 6572 7920 656c 6567 616e   not very elegan
-00002c20: 7420 6275 7420 616c 6c6f 7773 2061 2022  t but allows a "
-00002c30: 7369 6d70 6c65 2220 736f 6c75 7469 6f6e  simple" solution
-00002c40: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
-00002c50: 2020 2020 2023 2069 7373 7565 3435 3934       # issue4594
-00002c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002c70: 206f 7574 7075 7420 3d20 6765 7461 7474   output = getatt
-00002c80: 7228 6578 632c 2027 5f62 756e 646c 6532  r(exc, '_bundle2
-00002c90: 7361 6c76 6167 6564 6f75 7470 7574 272c  salvagedoutput',
-00002ca0: 2028 2929 0a20 2020 2020 2020 2020 2020   ()).           
-00002cb0: 2020 2020 2069 6620 6f75 7470 7574 3a0a       if output:.
-00002cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002cd0: 2020 2020 6275 6e64 6c65 7220 3d20 6275      bundler = bu
-00002ce0: 6e64 6c65 322e 6275 6e64 6c65 3230 2873  ndle2.bundle20(s
-00002cf0: 656c 662e 5f72 6570 6f2e 7569 290a 2020  elf._repo.ui).  
-00002d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d10: 2020 666f 7220 6f75 7420 696e 206f 7574    for out in out
-00002d20: 7075 743a 0a20 2020 2020 2020 2020 2020  put:.           
-00002d30: 2020 2020 2020 2020 2020 2020 2062 756e               bun
-00002d40: 646c 6572 2e61 6464 7061 7274 286f 7574  dler.addpart(out
-00002d50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00002d60: 2020 2020 2020 7374 7265 616d 203d 2075        stream = u
-00002d70: 7469 6c2e 6368 756e 6b62 7566 6665 7228  til.chunkbuffer(
-00002d80: 6275 6e64 6c65 722e 6765 7463 6875 6e6b  bundler.getchunk
-00002d90: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
-00002da0: 2020 2020 2020 2020 2062 203d 2062 756e           b = bun
-00002db0: 646c 6532 2e67 6574 756e 6275 6e64 6c65  dle2.getunbundle
-00002dc0: 7228 7365 6c66 2e75 692c 2073 7472 6561  r(self.ui, strea
-00002dd0: 6d29 0a20 2020 2020 2020 2020 2020 2020  m).             
-00002de0: 2020 2020 2020 2062 756e 646c 6532 2e70         bundle2.p
-00002df0: 726f 6365 7373 6275 6e64 6c65 2873 656c  rocessbundle(sel
-00002e00: 662e 5f72 6570 6f2c 2062 290a 2020 2020  f._repo, b).    
-00002e10: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00002e20: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-00002e30: 2065 7272 6f72 2e50 7573 6852 6163 6564   error.PushRaced
-00002e40: 2061 7320 6578 633a 0a20 2020 2020 2020   as exc:.       
-00002e50: 2020 2020 2072 6169 7365 2065 7272 6f72       raise error
-00002e60: 2e52 6573 706f 6e73 6545 7272 6f72 280a  .ResponseError(.
-00002e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e80: 5f28 6227 7075 7368 2066 6169 6c65 643a  _(b'push failed:
-00002e90: 2729 2c20 7374 7269 6e67 7574 696c 2e66  '), stringutil.f
-00002ea0: 6f72 6365 6279 7465 7374 7228 6578 6329  orcebytestr(exc)
-00002eb0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00002ec0: 2020 2020 2320 456e 6420 6f66 205f 6261      # End of _ba
-00002ed0: 7365 7769 7265 636f 6d6d 616e 6473 2069  sewirecommands i
-00002ee0: 6e74 6572 6661 6365 2e0a 0a20 2020 2023  nterface...    #
-00002ef0: 2042 6567 696e 206f 6620 7065 6572 2069   Begin of peer i
-00002f00: 6e74 6572 6661 6365 2e0a 0a20 2020 2064  nterface...    d
-00002f10: 6566 2063 6f6d 6d61 6e64 6578 6563 7574  ef commandexecut
-00002f20: 6f72 2873 656c 6629 3a0a 2020 2020 2020  or(self):.      
-00002f30: 2020 7265 7475 726e 206c 6f63 616c 636f    return localco
-00002f40: 6d6d 616e 6465 7865 6375 746f 7228 7365  mmandexecutor(se
-00002f50: 6c66 290a 0a20 2020 2023 2045 6e64 206f  lf)..    # End o
-00002f60: 6620 7065 6572 2069 6e74 6572 6661 6365  f peer interface
-00002f70: 2e0a 0a0a 4069 6e74 6572 6661 6365 7574  ....@interfaceut
-00002f80: 696c 2e69 6d70 6c65 6d65 6e74 6572 2872  il.implementer(r
-00002f90: 6570 6f73 6974 6f72 792e 6970 6565 726c  epository.ipeerl
-00002fa0: 6567 6163 7963 6f6d 6d61 6e64 7329 0a63  egacycommands).c
-00002fb0: 6c61 7373 206c 6f63 616c 6c65 6761 6379  lass locallegacy
-00002fc0: 7065 6572 286c 6f63 616c 7065 6572 293a  peer(localpeer):
-00002fd0: 0a20 2020 2022 2222 7065 6572 2065 7874  .    """peer ext
-00002fe0: 656e 7369 6f6e 2077 6869 6368 2069 6d70  ension which imp
-00002ff0: 6c65 6d65 6e74 7320 6c65 6761 6379 206d  lements legacy m
-00003000: 6574 686f 6473 2074 6f6f 3b20 7573 6564  ethods too; used
-00003010: 2066 6f72 2074 6573 7473 2077 6974 680a   for tests with.
-00003020: 2020 2020 7265 7374 7269 6374 6564 2063      restricted c
-00003030: 6170 6162 696c 6974 6965 7322 2222 0a0a  apabilities"""..
-00003040: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00003050: 2873 656c 662c 2072 6570 6f2c 2070 6174  (self, repo, pat
-00003060: 683d 4e6f 6e65 293a 0a20 2020 2020 2020  h=None):.       
-00003070: 2073 7570 6572 286c 6f63 616c 6c65 6761   super(locallega
-00003080: 6379 7065 6572 2c20 7365 6c66 292e 5f5f  cypeer, self).__
-00003090: 696e 6974 5f5f 2872 6570 6f2c 2063 6170  init__(repo, cap
-000030a0: 733d 6c65 6761 6379 6361 7073 2c20 7061  s=legacycaps, pa
-000030b0: 7468 3d70 6174 6829 0a0a 2020 2020 2320  th=path)..    # 
-000030c0: 4265 6769 6e20 6f66 2062 6173 656c 6567  Begin of baseleg
-000030d0: 6163 7977 6972 6563 6f6d 6d61 6e64 7320  acywirecommands 
-000030e0: 696e 7465 7266 6163 652e 0a0a 2020 2020  interface...    
-000030f0: 6465 6620 6265 7477 6565 6e28 7365 6c66  def between(self
-00003100: 2c20 7061 6972 7329 3a0a 2020 2020 2020  , pairs):.      
-00003110: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
-00003120: 6570 6f2e 6265 7477 6565 6e28 7061 6972  epo.between(pair
-00003130: 7329 0a0a 2020 2020 6465 6620 6272 616e  s)..    def bran
-00003140: 6368 6573 2873 656c 662c 206e 6f64 6573  ches(self, nodes
-00003150: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00003160: 6e20 7365 6c66 2e5f 7265 706f 2e62 7261  n self._repo.bra
-00003170: 6e63 6865 7328 6e6f 6465 7329 0a0a 2020  nches(nodes)..  
-00003180: 2020 6465 6620 6368 616e 6765 6772 6f75    def changegrou
-00003190: 7028 7365 6c66 2c20 6e6f 6465 732c 2073  p(self, nodes, s
-000031a0: 6f75 7263 6529 3a0a 2020 2020 2020 2020  ource):.        
-000031b0: 6f75 7467 6f69 6e67 203d 2064 6973 636f  outgoing = disco
-000031c0: 7665 7279 2e6f 7574 676f 696e 6728 0a20  very.outgoing(. 
-000031d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000031e0: 5f72 6570 6f2c 206d 6973 7369 6e67 726f  _repo, missingro
-000031f0: 6f74 733d 6e6f 6465 732c 2061 6e63 6573  ots=nodes, ances
-00003200: 746f 7273 6f66 3d73 656c 662e 5f72 6570  torsof=self._rep
-00003210: 6f2e 6865 6164 7328 290a 2020 2020 2020  o.heads().      
-00003220: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-00003230: 726e 2063 6861 6e67 6567 726f 7570 2e6d  rn changegroup.m
-00003240: 616b 6563 6861 6e67 6567 726f 7570 2873  akechangegroup(s
-00003250: 656c 662e 5f72 6570 6f2c 206f 7574 676f  elf._repo, outgo
-00003260: 696e 672c 2062 2730 3127 2c20 736f 7572  ing, b'01', sour
-00003270: 6365 290a 0a20 2020 2064 6566 2063 6861  ce)..    def cha
-00003280: 6e67 6567 726f 7570 7375 6273 6574 2873  ngegroupsubset(s
-00003290: 656c 662c 2062 6173 6573 2c20 6865 6164  elf, bases, head
-000032a0: 732c 2073 6f75 7263 6529 3a0a 2020 2020  s, source):.    
-000032b0: 2020 2020 6f75 7467 6f69 6e67 203d 2064      outgoing = d
-000032c0: 6973 636f 7665 7279 2e6f 7574 676f 696e  iscovery.outgoin
-000032d0: 6728 0a20 2020 2020 2020 2020 2020 2073  g(.            s
-000032e0: 656c 662e 5f72 6570 6f2c 206d 6973 7369  elf._repo, missi
-000032f0: 6e67 726f 6f74 733d 6261 7365 732c 2061  ngroots=bases, a
-00003300: 6e63 6573 746f 7273 6f66 3d68 6561 6473  ncestorsof=heads
-00003310: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00003320: 2020 2072 6574 7572 6e20 6368 616e 6765     return change
-00003330: 6772 6f75 702e 6d61 6b65 6368 616e 6765  group.makechange
-00003340: 6772 6f75 7028 7365 6c66 2e5f 7265 706f  group(self._repo
-00003350: 2c20 6f75 7467 6f69 6e67 2c20 6227 3031  , outgoing, b'01
-00003360: 272c 2073 6f75 7263 6529 0a0a 2020 2020  ', source)..    
-00003370: 2320 456e 6420 6f66 2062 6173 656c 6567  # End of baseleg
-00003380: 6163 7977 6972 6563 6f6d 6d61 6e64 7320  acywirecommands 
-00003390: 696e 7465 7266 6163 652e 0a0a 0a23 2046  interface....# F
-000033a0: 756e 6374 696f 6e73 2072 6563 6569 7669  unctions receivi
-000033b0: 6e67 2028 7569 2c20 6665 6174 7572 6573  ng (ui, features
-000033c0: 2920 7468 6174 2065 7874 656e 7369 6f6e  ) that extension
-000033d0: 7320 6361 6e20 7265 6769 7374 6572 2074  s can register t
-000033e0: 6f20 696d 7061 6374 0a23 2074 6865 2061  o impact.# the a
-000033f0: 6269 6c69 7479 2074 6f20 6c6f 6164 2072  bility to load r
-00003400: 6570 6f73 6974 6f72 6965 7320 7769 7468  epositories with
-00003410: 2063 7573 746f 6d20 7265 7175 6972 656d   custom requirem
-00003420: 656e 7473 2e20 4f6e 6c79 0a23 2066 756e  ents. Only.# fun
-00003430: 6374 696f 6e73 2064 6566 696e 6564 2069  ctions defined i
-00003440: 6e20 6c6f 6164 6564 2065 7874 656e 7369  n loaded extensi
-00003450: 6f6e 7320 6172 6520 6361 6c6c 6564 2e0a  ons are called..
-00003460: 230a 2320 5468 6520 6675 6e63 7469 6f6e  #.# The function
-00003470: 2072 6563 6569 7665 7320 6120 7365 7420   receives a set 
-00003480: 6f66 2072 6571 7569 7265 6d65 6e74 2073  of requirement s
-00003490: 7472 696e 6773 2074 6861 7420 7468 6520  trings that the 
-000034a0: 7265 706f 7369 746f 7279 0a23 2069 7320  repository.# is 
-000034b0: 6361 7061 626c 6520 6f66 206f 7065 6e69  capable of openi
-000034c0: 6e67 2e20 4675 6e63 7469 6f6e 7320 7769  ng. Functions wi
-000034d0: 6c6c 2074 7970 6963 616c 6c79 2061 6464  ll typically add
-000034e0: 2065 6c65 6d65 6e74 7320 746f 2074 6865   elements to the
-000034f0: 0a23 2073 6574 2074 6f20 7265 666c 6563  .# set to reflec
-00003500: 7420 7468 6174 2074 6865 2065 7874 656e  t that the exten
-00003510: 7369 6f6e 206b 6e6f 7773 2068 6f77 2074  sion knows how t
-00003520: 6f20 6861 6e64 6c65 2074 6861 7420 7265  o handle that re
-00003530: 7175 6972 656d 656e 7473 2e0a 6665 6174  quirements..feat
-00003540: 7572 6573 6574 7570 6675 6e63 7320 3d20  uresetupfuncs = 
-00003550: 7365 7428 290a 0a0a 6465 6620 5f67 6574  set()...def _get
-00003560: 7368 6172 6564 7666 7328 6867 7666 732c  sharedvfs(hgvfs,
-00003570: 2072 6571 7569 7265 6d65 6e74 7329 3a0a   requirements):.
-00003580: 2020 2020 2222 2272 6574 7572 6e73 2074      """returns t
-00003590: 6865 2076 6673 206f 626a 6563 7420 706f  he vfs object po
-000035a0: 696e 7469 6e67 2074 6f20 726f 6f74 206f  inting to root o
-000035b0: 6620 7368 6172 6564 2073 6f75 7263 650a  f shared source.
-000035c0: 2020 2020 7265 706f 2066 6f72 2061 2073      repo for a s
-000035d0: 6861 7265 6420 7265 706f 7369 746f 7279  hared repository
-000035e0: 0a0a 2020 2020 6867 7666 7320 6973 2076  ..    hgvfs is v
-000035f0: 6673 2070 6f69 6e74 696e 6720 6174 202e  fs pointing at .
-00003600: 6867 2f20 6f66 2063 7572 7265 6e74 2072  hg/ of current r
-00003610: 6570 6f20 2873 6861 7265 6420 6f6e 6529  epo (shared one)
-00003620: 0a20 2020 2072 6571 7569 7265 6d65 6e74  .    requirement
-00003630: 7320 6973 2061 2073 6574 206f 6620 7265  s is a set of re
-00003640: 7175 6972 656d 656e 7473 206f 6620 6375  quirements of cu
-00003650: 7272 656e 7420 7265 706f 2028 7368 6172  rrent repo (shar
-00003660: 6564 206f 6e65 290a 2020 2020 2222 220a  ed one).    """.
-00003670: 2020 2020 2320 5468 6520 6060 7368 6172      # The ``shar
-00003680: 6564 6060 206f 7220 6060 7265 6c73 6861  ed`` or ``relsha
-00003690: 7265 6460 6020 7265 7175 6972 656d 656e  red`` requiremen
-000036a0: 7473 2069 6e64 6963 6174 6520 7468 650a  ts indicate the.
-000036b0: 2020 2020 2320 7374 6f72 6520 6c69 7665      # store live
-000036c0: 7320 696e 2074 6865 2070 6174 6820 636f  s in the path co
-000036d0: 6e74 6169 6e65 6420 696e 2074 6865 2060  ntained in the `
-000036e0: 602e 6867 2f73 6861 7265 6470 6174 6860  `.hg/sharedpath`
-000036f0: 6020 6669 6c65 2e0a 2020 2020 2320 5468  ` file..    # Th
-00003700: 6973 2069 7320 616e 2061 6273 6f6c 7574  is is an absolut
-00003710: 6520 7061 7468 2066 6f72 2060 6073 6861  e path for ``sha
-00003720: 7265 6460 6020 616e 6420 7265 6c61 7469  red`` and relati
-00003730: 7665 2074 6f0a 2020 2020 2320 6060 2e68  ve to.    # ``.h
-00003740: 672f 6060 2066 6f72 2060 6072 656c 7368  g/`` for ``relsh
-00003750: 6172 6564 6060 2e0a 2020 2020 7368 6172  ared``..    shar
-00003760: 6564 7061 7468 203d 2068 6776 6673 2e72  edpath = hgvfs.r
-00003770: 6561 6428 6227 7368 6172 6564 7061 7468  ead(b'sharedpath
-00003780: 2729 2e72 7374 7269 7028 6227 5c6e 2729  ').rstrip(b'\n')
-00003790: 0a20 2020 2069 6620 7265 7175 6972 656d  .    if requirem
-000037a0: 656e 7473 6d6f 642e 5245 4c41 5449 5645  entsmod.RELATIVE
-000037b0: 5f53 4841 5245 445f 5245 5155 4952 454d  _SHARED_REQUIREM
-000037c0: 454e 5420 696e 2072 6571 7569 7265 6d65  ENT in requireme
-000037d0: 6e74 733a 0a20 2020 2020 2020 2073 6861  nts:.        sha
-000037e0: 7265 6470 6174 6820 3d20 7574 696c 2e6e  redpath = util.n
-000037f0: 6f72 6d70 6174 6828 6867 7666 732e 6a6f  ormpath(hgvfs.jo
-00003800: 696e 2873 6861 7265 6470 6174 6829 290a  in(sharedpath)).
-00003810: 0a20 2020 2073 6861 7265 6476 6673 203d  .    sharedvfs =
-00003820: 2076 6673 6d6f 642e 7666 7328 7368 6172   vfsmod.vfs(shar
-00003830: 6564 7061 7468 2c20 7265 616c 7061 7468  edpath, realpath
-00003840: 3d54 7275 6529 0a0a 2020 2020 6966 206e  =True)..    if n
-00003850: 6f74 2073 6861 7265 6476 6673 2e65 7869  ot sharedvfs.exi
-00003860: 7374 7328 293a 0a20 2020 2020 2020 2072  sts():.        r
-00003870: 6169 7365 2065 7272 6f72 2e52 6570 6f45  aise error.RepoE
-00003880: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00003890: 2020 5f28 6227 2e68 672f 7368 6172 6564    _(b'.hg/shared
-000038a0: 7061 7468 2070 6f69 6e74 7320 746f 206e  path points to n
-000038b0: 6f6e 6578 6973 7465 6e74 2064 6972 6563  onexistent direc
-000038c0: 746f 7279 2025 7327 290a 2020 2020 2020  tory %s').      
-000038d0: 2020 2020 2020 2520 7368 6172 6564 7666        % sharedvf
-000038e0: 732e 6261 7365 0a20 2020 2020 2020 2029  s.base.        )
-000038f0: 0a20 2020 2072 6574 7572 6e20 7368 6172  .    return shar
-00003900: 6564 7666 730a 0a0a 6465 6620 5f72 6561  edvfs...def _rea
-00003910: 6472 6571 7569 7265 7328 7666 732c 2061  drequires(vfs, a
-00003920: 6c6c 6f77 6d69 7373 696e 6729 3a0a 2020  llowmissing):.  
-00003930: 2020 2222 2272 6561 6473 2074 6865 2072    """reads the r
-00003940: 6571 7569 7265 2066 696c 6520 7072 6573  equire file pres
-00003950: 656e 7420 6174 2072 6f6f 7420 6f66 2074  ent at root of t
-00003960: 6869 7320 7666 730a 2020 2020 616e 6420  his vfs.    and 
-00003970: 7265 7475 726e 2061 2073 6574 206f 6620  return a set of 
-00003980: 7265 7175 6972 656d 656e 7473 0a0a 2020  requirements..  
-00003990: 2020 4966 2061 6c6c 6f77 6d69 7373 696e    If allowmissin
-000039a0: 6720 6973 2054 7275 652c 2077 6520 7375  g is True, we su
-000039b0: 7070 7265 7373 2046 696c 654e 6f74 466f  ppress FileNotFo
-000039c0: 756e 6445 7272 6f72 2069 6620 7261 6973  undError if rais
-000039d0: 6564 2222 220a 2020 2020 2320 7265 7175  ed""".    # requ
-000039e0: 6972 6573 2066 696c 6520 636f 6e74 6169  ires file contai
-000039f0: 6e73 2061 206e 6577 6c69 6e65 2d64 656c  ns a newline-del
-00003a00: 696d 6974 6564 206c 6973 7420 6f66 0a20  imited list of. 
-00003a10: 2020 2023 2066 6561 7475 7265 732f 6361     # features/ca
-00003a20: 7061 6269 6c69 7469 6573 2074 6865 206f  pabilities the o
-00003a30: 7065 6e65 7220 2875 7329 206d 7573 7420  pener (us) must 
-00003a40: 6861 7665 2069 6e20 6f72 6465 7220 746f  have in order to
-00003a50: 2075 7365 0a20 2020 2023 2074 6865 2072   use.    # the r
-00003a60: 6570 6f73 6974 6f72 792e 2054 6869 7320  epository. This 
-00003a70: 6669 6c65 2077 6173 2069 6e74 726f 6475  file was introdu
-00003a80: 6365 6420 696e 204d 6572 6375 7269 616c  ced in Mercurial
-00003a90: 2030 2e39 2e32 2c0a 2020 2020 2320 7768   0.9.2,.    # wh
-00003aa0: 6963 6820 6d65 616e 7320 7665 7279 206f  ich means very o
-00003ab0: 6c64 2072 6570 6f73 6974 6f72 6965 7320  ld repositories 
-00003ac0: 6d61 7920 6e6f 7420 6861 7665 206f 6e65  may not have one
-00003ad0: 2e20 5765 2061 7373 756d 650a 2020 2020  . We assume.    
-00003ae0: 2320 6120 6d69 7373 696e 6720 6669 6c65  # a missing file
-00003af0: 2074 7261 6e73 6c61 7465 7320 746f 206e   translates to n
-00003b00: 6f20 7265 7175 6972 656d 656e 7473 2e0a  o requirements..
-00003b10: 2020 2020 7265 6164 203d 2076 6673 2e74      read = vfs.t
-00003b20: 7279 7265 6164 2069 6620 616c 6c6f 776d  ryread if allowm
-00003b30: 6973 7369 6e67 2065 6c73 6520 7666 732e  issing else vfs.
-00003b40: 7265 6164 0a20 2020 2072 6574 7572 6e20  read.    return 
-00003b50: 7365 7428 7265 6164 2862 2772 6571 7569  set(read(b'requi
-00003b60: 7265 7327 292e 7370 6c69 746c 696e 6573  res').splitlines
-00003b70: 2829 290a 0a0a 6465 6620 6d61 6b65 6c6f  ())...def makelo
-00003b80: 6361 6c72 6570 6f73 6974 6f72 7928 6261  calrepository(ba
-00003b90: 7365 7569 2c20 7061 7468 3a20 6279 7465  seui, path: byte
-00003ba0: 732c 2069 6e74 656e 7473 3d4e 6f6e 6529  s, intents=None)
-00003bb0: 3a0a 2020 2020 2222 2243 7265 6174 6520  :.    """Create 
-00003bc0: 6120 6c6f 6361 6c20 7265 706f 7369 746f  a local reposito
-00003bd0: 7279 206f 626a 6563 742e 0a0a 2020 2020  ry object...    
-00003be0: 4769 7665 6e20 6172 6775 6d65 6e74 7320  Given arguments 
-00003bf0: 6e65 6564 6564 2074 6f20 636f 6e73 7472  needed to constr
-00003c00: 7563 7420 6120 6c6f 6361 6c20 7265 706f  uct a local repo
-00003c10: 7369 746f 7279 2c20 7468 6973 2066 756e  sitory, this fun
-00003c20: 6374 696f 6e0a 2020 2020 7065 7266 6f72  ction.    perfor
-00003c30: 6d73 2076 6172 696f 7573 2065 6172 6c79  ms various early
-00003c40: 2072 6570 6f73 6974 6f72 7920 6c6f 6164   repository load
-00003c50: 696e 6720 6675 6e63 7469 6f6e 616c 6974  ing functionalit
-00003c60: 7920 2873 7563 6820 6173 0a20 2020 2072  y (such as.    r
-00003c70: 6561 6469 6e67 2074 6865 2060 602e 6867  eading the ``.hg
-00003c80: 2f72 6571 7569 7265 7360 6020 616e 6420  /requires`` and 
-00003c90: 6060 2e68 672f 6867 7263 6060 2066 696c  ``.hg/hgrc`` fil
-00003ca0: 6573 292c 2076 616c 6964 6174 6573 2074  es), validates t
-00003cb0: 6861 740a 2020 2020 7468 6520 7265 706f  hat.    the repo
-00003cc0: 7369 746f 7279 2063 616e 2062 6520 6f70  sitory can be op
-00003cd0: 656e 6564 2c20 6465 7269 7665 7320 6120  ened, derives a 
-00003ce0: 7479 7065 2073 7569 7461 626c 6520 666f  type suitable fo
-00003cf0: 7220 7265 7072 6573 656e 7469 6e67 0a20  r representing. 
-00003d00: 2020 2074 6861 7420 7265 706f 7369 746f     that reposito
-00003d10: 7279 2c20 616e 6420 7265 7475 726e 7320  ry, and returns 
-00003d20: 616e 2069 6e73 7461 6e63 6520 6f66 2069  an instance of i
-00003d30: 742e 0a0a 2020 2020 5468 6520 7265 7475  t...    The retu
-00003d40: 726e 6564 206f 626a 6563 7420 636f 6e66  rned object conf
-00003d50: 6f72 6d73 2074 6f20 7468 6520 6060 7265  orms to the ``re
-00003d60: 706f 7369 746f 7279 2e63 6f6d 706c 6574  pository.complet
-00003d70: 656c 6f63 616c 7265 706f 7369 746f 7279  elocalrepository
-00003d80: 6060 0a20 2020 2069 6e74 6572 6661 6365  ``.    interface
-00003d90: 2e0a 0a20 2020 2054 6865 2072 6570 6f73  ...    The repos
-00003da0: 6974 6f72 7920 7479 7065 2069 7320 6465  itory type is de
-00003db0: 7269 7665 6420 6279 2063 616c 6c69 6e67  rived by calling
-00003dc0: 2061 2073 6572 6965 7320 6f66 2066 6163   a series of fac
-00003dd0: 746f 7279 2066 756e 6374 696f 6e73 0a20  tory functions. 
-00003de0: 2020 2066 6f72 2065 6163 6820 6173 7065     for each aspe
-00003df0: 6374 2f69 6e74 6572 6661 6365 206f 6620  ct/interface of 
-00003e00: 7468 6520 6669 6e61 6c20 7265 706f 7369  the final reposi
-00003e10: 746f 7279 2e20 5468 6573 6520 6172 6520  tory. These are 
-00003e20: 6465 6669 6e65 6420 6279 0a20 2020 2060  defined by.    `
-00003e30: 6052 4550 4f5f 494e 5445 5246 4143 4553  `REPO_INTERFACES
-00003e40: 6060 2e0a 0a20 2020 2045 6163 6820 6661  ``...    Each fa
-00003e50: 6374 6f72 7920 6675 6e63 7469 6f6e 2069  ctory function i
-00003e60: 7320 6361 6c6c 6564 2074 6f20 7072 6f64  s called to prod
-00003e70: 7563 6520 6120 7479 7065 2069 6d70 6c65  uce a type imple
-00003e80: 6d65 6e74 696e 6720 6120 7370 6563 6966  menting a specif
-00003e90: 6963 0a20 2020 2069 6e74 6572 6661 6365  ic.    interface
-00003ea0: 2e20 5468 6520 6375 6d75 6c61 7469 7665  . The cumulative
-00003eb0: 206c 6973 7420 6f66 2072 6574 7572 6e65   list of returne
-00003ec0: 6420 7479 7065 7320 7769 6c6c 2062 6520  d types will be 
-00003ed0: 636f 6d62 696e 6564 2069 6e74 6f20 610a  combined into a.
-00003ee0: 2020 2020 6e65 7720 7479 7065 2061 6e64      new type and
-00003ef0: 2074 6861 7420 7479 7065 2077 696c 6c20   that type will 
-00003f00: 6265 2069 6e73 7461 6e74 6961 7465 6420  be instantiated 
-00003f10: 746f 2072 6570 7265 7365 6e74 2074 6865  to represent the
-00003f20: 206c 6f63 616c 0a20 2020 2072 6570 6f73   local.    repos
-00003f30: 6974 6f72 792e 0a0a 2020 2020 5468 6520  itory...    The 
-00003f40: 6661 6374 6f72 7920 6675 6e63 7469 6f6e  factory function
-00003f50: 7320 6561 6368 2072 6563 6569 7665 2076  s each receive v
-00003f60: 6172 696f 7573 2073 7461 7465 2074 6861  arious state tha
-00003f70: 7420 6d61 7920 6265 2063 6f6e 7375 6c74  t may be consult
-00003f80: 6564 0a20 2020 2061 7320 7061 7274 206f  ed.    as part o
-00003f90: 6620 6465 7269 7669 6e67 2061 2074 7970  f deriving a typ
-00003fa0: 652e 0a0a 2020 2020 4578 7465 6e73 696f  e...    Extensio
-00003fb0: 6e73 2073 686f 756c 6420 7772 6170 2074  ns should wrap t
-00003fc0: 6865 7365 2066 6163 746f 7279 2066 756e  hese factory fun
-00003fd0: 6374 696f 6e73 2074 6f20 6375 7374 6f6d  ctions to custom
-00003fe0: 697a 6520 7265 706f 7369 746f 7279 2074  ize repository t
-00003ff0: 7970 650a 2020 2020 6372 6561 7469 6f6e  ype.    creation
-00004000: 2e20 4e6f 7465 2074 6861 7420 616e 2065  . Note that an e
-00004010: 7874 656e 7369 6f6e 2773 2077 7261 7070  xtension's wrapp
-00004020: 6564 2066 756e 6374 696f 6e20 6d61 7920  ed function may 
-00004030: 6265 2063 616c 6c65 6420 6576 656e 2069  be called even i
-00004040: 660a 2020 2020 7468 6174 2065 7874 656e  f.    that exten
-00004050: 7369 6f6e 2069 7320 6e6f 7420 6c6f 6164  sion is not load
-00004060: 6564 2066 6f72 2074 6865 2072 6570 6f20  ed for the repo 
-00004070: 6265 696e 6720 636f 6e73 7472 7563 7465  being constructe
-00004080: 642e 2045 7874 656e 7369 6f6e 730a 2020  d. Extensions.  
-00004090: 2020 7368 6f75 6c64 2063 6865 636b 2069    should check i
-000040a0: 6620 7468 6569 7220 6060 5f5f 6e61 6d65  f their ``__name
-000040b0: 5f5f 6060 2061 7070 6561 7273 2069 6e20  __`` appears in 
-000040c0: 7468 650a 2020 2020 6060 6578 7465 6e73  the.    ``extens
-000040d0: 696f 6e6d 6f64 756c 656e 616d 6573 6060  ionmodulenames``
-000040e0: 2073 6574 2070 6173 7365 6420 746f 2074   set passed to t
-000040f0: 6865 2066 6163 746f 7279 2066 756e 6374  he factory funct
-00004100: 696f 6e20 616e 6420 6e6f 2d6f 7020 6966  ion and no-op if
-00004110: 0a20 2020 206e 6f74 2e0a 2020 2020 2222  .    not..    ""
-00004120: 220a 2020 2020 7569 203d 2062 6173 6575  ".    ui = baseu
-00004130: 692e 636f 7079 2829 0a20 2020 2023 2050  i.copy().    # P
-00004140: 7265 7665 6e74 2063 6f70 7969 6e67 2072  revent copying r
-00004150: 6570 6f20 636f 6e66 6967 7572 6174 696f  epo configuratio
-00004160: 6e2e 0a20 2020 2075 692e 636f 7079 203d  n..    ui.copy =
-00004170: 2062 6173 6575 692e 636f 7079 0a0a 2020   baseui.copy..  
-00004180: 2020 2320 576f 726b 696e 6720 6469 7265    # Working dire
-00004190: 6374 6f72 7920 5646 5320 726f 6f74 6564  ctory VFS rooted
-000041a0: 2061 7420 7265 706f 7369 746f 7279 2072   at repository r
-000041b0: 6f6f 742e 0a20 2020 2077 6469 7276 6673  oot..    wdirvfs
-000041c0: 203d 2076 6673 6d6f 642e 7666 7328 7061   = vfsmod.vfs(pa
-000041d0: 7468 2c20 6578 7061 6e64 7061 7468 3d54  th, expandpath=T
-000041e0: 7275 652c 2072 6561 6c70 6174 683d 5472  rue, realpath=Tr
-000041f0: 7565 290a 0a20 2020 2023 204d 6169 6e20  ue)..    # Main 
-00004200: 5646 5320 666f 7220 2e68 672f 2064 6972  VFS for .hg/ dir
-00004210: 6563 746f 7279 2e0a 2020 2020 6867 7061  ectory..    hgpa
-00004220: 7468 203d 2077 6469 7276 6673 2e6a 6f69  th = wdirvfs.joi
-00004230: 6e28 6227 2e68 6727 290a 2020 2020 6867  n(b'.hg').    hg
-00004240: 7666 7320 3d20 7666 736d 6f64 2e76 6673  vfs = vfsmod.vfs
-00004250: 2868 6770 6174 682c 2063 6163 6865 6175  (hgpath, cacheau
-00004260: 6469 7465 643d 5472 7565 290a 2020 2020  dited=True).    
-00004270: 2320 5768 6574 6865 7220 7468 6973 2072  # Whether this r
-00004280: 6570 6f73 6974 6f72 7920 6973 2073 6861  epository is sha
-00004290: 7265 6420 6f6e 6520 6f72 206e 6f74 0a20  red one or not. 
-000042a0: 2020 2073 6861 7265 6420 3d20 4661 6c73     shared = Fals
-000042b0: 650a 2020 2020 2320 4966 2074 6869 7320  e.    # If this 
-000042c0: 7265 706f 7369 746f 7279 2069 7320 7368  repository is sh
-000042d0: 6172 6564 2c20 7666 7320 706f 696e 7469  ared, vfs pointi
-000042e0: 6e67 2074 6f20 7368 6172 6564 2072 6570  ng to shared rep
-000042f0: 6f0a 2020 2020 7368 6172 6564 7666 7320  o.    sharedvfs 
-00004300: 3d20 4e6f 6e65 0a0a 2020 2020 2320 5468  = None..    # Th
-00004310: 6520 2e68 672f 2070 6174 6820 7368 6f75  e .hg/ path shou
-00004320: 6c64 2065 7869 7374 2061 6e64 2073 686f  ld exist and sho
-00004330: 756c 6420 6265 2061 2064 6972 6563 746f  uld be a directo
-00004340: 7279 2e20 416c 6c20 6f74 6865 720a 2020  ry. All other.  
-00004350: 2020 2320 6361 7365 7320 6172 6520 6572    # cases are er
-00004360: 726f 7273 2e0a 2020 2020 6966 206e 6f74  rors..    if not
-00004370: 2068 6776 6673 2e69 7364 6972 2829 3a0a   hgvfs.isdir():.
-00004380: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00004390: 2020 2020 2020 2020 2068 6776 6673 2e73           hgvfs.s
-000043a0: 7461 7428 290a 2020 2020 2020 2020 6578  tat().        ex
-000043b0: 6365 7074 2046 696c 654e 6f74 466f 756e  cept FileNotFoun
-000043c0: 6445 7272 6f72 3a0a 2020 2020 2020 2020  dError:.        
-000043d0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-000043e0: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
-000043f0: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
-00004400: 2020 2020 2023 2043 616e 2062 6520 7261       # Can be ra
-00004410: 6973 6564 206f 6e20 5079 7468 6f6e 2033  ised on Python 3
-00004420: 2e38 2077 6865 6e20 7061 7468 2069 7320  .8 when path is 
-00004430: 696e 7661 6c69 642e 0a20 2020 2020 2020  invalid..       
-00004440: 2020 2020 2072 6169 7365 2065 7272 6f72       raise error
-00004450: 2e41 626f 7274 280a 2020 2020 2020 2020  .Abort(.        
-00004460: 2020 2020 2020 2020 5f28 6227 696e 7661          _(b'inva
-00004470: 6c69 6420 7061 7468 2025 733a 2025 7327  lid path %s: %s'
-00004480: 2920 2520 2870 6174 682c 2073 7472 696e  ) % (path, strin
-00004490: 6775 7469 6c2e 666f 7263 6562 7974 6573  gutil.forcebytes
-000044a0: 7472 2865 2929 0a20 2020 2020 2020 2020  tr(e)).         
-000044b0: 2020 2029 0a0a 2020 2020 2020 2020 7261     )..        ra
-000044c0: 6973 6520 6572 726f 722e 5265 706f 4572  ise error.RepoEr
-000044d0: 726f 7228 5f28 6227 7265 706f 7369 746f  ror(_(b'reposito
-000044e0: 7279 2025 7320 6e6f 7420 666f 756e 6427  ry %s not found'
-000044f0: 2920 2520 7061 7468 290a 0a20 2020 2072  ) % path)..    r
-00004500: 6571 7569 7265 6d65 6e74 7320 3d20 5f72  equirements = _r
-00004510: 6561 6472 6571 7569 7265 7328 6867 7666  eadrequires(hgvf
-00004520: 732c 2054 7275 6529 0a20 2020 2073 6861  s, True).    sha
-00004530: 7265 6420 3d20 280a 2020 2020 2020 2020  red = (.        
-00004540: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
-00004550: 5348 4152 4544 5f52 4551 5549 5245 4d45  SHARED_REQUIREME
-00004560: 4e54 2069 6e20 7265 7175 6972 656d 656e  NT in requiremen
-00004570: 7473 0a20 2020 2020 2020 206f 7220 7265  ts.        or re
-00004580: 7175 6972 656d 656e 7473 6d6f 642e 5245  quirementsmod.RE
-00004590: 4c41 5449 5645 5f53 4841 5245 445f 5245  LATIVE_SHARED_RE
-000045a0: 5155 4952 454d 454e 5420 696e 2072 6571  QUIREMENT in req
-000045b0: 7569 7265 6d65 6e74 730a 2020 2020 290a  uirements.    ).
-000045c0: 2020 2020 7374 6f72 6576 6673 203d 204e      storevfs = N
-000045d0: 6f6e 650a 2020 2020 6966 2073 6861 7265  one.    if share
-000045e0: 643a 0a20 2020 2020 2020 2023 2054 6869  d:.        # Thi
-000045f0: 7320 6973 2061 2073 6861 7265 6420 7265  s is a shared re
-00004600: 706f 0a20 2020 2020 2020 2073 6861 7265  po.        share
-00004610: 6476 6673 203d 205f 6765 7473 6861 7265  dvfs = _getshare
-00004620: 6476 6673 2868 6776 6673 2c20 7265 7175  dvfs(hgvfs, requ
-00004630: 6972 656d 656e 7473 290a 2020 2020 2020  irements).      
-00004640: 2020 7374 6f72 6576 6673 203d 2076 6673    storevfs = vfs
-00004650: 6d6f 642e 7666 7328 7368 6172 6564 7666  mod.vfs(sharedvf
-00004660: 732e 6a6f 696e 2862 2773 746f 7265 2729  s.join(b'store')
-00004670: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-00004680: 2020 2020 7374 6f72 6576 6673 203d 2076      storevfs = v
-00004690: 6673 6d6f 642e 7666 7328 6867 7666 732e  fsmod.vfs(hgvfs.
-000046a0: 6a6f 696e 2862 2773 746f 7265 2729 290a  join(b'store')).
-000046b0: 0a20 2020 2023 2069 6620 2e68 672f 7265  .    # if .hg/re
-000046c0: 7175 6972 6573 2063 6f6e 7461 696e 7320  quires contains 
-000046d0: 7468 6520 7368 6172 6573 6166 6520 7265  the sharesafe re
-000046e0: 7175 6972 656d 656e 742c 2069 7420 6d65  quirement, it me
-000046f0: 616e 730a 2020 2020 2320 7468 6572 6520  ans.    # there 
-00004700: 6578 6973 7473 2061 2060 2e68 672f 7374  exists a `.hg/st
-00004710: 6f72 652f 7265 7175 6972 6573 6020 746f  ore/requires` to
-00004720: 6f20 616e 6420 7765 2073 686f 756c 6420  o and we should 
-00004730: 7265 6164 2069 740a 2020 2020 2320 4e4f  read it.    # NO
-00004740: 5445 3a20 7072 6573 656e 6365 206f 6620  TE: presence of 
-00004750: 5348 4152 4553 4146 455f 5245 5155 4952  SHARESAFE_REQUIR
-00004760: 454d 454e 5420 696d 706c 7920 7468 6174  EMENT imply that
-00004770: 2073 746f 7265 2072 6571 7569 7265 6d65   store requireme
-00004780: 6e74 0a20 2020 2023 2069 7320 7072 6573  nt.    # is pres
-00004790: 656e 742e 2057 6520 6e65 7665 7220 7772  ent. We never wr
-000047a0: 6974 6520 5348 4152 4553 4146 455f 5245  ite SHARESAFE_RE
-000047b0: 5155 4952 454d 454e 5420 666f 7220 6120  QUIREMENT for a 
-000047c0: 7265 706f 2069 6620 7374 6f72 650a 2020  repo if store.  
-000047d0: 2020 2320 6973 206e 6f74 2070 7265 7365    # is not prese
-000047e0: 6e74 2c20 7265 6665 7220 6368 6563 6b72  nt, refer checkr
-000047f0: 6571 7569 7265 6d65 6e74 7363 6f6d 7061  equirementscompa
-00004800: 7428 2920 666f 7220 7468 6174 0a20 2020  t() for that.   
-00004810: 2023 0a20 2020 2023 2048 6f77 6576 6572   #.    # However
-00004820: 2c20 6966 2053 4841 5245 5341 4645 5f52  , if SHARESAFE_R
-00004830: 4551 5549 5245 4d45 4e54 2069 7320 6e6f  EQUIREMENT is no
-00004840: 7420 7072 6573 656e 742c 2069 7420 6d65  t present, it me
-00004850: 616e 7320 7468 6174 2074 6865 0a20 2020  ans that the.   
-00004860: 2023 2072 6570 6f73 6974 6f72 7920 7761   # repository wa
-00004870: 7320 7368 6172 6564 2074 6865 206f 6c64  s shared the old
-00004880: 2077 6179 2e20 5765 2063 6865 636b 2074   way. We check t
-00004890: 6865 2073 6861 7265 2073 6f75 7263 6520  he share source 
-000048a0: 2e68 672f 7265 7175 6972 6573 0a20 2020  .hg/requires.   
-000048b0: 2023 2066 6f72 2053 4841 5245 5341 4645   # for SHARESAFE
-000048c0: 5f52 4551 5549 5245 4d45 4e54 2074 6f20  _REQUIREMENT to 
-000048d0: 6465 7465 6374 2077 6865 7468 6572 2074  detect whether t
-000048e0: 6865 2063 7572 7265 6e74 2072 6570 6f73  he current repos
-000048f0: 6974 6f72 7920 6e65 6564 730a 2020 2020  itory needs.    
-00004900: 2320 746f 2062 6520 7265 7368 6172 6564  # to be reshared
-00004910: 0a20 2020 2068 696e 7420 3d20 5f28 6222  .    hint = _(b"
-00004920: 7365 6520 6068 6720 6865 6c70 2063 6f6e  see `hg help con
-00004930: 6669 672e 666f 726d 6174 2e75 7365 2d73  fig.format.use-s
-00004940: 6861 7265 2d73 6166 6560 2066 6f72 206d  hare-safe` for m
-00004950: 6f72 6520 696e 666f 726d 6174 696f 6e22  ore information"
-00004960: 290a 2020 2020 6966 2072 6571 7569 7265  ).    if require
-00004970: 6d65 6e74 736d 6f64 2e53 4841 5245 5341  mentsmod.SHARESA
-00004980: 4645 5f52 4551 5549 5245 4d45 4e54 2069  FE_REQUIREMENT i
-00004990: 6e20 7265 7175 6972 656d 656e 7473 3a0a  n requirements:.
-000049a0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-000049b0: 2020 2020 2020 2020 2073 6861 7265 640a           shared.
-000049c0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-000049d0: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
-000049e0: 5348 4152 4553 4146 455f 5245 5155 4952  SHARESAFE_REQUIR
-000049f0: 454d 454e 540a 2020 2020 2020 2020 2020  EMENT.          
-00004a00: 2020 6e6f 7420 696e 205f 7265 6164 7265    not in _readre
-00004a10: 7175 6972 6573 2873 6861 7265 6476 6673  quires(sharedvfs
-00004a20: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
-00004a30: 293a 0a20 2020 2020 2020 2020 2020 206d  ):.            m
-00004a40: 6973 6d61 7463 685f 7761 726e 203d 2075  ismatch_warn = u
-00004a50: 692e 636f 6e66 6967 626f 6f6c 280a 2020  i.configbool(.  
-00004a60: 2020 2020 2020 2020 2020 2020 2020 6227                b'
-00004a70: 7368 6172 6527 2c20 6227 7361 6665 2d6d  share', b'safe-m
-00004a80: 6973 6d61 7463 682e 736f 7572 6365 2d6e  ismatch.source-n
-00004a90: 6f74 2d73 6166 652e 7761 726e 270a 2020  ot-safe.warn'.  
-00004aa0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00004ab0: 2020 2020 2020 2020 6d69 736d 6174 6368          mismatch
-00004ac0: 5f63 6f6e 6669 6720 3d20 7569 2e63 6f6e  _config = ui.con
-00004ad0: 6669 6728 0a20 2020 2020 2020 2020 2020  fig(.           
-00004ae0: 2020 2020 2062 2773 6861 7265 272c 2062       b'share', b
-00004af0: 2773 6166 652d 6d69 736d 6174 6368 2e73  'safe-mismatch.s
-00004b00: 6f75 7263 652d 6e6f 742d 7361 6665 270a  ource-not-safe'.
-00004b10: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00004b20: 2020 2020 2020 2020 2020 6d69 736d 6174            mismat
-00004b30: 6368 5f76 6572 626f 7365 5f75 7067 7261  ch_verbose_upgra
-00004b40: 6465 203d 2075 692e 636f 6e66 6967 626f  de = ui.configbo
-00004b50: 6f6c 280a 2020 2020 2020 2020 2020 2020  ol(.            
-00004b60: 2020 2020 6227 7368 6172 6527 2c20 6227      b'share', b'
-00004b70: 7361 6665 2d6d 6973 6d61 7463 682e 736f  safe-mismatch.so
-00004b80: 7572 6365 2d6e 6f74 2d73 6166 653a 7665  urce-not-safe:ve
-00004b90: 7262 6f73 652d 7570 6772 6164 6527 0a20  rbose-upgrade'. 
-00004ba0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00004bb0: 2020 2020 2020 2020 2069 6620 6d69 736d           if mism
-00004bc0: 6174 6368 5f63 6f6e 6669 6720 696e 2028  atch_config in (
-00004bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004be0: 2062 2764 6f77 6e67 7261 6465 2d61 6c6c   b'downgrade-all
-00004bf0: 6f77 272c 0a20 2020 2020 2020 2020 2020  ow',.           
-00004c00: 2020 2020 2062 2761 6c6c 6f77 272c 0a20       b'allow',. 
-00004c10: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00004c20: 2764 6f77 6e67 7261 6465 2d61 626f 7274  'downgrade-abort
-00004c30: 272c 0a20 2020 2020 2020 2020 2020 2029  ',.            )
-00004c40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004c50: 2020 2320 7072 6576 656e 7420 6379 636c    # prevent cycl
-00004c60: 6963 2069 6d70 6f72 7420 6c6f 6361 6c72  ic import localr
-00004c70: 6570 6f20 2d3e 2075 7067 7261 6465 202d  epo -> upgrade -
-00004c80: 3e20 6c6f 6361 6c72 6570 6f0a 2020 2020  > localrepo.    
-00004c90: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-00004ca0: 202e 2069 6d70 6f72 7420 7570 6772 6164   . import upgrad
-00004cb0: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-00004cc0: 2020 2075 7067 7261 6465 2e64 6f77 6e67     upgrade.downg
-00004cd0: 7261 6465 5f73 6861 7265 5f74 6f5f 6e6f  rade_share_to_no
-00004ce0: 6e5f 7361 6665 280a 2020 2020 2020 2020  n_safe(.        
-00004cf0: 2020 2020 2020 2020 2020 2020 7569 2c0a              ui,.
-00004d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d10: 2020 2020 6867 7666 732c 0a20 2020 2020      hgvfs,.     
-00004d20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00004d30: 6861 7265 6476 6673 2c0a 2020 2020 2020  haredvfs,.      
-00004d40: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00004d50: 7175 6972 656d 656e 7473 2c0a 2020 2020  quirements,.    
-00004d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d70: 6d69 736d 6174 6368 5f63 6f6e 6669 672c  mismatch_config,
-00004d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004d90: 2020 2020 206d 6973 6d61 7463 685f 7761       mismatch_wa
-00004da0: 726e 2c0a 2020 2020 2020 2020 2020 2020  rn,.            
-00004db0: 2020 2020 2020 2020 6d69 736d 6174 6368          mismatch
-00004dc0: 5f76 6572 626f 7365 5f75 7067 7261 6465  _verbose_upgrade
-00004dd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00004de0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00004df0: 656c 6966 206d 6973 6d61 7463 685f 636f  elif mismatch_co
-00004e00: 6e66 6967 203d 3d20 6227 6162 6f72 7427  nfig == b'abort'
-00004e10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004e20: 2020 7261 6973 6520 6572 726f 722e 4162    raise error.Ab
-00004e30: 6f72 7428 0a20 2020 2020 2020 2020 2020  ort(.           
-00004e40: 2020 2020 2020 2020 205f 2862 2273 6861           _(b"sha
-00004e50: 7265 2073 6f75 7263 6520 646f 6573 206e  re source does n
-00004e60: 6f74 2073 7570 706f 7274 2073 6861 7265  ot support share
-00004e70: 2d73 6166 6520 7265 7175 6972 656d 656e  -safe requiremen
-00004e80: 7422 292c 0a20 2020 2020 2020 2020 2020  t"),.           
-00004e90: 2020 2020 2020 2020 2068 696e 743d 6869           hint=hi
-00004ea0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-00004eb0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00004ec0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00004ed0: 2020 2020 2020 2020 7261 6973 6520 6572          raise er
-00004ee0: 726f 722e 4162 6f72 7428 0a20 2020 2020  ror.Abort(.     
-00004ef0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-00004f00: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00004f10: 2020 2020 2020 2020 2020 6222 7368 6172            b"shar
-00004f20: 652d 7361 6665 206d 6973 6d61 7463 6820  e-safe mismatch 
-00004f30: 7769 7468 2073 6f75 7263 652e 5c6e 556e  with source.\nUn
-00004f40: 7265 636f 676e 697a 6564 220a 2020 2020  recognized".    
-00004f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f60: 2020 2020 6222 2076 616c 7565 2027 2573      b" value '%s
-00004f70: 2720 6f66 2060 7368 6172 652e 7361 6665  ' of `share.safe
-00004f80: 2d6d 6973 6d61 7463 682e 736f 7572 6365  -mismatch.source
-00004f90: 2d6e 6f74 2d73 6166 6560 220a 2020 2020  -not-safe`".    
-00004fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004fb0: 2020 2020 6222 2073 6574 2e22 0a20 2020      b" set.".   
-00004fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004fd0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00004fe0: 2020 2020 2020 2025 206d 6973 6d61 7463         % mismatc
-00004ff0: 685f 636f 6e66 6967 2c0a 2020 2020 2020  h_config,.      
-00005000: 2020 2020 2020 2020 2020 2020 2020 6869                hi
-00005010: 6e74 3d68 696e 742c 0a20 2020 2020 2020  nt=hint,.       
-00005020: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00005030: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00005040: 2020 2020 2072 6571 7569 7265 6d65 6e74       requirement
-00005050: 7320 7c3d 205f 7265 6164 7265 7175 6972  s |= _readrequir
-00005060: 6573 2873 746f 7265 7666 732c 2046 616c  es(storevfs, Fal
-00005070: 7365 290a 2020 2020 656c 6966 2073 6861  se).    elif sha
-00005080: 7265 643a 0a20 2020 2020 2020 2073 6f75  red:.        sou
-00005090: 7263 6572 6571 7569 7265 7320 3d20 5f72  rcerequires = _r
-000050a0: 6561 6472 6571 7569 7265 7328 7368 6172  eadrequires(shar
-000050b0: 6564 7666 732c 2046 616c 7365 290a 2020  edvfs, False).  
-000050c0: 2020 2020 2020 6966 2072 6571 7569 7265        if require
-000050d0: 6d65 6e74 736d 6f64 2e53 4841 5245 5341  mentsmod.SHARESA
-000050e0: 4645 5f52 4551 5549 5245 4d45 4e54 2069  FE_REQUIREMENT i
-000050f0: 6e20 736f 7572 6365 7265 7175 6972 6573  n sourcerequires
-00005100: 3a0a 2020 2020 2020 2020 2020 2020 6d69  :.            mi
-00005110: 736d 6174 6368 5f63 6f6e 6669 6720 3d20  smatch_config = 
-00005120: 7569 2e63 6f6e 6669 6728 6227 7368 6172  ui.config(b'shar
-00005130: 6527 2c20 6227 7361 6665 2d6d 6973 6d61  e', b'safe-misma
-00005140: 7463 682e 736f 7572 6365 2d73 6166 6527  tch.source-safe'
-00005150: 290a 2020 2020 2020 2020 2020 2020 6d69  ).            mi
-00005160: 736d 6174 6368 5f77 6172 6e20 3d20 7569  smatch_warn = ui
-00005170: 2e63 6f6e 6669 6762 6f6f 6c28 0a20 2020  .configbool(.   
-00005180: 2020 2020 2020 2020 2020 2020 2062 2773               b's
-00005190: 6861 7265 272c 2062 2773 6166 652d 6d69  hare', b'safe-mi
-000051a0: 736d 6174 6368 2e73 6f75 7263 652d 7361  smatch.source-sa
-000051b0: 6665 2e77 6172 6e27 0a20 2020 2020 2020  fe.warn'.       
-000051c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000051d0: 2020 206d 6973 6d61 7463 685f 7665 7262     mismatch_verb
-000051e0: 6f73 655f 7570 6772 6164 6520 3d20 7569  ose_upgrade = ui
-000051f0: 2e63 6f6e 6669 6762 6f6f 6c28 0a20 2020  .configbool(.   
-00005200: 2020 2020 2020 2020 2020 2020 2062 2773               b's
-00005210: 6861 7265 272c 2062 2773 6166 652d 6d69  hare', b'safe-mi
-00005220: 736d 6174 6368 2e73 6f75 7263 652d 7361  smatch.source-sa
-00005230: 6665 3a76 6572 626f 7365 2d75 7067 7261  fe:verbose-upgra
-00005240: 6465 270a 2020 2020 2020 2020 2020 2020  de'.            
-00005250: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00005260: 206d 6973 6d61 7463 685f 636f 6e66 6967   mismatch_config
-00005270: 2069 6e20 280a 2020 2020 2020 2020 2020   in (.          
-00005280: 2020 2020 2020 6227 7570 6772 6164 652d        b'upgrade-
-00005290: 616c 6c6f 7727 2c0a 2020 2020 2020 2020  allow',.        
-000052a0: 2020 2020 2020 2020 6227 616c 6c6f 7727          b'allow'
-000052b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000052c0: 2020 6227 7570 6772 6164 652d 6162 6f72    b'upgrade-abor
-000052d0: 7427 2c0a 2020 2020 2020 2020 2020 2020  t',.            
-000052e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000052f0: 2020 2023 2070 7265 7665 6e74 2063 7963     # prevent cyc
-00005300: 6c69 6320 696d 706f 7274 206c 6f63 616c  lic import local
-00005310: 7265 706f 202d 3e20 7570 6772 6164 6520  repo -> upgrade 
-00005320: 2d3e 206c 6f63 616c 7265 706f 0a20 2020  -> localrepo.   
-00005330: 2020 2020 2020 2020 2020 2020 2066 726f               fro
-00005340: 6d20 2e20 696d 706f 7274 2075 7067 7261  m . import upgra
-00005350: 6465 0a0a 2020 2020 2020 2020 2020 2020  de..            
-00005360: 2020 2020 7570 6772 6164 652e 7570 6772      upgrade.upgr
-00005370: 6164 655f 7368 6172 655f 746f 5f73 6166  ade_share_to_saf
-00005380: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-00005390: 2020 2020 2020 2075 692c 0a20 2020 2020         ui,.     
-000053a0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-000053b0: 6776 6673 2c0a 2020 2020 2020 2020 2020  gvfs,.          
-000053c0: 2020 2020 2020 2020 2020 7374 6f72 6576            storev
-000053d0: 6673 2c0a 2020 2020 2020 2020 2020 2020  fs,.            
-000053e0: 2020 2020 2020 2020 7265 7175 6972 656d          requirem
-000053f0: 656e 7473 2c0a 2020 2020 2020 2020 2020  ents,.          
-00005400: 2020 2020 2020 2020 2020 6d69 736d 6174            mismat
-00005410: 6368 5f63 6f6e 6669 672c 0a20 2020 2020  ch_config,.     
-00005420: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00005430: 6973 6d61 7463 685f 7761 726e 2c0a 2020  ismatch_warn,.  
-00005440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005450: 2020 6d69 736d 6174 6368 5f76 6572 626f    mismatch_verbo
-00005460: 7365 5f75 7067 7261 6465 2c0a 2020 2020  se_upgrade,.    
-00005470: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00005480: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-00005490: 6973 6d61 7463 685f 636f 6e66 6967 203d  ismatch_config =
-000054a0: 3d20 6227 6162 6f72 7427 3a0a 2020 2020  = b'abort':.    
-000054b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000054c0: 6520 6572 726f 722e 4162 6f72 7428 0a20  e error.Abort(. 
-000054d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000054e0: 2020 205f 280a 2020 2020 2020 2020 2020     _(.          
-000054f0: 2020 2020 2020 2020 2020 2020 2020 6227                b'
-00005500: 7665 7273 696f 6e20 6d69 736d 6174 6368  version mismatch
-00005510: 3a20 736f 7572 6365 2075 7365 7320 7368  : source uses sh
-00005520: 6172 652d 7361 6665 270a 2020 2020 2020  are-safe'.      
-00005530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005540: 2020 6227 2066 756e 6374 696f 6e61 6c69    b' functionali
-00005550: 7479 2077 6869 6c65 2074 6865 2063 7572  ty while the cur
-00005560: 7265 6e74 2073 6861 7265 2064 6f65 7320  rent share does 
-00005570: 6e6f 7427 0a20 2020 2020 2020 2020 2020  not'.           
-00005580: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
-00005590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055a0: 6869 6e74 3d68 696e 742c 0a20 2020 2020  hint=hint,.     
-000055b0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000055c0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000055d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000055e0: 6169 7365 2065 7272 6f72 2e41 626f 7274  aise error.Abort
-000055f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00005600: 2020 2020 2020 5f28 0a20 2020 2020 2020        _(.       
-00005610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005620: 2062 2273 6861 7265 2d73 6166 6520 6d69   b"share-safe mi
-00005630: 736d 6174 6368 2077 6974 6820 736f 7572  smatch with sour
-00005640: 6365 2e5c 6e55 6e72 6563 6f67 6e69 7a65  ce.\nUnrecognize
-00005650: 6422 0a20 2020 2020 2020 2020 2020 2020  d".             
-00005660: 2020 2020 2020 2020 2020 2062 2220 7661             b" va
-00005670: 6c75 6520 2725 7327 206f 6620 6073 6861  lue '%s' of `sha
-00005680: 7265 2e73 6166 652d 6d69 736d 6174 6368  re.safe-mismatch
-00005690: 2e73 6f75 7263 652d 7361 6665 6020 7365  .source-safe` se
-000056a0: 742e 220a 2020 2020 2020 2020 2020 2020  t.".            
-000056b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000056c0: 2020 2020 2020 2020 2020 2020 2020 2520                % 
-000056d0: 6d69 736d 6174 6368 5f63 6f6e 6669 672c  mismatch_config,
-000056e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000056f0: 2020 2020 2068 696e 743d 6869 6e74 2c0a       hint=hint,.
-00005700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005710: 290a 0a20 2020 2023 2054 6865 202e 6867  )..    # The .hg
-00005720: 2f68 6772 6320 6669 6c65 206d 6179 206c  /hgrc file may l
-00005730: 6f61 6420 6578 7465 6e73 696f 6e73 206f  oad extensions o
-00005740: 7220 636f 6e74 6169 6e20 636f 6e66 6967  r contain config
-00005750: 206f 7074 696f 6e73 0a20 2020 2023 2074   options.    # t
-00005760: 6861 7420 696e 666c 7565 6e63 6520 7265  hat influence re
-00005770: 706f 7369 746f 7279 2063 6f6e 7374 7275  pository constru
-00005780: 6374 696f 6e2e 2041 7474 656d 7074 2074  ction. Attempt t
-00005790: 6f20 6c6f 6164 2069 7420 616e 640a 2020  o load it and.  
-000057a0: 2020 2320 7072 6f63 6573 7320 616e 7920    # process any 
-000057b0: 6e65 7720 6578 7465 6e73 696f 6e73 2074  new extensions t
-000057c0: 6861 7420 6974 206d 6179 2068 6176 6520  hat it may have 
-000057d0: 7075 6c6c 6564 2069 6e2e 0a20 2020 2069  pulled in..    i
-000057e0: 6620 6c6f 6164 6867 7263 2875 692c 2077  f loadhgrc(ui, w
-000057f0: 6469 7276 6673 2c20 6867 7666 732c 2072  dirvfs, hgvfs, r
-00005800: 6571 7569 7265 6d65 6e74 732c 2073 6861  equirements, sha
-00005810: 7265 6476 6673 293a 0a20 2020 2020 2020  redvfs):.       
-00005820: 2061 6674 6572 6867 7263 6c6f 6164 2875   afterhgrcload(u
-00005830: 692c 2077 6469 7276 6673 2c20 6867 7666  i, wdirvfs, hgvf
-00005840: 732c 2072 6571 7569 7265 6d65 6e74 7329  s, requirements)
-00005850: 0a20 2020 2020 2020 2065 7874 656e 7369  .        extensi
-00005860: 6f6e 732e 6c6f 6164 616c 6c28 7569 290a  ons.loadall(ui).
-00005870: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
-00005880: 6e73 2e70 6f70 756c 6174 6575 6928 7569  ns.populateui(ui
-00005890: 290a 0a20 2020 2023 2053 6574 206f 6620  )..    # Set of 
-000058a0: 6d6f 6475 6c65 206e 616d 6573 206f 6620  module names of 
-000058b0: 6578 7465 6e73 696f 6e73 206c 6f61 6465  extensions loade
-000058c0: 6420 666f 7220 7468 6973 2072 6570 6f73  d for this repos
-000058d0: 6974 6f72 792e 0a20 2020 2065 7874 656e  itory..    exten
-000058e0: 7369 6f6e 6d6f 6475 6c65 6e61 6d65 7320  sionmodulenames 
-000058f0: 3d20 7b6d 2e5f 5f6e 616d 655f 5f20 666f  = {m.__name__ fo
-00005900: 7220 6e2c 206d 2069 6e20 6578 7465 6e73  r n, m in extens
-00005910: 696f 6e73 2e65 7874 656e 7369 6f6e 7328  ions.extensions(
-00005920: 7569 297d 0a0a 2020 2020 7375 7070 6f72  ui)}..    suppor
-00005930: 7465 6472 6571 7569 7265 6d65 6e74 7320  tedrequirements 
-00005940: 3d20 6761 7468 6572 7375 7070 6f72 7465  = gathersupporte
-00005950: 6472 6571 7569 7265 6d65 6e74 7328 7569  drequirements(ui
-00005960: 290a 0a20 2020 2023 2057 6520 6669 7273  )..    # We firs
-00005970: 7420 7661 6c69 6461 7465 2074 6865 2072  t validate the r
-00005980: 6571 7569 7265 6d65 6e74 7320 6172 6520  equirements are 
-00005990: 6b6e 6f77 6e2e 0a20 2020 2065 6e73 7572  known..    ensur
-000059a0: 6572 6571 7569 7265 6d65 6e74 7372 6563  erequirementsrec
-000059b0: 6f67 6e69 7a65 6428 7265 7175 6972 656d  ognized(requirem
-000059c0: 656e 7473 2c20 7375 7070 6f72 7465 6472  ents, supportedr
-000059d0: 6571 7569 7265 6d65 6e74 7329 0a0a 2020  equirements)..  
-000059e0: 2020 2320 5468 656e 2077 6520 7661 6c69    # Then we vali
-000059f0: 6461 7465 2074 6861 7420 7468 6520 6b6e  date that the kn
-00005a00: 6f77 6e20 7365 7420 6973 2072 6561 736f  own set is reaso
-00005a10: 6e61 626c 6520 746f 2075 7365 2074 6f67  nable to use tog
-00005a20: 6574 6865 722e 0a20 2020 2065 6e73 7572  ether..    ensur
-00005a30: 6572 6571 7569 7265 6d65 6e74 7363 6f6d  erequirementscom
-00005a40: 7061 7469 626c 6528 7569 2c20 7265 7175  patible(ui, requ
-00005a50: 6972 656d 656e 7473 290a 0a20 2020 2023  irements)..    #
-00005a60: 2054 4f44 4f20 7468 6572 6520 6172 6520   TODO there are 
-00005a70: 756e 6861 6e64 6c65 6420 6564 6765 2063  unhandled edge c
-00005a80: 6173 6573 2072 656c 6174 6564 2074 6f20  ases related to 
-00005a90: 6f70 656e 696e 6720 7265 706f 7369 746f  opening reposito
-00005aa0: 7269 6573 2077 6974 680a 2020 2020 2320  ries with.    # 
-00005ab0: 7368 6172 6564 2073 746f 7261 6765 2e20  shared storage. 
-00005ac0: 4966 2073 746f 7261 6765 2069 7320 7368  If storage is sh
-00005ad0: 6172 6564 2c20 7765 2073 686f 756c 6420  ared, we should 
-00005ae0: 616c 736f 2074 6573 7420 666f 7220 7265  also test for re
-00005af0: 7175 6972 656d 656e 7473 0a20 2020 2023  quirements.    #
-00005b00: 2063 6f6d 7061 7469 6269 6c69 7479 2069   compatibility i
-00005b10: 6e20 7468 6520 706f 696e 7465 642d 746f  n the pointed-to
-00005b20: 2072 6570 6f2e 2054 6869 7320 656e 7461   repo. This enta
-00005b30: 696c 7320 6c6f 6164 696e 6720 7468 6520  ils loading the 
-00005b40: 2e68 672f 6867 7263 2069 6e0a 2020 2020  .hg/hgrc in.    
-00005b50: 2320 7468 6174 2072 6570 6f2c 2061 7320  # that repo, as 
-00005b60: 7468 6174 2072 6570 6f20 6d61 7920 6c6f  that repo may lo
-00005b70: 6164 2065 7874 656e 7369 6f6e 7320 6e65  ad extensions ne
-00005b80: 6564 6564 2074 6f20 6f70 656e 2069 742e  eded to open it.
-00005b90: 2054 6869 7320 6973 2061 0a20 2020 2023   This is a.    #
-00005ba0: 2062 6974 2063 6f6d 706c 6963 6174 6564   bit complicated
-00005bb0: 2062 6563 6175 7365 2077 6520 646f 6e27   because we don'
-00005bc0: 7420 7761 6e74 2074 6865 206f 7468 6572  t want the other
-00005bd0: 2068 6772 6320 746f 206f 7665 7277 7269   hgrc to overwri
-00005be0: 7465 2073 6574 7469 6e67 730a 2020 2020  te settings.    
-00005bf0: 2320 696e 2074 6869 7320 6867 7263 2e0a  # in this hgrc..
-00005c00: 2020 2020 230a 2020 2020 2320 5468 6973      #.    # This
-00005c10: 2062 7567 2069 7320 736f 6d65 7768 6174   bug is somewhat
-00005c20: 206d 6974 6967 6174 6564 2062 7920 7468   mitigated by th
-00005c30: 6520 6661 6374 2074 6861 7420 7765 2063  e fact that we c
-00005c40: 6f70 7920 7468 6520 2e68 672f 7265 7175  opy the .hg/requ
-00005c50: 6972 6573 0a20 2020 2023 2066 696c 6520  ires.    # file 
-00005c60: 7768 656e 2073 6861 7269 6e67 2072 6570  when sharing rep
-00005c70: 6f73 2e20 4275 7420 6966 2061 2072 6571  os. But if a req
-00005c80: 7569 7265 6d65 6e74 2069 7320 6164 6465  uirement is adde
-00005c90: 6420 6166 7465 7220 7468 6520 7368 6172  d after the shar
-00005ca0: 6520 6973 0a20 2020 2023 2070 6572 666f  e is.    # perfo
-00005cb0: 726d 6564 2c20 7468 6572 6562 7920 696e  rmed, thereby in
-00005cc0: 7472 6f64 7563 696e 6720 6120 6e65 7720  troducing a new 
-00005cd0: 7265 7175 6972 656d 656e 7420 666f 7220  requirement for 
-00005ce0: 7468 6520 6f70 656e 6572 2c20 7765 206d  the opener, we m
-00005cf0: 6179 0a20 2020 2023 2077 696c 6c20 6e6f  ay.    # will no
-00005d00: 7420 7365 6520 7468 6174 2061 6e64 2063  t see that and c
-00005d10: 6f75 6c64 2065 6e63 6f75 6e74 6572 2061  ould encounter a
-00005d20: 2072 756e 2d74 696d 6520 6572 726f 7220   run-time error 
-00005d30: 696e 7465 7261 6374 696e 6720 7769 7468  interacting with
-00005d40: 0a20 2020 2023 2074 6861 7420 7368 6172  .    # that shar
-00005d50: 6564 2073 746f 7265 2073 696e 6365 2069  ed store since i
-00005d60: 7420 6861 7320 616e 2075 6e6b 6e6f 776e  t has an unknown
-00005d70: 2d74 6f2d 7573 2072 6571 7569 7265 6d65  -to-us requireme
-00005d80: 6e74 2e0a 0a20 2020 2023 2041 7420 7468  nt...    # At th
-00005d90: 6973 2070 6f69 6e74 2c20 7765 206b 6e6f  is point, we kno
-00005da0: 7720 7765 2073 686f 756c 6420 6265 2063  w we should be c
-00005db0: 6170 6162 6c65 206f 6620 6f70 656e 696e  apable of openin
-00005dc0: 6720 7468 6520 7265 706f 7369 746f 7279  g the repository
-00005dd0: 2e0a 2020 2020 2320 4e6f 7720 6765 7420  ..    # Now get 
-00005de0: 6f6e 2077 6974 6820 646f 696e 6720 7468  on with doing th
-00005df0: 6174 2e0a 0a20 2020 2066 6561 7475 7265  at...    feature
-00005e00: 7320 3d20 7365 7428 290a 0a20 2020 2023  s = set()..    #
-00005e10: 2054 6865 2022 7374 6f72 6522 2070 6172   The "store" par
-00005e20: 7420 6f66 2074 6865 2072 6570 6f73 6974  t of the reposit
-00005e30: 6f72 7920 686f 6c64 7320 7665 7273 696f  ory holds versio
-00005e40: 6e65 6420 6461 7461 2e20 486f 7720 6974  ned data. How it
-00005e50: 2069 730a 2020 2020 2320 6163 6365 7373   is.    # access
-00005e60: 6564 2069 7320 6465 7465 726d 696e 6564  ed is determined
-00005e70: 2062 7920 7661 7269 6f75 7320 7265 7175   by various requ
-00005e80: 6972 656d 656e 7473 2e20 4966 2060 7368  irements. If `sh
-00005e90: 6172 6564 6020 6f72 0a20 2020 2023 2060  ared` or.    # `
-00005ea0: 7265 6c73 6861 7265 6460 2072 6571 7569  relshared` requi
-00005eb0: 7265 6d65 6e74 7320 6172 6520 7072 6573  rements are pres
-00005ec0: 656e 742c 2074 6869 7320 696e 6469 6361  ent, this indica
-00005ed0: 7465 7320 6375 7272 656e 7420 7265 706f  tes current repo
-00005ee0: 7369 746f 7279 0a20 2020 2023 2069 7320  sitory.    # is 
-00005ef0: 6120 7368 6172 6520 616e 6420 7374 6f72  a share and stor
-00005f00: 6520 6578 6973 7473 2069 6e20 7061 7468  e exists in path
-00005f10: 206d 656e 7469 6f6e 6564 2069 6e20 602e   mentioned in `.
-00005f20: 6867 2f73 6861 7265 6470 6174 6860 0a20  hg/sharedpath`. 
-00005f30: 2020 2069 6620 7368 6172 6564 3a0a 2020     if shared:.  
-00005f40: 2020 2020 2020 7374 6f72 6562 6173 6570        storebasep
-00005f50: 6174 6820 3d20 7368 6172 6564 7666 732e  ath = sharedvfs.
-00005f60: 6261 7365 0a20 2020 2020 2020 2063 6163  base.        cac
-00005f70: 6865 7061 7468 203d 2073 6861 7265 6476  hepath = sharedv
-00005f80: 6673 2e6a 6f69 6e28 6227 6361 6368 6527  fs.join(b'cache'
-00005f90: 290a 2020 2020 2020 2020 6665 6174 7572  ).        featur
-00005fa0: 6573 2e61 6464 2872 6570 6f73 6974 6f72  es.add(repositor
-00005fb0: 792e 5245 504f 5f46 4541 5455 5245 5f53  y.REPO_FEATURE_S
-00005fc0: 4841 5245 445f 5354 4f52 4147 4529 0a20  HARED_STORAGE). 
-00005fd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00005fe0: 2073 746f 7265 6261 7365 7061 7468 203d   storebasepath =
-00005ff0: 2068 6776 6673 2e62 6173 650a 2020 2020   hgvfs.base.    
-00006000: 2020 2020 6361 6368 6570 6174 6820 3d20      cachepath = 
-00006010: 6867 7666 732e 6a6f 696e 2862 2763 6163  hgvfs.join(b'cac
-00006020: 6865 2729 0a20 2020 2077 6361 6368 6570  he').    wcachep
-00006030: 6174 6820 3d20 6867 7666 732e 6a6f 696e  ath = hgvfs.join
-00006040: 2862 2777 6361 6368 6527 290a 0a20 2020  (b'wcache')..   
-00006050: 2023 2054 6865 2073 746f 7265 2068 6173   # The store has
-00006060: 2063 6861 6e67 6564 206f 7665 7220 7469   changed over ti
-00006070: 6d65 2061 6e64 2074 6865 2065 7861 6374  me and the exact
-00006080: 206c 6179 6f75 7420 6973 2064 6963 7461   layout is dicta
-00006090: 7465 6420 6279 0a20 2020 2023 2072 6571  ted by.    # req
-000060a0: 7569 7265 6d65 6e74 732e 2054 6865 2073  uirements. The s
-000060b0: 746f 7265 2069 6e74 6572 6661 6365 2061  tore interface a
-000060c0: 6273 7472 6163 7473 2064 6966 6665 7265  bstracts differe
-000060d0: 6e63 6573 2061 6372 6f73 7320 616c 6c0a  nces across all.
-000060e0: 2020 2020 2320 6f66 2074 6865 6d2e 0a20      # of them.. 
-000060f0: 2020 2073 746f 7265 203d 206d 616b 6573     store = makes
-00006100: 746f 7265 280a 2020 2020 2020 2020 7265  tore(.        re
-00006110: 7175 6972 656d 656e 7473 2c0a 2020 2020  quirements,.    
-00006120: 2020 2020 7374 6f72 6562 6173 6570 6174      storebasepat
-00006130: 682c 0a20 2020 2020 2020 206c 616d 6264  h,.        lambd
-00006140: 6120 6261 7365 3a20 7666 736d 6f64 2e76  a base: vfsmod.v
-00006150: 6673 2862 6173 652c 2063 6163 6865 6175  fs(base, cacheau
-00006160: 6469 7465 643d 5472 7565 292c 0a20 2020  dited=True),.   
-00006170: 2029 0a20 2020 2068 6776 6673 2e63 7265   ).    hgvfs.cre
-00006180: 6174 656d 6f64 6520 3d20 7374 6f72 652e  atemode = store.
-00006190: 6372 6561 7465 6d6f 6465 0a0a 2020 2020  createmode..    
-000061a0: 7374 6f72 6576 6673 203d 2073 746f 7265  storevfs = store
-000061b0: 2e76 6673 0a20 2020 2073 746f 7265 7666  .vfs.    storevf
-000061c0: 732e 6f70 7469 6f6e 7320 3d20 7265 736f  s.options = reso
-000061d0: 6c76 6573 746f 7265 7666 736f 7074 696f  lvestorevfsoptio
-000061e0: 6e73 2875 692c 2072 6571 7569 7265 6d65  ns(ui, requireme
-000061f0: 6e74 732c 2066 6561 7475 7265 7329 0a0a  nts, features)..
-00006200: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
-00006210: 2072 6571 7569 7265 6d65 6e74 736d 6f64   requirementsmod
-00006220: 2e52 4556 4c4f 4756 325f 5245 5155 4952  .REVLOGV2_REQUIR
-00006230: 454d 454e 5420 696e 2072 6571 7569 7265  EMENT in require
-00006240: 6d65 6e74 730a 2020 2020 2020 2020 6f72  ments.        or
-00006250: 2072 6571 7569 7265 6d65 6e74 736d 6f64   requirementsmod
-00006260: 2e43 4841 4e47 454c 4f47 5632 5f52 4551  .CHANGELOGV2_REQ
-00006270: 5549 5245 4d45 4e54 2069 6e20 7265 7175  UIREMENT in requ
-00006280: 6972 656d 656e 7473 0a20 2020 2029 3a0a  irements.    ):.
-00006290: 2020 2020 2020 2020 6665 6174 7572 6573          features
-000062a0: 2e61 6464 2872 6570 6f73 6974 6f72 792e  .add(repository.
-000062b0: 5245 504f 5f46 4541 5455 5245 5f53 4944  REPO_FEATURE_SID
-000062c0: 455f 4441 5441 290a 2020 2020 2020 2020  E_DATA).        
-000062d0: 2320 7468 6520 7265 766c 6f67 7632 2064  # the revlogv2 d
-000062e0: 6f63 6b65 7420 696e 7472 6f64 7563 6564  ocket introduced
-000062f0: 2072 6163 6520 636f 6e64 6974 696f 6e20   race condition 
-00006300: 7468 6174 2077 6520 6e65 6564 2074 6f20  that we need to 
-00006310: 6669 780a 2020 2020 2020 2020 6665 6174  fix.        feat
-00006320: 7572 6573 2e64 6973 6361 7264 2872 6570  ures.discard(rep
-00006330: 6f73 6974 6f72 792e 5245 504f 5f46 4541  ository.REPO_FEA
-00006340: 5455 5245 5f53 5452 4541 4d5f 434c 4f4e  TURE_STREAM_CLON
-00006350: 4529 0a0a 2020 2020 2320 5468 6520 6361  E)..    # The ca
-00006360: 6368 6520 7666 7320 6973 2075 7365 6420  che vfs is used 
-00006370: 746f 206d 616e 6167 6520 6361 6368 6520  to manage cache 
-00006380: 6669 6c65 732e 0a20 2020 2063 6163 6865  files..    cache
-00006390: 7666 7320 3d20 7666 736d 6f64 2e76 6673  vfs = vfsmod.vfs
-000063a0: 2863 6163 6865 7061 7468 2c20 6361 6368  (cachepath, cach
-000063b0: 6561 7564 6974 6564 3d54 7275 6529 0a20  eaudited=True). 
-000063c0: 2020 2063 6163 6865 7666 732e 6372 6561     cachevfs.crea
-000063d0: 7465 6d6f 6465 203d 2073 746f 7265 2e63  temode = store.c
-000063e0: 7265 6174 656d 6f64 650a 2020 2020 2320  reatemode.    # 
-000063f0: 5468 6520 6361 6368 6520 7666 7320 6973  The cache vfs is
-00006400: 2075 7365 6420 746f 206d 616e 6167 6520   used to manage 
-00006410: 6361 6368 6520 6669 6c65 7320 7265 6c61  cache files rela
-00006420: 7465 6420 746f 2074 6865 2077 6f72 6b69  ted to the worki
-00006430: 6e67 2063 6f70 790a 2020 2020 7763 6163  ng copy.    wcac
-00006440: 6865 7666 7320 3d20 7666 736d 6f64 2e76  hevfs = vfsmod.v
-00006450: 6673 2877 6361 6368 6570 6174 682c 2063  fs(wcachepath, c
-00006460: 6163 6865 6175 6469 7465 643d 5472 7565  acheaudited=True
-00006470: 290a 2020 2020 7763 6163 6865 7666 732e  ).    wcachevfs.
-00006480: 6372 6561 7465 6d6f 6465 203d 2073 746f  createmode = sto
-00006490: 7265 2e63 7265 6174 656d 6f64 650a 0a20  re.createmode.. 
-000064a0: 2020 2023 204e 6f77 2072 6573 6f6c 7665     # Now resolve
-000064b0: 2074 6865 2074 7970 6520 666f 7220 7468   the type for th
-000064c0: 6520 7265 706f 7369 746f 7279 206f 626a  e repository obj
-000064d0: 6563 742e 2057 6520 646f 2074 6869 7320  ect. We do this 
-000064e0: 6279 2072 6570 6561 7465 646c 790a 2020  by repeatedly.  
-000064f0: 2020 2320 6361 6c6c 696e 6720 6120 6661    # calling a fa
-00006500: 6374 6f72 7920 6675 6e63 7469 6f6e 2074  ctory function t
-00006510: 6f20 7072 6f64 7563 6573 2074 7970 6573  o produces types
-00006520: 2066 6f72 2073 7065 6369 6669 6320 6173   for specific as
-00006530: 7065 6374 7320 6f66 2074 6865 0a20 2020  pects of the.   
-00006540: 2023 2072 6570 6f27 7320 6f70 6572 6174   # repo's operat
-00006550: 696f 6e2e 2054 6865 2061 6767 7265 6761  ion. The aggrega
-00006560: 7465 2072 6574 7572 6e65 6420 7479 7065  te returned type
-00006570: 7320 6172 6520 7573 6564 2061 7320 6261  s are used as ba
-00006580: 7365 2063 6c61 7373 6573 0a20 2020 2023  se classes.    #
-00006590: 2066 6f72 2061 2064 796e 616d 6963 616c   for a dynamical
-000065a0: 6c79 2d64 6572 6976 6564 2074 7970 652c  ly-derived type,
-000065b0: 2077 6869 6368 2077 696c 6c20 7265 7072   which will repr
-000065c0: 6573 656e 7420 6f75 7220 6e65 7720 7265  esent our new re
-000065d0: 706f 7369 746f 7279 2e0a 0a20 2020 2062  pository...    b
-000065e0: 6173 6573 203d 205b 5d0a 2020 2020 6578  ases = [].    ex
-000065f0: 7472 6173 7461 7465 203d 207b 7d0a 0a20  trastate = {}.. 
-00006600: 2020 2066 6f72 2069 6661 6365 2c20 666e     for iface, fn
-00006610: 2069 6e20 5245 504f 5f49 4e54 4552 4641   in REPO_INTERFA
-00006620: 4345 533a 0a20 2020 2020 2020 2023 2057  CES:.        # W
-00006630: 6520 7061 7373 2061 6c6c 2070 6f74 656e  e pass all poten
-00006640: 7469 616c 6c79 2075 7365 6675 6c20 7374  tially useful st
-00006650: 6174 6520 746f 2067 6976 6520 6578 7465  ate to give exte
-00006660: 6e73 696f 6e73 2074 6f6e 7320 6f66 0a20  nsions tons of. 
-00006670: 2020 2020 2020 2023 2066 6c65 7869 6269         # flexibi
-00006680: 6c69 7479 2e0a 2020 2020 2020 2020 7479  lity..        ty
-00006690: 7020 3d20 666e 2829 280a 2020 2020 2020  p = fn()(.      
-000066a0: 2020 2020 2020 7569 3d75 692c 0a20 2020        ui=ui,.   
-000066b0: 2020 2020 2020 2020 2069 6e74 656e 7473           intents
-000066c0: 3d69 6e74 656e 7473 2c0a 2020 2020 2020  =intents,.      
-000066d0: 2020 2020 2020 7265 7175 6972 656d 656e        requiremen
-000066e0: 7473 3d72 6571 7569 7265 6d65 6e74 732c  ts=requirements,
-000066f0: 0a20 2020 2020 2020 2020 2020 2066 6561  .            fea
-00006700: 7475 7265 733d 6665 6174 7572 6573 2c0a  tures=features,.
-00006710: 2020 2020 2020 2020 2020 2020 7764 6972              wdir
-00006720: 7666 733d 7764 6972 7666 732c 0a20 2020  vfs=wdirvfs,.   
-00006730: 2020 2020 2020 2020 2068 6776 6673 3d68           hgvfs=h
-00006740: 6776 6673 2c0a 2020 2020 2020 2020 2020  gvfs,.          
-00006750: 2020 7374 6f72 653d 7374 6f72 652c 0a20    store=store,. 
-00006760: 2020 2020 2020 2020 2020 2073 746f 7265             store
-00006770: 7666 733d 7374 6f72 6576 6673 2c0a 2020  vfs=storevfs,.  
-00006780: 2020 2020 2020 2020 2020 7374 6f72 656f            storeo
-00006790: 7074 696f 6e73 3d73 746f 7265 7666 732e  ptions=storevfs.
-000067a0: 6f70 7469 6f6e 732c 0a20 2020 2020 2020  options,.       
-000067b0: 2020 2020 2063 6163 6865 7666 733d 6361       cachevfs=ca
-000067c0: 6368 6576 6673 2c0a 2020 2020 2020 2020  chevfs,.        
-000067d0: 2020 2020 7763 6163 6865 7666 733d 7763      wcachevfs=wc
-000067e0: 6163 6865 7666 732c 0a20 2020 2020 2020  achevfs,.       
-000067f0: 2020 2020 2065 7874 656e 7369 6f6e 6d6f       extensionmo
-00006800: 6475 6c65 6e61 6d65 733d 6578 7465 6e73  dulenames=extens
-00006810: 696f 6e6d 6f64 756c 656e 616d 6573 2c0a  ionmodulenames,.
-00006820: 2020 2020 2020 2020 2020 2020 6578 7472              extr
-00006830: 6173 7461 7465 3d65 7874 7261 7374 6174  astate=extrastat
-00006840: 652c 0a20 2020 2020 2020 2020 2020 2062  e,.            b
-00006850: 6173 6563 6c61 7373 6573 3d62 6173 6573  aseclasses=bases
-00006860: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00006870: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-00006880: 7374 616e 6365 2874 7970 2c20 7479 7065  stance(typ, type
-00006890: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-000068a0: 6169 7365 2065 7272 6f72 2e50 726f 6772  aise error.Progr
-000068b0: 616d 6d69 6e67 4572 726f 7228 0a20 2020  ammingError(.   
-000068c0: 2020 2020 2020 2020 2020 2020 2062 2775               b'u
-000068d0: 6e61 626c 6520 746f 2063 6f6e 7374 7275  nable to constru
-000068e0: 6374 2074 7970 6520 666f 7220 2573 2720  ct type for %s' 
-000068f0: 2520 6966 6163 650a 2020 2020 2020 2020  % iface.        
-00006900: 2020 2020 290a 0a20 2020 2020 2020 2062      )..        b
-00006910: 6173 6573 2e61 7070 656e 6428 7479 7029  ases.append(typ)
-00006920: 0a0a 2020 2020 2320 7479 7065 2829 2061  ..    # type() a
-00006930: 6c6c 6f77 7320 796f 7520 746f 2075 7365  llows you to use
-00006940: 2063 6861 7261 6374 6572 7320 696e 2074   characters in t
-00006950: 7970 6520 6e61 6d65 7320 7468 6174 2077  ype names that w
-00006960: 6f75 6c64 6e27 7420 6265 0a20 2020 2023  ouldn't be.    #
-00006970: 2072 6563 6f67 6e69 7a65 6420 6173 2050   recognized as P
-00006980: 7974 686f 6e20 7379 6d62 6f6c 7320 696e  ython symbols in
-00006990: 2073 6f75 7263 6520 636f 6465 2e20 5765   source code. We
-000069a0: 2061 6275 7365 2074 6861 7420 746f 2061   abuse that to a
-000069b0: 6464 0a20 2020 2023 2072 6963 6820 696e  dd.    # rich in
-000069c0: 666f 726d 6174 696f 6e20 6162 6f75 7420  formation about 
-000069d0: 6f75 7220 636f 6e73 7472 7563 7465 6420  our constructed 
-000069e0: 7265 706f 2e0a 2020 2020 6e61 6d65 203d  repo..    name =
-000069f0: 2070 7963 6f6d 7061 742e 7379 7373 7472   pycompat.sysstr
-00006a00: 280a 2020 2020 2020 2020 6227 6465 7269  (.        b'deri
-00006a10: 7665 6472 6570 6f3a 2573 3c25 733e 2720  vedrepo:%s<%s>' 
-00006a20: 2520 2877 6469 7276 6673 2e62 6173 652c  % (wdirvfs.base,
-00006a30: 2062 272c 272e 6a6f 696e 2873 6f72 7465   b','.join(sorte
-00006a40: 6428 7265 7175 6972 656d 656e 7473 2929  d(requirements))
-00006a50: 290a 2020 2020 290a 0a20 2020 2063 6c73  ).    )..    cls
-00006a60: 203d 2074 7970 6528 6e61 6d65 2c20 7475   = type(name, tu
-00006a70: 706c 6528 6261 7365 7329 2c20 7b7d 290a  ple(bases), {}).
-00006a80: 0a20 2020 2072 6574 7572 6e20 636c 7328  .    return cls(
-00006a90: 0a20 2020 2020 2020 2062 6173 6575 693d  .        baseui=
-00006aa0: 6261 7365 7569 2c0a 2020 2020 2020 2020  baseui,.        
-00006ab0: 7569 3d75 692c 0a20 2020 2020 2020 206f  ui=ui,.        o
-00006ac0: 7269 6772 6f6f 743d 7061 7468 2c0a 2020  rigroot=path,.  
-00006ad0: 2020 2020 2020 7764 6972 7666 733d 7764        wdirvfs=wd
-00006ae0: 6972 7666 732c 0a20 2020 2020 2020 2068  irvfs,.        h
-00006af0: 6776 6673 3d68 6776 6673 2c0a 2020 2020  gvfs=hgvfs,.    
-00006b00: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
-00006b10: 3d72 6571 7569 7265 6d65 6e74 732c 0a20  =requirements,. 
-00006b20: 2020 2020 2020 2073 7570 706f 7274 6564         supported
-00006b30: 7265 7175 6972 656d 656e 7473 3d73 7570  requirements=sup
-00006b40: 706f 7274 6564 7265 7175 6972 656d 656e  portedrequiremen
-00006b50: 7473 2c0a 2020 2020 2020 2020 7368 6172  ts,.        shar
-00006b60: 6564 7061 7468 3d73 746f 7265 6261 7365  edpath=storebase
-00006b70: 7061 7468 2c0a 2020 2020 2020 2020 7374  path,.        st
-00006b80: 6f72 653d 7374 6f72 652c 0a20 2020 2020  ore=store,.     
-00006b90: 2020 2063 6163 6865 7666 733d 6361 6368     cachevfs=cach
-00006ba0: 6576 6673 2c0a 2020 2020 2020 2020 7763  evfs,.        wc
-00006bb0: 6163 6865 7666 733d 7763 6163 6865 7666  achevfs=wcachevf
-00006bc0: 732c 0a20 2020 2020 2020 2066 6561 7475  s,.        featu
-00006bd0: 7265 733d 6665 6174 7572 6573 2c0a 2020  res=features,.  
-00006be0: 2020 2020 2020 696e 7465 6e74 733d 696e        intents=in
-00006bf0: 7465 6e74 732c 0a20 2020 2029 0a0a 0a64  tents,.    )...d
-00006c00: 6566 206c 6f61 6468 6772 6328 0a20 2020  ef loadhgrc(.   
-00006c10: 2075 692c 0a20 2020 2077 6469 7276 6673   ui,.    wdirvfs
-00006c20: 3a20 7666 736d 6f64 2e76 6673 2c0a 2020  : vfsmod.vfs,.  
-00006c30: 2020 6867 7666 733a 2076 6673 6d6f 642e    hgvfs: vfsmod.
-00006c40: 7666 732c 0a20 2020 2072 6571 7569 7265  vfs,.    require
-00006c50: 6d65 6e74 732c 0a20 2020 2073 6861 7265  ments,.    share
-00006c60: 6476 6673 3a20 4f70 7469 6f6e 616c 5b76  dvfs: Optional[v
-00006c70: 6673 6d6f 642e 7666 735d 203d 204e 6f6e  fsmod.vfs] = Non
-00006c80: 652c 0a29 3a0a 2020 2020 2222 224c 6f61  e,.):.    """Loa
-00006c90: 6420 6867 7263 2066 696c 6573 2f63 6f6e  d hgrc files/con
-00006ca0: 7465 6e74 2069 6e74 6f20 6120 7569 2069  tent into a ui i
-00006cb0: 6e73 7461 6e63 652e 0a0a 2020 2020 5468  nstance...    Th
-00006cc0: 6973 2069 7320 6361 6c6c 6564 2064 7572  is is called dur
-00006cd0: 696e 6720 7265 706f 7369 746f 7279 206f  ing repository o
-00006ce0: 7065 6e69 6e67 2074 6f20 6c6f 6164 2061  pening to load a
-00006cf0: 6e79 2061 6464 6974 696f 6e61 6c0a 2020  ny additional.  
-00006d00: 2020 636f 6e66 6967 2066 696c 6573 206f    config files o
-00006d10: 7220 7365 7474 696e 6773 2072 656c 6576  r settings relev
-00006d20: 616e 7420 746f 2074 6865 2063 7572 7265  ant to the curre
-00006d30: 6e74 2072 6570 6f73 6974 6f72 792e 0a0a  nt repository...
-00006d40: 2020 2020 5265 7475 726e 7320 6120 626f      Returns a bo
-00006d50: 6f6c 2069 6e64 6963 6174 696e 6720 7768  ol indicating wh
-00006d60: 6574 6865 7220 616e 7920 6164 6469 7469  ether any additi
-00006d70: 6f6e 616c 2063 6f6e 6669 6773 2077 6572  onal configs wer
-00006d80: 6520 6c6f 6164 6564 2e0a 0a20 2020 2045  e loaded...    E
-00006d90: 7874 656e 7369 6f6e 7320 7368 6f75 6c64  xtensions should
-00006da0: 206d 6f6e 6b65 7970 6174 6368 2074 6869   monkeypatch thi
-00006db0: 7320 6675 6e63 7469 6f6e 2074 6f20 6d6f  s function to mo
-00006dc0: 6469 6679 2068 6f77 2070 6572 2d72 6570  dify how per-rep
-00006dd0: 6f0a 2020 2020 636f 6e66 6967 7320 6172  o.    configs ar
-00006de0: 6520 6c6f 6164 6564 2e20 466f 7220 6578  e loaded. For ex
-00006df0: 616d 706c 652c 2061 6e20 6578 7465 6e73  ample, an extens
-00006e00: 696f 6e20 6d61 7920 7769 7368 2074 6f20  ion may wish to 
-00006e10: 7075 6c6c 2069 6e0a 2020 2020 636f 6e66  pull in.    conf
-00006e20: 6967 7320 6672 6f6d 2061 6c74 6572 6e61  igs from alterna
-00006e30: 7465 2066 696c 6573 206f 7220 736f 7572  te files or sour
-00006e40: 6365 732e 0a0a 2020 2020 7368 6172 6564  ces...    shared
-00006e50: 7666 7320 6973 2076 6673 206f 626a 6563  vfs is vfs objec
-00006e60: 7420 706f 696e 7469 6e67 2074 6f20 736f  t pointing to so
-00006e70: 7572 6365 2072 6570 6f20 6966 2074 6865  urce repo if the
-00006e80: 2063 7572 7265 6e74 206f 6e65 2069 7320   current one is 
-00006e90: 610a 2020 2020 7368 6172 6564 206f 6e65  a.    shared one
-00006ea0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-00006eb0: 6e6f 7420 7263 7574 696c 2e75 7365 5f72  not rcutil.use_r
-00006ec0: 6570 6f5f 6867 7263 2829 3a0a 2020 2020  epo_hgrc():.    
-00006ed0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00006ee0: 0a0a 2020 2020 7265 7420 3d20 4661 6c73  ..    ret = Fals
-00006ef0: 650a 2020 2020 2320 6669 7273 7420 6c6f  e.    # first lo
-00006f00: 6164 2063 6f6e 6669 6720 6672 6f6d 2073  ad config from s
-00006f10: 6861 7265 6420 736f 7572 6365 2069 6620  hared source if 
-00006f20: 7765 2068 6173 2074 6f0a 2020 2020 6966  we has to.    if
-00006f30: 2072 6571 7569 7265 6d65 6e74 736d 6f64   requirementsmod
-00006f40: 2e53 4841 5245 5341 4645 5f52 4551 5549  .SHARESAFE_REQUI
-00006f50: 5245 4d45 4e54 2069 6e20 7265 7175 6972  REMENT in requir
-00006f60: 656d 656e 7473 2061 6e64 2073 6861 7265  ements and share
-00006f70: 6476 6673 3a0a 2020 2020 2020 2020 7472  dvfs:.        tr
-00006f80: 793a 0a20 2020 2020 2020 2020 2020 2075  y:.            u
-00006f90: 692e 7265 6164 636f 6e66 6967 2873 6861  i.readconfig(sha
-00006fa0: 7265 6476 6673 2e6a 6f69 6e28 6227 6867  redvfs.join(b'hg
-00006fb0: 7263 2729 2c20 726f 6f74 3d73 6861 7265  rc'), root=share
-00006fc0: 6476 6673 2e62 6173 6529 0a20 2020 2020  dvfs.base).     
-00006fd0: 2020 2020 2020 2072 6574 203d 2054 7275         ret = Tru
-00006fe0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-00006ff0: 2049 4f45 7272 6f72 3a0a 2020 2020 2020   IOError:.      
-00007000: 2020 2020 2020 7061 7373 0a0a 2020 2020        pass..    
-00007010: 7472 793a 0a20 2020 2020 2020 2075 692e  try:.        ui.
-00007020: 7265 6164 636f 6e66 6967 2868 6776 6673  readconfig(hgvfs
-00007030: 2e6a 6f69 6e28 6227 6867 7263 2729 2c20  .join(b'hgrc'), 
-00007040: 726f 6f74 3d77 6469 7276 6673 2e62 6173  root=wdirvfs.bas
-00007050: 6529 0a20 2020 2020 2020 2072 6574 203d  e).        ret =
-00007060: 2054 7275 650a 2020 2020 6578 6365 7074   True.    except
-00007070: 2049 4f45 7272 6f72 3a0a 2020 2020 2020   IOError:.      
-00007080: 2020 7061 7373 0a0a 2020 2020 7472 793a    pass..    try:
-00007090: 0a20 2020 2020 2020 2075 692e 7265 6164  .        ui.read
-000070a0: 636f 6e66 6967 2868 6776 6673 2e6a 6f69  config(hgvfs.joi
-000070b0: 6e28 6227 6867 7263 2d6e 6f74 2d73 6861  n(b'hgrc-not-sha
-000070c0: 7265 6427 292c 2072 6f6f 743d 7764 6972  red'), root=wdir
-000070d0: 7666 732e 6261 7365 290a 2020 2020 2020  vfs.base).      
-000070e0: 2020 7265 7420 3d20 5472 7565 0a20 2020    ret = True.   
-000070f0: 2065 7863 6570 7420 494f 4572 726f 723a   except IOError:
-00007100: 0a20 2020 2020 2020 2070 6173 730a 0a20  .        pass.. 
-00007110: 2020 2072 6574 7572 6e20 7265 740a 0a0a     return ret...
-00007120: 6465 6620 6166 7465 7268 6772 636c 6f61  def afterhgrcloa
-00007130: 6428 7569 2c20 7764 6972 7666 732c 2068  d(ui, wdirvfs, h
-00007140: 6776 6673 2c20 7265 7175 6972 656d 656e  gvfs, requiremen
-00007150: 7473 293a 0a20 2020 2022 2222 5065 7266  ts):.    """Perf
-00007160: 6f72 6d20 6164 6469 7469 6f6e 616c 2061  orm additional a
-00007170: 6374 696f 6e73 2061 6674 6572 202e 6867  ctions after .hg
-00007180: 2f68 6772 6320 6973 206c 6f61 6465 642e  /hgrc is loaded.
-00007190: 0a0a 2020 2020 5468 6973 2066 756e 6374  ..    This funct
-000071a0: 696f 6e20 6973 2063 616c 6c65 6420 6475  ion is called du
-000071b0: 7269 6e67 2072 6570 6f73 6974 6f72 7920  ring repository 
-000071c0: 6c6f 6164 696e 6720 696d 6d65 6469 6174  loading immediat
-000071d0: 656c 7920 6166 7465 720a 2020 2020 7468  ely after.    th
-000071e0: 6520 2e68 672f 6867 7263 2066 696c 6520  e .hg/hgrc file 
-000071f0: 6973 206c 6f61 6465 6420 616e 6420 6265  is loaded and be
-00007200: 666f 7265 2070 6572 2d72 6570 6f20 6578  fore per-repo ex
-00007210: 7465 6e73 696f 6e73 2061 7265 206c 6f61  tensions are loa
-00007220: 6465 642e 0a0a 2020 2020 5468 6520 6675  ded...    The fu
-00007230: 6e63 7469 6f6e 2063 616e 2062 6520 7573  nction can be us
-00007240: 6564 2074 6f20 7661 6c69 6461 7465 2063  ed to validate c
-00007250: 6f6e 6669 6773 2c20 6175 746f 6d61 7469  onfigs, automati
-00007260: 6361 6c6c 7920 6164 640a 2020 2020 6f70  cally add.    op
-00007270: 7469 6f6e 7320 2869 6e63 6c75 6469 6e67  tions (including
-00007280: 2065 7874 656e 7369 6f6e 7329 2062 6173   extensions) bas
-00007290: 6564 206f 6e20 7265 7175 6972 656d 656e  ed on requiremen
-000072a0: 7473 2c20 6574 632e 0a20 2020 2022 2222  ts, etc..    """
-000072b0: 0a0a 2020 2020 2320 4d61 7020 6f66 2072  ..    # Map of r
-000072c0: 6571 7569 7265 6d65 6e74 7320 746f 206c  equirements to l
-000072d0: 6973 7420 6f66 2065 7874 656e 7369 6f6e  ist of extension
-000072e0: 7320 746f 206c 6f61 6420 6175 746f 6d61  s to load automa
-000072f0: 7469 6361 6c6c 7920 7768 656e 0a20 2020  tically when.   
-00007300: 2023 2072 6571 7569 7265 6d65 6e74 2069   # requirement i
-00007310: 7320 7072 6573 656e 742e 0a20 2020 2061  s present..    a
-00007320: 7574 6f65 7874 656e 7369 6f6e 7320 3d20  utoextensions = 
-00007330: 7b0a 2020 2020 2020 2020 6227 6769 7427  {.        b'git'
-00007340: 3a20 5b62 2767 6974 275d 2c0a 2020 2020  : [b'git'],.    
-00007350: 2020 2020 6227 6c61 7267 6566 696c 6573      b'largefiles
-00007360: 273a 205b 6227 6c61 7267 6566 696c 6573  ': [b'largefiles
-00007370: 275d 2c0a 2020 2020 2020 2020 6227 6c66  '],.        b'lf
-00007380: 7327 3a20 5b62 276c 6673 275d 2c0a 2020  s': [b'lfs'],.  
-00007390: 2020 7d0a 0a20 2020 2066 6f72 2072 6571    }..    for req
-000073a0: 7569 7265 6d65 6e74 2c20 6e61 6d65 7320  uirement, names 
-000073b0: 696e 2073 6f72 7465 6428 6175 746f 6578  in sorted(autoex
-000073c0: 7465 6e73 696f 6e73 2e69 7465 6d73 2829  tensions.items()
-000073d0: 293a 0a20 2020 2020 2020 2069 6620 7265  ):.        if re
-000073e0: 7175 6972 656d 656e 7420 6e6f 7420 696e  quirement not in
-000073f0: 2072 6571 7569 7265 6d65 6e74 733a 0a20   requirements:. 
-00007400: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00007410: 6e75 650a 0a20 2020 2020 2020 2066 6f72  nue..        for
-00007420: 206e 616d 6520 696e 206e 616d 6573 3a0a   name in names:.
-00007430: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00007440: 6f74 2075 692e 6861 7363 6f6e 6669 6728  ot ui.hasconfig(
-00007450: 6227 6578 7465 6e73 696f 6e73 272c 206e  b'extensions', n
-00007460: 616d 6529 3a0a 2020 2020 2020 2020 2020  ame):.          
-00007470: 2020 2020 2020 7569 2e73 6574 636f 6e66        ui.setconf
-00007480: 6967 2862 2765 7874 656e 7369 6f6e 7327  ig(b'extensions'
-00007490: 2c20 6e61 6d65 2c20 6227 272c 2073 6f75  , name, b'', sou
-000074a0: 7263 653d 6227 6175 746f 6c6f 6164 2729  rce=b'autoload')
-000074b0: 0a0a 0a64 6566 2067 6174 6865 7273 7570  ...def gathersup
-000074c0: 706f 7274 6564 7265 7175 6972 656d 656e  portedrequiremen
-000074d0: 7473 2875 6929 3a0a 2020 2020 2222 2244  ts(ui):.    """D
-000074e0: 6574 6572 6d69 6e65 2074 6865 2063 6f6d  etermine the com
-000074f0: 706c 6574 6520 7365 7420 6f66 2072 6563  plete set of rec
-00007500: 6f67 6e69 7a65 6420 7265 7175 6972 656d  ognized requirem
-00007510: 656e 7473 2e22 2222 0a20 2020 2023 2053  ents.""".    # S
-00007520: 7461 7274 2077 6974 6820 616c 6c20 7265  tart with all re
-00007530: 7175 6972 656d 656e 7473 2073 7570 706f  quirements suppo
-00007540: 7274 6564 2062 7920 7468 6973 2066 696c  rted by this fil
-00007550: 652e 0a20 2020 2073 7570 706f 7274 6564  e..    supported
-00007560: 203d 2073 6574 286c 6f63 616c 7265 706f   = set(localrepo
-00007570: 7369 746f 7279 2e5f 6261 7365 7375 7070  sitory._basesupp
-00007580: 6f72 7465 6429 0a0a 2020 2020 2320 4578  orted)..    # Ex
-00007590: 6563 7574 6520 6060 6665 6174 7572 6573  ecute ``features
-000075a0: 6574 7570 6675 6e63 7360 6020 656e 7472  etupfuncs`` entr
-000075b0: 6965 7320 6966 2074 6865 7920 6265 6c6f  ies if they belo
-000075c0: 6e67 2074 6f20 616e 2065 7874 656e 7369  ng to an extensi
-000075d0: 6f6e 0a20 2020 2023 2072 656c 6576 616e  on.    # relevan
-000075e0: 7420 746f 2074 6869 7320 7569 2069 6e73  t to this ui ins
-000075f0: 7461 6e63 652e 0a20 2020 206d 6f64 756c  tance..    modul
-00007600: 6573 203d 207b 6d2e 5f5f 6e61 6d65 5f5f  es = {m.__name__
-00007610: 2066 6f72 206e 2c20 6d20 696e 2065 7874   for n, m in ext
-00007620: 656e 7369 6f6e 732e 6578 7465 6e73 696f  ensions.extensio
-00007630: 6e73 2875 6929 7d0a 0a20 2020 2066 6f72  ns(ui)}..    for
-00007640: 2066 6e20 696e 2066 6561 7475 7265 7365   fn in featurese
-00007650: 7475 7066 756e 6373 3a0a 2020 2020 2020  tupfuncs:.      
-00007660: 2020 6966 2066 6e2e 5f5f 6d6f 6475 6c65    if fn.__module
-00007670: 5f5f 2069 6e20 6d6f 6475 6c65 733a 0a20  __ in modules:. 
-00007680: 2020 2020 2020 2020 2020 2066 6e28 7569             fn(ui
-00007690: 2c20 7375 7070 6f72 7465 6429 0a0a 2020  , supported)..  
-000076a0: 2020 2320 4164 6420 6465 7269 7665 6420    # Add derived 
-000076b0: 7265 7175 6972 656d 656e 7473 2066 726f  requirements fro
-000076c0: 6d20 7265 6769 7374 6572 6564 2063 6f6d  m registered com
-000076d0: 7072 6573 7369 6f6e 2065 6e67 696e 6573  pression engines
-000076e0: 2e0a 2020 2020 666f 7220 6e61 6d65 2069  ..    for name i
-000076f0: 6e20 7574 696c 2e63 6f6d 7065 6e67 696e  n util.compengin
-00007700: 6573 3a0a 2020 2020 2020 2020 656e 6769  es:.        engi
-00007710: 6e65 203d 2075 7469 6c2e 636f 6d70 656e  ne = util.compen
-00007720: 6769 6e65 735b 6e61 6d65 5d0a 2020 2020  gines[name].    
-00007730: 2020 2020 6966 2065 6e67 696e 652e 6176      if engine.av
-00007740: 6169 6c61 626c 6528 2920 616e 6420 656e  ailable() and en
-00007750: 6769 6e65 2e72 6576 6c6f 6768 6561 6465  gine.revlogheade
-00007760: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
-00007770: 2073 7570 706f 7274 6564 2e61 6464 2862   supported.add(b
-00007780: 2765 7870 2d63 6f6d 7072 6573 7369 6f6e  'exp-compression
-00007790: 2d25 7327 2025 206e 616d 6529 0a20 2020  -%s' % name).   
-000077a0: 2020 2020 2020 2020 2069 6620 656e 6769           if engi
-000077b0: 6e65 2e6e 616d 6528 2920 3d3d 2062 277a  ne.name() == b'z
-000077c0: 7374 6427 3a0a 2020 2020 2020 2020 2020  std':.          
-000077d0: 2020 2020 2020 7375 7070 6f72 7465 642e        supported.
-000077e0: 6164 6428 7265 7175 6972 656d 656e 7473  add(requirements
-000077f0: 6d6f 642e 5245 564c 4f47 5f43 4f4d 5052  mod.REVLOG_COMPR
-00007800: 4553 5349 4f4e 5f5a 5354 4429 0a0a 2020  ESSION_ZSTD)..  
-00007810: 2020 7265 7475 726e 2073 7570 706f 7274    return support
-00007820: 6564 0a0a 0a64 6566 2065 6e73 7572 6572  ed...def ensurer
-00007830: 6571 7569 7265 6d65 6e74 7372 6563 6f67  equirementsrecog
-00007840: 6e69 7a65 6428 7265 7175 6972 656d 656e  nized(requiremen
-00007850: 7473 2c20 7375 7070 6f72 7465 6429 3a0a  ts, supported):.
-00007860: 2020 2020 2222 2256 616c 6964 6174 6520      """Validate 
-00007870: 7468 6174 2061 2073 6574 206f 6620 6c6f  that a set of lo
-00007880: 6361 6c20 7265 7175 6972 656d 656e 7473  cal requirements
-00007890: 2069 7320 7265 636f 676e 697a 6564 2e0a   is recognized..
-000078a0: 0a20 2020 2052 6563 6569 7665 7320 6120  .    Receives a 
-000078b0: 7365 7420 6f66 2072 6571 7569 7265 6d65  set of requireme
-000078c0: 6e74 732e 2052 6169 7365 7320 616e 2060  nts. Raises an `
-000078d0: 6065 7272 6f72 2e52 6570 6f45 7272 6f72  `error.RepoError
-000078e0: 6060 2069 6620 7468 6572 650a 2020 2020  `` if there.    
-000078f0: 6578 6973 7473 2061 6e79 2072 6571 7569  exists any requi
-00007900: 7265 6d65 6e74 2069 6e20 7468 6174 2073  rement in that s
-00007910: 6574 2074 6861 7420 6375 7272 656e 746c  et that currentl
-00007920: 7920 6c6f 6164 6564 2063 6f64 6520 646f  y loaded code do
-00007930: 6573 6e27 740a 2020 2020 7265 636f 676e  esn't.    recogn
-00007940: 697a 652e 0a0a 2020 2020 5265 7475 726e  ize...    Return
-00007950: 7320 6120 7365 7420 6f66 2073 7570 706f  s a set of suppo
-00007960: 7274 6564 2072 6571 7569 7265 6d65 6e74  rted requirement
-00007970: 732e 0a20 2020 2022 2222 0a20 2020 206d  s..    """.    m
-00007980: 6973 7369 6e67 203d 2073 6574 2829 0a0a  issing = set()..
-00007990: 2020 2020 666f 7220 7265 7175 6972 656d      for requirem
-000079a0: 656e 7420 696e 2072 6571 7569 7265 6d65  ent in requireme
-000079b0: 6e74 733a 0a20 2020 2020 2020 2069 6620  nts:.        if 
-000079c0: 7265 7175 6972 656d 656e 7420 696e 2073  requirement in s
-000079d0: 7570 706f 7274 6564 3a0a 2020 2020 2020  upported:.      
-000079e0: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
-000079f0: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
-00007a00: 6571 7569 7265 6d65 6e74 206f 7220 6e6f  equirement or no
-00007a10: 7420 7265 7175 6972 656d 656e 745b 303a  t requirement[0:
-00007a20: 315d 2e69 7361 6c6e 756d 2829 3a0a 2020  1].isalnum():.  
-00007a30: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00007a40: 6572 726f 722e 5265 7175 6972 656d 656e  error.Requiremen
-00007a50: 7445 7272 6f72 285f 2862 272e 6867 2f72  tError(_(b'.hg/r
-00007a60: 6571 7569 7265 7320 6669 6c65 2069 7320  equires file is 
-00007a70: 636f 7272 7570 7427 2929 0a0a 2020 2020  corrupt'))..    
-00007a80: 2020 2020 6d69 7373 696e 672e 6164 6428      missing.add(
-00007a90: 7265 7175 6972 656d 656e 7429 0a0a 2020  requirement)..  
-00007aa0: 2020 6966 206d 6973 7369 6e67 3a0a 2020    if missing:.  
-00007ab0: 2020 2020 2020 7261 6973 6520 6572 726f        raise erro
-00007ac0: 722e 5265 7175 6972 656d 656e 7445 7272  r.RequirementErr
-00007ad0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00007ae0: 5f28 6227 7265 706f 7369 746f 7279 2072  _(b'repository r
-00007af0: 6571 7569 7265 7320 6665 6174 7572 6573  equires features
-00007b00: 2075 6e6b 6e6f 776e 2074 6f20 7468 6973   unknown to this
-00007b10: 204d 6572 6375 7269 616c 3a20 2573 2729   Mercurial: %s')
-00007b20: 0a20 2020 2020 2020 2020 2020 2025 2062  .            % b
-00007b30: 2720 272e 6a6f 696e 2873 6f72 7465 6428  ' '.join(sorted(
-00007b40: 6d69 7373 696e 6729 292c 0a20 2020 2020  missing)),.     
-00007b50: 2020 2020 2020 2068 696e 743d 5f28 0a20         hint=_(. 
-00007b60: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00007b70: 2773 6565 2068 7474 7073 3a2f 2f6d 6572  'see https://mer
-00007b80: 6375 7269 616c 2d73 636d 2e6f 7267 2f77  curial-scm.org/w
-00007b90: 696b 692f 4d69 7373 696e 6752 6571 7569  iki/MissingRequi
-00007ba0: 7265 6d65 6e74 2027 0a20 2020 2020 2020  rement '.       
-00007bb0: 2020 2020 2020 2020 2062 2766 6f72 206d           b'for m
-00007bc0: 6f72 6520 696e 666f 726d 6174 696f 6e27  ore information'
-00007bd0: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
-00007be0: 2020 2020 2020 2020 290a 0a0a 6465 6620          )...def 
-00007bf0: 656e 7375 7265 7265 7175 6972 656d 656e  ensurerequiremen
-00007c00: 7473 636f 6d70 6174 6962 6c65 2875 692c  tscompatible(ui,
-00007c10: 2072 6571 7569 7265 6d65 6e74 7329 3a0a   requirements):.
-00007c20: 2020 2020 2222 2256 616c 6964 6174 6573      """Validates
-00007c30: 2074 6861 7420 6120 7365 7420 6f66 2072   that a set of r
-00007c40: 6563 6f67 6e69 7a65 6420 7265 7175 6972  ecognized requir
-00007c50: 656d 656e 7473 2069 7320 6d75 7475 616c  ements is mutual
-00007c60: 6c79 2063 6f6d 7061 7469 626c 652e 0a0a  ly compatible...
-00007c70: 2020 2020 536f 6d65 2072 6571 7569 7265      Some require
-00007c80: 6d65 6e74 7320 6d61 7920 6e6f 7420 6265  ments may not be
-00007c90: 2063 6f6d 7061 7469 626c 6520 7769 7468   compatible with
-00007ca0: 206f 7468 6572 7320 6f72 2072 6571 7569   others or requi
-00007cb0: 7265 0a20 2020 2063 6f6e 6669 6720 6f70  re.    config op
-00007cc0: 7469 6f6e 7320 7468 6174 2061 7265 6e27  tions that aren'
-00007cd0: 7420 656e 6162 6c65 642e 2054 6869 7320  t enabled. This 
-00007ce0: 6675 6e63 7469 6f6e 2069 7320 6361 6c6c  function is call
-00007cf0: 6564 2064 7572 696e 670a 2020 2020 7265  ed during.    re
-00007d00: 706f 7369 746f 7279 206f 7065 6e69 6e67  pository opening
-00007d10: 2074 6f20 656e 7375 7265 2074 6861 7420   to ensure that 
-00007d20: 7468 6520 7365 7420 6f66 2072 6571 7569  the set of requi
-00007d30: 7265 6d65 6e74 7320 6e65 6564 6564 0a20  rements needed. 
-00007d40: 2020 2074 6f20 6f70 656e 2061 2072 6570     to open a rep
-00007d50: 6f73 6974 6f72 7920 6973 2073 616e 6520  ository is sane 
-00007d60: 616e 6420 636f 6d70 6174 6962 6c65 2077  and compatible w
-00007d70: 6974 6820 636f 6e66 6967 206f 7074 696f  ith config optio
-00007d80: 6e73 2e0a 0a20 2020 2045 7874 656e 7369  ns...    Extensi
-00007d90: 6f6e 7320 6361 6e20 6d6f 6e6b 6579 7061  ons can monkeypa
-00007da0: 7463 6820 7468 6973 2066 756e 6374 696f  tch this functio
-00007db0: 6e20 746f 2070 6572 666f 726d 2061 6464  n to perform add
-00007dc0: 6974 696f 6e61 6c0a 2020 2020 6368 6563  itional.    chec
-00007dd0: 6b69 6e67 2e0a 0a20 2020 2060 6065 7272  king...    ``err
-00007de0: 6f72 2e52 6570 6f45 7272 6f72 6060 2073  or.RepoError`` s
-00007df0: 686f 756c 6420 6265 2072 6169 7365 6420  hould be raised 
-00007e00: 6f6e 2066 6169 6c75 7265 2e0a 2020 2020  on failure..    
-00007e10: 2222 220a 2020 2020 6966 2028 0a20 2020  """.    if (.   
-00007e20: 2020 2020 2072 6571 7569 7265 6d65 6e74       requirement
-00007e30: 736d 6f64 2e53 5041 5253 455f 5245 5155  smod.SPARSE_REQU
-00007e40: 4952 454d 454e 5420 696e 2072 6571 7569  IREMENT in requi
-00007e50: 7265 6d65 6e74 730a 2020 2020 2020 2020  rements.        
-00007e60: 616e 6420 6e6f 7420 7370 6172 7365 2e65  and not sparse.e
-00007e70: 6e61 626c 6564 0a20 2020 2029 3a0a 2020  nabled.    ):.  
-00007e80: 2020 2020 2020 7261 6973 6520 6572 726f        raise erro
-00007e90: 722e 5265 706f 4572 726f 7228 0a20 2020  r.RepoError(.   
-00007ea0: 2020 2020 2020 2020 205f 280a 2020 2020           _(.    
-00007eb0: 2020 2020 2020 2020 2020 2020 6227 7265              b're
-00007ec0: 706f 7369 746f 7279 2069 7320 7573 696e  pository is usin
-00007ed0: 6720 7370 6172 7365 2066 6561 7475 7265  g sparse feature
-00007ee0: 2062 7574 2027 0a20 2020 2020 2020 2020   but '.         
-00007ef0: 2020 2020 2020 2062 2773 7061 7273 6520         b'sparse 
-00007f00: 6973 206e 6f74 2065 6e61 626c 6564 3b20  is not enabled; 
-00007f10: 656e 6162 6c65 2074 6865 2027 0a20 2020  enable the '.   
-00007f20: 2020 2020 2020 2020 2020 2020 2062 2722               b'"
-00007f30: 7370 6172 7365 2220 6578 7465 6e73 696f  sparse" extensio
-00007f40: 6e73 2074 6f20 6163 6365 7373 270a 2020  ns to access'.  
-00007f50: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00007f60: 2020 2020 290a 0a0a 6465 6620 6d61 6b65      )...def make
-00007f70: 7374 6f72 6528 7265 7175 6972 656d 656e  store(requiremen
-00007f80: 7473 2c20 7061 7468 2c20 7666 7374 7970  ts, path, vfstyp
-00007f90: 6529 3a0a 2020 2020 2222 2243 6f6e 7374  e):.    """Const
-00007fa0: 7275 6374 2061 2073 746f 7261 6765 206f  ruct a storage o
-00007fb0: 626a 6563 7420 666f 7220 6120 7265 706f  bject for a repo
-00007fc0: 7369 746f 7279 2e22 2222 0a20 2020 2069  sitory.""".    i
-00007fd0: 6620 7265 7175 6972 656d 656e 7473 6d6f  f requirementsmo
-00007fe0: 642e 5354 4f52 455f 5245 5155 4952 454d  d.STORE_REQUIREM
-00007ff0: 454e 5420 696e 2072 6571 7569 7265 6d65  ENT in requireme
-00008000: 6e74 733a 0a20 2020 2020 2020 2069 6620  nts:.        if 
-00008010: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
-00008020: 464e 4341 4348 455f 5245 5155 4952 454d  FNCACHE_REQUIREM
-00008030: 454e 5420 696e 2072 6571 7569 7265 6d65  ENT in requireme
-00008040: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
-00008050: 2064 6f74 656e 636f 6465 203d 2072 6571   dotencode = req
-00008060: 7569 7265 6d65 6e74 736d 6f64 2e44 4f54  uirementsmod.DOT
-00008070: 454e 434f 4445 5f52 4551 5549 5245 4d45  ENCODE_REQUIREME
-00008080: 4e54 2069 6e20 7265 7175 6972 656d 656e  NT in requiremen
-00008090: 7473 0a20 2020 2020 2020 2020 2020 2072  ts.            r
-000080a0: 6574 7572 6e20 7374 6f72 656d 6f64 2e66  eturn storemod.f
-000080b0: 6e63 6163 6865 7374 6f72 6528 7061 7468  ncachestore(path
-000080c0: 2c20 7666 7374 7970 652c 2064 6f74 656e  , vfstype, doten
-000080d0: 636f 6465 290a 0a20 2020 2020 2020 2072  code)..        r
-000080e0: 6574 7572 6e20 7374 6f72 656d 6f64 2e65  eturn storemod.e
-000080f0: 6e63 6f64 6564 7374 6f72 6528 7061 7468  ncodedstore(path
-00008100: 2c20 7666 7374 7970 6529 0a0a 2020 2020  , vfstype)..    
-00008110: 7265 7475 726e 2073 746f 7265 6d6f 642e  return storemod.
-00008120: 6261 7369 6373 746f 7265 2870 6174 682c  basicstore(path,
-00008130: 2076 6673 7479 7065 290a 0a0a 6465 6620   vfstype)...def 
-00008140: 7265 736f 6c76 6573 746f 7265 7666 736f  resolvestorevfso
-00008150: 7074 696f 6e73 2875 692c 2072 6571 7569  ptions(ui, requi
-00008160: 7265 6d65 6e74 732c 2066 6561 7475 7265  rements, feature
-00008170: 7329 3a0a 2020 2020 2222 2252 6573 6f6c  s):.    """Resol
-00008180: 7665 2074 6865 206f 7074 696f 6e73 2074  ve the options t
-00008190: 6f20 7061 7373 2074 6f20 7468 6520 7374  o pass to the st
-000081a0: 6f72 6520 7666 7320 6f70 656e 6572 2e0a  ore vfs opener..
-000081b0: 0a20 2020 2054 6865 2072 6574 7572 6e65  .    The returne
-000081c0: 6420 6469 6374 2069 7320 7573 6564 2074  d dict is used t
-000081d0: 6f20 696e 666c 7565 6e63 6520 6265 6861  o influence beha
-000081e0: 7669 6f72 206f 6620 7468 6520 7374 6f72  vior of the stor
-000081f0: 6167 6520 6c61 7965 722e 0a20 2020 2022  age layer..    "
-00008200: 2222 0a20 2020 206f 7074 696f 6e73 203d  "".    options =
-00008210: 207b 7d0a 0a20 2020 2069 6620 7265 7175   {}..    if requ
-00008220: 6972 656d 656e 7473 6d6f 642e 5452 4545  irementsmod.TREE
-00008230: 4d41 4e49 4645 5354 5f52 4551 5549 5245  MANIFEST_REQUIRE
-00008240: 4d45 4e54 2069 6e20 7265 7175 6972 656d  MENT in requirem
-00008250: 656e 7473 3a0a 2020 2020 2020 2020 6f70  ents:.        op
-00008260: 7469 6f6e 735b 6227 7472 6565 6d61 6e69  tions[b'treemani
-00008270: 6665 7374 275d 203d 2054 7275 650a 0a20  fest'] = True.. 
-00008280: 2020 2023 2065 7870 6572 696d 656e 7461     # experimenta
-00008290: 6c20 636f 6e66 6967 3a20 666f 726d 6174  l config: format
-000082a0: 2e6d 616e 6966 6573 7463 6163 6865 7369  .manifestcachesi
-000082b0: 7a65 0a20 2020 206d 616e 6966 6573 7463  ze.    manifestc
-000082c0: 6163 6865 7369 7a65 203d 2075 692e 636f  achesize = ui.co
-000082d0: 6e66 6967 696e 7428 6227 666f 726d 6174  nfigint(b'format
-000082e0: 272c 2062 276d 616e 6966 6573 7463 6163  ', b'manifestcac
-000082f0: 6865 7369 7a65 2729 0a20 2020 2069 6620  hesize').    if 
-00008300: 6d61 6e69 6665 7374 6361 6368 6573 697a  manifestcachesiz
-00008310: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00008320: 2020 2020 2020 206f 7074 696f 6e73 5b62         options[b
-00008330: 276d 616e 6966 6573 7463 6163 6865 7369  'manifestcachesi
-00008340: 7a65 275d 203d 206d 616e 6966 6573 7463  ze'] = manifestc
-00008350: 6163 6865 7369 7a65 0a0a 2020 2020 2320  achesize..    # 
-00008360: 496e 2074 6865 2061 6273 656e 6365 206f  In the absence o
-00008370: 6620 616e 6f74 6865 7220 7265 7175 6972  f another requir
-00008380: 656d 656e 7420 7375 7065 7273 6564 696e  ement supersedin
-00008390: 6720 6120 7265 766c 6f67 2d72 656c 6174  g a revlog-relat
-000083a0: 6564 0a20 2020 2023 2072 6571 7569 7265  ed.    # require
-000083b0: 6d65 6e74 2c20 7765 2068 6176 6520 746f  ment, we have to
-000083c0: 2061 7373 756d 6520 7468 6520 7265 706f   assume the repo
-000083d0: 2069 7320 7573 696e 6720 7265 766c 6f67   is using revlog
-000083e0: 2076 6572 7369 6f6e 2030 2e0a 2020 2020   version 0..    
-000083f0: 2320 5468 6973 2072 6576 6c6f 6720 666f  # This revlog fo
-00008400: 726d 6174 2069 7320 7375 7065 7220 6f6c  rmat is super ol
-00008410: 6420 616e 6420 7765 2064 6f6e 2774 2062  d and we don't b
-00008420: 6f74 6865 7220 7472 7969 6e67 2074 6f20  other trying to 
-00008430: 7061 7273 650a 2020 2020 2320 6f70 656e  parse.    # open
-00008440: 6572 206f 7074 696f 6e73 2066 6f72 2069  er options for i
-00008450: 7420 6265 6361 7573 6520 7468 6f73 6520  t because those 
-00008460: 6f70 7469 6f6e 7320 776f 756c 646e 2774  options wouldn't
-00008470: 2064 6f20 616e 7974 6869 6e67 0a20 2020   do anything.   
-00008480: 2023 206d 6561 6e69 6e67 6675 6c20 6f6e   # meaningful on
-00008490: 2073 7563 6820 6f6c 6420 7265 706f 732e   such old repos.
-000084a0: 0a20 2020 2069 6620 280a 2020 2020 2020  .    if (.      
-000084b0: 2020 7265 7175 6972 656d 656e 7473 6d6f    requirementsmo
-000084c0: 642e 5245 564c 4f47 5631 5f52 4551 5549  d.REVLOGV1_REQUI
-000084d0: 5245 4d45 4e54 2069 6e20 7265 7175 6972  REMENT in requir
-000084e0: 656d 656e 7473 0a20 2020 2020 2020 206f  ements.        o
-000084f0: 7220 7265 7175 6972 656d 656e 7473 6d6f  r requirementsmo
-00008500: 642e 5245 564c 4f47 5632 5f52 4551 5549  d.REVLOGV2_REQUI
-00008510: 5245 4d45 4e54 2069 6e20 7265 7175 6972  REMENT in requir
-00008520: 656d 656e 7473 0a20 2020 2029 3a0a 2020  ements.    ):.  
-00008530: 2020 2020 2020 6f70 7469 6f6e 732e 7570        options.up
-00008540: 6461 7465 2872 6573 6f6c 7665 7265 766c  date(resolverevl
-00008550: 6f67 7374 6f72 6576 6673 6f70 7469 6f6e  ogstorevfsoption
-00008560: 7328 7569 2c20 7265 7175 6972 656d 656e  s(ui, requiremen
-00008570: 7473 2c20 6665 6174 7572 6573 2929 0a20  ts, features)). 
-00008580: 2020 2065 6c73 653a 2020 2320 6578 706c     else:  # expl
-00008590: 6963 6974 6c79 206d 6172 6b20 7265 706f  icitly mark repo
-000085a0: 2061 7320 7573 696e 6720 7265 766c 6f67   as using revlog
-000085b0: 7630 0a20 2020 2020 2020 206f 7074 696f  v0.        optio
-000085c0: 6e73 5b62 2772 6576 6c6f 6776 3027 5d20  ns[b'revlogv0'] 
-000085d0: 3d20 5472 7565 0a0a 2020 2020 6966 2072  = True..    if r
-000085e0: 6571 7569 7265 6d65 6e74 736d 6f64 2e43  equirementsmod.C
-000085f0: 4f50 4945 5353 4443 5f52 4551 5549 5245  OPIESSDC_REQUIRE
-00008600: 4d45 4e54 2069 6e20 7265 7175 6972 656d  MENT in requirem
-00008610: 656e 7473 3a0a 2020 2020 2020 2020 6f70  ents:.        op
-00008620: 7469 6f6e 735b 6227 636f 7069 6573 2d73  tions[b'copies-s
-00008630: 746f 7261 6765 275d 203d 2062 2763 6861  torage'] = b'cha
-00008640: 6e67 6573 6574 2d73 6964 6564 6174 6127  ngeset-sidedata'
-00008650: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00008660: 2020 2077 7269 7465 636f 7069 6573 746f     writecopiesto
-00008670: 203d 2075 692e 636f 6e66 6967 2862 2765   = ui.config(b'e
-00008680: 7870 6572 696d 656e 7461 6c27 2c20 6227  xperimental', b'
-00008690: 636f 7069 6573 2e77 7269 7465 2d74 6f27  copies.write-to'
-000086a0: 290a 2020 2020 2020 2020 636f 7069 6573  ).        copies
-000086b0: 6578 7472 616d 6f64 6520 3d20 2862 2763  extramode = (b'c
-000086c0: 6861 6e67 6573 6574 2d6f 6e6c 7927 2c20  hangeset-only', 
-000086d0: 6227 636f 6d70 6174 6962 696c 6974 7927  b'compatibility'
-000086e0: 290a 2020 2020 2020 2020 6966 2077 7269  ).        if wri
-000086f0: 7465 636f 7069 6573 746f 2069 6e20 636f  tecopiesto in co
-00008700: 7069 6573 6578 7472 616d 6f64 653a 0a20  piesextramode:. 
-00008710: 2020 2020 2020 2020 2020 206f 7074 696f             optio
-00008720: 6e73 5b62 2763 6f70 6965 732d 7374 6f72  ns[b'copies-stor
-00008730: 6167 6527 5d20 3d20 6227 6578 7472 6127  age'] = b'extra'
-00008740: 0a0a 2020 2020 7265 7475 726e 206f 7074  ..    return opt
-00008750: 696f 6e73 0a0a 0a64 6566 2072 6573 6f6c  ions...def resol
-00008760: 7665 7265 766c 6f67 7374 6f72 6576 6673  verevlogstorevfs
-00008770: 6f70 7469 6f6e 7328 7569 2c20 7265 7175  options(ui, requ
-00008780: 6972 656d 656e 7473 2c20 6665 6174 7572  irements, featur
-00008790: 6573 293a 0a20 2020 2022 2222 5265 736f  es):.    """Reso
-000087a0: 6c76 6520 6f70 656e 6572 206f 7074 696f  lve opener optio
-000087b0: 6e73 2073 7065 6369 6669 6320 746f 2072  ns specific to r
-000087c0: 6576 6c6f 6773 2e22 2222 0a0a 2020 2020  evlogs."""..    
-000087d0: 6f70 7469 6f6e 7320 3d20 7b7d 0a20 2020  options = {}.   
-000087e0: 206f 7074 696f 6e73 5b62 2766 6c61 6770   options[b'flagp
-000087f0: 726f 6365 7373 6f72 7327 5d20 3d20 7b7d  rocessors'] = {}
-00008800: 0a0a 2020 2020 6966 2072 6571 7569 7265  ..    if require
-00008810: 6d65 6e74 736d 6f64 2e52 4556 4c4f 4756  mentsmod.REVLOGV
-00008820: 315f 5245 5155 4952 454d 454e 5420 696e  1_REQUIREMENT in
-00008830: 2072 6571 7569 7265 6d65 6e74 733a 0a20   requirements:. 
-00008840: 2020 2020 2020 206f 7074 696f 6e73 5b62         options[b
-00008850: 2772 6576 6c6f 6776 3127 5d20 3d20 5472  'revlogv1'] = Tr
-00008860: 7565 0a20 2020 2069 6620 7265 7175 6972  ue.    if requir
-00008870: 656d 656e 7473 6d6f 642e 5245 564c 4f47  ementsmod.REVLOG
-00008880: 5632 5f52 4551 5549 5245 4d45 4e54 2069  V2_REQUIREMENT i
-00008890: 6e20 7265 7175 6972 656d 656e 7473 3a0a  n requirements:.
-000088a0: 2020 2020 2020 2020 6f70 7469 6f6e 735b          options[
-000088b0: 6227 7265 766c 6f67 7632 275d 203d 2054  b'revlogv2'] = T
-000088c0: 7275 650a 2020 2020 6966 2072 6571 7569  rue.    if requi
-000088d0: 7265 6d65 6e74 736d 6f64 2e43 4841 4e47  rementsmod.CHANG
-000088e0: 454c 4f47 5632 5f52 4551 5549 5245 4d45  ELOGV2_REQUIREME
-000088f0: 4e54 2069 6e20 7265 7175 6972 656d 656e  NT in requiremen
-00008900: 7473 3a0a 2020 2020 2020 2020 6f70 7469  ts:.        opti
-00008910: 6f6e 735b 6227 6368 616e 6765 6c6f 6776  ons[b'changelogv
-00008920: 3227 5d20 3d20 5472 7565 0a20 2020 2020  2'] = True.     
-00008930: 2020 2063 6d70 5f72 616e 6b20 3d20 7569     cmp_rank = ui
-00008940: 2e63 6f6e 6669 6762 6f6f 6c28 6227 6578  .configbool(b'ex
-00008950: 7065 7269 6d65 6e74 616c 272c 2062 2763  perimental', b'c
-00008960: 6861 6e67 656c 6f67 2d76 322e 636f 6d70  hangelog-v2.comp
-00008970: 7574 652d 7261 6e6b 2729 0a20 2020 2020  ute-rank').     
-00008980: 2020 206f 7074 696f 6e73 5b62 2763 6861     options[b'cha
-00008990: 6e67 656c 6f67 7632 2e63 6f6d 7075 7465  ngelogv2.compute
-000089a0: 2d72 616e 6b27 5d20 3d20 636d 705f 7261  -rank'] = cmp_ra
-000089b0: 6e6b 0a0a 2020 2020 6966 2072 6571 7569  nk..    if requi
-000089c0: 7265 6d65 6e74 736d 6f64 2e47 454e 4552  rementsmod.GENER
-000089d0: 414c 4445 4c54 415f 5245 5155 4952 454d  ALDELTA_REQUIREM
-000089e0: 454e 5420 696e 2072 6571 7569 7265 6d65  ENT in requireme
-000089f0: 6e74 733a 0a20 2020 2020 2020 206f 7074  nts:.        opt
-00008a00: 696f 6e73 5b62 2767 656e 6572 616c 6465  ions[b'generalde
-00008a10: 6c74 6127 5d20 3d20 5472 7565 0a0a 2020  lta'] = True..  
-00008a20: 2020 2320 6578 7065 7269 6d65 6e74 616c    # experimental
-00008a30: 2063 6f6e 6669 673a 2066 6f72 6d61 742e   config: format.
-00008a40: 6368 756e 6b63 6163 6865 7369 7a65 0a20  chunkcachesize. 
-00008a50: 2020 2063 6875 6e6b 6361 6368 6573 697a     chunkcachesiz
-00008a60: 6520 3d20 7569 2e63 6f6e 6669 6769 6e74  e = ui.configint
-00008a70: 2862 2766 6f72 6d61 7427 2c20 6227 6368  (b'format', b'ch
-00008a80: 756e 6b63 6163 6865 7369 7a65 2729 0a20  unkcachesize'). 
-00008a90: 2020 2069 6620 6368 756e 6b63 6163 6865     if chunkcache
-00008aa0: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
-00008ab0: 3a0a 2020 2020 2020 2020 6f70 7469 6f6e  :.        option
-00008ac0: 735b 6227 6368 756e 6b63 6163 6865 7369  s[b'chunkcachesi
-00008ad0: 7a65 275d 203d 2063 6875 6e6b 6361 6368  ze'] = chunkcach
-00008ae0: 6573 697a 650a 0a20 2020 2064 656c 7461  esize..    delta
-00008af0: 626f 7468 7061 7265 6e74 7320 3d20 7569  bothparents = ui
-00008b00: 2e63 6f6e 6669 6762 6f6f 6c28 0a20 2020  .configbool(.   
-00008b10: 2020 2020 2062 2773 746f 7261 6765 272c       b'storage',
-00008b20: 2062 2772 6576 6c6f 672e 6f70 7469 6d69   b'revlog.optimi
-00008b30: 7a65 2d64 656c 7461 2d70 6172 656e 742d  ze-delta-parent-
-00008b40: 6368 6f69 6365 270a 2020 2020 290a 2020  choice'.    ).  
-00008b50: 2020 6f70 7469 6f6e 735b 6227 6465 6c74    options[b'delt
-00008b60: 6162 6f74 6870 6172 656e 7473 275d 203d  abothparents'] =
-00008b70: 2064 656c 7461 626f 7468 7061 7265 6e74   deltabothparent
-00008b80: 730a 2020 2020 6470 735f 6367 6473 203d  s.    dps_cgds =
-00008b90: 2075 692e 636f 6e66 6967 696e 7428 0a20   ui.configint(. 
-00008ba0: 2020 2020 2020 2062 2773 746f 7261 6765         b'storage
-00008bb0: 272c 0a20 2020 2020 2020 2062 2772 6576  ',.        b'rev
-00008bc0: 6c6f 672e 6465 6c74 612d 7061 7265 6e74  log.delta-parent
-00008bd0: 2d73 6561 7263 682e 6361 6e64 6964 6174  -search.candidat
-00008be0: 652d 6772 6f75 702d 6368 756e 6b2d 7369  e-group-chunk-si
-00008bf0: 7a65 272c 0a20 2020 2029 0a20 2020 206f  ze',.    ).    o
-00008c00: 7074 696f 6e73 5b62 2764 656c 7461 2d70  ptions[b'delta-p
-00008c10: 6172 656e 742d 7365 6172 6368 2e63 616e  arent-search.can
-00008c20: 6469 6461 7465 2d67 726f 7570 2d63 6875  didate-group-chu
-00008c30: 6e6b 2d73 697a 6527 5d20 3d20 6470 735f  nk-size'] = dps_
-00008c40: 6367 6473 0a20 2020 206f 7074 696f 6e73  cgds.    options
-00008c50: 5b62 2764 6562 7567 2d64 656c 7461 275d  [b'debug-delta']
-00008c60: 203d 2075 692e 636f 6e66 6967 626f 6f6c   = ui.configbool
-00008c70: 2862 2764 6562 7567 272c 2062 2772 6576  (b'debug', b'rev
-00008c80: 6c6f 672e 6465 6275 672d 6465 6c74 6127  log.debug-delta'
-00008c90: 290a 0a20 2020 2069 7373 7565 3635 3238  )..    issue6528
-00008ca0: 203d 2075 692e 636f 6e66 6967 626f 6f6c   = ui.configbool
-00008cb0: 2862 2773 746f 7261 6765 272c 2062 2772  (b'storage', b'r
-00008cc0: 6576 6c6f 672e 6973 7375 6536 3532 382e  evlog.issue6528.
-00008cd0: 6669 782d 696e 636f 6d69 6e67 2729 0a20  fix-incoming'). 
-00008ce0: 2020 206f 7074 696f 6e73 5b62 2769 7373     options[b'iss
-00008cf0: 7565 3635 3238 2e66 6978 2d69 6e63 6f6d  ue6528.fix-incom
-00008d00: 696e 6727 5d20 3d20 6973 7375 6536 3532  ing'] = issue652
-00008d10: 380a 0a20 2020 206c 617a 7964 656c 7461  8..    lazydelta
-00008d20: 203d 2075 692e 636f 6e66 6967 626f 6f6c   = ui.configbool
-00008d30: 2862 2773 746f 7261 6765 272c 2062 2772  (b'storage', b'r
-00008d40: 6576 6c6f 672e 7265 7573 652d 6578 7465  evlog.reuse-exte
-00008d50: 726e 616c 2d64 656c 7461 2729 0a20 2020  rnal-delta').   
-00008d60: 206c 617a 7964 656c 7461 6261 7365 203d   lazydeltabase =
-00008d70: 2046 616c 7365 0a20 2020 2069 6620 6c61   False.    if la
-00008d80: 7a79 6465 6c74 613a 0a20 2020 2020 2020  zydelta:.       
-00008d90: 206c 617a 7964 656c 7461 6261 7365 203d   lazydeltabase =
-00008da0: 2075 692e 636f 6e66 6967 626f 6f6c 280a   ui.configbool(.
-00008db0: 2020 2020 2020 2020 2020 2020 6227 7374              b'st
-00008dc0: 6f72 6167 6527 2c20 6227 7265 766c 6f67  orage', b'revlog
-00008dd0: 2e72 6575 7365 2d65 7874 6572 6e61 6c2d  .reuse-external-
-00008de0: 6465 6c74 612d 7061 7265 6e74 270a 2020  delta-parent'.  
-00008df0: 2020 2020 2020 290a 2020 2020 6966 206c        ).    if l
-00008e00: 617a 7964 656c 7461 6261 7365 2069 7320  azydeltabase is 
-00008e10: 4e6f 6e65 3a0a 2020 2020 2020 2020 6c61  None:.        la
-00008e20: 7a79 6465 6c74 6162 6173 6520 3d20 6e6f  zydeltabase = no
-00008e30: 7420 7363 6d75 7469 6c2e 6764 6465 6c74  t scmutil.gddelt
-00008e40: 6163 6f6e 6669 6728 7569 290a 2020 2020  aconfig(ui).    
-00008e50: 6f70 7469 6f6e 735b 6227 6c61 7a79 6465  options[b'lazyde
-00008e60: 6c74 6127 5d20 3d20 6c61 7a79 6465 6c74  lta'] = lazydelt
-00008e70: 610a 2020 2020 6f70 7469 6f6e 735b 6227  a.    options[b'
-00008e80: 6c61 7a79 6465 6c74 6162 6173 6527 5d20  lazydeltabase'] 
-00008e90: 3d20 6c61 7a79 6465 6c74 6162 6173 650a  = lazydeltabase.
-00008ea0: 0a20 2020 2063 6861 696e 7370 616e 203d  .    chainspan =
-00008eb0: 2075 692e 636f 6e66 6967 6279 7465 7328   ui.configbytes(
-00008ec0: 6227 6578 7065 7269 6d65 6e74 616c 272c  b'experimental',
-00008ed0: 2062 276d 6178 6465 6c74 6163 6861 696e   b'maxdeltachain
-00008ee0: 7370 616e 2729 0a20 2020 2069 6620 3020  span').    if 0 
-00008ef0: 3c3d 2063 6861 696e 7370 616e 3a0a 2020  <= chainspan:.  
-00008f00: 2020 2020 2020 6f70 7469 6f6e 735b 6227        options[b'
-00008f10: 6d61 7864 656c 7461 6368 6169 6e73 7061  maxdeltachainspa
-00008f20: 6e27 5d20 3d20 6368 6169 6e73 7061 6e0a  n'] = chainspan.
-00008f30: 0a20 2020 206d 6d61 7069 6e64 6578 7468  .    mmapindexth
-00008f40: 7265 7368 6f6c 6420 3d20 7569 2e63 6f6e  reshold = ui.con
-00008f50: 6669 6762 7974 6573 2862 2765 7870 6572  figbytes(b'exper
-00008f60: 696d 656e 7461 6c27 2c20 6227 6d6d 6170  imental', b'mmap
-00008f70: 696e 6465 7874 6872 6573 686f 6c64 2729  indexthreshold')
-00008f80: 0a20 2020 2069 6620 6d6d 6170 696e 6465  .    if mmapinde
-00008f90: 7874 6872 6573 686f 6c64 2069 7320 6e6f  xthreshold is no
-00008fa0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00008fb0: 6f70 7469 6f6e 735b 6227 6d6d 6170 696e  options[b'mmapin
-00008fc0: 6465 7874 6872 6573 686f 6c64 275d 203d  dexthreshold'] =
-00008fd0: 206d 6d61 7069 6e64 6578 7468 7265 7368   mmapindexthresh
-00008fe0: 6f6c 640a 0a20 2020 2077 6974 6873 7061  old..    withspa
-00008ff0: 7273 6572 6561 6420 3d20 7569 2e63 6f6e  rseread = ui.con
-00009000: 6669 6762 6f6f 6c28 6227 6578 7065 7269  figbool(b'experi
-00009010: 6d65 6e74 616c 272c 2062 2773 7061 7273  mental', b'spars
-00009020: 652d 7265 6164 2729 0a20 2020 2073 7264  e-read').    srd
-00009030: 656e 7369 7479 7468 7265 7320 3d20 666c  ensitythres = fl
-00009040: 6f61 7428 0a20 2020 2020 2020 2075 692e  oat(.        ui.
-00009050: 636f 6e66 6967 2862 2765 7870 6572 696d  config(b'experim
-00009060: 656e 7461 6c27 2c20 6227 7370 6172 7365  ental', b'sparse
-00009070: 2d72 6561 642e 6465 6e73 6974 792d 7468  -read.density-th
-00009080: 7265 7368 6f6c 6427 290a 2020 2020 290a  reshold').    ).
-00009090: 2020 2020 7372 6d69 6e67 6170 7369 7a65      srmingapsize
-000090a0: 203d 2075 692e 636f 6e66 6967 6279 7465   = ui.configbyte
-000090b0: 7328 6227 6578 7065 7269 6d65 6e74 616c  s(b'experimental
-000090c0: 272c 2062 2773 7061 7273 652d 7265 6164  ', b'sparse-read
-000090d0: 2e6d 696e 2d67 6170 2d73 697a 6527 290a  .min-gap-size').
-000090e0: 2020 2020 6f70 7469 6f6e 735b 6227 7769      options[b'wi
-000090f0: 7468 2d73 7061 7273 652d 7265 6164 275d  th-sparse-read']
-00009100: 203d 2077 6974 6873 7061 7273 6572 6561   = withsparserea
-00009110: 640a 2020 2020 6f70 7469 6f6e 735b 6227  d.    options[b'
-00009120: 7370 6172 7365 2d72 6561 642d 6465 6e73  sparse-read-dens
-00009130: 6974 792d 7468 7265 7368 6f6c 6427 5d20  ity-threshold'] 
-00009140: 3d20 7372 6465 6e73 6974 7974 6872 6573  = srdensitythres
-00009150: 0a20 2020 206f 7074 696f 6e73 5b62 2773  .    options[b's
-00009160: 7061 7273 652d 7265 6164 2d6d 696e 2d67  parse-read-min-g
-00009170: 6170 2d73 697a 6527 5d20 3d20 7372 6d69  ap-size'] = srmi
-00009180: 6e67 6170 7369 7a65 0a0a 2020 2020 7370  ngapsize..    sp
-00009190: 6172 7365 7265 766c 6f67 203d 2072 6571  arserevlog = req
-000091a0: 7569 7265 6d65 6e74 736d 6f64 2e53 5041  uirementsmod.SPA
-000091b0: 5253 4552 4556 4c4f 475f 5245 5155 4952  RSEREVLOG_REQUIR
-000091c0: 454d 454e 5420 696e 2072 6571 7569 7265  EMENT in require
-000091d0: 6d65 6e74 730a 2020 2020 6f70 7469 6f6e  ments.    option
-000091e0: 735b 6227 7370 6172 7365 2d72 6576 6c6f  s[b'sparse-revlo
-000091f0: 6727 5d20 3d20 7370 6172 7365 7265 766c  g'] = sparserevl
-00009200: 6f67 0a20 2020 2069 6620 7370 6172 7365  og.    if sparse
-00009210: 7265 766c 6f67 3a0a 2020 2020 2020 2020  revlog:.        
-00009220: 6f70 7469 6f6e 735b 6227 6765 6e65 7261  options[b'genera
-00009230: 6c64 656c 7461 275d 203d 2054 7275 650a  ldelta'] = True.
-00009240: 0a20 2020 206d 6178 6368 6169 6e6c 656e  .    maxchainlen
-00009250: 203d 204e 6f6e 650a 2020 2020 6966 2073   = None.    if s
-00009260: 7061 7273 6572 6576 6c6f 673a 0a20 2020  parserevlog:.   
-00009270: 2020 2020 206d 6178 6368 6169 6e6c 656e       maxchainlen
-00009280: 203d 2072 6576 6c6f 6763 6f6e 7374 2e53   = revlogconst.S
-00009290: 5041 5253 455f 5245 564c 4f47 5f4d 4158  PARSE_REVLOG_MAX
-000092a0: 5f43 4841 494e 5f4c 454e 4754 480a 2020  _CHAIN_LENGTH.  
-000092b0: 2020 2320 6578 7065 7269 6d65 6e74 616c    # experimental
-000092c0: 2063 6f6e 6669 673a 2066 6f72 6d61 742e   config: format.
-000092d0: 6d61 7863 6861 696e 6c65 6e0a 2020 2020  maxchainlen.    
-000092e0: 6d61 7863 6861 696e 6c65 6e20 3d20 7569  maxchainlen = ui
-000092f0: 2e63 6f6e 6669 6769 6e74 2862 2766 6f72  .configint(b'for
-00009300: 6d61 7427 2c20 6227 6d61 7863 6861 696e  mat', b'maxchain
-00009310: 6c65 6e27 2c20 6d61 7863 6861 696e 6c65  len', maxchainle
-00009320: 6e29 0a20 2020 2069 6620 6d61 7863 6861  n).    if maxcha
-00009330: 696e 6c65 6e20 6973 206e 6f74 204e 6f6e  inlen is not Non
-00009340: 653a 0a20 2020 2020 2020 206f 7074 696f  e:.        optio
-00009350: 6e73 5b62 276d 6178 6368 6169 6e6c 656e  ns[b'maxchainlen
-00009360: 275d 203d 206d 6178 6368 6169 6e6c 656e  '] = maxchainlen
-00009370: 0a0a 2020 2020 666f 7220 7220 696e 2072  ..    for r in r
-00009380: 6571 7569 7265 6d65 6e74 733a 0a20 2020  equirements:.   
-00009390: 2020 2020 2023 2077 6520 616c 6c6f 7720       # we allow 
-000093a0: 6d75 6c74 6970 6c65 2063 6f6d 7072 6573  multiple compres
-000093b0: 7369 6f6e 2065 6e67 696e 6520 7265 7175  sion engine requ
-000093c0: 6972 656d 656e 7420 746f 2063 6f2d 6578  irement to co-ex
-000093d0: 6973 7420 6265 6361 7573 650a 2020 2020  ist because.    
-000093e0: 2020 2020 2320 7374 7269 636b 6c79 2073      # strickly s
-000093f0: 7065 616b 696e 672c 2072 6576 6c6f 6720  peaking, revlog 
-00009400: 7365 656d 7320 746f 2073 7570 706f 7274  seems to support
-00009410: 206d 6978 6564 2063 6f6d 7072 6573 7369   mixed compressi
-00009420: 6f6e 2073 7479 6c65 2e0a 2020 2020 2020  on style..      
-00009430: 2020 230a 2020 2020 2020 2020 2320 5468    #.        # Th
-00009440: 6520 636f 6d70 7265 7373 696f 6e20 7573  e compression us
-00009450: 6564 2066 6f72 206e 6577 2065 6e74 7269  ed for new entri
-00009460: 6573 2077 696c 6c20 6265 2022 7468 6520  es will be "the 
-00009470: 6c61 7374 206f 6e65 220a 2020 2020 2020  last one".      
-00009480: 2020 7072 6566 6978 203d 2072 2e73 7461    prefix = r.sta
-00009490: 7274 7377 6974 680a 2020 2020 2020 2020  rtswith.        
-000094a0: 6966 2070 7265 6669 7828 6227 7265 766c  if prefix(b'revl
-000094b0: 6f67 2d63 6f6d 7072 6573 7369 6f6e 2d27  og-compression-'
-000094c0: 2920 6f72 2070 7265 6669 7828 6227 6578  ) or prefix(b'ex
-000094d0: 702d 636f 6d70 7265 7373 696f 6e2d 2729  p-compression-')
-000094e0: 3a0a 2020 2020 2020 2020 2020 2020 6f70  :.            op
-000094f0: 7469 6f6e 735b 6227 636f 6d70 656e 6769  tions[b'compengi
-00009500: 6e65 275d 203d 2072 2e73 706c 6974 2862  ne'] = r.split(b
-00009510: 272d 272c 2032 295b 325d 0a0a 2020 2020  '-', 2)[2]..    
-00009520: 6f70 7469 6f6e 735b 6227 7a6c 6962 2e6c  options[b'zlib.l
-00009530: 6576 656c 275d 203d 2075 692e 636f 6e66  evel'] = ui.conf
-00009540: 6967 696e 7428 6227 7374 6f72 6167 6527  igint(b'storage'
-00009550: 2c20 6227 7265 766c 6f67 2e7a 6c69 622e  , b'revlog.zlib.
-00009560: 6c65 7665 6c27 290a 2020 2020 6966 206f  level').    if o
-00009570: 7074 696f 6e73 5b62 277a 6c69 622e 6c65  ptions[b'zlib.le
-00009580: 7665 6c27 5d20 6973 206e 6f74 204e 6f6e  vel'] is not Non
-00009590: 653a 0a20 2020 2020 2020 2069 6620 6e6f  e:.        if no
-000095a0: 7420 2830 203c 3d20 6f70 7469 6f6e 735b  t (0 <= options[
-000095b0: 6227 7a6c 6962 2e6c 6576 656c 275d 203c  b'zlib.level'] <
-000095c0: 3d20 3929 3a0a 2020 2020 2020 2020 2020  = 9):.          
-000095d0: 2020 6d73 6720 3d20 5f28 6227 696e 7661    msg = _(b'inva
-000095e0: 6c69 6420 7661 6c75 6520 666f 7220 6073  lid value for `s
-000095f0: 746f 7261 6765 2e72 6576 6c6f 672e 7a6c  torage.revlog.zl
-00009600: 6962 2e6c 6576 656c 6020 636f 6e66 6967  ib.level` config
-00009610: 3a20 2564 2729 0a20 2020 2020 2020 2020  : %d').         
-00009620: 2020 2072 6169 7365 2065 7272 6f72 2e41     raise error.A
-00009630: 626f 7274 286d 7367 2025 206f 7074 696f  bort(msg % optio
-00009640: 6e73 5b62 277a 6c69 622e 6c65 7665 6c27  ns[b'zlib.level'
-00009650: 5d29 0a20 2020 206f 7074 696f 6e73 5b62  ]).    options[b
-00009660: 277a 7374 642e 6c65 7665 6c27 5d20 3d20  'zstd.level'] = 
-00009670: 7569 2e63 6f6e 6669 6769 6e74 2862 2773  ui.configint(b's
-00009680: 746f 7261 6765 272c 2062 2772 6576 6c6f  torage', b'revlo
-00009690: 672e 7a73 7464 2e6c 6576 656c 2729 0a20  g.zstd.level'). 
-000096a0: 2020 2069 6620 6f70 7469 6f6e 735b 6227     if options[b'
-000096b0: 7a73 7464 2e6c 6576 656c 275d 2069 7320  zstd.level'] is 
-000096c0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000096d0: 2020 6966 206e 6f74 2028 3020 3c3d 206f    if not (0 <= o
-000096e0: 7074 696f 6e73 5b62 277a 7374 642e 6c65  ptions[b'zstd.le
-000096f0: 7665 6c27 5d20 3c3d 2032 3229 3a0a 2020  vel'] <= 22):.  
-00009700: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
-00009710: 5f28 6227 696e 7661 6c69 6420 7661 6c75  _(b'invalid valu
-00009720: 6520 666f 7220 6073 746f 7261 6765 2e72  e for `storage.r
-00009730: 6576 6c6f 672e 7a73 7464 2e6c 6576 656c  evlog.zstd.level
-00009740: 6020 636f 6e66 6967 3a20 2564 2729 0a20  ` config: %d'). 
-00009750: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00009760: 2065 7272 6f72 2e41 626f 7274 286d 7367   error.Abort(msg
-00009770: 2025 206f 7074 696f 6e73 5b62 277a 7374   % options[b'zst
-00009780: 642e 6c65 7665 6c27 5d29 0a0a 2020 2020  d.level'])..    
-00009790: 6966 2072 6571 7569 7265 6d65 6e74 736d  if requirementsm
-000097a0: 6f64 2e4e 4152 524f 575f 5245 5155 4952  od.NARROW_REQUIR
-000097b0: 454d 454e 5420 696e 2072 6571 7569 7265  EMENT in require
-000097c0: 6d65 6e74 733a 0a20 2020 2020 2020 206f  ments:.        o
-000097d0: 7074 696f 6e73 5b62 2765 6e61 626c 6565  ptions[b'enablee
-000097e0: 6c6c 6970 7369 7327 5d20 3d20 5472 7565  llipsis'] = True
-000097f0: 0a0a 2020 2020 6966 2075 692e 636f 6e66  ..    if ui.conf
-00009800: 6967 626f 6f6c 2862 2765 7870 6572 696d  igbool(b'experim
-00009810: 656e 7461 6c27 2c20 6227 7275 7374 2e69  ental', b'rust.i
-00009820: 6e64 6578 2729 3a0a 2020 2020 2020 2020  ndex'):.        
-00009830: 6f70 7469 6f6e 735b 6227 7275 7374 2e69  options[b'rust.i
-00009840: 6e64 6578 275d 203d 2054 7275 650a 2020  ndex'] = True.  
-00009850: 2020 6966 2072 6571 7569 7265 6d65 6e74    if requirement
-00009860: 736d 6f64 2e4e 4f44 454d 4150 5f52 4551  smod.NODEMAP_REQ
-00009870: 5549 5245 4d45 4e54 2069 6e20 7265 7175  UIREMENT in requ
-00009880: 6972 656d 656e 7473 3a0a 2020 2020 2020  irements:.      
-00009890: 2020 736c 6f77 5f70 6174 6820 3d20 7569    slow_path = ui
-000098a0: 2e63 6f6e 6669 6728 0a20 2020 2020 2020  .config(.       
-000098b0: 2020 2020 2062 2773 746f 7261 6765 272c       b'storage',
-000098c0: 2062 2772 6576 6c6f 672e 7065 7273 6973   b'revlog.persis
-000098d0: 7465 6e74 2d6e 6f64 656d 6170 2e73 6c6f  tent-nodemap.slo
-000098e0: 772d 7061 7468 270a 2020 2020 2020 2020  w-path'.        
-000098f0: 290a 2020 2020 2020 2020 6966 2073 6c6f  ).        if slo
-00009900: 775f 7061 7468 206e 6f74 2069 6e20 2862  w_path not in (b
-00009910: 2761 6c6c 6f77 272c 2062 2777 6172 6e27  'allow', b'warn'
-00009920: 2c20 6227 6162 6f72 7427 293a 0a20 2020  , b'abort'):.   
-00009930: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00009940: 203d 2075 692e 636f 6e66 6967 5f64 6566   = ui.config_def
-00009950: 6175 6c74 280a 2020 2020 2020 2020 2020  ault(.          
-00009960: 2020 2020 2020 6227 7374 6f72 6167 6527        b'storage'
-00009970: 2c20 6227 7265 766c 6f67 2e70 6572 7369  , b'revlog.persi
-00009980: 7374 656e 742d 6e6f 6465 6d61 702e 736c  stent-nodemap.sl
-00009990: 6f77 2d70 6174 6827 0a20 2020 2020 2020  ow-path'.       
-000099a0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000099b0: 2020 206d 7367 203d 205f 280a 2020 2020     msg = _(.    
-000099c0: 2020 2020 2020 2020 2020 2020 6227 756e              b'un
-000099d0: 6b6e 6f77 6e20 7661 6c75 6520 666f 7220  known value for 
-000099e0: 636f 6e66 6967 2027 0a20 2020 2020 2020  config '.       
-000099f0: 2020 2020 2020 2020 2062 2722 7374 6f72           b'"stor
-00009a00: 6167 652e 7265 766c 6f67 2e70 6572 7369  age.revlog.persi
-00009a10: 7374 656e 742d 6e6f 6465 6d61 702e 736c  stent-nodemap.sl
-00009a20: 6f77 2d70 6174 6822 3a20 2225 7322 5c6e  ow-path": "%s"\n
-00009a30: 270a 2020 2020 2020 2020 2020 2020 290a  '.            ).
-00009a40: 2020 2020 2020 2020 2020 2020 7569 2e77              ui.w
-00009a50: 6172 6e28 6d73 6720 2520 736c 6f77 5f70  arn(msg % slow_p
-00009a60: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
-00009a70: 2069 6620 6e6f 7420 7569 2e71 7569 6574   if not ui.quiet
-00009a80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009a90: 2020 7569 2e77 6172 6e28 5f28 6227 6661    ui.warn(_(b'fa
-00009aa0: 6c6c 696e 6720 6261 636b 2074 6f20 6465  lling back to de
-00009ab0: 6661 756c 7420 7661 6c75 653a 2025 735c  fault value: %s\
-00009ac0: 6e27 2920 2520 6465 6661 756c 7429 0a20  n') % default). 
-00009ad0: 2020 2020 2020 2020 2020 2073 6c6f 775f             slow_
-00009ae0: 7061 7468 203d 2064 6566 6175 6c74 0a0a  path = default..
-00009af0: 2020 2020 2020 2020 6d73 6720 3d20 5f28          msg = _(
-00009b00: 0a20 2020 2020 2020 2020 2020 2062 2261  .            b"a
-00009b10: 6363 6573 7369 6e67 2060 7065 7273 6973  ccessing `persis
-00009b20: 7465 6e74 2d6e 6f64 656d 6170 6020 7265  tent-nodemap` re
-00009b30: 706f 7369 746f 7279 2077 6974 686f 7574  pository without
-00009b40: 2061 7373 6f63 6961 7465 6420 220a 2020   associated ".  
-00009b50: 2020 2020 2020 2020 2020 6222 6661 7374            b"fast
-00009b60: 2069 6d70 6c65 6d65 6e74 6174 696f 6e2e   implementation.
-00009b70: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-00009b80: 2020 2020 6869 6e74 203d 205f 280a 2020      hint = _(.  
-00009b90: 2020 2020 2020 2020 2020 6222 6368 6563            b"chec
-00009ba0: 6b20 6068 6720 6865 6c70 2063 6f6e 6669  k `hg help confi
-00009bb0: 672e 666f 726d 6174 2e75 7365 2d70 6572  g.format.use-per
-00009bc0: 7369 7374 656e 742d 6e6f 6465 6d61 7060  sistent-nodemap`
-00009bd0: 2022 0a20 2020 2020 2020 2020 2020 2062   ".            b
-00009be0: 2266 6f72 2064 6574 6169 6c73 220a 2020  "for details".  
-00009bf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00009c00: 6966 206e 6f74 2072 6576 6c6f 672e 4841  if not revlog.HA
-00009c10: 535f 4641 5354 5f50 4552 5349 5354 454e  S_FAST_PERSISTEN
-00009c20: 545f 4e4f 4445 4d41 503a 0a20 2020 2020  T_NODEMAP:.     
-00009c30: 2020 2020 2020 2069 6620 736c 6f77 5f70         if slow_p
-00009c40: 6174 6820 3d3d 2062 2777 6172 6e27 3a0a  ath == b'warn':.
-00009c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c60: 6d73 6720 3d20 6222 7761 726e 696e 673a  msg = b"warning:
-00009c70: 2022 202b 206d 7367 202b 2062 275c 6e27   " + msg + b'\n'
-00009c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009c90: 2075 692e 7761 726e 286d 7367 290a 2020   ui.warn(msg).  
-00009ca0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00009cb0: 206e 6f74 2075 692e 7175 6965 743a 0a20   not ui.quiet:. 
-00009cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cd0: 2020 2068 696e 7420 3d20 6227 2827 202b     hint = b'(' +
-00009ce0: 2068 696e 7420 2b20 6227 295c 6e27 0a20   hint + b')\n'. 
-00009cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d00: 2020 2075 692e 7761 726e 2868 696e 7429     ui.warn(hint)
-00009d10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00009d20: 736c 6f77 5f70 6174 6820 3d3d 2062 2761  slow_path == b'a
-00009d30: 626f 7274 273a 0a20 2020 2020 2020 2020  bort':.         
-00009d40: 2020 2020 2020 2072 6169 7365 2065 7272         raise err
-00009d50: 6f72 2e41 626f 7274 286d 7367 2c20 6869  or.Abort(msg, hi
-00009d60: 6e74 3d68 696e 7429 0a20 2020 2020 2020  nt=hint).       
-00009d70: 206f 7074 696f 6e73 5b62 2770 6572 7369   options[b'persi
-00009d80: 7374 656e 742d 6e6f 6465 6d61 7027 5d20  stent-nodemap'] 
-00009d90: 3d20 5472 7565 0a20 2020 2069 6620 7265  = True.    if re
-00009da0: 7175 6972 656d 656e 7473 6d6f 642e 4449  quirementsmod.DI
-00009db0: 5253 5441 5445 5f56 325f 5245 5155 4952  RSTATE_V2_REQUIR
-00009dc0: 454d 454e 5420 696e 2072 6571 7569 7265  EMENT in require
-00009dd0: 6d65 6e74 733a 0a20 2020 2020 2020 2073  ments:.        s
-00009de0: 6c6f 775f 7061 7468 203d 2075 692e 636f  low_path = ui.co
-00009df0: 6e66 6967 2862 2773 746f 7261 6765 272c  nfig(b'storage',
-00009e00: 2062 2764 6972 7374 6174 652d 7632 2e73   b'dirstate-v2.s
-00009e10: 6c6f 772d 7061 7468 2729 0a20 2020 2020  low-path').     
-00009e20: 2020 2069 6620 736c 6f77 5f70 6174 6820     if slow_path 
-00009e30: 6e6f 7420 696e 2028 6227 616c 6c6f 7727  not in (b'allow'
-00009e40: 2c20 6227 7761 726e 272c 2062 2761 626f  , b'warn', b'abo
-00009e50: 7274 2729 3a0a 2020 2020 2020 2020 2020  rt'):.          
-00009e60: 2020 6465 6661 756c 7420 3d20 7569 2e63    default = ui.c
-00009e70: 6f6e 6669 675f 6465 6661 756c 7428 6227  onfig_default(b'
-00009e80: 7374 6f72 6167 6527 2c20 6227 6469 7273  storage', b'dirs
-00009e90: 7461 7465 2d76 322e 736c 6f77 2d70 6174  tate-v2.slow-pat
-00009ea0: 6827 290a 2020 2020 2020 2020 2020 2020  h').            
-00009eb0: 6d73 6720 3d20 5f28 6227 756e 6b6e 6f77  msg = _(b'unknow
-00009ec0: 6e20 7661 6c75 6520 666f 7220 636f 6e66  n value for conf
-00009ed0: 6967 2022 6469 7273 7461 7465 2d76 322e  ig "dirstate-v2.
-00009ee0: 736c 6f77 2d70 6174 6822 3a20 2225 7322  slow-path": "%s"
-00009ef0: 5c6e 2729 0a20 2020 2020 2020 2020 2020  \n').           
-00009f00: 2075 692e 7761 726e 286d 7367 2025 2073   ui.warn(msg % s
-00009f10: 6c6f 775f 7061 7468 290a 2020 2020 2020  low_path).      
-00009f20: 2020 2020 2020 6966 206e 6f74 2075 692e        if not ui.
-00009f30: 7175 6965 743a 0a20 2020 2020 2020 2020  quiet:.         
-00009f40: 2020 2020 2020 2075 692e 7761 726e 285f         ui.warn(_
-00009f50: 2862 2766 616c 6c69 6e67 2062 6163 6b20  (b'falling back 
-00009f60: 746f 2064 6566 6175 6c74 2076 616c 7565  to default value
-00009f70: 3a20 2573 5c6e 2729 2025 2064 6566 6175  : %s\n') % defau
-00009f80: 6c74 290a 2020 2020 2020 2020 2020 2020  lt).            
-00009f90: 736c 6f77 5f70 6174 6820 3d20 6465 6661  slow_path = defa
-00009fa0: 756c 740a 0a20 2020 2020 2020 206d 7367  ult..        msg
-00009fb0: 203d 205f 280a 2020 2020 2020 2020 2020   = _(.          
-00009fc0: 2020 6222 6163 6365 7373 696e 6720 6064    b"accessing `d
-00009fd0: 6972 7374 6174 652d 7632 6020 7265 706f  irstate-v2` repo
-00009fe0: 7369 746f 7279 2077 6974 686f 7574 2061  sitory without a
-00009ff0: 7373 6f63 6961 7465 6420 220a 2020 2020  ssociated ".    
-0000a000: 2020 2020 2020 2020 6222 6661 7374 2069          b"fast i
-0000a010: 6d70 6c65 6d65 6e74 6174 696f 6e2e 220a  mplementation.".
-0000a020: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000a030: 2020 6869 6e74 203d 205f 280a 2020 2020    hint = _(.    
-0000a040: 2020 2020 2020 2020 6222 6368 6563 6b20          b"check 
-0000a050: 6068 6720 6865 6c70 2063 6f6e 6669 672e  `hg help config.
-0000a060: 666f 726d 6174 2e75 7365 2d64 6972 7374  format.use-dirst
-0000a070: 6174 652d 7632 6020 2220 6222 666f 7220  ate-v2` " b"for 
-0000a080: 6465 7461 696c 7322 0a20 2020 2020 2020  details".       
-0000a090: 2029 0a20 2020 2020 2020 2069 6620 6e6f   ).        if no
-0000a0a0: 7420 6469 7273 7461 7465 2e48 4153 5f46  t dirstate.HAS_F
-0000a0b0: 4153 545f 4449 5253 5441 5445 5f56 323a  AST_DIRSTATE_V2:
-0000a0c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000a0d0: 736c 6f77 5f70 6174 6820 3d3d 2062 2777  slow_path == b'w
-0000a0e0: 6172 6e27 3a0a 2020 2020 2020 2020 2020  arn':.          
-0000a0f0: 2020 2020 2020 6d73 6720 3d20 6222 7761        msg = b"wa
-0000a100: 726e 696e 673a 2022 202b 206d 7367 202b  rning: " + msg +
-0000a110: 2062 275c 6e27 0a20 2020 2020 2020 2020   b'\n'.         
-0000a120: 2020 2020 2020 2075 692e 7761 726e 286d         ui.warn(m
-0000a130: 7367 290a 2020 2020 2020 2020 2020 2020  sg).            
-0000a140: 2020 2020 6966 206e 6f74 2075 692e 7175      if not ui.qu
-0000a150: 6965 743a 0a20 2020 2020 2020 2020 2020  iet:.           
-0000a160: 2020 2020 2020 2020 2068 696e 7420 3d20           hint = 
-0000a170: 6227 2827 202b 2068 696e 7420 2b20 6227  b'(' + hint + b'
-0000a180: 295c 6e27 0a20 2020 2020 2020 2020 2020  )\n'.           
-0000a190: 2020 2020 2020 2020 2075 692e 7761 726e           ui.warn
-0000a1a0: 2868 696e 7429 0a20 2020 2020 2020 2020  (hint).         
-0000a1b0: 2020 2069 6620 736c 6f77 5f70 6174 6820     if slow_path 
-0000a1c0: 3d3d 2062 2761 626f 7274 273a 0a20 2020  == b'abort':.   
-0000a1d0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000a1e0: 7365 2065 7272 6f72 2e41 626f 7274 286d  se error.Abort(m
-0000a1f0: 7367 2c20 6869 6e74 3d68 696e 7429 0a20  sg, hint=hint). 
-0000a200: 2020 2069 6620 7569 2e63 6f6e 6669 6762     if ui.configb
-0000a210: 6f6f 6c28 6227 7374 6f72 6167 6527 2c20  ool(b'storage', 
-0000a220: 6227 7265 766c 6f67 2e70 6572 7369 7374  b'revlog.persist
-0000a230: 656e 742d 6e6f 6465 6d61 702e 6d6d 6170  ent-nodemap.mmap
-0000a240: 2729 3a0a 2020 2020 2020 2020 6f70 7469  '):.        opti
-0000a250: 6f6e 735b 6227 7065 7273 6973 7465 6e74  ons[b'persistent
-0000a260: 2d6e 6f64 656d 6170 2e6d 6d61 7027 5d20  -nodemap.mmap'] 
-0000a270: 3d20 5472 7565 0a20 2020 2069 6620 7569  = True.    if ui
-0000a280: 2e63 6f6e 6669 6762 6f6f 6c28 6227 6465  .configbool(b'de
-0000a290: 7665 6c27 2c20 6227 7065 7273 6973 7465  vel', b'persiste
-0000a2a0: 6e74 2d6e 6f64 656d 6170 2729 3a0a 2020  nt-nodemap'):.  
-0000a2b0: 2020 2020 2020 6f70 7469 6f6e 735b 6227        options[b'
-0000a2c0: 6465 7665 6c2d 666f 7263 652d 6e6f 6465  devel-force-node
-0000a2d0: 6d61 7027 5d20 3d20 5472 7565 0a0a 2020  map'] = True..  
-0000a2e0: 2020 7265 7475 726e 206f 7074 696f 6e73    return options
-0000a2f0: 0a0a 0a64 6566 206d 616b 656d 6169 6e28  ...def makemain(
-0000a300: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
-0000a310: 2222 5072 6f64 7563 6520 6120 7479 7065  ""Produce a type
-0000a320: 2063 6f6e 666f 726d 696e 6720 746f 2060   conforming to `
-0000a330: 6069 6c6f 6361 6c72 6570 6f73 6974 6f72  `ilocalrepositor
-0000a340: 796d 6169 6e60 602e 2222 220a 2020 2020  ymain``.""".    
-0000a350: 7265 7475 726e 206c 6f63 616c 7265 706f  return localrepo
-0000a360: 7369 746f 7279 0a0a 0a40 696e 7465 7266  sitory...@interf
-0000a370: 6163 6575 7469 6c2e 696d 706c 656d 656e  aceutil.implemen
-0000a380: 7465 7228 7265 706f 7369 746f 7279 2e69  ter(repository.i
-0000a390: 6c6f 6361 6c72 6570 6f73 6974 6f72 7966  localrepositoryf
-0000a3a0: 696c 6573 746f 7261 6765 290a 636c 6173  ilestorage).clas
-0000a3b0: 7320 7265 766c 6f67 6669 6c65 7374 6f72  s revlogfilestor
-0000a3c0: 6167 653a 0a20 2020 2022 2222 4669 6c65  age:.    """File
-0000a3d0: 2073 746f 7261 6765 2077 6865 6e20 7573   storage when us
-0000a3e0: 696e 6720 7265 766c 6f67 732e 2222 220a  ing revlogs.""".
-0000a3f0: 0a20 2020 2064 6566 2066 696c 6528 7365  .    def file(se
-0000a400: 6c66 2c20 7061 7468 293a 0a20 2020 2020  lf, path):.     
-0000a410: 2020 2069 6620 7061 7468 2e73 7461 7274     if path.start
-0000a420: 7377 6974 6828 6227 2f27 293a 0a20 2020  swith(b'/'):.   
-0000a430: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
-0000a440: 7061 7468 5b31 3a5d 0a0a 2020 2020 2020  path[1:]..      
-0000a450: 2020 7265 7475 726e 2066 696c 656c 6f67    return filelog
-0000a460: 2e66 696c 656c 6f67 2873 656c 662e 7376  .filelog(self.sv
-0000a470: 6673 2c20 7061 7468 290a 0a0a 4069 6e74  fs, path)...@int
-0000a480: 6572 6661 6365 7574 696c 2e69 6d70 6c65  erfaceutil.imple
-0000a490: 6d65 6e74 6572 2872 6570 6f73 6974 6f72  menter(repositor
-0000a4a0: 792e 696c 6f63 616c 7265 706f 7369 746f  y.ilocalreposito
-0000a4b0: 7279 6669 6c65 7374 6f72 6167 6529 0a63  ryfilestorage).c
-0000a4c0: 6c61 7373 2072 6576 6c6f 676e 6172 726f  lass revlognarro
-0000a4d0: 7766 696c 6573 746f 7261 6765 3a0a 2020  wfilestorage:.  
-0000a4e0: 2020 2222 2246 696c 6520 7374 6f72 6167    """File storag
-0000a4f0: 6520 7768 656e 2075 7369 6e67 2072 6576  e when using rev
-0000a500: 6c6f 6773 2061 6e64 206e 6172 726f 7720  logs and narrow 
-0000a510: 6669 6c65 732e 2222 220a 0a20 2020 2064  files."""..    d
-0000a520: 6566 2066 696c 6528 7365 6c66 2c20 7061  ef file(self, pa
-0000a530: 7468 293a 0a20 2020 2020 2020 2069 6620  th):.        if 
-0000a540: 7061 7468 2e73 7461 7274 7377 6974 6828  path.startswith(
-0000a550: 6227 2f27 293a 0a20 2020 2020 2020 2020  b'/'):.         
-0000a560: 2020 2070 6174 6820 3d20 7061 7468 5b31     path = path[1
-0000a570: 3a5d 0a0a 2020 2020 2020 2020 7265 7475  :]..        retu
-0000a580: 726e 2066 696c 656c 6f67 2e6e 6172 726f  rn filelog.narro
-0000a590: 7766 696c 656c 6f67 2873 656c 662e 7376  wfilelog(self.sv
-0000a5a0: 6673 2c20 7061 7468 2c20 7365 6c66 2e5f  fs, path, self._
-0000a5b0: 7374 6f72 656e 6172 726f 776d 6174 6368  storenarrowmatch
-0000a5c0: 290a 0a0a 6465 6620 6d61 6b65 6669 6c65  )...def makefile
-0000a5d0: 7374 6f72 6167 6528 7265 7175 6972 656d  storage(requirem
-0000a5e0: 656e 7473 2c20 6665 6174 7572 6573 2c20  ents, features, 
-0000a5f0: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
-0000a600: 2222 5072 6f64 7563 6520 6120 7479 7065  ""Produce a type
-0000a610: 2063 6f6e 666f 726d 696e 6720 746f 2060   conforming to `
-0000a620: 6069 6c6f 6361 6c72 6570 6f73 6974 6f72  `ilocalrepositor
-0000a630: 7966 696c 6573 746f 7261 6765 6060 2e22  yfilestorage``."
-0000a640: 2222 0a20 2020 2066 6561 7475 7265 732e  "".    features.
-0000a650: 6164 6428 7265 706f 7369 746f 7279 2e52  add(repository.R
-0000a660: 4550 4f5f 4645 4154 5552 455f 5245 564c  EPO_FEATURE_REVL
-0000a670: 4f47 5f46 494c 455f 5354 4f52 4147 4529  OG_FILE_STORAGE)
-0000a680: 0a20 2020 2066 6561 7475 7265 732e 6164  .    features.ad
-0000a690: 6428 7265 706f 7369 746f 7279 2e52 4550  d(repository.REP
-0000a6a0: 4f5f 4645 4154 5552 455f 5354 5245 414d  O_FEATURE_STREAM
-0000a6b0: 5f43 4c4f 4e45 290a 0a20 2020 2069 6620  _CLONE)..    if 
-0000a6c0: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
-0000a6d0: 4e41 5252 4f57 5f52 4551 5549 5245 4d45  NARROW_REQUIREME
-0000a6e0: 4e54 2069 6e20 7265 7175 6972 656d 656e  NT in requiremen
-0000a6f0: 7473 3a0a 2020 2020 2020 2020 7265 7475  ts:.        retu
-0000a700: 726e 2072 6576 6c6f 676e 6172 726f 7766  rn revlognarrowf
-0000a710: 696c 6573 746f 7261 6765 0a20 2020 2065  ilestorage.    e
-0000a720: 6c73 653a 0a20 2020 2020 2020 2072 6574  lse:.        ret
-0000a730: 7572 6e20 7265 766c 6f67 6669 6c65 7374  urn revlogfilest
-0000a740: 6f72 6167 650a 0a0a 2320 4c69 7374 206f  orage...# List o
-0000a750: 6620 7265 706f 7369 746f 7279 2069 6e74  f repository int
-0000a760: 6572 6661 6365 7320 616e 6420 6661 6374  erfaces and fact
-0000a770: 6f72 7920 6675 6e63 7469 6f6e 7320 666f  ory functions fo
-0000a780: 7220 7468 656d 2e20 4561 6368 0a23 2077  r them. Each.# w
-0000a790: 696c 6c20 6265 2063 616c 6c65 6420 696e  ill be called in
-0000a7a0: 206f 7264 6572 2064 7572 696e 6720 6060   order during ``
-0000a7b0: 6d61 6b65 6c6f 6361 6c72 6570 6f73 6974  makelocalreposit
-0000a7c0: 6f72 7928 2960 6020 746f 2069 7465 7261  ory()`` to itera
-0000a7d0: 7469 7665 6c79 0a23 2064 6572 6976 6520  tively.# derive 
-0000a7e0: 7468 6520 6669 6e61 6c20 7479 7065 2066  the final type f
-0000a7f0: 6f72 2061 206c 6f63 616c 2072 6570 6f73  or a local repos
-0000a800: 6974 6f72 7920 696e 7374 616e 6365 2e20  itory instance. 
-0000a810: 5765 2063 6170 7475 7265 2074 6865 0a23  We capture the.#
-0000a820: 2066 756e 6374 696f 6e20 6173 2061 206c   function as a l
-0000a830: 616d 6264 6120 736f 2077 6520 646f 6e27  ambda so we don'
-0000a840: 7420 686f 6c64 2061 2072 6566 6572 656e  t hold a referen
-0000a850: 6365 2061 6e64 2074 6865 206d 6f64 756c  ce and the modul
-0000a860: 652d 6c65 7665 6c0a 2320 6675 6e63 7469  e-level.# functi
-0000a870: 6f6e 7320 6361 6e20 6265 2077 7261 7070  ons can be wrapp
-0000a880: 6564 2e0a 5245 504f 5f49 4e54 4552 4641  ed..REPO_INTERFA
-0000a890: 4345 5320 3d20 5b0a 2020 2020 2872 6570  CES = [.    (rep
-0000a8a0: 6f73 6974 6f72 792e 696c 6f63 616c 7265  ository.ilocalre
-0000a8b0: 706f 7369 746f 7279 6d61 696e 2c20 6c61  positorymain, la
-0000a8c0: 6d62 6461 3a20 6d61 6b65 6d61 696e 292c  mbda: makemain),
-0000a8d0: 0a20 2020 2028 7265 706f 7369 746f 7279  .    (repository
-0000a8e0: 2e69 6c6f 6361 6c72 6570 6f73 6974 6f72  .ilocalrepositor
-0000a8f0: 7966 696c 6573 746f 7261 6765 2c20 6c61  yfilestorage, la
-0000a900: 6d62 6461 3a20 6d61 6b65 6669 6c65 7374  mbda: makefilest
-0000a910: 6f72 6167 6529 2c0a 5d0a 0a0a 4069 6e74  orage),.]...@int
-0000a920: 6572 6661 6365 7574 696c 2e69 6d70 6c65  erfaceutil.imple
-0000a930: 6d65 6e74 6572 2872 6570 6f73 6974 6f72  menter(repositor
-0000a940: 792e 696c 6f63 616c 7265 706f 7369 746f  y.ilocalreposito
-0000a950: 7279 6d61 696e 290a 636c 6173 7320 6c6f  rymain).class lo
-0000a960: 6361 6c72 6570 6f73 6974 6f72 793a 0a20  calrepository:. 
-0000a970: 2020 2022 2222 4d61 696e 2063 6c61 7373     """Main class
-0000a980: 2066 6f72 2072 6570 7265 7365 6e74 696e   for representin
-0000a990: 6720 6c6f 6361 6c20 7265 706f 7369 746f  g local reposito
-0000a9a0: 7269 6573 2e0a 0a20 2020 2041 6c6c 206c  ries...    All l
-0000a9b0: 6f63 616c 2072 6570 6f73 6974 6f72 6965  ocal repositorie
-0000a9c0: 7320 6172 6520 696e 7374 616e 6365 7320  s are instances 
-0000a9d0: 6f66 2074 6869 7320 636c 6173 732e 0a0a  of this class...
-0000a9e0: 2020 2020 436f 6e73 7472 7563 7465 6420      Constructed 
-0000a9f0: 6f6e 2069 7473 206f 776e 2c20 696e 7374  on its own, inst
-0000aa00: 616e 6365 7320 6f66 2074 6869 7320 636c  ances of this cl
-0000aa10: 6173 7320 6172 6520 6e6f 7420 7573 6162  ass are not usab
-0000aa20: 6c65 2061 730a 2020 2020 7265 706f 7369  le as.    reposi
-0000aa30: 746f 7279 206f 626a 6563 7473 2e20 546f  tory objects. To
-0000aa40: 206f 6274 6169 6e20 6120 7573 6162 6c65   obtain a usable
-0000aa50: 2072 6570 6f73 6974 6f72 7920 6f62 6a65   repository obje
-0000aa60: 6374 2c20 6361 6c6c 0a20 2020 2060 6068  ct, call.    ``h
-0000aa70: 672e 7265 706f 7369 746f 7279 2829 6060  g.repository()``
-0000aa80: 2c20 6060 6c6f 6361 6c72 6570 6f2e 696e  , ``localrepo.in
-0000aa90: 7374 616e 6365 2829 6060 2c20 6f72 0a20  stance()``, or. 
-0000aaa0: 2020 2060 606c 6f63 616c 7265 706f 2e6d     ``localrepo.m
-0000aab0: 616b 656c 6f63 616c 7265 706f 7369 746f  akelocalreposito
-0000aac0: 7279 2829 6060 2e20 5468 6520 6c61 7474  ry()``. The latt
-0000aad0: 6572 2069 7320 7468 6520 6c6f 7765 7374  er is the lowest
-0000aae0: 2d6c 6576 656c 2e0a 2020 2020 6060 696e  -level..    ``in
-0000aaf0: 7374 616e 6365 2829 6060 2061 6464 7320  stance()`` adds 
-0000ab00: 7375 7070 6f72 7420 666f 7220 6372 6561  support for crea
-0000ab10: 7469 6e67 206e 6577 2072 6570 6f73 6974  ting new reposit
-0000ab20: 6f72 6965 732e 0a20 2020 2060 6068 672e  ories..    ``hg.
-0000ab30: 7265 706f 7369 746f 7279 2829 6060 2061  repository()`` a
-0000ab40: 6464 7320 6d6f 7265 2065 7874 656e 7369  dds more extensi
-0000ab50: 6f6e 2069 6e74 6567 7261 7469 6f6e 2c20  on integration, 
-0000ab60: 696e 636c 7564 696e 6720 6361 6c6c 696e  including callin
-0000ab70: 670a 2020 2020 6060 7265 706f 7365 7475  g.    ``reposetu
-0000ab80: 7028 2960 602e 2047 656e 6572 616c 6c79  p()``. Generally
-0000ab90: 2073 7065 616b 696e 672c 2060 6068 672e   speaking, ``hg.
-0000aba0: 7265 706f 7369 746f 7279 2829 6060 2073  repository()`` s
-0000abb0: 686f 756c 6420 6265 0a20 2020 2075 7365  hould be.    use
-0000abc0: 642e 0a20 2020 2022 2222 0a0a 2020 2020  d..    """..    
-0000abd0: 5f62 6173 6573 7570 706f 7274 6564 203d  _basesupported =
-0000abe0: 207b 0a20 2020 2020 2020 2072 6571 7569   {.        requi
-0000abf0: 7265 6d65 6e74 736d 6f64 2e41 5243 4849  rementsmod.ARCHI
-0000ac00: 5645 445f 5048 4153 455f 5245 5155 4952  VED_PHASE_REQUIR
-0000ac10: 454d 454e 542c 0a20 2020 2020 2020 2072  EMENT,.        r
-0000ac20: 6571 7569 7265 6d65 6e74 736d 6f64 2e42  equirementsmod.B
-0000ac30: 4f4f 4b4d 4152 4b53 5f49 4e5f 5354 4f52  OOKMARKS_IN_STOR
-0000ac40: 455f 5245 5155 4952 454d 454e 542c 0a20  E_REQUIREMENT,. 
-0000ac50: 2020 2020 2020 2072 6571 7569 7265 6d65         requireme
-0000ac60: 6e74 736d 6f64 2e43 4841 4e47 454c 4f47  ntsmod.CHANGELOG
-0000ac70: 5632 5f52 4551 5549 5245 4d45 4e54 2c0a  V2_REQUIREMENT,.
-0000ac80: 2020 2020 2020 2020 7265 7175 6972 656d          requirem
-0000ac90: 656e 7473 6d6f 642e 434f 5049 4553 5344  entsmod.COPIESSD
-0000aca0: 435f 5245 5155 4952 454d 454e 542c 0a20  C_REQUIREMENT,. 
-0000acb0: 2020 2020 2020 2072 6571 7569 7265 6d65         requireme
-0000acc0: 6e74 736d 6f64 2e44 4952 5354 4154 455f  ntsmod.DIRSTATE_
-0000acd0: 5452 4143 4b45 445f 4849 4e54 5f56 312c  TRACKED_HINT_V1,
-0000ace0: 0a20 2020 2020 2020 2072 6571 7569 7265  .        require
-0000acf0: 6d65 6e74 736d 6f64 2e44 4952 5354 4154  mentsmod.DIRSTAT
-0000ad00: 455f 5632 5f52 4551 5549 5245 4d45 4e54  E_V2_REQUIREMENT
-0000ad10: 2c0a 2020 2020 2020 2020 7265 7175 6972  ,.        requir
-0000ad20: 656d 656e 7473 6d6f 642e 444f 5445 4e43  ementsmod.DOTENC
-0000ad30: 4f44 455f 5245 5155 4952 454d 454e 542c  ODE_REQUIREMENT,
-0000ad40: 0a20 2020 2020 2020 2072 6571 7569 7265  .        require
-0000ad50: 6d65 6e74 736d 6f64 2e46 4e43 4143 4845  mentsmod.FNCACHE
-0000ad60: 5f52 4551 5549 5245 4d45 4e54 2c0a 2020  _REQUIREMENT,.  
-0000ad70: 2020 2020 2020 7265 7175 6972 656d 656e        requiremen
-0000ad80: 7473 6d6f 642e 4745 4e45 5241 4c44 454c  tsmod.GENERALDEL
-0000ad90: 5441 5f52 4551 5549 5245 4d45 4e54 2c0a  TA_REQUIREMENT,.
-0000ada0: 2020 2020 2020 2020 7265 7175 6972 656d          requirem
-0000adb0: 656e 7473 6d6f 642e 494e 5445 524e 414c  entsmod.INTERNAL
-0000adc0: 5f50 4841 5345 5f52 4551 5549 5245 4d45  _PHASE_REQUIREME
-0000add0: 4e54 2c0a 2020 2020 2020 2020 7265 7175  NT,.        requ
-0000ade0: 6972 656d 656e 7473 6d6f 642e 4e4f 4445  irementsmod.NODE
-0000adf0: 4d41 505f 5245 5155 4952 454d 454e 542c  MAP_REQUIREMENT,
-0000ae00: 0a20 2020 2020 2020 2072 6571 7569 7265  .        require
-0000ae10: 6d65 6e74 736d 6f64 2e52 454c 4154 4956  mentsmod.RELATIV
-0000ae20: 455f 5348 4152 4544 5f52 4551 5549 5245  E_SHARED_REQUIRE
-0000ae30: 4d45 4e54 2c0a 2020 2020 2020 2020 7265  MENT,.        re
-0000ae40: 7175 6972 656d 656e 7473 6d6f 642e 5245  quirementsmod.RE
-0000ae50: 564c 4f47 5631 5f52 4551 5549 5245 4d45  VLOGV1_REQUIREME
-0000ae60: 4e54 2c0a 2020 2020 2020 2020 7265 7175  NT,.        requ
-0000ae70: 6972 656d 656e 7473 6d6f 642e 5245 564c  irementsmod.REVL
-0000ae80: 4f47 5632 5f52 4551 5549 5245 4d45 4e54  OGV2_REQUIREMENT
-0000ae90: 2c0a 2020 2020 2020 2020 7265 7175 6972  ,.        requir
-0000aea0: 656d 656e 7473 6d6f 642e 5348 4152 4544  ementsmod.SHARED
-0000aeb0: 5f52 4551 5549 5245 4d45 4e54 2c0a 2020  _REQUIREMENT,.  
-0000aec0: 2020 2020 2020 7265 7175 6972 656d 656e        requiremen
-0000aed0: 7473 6d6f 642e 5348 4152 4553 4146 455f  tsmod.SHARESAFE_
-0000aee0: 5245 5155 4952 454d 454e 542c 0a20 2020  REQUIREMENT,.   
-0000aef0: 2020 2020 2072 6571 7569 7265 6d65 6e74       requirement
-0000af00: 736d 6f64 2e53 5041 5253 455f 5245 5155  smod.SPARSE_REQU
-0000af10: 4952 454d 454e 542c 0a20 2020 2020 2020  IREMENT,.       
-0000af20: 2072 6571 7569 7265 6d65 6e74 736d 6f64   requirementsmod
-0000af30: 2e53 5041 5253 4552 4556 4c4f 475f 5245  .SPARSEREVLOG_RE
-0000af40: 5155 4952 454d 454e 542c 0a20 2020 2020  QUIREMENT,.     
-0000af50: 2020 2072 6571 7569 7265 6d65 6e74 736d     requirementsm
-0000af60: 6f64 2e53 544f 5245 5f52 4551 5549 5245  od.STORE_REQUIRE
-0000af70: 4d45 4e54 2c0a 2020 2020 2020 2020 7265  MENT,.        re
-0000af80: 7175 6972 656d 656e 7473 6d6f 642e 5452  quirementsmod.TR
-0000af90: 4545 4d41 4e49 4645 5354 5f52 4551 5549  EEMANIFEST_REQUI
-0000afa0: 5245 4d45 4e54 2c0a 2020 2020 7d0a 0a20  REMENT,.    }.. 
-0000afb0: 2020 2023 206c 6973 7420 6f66 2070 7265     # list of pre
-0000afc0: 6669 7820 666f 7220 6669 6c65 2077 6869  fix for file whi
-0000afd0: 6368 2063 616e 2062 6520 7772 6974 7465  ch can be writte
-0000afe0: 6e20 7769 7468 6f75 7420 2777 6c6f 636b  n without 'wlock
-0000aff0: 270a 2020 2020 2320 4578 7465 6e73 696f  '.    # Extensio
-0000b000: 6e73 2073 686f 756c 6420 6578 7465 6e64  ns should extend
-0000b010: 2074 6869 7320 6c69 7374 2077 6865 6e20   this list when 
-0000b020: 6e65 6564 6564 0a20 2020 205f 776c 6f63  needed.    _wloc
-0000b030: 6b66 7265 6570 7265 6669 7820 3d20 7b0a  kfreeprefix = {.
-0000b040: 2020 2020 2020 2020 2320 5765 206d 6967          # We mig
-0000b050: 6820 636f 6e73 6964 6572 2072 6571 7569  h consider requi
-0000b060: 7269 6e67 2027 776c 6f63 6b27 2066 6f72  ring 'wlock' for
-0000b070: 2074 6865 206e 6578 740a 2020 2020 2020   the next.      
-0000b080: 2020 2320 7477 6f2c 2062 7574 2070 7265    # two, but pre
-0000b090: 7474 7920 6d75 6368 2061 6c6c 2074 6865  tty much all the
-0000b0a0: 2065 7869 7374 696e 6720 636f 6465 2061   existing code a
-0000b0b0: 7373 756d 650a 2020 2020 2020 2020 2320  ssume.        # 
-0000b0c0: 776c 6f63 6b20 6973 206e 6f74 206e 6565  wlock is not nee
-0000b0d0: 6465 6420 736f 2077 6520 6b65 6570 2074  ded so we keep t
-0000b0e0: 6865 6d20 6578 636c 7564 6564 2066 6f72  hem excluded for
-0000b0f0: 0a20 2020 2020 2020 2023 206e 6f77 2e0a  .        # now..
-0000b100: 2020 2020 2020 2020 6227 6867 7263 272c          b'hgrc',
-0000b110: 0a20 2020 2020 2020 2062 2772 6571 7569  .        b'requi
-0000b120: 7265 7327 2c0a 2020 2020 2020 2020 2320  res',.        # 
-0000b130: 5858 5820 6361 6368 6520 6973 2061 2063  XXX cache is a c
-0000b140: 6f6d 706c 6963 6174 6765 6420 6275 7369  omplicatged busi
-0000b150: 6e65 7373 2073 6f6d 656f 6e65 0a20 2020  ness someone.   
-0000b160: 2020 2020 2023 2073 686f 756c 6420 696e       # should in
-0000b170: 7665 7374 6967 6174 6520 7468 6973 2069  vestigate this i
-0000b180: 6e20 6465 7074 6820 6174 2073 6f6d 6520  n depth at some 
-0000b190: 706f 696e 740a 2020 2020 2020 2020 6227  point.        b'
-0000b1a0: 6361 6368 652f 272c 0a20 2020 2020 2020  cache/',.       
-0000b1b0: 2023 2058 5858 2062 6973 6563 7420 7761   # XXX bisect wa
-0000b1c0: 7320 7374 696c 6c20 6120 6269 7420 746f  s still a bit to
-0000b1d0: 6f20 6d65 7373 7920 6174 2074 6865 2074  o messy at the t
-0000b1e0: 696d 650a 2020 2020 2020 2020 2320 7468  ime.        # th
-0000b1f0: 6973 2063 6861 6e67 6573 6574 2077 6173  is changeset was
-0000b200: 2069 6e74 726f 6475 6365 642e 2053 6f6d   introduced. Som
-0000b210: 656f 6e65 2073 686f 756c 6420 6669 780a  eone should fix.
-0000b220: 2020 2020 2020 2020 2320 7468 6520 7265          # the re
-0000b230: 6d61 696e 6967 2062 6974 2061 6e64 2064  mainig bit and d
-0000b240: 726f 7020 7468 6973 206c 696e 650a 2020  rop this line.  
-0000b250: 2020 2020 2020 6227 6269 7365 6374 2e73        b'bisect.s
-0000b260: 7461 7465 272c 0a20 2020 207d 0a0a 2020  tate',.    }..  
-0000b270: 2020 6465 6620 5f5f 696e 6974 5f5f 280a    def __init__(.
-0000b280: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000b290: 2020 2020 2020 6261 7365 7569 2c0a 2020        baseui,.  
-0000b2a0: 2020 2020 2020 7569 2c0a 2020 2020 2020        ui,.      
-0000b2b0: 2020 6f72 6967 726f 6f74 3a20 6279 7465    origroot: byte
-0000b2c0: 732c 0a20 2020 2020 2020 2077 6469 7276  s,.        wdirv
-0000b2d0: 6673 3a20 7666 736d 6f64 2e76 6673 2c0a  fs: vfsmod.vfs,.
-0000b2e0: 2020 2020 2020 2020 6867 7666 733a 2076          hgvfs: v
-0000b2f0: 6673 6d6f 642e 7666 732c 0a20 2020 2020  fsmod.vfs,.     
-0000b300: 2020 2072 6571 7569 7265 6d65 6e74 732c     requirements,
-0000b310: 0a20 2020 2020 2020 2073 7570 706f 7274  .        support
-0000b320: 6564 7265 7175 6972 656d 656e 7473 2c0a  edrequirements,.
-0000b330: 2020 2020 2020 2020 7368 6172 6564 7061          sharedpa
-0000b340: 7468 3a20 6279 7465 732c 0a20 2020 2020  th: bytes,.     
-0000b350: 2020 2073 746f 7265 2c0a 2020 2020 2020     store,.      
-0000b360: 2020 6361 6368 6576 6673 3a20 7666 736d    cachevfs: vfsm
-0000b370: 6f64 2e76 6673 2c0a 2020 2020 2020 2020  od.vfs,.        
-0000b380: 7763 6163 6865 7666 733a 2076 6673 6d6f  wcachevfs: vfsmo
-0000b390: 642e 7666 732c 0a20 2020 2020 2020 2066  d.vfs,.        f
-0000b3a0: 6561 7475 7265 732c 0a20 2020 2020 2020  eatures,.       
-0000b3b0: 2069 6e74 656e 7473 3d4e 6f6e 652c 0a20   intents=None,. 
-0000b3c0: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-0000b3d0: 2243 7265 6174 6520 6120 6e65 7720 6c6f  "Create a new lo
-0000b3e0: 6361 6c20 7265 706f 7369 746f 7279 2069  cal repository i
-0000b3f0: 6e73 7461 6e63 652e 0a0a 2020 2020 2020  nstance...      
-0000b400: 2020 4d6f 7374 2063 616c 6c65 7273 2073    Most callers s
-0000b410: 686f 756c 6420 7573 6520 6060 6867 2e72  hould use ``hg.r
-0000b420: 6570 6f73 6974 6f72 7928 2960 602c 2060  epository()``, `
-0000b430: 606c 6f63 616c 7265 706f 2e69 6e73 7461  `localrepo.insta
-0000b440: 6e63 6528 2960 602c 0a20 2020 2020 2020  nce()``,.       
-0000b450: 206f 7220 6060 6c6f 6361 6c72 6570 6f2e   or ``localrepo.
-0000b460: 6d61 6b65 6c6f 6361 6c72 6570 6f73 6974  makelocalreposit
-0000b470: 6f72 7928 2960 6020 666f 7220 6f62 7461  ory()`` for obta
-0000b480: 696e 696e 6720 6120 6e65 7720 7265 706f  ining a new repo
-0000b490: 7369 746f 7279 0a20 2020 2020 2020 206f  sitory.        o
-0000b4a0: 626a 6563 742e 0a0a 2020 2020 2020 2020  bject...        
-0000b4b0: 4172 6775 6d65 6e74 733a 0a0a 2020 2020  Arguments:..    
-0000b4c0: 2020 2020 6261 7365 7569 0a20 2020 2020      baseui.     
-0000b4d0: 2020 2020 2020 6060 7569 2e75 6960 6020        ``ui.ui`` 
-0000b4e0: 696e 7374 616e 6365 2074 6861 7420 6060  instance that ``
-0000b4f0: 7569 6060 2061 7267 756d 656e 7420 7761  ui`` argument wa
-0000b500: 7320 6261 7365 6420 6f66 6620 6f66 2e0a  s based off of..
-0000b510: 0a20 2020 2020 2020 2075 690a 2020 2020  .        ui.    
-0000b520: 2020 2020 2020 2060 6075 692e 7569 6060         ``ui.ui``
-0000b530: 2069 6e73 7461 6e63 6520 666f 7220 7573   instance for us
-0000b540: 6520 6279 2074 6865 2072 6570 6f73 6974  e by the reposit
-0000b550: 6f72 792e 0a0a 2020 2020 2020 2020 6f72  ory...        or
-0000b560: 6967 726f 6f74 0a20 2020 2020 2020 2020  igroot.         
-0000b570: 2020 6060 6279 7465 7360 6020 7061 7468    ``bytes`` path
-0000b580: 2074 6f20 776f 726b 696e 6720 6469 7265   to working dire
-0000b590: 6374 6f72 7920 726f 6f74 206f 6620 7468  ctory root of th
-0000b5a0: 6973 2072 6570 6f73 6974 6f72 792e 0a0a  is repository...
-0000b5b0: 2020 2020 2020 2020 7764 6972 7666 730a          wdirvfs.
-0000b5c0: 2020 2020 2020 2020 2020 2060 6076 6673             ``vfs
-0000b5d0: 2e76 6673 6060 2072 6f6f 7465 6420 6174  .vfs`` rooted at
-0000b5e0: 2074 6865 2077 6f72 6b69 6e67 2064 6972   the working dir
-0000b5f0: 6563 746f 7279 2e0a 0a20 2020 2020 2020  ectory...       
-0000b600: 2068 6776 6673 0a20 2020 2020 2020 2020   hgvfs.         
-0000b610: 2020 6060 7666 732e 7666 7360 6020 726f    ``vfs.vfs`` ro
-0000b620: 6f74 6564 2061 7420 2e68 672f 0a0a 2020  oted at .hg/..  
-0000b630: 2020 2020 2020 7265 7175 6972 656d 656e        requiremen
-0000b640: 7473 0a20 2020 2020 2020 2020 2020 6060  ts.           ``
-0000b650: 7365 7460 6020 6f66 2062 7974 6573 7472  set`` of bytestr
-0000b660: 696e 6773 2072 6570 7265 7365 6e74 696e  ings representin
-0000b670: 6720 7265 706f 7369 746f 7279 206f 7065  g repository ope
-0000b680: 6e69 6e67 2072 6571 7569 7265 6d65 6e74  ning requirement
-0000b690: 732e 0a0a 2020 2020 2020 2020 7375 7070  s...        supp
-0000b6a0: 6f72 7465 6472 6571 7569 7265 6d65 6e74  ortedrequirement
-0000b6b0: 730a 2020 2020 2020 2020 2020 2060 6073  s.           ``s
-0000b6c0: 6574 6060 206f 6620 6279 7465 7374 7269  et`` of bytestri
-0000b6d0: 6e67 7320 7265 7072 6573 656e 7469 6e67  ngs representing
-0000b6e0: 2072 6570 6f73 6974 6f72 7920 7265 7175   repository requ
-0000b6f0: 6972 656d 656e 7473 2074 6861 7420 7765  irements that we
-0000b700: 0a20 2020 2020 2020 2020 2020 6b6e 6f77  .           know
-0000b710: 2068 6f77 2074 6f20 6f70 656e 2e20 4d61   how to open. Ma
-0000b720: 7920 6265 2061 2073 7570 6574 7365 7420  y be a supetset 
-0000b730: 6f66 2060 6072 6571 7569 7265 6d65 6e74  of ``requirement
-0000b740: 7360 602e 0a0a 2020 2020 2020 2020 7368  s``...        sh
-0000b750: 6172 6564 7061 7468 0a20 2020 2020 2020  aredpath.       
-0000b760: 2020 2020 6060 6279 7465 7360 6020 4465      ``bytes`` De
-0000b770: 6669 6e69 6e67 2070 6174 6820 746f 2073  fining path to s
-0000b780: 746f 7261 6765 2062 6173 6520 6469 7265  torage base dire
-0000b790: 6374 6f72 792e 2050 6f69 6e74 7320 746f  ctory. Points to
-0000b7a0: 2061 0a20 2020 2020 2020 2020 2020 6060   a.           ``
-0000b7b0: 2e68 672f 6060 2064 6972 6563 746f 7279  .hg/`` directory
-0000b7c0: 2073 6f6d 6577 6865 7265 2e0a 0a20 2020   somewhere...   
-0000b7d0: 2020 2020 2073 746f 7265 0a20 2020 2020       store.     
-0000b7e0: 2020 2020 2020 6060 7374 6f72 652e 6261        ``store.ba
-0000b7f0: 7369 6373 746f 7265 6060 2028 6f72 2064  sicstore`` (or d
-0000b800: 6572 6976 6564 2920 696e 7374 616e 6365  erived) instance
-0000b810: 2070 726f 7669 6469 6e67 2061 6363 6573   providing acces
-0000b820: 7320 746f 0a20 2020 2020 2020 2020 2020  s to.           
-0000b830: 7665 7273 696f 6e65 6420 7374 6f72 6167  versioned storag
-0000b840: 652e 0a0a 2020 2020 2020 2020 6361 6368  e...        cach
-0000b850: 6576 6673 0a20 2020 2020 2020 2020 2020  evfs.           
-0000b860: 6060 7666 732e 7666 7360 6020 7573 6564  ``vfs.vfs`` used
-0000b870: 2066 6f72 2063 6163 6865 2066 696c 6573   for cache files
-0000b880: 2e0a 0a20 2020 2020 2020 2077 6361 6368  ...        wcach
-0000b890: 6576 6673 0a20 2020 2020 2020 2020 2020  evfs.           
-0000b8a0: 6060 7666 732e 7666 7360 6020 7573 6564  ``vfs.vfs`` used
-0000b8b0: 2066 6f72 2063 6163 6865 2066 696c 6573   for cache files
-0000b8c0: 2072 656c 6174 6564 2074 6f20 7468 6520   related to the 
-0000b8d0: 776f 726b 696e 6720 636f 7079 2e0a 0a20  working copy... 
-0000b8e0: 2020 2020 2020 2066 6561 7475 7265 730a         features.
-0000b8f0: 2020 2020 2020 2020 2020 2060 6073 6574             ``set
-0000b900: 6060 206f 6620 6279 7465 7374 7269 6e67  `` of bytestring
-0000b910: 7320 6465 6669 6e69 6e67 2066 6561 7475  s defining featu
-0000b920: 7265 732f 6361 7061 6269 6c69 7469 6573  res/capabilities
-0000b930: 206f 6620 7468 6973 0a20 2020 2020 2020   of this.       
-0000b940: 2020 2020 696e 7374 616e 6365 2e0a 0a20      instance... 
-0000b950: 2020 2020 2020 2069 6e74 656e 7473 0a20         intents. 
-0000b960: 2020 2020 2020 2020 2020 6060 7365 7460            ``set`
-0000b970: 6020 6f66 2073 7973 7465 6d20 7374 7269  ` of system stri
-0000b980: 6e67 7320 696e 6469 6361 7469 6e67 2077  ngs indicating w
-0000b990: 6861 7420 7468 6973 2072 6570 6f20 7769  hat this repo wi
-0000b9a0: 6c6c 2062 6520 7573 6564 0a20 2020 2020  ll be used.     
-0000b9b0: 2020 2020 2020 666f 722e 0a20 2020 2020        for..     
-0000b9c0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
-0000b9d0: 656c 662e 6261 7365 7569 203d 2062 6173  elf.baseui = bas
-0000b9e0: 6575 690a 2020 2020 2020 2020 7365 6c66  eui.        self
-0000b9f0: 2e75 6920 3d20 7569 0a20 2020 2020 2020  .ui = ui.       
-0000ba00: 2073 656c 662e 6f72 6967 726f 6f74 203d   self.origroot =
-0000ba10: 206f 7269 6772 6f6f 740a 2020 2020 2020   origroot.      
-0000ba20: 2020 2320 7666 7320 726f 6f74 6564 2061    # vfs rooted a
-0000ba30: 7420 776f 726b 696e 6720 6469 7265 6374  t working direct
-0000ba40: 6f72 792e 0a20 2020 2020 2020 2073 656c  ory..        sel
-0000ba50: 662e 7776 6673 203d 2077 6469 7276 6673  f.wvfs = wdirvfs
-0000ba60: 0a20 2020 2020 2020 2073 656c 662e 726f  .        self.ro
-0000ba70: 6f74 203d 2077 6469 7276 6673 2e62 6173  ot = wdirvfs.bas
-0000ba80: 650a 2020 2020 2020 2020 2320 7666 7320  e.        # vfs 
-0000ba90: 726f 6f74 6564 2061 7420 2e68 672f 2e20  rooted at .hg/. 
-0000baa0: 5573 6564 2074 6f20 6163 6365 7373 206d  Used to access m
-0000bab0: 6f73 7420 6e6f 6e2d 7374 6f72 6520 7061  ost non-store pa
-0000bac0: 7468 732e 0a20 2020 2020 2020 2073 656c  ths..        sel
-0000bad0: 662e 7666 7320 3d20 6867 7666 730a 2020  f.vfs = hgvfs.  
-0000bae0: 2020 2020 2020 7365 6c66 2e70 6174 6820        self.path 
-0000baf0: 3d20 6867 7666 732e 6261 7365 0a20 2020  = hgvfs.base.   
-0000bb00: 2020 2020 2073 656c 662e 7265 7175 6972       self.requir
-0000bb10: 656d 656e 7473 203d 2072 6571 7569 7265  ements = require
-0000bb20: 6d65 6e74 730a 2020 2020 2020 2020 7365  ments.        se
-0000bb30: 6c66 2e6e 6f64 6563 6f6e 7374 616e 7473  lf.nodeconstants
-0000bb40: 203d 2073 6861 316e 6f64 6563 6f6e 7374   = sha1nodeconst
-0000bb50: 616e 7473 0a20 2020 2020 2020 2073 656c  ants.        sel
-0000bb60: 662e 6e75 6c6c 6964 203d 2073 656c 662e  f.nullid = self.
-0000bb70: 6e6f 6465 636f 6e73 7461 6e74 732e 6e75  nodeconstants.nu
-0000bb80: 6c6c 6964 0a20 2020 2020 2020 2073 656c  llid.        sel
-0000bb90: 662e 7375 7070 6f72 7465 6420 3d20 7375  f.supported = su
-0000bba0: 7070 6f72 7465 6472 6571 7569 7265 6d65  pportedrequireme
-0000bbb0: 6e74 730a 2020 2020 2020 2020 7365 6c66  nts.        self
-0000bbc0: 2e73 6861 7265 6470 6174 6820 3d20 7368  .sharedpath = sh
-0000bbd0: 6172 6564 7061 7468 0a20 2020 2020 2020  aredpath.       
-0000bbe0: 2073 656c 662e 7374 6f72 6520 3d20 7374   self.store = st
-0000bbf0: 6f72 650a 2020 2020 2020 2020 7365 6c66  ore.        self
-0000bc00: 2e63 6163 6865 7666 7320 3d20 6361 6368  .cachevfs = cach
-0000bc10: 6576 6673 0a20 2020 2020 2020 2073 656c  evfs.        sel
-0000bc20: 662e 7763 6163 6865 7666 7320 3d20 7763  f.wcachevfs = wc
-0000bc30: 6163 6865 7666 730a 2020 2020 2020 2020  achevfs.        
-0000bc40: 7365 6c66 2e66 6561 7475 7265 7320 3d20  self.features = 
-0000bc50: 6665 6174 7572 6573 0a0a 2020 2020 2020  features..      
-0000bc60: 2020 7365 6c66 2e66 696c 7465 726e 616d    self.filternam
-0000bc70: 6520 3d20 4e6f 6e65 0a0a 2020 2020 2020  e = None..      
-0000bc80: 2020 6966 2073 656c 662e 7569 2e63 6f6e    if self.ui.con
-0000bc90: 6669 6762 6f6f 6c28 6227 6465 7665 6c27  figbool(b'devel'
-0000bca0: 2c20 6227 616c 6c2d 7761 726e 696e 6773  , b'all-warnings
-0000bcb0: 2729 206f 7220 7365 6c66 2e75 692e 636f  ') or self.ui.co
-0000bcc0: 6e66 6967 626f 6f6c 280a 2020 2020 2020  nfigbool(.      
-0000bcd0: 2020 2020 2020 6227 6465 7665 6c27 2c20        b'devel', 
-0000bce0: 6227 6368 6563 6b2d 6c6f 636b 7327 0a20  b'check-locks'. 
-0000bcf0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0000bd00: 2020 2020 2020 7365 6c66 2e76 6673 2e61        self.vfs.a
-0000bd10: 7564 6974 203d 2073 656c 662e 5f67 6574  udit = self._get
-0000bd20: 7666 7377 6172 6428 7365 6c66 2e76 6673  vfsward(self.vfs
-0000bd30: 2e61 7564 6974 290a 2020 2020 2020 2020  .audit).        
-0000bd40: 2320 4120 6c69 7374 206f 6620 6361 6c6c  # A list of call
-0000bd50: 6261 636b 2074 6f20 7368 6170 6520 7468  back to shape th
-0000bd60: 6520 7068 6173 6520 6966 206e 6f20 6461  e phase if no da
-0000bd70: 7461 2077 6572 6520 666f 756e 642e 0a20  ta were found.. 
-0000bd80: 2020 2020 2020 2023 2043 616c 6c62 6163         # Callbac
-0000bd90: 6b20 6172 6520 696e 2074 6865 2066 6f72  k are in the for
-0000bda0: 6d3a 2066 756e 6328 7265 706f 2c20 726f  m: func(repo, ro
-0000bdb0: 6f74 7329 202d 2d3e 2070 726f 6365 7373  ots) --> process
-0000bdc0: 6564 2072 6f6f 742e 0a20 2020 2020 2020  ed root..       
-0000bdd0: 2023 2054 6869 7320 6c69 7374 2069 7420   # This list it 
-0000bde0: 746f 2062 6520 6669 6c6c 6564 2062 7920  to be filled by 
-0000bdf0: 6578 7465 6e73 696f 6e20 6475 7269 6e67  extension during
-0000be00: 2072 6570 6f20 7365 7475 700a 2020 2020   repo setup.    
-0000be10: 2020 2020 7365 6c66 2e5f 7068 6173 6564      self._phased
-0000be20: 6566 6175 6c74 7320 3d20 5b5d 0a0a 2020  efaults = []..  
-0000be30: 2020 2020 2020 636f 6c6f 722e 7365 7475        color.setu
-0000be40: 7028 7365 6c66 2e75 6929 0a0a 2020 2020  p(self.ui)..    
-0000be50: 2020 2020 7365 6c66 2e73 7061 7468 203d      self.spath =
-0000be60: 2073 656c 662e 7374 6f72 652e 7061 7468   self.store.path
-0000be70: 0a20 2020 2020 2020 2073 656c 662e 7376  .        self.sv
-0000be80: 6673 203d 2073 656c 662e 7374 6f72 652e  fs = self.store.
-0000be90: 7666 730a 2020 2020 2020 2020 7365 6c66  vfs.        self
-0000bea0: 2e73 6a6f 696e 203d 2073 656c 662e 7374  .sjoin = self.st
-0000beb0: 6f72 652e 6a6f 696e 0a20 2020 2020 2020  ore.join.       
-0000bec0: 2069 6620 7365 6c66 2e75 692e 636f 6e66   if self.ui.conf
-0000bed0: 6967 626f 6f6c 2862 2764 6576 656c 272c  igbool(b'devel',
-0000bee0: 2062 2761 6c6c 2d77 6172 6e69 6e67 7327   b'all-warnings'
-0000bef0: 2920 6f72 2073 656c 662e 7569 2e63 6f6e  ) or self.ui.con
-0000bf00: 6669 6762 6f6f 6c28 0a20 2020 2020 2020  figbool(.       
-0000bf10: 2020 2020 2062 2764 6576 656c 272c 2062       b'devel', b
-0000bf20: 2763 6865 636b 2d6c 6f63 6b73 270a 2020  'check-locks'.  
-0000bf30: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-0000bf40: 2020 2020 2069 6620 7574 696c 2e73 6166       if util.saf
-0000bf50: 6568 6173 6174 7472 2873 656c 662e 7376  ehasattr(self.sv
-0000bf60: 6673 2c20 6227 7666 7327 293a 2020 2320  fs, b'vfs'):  # 
-0000bf70: 7468 6973 2069 7320 6669 6c74 6572 7666  this is filtervf
-0000bf80: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0000bf90: 2020 7365 6c66 2e73 7666 732e 7666 732e    self.svfs.vfs.
-0000bfa0: 6175 6469 7420 3d20 7365 6c66 2e5f 6765  audit = self._ge
-0000bfb0: 7473 7666 7377 6172 6428 7365 6c66 2e73  tsvfsward(self.s
-0000bfc0: 7666 732e 7666 732e 6175 6469 7429 0a20  vfs.vfs.audit). 
-0000bfd0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000bfe0: 2020 2320 7374 616e 6461 7264 2076 6673    # standard vfs
-0000bff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c000: 2073 656c 662e 7376 6673 2e61 7564 6974   self.svfs.audit
-0000c010: 203d 2073 656c 662e 5f67 6574 7376 6673   = self._getsvfs
-0000c020: 7761 7264 2873 656c 662e 7376 6673 2e61  ward(self.svfs.a
-0000c030: 7564 6974 290a 0a20 2020 2020 2020 2073  udit)..        s
-0000c040: 656c 662e 5f64 6972 7374 6174 6576 616c  elf._dirstateval
-0000c050: 6964 6174 6577 6172 6e65 6420 3d20 4661  idatewarned = Fa
-0000c060: 6c73 650a 0a20 2020 2020 2020 2073 656c  lse..        sel
-0000c070: 662e 5f62 7261 6e63 6863 6163 6865 7320  f._branchcaches 
-0000c080: 3d20 6272 616e 6368 6d61 702e 4272 616e  = branchmap.Bran
-0000c090: 6368 4d61 7043 6163 6865 2829 0a20 2020  chMapCache().   
-0000c0a0: 2020 2020 2073 656c 662e 5f72 6576 6272       self._revbr
-0000c0b0: 616e 6368 6361 6368 6520 3d20 4e6f 6e65  anchcache = None
-0000c0c0: 0a20 2020 2020 2020 2073 656c 662e 5f66  .        self._f
-0000c0d0: 696c 7465 7270 6174 7320 3d20 7b7d 0a20  ilterpats = {}. 
-0000c0e0: 2020 2020 2020 2073 656c 662e 5f64 6174         self._dat
-0000c0f0: 6166 696c 7465 7273 203d 207b 7d0a 2020  afilters = {}.  
-0000c100: 2020 2020 2020 7365 6c66 2e5f 7472 616e        self._tran
-0000c110: 7372 6566 203d 2073 656c 662e 5f6c 6f63  sref = self._loc
-0000c120: 6b72 6566 203d 2073 656c 662e 5f77 6c6f  kref = self._wlo
-0000c130: 636b 7265 6620 3d20 4e6f 6e65 0a0a 2020  ckref = None..  
-0000c140: 2020 2020 2020 2320 4120 6361 6368 6520        # A cache 
-0000c150: 666f 7220 7661 7269 6f75 7320 6669 6c65  for various file
-0000c160: 7320 756e 6465 7220 2e68 672f 2074 6861  s under .hg/ tha
-0000c170: 7420 7472 6163 6b73 2066 696c 6520 6368  t tracks file ch
-0000c180: 616e 6765 732c 0a20 2020 2020 2020 2023  anges,.        #
-0000c190: 2028 7573 6564 2062 7920 7468 6520 6669   (used by the fi
-0000c1a0: 6c65 6361 6368 6520 6465 636f 7261 746f  lecache decorato
-0000c1b0: 7229 0a20 2020 2020 2020 2023 0a20 2020  r).        #.   
-0000c1c0: 2020 2020 2023 204d 6170 7320 6120 7072       # Maps a pr
-0000c1d0: 6f70 6572 7479 206e 616d 6520 746f 2069  operty name to i
-0000c1e0: 7473 2075 7469 6c2e 6669 6c65 6361 6368  ts util.filecach
-0000c1f0: 6565 6e74 7279 0a20 2020 2020 2020 2073  eentry.        s
-0000c200: 656c 662e 5f66 696c 6563 6163 6865 203d  elf._filecache =
-0000c210: 207b 7d0a 0a20 2020 2020 2020 2023 2068   {}..        # h
-0000c220: 6f6c 6420 7365 7473 206f 6620 7265 7669  old sets of revi
-0000c230: 7369 6f6e 2074 6f20 6265 2066 696c 7465  sion to be filte
-0000c240: 7265 640a 2020 2020 2020 2020 2320 7368  red.        # sh
-0000c250: 6f75 6c64 2062 6520 636c 6561 7265 6420  ould be cleared 
-0000c260: 7768 656e 2073 6f6d 6574 6869 6e67 206d  when something m
-0000c270: 6967 6874 2068 6176 6520 6368 616e 6765  ight have change
-0000c280: 6420 7468 6520 6669 6c74 6572 2076 616c  d the filter val
-0000c290: 7565 3a0a 2020 2020 2020 2020 2320 2d20  ue:.        # - 
-0000c2a0: 6e65 7720 6368 616e 6765 7365 7473 2c0a  new changesets,.
-0000c2b0: 2020 2020 2020 2020 2320 2d20 7068 6173          # - phas
-0000c2c0: 6520 6368 616e 6765 2c0a 2020 2020 2020  e change,.      
-0000c2d0: 2020 2320 2d20 6e65 7720 6f62 736f 6c65    # - new obsole
-0000c2e0: 7363 656e 6365 206d 6172 6b65 722c 0a20  scence marker,. 
-0000c2f0: 2020 2020 2020 2023 202d 2077 6f72 6b69         # - worki
-0000c300: 6e67 2064 6972 6563 746f 7279 2070 6172  ng directory par
-0000c310: 656e 7420 6368 616e 6765 2c0a 2020 2020  ent change,.    
-0000c320: 2020 2020 2320 2d20 626f 6f6b 6d61 726b      # - bookmark
-0000c330: 2063 6861 6e67 6573 0a20 2020 2020 2020   changes.       
-0000c340: 2073 656c 662e 6669 6c74 6572 6564 7265   self.filteredre
-0000c350: 7663 6163 6865 203d 207b 7d0a 0a20 2020  vcache = {}..   
-0000c360: 2020 2020 2073 656c 662e 5f64 6972 7374       self._dirst
-0000c370: 6174 6520 3d20 4e6f 6e65 0a20 2020 2020  ate = None.     
-0000c380: 2020 2023 2070 6f73 742d 6469 7273 7461     # post-dirsta
-0000c390: 7465 2d73 7461 7475 7320 686f 6f6b 730a  te-status hooks.
-0000c3a0: 2020 2020 2020 2020 7365 6c66 2e5f 706f          self._po
-0000c3b0: 7374 6473 7374 6174 7573 203d 205b 5d0a  stdsstatus = [].
-0000c3c0: 0a20 2020 2020 2020 2073 656c 662e 5f70  .        self._p
-0000c3d0: 656e 6469 6e67 5f6e 6172 726f 775f 7061  ending_narrow_pa
-0000c3e0: 7473 203d 204e 6f6e 650a 2020 2020 2020  ts = None.      
-0000c3f0: 2020 7365 6c66 2e5f 7065 6e64 696e 675f    self._pending_
-0000c400: 6e61 7272 6f77 5f70 6174 735f 6469 7273  narrow_pats_dirs
-0000c410: 7461 7465 203d 204e 6f6e 650a 0a20 2020  tate = None..   
-0000c420: 2020 2020 2023 2067 656e 6572 6963 206d       # generic m
-0000c430: 6170 7069 6e67 2062 6574 7765 656e 206e  apping between n
-0000c440: 616d 6573 2061 6e64 206e 6f64 6573 0a20  ames and nodes. 
-0000c450: 2020 2020 2020 2073 656c 662e 6e61 6d65         self.name
-0000c460: 7320 3d20 6e61 6d65 7370 6163 6573 2e6e  s = namespaces.n
-0000c470: 616d 6573 7061 6365 7328 290a 0a20 2020  amespaces()..   
-0000c480: 2020 2020 2023 204b 6579 2074 6f20 7369       # Key to si
-0000c490: 676e 6174 7572 6520 7661 6c75 652e 0a20  gnature value.. 
-0000c4a0: 2020 2020 2020 2073 656c 662e 5f73 7061         self._spa
-0000c4b0: 7273 6573 6967 6e61 7475 7265 6361 6368  rsesignaturecach
-0000c4c0: 6520 3d20 7b7d 0a20 2020 2020 2020 2023  e = {}.        #
-0000c4d0: 2053 6967 6e61 7475 7265 2074 6f20 6361   Signature to ca
-0000c4e0: 6368 6564 206d 6174 6368 6572 2069 6e73  ched matcher ins
-0000c4f0: 7461 6e63 652e 0a20 2020 2020 2020 2073  tance..        s
-0000c500: 656c 662e 5f73 7061 7273 656d 6174 6368  elf._sparsematch
-0000c510: 6572 6361 6368 6520 3d20 7b7d 0a0a 2020  ercache = {}..  
-0000c520: 2020 2020 2020 7365 6c66 2e5f 6578 7472        self._extr
-0000c530: 6166 696c 7465 7269 6420 3d20 7265 706f  afilterid = repo
-0000c540: 7669 6577 2e65 7874 7261 6669 6c74 6572  view.extrafilter
-0000c550: 2875 6929 0a0a 2020 2020 2020 2020 7365  (ui)..        se
-0000c560: 6c66 2e66 696c 6563 6f70 6965 736d 6f64  lf.filecopiesmod
-0000c570: 6520 3d20 4e6f 6e65 0a20 2020 2020 2020  e = None.       
-0000c580: 2069 6620 7265 7175 6972 656d 656e 7473   if requirements
-0000c590: 6d6f 642e 434f 5049 4553 5344 435f 5245  mod.COPIESSDC_RE
-0000c5a0: 5155 4952 454d 454e 5420 696e 2073 656c  QUIREMENT in sel
-0000c5b0: 662e 7265 7175 6972 656d 656e 7473 3a0a  f.requirements:.
-0000c5c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000c5d0: 2e66 696c 6563 6f70 6965 736d 6f64 6520  .filecopiesmode 
-0000c5e0: 3d20 6227 6368 616e 6765 7365 742d 7369  = b'changeset-si
-0000c5f0: 6465 6461 7461 270a 0a20 2020 2020 2020  dedata'..       
-0000c600: 2073 656c 662e 5f77 616e 7465 645f 7369   self._wanted_si
-0000c610: 6465 6461 7461 203d 2073 6574 2829 0a20  dedata = set(). 
-0000c620: 2020 2020 2020 2073 656c 662e 5f73 6964         self._sid
-0000c630: 6564 6174 615f 636f 6d70 7574 6572 7320  edata_computers 
-0000c640: 3d20 7b7d 0a20 2020 2020 2020 2073 6964  = {}.        sid
-0000c650: 6564 6174 616d 6f64 2e73 6574 5f73 6964  edatamod.set_sid
-0000c660: 6564 6174 615f 7370 6563 5f66 6f72 5f72  edata_spec_for_r
-0000c670: 6570 6f28 7365 6c66 290a 0a20 2020 2064  epo(self)..    d
-0000c680: 6566 205f 6765 7476 6673 7761 7264 2873  ef _getvfsward(s
-0000c690: 656c 662c 206f 7269 6766 756e 6329 3a0a  elf, origfunc):.
-0000c6a0: 2020 2020 2020 2020 2222 2262 7569 6c64          """build
-0000c6b0: 2061 2077 6172 6420 666f 7220 7365 6c66   a ward for self
-0000c6c0: 2e76 6673 2222 220a 2020 2020 2020 2020  .vfs""".        
-0000c6d0: 7272 6566 203d 2077 6561 6b72 6566 2e72  rref = weakref.r
-0000c6e0: 6566 2873 656c 6629 0a0a 2020 2020 2020  ef(self)..      
-0000c6f0: 2020 6465 6620 6368 6563 6b76 6673 2870    def checkvfs(p
-0000c700: 6174 682c 206d 6f64 653d 4e6f 6e65 293a  ath, mode=None):
-0000c710: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000c720: 203d 206f 7269 6766 756e 6328 7061 7468   = origfunc(path
-0000c730: 2c20 6d6f 6465 3d6d 6f64 6529 0a20 2020  , mode=mode).   
-0000c740: 2020 2020 2020 2020 2072 6570 6f20 3d20           repo = 
-0000c750: 7272 6566 2829 0a20 2020 2020 2020 2020  rref().         
-0000c760: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-0000c770: 2020 2020 2020 2020 7265 706f 2069 7320          repo is 
-0000c780: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0000c790: 2020 2020 206f 7220 6e6f 7420 7574 696c       or not util
-0000c7a0: 2e73 6166 6568 6173 6174 7472 2872 6570  .safehasattr(rep
-0000c7b0: 6f2c 2062 275f 776c 6f63 6b72 6566 2729  o, b'_wlockref')
-0000c7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c7d0: 206f 7220 6e6f 7420 7574 696c 2e73 6166   or not util.saf
-0000c7e0: 6568 6173 6174 7472 2872 6570 6f2c 2062  ehasattr(repo, b
-0000c7f0: 275f 6c6f 636b 7265 6627 290a 2020 2020  '_lockref').    
-0000c800: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-0000c810: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000c820: 6e0a 2020 2020 2020 2020 2020 2020 6966  n.            if
-0000c830: 206d 6f64 6520 696e 2028 4e6f 6e65 2c20   mode in (None, 
-0000c840: 6227 7227 2c20 6227 7262 2729 3a0a 2020  b'r', b'rb'):.  
-0000c850: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000c860: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
-0000c870: 2069 6620 7061 7468 2e73 7461 7274 7377   if path.startsw
-0000c880: 6974 6828 7265 706f 2e70 6174 6829 3a0a  ith(repo.path):.
-0000c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8a0: 2320 7472 756e 6361 7465 206e 616d 6520  # truncate name 
-0000c8b0: 7265 6c61 7469 7665 2074 6f20 7468 6520  relative to the 
-0000c8c0: 7265 706f 7369 746f 7279 2028 2e68 6729  repository (.hg)
-0000c8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c8e0: 2070 6174 6820 3d20 7061 7468 5b6c 656e   path = path[len
-0000c8f0: 2872 6570 6f2e 7061 7468 2920 2b20 3120  (repo.path) + 1 
-0000c900: 3a5d 0a20 2020 2020 2020 2020 2020 2069  :].            i
-0000c910: 6620 7061 7468 2e73 7461 7274 7377 6974  f path.startswit
-0000c920: 6828 6227 6361 6368 652f 2729 3a0a 2020  h(b'cache/'):.  
-0000c930: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-0000c940: 6720 3d20 6227 6163 6365 7373 696e 6720  g = b'accessing 
-0000c950: 6361 6368 6520 7769 7468 2076 6673 2069  cache with vfs i
-0000c960: 6e73 7465 6164 206f 6620 6361 6368 6576  nstead of cachev
-0000c970: 6673 3a20 2225 7322 270a 2020 2020 2020  fs: "%s"'.      
-0000c980: 2020 2020 2020 2020 2020 7265 706f 2e75            repo.u
-0000c990: 692e 6465 7665 6c77 6172 6e28 6d73 6720  i.develwarn(msg 
-0000c9a0: 2520 7061 7468 2c20 7374 6163 6b6c 6576  % path, stacklev
-0000c9b0: 656c 3d33 2c20 636f 6e66 6967 3d62 2263  el=3, config=b"c
-0000c9c0: 6163 6865 2d76 6673 2229 0a20 2020 2020  ache-vfs").     
-0000c9d0: 2020 2020 2020 2023 2070 6174 6820 7072         # path pr
-0000c9e0: 6566 6978 6573 2063 6f76 6572 6564 2062  efixes covered b
-0000c9f0: 7920 276c 6f63 6b27 0a20 2020 2020 2020  y 'lock'.       
-0000ca00: 2020 2020 2076 6673 5f70 6174 685f 7072       vfs_path_pr
-0000ca10: 6566 6978 6573 203d 2028 0a20 2020 2020  efixes = (.     
-0000ca20: 2020 2020 2020 2020 2020 2062 276a 6f75             b'jou
-0000ca30: 726e 616c 2e27 2c0a 2020 2020 2020 2020  rnal.',.        
-0000ca40: 2020 2020 2020 2020 6227 756e 646f 2e27          b'undo.'
-0000ca50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000ca60: 2020 6227 7374 7269 702d 6261 636b 7570    b'strip-backup
-0000ca70: 2f27 2c0a 2020 2020 2020 2020 2020 2020  /',.            
-0000ca80: 2020 2020 6227 6361 6368 652f 272c 0a20      b'cache/',. 
-0000ca90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000caa0: 2020 2020 2020 2020 2069 6620 616e 7928           if any(
-0000cab0: 7061 7468 2e73 7461 7274 7377 6974 6828  path.startswith(
-0000cac0: 7072 6566 6978 2920 666f 7220 7072 6566  prefix) for pref
-0000cad0: 6978 2069 6e20 7666 735f 7061 7468 5f70  ix in vfs_path_p
-0000cae0: 7265 6669 7865 7329 3a0a 2020 2020 2020  refixes):.      
-0000caf0: 2020 2020 2020 2020 2020 6966 2072 6570            if rep
-0000cb00: 6f2e 5f63 7572 7265 6e74 6c6f 636b 2872  o._currentlock(r
-0000cb10: 6570 6f2e 5f6c 6f63 6b72 6566 2920 6973  epo._lockref) is
-0000cb20: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000cb30: 2020 2020 2020 2020 2020 2072 6570 6f2e             repo.
-0000cb40: 7569 2e64 6576 656c 7761 726e 280a 2020  ui.develwarn(.  
-0000cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb60: 2020 2020 2020 6227 7772 6974 6520 7769        b'write wi
-0000cb70: 7468 206e 6f20 6c6f 636b 3a20 2225 7322  th no lock: "%s"
-0000cb80: 2720 2520 7061 7468 2c0a 2020 2020 2020  ' % path,.      
-0000cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cba0: 2020 7374 6163 6b6c 6576 656c 3d33 2c0a    stacklevel=3,.
-0000cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbc0: 2020 2020 2020 2020 636f 6e66 6967 3d62          config=b
-0000cbd0: 2763 6865 636b 2d6c 6f63 6b73 272c 0a20  'check-locks',. 
-0000cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbf0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000cc00: 2065 6c69 6620 7265 706f 2e5f 6375 7272   elif repo._curr
-0000cc10: 656e 746c 6f63 6b28 7265 706f 2e5f 776c  entlock(repo._wl
-0000cc20: 6f63 6b72 6566 2920 6973 204e 6f6e 653a  ockref) is None:
-0000cc30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cc40: 2023 2072 6573 7420 6f66 2076 6673 2066   # rest of vfs f
-0000cc50: 696c 6573 2061 7265 2063 6f76 6572 6564  iles are covered
-0000cc60: 2062 7920 2777 6c6f 636b 270a 2020 2020   by 'wlock'.    
-0000cc70: 2020 2020 2020 2020 2020 2020 230a 2020              #.  
-0000cc80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000cc90: 6578 636c 7564 6520 7370 6563 6961 6c20  exclude special 
-0000cca0: 6669 6c65 730a 2020 2020 2020 2020 2020  files.          
-0000ccb0: 2020 2020 2020 666f 7220 7072 6566 6978        for prefix
-0000ccc0: 2069 6e20 7365 6c66 2e5f 776c 6f63 6b66   in self._wlockf
-0000ccd0: 7265 6570 7265 6669 783a 0a20 2020 2020  reeprefix:.     
-0000cce0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000ccf0: 6620 7061 7468 2e73 7461 7274 7377 6974  f path.startswit
-0000cd00: 6828 7072 6566 6978 293a 0a20 2020 2020  h(prefix):.     
-0000cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd20: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-0000cd30: 2020 2020 2020 2020 2020 7265 706f 2e75            repo.u
-0000cd40: 692e 6465 7665 6c77 6172 6e28 0a20 2020  i.develwarn(.   
-0000cd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd60: 2062 2777 7269 7465 2077 6974 6820 6e6f   b'write with no
-0000cd70: 2077 6c6f 636b 3a20 2225 7322 2720 2520   wlock: "%s"' % 
-0000cd80: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
-0000cd90: 2020 2020 2020 2020 2020 7374 6163 6b6c            stackl
-0000cda0: 6576 656c 3d33 2c0a 2020 2020 2020 2020  evel=3,.        
-0000cdb0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-0000cdc0: 6967 3d62 2763 6865 636b 2d6c 6f63 6b73  ig=b'check-locks
-0000cdd0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0000cde0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000cdf0: 2072 6574 7572 6e20 7265 740a 0a20 2020   return ret..   
-0000ce00: 2020 2020 2072 6574 7572 6e20 6368 6563       return chec
-0000ce10: 6b76 6673 0a0a 2020 2020 6465 6620 5f67  kvfs..    def _g
-0000ce20: 6574 7376 6673 7761 7264 2873 656c 662c  etsvfsward(self,
-0000ce30: 206f 7269 6766 756e 6329 3a0a 2020 2020   origfunc):.    
-0000ce40: 2020 2020 2222 2262 7569 6c64 2061 2077      """build a w
-0000ce50: 6172 6420 666f 7220 7365 6c66 2e73 7666  ard for self.svf
-0000ce60: 7322 2222 0a20 2020 2020 2020 2072 7265  s""".        rre
-0000ce70: 6620 3d20 7765 616b 7265 662e 7265 6628  f = weakref.ref(
-0000ce80: 7365 6c66 290a 0a20 2020 2020 2020 2064  self)..        d
-0000ce90: 6566 2063 6865 636b 7376 6673 2870 6174  ef checksvfs(pat
-0000cea0: 682c 206d 6f64 653d 4e6f 6e65 293a 0a20  h, mode=None):. 
-0000ceb0: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
-0000cec0: 206f 7269 6766 756e 6328 7061 7468 2c20   origfunc(path, 
-0000ced0: 6d6f 6465 3d6d 6f64 6529 0a20 2020 2020  mode=mode).     
-0000cee0: 2020 2020 2020 2072 6570 6f20 3d20 7272         repo = rr
-0000cef0: 6566 2829 0a20 2020 2020 2020 2020 2020  ef().           
-0000cf00: 2069 6620 7265 706f 2069 7320 4e6f 6e65   if repo is None
-0000cf10: 206f 7220 6e6f 7420 7574 696c 2e73 6166   or not util.saf
-0000cf20: 6568 6173 6174 7472 2872 6570 6f2c 2062  ehasattr(repo, b
-0000cf30: 275f 6c6f 636b 7265 6627 293a 0a20 2020  '_lockref'):.   
-0000cf40: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000cf50: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
-0000cf60: 6966 206d 6f64 6520 696e 2028 4e6f 6e65  if mode in (None
-0000cf70: 2c20 6227 7227 2c20 6227 7262 2729 3a0a  , b'r', b'rb'):.
-0000cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf90: 7265 7475 726e 0a20 2020 2020 2020 2020  return.         
-0000cfa0: 2020 2069 6620 7061 7468 2e73 7461 7274     if path.start
-0000cfb0: 7377 6974 6828 7265 706f 2e73 6861 7265  swith(repo.share
-0000cfc0: 6470 6174 6829 3a0a 2020 2020 2020 2020  dpath):.        
-0000cfd0: 2020 2020 2020 2020 2320 7472 756e 6361          # trunca
-0000cfe0: 7465 206e 616d 6520 7265 6c61 7469 7665  te name relative
-0000cff0: 2074 6f20 7468 6520 7265 706f 7369 746f   to the reposito
-0000d000: 7279 2028 2e68 6729 0a20 2020 2020 2020  ry (.hg).       
-0000d010: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
-0000d020: 7061 7468 5b6c 656e 2872 6570 6f2e 7368  path[len(repo.sh
-0000d030: 6172 6564 7061 7468 2920 2b20 3120 3a5d  aredpath) + 1 :]
-0000d040: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d050: 7265 706f 2e5f 6375 7272 656e 746c 6f63  repo._currentloc
-0000d060: 6b28 7265 706f 2e5f 6c6f 636b 7265 6629  k(repo._lockref)
-0000d070: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000d080: 2020 2020 2020 2020 2020 7265 706f 2e75            repo.u
-0000d090: 692e 6465 7665 6c77 6172 6e28 0a20 2020  i.develwarn(.   
-0000d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0b0: 2062 2777 7269 7465 2077 6974 6820 6e6f   b'write with no
-0000d0c0: 206c 6f63 6b3a 2022 2573 2227 2025 2070   lock: "%s"' % p
-0000d0d0: 6174 682c 2073 7461 636b 6c65 7665 6c3d  ath, stacklevel=
-0000d0e0: 340a 2020 2020 2020 2020 2020 2020 2020  4.              
-0000d0f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000d100: 7265 7475 726e 2072 6574 0a0a 2020 2020  return ret..    
-0000d110: 2020 2020 7265 7475 726e 2063 6865 636b      return check
-0000d120: 7376 6673 0a0a 2020 2020 6465 6620 636c  svfs..    def cl
-0000d130: 6f73 6528 7365 6c66 293a 0a20 2020 2020  ose(self):.     
-0000d140: 2020 2073 656c 662e 5f77 7269 7465 6361     self._writeca
-0000d150: 6368 6573 2829 0a0a 2020 2020 6465 6620  ches()..    def 
-0000d160: 5f77 7269 7465 6361 6368 6573 2873 656c  _writecaches(sel
-0000d170: 6629 3a0a 2020 2020 2020 2020 6966 2073  f):.        if s
-0000d180: 656c 662e 5f72 6576 6272 616e 6368 6361  elf._revbranchca
-0000d190: 6368 653a 0a20 2020 2020 2020 2020 2020  che:.           
-0000d1a0: 2073 656c 662e 5f72 6576 6272 616e 6368   self._revbranch
-0000d1b0: 6361 6368 652e 7772 6974 6528 290a 0a20  cache.write().. 
-0000d1c0: 2020 2064 6566 205f 7265 7374 7269 6374     def _restrict
-0000d1d0: 6361 7061 6269 6c69 7469 6573 2873 656c  capabilities(sel
-0000d1e0: 662c 2063 6170 7329 3a0a 2020 2020 2020  f, caps):.      
-0000d1f0: 2020 6966 2073 656c 662e 7569 2e63 6f6e    if self.ui.con
-0000d200: 6669 6762 6f6f 6c28 6227 6578 7065 7269  figbool(b'experi
-0000d210: 6d65 6e74 616c 272c 2062 2762 756e 646c  mental', b'bundl
-0000d220: 6532 2d61 6476 6572 7469 7365 2729 3a0a  e2-advertise'):.
-0000d230: 2020 2020 2020 2020 2020 2020 6361 7073              caps
-0000d240: 203d 2073 6574 2863 6170 7329 0a20 2020   = set(caps).   
-0000d250: 2020 2020 2020 2020 2063 6170 7362 6c6f           capsblo
-0000d260: 6220 3d20 6275 6e64 6c65 322e 656e 636f  b = bundle2.enco
-0000d270: 6465 6361 7073 280a 2020 2020 2020 2020  decaps(.        
-0000d280: 2020 2020 2020 2020 6275 6e64 6c65 322e          bundle2.
-0000d290: 6765 7472 6570 6f63 6170 7328 7365 6c66  getrepocaps(self
-0000d2a0: 2c20 726f 6c65 3d62 2763 6c69 656e 7427  , role=b'client'
-0000d2b0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-0000d2c0: 2020 2020 2020 2020 2020 2020 6361 7073              caps
-0000d2d0: 2e61 6464 2862 2762 756e 646c 6532 3d27  .add(b'bundle2='
-0000d2e0: 202b 2075 726c 7265 712e 7175 6f74 6528   + urlreq.quote(
-0000d2f0: 6361 7073 626c 6f62 2929 0a20 2020 2020  capsblob)).     
-0000d300: 2020 2069 6620 7365 6c66 2e75 692e 636f     if self.ui.co
-0000d310: 6e66 6967 626f 6f6c 2862 2765 7870 6572  nfigbool(b'exper
-0000d320: 696d 656e 7461 6c27 2c20 6227 6e61 7272  imental', b'narr
-0000d330: 6f77 2729 3a0a 2020 2020 2020 2020 2020  ow'):.          
-0000d340: 2020 6361 7073 2e61 6464 2877 6972 6570    caps.add(wirep
-0000d350: 726f 746f 7479 7065 732e 4e41 5252 4f57  rototypes.NARROW
-0000d360: 4341 5029 0a20 2020 2020 2020 2072 6574  CAP).        ret
-0000d370: 7572 6e20 6361 7073 0a0a 2020 2020 2320  urn caps..    # 
-0000d380: 446f 6e27 7420 6361 6368 6520 6175 6469  Don't cache audi
-0000d390: 746f 722f 6e6f 6673 6175 6469 746f 722c  tor/nofsauditor,
-0000d3a0: 206f 7220 796f 7527 6c6c 2065 6e64 2075   or you'll end u
-0000d3b0: 7020 7769 7468 2072 6566 6572 656e 6365  p with reference
-0000d3c0: 2063 7963 6c65 3a0a 2020 2020 2320 7365   cycle:.    # se
-0000d3d0: 6c66 202d 3e20 6175 6469 746f 7220 2d3e  lf -> auditor ->
-0000d3e0: 2073 656c 662e 5f63 6865 636b 6e65 7374   self._checknest
-0000d3f0: 6564 202d 3e20 7365 6c66 0a0a 2020 2020  ed -> self..    
-0000d400: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-0000d410: 6620 6175 6469 746f 7228 7365 6c66 293a  f auditor(self):
-0000d420: 0a20 2020 2020 2020 2023 2054 6869 7320  .        # This 
-0000d430: 6973 206f 6e6c 7920 7573 6564 2062 7920  is only used by 
-0000d440: 636f 6e74 6578 742e 776f 726b 696e 6763  context.workingc
-0000d450: 7478 2e6d 6174 6368 2069 6e20 6f72 6465  tx.match in orde
-0000d460: 7220 746f 0a20 2020 2020 2020 2023 2064  r to.        # d
-0000d470: 6574 6563 7420 6669 6c65 7320 696e 2073  etect files in s
-0000d480: 7562 7265 706f 732e 0a20 2020 2020 2020  ubrepos..       
-0000d490: 2072 6574 7572 6e20 7061 7468 7574 696c   return pathutil
-0000d4a0: 2e70 6174 6861 7564 6974 6f72 2873 656c  .pathauditor(sel
-0000d4b0: 662e 726f 6f74 2c20 6361 6c6c 6261 636b  f.root, callback
-0000d4c0: 3d73 656c 662e 5f63 6865 636b 6e65 7374  =self._checknest
-0000d4d0: 6564 290a 0a20 2020 2040 7072 6f70 6572  ed)..    @proper
-0000d4e0: 7479 0a20 2020 2064 6566 206e 6f66 7361  ty.    def nofsa
-0000d4f0: 7564 6974 6f72 2873 656c 6629 3a0a 2020  uditor(self):.  
-0000d500: 2020 2020 2020 2320 5468 6973 2069 7320        # This is 
-0000d510: 6f6e 6c79 2075 7365 6420 6279 2063 6f6e  only used by con
-0000d520: 7465 7874 2e62 6173 6563 7478 2e6d 6174  text.basectx.mat
-0000d530: 6368 2069 6e20 6f72 6465 7220 746f 2064  ch in order to d
-0000d540: 6574 6563 740a 2020 2020 2020 2020 2320  etect.        # 
-0000d550: 6669 6c65 7320 696e 2073 7562 7265 706f  files in subrepo
-0000d560: 732e 0a20 2020 2020 2020 2072 6574 7572  s..        retur
-0000d570: 6e20 7061 7468 7574 696c 2e70 6174 6861  n pathutil.patha
-0000d580: 7564 6974 6f72 280a 2020 2020 2020 2020  uditor(.        
-0000d590: 2020 2020 7365 6c66 2e72 6f6f 742c 2063      self.root, c
-0000d5a0: 616c 6c62 6163 6b3d 7365 6c66 2e5f 6368  allback=self._ch
-0000d5b0: 6563 6b6e 6573 7465 642c 2072 6561 6c66  ecknested, realf
-0000d5c0: 733d 4661 6c73 652c 2063 6163 6865 643d  s=False, cached=
-0000d5d0: 5472 7565 0a20 2020 2020 2020 2029 0a0a  True.        )..
-0000d5e0: 2020 2020 6465 6620 5f63 6865 636b 6e65      def _checkne
-0000d5f0: 7374 6564 2873 656c 662c 2070 6174 6829  sted(self, path)
-0000d600: 3a0a 2020 2020 2020 2020 2222 2244 6574  :.        """Det
-0000d610: 6572 6d69 6e65 2069 6620 7061 7468 2069  ermine if path i
-0000d620: 7320 6120 6c65 6761 6c20 6e65 7374 6564  s a legal nested
-0000d630: 2072 6570 6f73 6974 6f72 792e 2222 220a   repository.""".
-0000d640: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
-0000d650: 6174 682e 7374 6172 7473 7769 7468 2873  ath.startswith(s
-0000d660: 656c 662e 726f 6f74 293a 0a20 2020 2020  elf.root):.     
-0000d670: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0000d680: 6c73 650a 2020 2020 2020 2020 7375 6270  lse.        subp
-0000d690: 6174 6820 3d20 7061 7468 5b6c 656e 2873  ath = path[len(s
-0000d6a0: 656c 662e 726f 6f74 2920 2b20 3120 3a5d  elf.root) + 1 :]
-0000d6b0: 0a20 2020 2020 2020 206e 6f72 6d73 7562  .        normsub
-0000d6c0: 7061 7468 203d 2075 7469 6c2e 7063 6f6e  path = util.pcon
-0000d6d0: 7665 7274 2873 7562 7061 7468 290a 0a20  vert(subpath).. 
-0000d6e0: 2020 2020 2020 2023 2058 5858 3a20 4368         # XXX: Ch
-0000d6f0: 6563 6b69 6e67 2061 6761 696e 7374 2074  ecking against t
-0000d700: 6865 2063 7572 7265 6e74 2077 6f72 6b69  he current worki
-0000d710: 6e67 2063 6f70 7920 6973 2077 726f 6e67  ng copy is wrong
-0000d720: 2069 6e0a 2020 2020 2020 2020 2320 7468   in.        # th
-0000d730: 6520 7365 6e73 6520 7468 6174 2069 7420  e sense that it 
-0000d740: 6361 6e20 7265 6a65 6374 2074 6869 6e67  can reject thing
-0000d750: 7320 6c69 6b65 0a20 2020 2020 2020 2023  s like.        #
-0000d760: 0a20 2020 2020 2020 2023 2020 2024 2068  .        #   $ h
-0000d770: 6720 6361 7420 2d72 2031 3020 7375 622f  g cat -r 10 sub/
-0000d780: 782e 7478 740a 2020 2020 2020 2020 230a  x.txt.        #.
-0000d790: 2020 2020 2020 2020 2320 6966 2073 7562          # if sub
-0000d7a0: 2f20 6973 206e 6f20 6c6f 6e67 6572 2061  / is no longer a
-0000d7b0: 2073 7562 7265 706f 7369 746f 7279 2069   subrepository i
-0000d7c0: 6e20 7468 6520 776f 726b 696e 6720 636f  n the working co
-0000d7d0: 7079 0a20 2020 2020 2020 2023 2070 6172  py.        # par
-0000d7e0: 656e 7420 7265 7669 7369 6f6e 2e0a 2020  ent revision..  
-0000d7f0: 2020 2020 2020 230a 2020 2020 2020 2020        #.        
-0000d800: 2320 486f 7765 7665 722c 2069 7420 6361  # However, it ca
-0000d810: 6e20 6f66 2063 6f75 7273 6520 616c 736f  n of course also
-0000d820: 2061 6c6c 6f77 2074 6869 6e67 7320 7468   allow things th
-0000d830: 6174 2077 6f75 6c64 2068 6176 650a 2020  at would have.  
-0000d840: 2020 2020 2020 2320 6265 656e 2072 656a        # been rej
-0000d850: 6563 7465 6420 6265 666f 7265 2c20 7375  ected before, su
-0000d860: 6368 2061 7320 7468 6520 6162 6f76 6520  ch as the above 
-0000d870: 6361 7420 636f 6d6d 616e 6420 6966 2073  cat command if s
-0000d880: 7562 2f0a 2020 2020 2020 2020 2320 6973  ub/.        # is
-0000d890: 2061 2073 7562 7265 706f 7369 746f 7279   a subrepository
-0000d8a0: 206e 6f77 2c20 6275 7420 7761 7320 6120   now, but was a 
-0000d8b0: 6e6f 726d 616c 2064 6972 6563 746f 7279  normal directory
-0000d8c0: 2062 6566 6f72 652e 0a20 2020 2020 2020   before..       
-0000d8d0: 2023 2054 6865 206f 6c64 2070 6174 6820   # The old path 
-0000d8e0: 6175 6469 746f 7220 776f 756c 6420 6861  auditor would ha
-0000d8f0: 7665 2072 656a 6563 7465 6420 6279 206d  ve rejected by m
-0000d900: 6973 7461 6b65 2073 696e 6365 2069 740a  istake since it.
-0000d910: 2020 2020 2020 2020 2320 7061 6e69 6373          # panics
-0000d920: 2077 6865 6e20 6974 2073 6565 7320 7375   when it sees su
-0000d930: 622f 2e68 672f 2e0a 2020 2020 2020 2020  b/.hg/..        
-0000d940: 230a 2020 2020 2020 2020 2320 416c 6c20  #.        # All 
-0000d950: 696e 2061 6c6c 2c20 6368 6563 6b69 6e67  in all, checking
-0000d960: 2061 6761 696e 7374 2074 6865 2077 6f72   against the wor
-0000d970: 6b69 6e67 2063 6f70 7920 7365 656d 7320  king copy seems 
-0000d980: 7365 6e73 6962 6c65 0a20 2020 2020 2020  sensible.       
-0000d990: 2023 2073 696e 6365 2077 6520 7761 6e74   # since we want
-0000d9a0: 2074 6f20 7072 6576 656e 7420 6163 6365   to prevent acce
-0000d9b0: 7373 2074 6f20 6e65 7374 6564 2072 6570  ss to nested rep
-0000d9c0: 6f73 6974 6f72 6965 7320 6f6e 0a20 2020  ositories on.   
-0000d9d0: 2020 2020 2023 2074 6865 2066 696c 6573       # the files
-0000d9e0: 7973 7465 6d20 2a6e 6f77 2a2e 0a20 2020  ystem *now*..   
-0000d9f0: 2020 2020 2063 7478 203d 2073 656c 665b       ctx = self[
-0000da00: 4e6f 6e65 5d0a 2020 2020 2020 2020 7061  None].        pa
-0000da10: 7274 7320 3d20 7574 696c 2e73 706c 6974  rts = util.split
-0000da20: 7061 7468 2873 7562 7061 7468 290a 2020  path(subpath).  
-0000da30: 2020 2020 2020 7768 696c 6520 7061 7274        while part
-0000da40: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-0000da50: 7265 6669 7820 3d20 6227 2f27 2e6a 6f69  refix = b'/'.joi
-0000da60: 6e28 7061 7274 7329 0a20 2020 2020 2020  n(parts).       
-0000da70: 2020 2020 2069 6620 7072 6566 6978 2069       if prefix i
-0000da80: 6e20 6374 782e 7375 6273 7461 7465 3a0a  n ctx.substate:.
-0000da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000daa0: 6966 2070 7265 6669 7820 3d3d 206e 6f72  if prefix == nor
-0000dab0: 6d73 7562 7061 7468 3a0a 2020 2020 2020  msubpath:.      
-0000dac0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000dad0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0000dae0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db00: 2020 2020 7375 6220 3d20 6374 782e 7375      sub = ctx.su
-0000db10: 6228 7072 6566 6978 290a 2020 2020 2020  b(prefix).      
-0000db20: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000db30: 7475 726e 2073 7562 2e63 6865 636b 6e65  turn sub.checkne
-0000db40: 7374 6564 2873 7562 7061 7468 5b6c 656e  sted(subpath[len
-0000db50: 2870 7265 6669 7829 202b 2031 203a 5d29  (prefix) + 1 :])
-0000db60: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000db70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000db80: 2020 2070 6172 7473 2e70 6f70 2829 0a20     parts.pop(). 
-0000db90: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0000dba0: 6c73 650a 0a20 2020 2064 6566 2070 6565  lse..    def pee
-0000dbb0: 7228 7365 6c66 2c20 7061 7468 3d4e 6f6e  r(self, path=Non
-0000dbc0: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
-0000dbd0: 726e 206c 6f63 616c 7065 6572 2873 656c  rn localpeer(sel
-0000dbe0: 662c 2070 6174 683d 7061 7468 2920 2023  f, path=path)  #
-0000dbf0: 206e 6f74 2063 6163 6865 6420 746f 2061   not cached to a
-0000dc00: 766f 6964 2072 6566 6572 656e 6365 2063  void reference c
-0000dc10: 7963 6c65 0a0a 2020 2020 6465 6620 756e  ycle..    def un
-0000dc20: 6669 6c74 6572 6564 2873 656c 6629 3a0a  filtered(self):.
-0000dc30: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-0000dc40: 6e20 756e 6669 6c74 6572 6564 2076 6572  n unfiltered ver
-0000dc50: 7369 6f6e 206f 6620 7468 6520 7265 706f  sion of the repo
-0000dc60: 7369 746f 7279 0a0a 2020 2020 2020 2020  sitory..        
-0000dc70: 496e 7465 6e64 6564 2074 6f20 6265 206f  Intended to be o
-0000dc80: 7665 7277 7269 7474 656e 2062 7920 6669  verwritten by fi
-0000dc90: 6c74 6572 6564 2072 6570 6f2e 2222 220a  ltered repo.""".
-0000dca0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000dcb0: 656c 660a 0a20 2020 2064 6566 2066 696c  elf..    def fil
-0000dcc0: 7465 7265 6428 7365 6c66 2c20 6e61 6d65  tered(self, name
-0000dcd0: 2c20 7669 7369 6269 6c69 7479 6578 6365  , visibilityexce
-0000dce0: 7074 696f 6e73 3d4e 6f6e 6529 3a0a 2020  ptions=None):.  
-0000dcf0: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
-0000dd00: 6120 6669 6c74 6572 6564 2076 6572 7369  a filtered versi
-0000dd10: 6f6e 206f 6620 6120 7265 706f 7369 746f  on of a reposito
-0000dd20: 7279 0a0a 2020 2020 2020 2020 5468 6520  ry..        The 
-0000dd30: 606e 616d 6560 2070 6172 616d 6574 6572  `name` parameter
-0000dd40: 2069 7320 7468 6520 6964 656e 7469 6669   is the identifi
-0000dd50: 6572 206f 6620 7468 6520 7265 7175 6573  er of the reques
-0000dd60: 7465 6420 7669 6577 2e20 5468 6973 0a20  ted view. This. 
-0000dd70: 2020 2020 2020 2077 696c 6c20 7265 7475         will retu
-0000dd80: 726e 2061 2072 6570 6f76 6965 7720 6f62  rn a repoview ob
-0000dd90: 6a65 6374 2073 6574 2022 6578 6163 746c  ject set "exactl
-0000dda0: 7922 2074 6f20 7468 6520 7370 6563 6966  y" to the specif
-0000ddb0: 6965 6420 7669 6577 2e0a 0a20 2020 2020  ied view...     
-0000ddc0: 2020 2054 6869 7320 6675 6e63 7469 6f6e     This function
-0000ddd0: 2064 6f65 7320 6e6f 7420 6170 706c 7920   does not apply 
-0000dde0: 7265 6375 7273 6976 6520 6669 6c74 6572  recursive filter
-0000ddf0: 696e 6720 746f 2061 2072 6570 6f73 6974  ing to a reposit
-0000de00: 6f72 792e 2046 6f72 0a20 2020 2020 2020  ory. For.       
-0000de10: 2065 7861 6d70 6c65 2063 616c 6c69 6e67   example calling
-0000de20: 2060 7265 706f 2e66 696c 7465 7265 6428   `repo.filtered(
-0000de30: 2273 6572 7665 6422 2960 2077 696c 6c20  "served")` will 
-0000de40: 7265 7475 726e 2061 2072 6570 6f76 6965  return a repovie
-0000de50: 7720 7573 696e 670a 2020 2020 2020 2020  w using.        
-0000de60: 7468 6520 2273 6572 7665 6422 2076 6965  the "served" vie
-0000de70: 772c 2072 6567 6172 646c 6573 7320 6f66  w, regardless of
-0000de80: 2074 6865 2069 6e69 7469 616c 2076 6965   the initial vie
-0000de90: 7720 7573 6564 2062 7920 6072 6570 6f60  w used by `repo`
-0000dea0: 2e0a 0a20 2020 2020 2020 2049 6e20 6f74  ...        In ot
-0000deb0: 6865 7220 776f 7264 2c20 7468 6572 6520  her word, there 
-0000dec0: 6973 2061 6c77 6179 7320 6f6e 6c79 206f  is always only o
-0000ded0: 6e65 206c 6576 656c 206f 6620 6072 6570  ne level of `rep
-0000dee0: 6f76 6965 7760 2022 6669 6c74 6572 696e  oview` "filterin
-0000def0: 6722 2e0a 2020 2020 2020 2020 2222 220a  g"..        """.
-0000df00: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000df10: 5f65 7874 7261 6669 6c74 6572 6964 2069  _extrafilterid i
-0000df20: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2062  s not None and b
-0000df30: 2725 2720 6e6f 7420 696e 206e 616d 653a  '%' not in name:
-0000df40: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
-0000df50: 6520 3d20 6e61 6d65 202b 2062 2725 2720  e = name + b'%' 
-0000df60: 2b20 7365 6c66 2e5f 6578 7472 6166 696c  + self._extrafil
-0000df70: 7465 7269 640a 0a20 2020 2020 2020 2063  terid..        c
-0000df80: 6c73 203d 2072 6570 6f76 6965 772e 6e65  ls = repoview.ne
-0000df90: 7774 7970 6528 7365 6c66 2e75 6e66 696c  wtype(self.unfil
-0000dfa0: 7465 7265 6428 292e 5f5f 636c 6173 735f  tered().__class_
-0000dfb0: 5f29 0a20 2020 2020 2020 2072 6574 7572  _).        retur
-0000dfc0: 6e20 636c 7328 7365 6c66 2c20 6e61 6d65  n cls(self, name
-0000dfd0: 2c20 7669 7369 6269 6c69 7479 6578 6365  , visibilityexce
-0000dfe0: 7074 696f 6e73 290a 0a20 2020 2040 6d69  ptions)..    @mi
-0000dff0: 7865 6472 6570 6f73 746f 7265 6361 6368  xedrepostorecach
-0000e000: 6528 0a20 2020 2020 2020 2028 6227 626f  e(.        (b'bo
-0000e010: 6f6b 6d61 726b 7327 2c20 6227 706c 6169  okmarks', b'plai
-0000e020: 6e27 292c 0a20 2020 2020 2020 2028 6227  n'),.        (b'
-0000e030: 626f 6f6b 6d61 726b 732e 6375 7272 656e  bookmarks.curren
-0000e040: 7427 2c20 6227 706c 6169 6e27 292c 0a20  t', b'plain'),. 
-0000e050: 2020 2020 2020 2028 6227 626f 6f6b 6d61         (b'bookma
-0000e060: 726b 7327 2c20 6227 2729 2c0a 2020 2020  rks', b''),.    
-0000e070: 2020 2020 2862 2730 3063 6861 6e67 656c      (b'00changel
-0000e080: 6f67 2e69 272c 2062 2727 292c 0a20 2020  og.i', b''),.   
-0000e090: 2029 0a20 2020 2064 6566 205f 626f 6f6b   ).    def _book
-0000e0a0: 6d61 726b 7328 7365 6c66 293a 0a20 2020  marks(self):.   
-0000e0b0: 2020 2020 2023 2053 696e 6365 2074 6865       # Since the
-0000e0c0: 206d 756c 7469 706c 6520 6669 6c65 7320   multiple files 
-0000e0d0: 696e 766f 6c76 6564 2069 6e20 7468 6520  involved in the 
-0000e0e0: 7472 616e 7361 6374 696f 6e20 6361 6e6e  transaction cann
-0000e0f0: 6f74 2062 650a 2020 2020 2020 2020 2320  ot be.        # 
-0000e100: 7772 6974 7465 6e20 6174 6f6d 6963 616c  written atomical
-0000e110: 6c79 2028 7769 7468 2063 7572 7265 6e74  ly (with current
-0000e120: 2072 6570 6f73 6974 6f72 7920 666f 726d   repository form
-0000e130: 6174 292c 2074 6865 7265 2069 7320 6120  at), there is a 
-0000e140: 7261 6365 0a20 2020 2020 2020 2023 2063  race.        # c
-0000e150: 6f6e 6469 7469 6f6e 2068 6572 652e 0a20  ondition here.. 
-0000e160: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
-0000e170: 2023 2031 2920 6368 616e 6765 6c6f 6720   # 1) changelog 
-0000e180: 636f 6e74 656e 7420 4120 6973 2072 6561  content A is rea
-0000e190: 640a 2020 2020 2020 2020 2320 3229 206f  d.        # 2) o
-0000e1a0: 7574 7369 6465 2074 7261 6e73 6163 7469  utside transacti
-0000e1b0: 6f6e 2075 7064 6174 6520 6368 616e 6765  on update change
-0000e1c0: 6c6f 6720 746f 2063 6f6e 7465 6e74 2042  log to content B
-0000e1d0: 0a20 2020 2020 2020 2023 2033 2920 6f75  .        # 3) ou
-0000e1e0: 7473 6964 6520 7472 616e 7361 6374 696f  tside transactio
-0000e1f0: 6e20 7570 6461 7465 2062 6f6f 6b6d 6172  n update bookmar
-0000e200: 6b20 6669 6c65 2072 6566 6572 7269 6e67  k file referring
-0000e210: 2074 6f20 636f 6e74 656e 7420 420a 2020   to content B.  
-0000e220: 2020 2020 2020 2320 3429 2062 6f6f 6b6d        # 4) bookm
-0000e230: 6172 6b73 2066 696c 6520 636f 6e74 656e  arks file conten
-0000e240: 7420 6973 2072 6561 6420 616e 6420 6669  t is read and fi
-0000e250: 6c74 6572 6564 2061 6761 696e 7374 2063  ltered against c
-0000e260: 6861 6e67 656c 6f67 2d41 0a20 2020 2020  hangelog-A.     
-0000e270: 2020 2023 0a20 2020 2020 2020 2023 2057     #.        # W
-0000e280: 6865 6e20 7468 6973 2068 6170 7065 6e73  hen this happens
-0000e290: 2c20 626f 6f6b 6d61 726b 7320 6167 6169  , bookmarks agai
-0000e2a0: 6e73 7420 6e6f 6465 7320 6d69 7373 696e  nst nodes missin
-0000e2b0: 6720 6672 6f6d 2041 2061 7265 2064 726f  g from A are dro
-0000e2c0: 7070 6564 2e0a 2020 2020 2020 2020 230a  pped..        #.
-0000e2d0: 2020 2020 2020 2020 2320 4861 7669 6e67          # Having
-0000e2e0: 2074 6869 7320 6861 7070 656e 696e 6720   this happening 
-0000e2f0: 6475 7269 6e67 2072 6561 6420 6973 206e  during read is n
-0000e300: 6f74 2067 7265 6174 2c20 6275 7420 6974  ot great, but it
-0000e310: 2062 6563 6f6d 6520 776f 7273 650a 2020   become worse.  
-0000e320: 2020 2020 2020 2320 7768 656e 2074 6869        # when thi
-0000e330: 7320 6861 7070 656e 2064 7572 696e 6720  s happen during 
-0000e340: 7772 6974 6520 6265 6361 7573 6520 7468  write because th
-0000e350: 6520 626f 6f6b 6d61 726b 7320 746f 2074  e bookmarks to t
-0000e360: 6865 2022 756e 6b6e 6f77 6e22 0a20 2020  he "unknown".   
-0000e370: 2020 2020 2023 206e 6f64 6573 2077 696c       # nodes wil
-0000e380: 6c20 6265 2064 726f 7070 6564 2066 6f72  l be dropped for
-0000e390: 2067 6f6f 642e 2048 6f77 6576 6572 2c20   good. However, 
-0000e3a0: 7772 6974 6573 2068 6170 7065 6e20 7769  writes happen wi
-0000e3b0: 7468 696e 206c 6f63 6b73 2e0a 2020 2020  thin locks..    
-0000e3c0: 2020 2020 2320 5468 6973 206c 6f63 6b69      # This locki
-0000e3d0: 6e67 206d 616b 6573 2069 7420 706f 7373  ng makes it poss
-0000e3e0: 6962 6c65 2074 6f20 6861 7665 2061 2072  ible to have a r
-0000e3f0: 6163 6520 6672 6565 2063 6f6e 7369 7374  ace free consist
-0000e400: 656e 7420 7265 6164 2e0a 2020 2020 2020  ent read..      
-0000e410: 2020 2320 466f 7220 7468 6973 2070 7572    # For this pur
-0000e420: 706f 7365 2064 6174 6120 7265 6164 2066  pose data read f
-0000e430: 726f 6d20 6469 7363 2062 6566 6f72 6520  rom disc before 
-0000e440: 6c6f 636b 696e 6720 2061 7265 0a20 2020  locking  are.   
-0000e450: 2020 2020 2023 2022 696e 7661 6c69 6461       # "invalida
-0000e460: 7465 6422 2072 6967 6874 2061 6674 6572  ted" right after
-0000e470: 2074 6865 206c 6f63 6b73 2061 7265 2074   the locks are t
-0000e480: 616b 656e 2e20 5468 6973 2069 6e76 616c  aken. This inval
-0000e490: 6964 6174 696f 6e73 2061 7265 0a20 2020  idations are.   
-0000e4a0: 2020 2020 2023 2022 6c69 6768 7422 2c20       # "light", 
-0000e4b0: 7468 6520 6066 696c 6563 6163 6865 6020  the `filecache` 
-0000e4c0: 6d65 6368 616e 6973 6d20 6b65 6570 2074  mechanism keep t
-0000e4d0: 6865 2064 6174 6120 696e 206d 656d 6f72  he data in memor
-0000e4e0: 7920 616e 6420 7769 6c6c 0a20 2020 2020  y and will.     
-0000e4f0: 2020 2023 2072 6575 7365 2074 6865 6d20     # reuse them 
-0000e500: 6966 2074 6865 2075 6e64 6572 6c79 696e  if the underlyin
-0000e510: 6720 6669 6c65 7320 6469 6420 6e6f 7420  g files did not 
-0000e520: 6368 616e 6765 642e 204e 6f74 2070 6172  changed. Not par
-0000e530: 7369 6e67 2074 6865 0a20 2020 2020 2020  sing the.       
-0000e540: 2023 2073 616d 6520 6461 7461 206d 756c   # same data mul
-0000e550: 7469 706c 6520 7469 6d65 7320 6865 6c70  tiple times help
-0000e560: 7320 7065 7266 6f72 6d61 6e63 6573 2e0a  s performances..
-0000e570: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
-0000e580: 2020 2320 556e 666f 7274 756e 6174 656c    # Unfortunatel
-0000e590: 7920 696e 2074 6865 2063 6173 6520 6465  y in the case de
-0000e5a0: 7363 7269 6265 2061 626f 7665 2c20 7468  scribe above, th
-0000e5b0: 6520 6669 6c65 7320 7472 6163 6b65 6420  e files tracked 
-0000e5c0: 6279 2074 6865 0a20 2020 2020 2020 2023  by the.        #
-0000e5d0: 2062 6f6f 6b6d 6172 6b73 2066 696c 6520   bookmarks file 
-0000e5e0: 6361 6368 6520 6d69 6768 7420 6e6f 7420  cache might not 
-0000e5f0: 6861 7665 2063 6861 6e67 6564 2c20 6275  have changed, bu
-0000e600: 7420 7468 6520 696e 2d6d 656d 6f72 790a  t the in-memory.
-0000e610: 2020 2020 2020 2020 2320 636f 6e74 656e          # conten
-0000e620: 7420 6973 2073 7469 6c6c 2022 7772 6f6e  t is still "wron
-0000e630: 6722 2062 6563 6175 7365 2077 6520 7573  g" because we us
-0000e640: 6564 2061 6e20 6f6c 6465 7220 6368 616e  ed an older chan
-0000e650: 6765 6c6f 6720 636f 6e74 656e 740a 2020  gelog content.  
-0000e660: 2020 2020 2020 2320 746f 2070 726f 6365        # to proce
-0000e670: 7373 2074 6865 206f 6e2d 6469 736b 2064  ss the on-disk d
-0000e680: 6174 612e 2053 6f20 6166 7465 7220 6c6f  ata. So after lo
-0000e690: 636b 696e 672c 2074 6865 2063 6861 6e67  cking, the chang
-0000e6a0: 656c 6f67 2077 6f75 6c64 2062 650a 2020  elog would be.  
-0000e6b0: 2020 2020 2020 2320 7265 6672 6573 6865        # refreshe
-0000e6c0: 6420 6275 7420 605f 626f 6f6b 6d61 726b  d but `_bookmark
-0000e6d0: 7360 2077 6f75 6c64 2062 6520 7072 6573  s` would be pres
-0000e6e0: 6572 7665 642e 0a20 2020 2020 2020 2023  erved..        #
-0000e6f0: 2041 6464 696e 6720 6030 3063 6861 6e67   Adding `00chang
-0000e700: 656c 6f67 2e69 6020 746f 2074 6865 206c  elog.i` to the l
-0000e710: 6973 7420 6f66 2074 7261 636b 6564 2066  ist of tracked f
-0000e720: 696c 6520 6973 206e 6f74 0a20 2020 2020  ile is not.     
-0000e730: 2020 2023 2065 6e6f 7567 682c 2062 6563     # enough, bec
-0000e740: 6175 7365 2061 7420 7468 6520 7469 6d65  ause at the time
-0000e750: 2077 6520 6275 696c 6420 7468 6520 636f   we build the co
-0000e760: 6e74 656e 7420 666f 7220 605f 626f 6f6b  ntent for `_book
-0000e770: 6d61 726b 7360 2069 6e0a 2020 2020 2020  marks` in.      
-0000e780: 2020 2320 2834 292c 2074 6865 2063 6861    # (4), the cha
-0000e790: 6e67 656c 6f67 2066 696c 6520 6861 7320  ngelog file has 
-0000e7a0: 616c 7265 6164 7920 6469 7665 7267 6564  already diverged
-0000e7b0: 2066 726f 6d20 7468 6520 636f 6e74 656e   from the conten
-0000e7c0: 7420 7573 6564 0a20 2020 2020 2020 2023  t used.        #
-0000e7d0: 2066 6f72 206c 6f61 6469 6e67 2060 6368   for loading `ch
-0000e7e0: 616e 6765 6c6f 6760 2069 6e20 2831 290a  angelog` in (1).
-0000e7f0: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
-0000e800: 2020 2320 546f 2070 7265 7665 6e74 2074    # To prevent t
-0000e810: 6865 2069 7373 7565 2c20 7765 2066 6f72  he issue, we for
-0000e820: 6365 2074 6865 2063 6861 6e67 656c 6f67  ce the changelog
-0000e830: 2074 6f20 6265 2065 7870 6c69 6369 746c   to be explicitl
-0000e840: 790a 2020 2020 2020 2020 2320 7265 6c6f  y.        # relo
-0000e850: 6164 6564 2077 6869 6c65 2063 6f6d 7075  aded while compu
-0000e860: 7469 6e67 2060 5f62 6f6f 6b6d 6172 6b73  ting `_bookmarks
-0000e870: 602e 2054 6865 2064 6174 6120 7261 6365  `. The data race
-0000e880: 2063 616e 2073 7469 6c6c 2068 6170 7065   can still happe
-0000e890: 6e0a 2020 2020 2020 2020 2320 7769 7468  n.        # with
-0000e8a0: 6f75 7420 7468 6520 6c6f 636b 2028 7769  out the lock (wi
-0000e8b0: 7468 2061 206e 6172 726f 7765 7220 7769  th a narrower wi
-0000e8c0: 6e64 6f77 292c 2062 7574 2069 7420 776f  ndow), but it wo
-0000e8d0: 756c 6420 6e6f 206c 6f6e 6765 7220 676f  uld no longer go
-0000e8e0: 0a20 2020 2020 2020 2023 2075 6e64 6574  .        # undet
-0000e8f0: 6563 7465 6420 6475 7269 6e67 2074 6865  ected during the
-0000e900: 206c 6f63 6b20 7469 6d65 2072 6566 7265   lock time refre
-0000e910: 7368 2e0a 2020 2020 2020 2020 230a 2020  sh..        #.  
-0000e920: 2020 2020 2020 2320 5468 6520 6e65 7720        # The new 
-0000e930: 7363 6865 6475 6c65 2069 7320 6173 2066  schedule is as f
-0000e940: 6f6c 6c6f 770a 2020 2020 2020 2020 230a  ollow.        #.
-0000e950: 2020 2020 2020 2020 2320 3129 2066 696c          # 1) fil
-0000e960: 6563 6163 6865 206c 6f67 6963 2064 6574  ecache logic det
-0000e970: 6563 7420 7468 6174 2060 5f62 6f6f 6b6d  ect that `_bookm
-0000e980: 6172 6b73 6020 6e65 6564 7320 746f 2062  arks` needs to b
-0000e990: 6520 636f 6d70 7574 6564 0a20 2020 2020  e computed.     
-0000e9a0: 2020 2023 2032 2920 6361 6368 6573 7461     # 2) cachesta
-0000e9b0: 7420 666f 7220 6062 6f6f 6b6d 6172 6b73  t for `bookmarks
-0000e9c0: 6020 616e 6420 6063 6861 6e67 656c 6f67  ` and `changelog
-0000e9d0: 6020 6172 6520 6361 7074 7572 6564 2028  ` are captured (
-0000e9e0: 666f 7220 626f 6f6b 290a 2020 2020 2020  for book).      
-0000e9f0: 2020 2320 3329 2057 6520 666f 7263 6520    # 3) We force 
-0000ea00: 6063 6861 6e67 656c 6f67 6020 6669 6c65  `changelog` file
-0000ea10: 6361 6368 6520 746f 2062 6520 7465 7374  cache to be test
-0000ea20: 6564 0a20 2020 2020 2020 2023 2034 2920  ed.        # 4) 
-0000ea30: 6361 6368 6573 7461 7420 666f 7220 6063  cachestat for `c
-0000ea40: 6861 6e67 656c 6f67 6020 6172 6520 6361  hangelog` are ca
-0000ea50: 7074 7572 6564 2028 666f 7220 6368 616e  ptured (for chan
-0000ea60: 6765 6c6f 6729 0a20 2020 2020 2020 2023  gelog).        #
-0000ea70: 2035 2920 605f 626f 6f6b 6d61 726b 7360   5) `_bookmarks`
-0000ea80: 2069 7320 636f 6d70 7574 6564 2061 6e64   is computed and
-0000ea90: 2063 6163 6865 640a 2020 2020 2020 2020   cached.        
-0000eaa0: 230a 2020 2020 2020 2020 2320 5468 6520  #.        # The 
-0000eab0: 7374 6570 2069 6e20 2833 2920 656e 7375  step in (3) ensu
-0000eac0: 7265 2077 6520 6861 7665 2061 2063 6861  re we have a cha
-0000ead0: 6e67 656c 6f67 2061 7420 6c65 6173 7420  ngelog at least 
-0000eae0: 6173 2072 6563 656e 7420 6173 2074 6865  as recent as the
-0000eaf0: 0a20 2020 2020 2020 2023 2063 6163 6865  .        # cache
-0000eb00: 2073 7461 7420 636f 6d70 7574 6564 2069   stat computed i
-0000eb10: 6e20 2831 292e 2041 7320 6120 7265 7375  n (1). As a resu
-0000eb20: 6c74 2061 7420 6c6f 636b 696e 6720 7469  lt at locking ti
-0000eb30: 6d65 3a0a 2020 2020 2020 2020 2320 202a  me:.        #  *
-0000eb40: 2069 6620 7468 6520 6368 616e 6765 6c6f   if the changelo
-0000eb50: 6720 6469 6420 6e6f 7420 6368 616e 6765  g did not change
-0000eb60: 6420 7369 6e63 6520 2831 2920 2d3e 2077  d since (1) -> w
-0000eb70: 6520 6361 6e20 7265 7573 6520 7468 6520  e can reuse the 
-0000eb80: 6461 7461 0a20 2020 2020 2020 2023 2020  data.        #  
-0000eb90: 2a20 6f74 6865 7277 6973 6520 2d3e 2074  * otherwise -> t
-0000eba0: 6865 2062 6f6f 6b6d 6172 6b73 2067 6574  he bookmarks get
-0000ebb0: 2072 6566 7265 7368 6564 2e0a 2020 2020   refreshed..    
-0000ebc0: 2020 2020 7365 6c66 2e5f 7265 6672 6573      self._refres
-0000ebd0: 6863 6861 6e67 656c 6f67 2829 0a20 2020  hchangelog().   
-0000ebe0: 2020 2020 2072 6574 7572 6e20 626f 6f6b       return book
-0000ebf0: 6d61 726b 732e 626d 7374 6f72 6528 7365  marks.bmstore(se
-0000ec00: 6c66 290a 0a20 2020 2064 6566 205f 7265  lf)..    def _re
-0000ec10: 6672 6573 6863 6861 6e67 656c 6f67 2873  freshchangelog(s
-0000ec20: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0000ec30: 226d 616b 6520 7375 7265 2074 6865 2069  "make sure the i
-0000ec40: 6e20 6d65 6d6f 7279 2063 6861 6e67 656c  n memory changel
-0000ec50: 6f67 206d 6174 6368 2074 6865 206f 6e2d  og match the on-
-0000ec60: 6469 736b 206f 6e65 2222 220a 2020 2020  disk one""".    
-0000ec70: 2020 2020 6966 2027 6368 616e 6765 6c6f      if 'changelo
-0000ec80: 6727 2069 6e20 7661 7273 2873 656c 6629  g' in vars(self)
-0000ec90: 2061 6e64 2073 656c 662e 6375 7272 656e   and self.curren
-0000eca0: 7474 7261 6e73 6163 7469 6f6e 2829 2069  ttransaction() i
-0000ecb0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0000ecc0: 2020 2020 6465 6c20 7365 6c66 2e63 6861      del self.cha
-0000ecd0: 6e67 656c 6f67 0a0a 2020 2020 4070 726f  ngelog..    @pro
-0000ece0: 7065 7274 790a 2020 2020 6465 6620 5f61  perty.    def _a
-0000ecf0: 6374 6976 6562 6f6f 6b6d 6172 6b28 7365  ctivebookmark(se
-0000ed00: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-0000ed10: 7572 6e20 7365 6c66 2e5f 626f 6f6b 6d61  urn self._bookma
-0000ed20: 726b 732e 6163 7469 7665 0a0a 2020 2020  rks.active..    
-0000ed30: 2320 5f70 6861 7365 7365 7473 2064 6570  # _phasesets dep
-0000ed40: 656e 6420 6f6e 2063 6861 6e67 656c 6f67  end on changelog
-0000ed50: 2e20 7768 6174 2077 6520 6e65 6564 2069  . what we need i
-0000ed60: 7320 746f 2063 616c 6c0a 2020 2020 2320  s to call.    # 
-0000ed70: 5f70 6861 7365 6361 6368 652e 696e 7661  _phasecache.inva
-0000ed80: 6c69 6461 7465 2829 2069 6620 2730 3063  lidate() if '00c
-0000ed90: 6861 6e67 656c 6f67 2e69 2720 7761 7320  hangelog.i' was 
-0000eda0: 6368 616e 6765 642c 2062 7574 2069 740a  changed, but it.
-0000edb0: 2020 2020 2320 6361 6e27 7420 6265 2065      # can't be e
-0000edc0: 6173 696c 7920 6578 7072 6573 7365 6420  asily expressed 
-0000edd0: 696e 2066 696c 6563 6163 6865 206d 6563  in filecache mec
-0000ede0: 6861 6e69 736d 2e0a 2020 2020 4073 746f  hanism..    @sto
-0000edf0: 7265 6361 6368 6528 6227 7068 6173 6572  recache(b'phaser
-0000ee00: 6f6f 7473 272c 2062 2730 3063 6861 6e67  oots', b'00chang
-0000ee10: 656c 6f67 2e69 2729 0a20 2020 2064 6566  elog.i').    def
-0000ee20: 205f 7068 6173 6563 6163 6865 2873 656c   _phasecache(sel
-0000ee30: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-0000ee40: 726e 2070 6861 7365 732e 7068 6173 6563  rn phases.phasec
-0000ee50: 6163 6865 2873 656c 662c 2073 656c 662e  ache(self, self.
-0000ee60: 5f70 6861 7365 6465 6661 756c 7473 290a  _phasedefaults).
-0000ee70: 0a20 2020 2040 7374 6f72 6563 6163 6865  .    @storecache
-0000ee80: 2862 276f 6273 7374 6f72 6527 290a 2020  (b'obsstore').  
-0000ee90: 2020 6465 6620 6f62 7373 746f 7265 2873    def obsstore(s
-0000eea0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-0000eeb0: 7475 726e 206f 6273 6f6c 6574 652e 6d61  turn obsolete.ma
-0000eec0: 6b65 7374 6f72 6528 7365 6c66 2e75 692c  kestore(self.ui,
-0000eed0: 2073 656c 6629 0a0a 2020 2020 4063 6861   self)..    @cha
-0000eee0: 6e67 656c 6f67 6361 6368 6528 290a 2020  ngelogcache().  
-0000eef0: 2020 6465 6620 6368 616e 6765 6c6f 6728    def changelog(
-0000ef00: 7265 706f 293a 0a20 2020 2020 2020 2023  repo):.        #
-0000ef10: 206c 6f61 6420 6469 7273 7461 7465 2062   load dirstate b
-0000ef20: 6566 6f72 6520 6368 616e 6765 6c6f 6720  efore changelog 
-0000ef30: 746f 2061 766f 6964 2072 6163 6520 7365  to avoid race se
-0000ef40: 6520 6973 7375 6536 3330 330a 2020 2020  e issue6303.    
-0000ef50: 2020 2020 7265 706f 2e64 6972 7374 6174      repo.dirstat
-0000ef60: 652e 7072 6566 6574 6368 5f70 6172 656e  e.prefetch_paren
-0000ef70: 7473 2829 0a20 2020 2020 2020 2072 6574  ts().        ret
-0000ef80: 7572 6e20 7265 706f 2e73 746f 7265 2e63  urn repo.store.c
-0000ef90: 6861 6e67 656c 6f67 280a 2020 2020 2020  hangelog(.      
-0000efa0: 2020 2020 2020 7478 6e75 7469 6c2e 6d61        txnutil.ma
-0000efb0: 7968 6176 6570 656e 6469 6e67 2872 6570  yhavepending(rep
-0000efc0: 6f2e 726f 6f74 292c 0a20 2020 2020 2020  o.root),.       
-0000efd0: 2020 2020 2063 6f6e 6375 7272 656e 6379       concurrency
-0000efe0: 6368 6563 6b65 723d 7265 766c 6f67 6368  checker=revlogch
-0000eff0: 6563 6b65 722e 6765 745f 6368 6563 6b65  ecker.get_checke
-0000f000: 7228 7265 706f 2e75 692c 2062 2763 6861  r(repo.ui, b'cha
-0000f010: 6e67 656c 6f67 2729 2c0a 2020 2020 2020  ngelog'),.      
-0000f020: 2020 290a 0a20 2020 2040 6d61 6e69 6665    )..    @manife
-0000f030: 7374 6c6f 6763 6163 6865 2829 0a20 2020  stlogcache().   
-0000f040: 2064 6566 206d 616e 6966 6573 746c 6f67   def manifestlog
-0000f050: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000f060: 7265 7475 726e 2073 656c 662e 7374 6f72  return self.stor
-0000f070: 652e 6d61 6e69 6665 7374 6c6f 6728 7365  e.manifestlog(se
-0000f080: 6c66 2c20 7365 6c66 2e5f 7374 6f72 656e  lf, self._storen
-0000f090: 6172 726f 776d 6174 6368 290a 0a20 2020  arrowmatch)..   
-0000f0a0: 2040 756e 6669 6c74 6572 6564 7072 6f70   @unfilteredprop
-0000f0b0: 6572 7479 6361 6368 650a 2020 2020 6465  ertycache.    de
-0000f0c0: 6620 6469 7273 7461 7465 2873 656c 6629  f dirstate(self)
-0000f0d0: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
-0000f0e0: 662e 5f64 6972 7374 6174 6520 6973 204e  f._dirstate is N
-0000f0f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000f100: 2073 656c 662e 5f64 6972 7374 6174 6520   self._dirstate 
-0000f110: 3d20 7365 6c66 2e5f 6d61 6b65 6469 7273  = self._makedirs
-0000f120: 7461 7465 2829 0a20 2020 2020 2020 2065  tate().        e
-0000f130: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000f140: 2073 656c 662e 5f64 6972 7374 6174 652e   self._dirstate.
-0000f150: 7265 6672 6573 6828 290a 2020 2020 2020  refresh().      
-0000f160: 2020 7265 7475 726e 2073 656c 662e 5f64    return self._d
-0000f170: 6972 7374 6174 650a 0a20 2020 2064 6566  irstate..    def
-0000f180: 205f 6d61 6b65 6469 7273 7461 7465 2873   _makedirstate(s
-0000f190: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0000f1a0: 2245 7874 656e 7369 6f6e 2070 6f69 6e74  "Extension point
-0000f1b0: 2066 6f72 2077 7261 7070 696e 6720 7468   for wrapping th
-0000f1c0: 6520 6469 7273 7461 7465 2070 6572 2d72  e dirstate per-r
-0000f1d0: 6570 6f2e 2222 220a 2020 2020 2020 2020  epo.""".        
-0000f1e0: 7370 6172 7365 6d61 7463 6866 6e20 3d20  sparsematchfn = 
-0000f1f0: 4e6f 6e65 0a20 2020 2020 2020 2069 6620  None.        if 
-0000f200: 7370 6172 7365 2e75 7365 5f73 7061 7273  sparse.use_spars
-0000f210: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0000f220: 2020 2020 2073 7061 7273 656d 6174 6368       sparsematch
-0000f230: 666e 203d 206c 616d 6264 613a 2073 7061  fn = lambda: spa
-0000f240: 7273 652e 6d61 7463 6865 7228 7365 6c66  rse.matcher(self
-0000f250: 290a 2020 2020 2020 2020 7632 5f72 6571  ).        v2_req
-0000f260: 203d 2072 6571 7569 7265 6d65 6e74 736d   = requirementsm
-0000f270: 6f64 2e44 4952 5354 4154 455f 5632 5f52  od.DIRSTATE_V2_R
-0000f280: 4551 5549 5245 4d45 4e54 0a20 2020 2020  EQUIREMENT.     
-0000f290: 2020 2074 6820 3d20 7265 7175 6972 656d     th = requirem
-0000f2a0: 656e 7473 6d6f 642e 4449 5253 5441 5445  entsmod.DIRSTATE
-0000f2b0: 5f54 5241 434b 4544 5f48 494e 545f 5631  _TRACKED_HINT_V1
-0000f2c0: 0a20 2020 2020 2020 2075 7365 5f64 6972  .        use_dir
-0000f2d0: 7374 6174 655f 7632 203d 2076 325f 7265  state_v2 = v2_re
-0000f2e0: 7120 696e 2073 656c 662e 7265 7175 6972  q in self.requir
-0000f2f0: 656d 656e 7473 0a20 2020 2020 2020 2075  ements.        u
-0000f300: 7365 5f74 7261 636b 6564 5f68 696e 7420  se_tracked_hint 
-0000f310: 3d20 7468 2069 6e20 7365 6c66 2e72 6571  = th in self.req
-0000f320: 7569 7265 6d65 6e74 730a 0a20 2020 2020  uirements..     
-0000f330: 2020 2072 6574 7572 6e20 6469 7273 7461     return dirsta
-0000f340: 7465 2e64 6972 7374 6174 6528 0a20 2020  te.dirstate(.   
-0000f350: 2020 2020 2020 2020 2073 656c 662e 7666           self.vf
-0000f360: 732c 0a20 2020 2020 2020 2020 2020 2073  s,.            s
-0000f370: 656c 662e 7569 2c0a 2020 2020 2020 2020  elf.ui,.        
-0000f380: 2020 2020 7365 6c66 2e72 6f6f 742c 0a20      self.root,. 
-0000f390: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000f3a0: 5f64 6972 7374 6174 6576 616c 6964 6174  _dirstatevalidat
-0000f3b0: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-0000f3c0: 7061 7273 656d 6174 6368 666e 2c0a 2020  parsematchfn,.  
-0000f3d0: 2020 2020 2020 2020 2020 7365 6c66 2e6e            self.n
-0000f3e0: 6f64 6563 6f6e 7374 616e 7473 2c0a 2020  odeconstants,.  
-0000f3f0: 2020 2020 2020 2020 2020 7573 655f 6469            use_di
-0000f400: 7273 7461 7465 5f76 322c 0a20 2020 2020  rstate_v2,.     
-0000f410: 2020 2020 2020 2075 7365 5f74 7261 636b         use_track
-0000f420: 6564 5f68 696e 743d 7573 655f 7472 6163  ed_hint=use_trac
-0000f430: 6b65 645f 6869 6e74 2c0a 2020 2020 2020  ked_hint,.      
-0000f440: 2020 290a 0a20 2020 2064 6566 205f 6469    )..    def _di
-0000f450: 7273 7461 7465 7661 6c69 6461 7465 2873  rstatevalidate(s
-0000f460: 656c 662c 206e 6f64 6529 3a0a 2020 2020  elf, node):.    
-0000f470: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000f480: 2020 2020 2073 656c 662e 6368 616e 6765       self.change
-0000f490: 6c6f 672e 7265 7628 6e6f 6465 290a 2020  log.rev(node).  
-0000f4a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000f4b0: 206e 6f64 650a 2020 2020 2020 2020 6578   node.        ex
-0000f4c0: 6365 7074 2065 7272 6f72 2e4c 6f6f 6b75  cept error.Looku
-0000f4d0: 7045 7272 6f72 3a0a 2020 2020 2020 2020  pError:.        
-0000f4e0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-0000f4f0: 5f64 6972 7374 6174 6576 616c 6964 6174  _dirstatevalidat
-0000f500: 6577 6172 6e65 643a 0a20 2020 2020 2020  ewarned:.       
-0000f510: 2020 2020 2020 2020 2073 656c 662e 5f64           self._d
-0000f520: 6972 7374 6174 6576 616c 6964 6174 6577  irstatevalidatew
-0000f530: 6172 6e65 6420 3d20 5472 7565 0a20 2020  arned = True.   
-0000f540: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000f550: 662e 7569 2e77 6172 6e28 0a20 2020 2020  f.ui.warn(.     
-0000f560: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-0000f570: 2862 2277 6172 6e69 6e67 3a20 6967 6e6f  (b"warning: igno
-0000f580: 7269 6e67 2075 6e6b 6e6f 776e 2077 6f72  ring unknown wor
-0000f590: 6b69 6e67 2070 6172 656e 7420 2573 215c  king parent %s!\
-0000f5a0: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-0000f5b0: 2020 2020 2020 2020 2520 7368 6f72 7428          % short(
-0000f5c0: 6e6f 6465 290a 2020 2020 2020 2020 2020  node).          
-0000f5d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000f5e0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000f5f0: 6e75 6c6c 6964 0a0a 2020 2020 4073 746f  nullid..    @sto
-0000f600: 7265 6361 6368 6528 6e61 7272 6f77 7370  recache(narrowsp
-0000f610: 6563 2e46 494c 454e 414d 4529 0a20 2020  ec.FILENAME).   
-0000f620: 2064 6566 206e 6172 726f 7770 6174 7328   def narrowpats(
-0000f630: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0000f640: 2222 6d61 7463 6865 7220 7061 7474 6572  ""matcher patter
-0000f650: 6e73 2066 6f72 2074 6869 7320 7265 706f  ns for this repo
-0000f660: 7369 746f 7279 2773 206e 6172 726f 7773  sitory's narrows
-0000f670: 7065 630a 0a20 2020 2020 2020 2041 2074  pec..        A t
-0000f680: 7570 6c65 206f 6620 2869 6e63 6c75 6465  uple of (include
-0000f690: 732c 2065 7863 6c75 6465 7329 2e0a 2020  s, excludes)..  
-0000f6a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000f6b0: 2020 2320 7468 6520 6e61 7272 6f77 206d    # the narrow m
-0000f6c0: 616e 6167 656d 656e 7420 7368 6f75 6c64  anagement should
-0000f6d0: 2070 726f 6261 626c 7920 6d6f 7665 2069   probably move i
-0000f6e0: 6e74 6f20 6974 7320 6f77 6e20 6f62 6a65  nto its own obje
-0000f6f0: 6374 0a20 2020 2020 2020 2076 616c 203d  ct.        val =
-0000f700: 2073 656c 662e 5f70 656e 6469 6e67 5f6e   self._pending_n
-0000f710: 6172 726f 775f 7061 7473 0a20 2020 2020  arrow_pats.     
-0000f720: 2020 2069 6620 7661 6c20 6973 204e 6f6e     if val is Non
-0000f730: 653a 0a20 2020 2020 2020 2020 2020 2076  e:.            v
-0000f740: 616c 203d 206e 6172 726f 7773 7065 632e  al = narrowspec.
-0000f750: 6c6f 6164 2873 656c 6629 0a20 2020 2020  load(self).     
-0000f760: 2020 2072 6574 7572 6e20 7661 6c0a 0a20     return val.. 
-0000f770: 2020 2040 7374 6f72 6563 6163 6865 286e     @storecache(n
-0000f780: 6172 726f 7773 7065 632e 4649 4c45 4e41  arrowspec.FILENA
-0000f790: 4d45 290a 2020 2020 6465 6620 5f73 746f  ME).    def _sto
-0000f7a0: 7265 6e61 7272 6f77 6d61 7463 6828 7365  renarrowmatch(se
-0000f7b0: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
-0000f7c0: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
-0000f7d0: 4e41 5252 4f57 5f52 4551 5549 5245 4d45  NARROW_REQUIREME
-0000f7e0: 4e54 206e 6f74 2069 6e20 7365 6c66 2e72  NT not in self.r
-0000f7f0: 6571 7569 7265 6d65 6e74 733a 0a20 2020  equirements:.   
-0000f800: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000f810: 6d61 7463 686d 6f64 2e61 6c77 6179 7328  matchmod.always(
-0000f820: 290a 2020 2020 2020 2020 696e 636c 7564  ).        includ
-0000f830: 652c 2065 7863 6c75 6465 203d 2073 656c  e, exclude = sel
-0000f840: 662e 6e61 7272 6f77 7061 7473 0a20 2020  f.narrowpats.   
-0000f850: 2020 2020 2072 6574 7572 6e20 6e61 7272       return narr
-0000f860: 6f77 7370 6563 2e6d 6174 6368 2873 656c  owspec.match(sel
-0000f870: 662e 726f 6f74 2c20 696e 636c 7564 653d  f.root, include=
-0000f880: 696e 636c 7564 652c 2065 7863 6c75 6465  include, exclude
-0000f890: 3d65 7863 6c75 6465 290a 0a20 2020 2040  =exclude)..    @
-0000f8a0: 7374 6f72 6563 6163 6865 286e 6172 726f  storecache(narro
-0000f8b0: 7773 7065 632e 4649 4c45 4e41 4d45 290a  wspec.FILENAME).
-0000f8c0: 2020 2020 6465 6620 5f6e 6172 726f 776d      def _narrowm
-0000f8d0: 6174 6368 2873 656c 6629 3a0a 2020 2020  atch(self):.    
-0000f8e0: 2020 2020 6966 2072 6571 7569 7265 6d65      if requireme
-0000f8f0: 6e74 736d 6f64 2e4e 4152 524f 575f 5245  ntsmod.NARROW_RE
-0000f900: 5155 4952 454d 454e 5420 6e6f 7420 696e  QUIREMENT not in
-0000f910: 2073 656c 662e 7265 7175 6972 656d 656e   self.requiremen
-0000f920: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-0000f930: 7265 7475 726e 206d 6174 6368 6d6f 642e  return matchmod.
-0000f940: 616c 7761 7973 2829 0a20 2020 2020 2020  always().       
-0000f950: 206e 6172 726f 7773 7065 632e 6368 6563   narrowspec.chec
-0000f960: 6b77 6f72 6b69 6e67 636f 7079 6e61 7272  kworkingcopynarr
-0000f970: 6f77 7370 6563 2873 656c 6629 0a20 2020  owspec(self).   
-0000f980: 2020 2020 2069 6e63 6c75 6465 2c20 6578       include, ex
-0000f990: 636c 7564 6520 3d20 7365 6c66 2e6e 6172  clude = self.nar
-0000f9a0: 726f 7770 6174 730a 2020 2020 2020 2020  rowpats.        
-0000f9b0: 7265 7475 726e 206e 6172 726f 7773 7065  return narrowspe
-0000f9c0: 632e 6d61 7463 6828 7365 6c66 2e72 6f6f  c.match(self.roo
-0000f9d0: 742c 2069 6e63 6c75 6465 3d69 6e63 6c75  t, include=inclu
-0000f9e0: 6465 2c20 6578 636c 7564 653d 6578 636c  de, exclude=excl
-0000f9f0: 7564 6529 0a0a 2020 2020 6465 6620 6e61  ude)..    def na
-0000fa00: 7272 6f77 6d61 7463 6828 7365 6c66 2c20  rrowmatch(self, 
-0000fa10: 6d61 7463 683d 4e6f 6e65 2c20 696e 636c  match=None, incl
-0000fa20: 7564 6565 7861 6374 3d46 616c 7365 293a  udeexact=False):
-0000fa30: 0a20 2020 2020 2020 2022 2222 6d61 7463  .        """matc
-0000fa40: 6865 7220 636f 7272 6573 706f 6e64 696e  her correspondin
-0000fa50: 6720 7468 6520 7468 6520 7265 706f 2773  g the the repo's
-0000fa60: 206e 6172 726f 7773 7065 630a 0a20 2020   narrowspec..   
-0000fa70: 2020 2020 2049 6620 606d 6174 6368 6020       If `match` 
-0000fa80: 6973 2067 6976 656e 2c20 7468 656e 2074  is given, then t
-0000fa90: 6861 7420 7769 6c6c 2062 6520 696e 7465  hat will be inte
-0000faa0: 7273 6563 7465 6420 7769 7468 2074 6865  rsected with the
-0000fab0: 206e 6172 726f 770a 2020 2020 2020 2020   narrow.        
-0000fac0: 6d61 7463 6865 722e 0a0a 2020 2020 2020  matcher...      
-0000fad0: 2020 4966 2060 696e 636c 7564 6565 7861    If `includeexa
-0000fae0: 6374 6020 6973 2054 7275 652c 2074 6865  ct` is True, the
-0000faf0: 6e20 616e 7920 6578 6163 7420 6d61 7463  n any exact matc
-0000fb00: 6865 7320 6672 6f6d 2060 6d61 7463 6860  hes from `match`
-0000fb10: 2077 696c 6c0a 2020 2020 2020 2020 6265   will.        be
-0000fb20: 2069 6e63 6c75 6465 6420 6576 656e 2069   included even i
-0000fb30: 6620 7468 6579 2772 6520 6f75 7473 6964  f they're outsid
-0000fb40: 6520 7468 6520 6e61 7272 6f77 7370 6563  e the narrowspec
-0000fb50: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000fb60: 2020 2020 2020 6966 206d 6174 6368 3a0a        if match:.
-0000fb70: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0000fb80: 6e63 6c75 6465 6578 6163 7420 616e 6420  ncludeexact and 
-0000fb90: 6e6f 7420 7365 6c66 2e5f 6e61 7272 6f77  not self._narrow
-0000fba0: 6d61 7463 682e 616c 7761 7973 2829 3a0a  match.always():.
-0000fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fbc0: 2320 646f 206e 6f74 2065 7863 6c75 6465  # do not exclude
-0000fbd0: 2065 7870 6c69 6369 746c 792d 7370 6563   explicitly-spec
-0000fbe0: 6966 6965 6420 7061 7468 7320 736f 2074  ified paths so t
-0000fbf0: 6861 7420 7468 6579 2063 616e 0a20 2020  hat they can.   
-0000fc00: 2020 2020 2020 2020 2020 2020 2023 2062               # b
-0000fc10: 6520 7761 726e 6564 206c 6174 6572 206f  e warned later o
-0000fc20: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-0000fc30: 2020 656d 203d 206d 6174 6368 6d6f 642e    em = matchmod.
-0000fc40: 6578 6163 7428 6d61 7463 682e 6669 6c65  exact(match.file
-0000fc50: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
-0000fc60: 2020 2020 206e 6d20 3d20 6d61 7463 686d       nm = matchm
-0000fc70: 6f64 2e75 6e69 6f6e 6d61 7463 6865 7228  od.unionmatcher(
-0000fc80: 5b73 656c 662e 5f6e 6172 726f 776d 6174  [self._narrowmat
-0000fc90: 6368 2c20 656d 5d29 0a20 2020 2020 2020  ch, em]).       
-0000fca0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000fcb0: 6d61 7463 686d 6f64 2e69 6e74 6572 7365  matchmod.interse
-0000fcc0: 6374 6d61 7463 6865 7273 286d 6174 6368  ctmatchers(match
-0000fcd0: 2c20 6e6d 290a 2020 2020 2020 2020 2020  , nm).          
-0000fce0: 2020 7265 7475 726e 206d 6174 6368 6d6f    return matchmo
-0000fcf0: 642e 696e 7465 7273 6563 746d 6174 6368  d.intersectmatch
-0000fd00: 6572 7328 6d61 7463 682c 2073 656c 662e  ers(match, self.
-0000fd10: 5f6e 6172 726f 776d 6174 6368 290a 2020  _narrowmatch).  
-0000fd20: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000fd30: 662e 5f6e 6172 726f 776d 6174 6368 0a0a  f._narrowmatch..
-0000fd40: 2020 2020 6465 6620 7365 746e 6172 726f      def setnarro
-0000fd50: 7770 6174 7328 7365 6c66 2c20 6e65 7769  wpats(self, newi
-0000fd60: 6e63 6c75 6465 732c 206e 6577 6578 636c  ncludes, newexcl
-0000fd70: 7564 6573 293a 0a20 2020 2020 2020 206e  udes):.        n
-0000fd80: 6172 726f 7773 7065 632e 7361 7665 2873  arrowspec.save(s
-0000fd90: 656c 662c 206e 6577 696e 636c 7564 6573  elf, newincludes
-0000fda0: 2c20 6e65 7765 7863 6c75 6465 7329 0a20  , newexcludes). 
-0000fdb0: 2020 2020 2020 2073 656c 662e 696e 7661         self.inva
-0000fdc0: 6c69 6461 7465 2863 6c65 6172 6669 6c65  lidate(clearfile
-0000fdd0: 6361 6368 653d 5472 7565 290a 0a20 2020  cache=True)..   
-0000fde0: 2040 756e 6669 6c74 6572 6564 7072 6f70   @unfilteredprop
-0000fdf0: 6572 7479 6361 6368 650a 2020 2020 6465  ertycache.    de
-0000fe00: 6620 5f71 7569 636b 5f61 6363 6573 735f  f _quick_access_
-0000fe10: 6368 616e 6765 6964 5f6e 756c 6c28 7365  changeid_null(se
-0000fe20: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-0000fe30: 7572 6e20 7b0a 2020 2020 2020 2020 2020  urn {.          
-0000fe40: 2020 6227 6e75 6c6c 273a 2028 6e75 6c6c    b'null': (null
-0000fe50: 7265 762c 2073 656c 662e 6e6f 6465 636f  rev, self.nodeco
-0000fe60: 6e73 7461 6e74 732e 6e75 6c6c 6964 292c  nstants.nullid),
-0000fe70: 0a20 2020 2020 2020 2020 2020 206e 756c  .            nul
-0000fe80: 6c72 6576 3a20 286e 756c 6c72 6576 2c20  lrev: (nullrev, 
-0000fe90: 7365 6c66 2e6e 6f64 6563 6f6e 7374 616e  self.nodeconstan
-0000fea0: 7473 2e6e 756c 6c69 6429 2c0a 2020 2020  ts.nullid),.    
-0000feb0: 2020 2020 2020 2020 7365 6c66 2e6e 756c          self.nul
-0000fec0: 6c69 643a 2028 6e75 6c6c 7265 762c 2073  lid: (nullrev, s
-0000fed0: 656c 662e 6e75 6c6c 6964 292c 0a20 2020  elf.nullid),.   
-0000fee0: 2020 2020 207d 0a0a 2020 2020 4075 6e66       }..    @unf
-0000fef0: 696c 7465 7265 6470 726f 7065 7274 7963  ilteredpropertyc
-0000ff00: 6163 6865 0a20 2020 2064 6566 205f 7175  ache.    def _qu
-0000ff10: 6963 6b5f 6163 6365 7373 5f63 6861 6e67  ick_access_chang
-0000ff20: 6569 645f 7763 2873 656c 6629 3a0a 2020  eid_wc(self):.  
-0000ff30: 2020 2020 2020 2320 616c 736f 2066 6173        # also fas
-0000ff40: 7420 7061 7468 2061 6363 6573 7320 746f  t path access to
-0000ff50: 2074 6865 2077 6f72 6b69 6e67 2063 6f70   the working cop
-0000ff60: 7920 7061 7265 6e74 730a 2020 2020 2020  y parents.      
-0000ff70: 2020 2320 686f 7765 7665 722c 206f 6e6c    # however, onl
-0000ff80: 7920 646f 2069 7420 666f 7220 6669 6c74  y do it for filt
-0000ff90: 6572 2074 6861 7420 656e 7375 7265 2077  er that ensure w
-0000ffa0: 6320 6973 2076 6973 6962 6c65 2e0a 2020  c is visible..  
-0000ffb0: 2020 2020 2020 7175 6963 6b20 3d20 7365        quick = se
-0000ffc0: 6c66 2e5f 7175 6963 6b5f 6163 6365 7373  lf._quick_access
-0000ffd0: 5f63 6861 6e67 6569 645f 6e75 6c6c 2e63  _changeid_null.c
-0000ffe0: 6f70 7928 290a 2020 2020 2020 2020 636c  opy().        cl
-0000fff0: 203d 2073 656c 662e 756e 6669 6c74 6572   = self.unfilter
-00010000: 6564 2829 2e63 6861 6e67 656c 6f67 0a20  ed().changelog. 
-00010010: 2020 2020 2020 2066 6f72 206e 6f64 6520         for node 
-00010020: 696e 2073 656c 662e 6469 7273 7461 7465  in self.dirstate
-00010030: 2e70 6172 656e 7473 2829 3a0a 2020 2020  .parents():.    
-00010040: 2020 2020 2020 2020 6966 206e 6f64 6520          if node 
-00010050: 3d3d 2073 656c 662e 6e75 6c6c 6964 3a0a  == self.nullid:.
-00010060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010070: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-00010080: 2020 2020 2072 6576 203d 2063 6c2e 696e       rev = cl.in
-00010090: 6465 782e 6765 745f 7265 7628 6e6f 6465  dex.get_rev(node
-000100a0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000100b0: 2072 6576 2069 7320 4e6f 6e65 3a0a 2020   rev is None:.  
-000100c0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000100d0: 756e 6b6e 6f77 6e20 776f 726b 696e 6720  unknown working 
-000100e0: 636f 7079 2070 6172 656e 7420 6361 7365  copy parent case
-000100f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010100: 2020 230a 2020 2020 2020 2020 2020 2020    #.            
-00010110: 2020 2020 2320 2020 736b 6970 2074 6865      #   skip the
-00010120: 2066 6173 7420 7061 7468 2061 6e64 206c   fast path and l
-00010130: 6574 2068 6967 6865 7220 636f 6465 2064  et higher code d
-00010140: 6561 6c20 7769 7468 2069 740a 2020 2020  eal with it.    
-00010150: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00010160: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00010170: 2070 6169 7220 3d20 2872 6576 2c20 6e6f   pair = (rev, no
-00010180: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-00010190: 7175 6963 6b5b 7265 765d 203d 2070 6169  quick[rev] = pai
-000101a0: 720a 2020 2020 2020 2020 2020 2020 7175  r.            qu
-000101b0: 6963 6b5b 6e6f 6465 5d20 3d20 7061 6972  ick[node] = pair
-000101c0: 0a20 2020 2020 2020 2020 2020 2023 2061  .            # a
-000101d0: 6c73 6f20 6164 6420 7468 6520 7061 7265  lso add the pare
-000101e0: 6e74 7320 6f66 2074 6865 2070 6172 656e  nts of the paren
-000101f0: 7473 0a20 2020 2020 2020 2020 2020 2066  ts.            f
-00010200: 6f72 2072 2069 6e20 636c 2e70 6172 656e  or r in cl.paren
-00010210: 7472 6576 7328 7265 7629 3a0a 2020 2020  trevs(rev):.    
-00010220: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00010230: 203d 3d20 6e75 6c6c 7265 763a 0a20 2020   == nullrev:.   
+00001de0: 3d4e 6f6e 652c 2072 656d 6f74 6568 6964  =None, remotehid
+00001df0: 6465 6e3d 4661 6c73 6529 3a0a 2020 2020  den=False):.    
+00001e00: 2020 2020 7375 7065 7228 6c6f 6361 6c70      super(localp
+00001e10: 6565 722c 2073 656c 6629 2e5f 5f69 6e69  eer, self).__ini
+00001e20: 745f 5f28 0a20 2020 2020 2020 2020 2020  t__(.           
+00001e30: 2072 6570 6f2e 7569 2c20 7061 7468 3d70   repo.ui, path=p
+00001e40: 6174 682c 2072 656d 6f74 6568 6964 6465  ath, remotehidde
+00001e50: 6e3d 7265 6d6f 7465 6869 6464 656e 0a20  n=remotehidden. 
+00001e60: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00001e70: 2020 6966 2063 6170 7320 6973 204e 6f6e    if caps is Non
+00001e80: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
+00001e90: 6170 7320 3d20 6d6f 6465 726e 6361 7073  aps = moderncaps
+00001ea0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+00001eb0: 6966 2072 656d 6f74 6568 6964 6465 6e3a  if remotehidden:
+00001ec0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00001ed0: 662e 5f72 6570 6f20 3d20 7265 706f 2e66  f._repo = repo.f
+00001ee0: 696c 7465 7265 6428 6227 7365 7276 6564  iltered(b'served
+00001ef0: 2e68 6964 6465 6e27 290a 2020 2020 2020  .hidden').      
+00001f00: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00001f10: 2020 2020 7365 6c66 2e5f 7265 706f 203d      self._repo =
+00001f20: 2072 6570 6f2e 6669 6c74 6572 6564 2862   repo.filtered(b
+00001f30: 2773 6572 7665 6427 290a 2020 2020 2020  'served').      
+00001f40: 2020 6966 2072 6570 6f2e 5f77 616e 7465    if repo._wante
+00001f50: 645f 7369 6465 6461 7461 3a0a 2020 2020  d_sidedata:.    
+00001f60: 2020 2020 2020 2020 666f 726d 6174 7465          formatte
+00001f70: 6420 3d20 6275 6e64 6c65 322e 666f 726d  d = bundle2.form
+00001f80: 6174 5f72 656d 6f74 655f 7761 6e74 6564  at_remote_wanted
+00001f90: 5f73 6964 6564 6174 6128 7265 706f 290a  _sidedata(repo).
+00001fa0: 2020 2020 2020 2020 2020 2020 6361 7073              caps
+00001fb0: 2e61 6464 2862 2765 7870 2d77 616e 7465  .add(b'exp-wante
+00001fc0: 642d 7369 6465 6461 7461 3d27 202b 2066  d-sidedata=' + f
+00001fd0: 6f72 6d61 7474 6564 290a 0a20 2020 2020  ormatted)..     
+00001fe0: 2020 2073 656c 662e 5f63 6170 7320 3d20     self._caps = 
+00001ff0: 7265 706f 2e5f 7265 7374 7269 6374 6361  repo._restrictca
+00002000: 7061 6269 6c69 7469 6573 2863 6170 7329  pabilities(caps)
+00002010: 0a0a 2020 2020 2320 4265 6769 6e20 6f66  ..    # Begin of
+00002020: 205f 6261 7365 7065 6572 2069 6e74 6572   _basepeer inter
+00002030: 6661 6365 2e0a 0a20 2020 2064 6566 2075  face...    def u
+00002040: 726c 2873 656c 6629 3a0a 2020 2020 2020  rl(self):.      
+00002050: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+00002060: 6570 6f2e 7572 6c28 290a 0a20 2020 2064  epo.url()..    d
+00002070: 6566 206c 6f63 616c 2873 656c 6629 3a0a  ef local(self):.
+00002080: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00002090: 656c 662e 5f72 6570 6f0a 0a20 2020 2064  elf._repo..    d
+000020a0: 6566 2063 616e 7075 7368 2873 656c 6629  ef canpush(self)
+000020b0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000020c0: 2054 7275 650a 0a20 2020 2064 6566 2063   True..    def c
+000020d0: 6c6f 7365 2873 656c 6629 3a0a 2020 2020  lose(self):.    
+000020e0: 2020 2020 7365 6c66 2e5f 7265 706f 2e63      self._repo.c
+000020f0: 6c6f 7365 2829 0a0a 2020 2020 2320 456e  lose()..    # En
+00002100: 6420 6f66 205f 6261 7365 7065 6572 2069  d of _basepeer i
+00002110: 6e74 6572 6661 6365 2e0a 0a20 2020 2023  nterface...    #
+00002120: 2042 6567 696e 206f 6620 5f62 6173 6577   Begin of _basew
+00002130: 6972 6563 6f6d 6d61 6e64 7320 696e 7465  irecommands inte
+00002140: 7266 6163 652e 0a0a 2020 2020 6465 6620  rface...    def 
+00002150: 6272 616e 6368 6d61 7028 7365 6c66 293a  branchmap(self):
+00002160: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00002170: 7365 6c66 2e5f 7265 706f 2e62 7261 6e63  self._repo.branc
+00002180: 686d 6170 2829 0a0a 2020 2020 6465 6620  hmap()..    def 
+00002190: 6361 7061 6269 6c69 7469 6573 2873 656c  capabilities(sel
+000021a0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+000021b0: 726e 2073 656c 662e 5f63 6170 730a 0a20  rn self._caps.. 
+000021c0: 2020 2064 6566 2067 6574 5f63 6163 6865     def get_cache
+000021d0: 645f 6275 6e64 6c65 5f69 6e6c 696e 6528  d_bundle_inline(
+000021e0: 7365 6c66 2c20 7061 7468 293a 0a20 2020  self, path):.   
+000021f0: 2020 2020 2023 206e 6f74 206e 6565 6465       # not neede
+00002200: 6420 7769 7468 206c 6f63 616c 2070 6565  d with local pee
+00002210: 720a 2020 2020 2020 2020 7261 6973 6520  r.        raise 
+00002220: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
+00002230: 726f 720a 0a20 2020 2064 6566 2063 6c6f  ror..    def clo
+00002240: 6e65 6275 6e64 6c65 7328 7365 6c66 293a  nebundles(self):
+00002250: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00002260: 6275 6e64 6c65 6361 6368 6573 2e67 6574  bundlecaches.get
+00002270: 5f6d 616e 6966 6573 7428 7365 6c66 2e5f  _manifest(self._
+00002280: 7265 706f 290a 0a20 2020 2064 6566 2064  repo)..    def d
+00002290: 6562 7567 7769 7265 6172 6773 2873 656c  ebugwireargs(sel
+000022a0: 662c 206f 6e65 2c20 7477 6f2c 2074 6872  f, one, two, thr
+000022b0: 6565 3d4e 6f6e 652c 2066 6f75 723d 4e6f  ee=None, four=No
+000022c0: 6e65 2c20 6669 7665 3d4e 6f6e 6529 3a0a  ne, five=None):.
+000022d0: 2020 2020 2020 2020 2222 2255 7365 6420          """Used 
+000022e0: 746f 2074 6573 7420 6172 6775 6d65 6e74  to test argument
+000022f0: 2070 6173 7369 6e67 206f 7665 7220 7468   passing over th
+00002300: 6520 7769 7265 2222 220a 2020 2020 2020  e wire""".      
+00002310: 2020 7265 7475 726e 2062 2225 7320 2573    return b"%s %s
+00002320: 2025 7320 2573 2025 7322 2025 2028 0a20   %s %s %s" % (. 
+00002330: 2020 2020 2020 2020 2020 206f 6e65 2c0a             one,.
+00002340: 2020 2020 2020 2020 2020 2020 7477 6f2c              two,
+00002350: 0a20 2020 2020 2020 2020 2020 2070 7963  .            pyc
+00002360: 6f6d 7061 742e 6279 7465 7374 7228 7468  ompat.bytestr(th
+00002370: 7265 6529 2c0a 2020 2020 2020 2020 2020  ree),.          
+00002380: 2020 7079 636f 6d70 6174 2e62 7974 6573    pycompat.bytes
+00002390: 7472 2866 6f75 7229 2c0a 2020 2020 2020  tr(four),.      
+000023a0: 2020 2020 2020 7079 636f 6d70 6174 2e62        pycompat.b
+000023b0: 7974 6573 7472 2866 6976 6529 2c0a 2020  ytestr(five),.  
+000023c0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+000023d0: 2067 6574 6275 6e64 6c65 280a 2020 2020   getbundle(.    
+000023e0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+000023f0: 2020 736f 7572 6365 2c0a 2020 2020 2020    source,.      
+00002400: 2020 6865 6164 733d 4e6f 6e65 2c0a 2020    heads=None,.  
+00002410: 2020 2020 2020 636f 6d6d 6f6e 3d4e 6f6e        common=Non
+00002420: 652c 0a20 2020 2020 2020 2062 756e 646c  e,.        bundl
+00002430: 6563 6170 733d 4e6f 6e65 2c0a 2020 2020  ecaps=None,.    
+00002440: 2020 2020 7265 6d6f 7465 5f73 6964 6564      remote_sided
+00002450: 6174 613d 4e6f 6e65 2c0a 2020 2020 2020  ata=None,.      
+00002460: 2020 2a2a 6b77 6172 6773 0a20 2020 2029    **kwargs.    )
+00002470: 3a0a 2020 2020 2020 2020 6368 756e 6b73  :.        chunks
+00002480: 203d 2065 7863 6861 6e67 652e 6765 7462   = exchange.getb
+00002490: 756e 646c 6563 6875 6e6b 7328 0a20 2020  undlechunks(.   
+000024a0: 2020 2020 2020 2020 2073 656c 662e 5f72           self._r
+000024b0: 6570 6f2c 0a20 2020 2020 2020 2020 2020  epo,.           
+000024c0: 2073 6f75 7263 652c 0a20 2020 2020 2020   source,.       
+000024d0: 2020 2020 2068 6561 6473 3d68 6561 6473       heads=heads
+000024e0: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+000024f0: 6d6d 6f6e 3d63 6f6d 6d6f 6e2c 0a20 2020  mmon=common,.   
+00002500: 2020 2020 2020 2020 2062 756e 646c 6563           bundlec
+00002510: 6170 733d 6275 6e64 6c65 6361 7073 2c0a  aps=bundlecaps,.
+00002520: 2020 2020 2020 2020 2020 2020 7265 6d6f              remo
+00002530: 7465 5f73 6964 6564 6174 613d 7265 6d6f  te_sidedata=remo
+00002540: 7465 5f73 6964 6564 6174 612c 0a20 2020  te_sidedata,.   
+00002550: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
+00002560: 730a 2020 2020 2020 2020 295b 315d 0a20  s.        )[1]. 
+00002570: 2020 2020 2020 2063 6220 3d20 7574 696c         cb = util
+00002580: 2e63 6875 6e6b 6275 6666 6572 2863 6875  .chunkbuffer(chu
+00002590: 6e6b 7329 0a0a 2020 2020 2020 2020 6966  nks)..        if
+000025a0: 2065 7863 6861 6e67 652e 6275 6e64 6c65   exchange.bundle
+000025b0: 3272 6571 7565 7374 6564 2862 756e 646c  2requested(bundl
+000025c0: 6563 6170 7329 3a0a 2020 2020 2020 2020  ecaps):.        
+000025d0: 2020 2020 2320 5768 656e 2072 6571 7565      # When reque
+000025e0: 7374 696e 6720 6120 6275 6e64 6c65 322c  sting a bundle2,
+000025f0: 2067 6574 6275 6e64 6c65 2072 6574 7572   getbundle retur
+00002600: 6e73 2061 2073 7472 6561 6d20 746f 206d  ns a stream to m
+00002610: 616b 6520 7468 650a 2020 2020 2020 2020  ake the.        
+00002620: 2020 2020 2320 7769 7265 206c 6576 656c      # wire level
+00002630: 2066 756e 6374 696f 6e20 6861 7070 6965   function happie
+00002640: 722e 2057 6520 6e65 6564 2074 6f20 6275  r. We need to bu
+00002650: 696c 6420 6120 7072 6f70 6572 206f 626a  ild a proper obj
+00002660: 6563 740a 2020 2020 2020 2020 2020 2020  ect.            
+00002670: 2320 6672 6f6d 2069 7420 696e 206c 6f63  # from it in loc
+00002680: 616c 2070 6565 722e 0a20 2020 2020 2020  al peer..       
+00002690: 2020 2020 2072 6574 7572 6e20 6275 6e64       return bund
+000026a0: 6c65 322e 6765 7475 6e62 756e 646c 6572  le2.getunbundler
+000026b0: 2873 656c 662e 7569 2c20 6362 290a 2020  (self.ui, cb).  
+000026c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000026d0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+000026e0: 6861 6e67 6567 726f 7570 2e67 6574 756e  hangegroup.getun
+000026f0: 6275 6e64 6c65 7228 6227 3031 272c 2063  bundler(b'01', c
+00002700: 622c 204e 6f6e 6529 0a0a 2020 2020 6465  b, None)..    de
+00002710: 6620 6865 6164 7328 7365 6c66 293a 0a20  f heads(self):. 
+00002720: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00002730: 6c66 2e5f 7265 706f 2e68 6561 6473 2829  lf._repo.heads()
+00002740: 0a0a 2020 2020 6465 6620 6b6e 6f77 6e28  ..    def known(
+00002750: 7365 6c66 2c20 6e6f 6465 7329 3a0a 2020  self, nodes):.  
+00002760: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00002770: 662e 5f72 6570 6f2e 6b6e 6f77 6e28 6e6f  f._repo.known(no
+00002780: 6465 7329 0a0a 2020 2020 6465 6620 6c69  des)..    def li
+00002790: 7374 6b65 7973 2873 656c 662c 206e 616d  stkeys(self, nam
+000027a0: 6573 7061 6365 293a 0a20 2020 2020 2020  espace):.       
+000027b0: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
+000027c0: 706f 2e6c 6973 746b 6579 7328 6e61 6d65  po.listkeys(name
+000027d0: 7370 6163 6529 0a0a 2020 2020 6465 6620  space)..    def 
+000027e0: 6c6f 6f6b 7570 2873 656c 662c 206b 6579  lookup(self, key
+000027f0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00002800: 6e20 7365 6c66 2e5f 7265 706f 2e6c 6f6f  n self._repo.loo
+00002810: 6b75 7028 6b65 7929 0a0a 2020 2020 6465  kup(key)..    de
+00002820: 6620 7075 7368 6b65 7928 7365 6c66 2c20  f pushkey(self, 
+00002830: 6e61 6d65 7370 6163 652c 206b 6579 2c20  namespace, key, 
+00002840: 6f6c 642c 206e 6577 293a 0a20 2020 2020  old, new):.     
+00002850: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00002860: 7265 706f 2e70 7573 686b 6579 286e 616d  repo.pushkey(nam
+00002870: 6573 7061 6365 2c20 6b65 792c 206f 6c64  espace, key, old
+00002880: 2c20 6e65 7729 0a0a 2020 2020 6465 6620  , new)..    def 
+00002890: 7374 7265 616d 5f6f 7574 2873 656c 6629  stream_out(self)
+000028a0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+000028b0: 6572 726f 722e 4162 6f72 7428 5f28 6227  error.Abort(_(b'
+000028c0: 6361 6e6e 6f74 2070 6572 666f 726d 2073  cannot perform s
+000028d0: 7472 6561 6d20 636c 6f6e 6520 6167 6169  tream clone agai
+000028e0: 6e73 7420 6c6f 6361 6c20 7065 6572 2729  nst local peer')
+000028f0: 290a 0a20 2020 2064 6566 2075 6e62 756e  )..    def unbun
+00002900: 646c 6528 7365 6c66 2c20 6275 6e64 6c65  dle(self, bundle
+00002910: 2c20 6865 6164 732c 2075 726c 293a 0a20  , heads, url):. 
+00002920: 2020 2020 2020 2022 2222 6170 706c 7920         """apply 
+00002930: 6120 6275 6e64 6c65 206f 6e20 6120 7265  a bundle on a re
+00002940: 706f 0a0a 2020 2020 2020 2020 5468 6973  po..        This
+00002950: 2066 756e 6374 696f 6e20 6861 6e64 6c65   function handle
+00002960: 7320 7468 6520 7265 706f 206c 6f63 6b69  s the repo locki
+00002970: 6e67 2069 7473 656c 662e 2222 220a 2020  ng itself.""".  
+00002980: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00002990: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+000029a0: 2020 2020 2020 2020 2020 2020 6275 6e64              bund
+000029b0: 6c65 203d 2065 7863 6861 6e67 652e 7265  le = exchange.re
+000029c0: 6164 6275 6e64 6c65 2873 656c 662e 7569  adbundle(self.ui
+000029d0: 2c20 6275 6e64 6c65 2c20 4e6f 6e65 290a  , bundle, None).
+000029e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000029f0: 7265 7420 3d20 6578 6368 616e 6765 2e75  ret = exchange.u
+00002a00: 6e62 756e 646c 6528 7365 6c66 2e5f 7265  nbundle(self._re
+00002a10: 706f 2c20 6275 6e64 6c65 2c20 6865 6164  po, bundle, head
+00002a20: 732c 2062 2770 7573 6827 2c20 7572 6c29  s, b'push', url)
+00002a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002a40: 2069 6620 7574 696c 2e73 6166 6568 6173   if util.safehas
+00002a50: 6174 7472 2872 6574 2c20 2767 6574 6368  attr(ret, 'getch
+00002a60: 756e 6b73 2729 3a0a 2020 2020 2020 2020  unks'):.        
+00002a70: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+00002a80: 6973 2069 7320 6120 6275 6e64 6c65 3230  is is a bundle20
+00002a90: 206f 626a 6563 742c 2074 7572 6e20 6974   object, turn it
+00002aa0: 2069 6e74 6f20 616e 2075 6e62 756e 646c   into an unbundl
+00002ab0: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
+00002ac0: 2020 2020 2020 2020 2320 5468 6973 206c          # This l
+00002ad0: 6974 746c 6520 6461 6e63 6520 7368 6f75  ittle dance shou
+00002ae0: 6c64 2062 6520 6472 6f70 7065 6420 6576  ld be dropped ev
+00002af0: 656e 7475 616c 6c79 2077 6865 6e20 7468  entually when th
+00002b00: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00002b10: 2020 2020 2020 2320 4150 4920 6973 2066        # API is f
+00002b20: 696e 616c 6c79 2069 6d70 726f 7665 642e  inally improved.
+00002b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002b40: 2020 2020 2073 7472 6561 6d20 3d20 7574       stream = ut
+00002b50: 696c 2e63 6875 6e6b 6275 6666 6572 2872  il.chunkbuffer(r
+00002b60: 6574 2e67 6574 6368 756e 6b73 2829 290a  et.getchunks()).
+00002b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b80: 2020 2020 7265 7420 3d20 6275 6e64 6c65      ret = bundle
+00002b90: 322e 6765 7475 6e62 756e 646c 6572 2873  2.getunbundler(s
+00002ba0: 656c 662e 7569 2c20 7374 7265 616d 290a  elf.ui, stream).
+00002bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002bc0: 7265 7475 726e 2072 6574 0a20 2020 2020  return ret.     
+00002bd0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+00002be0: 6365 7074 696f 6e20 6173 2065 7863 3a0a  ception as exc:.
+00002bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c00: 2320 4966 2074 6865 2065 7863 6570 7469  # If the excepti
+00002c10: 6f6e 2063 6f6e 7461 696e 7320 6f75 7470  on contains outp
+00002c20: 7574 2073 616c 7661 6765 6420 6672 6f6d  ut salvaged from
+00002c30: 2061 2062 756e 646c 6532 0a20 2020 2020   a bundle2.     
+00002c40: 2020 2020 2020 2020 2020 2023 2072 6570             # rep
+00002c50: 6c79 2c20 7765 206e 6565 6420 746f 206d  ly, we need to m
+00002c60: 616b 6520 7375 7265 2069 7420 6973 2070  ake sure it is p
+00002c70: 7269 6e74 6564 2062 6566 6f72 6520 636f  rinted before co
+00002c80: 6e74 696e 7569 6e67 0a20 2020 2020 2020  ntinuing.       
+00002c90: 2020 2020 2020 2020 2023 2074 6f20 6661           # to fa
+00002ca0: 696c 2e20 536f 2077 6520 6275 696c 6420  il. So we build 
+00002cb0: 6120 6275 6e64 6c65 3220 7769 7468 2073  a bundle2 with s
+00002cc0: 7563 6820 6f75 7470 7574 2061 6e64 2063  uch output and c
+00002cd0: 6f6e 7375 6d65 0a20 2020 2020 2020 2020  onsume.         
+00002ce0: 2020 2020 2020 2023 2069 7420 6469 7265         # it dire
+00002cf0: 6374 6c79 2e0a 2020 2020 2020 2020 2020  ctly..          
+00002d00: 2020 2020 2020 230a 2020 2020 2020 2020        #.        
+00002d10: 2020 2020 2020 2020 2320 5468 6973 2069          # This i
+00002d20: 7320 6e6f 7420 7665 7279 2065 6c65 6761  s not very elega
+00002d30: 6e74 2062 7574 2061 6c6c 6f77 7320 6120  nt but allows a 
+00002d40: 2273 696d 706c 6522 2073 6f6c 7574 696f  "simple" solutio
+00002d50: 6e20 666f 720a 2020 2020 2020 2020 2020  n for.          
+00002d60: 2020 2020 2020 2320 6973 7375 6534 3539        # issue459
+00002d70: 340a 2020 2020 2020 2020 2020 2020 2020  4.              
+00002d80: 2020 6f75 7470 7574 203d 2067 6574 6174    output = getat
+00002d90: 7472 2865 7863 2c20 275f 6275 6e64 6c65  tr(exc, '_bundle
+00002da0: 3273 616c 7661 6765 646f 7574 7075 7427  2salvagedoutput'
+00002db0: 2c20 2829 290a 2020 2020 2020 2020 2020  , ()).          
+00002dc0: 2020 2020 2020 6966 206f 7574 7075 743a        if output:
+00002dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002de0: 2020 2020 2062 756e 646c 6572 203d 2062       bundler = b
+00002df0: 756e 646c 6532 2e62 756e 646c 6532 3028  undle2.bundle20(
+00002e00: 7365 6c66 2e5f 7265 706f 2e75 6929 0a20  self._repo.ui). 
+00002e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e20: 2020 2066 6f72 206f 7574 2069 6e20 6f75     for out in ou
+00002e30: 7470 7574 3a0a 2020 2020 2020 2020 2020  tput:.          
+00002e40: 2020 2020 2020 2020 2020 2020 2020 6275                bu
+00002e50: 6e64 6c65 722e 6164 6470 6172 7428 6f75  ndler.addpart(ou
+00002e60: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00002e70: 2020 2020 2020 2073 7472 6561 6d20 3d20         stream = 
+00002e80: 7574 696c 2e63 6875 6e6b 6275 6666 6572  util.chunkbuffer
+00002e90: 2862 756e 646c 6572 2e67 6574 6368 756e  (bundler.getchun
+00002ea0: 6b73 2829 290a 2020 2020 2020 2020 2020  ks()).          
+00002eb0: 2020 2020 2020 2020 2020 6220 3d20 6275            b = bu
+00002ec0: 6e64 6c65 322e 6765 7475 6e62 756e 646c  ndle2.getunbundl
+00002ed0: 6572 2873 656c 662e 7569 2c20 7374 7265  er(self.ui, stre
+00002ee0: 616d 290a 2020 2020 2020 2020 2020 2020  am).            
+00002ef0: 2020 2020 2020 2020 6275 6e64 6c65 322e          bundle2.
+00002f00: 7072 6f63 6573 7362 756e 646c 6528 7365  processbundle(se
+00002f10: 6c66 2e5f 7265 706f 2c20 6229 0a20 2020  lf._repo, b).   
+00002f20: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00002f30: 7365 0a20 2020 2020 2020 2065 7863 6570  se.        excep
+00002f40: 7420 6572 726f 722e 5075 7368 5261 6365  t error.PushRace
+00002f50: 6420 6173 2065 7863 3a0a 2020 2020 2020  d as exc:.      
+00002f60: 2020 2020 2020 7261 6973 6520 6572 726f        raise erro
+00002f70: 722e 5265 7370 6f6e 7365 4572 726f 7228  r.ResponseError(
+00002f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002f90: 205f 2862 2770 7573 6820 6661 696c 6564   _(b'push failed
+00002fa0: 3a27 292c 2073 7472 696e 6775 7469 6c2e  :'), stringutil.
+00002fb0: 666f 7263 6562 7974 6573 7472 2865 7863  forcebytestr(exc
+00002fc0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+00002fd0: 0a20 2020 2023 2045 6e64 206f 6620 5f62  .    # End of _b
+00002fe0: 6173 6577 6972 6563 6f6d 6d61 6e64 7320  asewirecommands 
+00002ff0: 696e 7465 7266 6163 652e 0a0a 2020 2020  interface...    
+00003000: 2320 4265 6769 6e20 6f66 2070 6565 7220  # Begin of peer 
+00003010: 696e 7465 7266 6163 652e 0a0a 2020 2020  interface...    
+00003020: 6465 6620 636f 6d6d 616e 6465 7865 6375  def commandexecu
+00003030: 746f 7228 7365 6c66 293a 0a20 2020 2020  tor(self):.     
+00003040: 2020 2072 6574 7572 6e20 6c6f 6361 6c63     return localc
+00003050: 6f6d 6d61 6e64 6578 6563 7574 6f72 2873  ommandexecutor(s
+00003060: 656c 6629 0a0a 2020 2020 2320 456e 6420  elf)..    # End 
+00003070: 6f66 2070 6565 7220 696e 7465 7266 6163  of peer interfac
+00003080: 652e 0a0a 0a40 696e 7465 7266 6163 6575  e....@interfaceu
+00003090: 7469 6c2e 696d 706c 656d 656e 7465 7228  til.implementer(
+000030a0: 7265 706f 7369 746f 7279 2e69 7065 6572  repository.ipeer
+000030b0: 6c65 6761 6379 636f 6d6d 616e 6473 290a  legacycommands).
+000030c0: 636c 6173 7320 6c6f 6361 6c6c 6567 6163  class locallegac
+000030d0: 7970 6565 7228 6c6f 6361 6c70 6565 7229  ypeer(localpeer)
+000030e0: 3a0a 2020 2020 2222 2270 6565 7220 6578  :.    """peer ex
+000030f0: 7465 6e73 696f 6e20 7768 6963 6820 696d  tension which im
+00003100: 706c 656d 656e 7473 206c 6567 6163 7920  plements legacy 
+00003110: 6d65 7468 6f64 7320 746f 6f3b 2075 7365  methods too; use
+00003120: 6420 666f 7220 7465 7374 7320 7769 7468  d for tests with
+00003130: 0a20 2020 2072 6573 7472 6963 7465 6420  .    restricted 
+00003140: 6361 7061 6269 6c69 7469 6573 2222 220a  capabilities""".
+00003150: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00003160: 5f28 7365 6c66 2c20 7265 706f 2c20 7061  _(self, repo, pa
+00003170: 7468 3d4e 6f6e 652c 2072 656d 6f74 6568  th=None, remoteh
+00003180: 6964 6465 6e3d 4661 6c73 6529 3a0a 2020  idden=False):.  
+00003190: 2020 2020 2020 7375 7065 7228 6c6f 6361        super(loca
+000031a0: 6c6c 6567 6163 7970 6565 722c 2073 656c  llegacypeer, sel
+000031b0: 6629 2e5f 5f69 6e69 745f 5f28 0a20 2020  f).__init__(.   
+000031c0: 2020 2020 2020 2020 2072 6570 6f2c 2063           repo, c
+000031d0: 6170 733d 6c65 6761 6379 6361 7073 2c20  aps=legacycaps, 
+000031e0: 7061 7468 3d70 6174 682c 2072 656d 6f74  path=path, remot
+000031f0: 6568 6964 6465 6e3d 7265 6d6f 7465 6869  ehidden=remotehi
+00003200: 6464 656e 0a20 2020 2020 2020 2029 0a0a  dden.        )..
+00003210: 2020 2020 2320 4265 6769 6e20 6f66 2062      # Begin of b
+00003220: 6173 656c 6567 6163 7977 6972 6563 6f6d  aselegacywirecom
+00003230: 6d61 6e64 7320 696e 7465 7266 6163 652e  mands interface.
+00003240: 0a0a 2020 2020 6465 6620 6265 7477 6565  ..    def betwee
+00003250: 6e28 7365 6c66 2c20 7061 6972 7329 3a0a  n(self, pairs):.
+00003260: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00003270: 656c 662e 5f72 6570 6f2e 6265 7477 6565  elf._repo.betwee
+00003280: 6e28 7061 6972 7329 0a0a 2020 2020 6465  n(pairs)..    de
+00003290: 6620 6272 616e 6368 6573 2873 656c 662c  f branches(self,
+000032a0: 206e 6f64 6573 293a 0a20 2020 2020 2020   nodes):.       
+000032b0: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
+000032c0: 706f 2e62 7261 6e63 6865 7328 6e6f 6465  po.branches(node
+000032d0: 7329 0a0a 2020 2020 6465 6620 6368 616e  s)..    def chan
+000032e0: 6765 6772 6f75 7028 7365 6c66 2c20 6e6f  gegroup(self, no
+000032f0: 6465 732c 2073 6f75 7263 6529 3a0a 2020  des, source):.  
+00003300: 2020 2020 2020 6f75 7467 6f69 6e67 203d        outgoing =
+00003310: 2064 6973 636f 7665 7279 2e6f 7574 676f   discovery.outgo
+00003320: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
+00003330: 2073 656c 662e 5f72 6570 6f2c 206d 6973   self._repo, mis
+00003340: 7369 6e67 726f 6f74 733d 6e6f 6465 732c  singroots=nodes,
+00003350: 2061 6e63 6573 746f 7273 6f66 3d73 656c   ancestorsof=sel
+00003360: 662e 5f72 6570 6f2e 6865 6164 7328 290a  f._repo.heads().
+00003370: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00003380: 2020 7265 7475 726e 2063 6861 6e67 6567    return changeg
+00003390: 726f 7570 2e6d 616b 6563 6861 6e67 6567  roup.makechangeg
+000033a0: 726f 7570 2873 656c 662e 5f72 6570 6f2c  roup(self._repo,
+000033b0: 206f 7574 676f 696e 672c 2062 2730 3127   outgoing, b'01'
+000033c0: 2c20 736f 7572 6365 290a 0a20 2020 2064  , source)..    d
+000033d0: 6566 2063 6861 6e67 6567 726f 7570 7375  ef changegroupsu
+000033e0: 6273 6574 2873 656c 662c 2062 6173 6573  bset(self, bases
+000033f0: 2c20 6865 6164 732c 2073 6f75 7263 6529  , heads, source)
+00003400: 3a0a 2020 2020 2020 2020 6f75 7467 6f69  :.        outgoi
+00003410: 6e67 203d 2064 6973 636f 7665 7279 2e6f  ng = discovery.o
+00003420: 7574 676f 696e 6728 0a20 2020 2020 2020  utgoing(.       
+00003430: 2020 2020 2073 656c 662e 5f72 6570 6f2c       self._repo,
+00003440: 206d 6973 7369 6e67 726f 6f74 733d 6261   missingroots=ba
+00003450: 7365 732c 2061 6e63 6573 746f 7273 6f66  ses, ancestorsof
+00003460: 3d68 6561 6473 0a20 2020 2020 2020 2029  =heads.        )
+00003470: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00003480: 6368 616e 6765 6772 6f75 702e 6d61 6b65  changegroup.make
+00003490: 6368 616e 6765 6772 6f75 7028 7365 6c66  changegroup(self
+000034a0: 2e5f 7265 706f 2c20 6f75 7467 6f69 6e67  ._repo, outgoing
+000034b0: 2c20 6227 3031 272c 2073 6f75 7263 6529  , b'01', source)
+000034c0: 0a0a 2020 2020 2320 456e 6420 6f66 2062  ..    # End of b
+000034d0: 6173 656c 6567 6163 7977 6972 6563 6f6d  aselegacywirecom
+000034e0: 6d61 6e64 7320 696e 7465 7266 6163 652e  mands interface.
+000034f0: 0a0a 0a23 2046 756e 6374 696f 6e73 2072  ...# Functions r
+00003500: 6563 6569 7669 6e67 2028 7569 2c20 6665  eceiving (ui, fe
+00003510: 6174 7572 6573 2920 7468 6174 2065 7874  atures) that ext
+00003520: 656e 7369 6f6e 7320 6361 6e20 7265 6769  ensions can regi
+00003530: 7374 6572 2074 6f20 696d 7061 6374 0a23  ster to impact.#
+00003540: 2074 6865 2061 6269 6c69 7479 2074 6f20   the ability to 
+00003550: 6c6f 6164 2072 6570 6f73 6974 6f72 6965  load repositorie
+00003560: 7320 7769 7468 2063 7573 746f 6d20 7265  s with custom re
+00003570: 7175 6972 656d 656e 7473 2e20 4f6e 6c79  quirements. Only
+00003580: 0a23 2066 756e 6374 696f 6e73 2064 6566  .# functions def
+00003590: 696e 6564 2069 6e20 6c6f 6164 6564 2065  ined in loaded e
+000035a0: 7874 656e 7369 6f6e 7320 6172 6520 6361  xtensions are ca
+000035b0: 6c6c 6564 2e0a 230a 2320 5468 6520 6675  lled..#.# The fu
+000035c0: 6e63 7469 6f6e 2072 6563 6569 7665 7320  nction receives 
+000035d0: 6120 7365 7420 6f66 2072 6571 7569 7265  a set of require
+000035e0: 6d65 6e74 2073 7472 696e 6773 2074 6861  ment strings tha
+000035f0: 7420 7468 6520 7265 706f 7369 746f 7279  t the repository
+00003600: 0a23 2069 7320 6361 7061 626c 6520 6f66  .# is capable of
+00003610: 206f 7065 6e69 6e67 2e20 4675 6e63 7469   opening. Functi
+00003620: 6f6e 7320 7769 6c6c 2074 7970 6963 616c  ons will typical
+00003630: 6c79 2061 6464 2065 6c65 6d65 6e74 7320  ly add elements 
+00003640: 746f 2074 6865 0a23 2073 6574 2074 6f20  to the.# set to 
+00003650: 7265 666c 6563 7420 7468 6174 2074 6865  reflect that the
+00003660: 2065 7874 656e 7369 6f6e 206b 6e6f 7773   extension knows
+00003670: 2068 6f77 2074 6f20 6861 6e64 6c65 2074   how to handle t
+00003680: 6861 7420 7265 7175 6972 656d 656e 7473  hat requirements
+00003690: 2e0a 6665 6174 7572 6573 6574 7570 6675  ..featuresetupfu
+000036a0: 6e63 7320 3d20 7365 7428 290a 0a0a 6465  ncs = set()...de
+000036b0: 6620 5f67 6574 7368 6172 6564 7666 7328  f _getsharedvfs(
+000036c0: 6867 7666 732c 2072 6571 7569 7265 6d65  hgvfs, requireme
+000036d0: 6e74 7329 3a0a 2020 2020 2222 2272 6574  nts):.    """ret
+000036e0: 7572 6e73 2074 6865 2076 6673 206f 626a  urns the vfs obj
+000036f0: 6563 7420 706f 696e 7469 6e67 2074 6f20  ect pointing to 
+00003700: 726f 6f74 206f 6620 7368 6172 6564 2073  root of shared s
+00003710: 6f75 7263 650a 2020 2020 7265 706f 2066  ource.    repo f
+00003720: 6f72 2061 2073 6861 7265 6420 7265 706f  or a shared repo
+00003730: 7369 746f 7279 0a0a 2020 2020 6867 7666  sitory..    hgvf
+00003740: 7320 6973 2076 6673 2070 6f69 6e74 696e  s is vfs pointin
+00003750: 6720 6174 202e 6867 2f20 6f66 2063 7572  g at .hg/ of cur
+00003760: 7265 6e74 2072 6570 6f20 2873 6861 7265  rent repo (share
+00003770: 6420 6f6e 6529 0a20 2020 2072 6571 7569  d one).    requi
+00003780: 7265 6d65 6e74 7320 6973 2061 2073 6574  rements is a set
+00003790: 206f 6620 7265 7175 6972 656d 656e 7473   of requirements
+000037a0: 206f 6620 6375 7272 656e 7420 7265 706f   of current repo
+000037b0: 2028 7368 6172 6564 206f 6e65 290a 2020   (shared one).  
+000037c0: 2020 2222 220a 2020 2020 2320 5468 6520    """.    # The 
+000037d0: 6060 7368 6172 6564 6060 206f 7220 6060  ``shared`` or ``
+000037e0: 7265 6c73 6861 7265 6460 6020 7265 7175  relshared`` requ
+000037f0: 6972 656d 656e 7473 2069 6e64 6963 6174  irements indicat
+00003800: 6520 7468 650a 2020 2020 2320 7374 6f72  e the.    # stor
+00003810: 6520 6c69 7665 7320 696e 2074 6865 2070  e lives in the p
+00003820: 6174 6820 636f 6e74 6169 6e65 6420 696e  ath contained in
+00003830: 2074 6865 2060 602e 6867 2f73 6861 7265   the ``.hg/share
+00003840: 6470 6174 6860 6020 6669 6c65 2e0a 2020  dpath`` file..  
+00003850: 2020 2320 5468 6973 2069 7320 616e 2061    # This is an a
+00003860: 6273 6f6c 7574 6520 7061 7468 2066 6f72  bsolute path for
+00003870: 2060 6073 6861 7265 6460 6020 616e 6420   ``shared`` and 
+00003880: 7265 6c61 7469 7665 2074 6f0a 2020 2020  relative to.    
+00003890: 2320 6060 2e68 672f 6060 2066 6f72 2060  # ``.hg/`` for `
+000038a0: 6072 656c 7368 6172 6564 6060 2e0a 2020  `relshared``..  
+000038b0: 2020 7368 6172 6564 7061 7468 203d 2068    sharedpath = h
+000038c0: 6776 6673 2e72 6561 6428 6227 7368 6172  gvfs.read(b'shar
+000038d0: 6564 7061 7468 2729 2e72 7374 7269 7028  edpath').rstrip(
+000038e0: 6227 5c6e 2729 0a20 2020 2069 6620 7265  b'\n').    if re
+000038f0: 7175 6972 656d 656e 7473 6d6f 642e 5245  quirementsmod.RE
+00003900: 4c41 5449 5645 5f53 4841 5245 445f 5245  LATIVE_SHARED_RE
+00003910: 5155 4952 454d 454e 5420 696e 2072 6571  QUIREMENT in req
+00003920: 7569 7265 6d65 6e74 733a 0a20 2020 2020  uirements:.     
+00003930: 2020 2073 6861 7265 6470 6174 6820 3d20     sharedpath = 
+00003940: 7574 696c 2e6e 6f72 6d70 6174 6828 6867  util.normpath(hg
+00003950: 7666 732e 6a6f 696e 2873 6861 7265 6470  vfs.join(sharedp
+00003960: 6174 6829 290a 0a20 2020 2073 6861 7265  ath))..    share
+00003970: 6476 6673 203d 2076 6673 6d6f 642e 7666  dvfs = vfsmod.vf
+00003980: 7328 7368 6172 6564 7061 7468 2c20 7265  s(sharedpath, re
+00003990: 616c 7061 7468 3d54 7275 6529 0a0a 2020  alpath=True)..  
+000039a0: 2020 6966 206e 6f74 2073 6861 7265 6476    if not sharedv
+000039b0: 6673 2e65 7869 7374 7328 293a 0a20 2020  fs.exists():.   
+000039c0: 2020 2020 2072 6169 7365 2065 7272 6f72       raise error
+000039d0: 2e52 6570 6f45 7272 6f72 280a 2020 2020  .RepoError(.    
+000039e0: 2020 2020 2020 2020 5f28 6227 2e68 672f          _(b'.hg/
+000039f0: 7368 6172 6564 7061 7468 2070 6f69 6e74  sharedpath point
+00003a00: 7320 746f 206e 6f6e 6578 6973 7465 6e74  s to nonexistent
+00003a10: 2064 6972 6563 746f 7279 2025 7327 290a   directory %s').
+00003a20: 2020 2020 2020 2020 2020 2020 2520 7368              % sh
+00003a30: 6172 6564 7666 732e 6261 7365 0a20 2020  aredvfs.base.   
+00003a40: 2020 2020 2029 0a20 2020 2072 6574 7572       ).    retur
+00003a50: 6e20 7368 6172 6564 7666 730a 0a0a 6465  n sharedvfs...de
+00003a60: 6620 5f72 6561 6472 6571 7569 7265 7328  f _readrequires(
+00003a70: 7666 732c 2061 6c6c 6f77 6d69 7373 696e  vfs, allowmissin
+00003a80: 6729 3a0a 2020 2020 2222 2272 6561 6473  g):.    """reads
+00003a90: 2074 6865 2072 6571 7569 7265 2066 696c   the require fil
+00003aa0: 6520 7072 6573 656e 7420 6174 2072 6f6f  e present at roo
+00003ab0: 7420 6f66 2074 6869 7320 7666 730a 2020  t of this vfs.  
+00003ac0: 2020 616e 6420 7265 7475 726e 2061 2073    and return a s
+00003ad0: 6574 206f 6620 7265 7175 6972 656d 656e  et of requiremen
+00003ae0: 7473 0a0a 2020 2020 4966 2061 6c6c 6f77  ts..    If allow
+00003af0: 6d69 7373 696e 6720 6973 2054 7275 652c  missing is True,
+00003b00: 2077 6520 7375 7070 7265 7373 2046 696c   we suppress Fil
+00003b10: 654e 6f74 466f 756e 6445 7272 6f72 2069  eNotFoundError i
+00003b20: 6620 7261 6973 6564 2222 220a 2020 2020  f raised""".    
+00003b30: 2320 7265 7175 6972 6573 2066 696c 6520  # requires file 
+00003b40: 636f 6e74 6169 6e73 2061 206e 6577 6c69  contains a newli
+00003b50: 6e65 2d64 656c 696d 6974 6564 206c 6973  ne-delimited lis
+00003b60: 7420 6f66 0a20 2020 2023 2066 6561 7475  t of.    # featu
+00003b70: 7265 732f 6361 7061 6269 6c69 7469 6573  res/capabilities
+00003b80: 2074 6865 206f 7065 6e65 7220 2875 7329   the opener (us)
+00003b90: 206d 7573 7420 6861 7665 2069 6e20 6f72   must have in or
+00003ba0: 6465 7220 746f 2075 7365 0a20 2020 2023  der to use.    #
+00003bb0: 2074 6865 2072 6570 6f73 6974 6f72 792e   the repository.
+00003bc0: 2054 6869 7320 6669 6c65 2077 6173 2069   This file was i
+00003bd0: 6e74 726f 6475 6365 6420 696e 204d 6572  ntroduced in Mer
+00003be0: 6375 7269 616c 2030 2e39 2e32 2c0a 2020  curial 0.9.2,.  
+00003bf0: 2020 2320 7768 6963 6820 6d65 616e 7320    # which means 
+00003c00: 7665 7279 206f 6c64 2072 6570 6f73 6974  very old reposit
+00003c10: 6f72 6965 7320 6d61 7920 6e6f 7420 6861  ories may not ha
+00003c20: 7665 206f 6e65 2e20 5765 2061 7373 756d  ve one. We assum
+00003c30: 650a 2020 2020 2320 6120 6d69 7373 696e  e.    # a missin
+00003c40: 6720 6669 6c65 2074 7261 6e73 6c61 7465  g file translate
+00003c50: 7320 746f 206e 6f20 7265 7175 6972 656d  s to no requirem
+00003c60: 656e 7473 2e0a 2020 2020 7265 6164 203d  ents..    read =
+00003c70: 2076 6673 2e74 7279 7265 6164 2069 6620   vfs.tryread if 
+00003c80: 616c 6c6f 776d 6973 7369 6e67 2065 6c73  allowmissing els
+00003c90: 6520 7666 732e 7265 6164 0a20 2020 2072  e vfs.read.    r
+00003ca0: 6574 7572 6e20 7365 7428 7265 6164 2862  eturn set(read(b
+00003cb0: 2772 6571 7569 7265 7327 292e 7370 6c69  'requires').spli
+00003cc0: 746c 696e 6573 2829 290a 0a0a 6465 6620  tlines())...def 
+00003cd0: 6d61 6b65 6c6f 6361 6c72 6570 6f73 6974  makelocalreposit
+00003ce0: 6f72 7928 6261 7365 7569 2c20 7061 7468  ory(baseui, path
+00003cf0: 3a20 6279 7465 732c 2069 6e74 656e 7473  : bytes, intents
+00003d00: 3d4e 6f6e 6529 3a0a 2020 2020 2222 2243  =None):.    """C
+00003d10: 7265 6174 6520 6120 6c6f 6361 6c20 7265  reate a local re
+00003d20: 706f 7369 746f 7279 206f 626a 6563 742e  pository object.
+00003d30: 0a0a 2020 2020 4769 7665 6e20 6172 6775  ..    Given argu
+00003d40: 6d65 6e74 7320 6e65 6564 6564 2074 6f20  ments needed to 
+00003d50: 636f 6e73 7472 7563 7420 6120 6c6f 6361  construct a loca
+00003d60: 6c20 7265 706f 7369 746f 7279 2c20 7468  l repository, th
+00003d70: 6973 2066 756e 6374 696f 6e0a 2020 2020  is function.    
+00003d80: 7065 7266 6f72 6d73 2076 6172 696f 7573  performs various
+00003d90: 2065 6172 6c79 2072 6570 6f73 6974 6f72   early repositor
+00003da0: 7920 6c6f 6164 696e 6720 6675 6e63 7469  y loading functi
+00003db0: 6f6e 616c 6974 7920 2873 7563 6820 6173  onality (such as
+00003dc0: 0a20 2020 2072 6561 6469 6e67 2074 6865  .    reading the
+00003dd0: 2060 602e 6867 2f72 6571 7569 7265 7360   ``.hg/requires`
+00003de0: 6020 616e 6420 6060 2e68 672f 6867 7263  ` and ``.hg/hgrc
+00003df0: 6060 2066 696c 6573 292c 2076 616c 6964  `` files), valid
+00003e00: 6174 6573 2074 6861 740a 2020 2020 7468  ates that.    th
+00003e10: 6520 7265 706f 7369 746f 7279 2063 616e  e repository can
+00003e20: 2062 6520 6f70 656e 6564 2c20 6465 7269   be opened, deri
+00003e30: 7665 7320 6120 7479 7065 2073 7569 7461  ves a type suita
+00003e40: 626c 6520 666f 7220 7265 7072 6573 656e  ble for represen
+00003e50: 7469 6e67 0a20 2020 2074 6861 7420 7265  ting.    that re
+00003e60: 706f 7369 746f 7279 2c20 616e 6420 7265  pository, and re
+00003e70: 7475 726e 7320 616e 2069 6e73 7461 6e63  turns an instanc
+00003e80: 6520 6f66 2069 742e 0a0a 2020 2020 5468  e of it...    Th
+00003e90: 6520 7265 7475 726e 6564 206f 626a 6563  e returned objec
+00003ea0: 7420 636f 6e66 6f72 6d73 2074 6f20 7468  t conforms to th
+00003eb0: 6520 6060 7265 706f 7369 746f 7279 2e63  e ``repository.c
+00003ec0: 6f6d 706c 6574 656c 6f63 616c 7265 706f  ompletelocalrepo
+00003ed0: 7369 746f 7279 6060 0a20 2020 2069 6e74  sitory``.    int
+00003ee0: 6572 6661 6365 2e0a 0a20 2020 2054 6865  erface...    The
+00003ef0: 2072 6570 6f73 6974 6f72 7920 7479 7065   repository type
+00003f00: 2069 7320 6465 7269 7665 6420 6279 2063   is derived by c
+00003f10: 616c 6c69 6e67 2061 2073 6572 6965 7320  alling a series 
+00003f20: 6f66 2066 6163 746f 7279 2066 756e 6374  of factory funct
+00003f30: 696f 6e73 0a20 2020 2066 6f72 2065 6163  ions.    for eac
+00003f40: 6820 6173 7065 6374 2f69 6e74 6572 6661  h aspect/interfa
+00003f50: 6365 206f 6620 7468 6520 6669 6e61 6c20  ce of the final 
+00003f60: 7265 706f 7369 746f 7279 2e20 5468 6573  repository. Thes
+00003f70: 6520 6172 6520 6465 6669 6e65 6420 6279  e are defined by
+00003f80: 0a20 2020 2060 6052 4550 4f5f 494e 5445  .    ``REPO_INTE
+00003f90: 5246 4143 4553 6060 2e0a 0a20 2020 2045  RFACES``...    E
+00003fa0: 6163 6820 6661 6374 6f72 7920 6675 6e63  ach factory func
+00003fb0: 7469 6f6e 2069 7320 6361 6c6c 6564 2074  tion is called t
+00003fc0: 6f20 7072 6f64 7563 6520 6120 7479 7065  o produce a type
+00003fd0: 2069 6d70 6c65 6d65 6e74 696e 6720 6120   implementing a 
+00003fe0: 7370 6563 6966 6963 0a20 2020 2069 6e74  specific.    int
+00003ff0: 6572 6661 6365 2e20 5468 6520 6375 6d75  erface. The cumu
+00004000: 6c61 7469 7665 206c 6973 7420 6f66 2072  lative list of r
+00004010: 6574 7572 6e65 6420 7479 7065 7320 7769  eturned types wi
+00004020: 6c6c 2062 6520 636f 6d62 696e 6564 2069  ll be combined i
+00004030: 6e74 6f20 610a 2020 2020 6e65 7720 7479  nto a.    new ty
+00004040: 7065 2061 6e64 2074 6861 7420 7479 7065  pe and that type
+00004050: 2077 696c 6c20 6265 2069 6e73 7461 6e74   will be instant
+00004060: 6961 7465 6420 746f 2072 6570 7265 7365  iated to represe
+00004070: 6e74 2074 6865 206c 6f63 616c 0a20 2020  nt the local.   
+00004080: 2072 6570 6f73 6974 6f72 792e 0a0a 2020   repository...  
+00004090: 2020 5468 6520 6661 6374 6f72 7920 6675    The factory fu
+000040a0: 6e63 7469 6f6e 7320 6561 6368 2072 6563  nctions each rec
+000040b0: 6569 7665 2076 6172 696f 7573 2073 7461  eive various sta
+000040c0: 7465 2074 6861 7420 6d61 7920 6265 2063  te that may be c
+000040d0: 6f6e 7375 6c74 6564 0a20 2020 2061 7320  onsulted.    as 
+000040e0: 7061 7274 206f 6620 6465 7269 7669 6e67  part of deriving
+000040f0: 2061 2074 7970 652e 0a0a 2020 2020 4578   a type...    Ex
+00004100: 7465 6e73 696f 6e73 2073 686f 756c 6420  tensions should 
+00004110: 7772 6170 2074 6865 7365 2066 6163 746f  wrap these facto
+00004120: 7279 2066 756e 6374 696f 6e73 2074 6f20  ry functions to 
+00004130: 6375 7374 6f6d 697a 6520 7265 706f 7369  customize reposi
+00004140: 746f 7279 2074 7970 650a 2020 2020 6372  tory type.    cr
+00004150: 6561 7469 6f6e 2e20 4e6f 7465 2074 6861  eation. Note tha
+00004160: 7420 616e 2065 7874 656e 7369 6f6e 2773  t an extension's
+00004170: 2077 7261 7070 6564 2066 756e 6374 696f   wrapped functio
+00004180: 6e20 6d61 7920 6265 2063 616c 6c65 6420  n may be called 
+00004190: 6576 656e 2069 660a 2020 2020 7468 6174  even if.    that
+000041a0: 2065 7874 656e 7369 6f6e 2069 7320 6e6f   extension is no
+000041b0: 7420 6c6f 6164 6564 2066 6f72 2074 6865  t loaded for the
+000041c0: 2072 6570 6f20 6265 696e 6720 636f 6e73   repo being cons
+000041d0: 7472 7563 7465 642e 2045 7874 656e 7369  tructed. Extensi
+000041e0: 6f6e 730a 2020 2020 7368 6f75 6c64 2063  ons.    should c
+000041f0: 6865 636b 2069 6620 7468 6569 7220 6060  heck if their ``
+00004200: 5f5f 6e61 6d65 5f5f 6060 2061 7070 6561  __name__`` appea
+00004210: 7273 2069 6e20 7468 650a 2020 2020 6060  rs in the.    ``
+00004220: 6578 7465 6e73 696f 6e6d 6f64 756c 656e  extensionmodulen
+00004230: 616d 6573 6060 2073 6574 2070 6173 7365  ames`` set passe
+00004240: 6420 746f 2074 6865 2066 6163 746f 7279  d to the factory
+00004250: 2066 756e 6374 696f 6e20 616e 6420 6e6f   function and no
+00004260: 2d6f 7020 6966 0a20 2020 206e 6f74 2e0a  -op if.    not..
+00004270: 2020 2020 2222 220a 2020 2020 7569 203d      """.    ui =
+00004280: 2062 6173 6575 692e 636f 7079 2829 0a20   baseui.copy(). 
+00004290: 2020 2023 2050 7265 7665 6e74 2063 6f70     # Prevent cop
+000042a0: 7969 6e67 2072 6570 6f20 636f 6e66 6967  ying repo config
+000042b0: 7572 6174 696f 6e2e 0a20 2020 2075 692e  uration..    ui.
+000042c0: 636f 7079 203d 2062 6173 6575 692e 636f  copy = baseui.co
+000042d0: 7079 0a0a 2020 2020 2320 576f 726b 696e  py..    # Workin
+000042e0: 6720 6469 7265 6374 6f72 7920 5646 5320  g directory VFS 
+000042f0: 726f 6f74 6564 2061 7420 7265 706f 7369  rooted at reposi
+00004300: 746f 7279 2072 6f6f 742e 0a20 2020 2077  tory root..    w
+00004310: 6469 7276 6673 203d 2076 6673 6d6f 642e  dirvfs = vfsmod.
+00004320: 7666 7328 7061 7468 2c20 6578 7061 6e64  vfs(path, expand
+00004330: 7061 7468 3d54 7275 652c 2072 6561 6c70  path=True, realp
+00004340: 6174 683d 5472 7565 290a 0a20 2020 2023  ath=True)..    #
+00004350: 204d 6169 6e20 5646 5320 666f 7220 2e68   Main VFS for .h
+00004360: 672f 2064 6972 6563 746f 7279 2e0a 2020  g/ directory..  
+00004370: 2020 6867 7061 7468 203d 2077 6469 7276    hgpath = wdirv
+00004380: 6673 2e6a 6f69 6e28 6227 2e68 6727 290a  fs.join(b'.hg').
+00004390: 2020 2020 6867 7666 7320 3d20 7666 736d      hgvfs = vfsm
+000043a0: 6f64 2e76 6673 2868 6770 6174 682c 2063  od.vfs(hgpath, c
+000043b0: 6163 6865 6175 6469 7465 643d 5472 7565  acheaudited=True
+000043c0: 290a 2020 2020 2320 5768 6574 6865 7220  ).    # Whether 
+000043d0: 7468 6973 2072 6570 6f73 6974 6f72 7920  this repository 
+000043e0: 6973 2073 6861 7265 6420 6f6e 6520 6f72  is shared one or
+000043f0: 206e 6f74 0a20 2020 2073 6861 7265 6420   not.    shared 
+00004400: 3d20 4661 6c73 650a 2020 2020 2320 4966  = False.    # If
+00004410: 2074 6869 7320 7265 706f 7369 746f 7279   this repository
+00004420: 2069 7320 7368 6172 6564 2c20 7666 7320   is shared, vfs 
+00004430: 706f 696e 7469 6e67 2074 6f20 7368 6172  pointing to shar
+00004440: 6564 2072 6570 6f0a 2020 2020 7368 6172  ed repo.    shar
+00004450: 6564 7666 7320 3d20 4e6f 6e65 0a0a 2020  edvfs = None..  
+00004460: 2020 2320 5468 6520 2e68 672f 2070 6174    # The .hg/ pat
+00004470: 6820 7368 6f75 6c64 2065 7869 7374 2061  h should exist a
+00004480: 6e64 2073 686f 756c 6420 6265 2061 2064  nd should be a d
+00004490: 6972 6563 746f 7279 2e20 416c 6c20 6f74  irectory. All ot
+000044a0: 6865 720a 2020 2020 2320 6361 7365 7320  her.    # cases 
+000044b0: 6172 6520 6572 726f 7273 2e0a 2020 2020  are errors..    
+000044c0: 6966 206e 6f74 2068 6776 6673 2e69 7364  if not hgvfs.isd
+000044d0: 6972 2829 3a0a 2020 2020 2020 2020 7472  ir():.        tr
+000044e0: 793a 0a20 2020 2020 2020 2020 2020 2068  y:.            h
+000044f0: 6776 6673 2e73 7461 7428 290a 2020 2020  gvfs.stat().    
+00004500: 2020 2020 6578 6365 7074 2046 696c 654e      except FileN
+00004510: 6f74 466f 756e 6445 7272 6f72 3a0a 2020  otFoundError:.  
+00004520: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+00004530: 2020 2020 2020 2065 7863 6570 7420 5661         except Va
+00004540: 6c75 6545 7272 6f72 2061 7320 653a 0a20  lueError as e:. 
+00004550: 2020 2020 2020 2020 2020 2023 2043 616e             # Can
+00004560: 2062 6520 7261 6973 6564 206f 6e20 5079   be raised on Py
+00004570: 7468 6f6e 2033 2e38 2077 6865 6e20 7061  thon 3.8 when pa
+00004580: 7468 2069 7320 696e 7661 6c69 642e 0a20  th is invalid.. 
+00004590: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000045a0: 2065 7272 6f72 2e41 626f 7274 280a 2020   error.Abort(.  
+000045b0: 2020 2020 2020 2020 2020 2020 2020 5f28                _(
+000045c0: 6227 696e 7661 6c69 6420 7061 7468 2025  b'invalid path %
+000045d0: 733a 2025 7327 2920 2520 2870 6174 682c  s: %s') % (path,
+000045e0: 2073 7472 696e 6775 7469 6c2e 666f 7263   stringutil.forc
+000045f0: 6562 7974 6573 7472 2865 2929 0a20 2020  ebytestr(e)).   
+00004600: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00004610: 2020 2020 7261 6973 6520 6572 726f 722e      raise error.
+00004620: 5265 706f 4572 726f 7228 5f28 6227 7265  RepoError(_(b're
+00004630: 706f 7369 746f 7279 2025 7320 6e6f 7420  pository %s not 
+00004640: 666f 756e 6427 2920 2520 7061 7468 290a  found') % path).
+00004650: 0a20 2020 2072 6571 7569 7265 6d65 6e74  .    requirement
+00004660: 7320 3d20 5f72 6561 6472 6571 7569 7265  s = _readrequire
+00004670: 7328 6867 7666 732c 2054 7275 6529 0a20  s(hgvfs, True). 
+00004680: 2020 2073 6861 7265 6420 3d20 280a 2020     shared = (.  
+00004690: 2020 2020 2020 7265 7175 6972 656d 656e        requiremen
+000046a0: 7473 6d6f 642e 5348 4152 4544 5f52 4551  tsmod.SHARED_REQ
+000046b0: 5549 5245 4d45 4e54 2069 6e20 7265 7175  UIREMENT in requ
+000046c0: 6972 656d 656e 7473 0a20 2020 2020 2020  irements.       
+000046d0: 206f 7220 7265 7175 6972 656d 656e 7473   or requirements
+000046e0: 6d6f 642e 5245 4c41 5449 5645 5f53 4841  mod.RELATIVE_SHA
+000046f0: 5245 445f 5245 5155 4952 454d 454e 5420  RED_REQUIREMENT 
+00004700: 696e 2072 6571 7569 7265 6d65 6e74 730a  in requirements.
+00004710: 2020 2020 290a 2020 2020 7374 6f72 6576      ).    storev
+00004720: 6673 203d 204e 6f6e 650a 2020 2020 6966  fs = None.    if
+00004730: 2073 6861 7265 643a 0a20 2020 2020 2020   shared:.       
+00004740: 2023 2054 6869 7320 6973 2061 2073 6861   # This is a sha
+00004750: 7265 6420 7265 706f 0a20 2020 2020 2020  red repo.       
+00004760: 2073 6861 7265 6476 6673 203d 205f 6765   sharedvfs = _ge
+00004770: 7473 6861 7265 6476 6673 2868 6776 6673  tsharedvfs(hgvfs
+00004780: 2c20 7265 7175 6972 656d 656e 7473 290a  , requirements).
+00004790: 2020 2020 2020 2020 7374 6f72 6576 6673          storevfs
+000047a0: 203d 2076 6673 6d6f 642e 7666 7328 7368   = vfsmod.vfs(sh
+000047b0: 6172 6564 7666 732e 6a6f 696e 2862 2773  aredvfs.join(b's
+000047c0: 746f 7265 2729 290a 2020 2020 656c 7365  tore')).    else
+000047d0: 3a0a 2020 2020 2020 2020 7374 6f72 6576  :.        storev
+000047e0: 6673 203d 2076 6673 6d6f 642e 7666 7328  fs = vfsmod.vfs(
+000047f0: 6867 7666 732e 6a6f 696e 2862 2773 746f  hgvfs.join(b'sto
+00004800: 7265 2729 290a 0a20 2020 2023 2069 6620  re'))..    # if 
+00004810: 2e68 672f 7265 7175 6972 6573 2063 6f6e  .hg/requires con
+00004820: 7461 696e 7320 7468 6520 7368 6172 6573  tains the shares
+00004830: 6166 6520 7265 7175 6972 656d 656e 742c  afe requirement,
+00004840: 2069 7420 6d65 616e 730a 2020 2020 2320   it means.    # 
+00004850: 7468 6572 6520 6578 6973 7473 2061 2060  there exists a `
+00004860: 2e68 672f 7374 6f72 652f 7265 7175 6972  .hg/store/requir
+00004870: 6573 6020 746f 6f20 616e 6420 7765 2073  es` too and we s
+00004880: 686f 756c 6420 7265 6164 2069 740a 2020  hould read it.  
+00004890: 2020 2320 4e4f 5445 3a20 7072 6573 656e    # NOTE: presen
+000048a0: 6365 206f 6620 5348 4152 4553 4146 455f  ce of SHARESAFE_
+000048b0: 5245 5155 4952 454d 454e 5420 696d 706c  REQUIREMENT impl
+000048c0: 7920 7468 6174 2073 746f 7265 2072 6571  y that store req
+000048d0: 7569 7265 6d65 6e74 0a20 2020 2023 2069  uirement.    # i
+000048e0: 7320 7072 6573 656e 742e 2057 6520 6e65  s present. We ne
+000048f0: 7665 7220 7772 6974 6520 5348 4152 4553  ver write SHARES
+00004900: 4146 455f 5245 5155 4952 454d 454e 5420  AFE_REQUIREMENT 
+00004910: 666f 7220 6120 7265 706f 2069 6620 7374  for a repo if st
+00004920: 6f72 650a 2020 2020 2320 6973 206e 6f74  ore.    # is not
+00004930: 2070 7265 7365 6e74 2c20 7265 6665 7220   present, refer 
+00004940: 6368 6563 6b72 6571 7569 7265 6d65 6e74  checkrequirement
+00004950: 7363 6f6d 7061 7428 2920 666f 7220 7468  scompat() for th
+00004960: 6174 0a20 2020 2023 0a20 2020 2023 2048  at.    #.    # H
+00004970: 6f77 6576 6572 2c20 6966 2053 4841 5245  owever, if SHARE
+00004980: 5341 4645 5f52 4551 5549 5245 4d45 4e54  SAFE_REQUIREMENT
+00004990: 2069 7320 6e6f 7420 7072 6573 656e 742c   is not present,
+000049a0: 2069 7420 6d65 616e 7320 7468 6174 2074   it means that t
+000049b0: 6865 0a20 2020 2023 2072 6570 6f73 6974  he.    # reposit
+000049c0: 6f72 7920 7761 7320 7368 6172 6564 2074  ory was shared t
+000049d0: 6865 206f 6c64 2077 6179 2e20 5765 2063  he old way. We c
+000049e0: 6865 636b 2074 6865 2073 6861 7265 2073  heck the share s
+000049f0: 6f75 7263 6520 2e68 672f 7265 7175 6972  ource .hg/requir
+00004a00: 6573 0a20 2020 2023 2066 6f72 2053 4841  es.    # for SHA
+00004a10: 5245 5341 4645 5f52 4551 5549 5245 4d45  RESAFE_REQUIREME
+00004a20: 4e54 2074 6f20 6465 7465 6374 2077 6865  NT to detect whe
+00004a30: 7468 6572 2074 6865 2063 7572 7265 6e74  ther the current
+00004a40: 2072 6570 6f73 6974 6f72 7920 6e65 6564   repository need
+00004a50: 730a 2020 2020 2320 746f 2062 6520 7265  s.    # to be re
+00004a60: 7368 6172 6564 0a20 2020 2068 696e 7420  shared.    hint 
+00004a70: 3d20 5f28 6222 7365 6520 6068 6720 6865  = _(b"see `hg he
+00004a80: 6c70 2063 6f6e 6669 672e 666f 726d 6174  lp config.format
+00004a90: 2e75 7365 2d73 6861 7265 2d73 6166 6560  .use-share-safe`
+00004aa0: 2066 6f72 206d 6f72 6520 696e 666f 726d   for more inform
+00004ab0: 6174 696f 6e22 290a 2020 2020 6966 2072  ation").    if r
+00004ac0: 6571 7569 7265 6d65 6e74 736d 6f64 2e53  equirementsmod.S
+00004ad0: 4841 5245 5341 4645 5f52 4551 5549 5245  HARESAFE_REQUIRE
+00004ae0: 4d45 4e54 2069 6e20 7265 7175 6972 656d  MENT in requirem
+00004af0: 656e 7473 3a0a 2020 2020 2020 2020 6966  ents:.        if
+00004b00: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
+00004b10: 6861 7265 640a 2020 2020 2020 2020 2020  hared.          
+00004b20: 2020 616e 6420 7265 7175 6972 656d 656e    and requiremen
+00004b30: 7473 6d6f 642e 5348 4152 4553 4146 455f  tsmod.SHARESAFE_
+00004b40: 5245 5155 4952 454d 454e 540a 2020 2020  REQUIREMENT.    
+00004b50: 2020 2020 2020 2020 6e6f 7420 696e 205f          not in _
+00004b60: 7265 6164 7265 7175 6972 6573 2873 6861  readrequires(sha
+00004b70: 7265 6476 6673 2c20 5472 7565 290a 2020  redvfs, True).  
+00004b80: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+00004b90: 2020 2020 206d 6973 6d61 7463 685f 7761       mismatch_wa
+00004ba0: 726e 203d 2075 692e 636f 6e66 6967 626f  rn = ui.configbo
+00004bb0: 6f6c 280a 2020 2020 2020 2020 2020 2020  ol(.            
+00004bc0: 2020 2020 6227 7368 6172 6527 2c20 6227      b'share', b'
+00004bd0: 7361 6665 2d6d 6973 6d61 7463 682e 736f  safe-mismatch.so
+00004be0: 7572 6365 2d6e 6f74 2d73 6166 652e 7761  urce-not-safe.wa
+00004bf0: 726e 270a 2020 2020 2020 2020 2020 2020  rn'.            
+00004c00: 290a 2020 2020 2020 2020 2020 2020 6d69  ).            mi
+00004c10: 736d 6174 6368 5f63 6f6e 6669 6720 3d20  smatch_config = 
+00004c20: 7569 2e63 6f6e 6669 6728 0a20 2020 2020  ui.config(.     
+00004c30: 2020 2020 2020 2020 2020 2062 2773 6861             b'sha
+00004c40: 7265 272c 2062 2773 6166 652d 6d69 736d  re', b'safe-mism
+00004c50: 6174 6368 2e73 6f75 7263 652d 6e6f 742d  atch.source-not-
+00004c60: 7361 6665 270a 2020 2020 2020 2020 2020  safe'.          
+00004c70: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00004c80: 6d69 736d 6174 6368 5f76 6572 626f 7365  mismatch_verbose
+00004c90: 5f75 7067 7261 6465 203d 2075 692e 636f  _upgrade = ui.co
+00004ca0: 6e66 6967 626f 6f6c 280a 2020 2020 2020  nfigbool(.      
+00004cb0: 2020 2020 2020 2020 2020 6227 7368 6172            b'shar
+00004cc0: 6527 2c20 6227 7361 6665 2d6d 6973 6d61  e', b'safe-misma
+00004cd0: 7463 682e 736f 7572 6365 2d6e 6f74 2d73  tch.source-not-s
+00004ce0: 6166 653a 7665 7262 6f73 652d 7570 6772  afe:verbose-upgr
+00004cf0: 6164 6527 0a20 2020 2020 2020 2020 2020  ade'.           
+00004d00: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
+00004d10: 6620 6d69 736d 6174 6368 5f63 6f6e 6669  f mismatch_confi
+00004d20: 6720 696e 2028 0a20 2020 2020 2020 2020  g in (.         
+00004d30: 2020 2020 2020 2062 2764 6f77 6e67 7261         b'downgra
+00004d40: 6465 2d61 6c6c 6f77 272c 0a20 2020 2020  de-allow',.     
+00004d50: 2020 2020 2020 2020 2020 2062 2761 6c6c             b'all
+00004d60: 6f77 272c 0a20 2020 2020 2020 2020 2020  ow',.           
+00004d70: 2020 2020 2062 2764 6f77 6e67 7261 6465       b'downgrade
+00004d80: 2d61 626f 7274 272c 0a20 2020 2020 2020  -abort',.       
+00004d90: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00004da0: 2020 2020 2020 2020 2320 7072 6576 656e          # preven
+00004db0: 7420 6379 636c 6963 2069 6d70 6f72 7420  t cyclic import 
+00004dc0: 6c6f 6361 6c72 6570 6f20 2d3e 2075 7067  localrepo -> upg
+00004dd0: 7261 6465 202d 3e20 6c6f 6361 6c72 6570  rade -> localrep
+00004de0: 6f0a 2020 2020 2020 2020 2020 2020 2020  o.              
+00004df0: 2020 6672 6f6d 202e 2069 6d70 6f72 7420    from . import 
+00004e00: 7570 6772 6164 650a 0a20 2020 2020 2020  upgrade..       
+00004e10: 2020 2020 2020 2020 2075 7067 7261 6465           upgrade
+00004e20: 2e64 6f77 6e67 7261 6465 5f73 6861 7265  .downgrade_share
+00004e30: 5f74 6f5f 6e6f 6e5f 7361 6665 280a 2020  _to_non_safe(.  
+00004e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e50: 2020 7569 2c0a 2020 2020 2020 2020 2020    ui,.          
+00004e60: 2020 2020 2020 2020 2020 6867 7666 732c            hgvfs,
+00004e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004e80: 2020 2020 2073 6861 7265 6476 6673 2c0a       sharedvfs,.
+00004e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ea0: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
+00004eb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004ec0: 2020 2020 2020 6d69 736d 6174 6368 5f63        mismatch_c
+00004ed0: 6f6e 6669 672c 0a20 2020 2020 2020 2020  onfig,.         
+00004ee0: 2020 2020 2020 2020 2020 206d 6973 6d61             misma
+00004ef0: 7463 685f 7761 726e 2c0a 2020 2020 2020  tch_warn,.      
+00004f00: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+00004f10: 736d 6174 6368 5f76 6572 626f 7365 5f75  smatch_verbose_u
+00004f20: 7067 7261 6465 2c0a 2020 2020 2020 2020  pgrade,.        
+00004f30: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00004f40: 2020 2020 2020 656c 6966 206d 6973 6d61        elif misma
+00004f50: 7463 685f 636f 6e66 6967 203d 3d20 6227  tch_config == b'
+00004f60: 6162 6f72 7427 3a0a 2020 2020 2020 2020  abort':.        
+00004f70: 2020 2020 2020 2020 7261 6973 6520 6572          raise er
+00004f80: 726f 722e 4162 6f72 7428 0a20 2020 2020  ror.Abort(.     
+00004f90: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00004fa0: 2862 2273 6861 7265 2073 6f75 7263 6520  (b"share source 
+00004fb0: 646f 6573 206e 6f74 2073 7570 706f 7274  does not support
+00004fc0: 2073 6861 7265 2d73 6166 6520 7265 7175   share-safe requ
+00004fd0: 6972 656d 656e 7422 292c 0a20 2020 2020  irement"),.     
+00004fe0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00004ff0: 696e 743d 6869 6e74 2c0a 2020 2020 2020  int=hint,.      
+00005000: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00005010: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00005020: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00005030: 6973 6520 6572 726f 722e 4162 6f72 7428  ise error.Abort(
+00005040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005050: 2020 2020 205f 280a 2020 2020 2020 2020       _(.        
+00005060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005070: 6222 7368 6172 652d 7361 6665 206d 6973  b"share-safe mis
+00005080: 6d61 7463 6820 7769 7468 2073 6f75 7263  match with sourc
+00005090: 652e 5c6e 556e 7265 636f 676e 697a 6564  e.\nUnrecognized
+000050a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000050b0: 2020 2020 2020 2020 2020 6222 2076 616c            b" val
+000050c0: 7565 2027 2573 2720 6f66 2060 7368 6172  ue '%s' of `shar
+000050d0: 652e 7361 6665 2d6d 6973 6d61 7463 682e  e.safe-mismatch.
+000050e0: 736f 7572 6365 2d6e 6f74 2d73 6166 6560  source-not-safe`
+000050f0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00005100: 2020 2020 2020 2020 2020 6222 2073 6574            b" set
+00005110: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+00005120: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00005130: 2020 2020 2020 2020 2020 2020 2025 206d               % m
+00005140: 6973 6d61 7463 685f 636f 6e66 6967 2c0a  ismatch_config,.
+00005150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005160: 2020 2020 6869 6e74 3d68 696e 742c 0a20      hint=hint,. 
+00005170: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00005180: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00005190: 2020 2020 2020 2020 2020 2072 6571 7569             requi
+000051a0: 7265 6d65 6e74 7320 7c3d 205f 7265 6164  rements |= _read
+000051b0: 7265 7175 6972 6573 2873 746f 7265 7666  requires(storevf
+000051c0: 732c 2046 616c 7365 290a 2020 2020 656c  s, False).    el
+000051d0: 6966 2073 6861 7265 643a 0a20 2020 2020  if shared:.     
+000051e0: 2020 2073 6f75 7263 6572 6571 7569 7265     sourcerequire
+000051f0: 7320 3d20 5f72 6561 6472 6571 7569 7265  s = _readrequire
+00005200: 7328 7368 6172 6564 7666 732c 2046 616c  s(sharedvfs, Fal
+00005210: 7365 290a 2020 2020 2020 2020 6966 2072  se).        if r
+00005220: 6571 7569 7265 6d65 6e74 736d 6f64 2e53  equirementsmod.S
+00005230: 4841 5245 5341 4645 5f52 4551 5549 5245  HARESAFE_REQUIRE
+00005240: 4d45 4e54 2069 6e20 736f 7572 6365 7265  MENT in sourcere
+00005250: 7175 6972 6573 3a0a 2020 2020 2020 2020  quires:.        
+00005260: 2020 2020 6d69 736d 6174 6368 5f63 6f6e      mismatch_con
+00005270: 6669 6720 3d20 7569 2e63 6f6e 6669 6728  fig = ui.config(
+00005280: 6227 7368 6172 6527 2c20 6227 7361 6665  b'share', b'safe
+00005290: 2d6d 6973 6d61 7463 682e 736f 7572 6365  -mismatch.source
+000052a0: 2d73 6166 6527 290a 2020 2020 2020 2020  -safe').        
+000052b0: 2020 2020 6d69 736d 6174 6368 5f77 6172      mismatch_war
+000052c0: 6e20 3d20 7569 2e63 6f6e 6669 6762 6f6f  n = ui.configboo
+000052d0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+000052e0: 2020 2062 2773 6861 7265 272c 2062 2773     b'share', b's
+000052f0: 6166 652d 6d69 736d 6174 6368 2e73 6f75  afe-mismatch.sou
+00005300: 7263 652d 7361 6665 2e77 6172 6e27 0a20  rce-safe.warn'. 
+00005310: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00005320: 2020 2020 2020 2020 206d 6973 6d61 7463           mismatc
+00005330: 685f 7665 7262 6f73 655f 7570 6772 6164  h_verbose_upgrad
+00005340: 6520 3d20 7569 2e63 6f6e 6669 6762 6f6f  e = ui.configboo
+00005350: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+00005360: 2020 2062 2773 6861 7265 272c 2062 2773     b'share', b's
+00005370: 6166 652d 6d69 736d 6174 6368 2e73 6f75  afe-mismatch.sou
+00005380: 7263 652d 7361 6665 3a76 6572 626f 7365  rce-safe:verbose
+00005390: 2d75 7067 7261 6465 270a 2020 2020 2020  -upgrade'.      
+000053a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000053b0: 2020 2020 6966 206d 6973 6d61 7463 685f      if mismatch_
+000053c0: 636f 6e66 6967 2069 6e20 280a 2020 2020  config in (.    
+000053d0: 2020 2020 2020 2020 2020 2020 6227 7570              b'up
+000053e0: 6772 6164 652d 616c 6c6f 7727 2c0a 2020  grade-allow',.  
+000053f0: 2020 2020 2020 2020 2020 2020 2020 6227                b'
+00005400: 616c 6c6f 7727 2c0a 2020 2020 2020 2020  allow',.        
+00005410: 2020 2020 2020 2020 6227 7570 6772 6164          b'upgrad
+00005420: 652d 6162 6f72 7427 2c0a 2020 2020 2020  e-abort',.      
+00005430: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+00005440: 2020 2020 2020 2020 2023 2070 7265 7665           # preve
+00005450: 6e74 2063 7963 6c69 6320 696d 706f 7274  nt cyclic import
+00005460: 206c 6f63 616c 7265 706f 202d 3e20 7570   localrepo -> up
+00005470: 6772 6164 6520 2d3e 206c 6f63 616c 7265  grade -> localre
+00005480: 706f 0a20 2020 2020 2020 2020 2020 2020  po.             
+00005490: 2020 2066 726f 6d20 2e20 696d 706f 7274     from . import
+000054a0: 2075 7067 7261 6465 0a0a 2020 2020 2020   upgrade..      
+000054b0: 2020 2020 2020 2020 2020 7570 6772 6164            upgrad
+000054c0: 652e 7570 6772 6164 655f 7368 6172 655f  e.upgrade_share_
+000054d0: 746f 5f73 6166 6528 0a20 2020 2020 2020  to_safe(.       
+000054e0: 2020 2020 2020 2020 2020 2020 2075 692c               ui,
+000054f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005500: 2020 2020 2068 6776 6673 2c0a 2020 2020       hgvfs,.    
+00005510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005520: 7374 6f72 6576 6673 2c0a 2020 2020 2020  storevfs,.      
+00005530: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00005540: 7175 6972 656d 656e 7473 2c0a 2020 2020  quirements,.    
+00005550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005560: 6d69 736d 6174 6368 5f63 6f6e 6669 672c  mismatch_config,
+00005570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005580: 2020 2020 206d 6973 6d61 7463 685f 7761       mismatch_wa
+00005590: 726e 2c0a 2020 2020 2020 2020 2020 2020  rn,.            
+000055a0: 2020 2020 2020 2020 6d69 736d 6174 6368          mismatch
+000055b0: 5f76 6572 626f 7365 5f75 7067 7261 6465  _verbose_upgrade
+000055c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000055d0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+000055e0: 656c 6966 206d 6973 6d61 7463 685f 636f  elif mismatch_co
+000055f0: 6e66 6967 203d 3d20 6227 6162 6f72 7427  nfig == b'abort'
+00005600: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005610: 2020 7261 6973 6520 6572 726f 722e 4162    raise error.Ab
+00005620: 6f72 7428 0a20 2020 2020 2020 2020 2020  ort(.           
+00005630: 2020 2020 2020 2020 205f 280a 2020 2020           _(.    
+00005640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005650: 2020 2020 6227 7665 7273 696f 6e20 6d69      b'version mi
+00005660: 736d 6174 6368 3a20 736f 7572 6365 2075  smatch: source u
+00005670: 7365 7320 7368 6172 652d 7361 6665 270a  ses share-safe'.
+00005680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005690: 2020 2020 2020 2020 6227 2066 756e 6374          b' funct
+000056a0: 696f 6e61 6c69 7479 2077 6869 6c65 2074  ionality while t
+000056b0: 6865 2063 7572 7265 6e74 2073 6861 7265  he current share
+000056c0: 2064 6f65 7320 6e6f 7427 0a20 2020 2020   does not'.     
+000056d0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000056e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000056f0: 2020 2020 2020 6869 6e74 3d68 696e 742c        hint=hint,
+00005700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005710: 2029 0a20 2020 2020 2020 2020 2020 2065   ).            e
+00005720: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00005730: 2020 2020 2072 6169 7365 2065 7272 6f72       raise error
+00005740: 2e41 626f 7274 280a 2020 2020 2020 2020  .Abort(.        
+00005750: 2020 2020 2020 2020 2020 2020 5f28 0a20              _(. 
+00005760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005770: 2020 2020 2020 2062 2273 6861 7265 2d73         b"share-s
+00005780: 6166 6520 6d69 736d 6174 6368 2077 6974  afe mismatch wit
+00005790: 6820 736f 7572 6365 2e5c 6e55 6e72 6563  h source.\nUnrec
+000057a0: 6f67 6e69 7a65 6422 0a20 2020 2020 2020  ognized".       
+000057b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000057c0: 2062 2220 7661 6c75 6520 2725 7327 206f   b" value '%s' o
+000057d0: 6620 6073 6861 7265 2e73 6166 652d 6d69  f `share.safe-mi
+000057e0: 736d 6174 6368 2e73 6f75 7263 652d 7361  smatch.source-sa
+000057f0: 6665 6020 7365 742e 220a 2020 2020 2020  fe` set.".      
+00005800: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00005810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005820: 2020 2020 2520 6d69 736d 6174 6368 5f63      % mismatch_c
+00005830: 6f6e 6669 672c 0a20 2020 2020 2020 2020  onfig,.         
+00005840: 2020 2020 2020 2020 2020 2068 696e 743d             hint=
+00005850: 6869 6e74 2c0a 2020 2020 2020 2020 2020  hint,.          
+00005860: 2020 2020 2020 290a 0a20 2020 2023 2054        )..    # T
+00005870: 6865 202e 6867 2f68 6772 6320 6669 6c65  he .hg/hgrc file
+00005880: 206d 6179 206c 6f61 6420 6578 7465 6e73   may load extens
+00005890: 696f 6e73 206f 7220 636f 6e74 6169 6e20  ions or contain 
+000058a0: 636f 6e66 6967 206f 7074 696f 6e73 0a20  config options. 
+000058b0: 2020 2023 2074 6861 7420 696e 666c 7565     # that influe
+000058c0: 6e63 6520 7265 706f 7369 746f 7279 2063  nce repository c
+000058d0: 6f6e 7374 7275 6374 696f 6e2e 2041 7474  onstruction. Att
+000058e0: 656d 7074 2074 6f20 6c6f 6164 2069 7420  empt to load it 
+000058f0: 616e 640a 2020 2020 2320 7072 6f63 6573  and.    # proces
+00005900: 7320 616e 7920 6e65 7720 6578 7465 6e73  s any new extens
+00005910: 696f 6e73 2074 6861 7420 6974 206d 6179  ions that it may
+00005920: 2068 6176 6520 7075 6c6c 6564 2069 6e2e   have pulled in.
+00005930: 0a20 2020 2069 6620 6c6f 6164 6867 7263  .    if loadhgrc
+00005940: 2875 692c 2077 6469 7276 6673 2c20 6867  (ui, wdirvfs, hg
+00005950: 7666 732c 2072 6571 7569 7265 6d65 6e74  vfs, requirement
+00005960: 732c 2073 6861 7265 6476 6673 293a 0a20  s, sharedvfs):. 
+00005970: 2020 2020 2020 2061 6674 6572 6867 7263         afterhgrc
+00005980: 6c6f 6164 2875 692c 2077 6469 7276 6673  load(ui, wdirvfs
+00005990: 2c20 6867 7666 732c 2072 6571 7569 7265  , hgvfs, require
+000059a0: 6d65 6e74 7329 0a20 2020 2020 2020 2065  ments).        e
+000059b0: 7874 656e 7369 6f6e 732e 6c6f 6164 616c  xtensions.loadal
+000059c0: 6c28 7569 290a 2020 2020 2020 2020 6578  l(ui).        ex
+000059d0: 7465 6e73 696f 6e73 2e70 6f70 756c 6174  tensions.populat
+000059e0: 6575 6928 7569 290a 0a20 2020 2023 2053  eui(ui)..    # S
+000059f0: 6574 206f 6620 6d6f 6475 6c65 206e 616d  et of module nam
+00005a00: 6573 206f 6620 6578 7465 6e73 696f 6e73  es of extensions
+00005a10: 206c 6f61 6465 6420 666f 7220 7468 6973   loaded for this
+00005a20: 2072 6570 6f73 6974 6f72 792e 0a20 2020   repository..   
+00005a30: 2065 7874 656e 7369 6f6e 6d6f 6475 6c65   extensionmodule
+00005a40: 6e61 6d65 7320 3d20 7b6d 2e5f 5f6e 616d  names = {m.__nam
+00005a50: 655f 5f20 666f 7220 6e2c 206d 2069 6e20  e__ for n, m in 
+00005a60: 6578 7465 6e73 696f 6e73 2e65 7874 656e  extensions.exten
+00005a70: 7369 6f6e 7328 7569 297d 0a0a 2020 2020  sions(ui)}..    
+00005a80: 7375 7070 6f72 7465 6472 6571 7569 7265  supportedrequire
+00005a90: 6d65 6e74 7320 3d20 6761 7468 6572 7375  ments = gathersu
+00005aa0: 7070 6f72 7465 6472 6571 7569 7265 6d65  pportedrequireme
+00005ab0: 6e74 7328 7569 290a 0a20 2020 2023 2057  nts(ui)..    # W
+00005ac0: 6520 6669 7273 7420 7661 6c69 6461 7465  e first validate
+00005ad0: 2074 6865 2072 6571 7569 7265 6d65 6e74   the requirement
+00005ae0: 7320 6172 6520 6b6e 6f77 6e2e 0a20 2020  s are known..   
+00005af0: 2065 6e73 7572 6572 6571 7569 7265 6d65   ensurerequireme
+00005b00: 6e74 7372 6563 6f67 6e69 7a65 6428 7265  ntsrecognized(re
+00005b10: 7175 6972 656d 656e 7473 2c20 7375 7070  quirements, supp
+00005b20: 6f72 7465 6472 6571 7569 7265 6d65 6e74  ortedrequirement
+00005b30: 7329 0a0a 2020 2020 2320 5468 656e 2077  s)..    # Then w
+00005b40: 6520 7661 6c69 6461 7465 2074 6861 7420  e validate that 
+00005b50: 7468 6520 6b6e 6f77 6e20 7365 7420 6973  the known set is
+00005b60: 2072 6561 736f 6e61 626c 6520 746f 2075   reasonable to u
+00005b70: 7365 2074 6f67 6574 6865 722e 0a20 2020  se together..   
+00005b80: 2065 6e73 7572 6572 6571 7569 7265 6d65   ensurerequireme
+00005b90: 6e74 7363 6f6d 7061 7469 626c 6528 7569  ntscompatible(ui
+00005ba0: 2c20 7265 7175 6972 656d 656e 7473 290a  , requirements).
+00005bb0: 0a20 2020 2023 2054 4f44 4f20 7468 6572  .    # TODO ther
+00005bc0: 6520 6172 6520 756e 6861 6e64 6c65 6420  e are unhandled 
+00005bd0: 6564 6765 2063 6173 6573 2072 656c 6174  edge cases relat
+00005be0: 6564 2074 6f20 6f70 656e 696e 6720 7265  ed to opening re
+00005bf0: 706f 7369 746f 7269 6573 2077 6974 680a  positories with.
+00005c00: 2020 2020 2320 7368 6172 6564 2073 746f      # shared sto
+00005c10: 7261 6765 2e20 4966 2073 746f 7261 6765  rage. If storage
+00005c20: 2069 7320 7368 6172 6564 2c20 7765 2073   is shared, we s
+00005c30: 686f 756c 6420 616c 736f 2074 6573 7420  hould also test 
+00005c40: 666f 7220 7265 7175 6972 656d 656e 7473  for requirements
+00005c50: 0a20 2020 2023 2063 6f6d 7061 7469 6269  .    # compatibi
+00005c60: 6c69 7479 2069 6e20 7468 6520 706f 696e  lity in the poin
+00005c70: 7465 642d 746f 2072 6570 6f2e 2054 6869  ted-to repo. Thi
+00005c80: 7320 656e 7461 696c 7320 6c6f 6164 696e  s entails loadin
+00005c90: 6720 7468 6520 2e68 672f 6867 7263 2069  g the .hg/hgrc i
+00005ca0: 6e0a 2020 2020 2320 7468 6174 2072 6570  n.    # that rep
+00005cb0: 6f2c 2061 7320 7468 6174 2072 6570 6f20  o, as that repo 
+00005cc0: 6d61 7920 6c6f 6164 2065 7874 656e 7369  may load extensi
+00005cd0: 6f6e 7320 6e65 6564 6564 2074 6f20 6f70  ons needed to op
+00005ce0: 656e 2069 742e 2054 6869 7320 6973 2061  en it. This is a
+00005cf0: 0a20 2020 2023 2062 6974 2063 6f6d 706c  .    # bit compl
+00005d00: 6963 6174 6564 2062 6563 6175 7365 2077  icated because w
+00005d10: 6520 646f 6e27 7420 7761 6e74 2074 6865  e don't want the
+00005d20: 206f 7468 6572 2068 6772 6320 746f 206f   other hgrc to o
+00005d30: 7665 7277 7269 7465 2073 6574 7469 6e67  verwrite setting
+00005d40: 730a 2020 2020 2320 696e 2074 6869 7320  s.    # in this 
+00005d50: 6867 7263 2e0a 2020 2020 230a 2020 2020  hgrc..    #.    
+00005d60: 2320 5468 6973 2062 7567 2069 7320 736f  # This bug is so
+00005d70: 6d65 7768 6174 206d 6974 6967 6174 6564  mewhat mitigated
+00005d80: 2062 7920 7468 6520 6661 6374 2074 6861   by the fact tha
+00005d90: 7420 7765 2063 6f70 7920 7468 6520 2e68  t we copy the .h
+00005da0: 672f 7265 7175 6972 6573 0a20 2020 2023  g/requires.    #
+00005db0: 2066 696c 6520 7768 656e 2073 6861 7269   file when shari
+00005dc0: 6e67 2072 6570 6f73 2e20 4275 7420 6966  ng repos. But if
+00005dd0: 2061 2072 6571 7569 7265 6d65 6e74 2069   a requirement i
+00005de0: 7320 6164 6465 6420 6166 7465 7220 7468  s added after th
+00005df0: 6520 7368 6172 6520 6973 0a20 2020 2023  e share is.    #
+00005e00: 2070 6572 666f 726d 6564 2c20 7468 6572   performed, ther
+00005e10: 6562 7920 696e 7472 6f64 7563 696e 6720  eby introducing 
+00005e20: 6120 6e65 7720 7265 7175 6972 656d 656e  a new requiremen
+00005e30: 7420 666f 7220 7468 6520 6f70 656e 6572  t for the opener
+00005e40: 2c20 7765 206d 6179 0a20 2020 2023 2077  , we may.    # w
+00005e50: 696c 6c20 6e6f 7420 7365 6520 7468 6174  ill not see that
+00005e60: 2061 6e64 2063 6f75 6c64 2065 6e63 6f75   and could encou
+00005e70: 6e74 6572 2061 2072 756e 2d74 696d 6520  nter a run-time 
+00005e80: 6572 726f 7220 696e 7465 7261 6374 696e  error interactin
+00005e90: 6720 7769 7468 0a20 2020 2023 2074 6861  g with.    # tha
+00005ea0: 7420 7368 6172 6564 2073 746f 7265 2073  t shared store s
+00005eb0: 696e 6365 2069 7420 6861 7320 616e 2075  ince it has an u
+00005ec0: 6e6b 6e6f 776e 2d74 6f2d 7573 2072 6571  nknown-to-us req
+00005ed0: 7569 7265 6d65 6e74 2e0a 0a20 2020 2023  uirement...    #
+00005ee0: 2041 7420 7468 6973 2070 6f69 6e74 2c20   At this point, 
+00005ef0: 7765 206b 6e6f 7720 7765 2073 686f 756c  we know we shoul
+00005f00: 6420 6265 2063 6170 6162 6c65 206f 6620  d be capable of 
+00005f10: 6f70 656e 696e 6720 7468 6520 7265 706f  opening the repo
+00005f20: 7369 746f 7279 2e0a 2020 2020 2320 4e6f  sitory..    # No
+00005f30: 7720 6765 7420 6f6e 2077 6974 6820 646f  w get on with do
+00005f40: 696e 6720 7468 6174 2e0a 0a20 2020 2066  ing that...    f
+00005f50: 6561 7475 7265 7320 3d20 7365 7428 290a  eatures = set().
+00005f60: 0a20 2020 2023 2054 6865 2022 7374 6f72  .    # The "stor
+00005f70: 6522 2070 6172 7420 6f66 2074 6865 2072  e" part of the r
+00005f80: 6570 6f73 6974 6f72 7920 686f 6c64 7320  epository holds 
+00005f90: 7665 7273 696f 6e65 6420 6461 7461 2e20  versioned data. 
+00005fa0: 486f 7720 6974 2069 730a 2020 2020 2320  How it is.    # 
+00005fb0: 6163 6365 7373 6564 2069 7320 6465 7465  accessed is dete
+00005fc0: 726d 696e 6564 2062 7920 7661 7269 6f75  rmined by variou
+00005fd0: 7320 7265 7175 6972 656d 656e 7473 2e20  s requirements. 
+00005fe0: 4966 2060 7368 6172 6564 6020 6f72 0a20  If `shared` or. 
+00005ff0: 2020 2023 2060 7265 6c73 6861 7265 6460     # `relshared`
+00006000: 2072 6571 7569 7265 6d65 6e74 7320 6172   requirements ar
+00006010: 6520 7072 6573 656e 742c 2074 6869 7320  e present, this 
+00006020: 696e 6469 6361 7465 7320 6375 7272 656e  indicates curren
+00006030: 7420 7265 706f 7369 746f 7279 0a20 2020  t repository.   
+00006040: 2023 2069 7320 6120 7368 6172 6520 616e   # is a share an
+00006050: 6420 7374 6f72 6520 6578 6973 7473 2069  d store exists i
+00006060: 6e20 7061 7468 206d 656e 7469 6f6e 6564  n path mentioned
+00006070: 2069 6e20 602e 6867 2f73 6861 7265 6470   in `.hg/sharedp
+00006080: 6174 6860 0a20 2020 2069 6620 7368 6172  ath`.    if shar
+00006090: 6564 3a0a 2020 2020 2020 2020 7374 6f72  ed:.        stor
+000060a0: 6562 6173 6570 6174 6820 3d20 7368 6172  ebasepath = shar
+000060b0: 6564 7666 732e 6261 7365 0a20 2020 2020  edvfs.base.     
+000060c0: 2020 2063 6163 6865 7061 7468 203d 2073     cachepath = s
+000060d0: 6861 7265 6476 6673 2e6a 6f69 6e28 6227  haredvfs.join(b'
+000060e0: 6361 6368 6527 290a 2020 2020 2020 2020  cache').        
+000060f0: 6665 6174 7572 6573 2e61 6464 2872 6570  features.add(rep
+00006100: 6f73 6974 6f72 792e 5245 504f 5f46 4541  ository.REPO_FEA
+00006110: 5455 5245 5f53 4841 5245 445f 5354 4f52  TURE_SHARED_STOR
+00006120: 4147 4529 0a20 2020 2065 6c73 653a 0a20  AGE).    else:. 
+00006130: 2020 2020 2020 2073 746f 7265 6261 7365         storebase
+00006140: 7061 7468 203d 2068 6776 6673 2e62 6173  path = hgvfs.bas
+00006150: 650a 2020 2020 2020 2020 6361 6368 6570  e.        cachep
+00006160: 6174 6820 3d20 6867 7666 732e 6a6f 696e  ath = hgvfs.join
+00006170: 2862 2763 6163 6865 2729 0a20 2020 2077  (b'cache').    w
+00006180: 6361 6368 6570 6174 6820 3d20 6867 7666  cachepath = hgvf
+00006190: 732e 6a6f 696e 2862 2777 6361 6368 6527  s.join(b'wcache'
+000061a0: 290a 0a20 2020 2023 2054 6865 2073 746f  )..    # The sto
+000061b0: 7265 2068 6173 2063 6861 6e67 6564 206f  re has changed o
+000061c0: 7665 7220 7469 6d65 2061 6e64 2074 6865  ver time and the
+000061d0: 2065 7861 6374 206c 6179 6f75 7420 6973   exact layout is
+000061e0: 2064 6963 7461 7465 6420 6279 0a20 2020   dictated by.   
+000061f0: 2023 2072 6571 7569 7265 6d65 6e74 732e   # requirements.
+00006200: 2054 6865 2073 746f 7265 2069 6e74 6572   The store inter
+00006210: 6661 6365 2061 6273 7472 6163 7473 2064  face abstracts d
+00006220: 6966 6665 7265 6e63 6573 2061 6372 6f73  ifferences acros
+00006230: 7320 616c 6c0a 2020 2020 2320 6f66 2074  s all.    # of t
+00006240: 6865 6d2e 0a20 2020 2073 746f 7265 203d  hem..    store =
+00006250: 206d 616b 6573 746f 7265 280a 2020 2020   makestore(.    
+00006260: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
+00006270: 2c0a 2020 2020 2020 2020 7374 6f72 6562  ,.        storeb
+00006280: 6173 6570 6174 682c 0a20 2020 2020 2020  asepath,.       
+00006290: 206c 616d 6264 6120 6261 7365 3a20 7666   lambda base: vf
+000062a0: 736d 6f64 2e76 6673 2862 6173 652c 2063  smod.vfs(base, c
+000062b0: 6163 6865 6175 6469 7465 643d 5472 7565  acheaudited=True
+000062c0: 292c 0a20 2020 2029 0a20 2020 2068 6776  ),.    ).    hgv
+000062d0: 6673 2e63 7265 6174 656d 6f64 6520 3d20  fs.createmode = 
+000062e0: 7374 6f72 652e 6372 6561 7465 6d6f 6465  store.createmode
+000062f0: 0a0a 2020 2020 7374 6f72 6576 6673 203d  ..    storevfs =
+00006300: 2073 746f 7265 2e76 6673 0a20 2020 2073   store.vfs.    s
+00006310: 746f 7265 7666 732e 6f70 7469 6f6e 7320  torevfs.options 
+00006320: 3d20 7265 736f 6c76 6573 746f 7265 7666  = resolvestorevf
+00006330: 736f 7074 696f 6e73 2875 692c 2072 6571  soptions(ui, req
+00006340: 7569 7265 6d65 6e74 732c 2066 6561 7475  uirements, featu
+00006350: 7265 7329 0a0a 2020 2020 6966 2028 0a20  res)..    if (. 
+00006360: 2020 2020 2020 2072 6571 7569 7265 6d65         requireme
+00006370: 6e74 736d 6f64 2e52 4556 4c4f 4756 325f  ntsmod.REVLOGV2_
+00006380: 5245 5155 4952 454d 454e 5420 696e 2072  REQUIREMENT in r
+00006390: 6571 7569 7265 6d65 6e74 730a 2020 2020  equirements.    
+000063a0: 2020 2020 6f72 2072 6571 7569 7265 6d65      or requireme
+000063b0: 6e74 736d 6f64 2e43 4841 4e47 454c 4f47  ntsmod.CHANGELOG
+000063c0: 5632 5f52 4551 5549 5245 4d45 4e54 2069  V2_REQUIREMENT i
+000063d0: 6e20 7265 7175 6972 656d 656e 7473 0a20  n requirements. 
+000063e0: 2020 2029 3a0a 2020 2020 2020 2020 6665     ):.        fe
+000063f0: 6174 7572 6573 2e61 6464 2872 6570 6f73  atures.add(repos
+00006400: 6974 6f72 792e 5245 504f 5f46 4541 5455  itory.REPO_FEATU
+00006410: 5245 5f53 4944 455f 4441 5441 290a 2020  RE_SIDE_DATA).  
+00006420: 2020 2020 2020 2320 7468 6520 7265 766c        # the revl
+00006430: 6f67 7632 2064 6f63 6b65 7420 696e 7472  ogv2 docket intr
+00006440: 6f64 7563 6564 2072 6163 6520 636f 6e64  oduced race cond
+00006450: 6974 696f 6e20 7468 6174 2077 6520 6e65  ition that we ne
+00006460: 6564 2074 6f20 6669 780a 2020 2020 2020  ed to fix.      
+00006470: 2020 6665 6174 7572 6573 2e64 6973 6361    features.disca
+00006480: 7264 2872 6570 6f73 6974 6f72 792e 5245  rd(repository.RE
+00006490: 504f 5f46 4541 5455 5245 5f53 5452 4541  PO_FEATURE_STREA
+000064a0: 4d5f 434c 4f4e 4529 0a0a 2020 2020 2320  M_CLONE)..    # 
+000064b0: 5468 6520 6361 6368 6520 7666 7320 6973  The cache vfs is
+000064c0: 2075 7365 6420 746f 206d 616e 6167 6520   used to manage 
+000064d0: 6361 6368 6520 6669 6c65 732e 0a20 2020  cache files..   
+000064e0: 2063 6163 6865 7666 7320 3d20 7666 736d   cachevfs = vfsm
+000064f0: 6f64 2e76 6673 2863 6163 6865 7061 7468  od.vfs(cachepath
+00006500: 2c20 6361 6368 6561 7564 6974 6564 3d54  , cacheaudited=T
+00006510: 7275 6529 0a20 2020 2063 6163 6865 7666  rue).    cachevf
+00006520: 732e 6372 6561 7465 6d6f 6465 203d 2073  s.createmode = s
+00006530: 746f 7265 2e63 7265 6174 656d 6f64 650a  tore.createmode.
+00006540: 2020 2020 2320 5468 6520 6361 6368 6520      # The cache 
+00006550: 7666 7320 6973 2075 7365 6420 746f 206d  vfs is used to m
+00006560: 616e 6167 6520 6361 6368 6520 6669 6c65  anage cache file
+00006570: 7320 7265 6c61 7465 6420 746f 2074 6865  s related to the
+00006580: 2077 6f72 6b69 6e67 2063 6f70 790a 2020   working copy.  
+00006590: 2020 7763 6163 6865 7666 7320 3d20 7666    wcachevfs = vf
+000065a0: 736d 6f64 2e76 6673 2877 6361 6368 6570  smod.vfs(wcachep
+000065b0: 6174 682c 2063 6163 6865 6175 6469 7465  ath, cacheaudite
+000065c0: 643d 5472 7565 290a 2020 2020 7763 6163  d=True).    wcac
+000065d0: 6865 7666 732e 6372 6561 7465 6d6f 6465  hevfs.createmode
+000065e0: 203d 2073 746f 7265 2e63 7265 6174 656d   = store.createm
+000065f0: 6f64 650a 0a20 2020 2023 204e 6f77 2072  ode..    # Now r
+00006600: 6573 6f6c 7665 2074 6865 2074 7970 6520  esolve the type 
+00006610: 666f 7220 7468 6520 7265 706f 7369 746f  for the reposito
+00006620: 7279 206f 626a 6563 742e 2057 6520 646f  ry object. We do
+00006630: 2074 6869 7320 6279 2072 6570 6561 7465   this by repeate
+00006640: 646c 790a 2020 2020 2320 6361 6c6c 696e  dly.    # callin
+00006650: 6720 6120 6661 6374 6f72 7920 6675 6e63  g a factory func
+00006660: 7469 6f6e 2074 6f20 7072 6f64 7563 6573  tion to produces
+00006670: 2074 7970 6573 2066 6f72 2073 7065 6369   types for speci
+00006680: 6669 6320 6173 7065 6374 7320 6f66 2074  fic aspects of t
+00006690: 6865 0a20 2020 2023 2072 6570 6f27 7320  he.    # repo's 
+000066a0: 6f70 6572 6174 696f 6e2e 2054 6865 2061  operation. The a
+000066b0: 6767 7265 6761 7465 2072 6574 7572 6e65  ggregate returne
+000066c0: 6420 7479 7065 7320 6172 6520 7573 6564  d types are used
+000066d0: 2061 7320 6261 7365 2063 6c61 7373 6573   as base classes
+000066e0: 0a20 2020 2023 2066 6f72 2061 2064 796e  .    # for a dyn
+000066f0: 616d 6963 616c 6c79 2d64 6572 6976 6564  amically-derived
+00006700: 2074 7970 652c 2077 6869 6368 2077 696c   type, which wil
+00006710: 6c20 7265 7072 6573 656e 7420 6f75 7220  l represent our 
+00006720: 6e65 7720 7265 706f 7369 746f 7279 2e0a  new repository..
+00006730: 0a20 2020 2062 6173 6573 203d 205b 5d0a  .    bases = [].
+00006740: 2020 2020 6578 7472 6173 7461 7465 203d      extrastate =
+00006750: 207b 7d0a 0a20 2020 2066 6f72 2069 6661   {}..    for ifa
+00006760: 6365 2c20 666e 2069 6e20 5245 504f 5f49  ce, fn in REPO_I
+00006770: 4e54 4552 4641 4345 533a 0a20 2020 2020  NTERFACES:.     
+00006780: 2020 2023 2057 6520 7061 7373 2061 6c6c     # We pass all
+00006790: 2070 6f74 656e 7469 616c 6c79 2075 7365   potentially use
+000067a0: 6675 6c20 7374 6174 6520 746f 2067 6976  ful state to giv
+000067b0: 6520 6578 7465 6e73 696f 6e73 2074 6f6e  e extensions ton
+000067c0: 7320 6f66 0a20 2020 2020 2020 2023 2066  s of.        # f
+000067d0: 6c65 7869 6269 6c69 7479 2e0a 2020 2020  lexibility..    
+000067e0: 2020 2020 7479 7020 3d20 666e 2829 280a      typ = fn()(.
+000067f0: 2020 2020 2020 2020 2020 2020 7569 3d75              ui=u
+00006800: 692c 0a20 2020 2020 2020 2020 2020 2069  i,.            i
+00006810: 6e74 656e 7473 3d69 6e74 656e 7473 2c0a  ntents=intents,.
+00006820: 2020 2020 2020 2020 2020 2020 7265 7175              requ
+00006830: 6972 656d 656e 7473 3d72 6571 7569 7265  irements=require
+00006840: 6d65 6e74 732c 0a20 2020 2020 2020 2020  ments,.         
+00006850: 2020 2066 6561 7475 7265 733d 6665 6174     features=feat
+00006860: 7572 6573 2c0a 2020 2020 2020 2020 2020  ures,.          
+00006870: 2020 7764 6972 7666 733d 7764 6972 7666    wdirvfs=wdirvf
+00006880: 732c 0a20 2020 2020 2020 2020 2020 2068  s,.            h
+00006890: 6776 6673 3d68 6776 6673 2c0a 2020 2020  gvfs=hgvfs,.    
+000068a0: 2020 2020 2020 2020 7374 6f72 653d 7374          store=st
+000068b0: 6f72 652c 0a20 2020 2020 2020 2020 2020  ore,.           
+000068c0: 2073 746f 7265 7666 733d 7374 6f72 6576   storevfs=storev
+000068d0: 6673 2c0a 2020 2020 2020 2020 2020 2020  fs,.            
+000068e0: 7374 6f72 656f 7074 696f 6e73 3d73 746f  storeoptions=sto
+000068f0: 7265 7666 732e 6f70 7469 6f6e 732c 0a20  revfs.options,. 
+00006900: 2020 2020 2020 2020 2020 2063 6163 6865             cache
+00006910: 7666 733d 6361 6368 6576 6673 2c0a 2020  vfs=cachevfs,.  
+00006920: 2020 2020 2020 2020 2020 7763 6163 6865            wcache
+00006930: 7666 733d 7763 6163 6865 7666 732c 0a20  vfs=wcachevfs,. 
+00006940: 2020 2020 2020 2020 2020 2065 7874 656e             exten
+00006950: 7369 6f6e 6d6f 6475 6c65 6e61 6d65 733d  sionmodulenames=
+00006960: 6578 7465 6e73 696f 6e6d 6f64 756c 656e  extensionmodulen
+00006970: 616d 6573 2c0a 2020 2020 2020 2020 2020  ames,.          
+00006980: 2020 6578 7472 6173 7461 7465 3d65 7874    extrastate=ext
+00006990: 7261 7374 6174 652c 0a20 2020 2020 2020  rastate,.       
+000069a0: 2020 2020 2062 6173 6563 6c61 7373 6573       baseclasses
+000069b0: 3d62 6173 6573 2c0a 2020 2020 2020 2020  =bases,.        
+000069c0: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+000069d0: 7420 6973 696e 7374 616e 6365 2874 7970  t isinstance(typ
+000069e0: 2c20 7479 7065 293a 0a20 2020 2020 2020  , type):.       
+000069f0: 2020 2020 2072 6169 7365 2065 7272 6f72       raise error
+00006a00: 2e50 726f 6772 616d 6d69 6e67 4572 726f  .ProgrammingErro
+00006a10: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00006a20: 2020 2062 2775 6e61 626c 6520 746f 2063     b'unable to c
+00006a30: 6f6e 7374 7275 6374 2074 7970 6520 666f  onstruct type fo
+00006a40: 7220 2573 2720 2520 6966 6163 650a 2020  r %s' % iface.  
+00006a50: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00006a60: 2020 2020 2062 6173 6573 2e61 7070 656e       bases.appen
+00006a70: 6428 7479 7029 0a0a 2020 2020 2320 7479  d(typ)..    # ty
+00006a80: 7065 2829 2061 6c6c 6f77 7320 796f 7520  pe() allows you 
+00006a90: 746f 2075 7365 2063 6861 7261 6374 6572  to use character
+00006aa0: 7320 696e 2074 7970 6520 6e61 6d65 7320  s in type names 
+00006ab0: 7468 6174 2077 6f75 6c64 6e27 7420 6265  that wouldn't be
+00006ac0: 0a20 2020 2023 2072 6563 6f67 6e69 7a65  .    # recognize
+00006ad0: 6420 6173 2050 7974 686f 6e20 7379 6d62  d as Python symb
+00006ae0: 6f6c 7320 696e 2073 6f75 7263 6520 636f  ols in source co
+00006af0: 6465 2e20 5765 2061 6275 7365 2074 6861  de. We abuse tha
+00006b00: 7420 746f 2061 6464 0a20 2020 2023 2072  t to add.    # r
+00006b10: 6963 6820 696e 666f 726d 6174 696f 6e20  ich information 
+00006b20: 6162 6f75 7420 6f75 7220 636f 6e73 7472  about our constr
+00006b30: 7563 7465 6420 7265 706f 2e0a 2020 2020  ucted repo..    
+00006b40: 6e61 6d65 203d 2070 7963 6f6d 7061 742e  name = pycompat.
+00006b50: 7379 7373 7472 280a 2020 2020 2020 2020  sysstr(.        
+00006b60: 6227 6465 7269 7665 6472 6570 6f3a 2573  b'derivedrepo:%s
+00006b70: 3c25 733e 2720 2520 2877 6469 7276 6673  <%s>' % (wdirvfs
+00006b80: 2e62 6173 652c 2062 272c 272e 6a6f 696e  .base, b','.join
+00006b90: 2873 6f72 7465 6428 7265 7175 6972 656d  (sorted(requirem
+00006ba0: 656e 7473 2929 290a 2020 2020 290a 0a20  ents))).    ).. 
+00006bb0: 2020 2063 6c73 203d 2074 7970 6528 6e61     cls = type(na
+00006bc0: 6d65 2c20 7475 706c 6528 6261 7365 7329  me, tuple(bases)
+00006bd0: 2c20 7b7d 290a 0a20 2020 2072 6574 7572  , {})..    retur
+00006be0: 6e20 636c 7328 0a20 2020 2020 2020 2062  n cls(.        b
+00006bf0: 6173 6575 693d 6261 7365 7569 2c0a 2020  aseui=baseui,.  
+00006c00: 2020 2020 2020 7569 3d75 692c 0a20 2020        ui=ui,.   
+00006c10: 2020 2020 206f 7269 6772 6f6f 743d 7061       origroot=pa
+00006c20: 7468 2c0a 2020 2020 2020 2020 7764 6972  th,.        wdir
+00006c30: 7666 733d 7764 6972 7666 732c 0a20 2020  vfs=wdirvfs,.   
+00006c40: 2020 2020 2068 6776 6673 3d68 6776 6673       hgvfs=hgvfs
+00006c50: 2c0a 2020 2020 2020 2020 7265 7175 6972  ,.        requir
+00006c60: 656d 656e 7473 3d72 6571 7569 7265 6d65  ements=requireme
+00006c70: 6e74 732c 0a20 2020 2020 2020 2073 7570  nts,.        sup
+00006c80: 706f 7274 6564 7265 7175 6972 656d 656e  portedrequiremen
+00006c90: 7473 3d73 7570 706f 7274 6564 7265 7175  ts=supportedrequ
+00006ca0: 6972 656d 656e 7473 2c0a 2020 2020 2020  irements,.      
+00006cb0: 2020 7368 6172 6564 7061 7468 3d73 746f    sharedpath=sto
+00006cc0: 7265 6261 7365 7061 7468 2c0a 2020 2020  rebasepath,.    
+00006cd0: 2020 2020 7374 6f72 653d 7374 6f72 652c      store=store,
+00006ce0: 0a20 2020 2020 2020 2063 6163 6865 7666  .        cachevf
+00006cf0: 733d 6361 6368 6576 6673 2c0a 2020 2020  s=cachevfs,.    
+00006d00: 2020 2020 7763 6163 6865 7666 733d 7763      wcachevfs=wc
+00006d10: 6163 6865 7666 732c 0a20 2020 2020 2020  achevfs,.       
+00006d20: 2066 6561 7475 7265 733d 6665 6174 7572   features=featur
+00006d30: 6573 2c0a 2020 2020 2020 2020 696e 7465  es,.        inte
+00006d40: 6e74 733d 696e 7465 6e74 732c 0a20 2020  nts=intents,.   
+00006d50: 2029 0a0a 0a64 6566 206c 6f61 6468 6772   )...def loadhgr
+00006d60: 6328 0a20 2020 2075 692c 0a20 2020 2077  c(.    ui,.    w
+00006d70: 6469 7276 6673 3a20 7666 736d 6f64 2e76  dirvfs: vfsmod.v
+00006d80: 6673 2c0a 2020 2020 6867 7666 733a 2076  fs,.    hgvfs: v
+00006d90: 6673 6d6f 642e 7666 732c 0a20 2020 2072  fsmod.vfs,.    r
+00006da0: 6571 7569 7265 6d65 6e74 732c 0a20 2020  equirements,.   
+00006db0: 2073 6861 7265 6476 6673 3a20 4f70 7469   sharedvfs: Opti
+00006dc0: 6f6e 616c 5b76 6673 6d6f 642e 7666 735d  onal[vfsmod.vfs]
+00006dd0: 203d 204e 6f6e 652c 0a29 3a0a 2020 2020   = None,.):.    
+00006de0: 2222 224c 6f61 6420 6867 7263 2066 696c  """Load hgrc fil
+00006df0: 6573 2f63 6f6e 7465 6e74 2069 6e74 6f20  es/content into 
+00006e00: 6120 7569 2069 6e73 7461 6e63 652e 0a0a  a ui instance...
+00006e10: 2020 2020 5468 6973 2069 7320 6361 6c6c      This is call
+00006e20: 6564 2064 7572 696e 6720 7265 706f 7369  ed during reposi
+00006e30: 746f 7279 206f 7065 6e69 6e67 2074 6f20  tory opening to 
+00006e40: 6c6f 6164 2061 6e79 2061 6464 6974 696f  load any additio
+00006e50: 6e61 6c0a 2020 2020 636f 6e66 6967 2066  nal.    config f
+00006e60: 696c 6573 206f 7220 7365 7474 696e 6773  iles or settings
+00006e70: 2072 656c 6576 616e 7420 746f 2074 6865   relevant to the
+00006e80: 2063 7572 7265 6e74 2072 6570 6f73 6974   current reposit
+00006e90: 6f72 792e 0a0a 2020 2020 5265 7475 726e  ory...    Return
+00006ea0: 7320 6120 626f 6f6c 2069 6e64 6963 6174  s a bool indicat
+00006eb0: 696e 6720 7768 6574 6865 7220 616e 7920  ing whether any 
+00006ec0: 6164 6469 7469 6f6e 616c 2063 6f6e 6669  additional confi
+00006ed0: 6773 2077 6572 6520 6c6f 6164 6564 2e0a  gs were loaded..
+00006ee0: 0a20 2020 2045 7874 656e 7369 6f6e 7320  .    Extensions 
+00006ef0: 7368 6f75 6c64 206d 6f6e 6b65 7970 6174  should monkeypat
+00006f00: 6368 2074 6869 7320 6675 6e63 7469 6f6e  ch this function
+00006f10: 2074 6f20 6d6f 6469 6679 2068 6f77 2070   to modify how p
+00006f20: 6572 2d72 6570 6f0a 2020 2020 636f 6e66  er-repo.    conf
+00006f30: 6967 7320 6172 6520 6c6f 6164 6564 2e20  igs are loaded. 
+00006f40: 466f 7220 6578 616d 706c 652c 2061 6e20  For example, an 
+00006f50: 6578 7465 6e73 696f 6e20 6d61 7920 7769  extension may wi
+00006f60: 7368 2074 6f20 7075 6c6c 2069 6e0a 2020  sh to pull in.  
+00006f70: 2020 636f 6e66 6967 7320 6672 6f6d 2061    configs from a
+00006f80: 6c74 6572 6e61 7465 2066 696c 6573 206f  lternate files o
+00006f90: 7220 736f 7572 6365 732e 0a0a 2020 2020  r sources...    
+00006fa0: 7368 6172 6564 7666 7320 6973 2076 6673  sharedvfs is vfs
+00006fb0: 206f 626a 6563 7420 706f 696e 7469 6e67   object pointing
+00006fc0: 2074 6f20 736f 7572 6365 2072 6570 6f20   to source repo 
+00006fd0: 6966 2074 6865 2063 7572 7265 6e74 206f  if the current o
+00006fe0: 6e65 2069 7320 610a 2020 2020 7368 6172  ne is a.    shar
+00006ff0: 6564 206f 6e65 0a20 2020 2022 2222 0a20  ed one.    """. 
+00007000: 2020 2069 6620 6e6f 7420 7263 7574 696c     if not rcutil
+00007010: 2e75 7365 5f72 6570 6f5f 6867 7263 2829  .use_repo_hgrc()
+00007020: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00007030: 2046 616c 7365 0a0a 2020 2020 7265 7420   False..    ret 
+00007040: 3d20 4661 6c73 650a 2020 2020 2320 6669  = False.    # fi
+00007050: 7273 7420 6c6f 6164 2063 6f6e 6669 6720  rst load config 
+00007060: 6672 6f6d 2073 6861 7265 6420 736f 7572  from shared sour
+00007070: 6365 2069 6620 7765 2068 6173 2074 6f0a  ce if we has to.
+00007080: 2020 2020 6966 2072 6571 7569 7265 6d65      if requireme
+00007090: 6e74 736d 6f64 2e53 4841 5245 5341 4645  ntsmod.SHARESAFE
+000070a0: 5f52 4551 5549 5245 4d45 4e54 2069 6e20  _REQUIREMENT in 
+000070b0: 7265 7175 6972 656d 656e 7473 2061 6e64  requirements and
+000070c0: 2073 6861 7265 6476 6673 3a0a 2020 2020   sharedvfs:.    
+000070d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000070e0: 2020 2020 2075 692e 7265 6164 636f 6e66       ui.readconf
+000070f0: 6967 2873 6861 7265 6476 6673 2e6a 6f69  ig(sharedvfs.joi
+00007100: 6e28 6227 6867 7263 2729 2c20 726f 6f74  n(b'hgrc'), root
+00007110: 3d73 6861 7265 6476 6673 2e62 6173 6529  =sharedvfs.base)
+00007120: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00007130: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00007140: 6578 6365 7074 2049 4f45 7272 6f72 3a0a  except IOError:.
+00007150: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00007160: 0a0a 2020 2020 7472 793a 0a20 2020 2020  ..    try:.     
+00007170: 2020 2075 692e 7265 6164 636f 6e66 6967     ui.readconfig
+00007180: 2868 6776 6673 2e6a 6f69 6e28 6227 6867  (hgvfs.join(b'hg
+00007190: 7263 2729 2c20 726f 6f74 3d77 6469 7276  rc'), root=wdirv
+000071a0: 6673 2e62 6173 6529 0a20 2020 2020 2020  fs.base).       
+000071b0: 2072 6574 203d 2054 7275 650a 2020 2020   ret = True.    
+000071c0: 6578 6365 7074 2049 4f45 7272 6f72 3a0a  except IOError:.
+000071d0: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
+000071e0: 2020 7472 793a 0a20 2020 2020 2020 2075    try:.        u
+000071f0: 692e 7265 6164 636f 6e66 6967 2868 6776  i.readconfig(hgv
+00007200: 6673 2e6a 6f69 6e28 6227 6867 7263 2d6e  fs.join(b'hgrc-n
+00007210: 6f74 2d73 6861 7265 6427 292c 2072 6f6f  ot-shared'), roo
+00007220: 743d 7764 6972 7666 732e 6261 7365 290a  t=wdirvfs.base).
+00007230: 2020 2020 2020 2020 7265 7420 3d20 5472          ret = Tr
+00007240: 7565 0a20 2020 2065 7863 6570 7420 494f  ue.    except IO
+00007250: 4572 726f 723a 0a20 2020 2020 2020 2070  Error:.        p
+00007260: 6173 730a 0a20 2020 2072 6574 7572 6e20  ass..    return 
+00007270: 7265 740a 0a0a 6465 6620 6166 7465 7268  ret...def afterh
+00007280: 6772 636c 6f61 6428 7569 2c20 7764 6972  grcload(ui, wdir
+00007290: 7666 732c 2068 6776 6673 2c20 7265 7175  vfs, hgvfs, requ
+000072a0: 6972 656d 656e 7473 293a 0a20 2020 2022  irements):.    "
+000072b0: 2222 5065 7266 6f72 6d20 6164 6469 7469  ""Perform additi
+000072c0: 6f6e 616c 2061 6374 696f 6e73 2061 6674  onal actions aft
+000072d0: 6572 202e 6867 2f68 6772 6320 6973 206c  er .hg/hgrc is l
+000072e0: 6f61 6465 642e 0a0a 2020 2020 5468 6973  oaded...    This
+000072f0: 2066 756e 6374 696f 6e20 6973 2063 616c   function is cal
+00007300: 6c65 6420 6475 7269 6e67 2072 6570 6f73  led during repos
+00007310: 6974 6f72 7920 6c6f 6164 696e 6720 696d  itory loading im
+00007320: 6d65 6469 6174 656c 7920 6166 7465 720a  mediately after.
+00007330: 2020 2020 7468 6520 2e68 672f 6867 7263      the .hg/hgrc
+00007340: 2066 696c 6520 6973 206c 6f61 6465 6420   file is loaded 
+00007350: 616e 6420 6265 666f 7265 2070 6572 2d72  and before per-r
+00007360: 6570 6f20 6578 7465 6e73 696f 6e73 2061  epo extensions a
+00007370: 7265 206c 6f61 6465 642e 0a0a 2020 2020  re loaded...    
+00007380: 5468 6520 6675 6e63 7469 6f6e 2063 616e  The function can
+00007390: 2062 6520 7573 6564 2074 6f20 7661 6c69   be used to vali
+000073a0: 6461 7465 2063 6f6e 6669 6773 2c20 6175  date configs, au
+000073b0: 746f 6d61 7469 6361 6c6c 7920 6164 640a  tomatically add.
+000073c0: 2020 2020 6f70 7469 6f6e 7320 2869 6e63      options (inc
+000073d0: 6c75 6469 6e67 2065 7874 656e 7369 6f6e  luding extension
+000073e0: 7329 2062 6173 6564 206f 6e20 7265 7175  s) based on requ
+000073f0: 6972 656d 656e 7473 2c20 6574 632e 0a20  irements, etc.. 
+00007400: 2020 2022 2222 0a0a 2020 2020 2320 4d61     """..    # Ma
+00007410: 7020 6f66 2072 6571 7569 7265 6d65 6e74  p of requirement
+00007420: 7320 746f 206c 6973 7420 6f66 2065 7874  s to list of ext
+00007430: 656e 7369 6f6e 7320 746f 206c 6f61 6420  ensions to load 
+00007440: 6175 746f 6d61 7469 6361 6c6c 7920 7768  automatically wh
+00007450: 656e 0a20 2020 2023 2072 6571 7569 7265  en.    # require
+00007460: 6d65 6e74 2069 7320 7072 6573 656e 742e  ment is present.
+00007470: 0a20 2020 2061 7574 6f65 7874 656e 7369  .    autoextensi
+00007480: 6f6e 7320 3d20 7b0a 2020 2020 2020 2020  ons = {.        
+00007490: 6227 6769 7427 3a20 5b62 2767 6974 275d  b'git': [b'git']
+000074a0: 2c0a 2020 2020 2020 2020 6227 6c61 7267  ,.        b'larg
+000074b0: 6566 696c 6573 273a 205b 6227 6c61 7267  efiles': [b'larg
+000074c0: 6566 696c 6573 275d 2c0a 2020 2020 2020  efiles'],.      
+000074d0: 2020 6227 6c66 7327 3a20 5b62 276c 6673    b'lfs': [b'lfs
+000074e0: 275d 2c0a 2020 2020 7d0a 0a20 2020 2066  '],.    }..    f
+000074f0: 6f72 2072 6571 7569 7265 6d65 6e74 2c20  or requirement, 
+00007500: 6e61 6d65 7320 696e 2073 6f72 7465 6428  names in sorted(
+00007510: 6175 746f 6578 7465 6e73 696f 6e73 2e69  autoextensions.i
+00007520: 7465 6d73 2829 293a 0a20 2020 2020 2020  tems()):.       
+00007530: 2069 6620 7265 7175 6972 656d 656e 7420   if requirement 
+00007540: 6e6f 7420 696e 2072 6571 7569 7265 6d65  not in requireme
+00007550: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+00007560: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
+00007570: 2020 2066 6f72 206e 616d 6520 696e 206e     for name in n
+00007580: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+00007590: 2020 6966 206e 6f74 2075 692e 6861 7363    if not ui.hasc
+000075a0: 6f6e 6669 6728 6227 6578 7465 6e73 696f  onfig(b'extensio
+000075b0: 6e73 272c 206e 616d 6529 3a0a 2020 2020  ns', name):.    
+000075c0: 2020 2020 2020 2020 2020 2020 7569 2e73              ui.s
+000075d0: 6574 636f 6e66 6967 2862 2765 7874 656e  etconfig(b'exten
+000075e0: 7369 6f6e 7327 2c20 6e61 6d65 2c20 6227  sions', name, b'
+000075f0: 272c 2073 6f75 7263 653d 6227 6175 746f  ', source=b'auto
+00007600: 6c6f 6164 2729 0a0a 0a64 6566 2067 6174  load')...def gat
+00007610: 6865 7273 7570 706f 7274 6564 7265 7175  hersupportedrequ
+00007620: 6972 656d 656e 7473 2875 6929 3a0a 2020  irements(ui):.  
+00007630: 2020 2222 2244 6574 6572 6d69 6e65 2074    """Determine t
+00007640: 6865 2063 6f6d 706c 6574 6520 7365 7420  he complete set 
+00007650: 6f66 2072 6563 6f67 6e69 7a65 6420 7265  of recognized re
+00007660: 7175 6972 656d 656e 7473 2e22 2222 0a20  quirements.""". 
+00007670: 2020 2023 2053 7461 7274 2077 6974 6820     # Start with 
+00007680: 616c 6c20 7265 7175 6972 656d 656e 7473  all requirements
+00007690: 2073 7570 706f 7274 6564 2062 7920 7468   supported by th
+000076a0: 6973 2066 696c 652e 0a20 2020 2073 7570  is file..    sup
+000076b0: 706f 7274 6564 203d 2073 6574 286c 6f63  ported = set(loc
+000076c0: 616c 7265 706f 7369 746f 7279 2e5f 6261  alrepository._ba
+000076d0: 7365 7375 7070 6f72 7465 6429 0a0a 2020  sesupported)..  
+000076e0: 2020 2320 4578 6563 7574 6520 6060 6665    # Execute ``fe
+000076f0: 6174 7572 6573 6574 7570 6675 6e63 7360  aturesetupfuncs`
+00007700: 6020 656e 7472 6965 7320 6966 2074 6865  ` entries if the
+00007710: 7920 6265 6c6f 6e67 2074 6f20 616e 2065  y belong to an e
+00007720: 7874 656e 7369 6f6e 0a20 2020 2023 2072  xtension.    # r
+00007730: 656c 6576 616e 7420 746f 2074 6869 7320  elevant to this 
+00007740: 7569 2069 6e73 7461 6e63 652e 0a20 2020  ui instance..   
+00007750: 206d 6f64 756c 6573 203d 207b 6d2e 5f5f   modules = {m.__
+00007760: 6e61 6d65 5f5f 2066 6f72 206e 2c20 6d20  name__ for n, m 
+00007770: 696e 2065 7874 656e 7369 6f6e 732e 6578  in extensions.ex
+00007780: 7465 6e73 696f 6e73 2875 6929 7d0a 0a20  tensions(ui)}.. 
+00007790: 2020 2066 6f72 2066 6e20 696e 2066 6561     for fn in fea
+000077a0: 7475 7265 7365 7475 7066 756e 6373 3a0a  turesetupfuncs:.
+000077b0: 2020 2020 2020 2020 6966 2066 6e2e 5f5f          if fn.__
+000077c0: 6d6f 6475 6c65 5f5f 2069 6e20 6d6f 6475  module__ in modu
+000077d0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+000077e0: 2066 6e28 7569 2c20 7375 7070 6f72 7465   fn(ui, supporte
+000077f0: 6429 0a0a 2020 2020 2320 4164 6420 6465  d)..    # Add de
+00007800: 7269 7665 6420 7265 7175 6972 656d 656e  rived requiremen
+00007810: 7473 2066 726f 6d20 7265 6769 7374 6572  ts from register
+00007820: 6564 2063 6f6d 7072 6573 7369 6f6e 2065  ed compression e
+00007830: 6e67 696e 6573 2e0a 2020 2020 666f 7220  ngines..    for 
+00007840: 6e61 6d65 2069 6e20 7574 696c 2e63 6f6d  name in util.com
+00007850: 7065 6e67 696e 6573 3a0a 2020 2020 2020  pengines:.      
+00007860: 2020 656e 6769 6e65 203d 2075 7469 6c2e    engine = util.
+00007870: 636f 6d70 656e 6769 6e65 735b 6e61 6d65  compengines[name
+00007880: 5d0a 2020 2020 2020 2020 6966 2065 6e67  ].        if eng
+00007890: 696e 652e 6176 6169 6c61 626c 6528 2920  ine.available() 
+000078a0: 616e 6420 656e 6769 6e65 2e72 6576 6c6f  and engine.revlo
+000078b0: 6768 6561 6465 7228 293a 0a20 2020 2020  gheader():.     
+000078c0: 2020 2020 2020 2073 7570 706f 7274 6564         supported
+000078d0: 2e61 6464 2862 2765 7870 2d63 6f6d 7072  .add(b'exp-compr
+000078e0: 6573 7369 6f6e 2d25 7327 2025 206e 616d  ession-%s' % nam
+000078f0: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+00007900: 6620 656e 6769 6e65 2e6e 616d 6528 2920  f engine.name() 
+00007910: 3d3d 2062 277a 7374 6427 3a0a 2020 2020  == b'zstd':.    
+00007920: 2020 2020 2020 2020 2020 2020 7375 7070              supp
+00007930: 6f72 7465 642e 6164 6428 7265 7175 6972  orted.add(requir
+00007940: 656d 656e 7473 6d6f 642e 5245 564c 4f47  ementsmod.REVLOG
+00007950: 5f43 4f4d 5052 4553 5349 4f4e 5f5a 5354  _COMPRESSION_ZST
+00007960: 4429 0a0a 2020 2020 7265 7475 726e 2073  D)..    return s
+00007970: 7570 706f 7274 6564 0a0a 0a64 6566 2065  upported...def e
+00007980: 6e73 7572 6572 6571 7569 7265 6d65 6e74  nsurerequirement
+00007990: 7372 6563 6f67 6e69 7a65 6428 7265 7175  srecognized(requ
+000079a0: 6972 656d 656e 7473 2c20 7375 7070 6f72  irements, suppor
+000079b0: 7465 6429 3a0a 2020 2020 2222 2256 616c  ted):.    """Val
+000079c0: 6964 6174 6520 7468 6174 2061 2073 6574  idate that a set
+000079d0: 206f 6620 6c6f 6361 6c20 7265 7175 6972   of local requir
+000079e0: 656d 656e 7473 2069 7320 7265 636f 676e  ements is recogn
+000079f0: 697a 6564 2e0a 0a20 2020 2052 6563 6569  ized...    Recei
+00007a00: 7665 7320 6120 7365 7420 6f66 2072 6571  ves a set of req
+00007a10: 7569 7265 6d65 6e74 732e 2052 6169 7365  uirements. Raise
+00007a20: 7320 616e 2060 6065 7272 6f72 2e52 6570  s an ``error.Rep
+00007a30: 6f45 7272 6f72 6060 2069 6620 7468 6572  oError`` if ther
+00007a40: 650a 2020 2020 6578 6973 7473 2061 6e79  e.    exists any
+00007a50: 2072 6571 7569 7265 6d65 6e74 2069 6e20   requirement in 
+00007a60: 7468 6174 2073 6574 2074 6861 7420 6375  that set that cu
+00007a70: 7272 656e 746c 7920 6c6f 6164 6564 2063  rrently loaded c
+00007a80: 6f64 6520 646f 6573 6e27 740a 2020 2020  ode doesn't.    
+00007a90: 7265 636f 676e 697a 652e 0a0a 2020 2020  recognize...    
+00007aa0: 5265 7475 726e 7320 6120 7365 7420 6f66  Returns a set of
+00007ab0: 2073 7570 706f 7274 6564 2072 6571 7569   supported requi
+00007ac0: 7265 6d65 6e74 732e 0a20 2020 2022 2222  rements..    """
+00007ad0: 0a20 2020 206d 6973 7369 6e67 203d 2073  .    missing = s
+00007ae0: 6574 2829 0a0a 2020 2020 666f 7220 7265  et()..    for re
+00007af0: 7175 6972 656d 656e 7420 696e 2072 6571  quirement in req
+00007b00: 7569 7265 6d65 6e74 733a 0a20 2020 2020  uirements:.     
+00007b10: 2020 2069 6620 7265 7175 6972 656d 656e     if requiremen
+00007b20: 7420 696e 2073 7570 706f 7274 6564 3a0a  t in supported:.
+00007b30: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00007b40: 696e 7565 0a0a 2020 2020 2020 2020 6966  inue..        if
+00007b50: 206e 6f74 2072 6571 7569 7265 6d65 6e74   not requirement
+00007b60: 206f 7220 6e6f 7420 7265 7175 6972 656d   or not requirem
+00007b70: 656e 745b 303a 315d 2e69 7361 6c6e 756d  ent[0:1].isalnum
+00007b80: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00007b90: 7261 6973 6520 6572 726f 722e 5265 7175  raise error.Requ
+00007ba0: 6972 656d 656e 7445 7272 6f72 285f 2862  irementError(_(b
+00007bb0: 272e 6867 2f72 6571 7569 7265 7320 6669  '.hg/requires fi
+00007bc0: 6c65 2069 7320 636f 7272 7570 7427 2929  le is corrupt'))
+00007bd0: 0a0a 2020 2020 2020 2020 6d69 7373 696e  ..        missin
+00007be0: 672e 6164 6428 7265 7175 6972 656d 656e  g.add(requiremen
+00007bf0: 7429 0a0a 2020 2020 6966 206d 6973 7369  t)..    if missi
+00007c00: 6e67 3a0a 2020 2020 2020 2020 7261 6973  ng:.        rais
+00007c10: 6520 6572 726f 722e 5265 7175 6972 656d  e error.Requirem
+00007c20: 656e 7445 7272 6f72 280a 2020 2020 2020  entError(.      
+00007c30: 2020 2020 2020 5f28 6227 7265 706f 7369        _(b'reposi
+00007c40: 746f 7279 2072 6571 7569 7265 7320 6665  tory requires fe
+00007c50: 6174 7572 6573 2075 6e6b 6e6f 776e 2074  atures unknown t
+00007c60: 6f20 7468 6973 204d 6572 6375 7269 616c  o this Mercurial
+00007c70: 3a20 2573 2729 0a20 2020 2020 2020 2020  : %s').         
+00007c80: 2020 2025 2062 2720 272e 6a6f 696e 2873     % b' '.join(s
+00007c90: 6f72 7465 6428 6d69 7373 696e 6729 292c  orted(missing)),
+00007ca0: 0a20 2020 2020 2020 2020 2020 2068 696e  .            hin
+00007cb0: 743d 5f28 0a20 2020 2020 2020 2020 2020  t=_(.           
+00007cc0: 2020 2020 2062 2773 6565 2068 7474 7073       b'see https
+00007cd0: 3a2f 2f6d 6572 6375 7269 616c 2d73 636d  ://mercurial-scm
+00007ce0: 2e6f 7267 2f77 696b 692f 4d69 7373 696e  .org/wiki/Missin
+00007cf0: 6752 6571 7569 7265 6d65 6e74 2027 0a20  gRequirement '. 
+00007d00: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00007d10: 2766 6f72 206d 6f72 6520 696e 666f 726d  'for more inform
+00007d20: 6174 696f 6e27 0a20 2020 2020 2020 2020  ation'.         
+00007d30: 2020 2029 2c0a 2020 2020 2020 2020 290a     ),.        ).
+00007d40: 0a0a 6465 6620 656e 7375 7265 7265 7175  ..def ensurerequ
+00007d50: 6972 656d 656e 7473 636f 6d70 6174 6962  irementscompatib
+00007d60: 6c65 2875 692c 2072 6571 7569 7265 6d65  le(ui, requireme
+00007d70: 6e74 7329 3a0a 2020 2020 2222 2256 616c  nts):.    """Val
+00007d80: 6964 6174 6573 2074 6861 7420 6120 7365  idates that a se
+00007d90: 7420 6f66 2072 6563 6f67 6e69 7a65 6420  t of recognized 
+00007da0: 7265 7175 6972 656d 656e 7473 2069 7320  requirements is 
+00007db0: 6d75 7475 616c 6c79 2063 6f6d 7061 7469  mutually compati
+00007dc0: 626c 652e 0a0a 2020 2020 536f 6d65 2072  ble...    Some r
+00007dd0: 6571 7569 7265 6d65 6e74 7320 6d61 7920  equirements may 
+00007de0: 6e6f 7420 6265 2063 6f6d 7061 7469 626c  not be compatibl
+00007df0: 6520 7769 7468 206f 7468 6572 7320 6f72  e with others or
+00007e00: 2072 6571 7569 7265 0a20 2020 2063 6f6e   require.    con
+00007e10: 6669 6720 6f70 7469 6f6e 7320 7468 6174  fig options that
+00007e20: 2061 7265 6e27 7420 656e 6162 6c65 642e   aren't enabled.
+00007e30: 2054 6869 7320 6675 6e63 7469 6f6e 2069   This function i
+00007e40: 7320 6361 6c6c 6564 2064 7572 696e 670a  s called during.
+00007e50: 2020 2020 7265 706f 7369 746f 7279 206f      repository o
+00007e60: 7065 6e69 6e67 2074 6f20 656e 7375 7265  pening to ensure
+00007e70: 2074 6861 7420 7468 6520 7365 7420 6f66   that the set of
+00007e80: 2072 6571 7569 7265 6d65 6e74 7320 6e65   requirements ne
+00007e90: 6564 6564 0a20 2020 2074 6f20 6f70 656e  eded.    to open
+00007ea0: 2061 2072 6570 6f73 6974 6f72 7920 6973   a repository is
+00007eb0: 2073 616e 6520 616e 6420 636f 6d70 6174   sane and compat
+00007ec0: 6962 6c65 2077 6974 6820 636f 6e66 6967  ible with config
+00007ed0: 206f 7074 696f 6e73 2e0a 0a20 2020 2045   options...    E
+00007ee0: 7874 656e 7369 6f6e 7320 6361 6e20 6d6f  xtensions can mo
+00007ef0: 6e6b 6579 7061 7463 6820 7468 6973 2066  nkeypatch this f
+00007f00: 756e 6374 696f 6e20 746f 2070 6572 666f  unction to perfo
+00007f10: 726d 2061 6464 6974 696f 6e61 6c0a 2020  rm additional.  
+00007f20: 2020 6368 6563 6b69 6e67 2e0a 0a20 2020    checking...   
+00007f30: 2060 6065 7272 6f72 2e52 6570 6f45 7272   ``error.RepoErr
+00007f40: 6f72 6060 2073 686f 756c 6420 6265 2072  or`` should be r
+00007f50: 6169 7365 6420 6f6e 2066 6169 6c75 7265  aised on failure
+00007f60: 2e0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
+00007f70: 2028 0a20 2020 2020 2020 2072 6571 7569   (.        requi
+00007f80: 7265 6d65 6e74 736d 6f64 2e53 5041 5253  rementsmod.SPARS
+00007f90: 455f 5245 5155 4952 454d 454e 5420 696e  E_REQUIREMENT in
+00007fa0: 2072 6571 7569 7265 6d65 6e74 730a 2020   requirements.  
+00007fb0: 2020 2020 2020 616e 6420 6e6f 7420 7370        and not sp
+00007fc0: 6172 7365 2e65 6e61 626c 6564 0a20 2020  arse.enabled.   
+00007fd0: 2029 3a0a 2020 2020 2020 2020 7261 6973   ):.        rais
+00007fe0: 6520 6572 726f 722e 5265 706f 4572 726f  e error.RepoErro
+00007ff0: 7228 0a20 2020 2020 2020 2020 2020 205f  r(.            _
+00008000: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00008010: 2020 6227 7265 706f 7369 746f 7279 2069    b'repository i
+00008020: 7320 7573 696e 6720 7370 6172 7365 2066  s using sparse f
+00008030: 6561 7475 7265 2062 7574 2027 0a20 2020  eature but '.   
+00008040: 2020 2020 2020 2020 2020 2020 2062 2773               b's
+00008050: 7061 7273 6520 6973 206e 6f74 2065 6e61  parse is not ena
+00008060: 626c 6564 3b20 656e 6162 6c65 2074 6865  bled; enable the
+00008070: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+00008080: 2020 2062 2722 7370 6172 7365 2220 6578     b'"sparse" ex
+00008090: 7465 6e73 696f 6e73 2074 6f20 6163 6365  tensions to acce
+000080a0: 7373 270a 2020 2020 2020 2020 2020 2020  ss'.            
+000080b0: 290a 2020 2020 2020 2020 290a 0a0a 6465  ).        )...de
+000080c0: 6620 6d61 6b65 7374 6f72 6528 7265 7175  f makestore(requ
+000080d0: 6972 656d 656e 7473 2c20 7061 7468 2c20  irements, path, 
+000080e0: 7666 7374 7970 6529 3a0a 2020 2020 2222  vfstype):.    ""
+000080f0: 2243 6f6e 7374 7275 6374 2061 2073 746f  "Construct a sto
+00008100: 7261 6765 206f 626a 6563 7420 666f 7220  rage object for 
+00008110: 6120 7265 706f 7369 746f 7279 2e22 2222  a repository."""
+00008120: 0a20 2020 2069 6620 7265 7175 6972 656d  .    if requirem
+00008130: 656e 7473 6d6f 642e 5354 4f52 455f 5245  entsmod.STORE_RE
+00008140: 5155 4952 454d 454e 5420 696e 2072 6571  QUIREMENT in req
+00008150: 7569 7265 6d65 6e74 733a 0a20 2020 2020  uirements:.     
+00008160: 2020 2069 6620 7265 7175 6972 656d 656e     if requiremen
+00008170: 7473 6d6f 642e 464e 4341 4348 455f 5245  tsmod.FNCACHE_RE
+00008180: 5155 4952 454d 454e 5420 696e 2072 6571  QUIREMENT in req
+00008190: 7569 7265 6d65 6e74 733a 0a20 2020 2020  uirements:.     
+000081a0: 2020 2020 2020 2064 6f74 656e 636f 6465         dotencode
+000081b0: 203d 2072 6571 7569 7265 6d65 6e74 736d   = requirementsm
+000081c0: 6f64 2e44 4f54 454e 434f 4445 5f52 4551  od.DOTENCODE_REQ
+000081d0: 5549 5245 4d45 4e54 2069 6e20 7265 7175  UIREMENT in requ
+000081e0: 6972 656d 656e 7473 0a20 2020 2020 2020  irements.       
+000081f0: 2020 2020 2072 6574 7572 6e20 7374 6f72       return stor
+00008200: 656d 6f64 2e66 6e63 6163 6865 7374 6f72  emod.fncachestor
+00008210: 6528 7061 7468 2c20 7666 7374 7970 652c  e(path, vfstype,
+00008220: 2064 6f74 656e 636f 6465 290a 0a20 2020   dotencode)..   
+00008230: 2020 2020 2072 6574 7572 6e20 7374 6f72       return stor
+00008240: 656d 6f64 2e65 6e63 6f64 6564 7374 6f72  emod.encodedstor
+00008250: 6528 7061 7468 2c20 7666 7374 7970 6529  e(path, vfstype)
+00008260: 0a0a 2020 2020 7265 7475 726e 2073 746f  ..    return sto
+00008270: 7265 6d6f 642e 6261 7369 6373 746f 7265  remod.basicstore
+00008280: 2870 6174 682c 2076 6673 7479 7065 290a  (path, vfstype).
+00008290: 0a0a 6465 6620 7265 736f 6c76 6573 746f  ..def resolvesto
+000082a0: 7265 7666 736f 7074 696f 6e73 2875 692c  revfsoptions(ui,
+000082b0: 2072 6571 7569 7265 6d65 6e74 732c 2066   requirements, f
+000082c0: 6561 7475 7265 7329 3a0a 2020 2020 2222  eatures):.    ""
+000082d0: 2252 6573 6f6c 7665 2074 6865 206f 7074  "Resolve the opt
+000082e0: 696f 6e73 2074 6f20 7061 7373 2074 6f20  ions to pass to 
+000082f0: 7468 6520 7374 6f72 6520 7666 7320 6f70  the store vfs op
+00008300: 656e 6572 2e0a 0a20 2020 2054 6865 2072  ener...    The r
+00008310: 6574 7572 6e65 6420 6469 6374 2069 7320  eturned dict is 
+00008320: 7573 6564 2074 6f20 696e 666c 7565 6e63  used to influenc
+00008330: 6520 6265 6861 7669 6f72 206f 6620 7468  e behavior of th
+00008340: 6520 7374 6f72 6167 6520 6c61 7965 722e  e storage layer.
+00008350: 0a20 2020 2022 2222 0a20 2020 206f 7074  .    """.    opt
+00008360: 696f 6e73 203d 207b 7d0a 0a20 2020 2069  ions = {}..    i
+00008370: 6620 7265 7175 6972 656d 656e 7473 6d6f  f requirementsmo
+00008380: 642e 5452 4545 4d41 4e49 4645 5354 5f52  d.TREEMANIFEST_R
+00008390: 4551 5549 5245 4d45 4e54 2069 6e20 7265  EQUIREMENT in re
+000083a0: 7175 6972 656d 656e 7473 3a0a 2020 2020  quirements:.    
+000083b0: 2020 2020 6f70 7469 6f6e 735b 6227 7472      options[b'tr
+000083c0: 6565 6d61 6e69 6665 7374 275d 203d 2054  eemanifest'] = T
+000083d0: 7275 650a 0a20 2020 2023 2065 7870 6572  rue..    # exper
+000083e0: 696d 656e 7461 6c20 636f 6e66 6967 3a20  imental config: 
+000083f0: 666f 726d 6174 2e6d 616e 6966 6573 7463  format.manifestc
+00008400: 6163 6865 7369 7a65 0a20 2020 206d 616e  achesize.    man
+00008410: 6966 6573 7463 6163 6865 7369 7a65 203d  ifestcachesize =
+00008420: 2075 692e 636f 6e66 6967 696e 7428 6227   ui.configint(b'
+00008430: 666f 726d 6174 272c 2062 276d 616e 6966  format', b'manif
+00008440: 6573 7463 6163 6865 7369 7a65 2729 0a20  estcachesize'). 
+00008450: 2020 2069 6620 6d61 6e69 6665 7374 6361     if manifestca
+00008460: 6368 6573 697a 6520 6973 206e 6f74 204e  chesize is not N
+00008470: 6f6e 653a 0a20 2020 2020 2020 206f 7074  one:.        opt
+00008480: 696f 6e73 5b62 276d 616e 6966 6573 7463  ions[b'manifestc
+00008490: 6163 6865 7369 7a65 275d 203d 206d 616e  achesize'] = man
+000084a0: 6966 6573 7463 6163 6865 7369 7a65 0a0a  ifestcachesize..
+000084b0: 2020 2020 2320 496e 2074 6865 2061 6273      # In the abs
+000084c0: 656e 6365 206f 6620 616e 6f74 6865 7220  ence of another 
+000084d0: 7265 7175 6972 656d 656e 7420 7375 7065  requirement supe
+000084e0: 7273 6564 696e 6720 6120 7265 766c 6f67  rseding a revlog
+000084f0: 2d72 656c 6174 6564 0a20 2020 2023 2072  -related.    # r
+00008500: 6571 7569 7265 6d65 6e74 2c20 7765 2068  equirement, we h
+00008510: 6176 6520 746f 2061 7373 756d 6520 7468  ave to assume th
+00008520: 6520 7265 706f 2069 7320 7573 696e 6720  e repo is using 
+00008530: 7265 766c 6f67 2076 6572 7369 6f6e 2030  revlog version 0
+00008540: 2e0a 2020 2020 2320 5468 6973 2072 6576  ..    # This rev
+00008550: 6c6f 6720 666f 726d 6174 2069 7320 7375  log format is su
+00008560: 7065 7220 6f6c 6420 616e 6420 7765 2064  per old and we d
+00008570: 6f6e 2774 2062 6f74 6865 7220 7472 7969  on't bother tryi
+00008580: 6e67 2074 6f20 7061 7273 650a 2020 2020  ng to parse.    
+00008590: 2320 6f70 656e 6572 206f 7074 696f 6e73  # opener options
+000085a0: 2066 6f72 2069 7420 6265 6361 7573 6520   for it because 
+000085b0: 7468 6f73 6520 6f70 7469 6f6e 7320 776f  those options wo
+000085c0: 756c 646e 2774 2064 6f20 616e 7974 6869  uldn't do anythi
+000085d0: 6e67 0a20 2020 2023 206d 6561 6e69 6e67  ng.    # meaning
+000085e0: 6675 6c20 6f6e 2073 7563 6820 6f6c 6420  ful on such old 
+000085f0: 7265 706f 732e 0a20 2020 2069 6620 280a  repos..    if (.
+00008600: 2020 2020 2020 2020 7265 7175 6972 656d          requirem
+00008610: 656e 7473 6d6f 642e 5245 564c 4f47 5631  entsmod.REVLOGV1
+00008620: 5f52 4551 5549 5245 4d45 4e54 2069 6e20  _REQUIREMENT in 
+00008630: 7265 7175 6972 656d 656e 7473 0a20 2020  requirements.   
+00008640: 2020 2020 206f 7220 7265 7175 6972 656d       or requirem
+00008650: 656e 7473 6d6f 642e 5245 564c 4f47 5632  entsmod.REVLOGV2
+00008660: 5f52 4551 5549 5245 4d45 4e54 2069 6e20  _REQUIREMENT in 
+00008670: 7265 7175 6972 656d 656e 7473 0a20 2020  requirements.   
+00008680: 2029 3a0a 2020 2020 2020 2020 6f70 7469   ):.        opti
+00008690: 6f6e 732e 7570 6461 7465 2872 6573 6f6c  ons.update(resol
+000086a0: 7665 7265 766c 6f67 7374 6f72 6576 6673  verevlogstorevfs
+000086b0: 6f70 7469 6f6e 7328 7569 2c20 7265 7175  options(ui, requ
+000086c0: 6972 656d 656e 7473 2c20 6665 6174 7572  irements, featur
+000086d0: 6573 2929 0a20 2020 2065 6c73 653a 2020  es)).    else:  
+000086e0: 2320 6578 706c 6963 6974 6c79 206d 6172  # explicitly mar
+000086f0: 6b20 7265 706f 2061 7320 7573 696e 6720  k repo as using 
+00008700: 7265 766c 6f67 7630 0a20 2020 2020 2020  revlogv0.       
+00008710: 206f 7074 696f 6e73 5b62 2772 6576 6c6f   options[b'revlo
+00008720: 6776 3027 5d20 3d20 5472 7565 0a0a 2020  gv0'] = True..  
+00008730: 2020 6966 2072 6571 7569 7265 6d65 6e74    if requirement
+00008740: 736d 6f64 2e43 4f50 4945 5353 4443 5f52  smod.COPIESSDC_R
+00008750: 4551 5549 5245 4d45 4e54 2069 6e20 7265  EQUIREMENT in re
+00008760: 7175 6972 656d 656e 7473 3a0a 2020 2020  quirements:.    
+00008770: 2020 2020 6f70 7469 6f6e 735b 6227 636f      options[b'co
+00008780: 7069 6573 2d73 746f 7261 6765 275d 203d  pies-storage'] =
+00008790: 2062 2763 6861 6e67 6573 6574 2d73 6964   b'changeset-sid
+000087a0: 6564 6174 6127 0a20 2020 2065 6c73 653a  edata'.    else:
+000087b0: 0a20 2020 2020 2020 2077 7269 7465 636f  .        writeco
+000087c0: 7069 6573 746f 203d 2075 692e 636f 6e66  piesto = ui.conf
+000087d0: 6967 2862 2765 7870 6572 696d 656e 7461  ig(b'experimenta
+000087e0: 6c27 2c20 6227 636f 7069 6573 2e77 7269  l', b'copies.wri
+000087f0: 7465 2d74 6f27 290a 2020 2020 2020 2020  te-to').        
+00008800: 636f 7069 6573 6578 7472 616d 6f64 6520  copiesextramode 
+00008810: 3d20 2862 2763 6861 6e67 6573 6574 2d6f  = (b'changeset-o
+00008820: 6e6c 7927 2c20 6227 636f 6d70 6174 6962  nly', b'compatib
+00008830: 696c 6974 7927 290a 2020 2020 2020 2020  ility').        
+00008840: 6966 2077 7269 7465 636f 7069 6573 746f  if writecopiesto
+00008850: 2069 6e20 636f 7069 6573 6578 7472 616d   in copiesextram
+00008860: 6f64 653a 0a20 2020 2020 2020 2020 2020  ode:.           
+00008870: 206f 7074 696f 6e73 5b62 2763 6f70 6965   options[b'copie
+00008880: 732d 7374 6f72 6167 6527 5d20 3d20 6227  s-storage'] = b'
+00008890: 6578 7472 6127 0a0a 2020 2020 7265 7475  extra'..    retu
+000088a0: 726e 206f 7074 696f 6e73 0a0a 0a64 6566  rn options...def
+000088b0: 2072 6573 6f6c 7665 7265 766c 6f67 7374   resolverevlogst
+000088c0: 6f72 6576 6673 6f70 7469 6f6e 7328 7569  orevfsoptions(ui
+000088d0: 2c20 7265 7175 6972 656d 656e 7473 2c20  , requirements, 
+000088e0: 6665 6174 7572 6573 293a 0a20 2020 2022  features):.    "
+000088f0: 2222 5265 736f 6c76 6520 6f70 656e 6572  ""Resolve opener
+00008900: 206f 7074 696f 6e73 2073 7065 6369 6669   options specifi
+00008910: 6320 746f 2072 6576 6c6f 6773 2e22 2222  c to revlogs."""
+00008920: 0a0a 2020 2020 6f70 7469 6f6e 7320 3d20  ..    options = 
+00008930: 7b7d 0a20 2020 206f 7074 696f 6e73 5b62  {}.    options[b
+00008940: 2766 6c61 6770 726f 6365 7373 6f72 7327  'flagprocessors'
+00008950: 5d20 3d20 7b7d 0a0a 2020 2020 6966 2072  ] = {}..    if r
+00008960: 6571 7569 7265 6d65 6e74 736d 6f64 2e52  equirementsmod.R
+00008970: 4556 4c4f 4756 315f 5245 5155 4952 454d  EVLOGV1_REQUIREM
+00008980: 454e 5420 696e 2072 6571 7569 7265 6d65  ENT in requireme
+00008990: 6e74 733a 0a20 2020 2020 2020 206f 7074  nts:.        opt
+000089a0: 696f 6e73 5b62 2772 6576 6c6f 6776 3127  ions[b'revlogv1'
+000089b0: 5d20 3d20 5472 7565 0a20 2020 2069 6620  ] = True.    if 
+000089c0: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
+000089d0: 5245 564c 4f47 5632 5f52 4551 5549 5245  REVLOGV2_REQUIRE
+000089e0: 4d45 4e54 2069 6e20 7265 7175 6972 656d  MENT in requirem
+000089f0: 656e 7473 3a0a 2020 2020 2020 2020 6f70  ents:.        op
+00008a00: 7469 6f6e 735b 6227 7265 766c 6f67 7632  tions[b'revlogv2
+00008a10: 275d 203d 2054 7275 650a 2020 2020 6966  '] = True.    if
+00008a20: 2072 6571 7569 7265 6d65 6e74 736d 6f64   requirementsmod
+00008a30: 2e43 4841 4e47 454c 4f47 5632 5f52 4551  .CHANGELOGV2_REQ
+00008a40: 5549 5245 4d45 4e54 2069 6e20 7265 7175  UIREMENT in requ
+00008a50: 6972 656d 656e 7473 3a0a 2020 2020 2020  irements:.      
+00008a60: 2020 6f70 7469 6f6e 735b 6227 6368 616e    options[b'chan
+00008a70: 6765 6c6f 6776 3227 5d20 3d20 5472 7565  gelogv2'] = True
+00008a80: 0a20 2020 2020 2020 2063 6d70 5f72 616e  .        cmp_ran
+00008a90: 6b20 3d20 7569 2e63 6f6e 6669 6762 6f6f  k = ui.configboo
+00008aa0: 6c28 6227 6578 7065 7269 6d65 6e74 616c  l(b'experimental
+00008ab0: 272c 2062 2763 6861 6e67 656c 6f67 2d76  ', b'changelog-v
+00008ac0: 322e 636f 6d70 7574 652d 7261 6e6b 2729  2.compute-rank')
+00008ad0: 0a20 2020 2020 2020 206f 7074 696f 6e73  .        options
+00008ae0: 5b62 2763 6861 6e67 656c 6f67 7632 2e63  [b'changelogv2.c
+00008af0: 6f6d 7075 7465 2d72 616e 6b27 5d20 3d20  ompute-rank'] = 
+00008b00: 636d 705f 7261 6e6b 0a0a 2020 2020 6966  cmp_rank..    if
+00008b10: 2072 6571 7569 7265 6d65 6e74 736d 6f64   requirementsmod
+00008b20: 2e47 454e 4552 414c 4445 4c54 415f 5245  .GENERALDELTA_RE
+00008b30: 5155 4952 454d 454e 5420 696e 2072 6571  QUIREMENT in req
+00008b40: 7569 7265 6d65 6e74 733a 0a20 2020 2020  uirements:.     
+00008b50: 2020 206f 7074 696f 6e73 5b62 2767 656e     options[b'gen
+00008b60: 6572 616c 6465 6c74 6127 5d20 3d20 5472  eraldelta'] = Tr
+00008b70: 7565 0a0a 2020 2020 2320 6578 7065 7269  ue..    # experi
+00008b80: 6d65 6e74 616c 2063 6f6e 6669 673a 2066  mental config: f
+00008b90: 6f72 6d61 742e 6368 756e 6b63 6163 6865  ormat.chunkcache
+00008ba0: 7369 7a65 0a20 2020 2063 6875 6e6b 6361  size.    chunkca
+00008bb0: 6368 6573 697a 6520 3d20 7569 2e63 6f6e  chesize = ui.con
+00008bc0: 6669 6769 6e74 2862 2766 6f72 6d61 7427  figint(b'format'
+00008bd0: 2c20 6227 6368 756e 6b63 6163 6865 7369  , b'chunkcachesi
+00008be0: 7a65 2729 0a20 2020 2069 6620 6368 756e  ze').    if chun
+00008bf0: 6b63 6163 6865 7369 7a65 2069 7320 6e6f  kcachesize is no
+00008c00: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00008c10: 6f70 7469 6f6e 735b 6227 6368 756e 6b63  options[b'chunkc
+00008c20: 6163 6865 7369 7a65 275d 203d 2063 6875  achesize'] = chu
+00008c30: 6e6b 6361 6368 6573 697a 650a 0a20 2020  nkcachesize..   
+00008c40: 2064 656c 7461 626f 7468 7061 7265 6e74   deltabothparent
+00008c50: 7320 3d20 7569 2e63 6f6e 6669 6762 6f6f  s = ui.configboo
+00008c60: 6c28 0a20 2020 2020 2020 2062 2773 746f  l(.        b'sto
+00008c70: 7261 6765 272c 2062 2772 6576 6c6f 672e  rage', b'revlog.
+00008c80: 6f70 7469 6d69 7a65 2d64 656c 7461 2d70  optimize-delta-p
+00008c90: 6172 656e 742d 6368 6f69 6365 270a 2020  arent-choice'.  
+00008ca0: 2020 290a 2020 2020 6f70 7469 6f6e 735b    ).    options[
+00008cb0: 6227 6465 6c74 6162 6f74 6870 6172 656e  b'deltabothparen
+00008cc0: 7473 275d 203d 2064 656c 7461 626f 7468  ts'] = deltaboth
+00008cd0: 7061 7265 6e74 730a 2020 2020 6470 735f  parents.    dps_
+00008ce0: 6367 6473 203d 2075 692e 636f 6e66 6967  cgds = ui.config
+00008cf0: 696e 7428 0a20 2020 2020 2020 2062 2773  int(.        b's
+00008d00: 746f 7261 6765 272c 0a20 2020 2020 2020  torage',.       
+00008d10: 2062 2772 6576 6c6f 672e 6465 6c74 612d   b'revlog.delta-
+00008d20: 7061 7265 6e74 2d73 6561 7263 682e 6361  parent-search.ca
+00008d30: 6e64 6964 6174 652d 6772 6f75 702d 6368  ndidate-group-ch
+00008d40: 756e 6b2d 7369 7a65 272c 0a20 2020 2029  unk-size',.    )
+00008d50: 0a20 2020 206f 7074 696f 6e73 5b62 2764  .    options[b'd
+00008d60: 656c 7461 2d70 6172 656e 742d 7365 6172  elta-parent-sear
+00008d70: 6368 2e63 616e 6469 6461 7465 2d67 726f  ch.candidate-gro
+00008d80: 7570 2d63 6875 6e6b 2d73 697a 6527 5d20  up-chunk-size'] 
+00008d90: 3d20 6470 735f 6367 6473 0a20 2020 206f  = dps_cgds.    o
+00008da0: 7074 696f 6e73 5b62 2764 6562 7567 2d64  ptions[b'debug-d
+00008db0: 656c 7461 275d 203d 2075 692e 636f 6e66  elta'] = ui.conf
+00008dc0: 6967 626f 6f6c 2862 2764 6562 7567 272c  igbool(b'debug',
+00008dd0: 2062 2772 6576 6c6f 672e 6465 6275 672d   b'revlog.debug-
+00008de0: 6465 6c74 6127 290a 0a20 2020 2069 7373  delta')..    iss
+00008df0: 7565 3635 3238 203d 2075 692e 636f 6e66  ue6528 = ui.conf
+00008e00: 6967 626f 6f6c 2862 2773 746f 7261 6765  igbool(b'storage
+00008e10: 272c 2062 2772 6576 6c6f 672e 6973 7375  ', b'revlog.issu
+00008e20: 6536 3532 382e 6669 782d 696e 636f 6d69  e6528.fix-incomi
+00008e30: 6e67 2729 0a20 2020 206f 7074 696f 6e73  ng').    options
+00008e40: 5b62 2769 7373 7565 3635 3238 2e66 6978  [b'issue6528.fix
+00008e50: 2d69 6e63 6f6d 696e 6727 5d20 3d20 6973  -incoming'] = is
+00008e60: 7375 6536 3532 380a 0a20 2020 206c 617a  sue6528..    laz
+00008e70: 7964 656c 7461 203d 2075 692e 636f 6e66  ydelta = ui.conf
+00008e80: 6967 626f 6f6c 2862 2773 746f 7261 6765  igbool(b'storage
+00008e90: 272c 2062 2772 6576 6c6f 672e 7265 7573  ', b'revlog.reus
+00008ea0: 652d 6578 7465 726e 616c 2d64 656c 7461  e-external-delta
+00008eb0: 2729 0a20 2020 206c 617a 7964 656c 7461  ').    lazydelta
+00008ec0: 6261 7365 203d 2046 616c 7365 0a20 2020  base = False.   
+00008ed0: 2069 6620 6c61 7a79 6465 6c74 613a 0a20   if lazydelta:. 
+00008ee0: 2020 2020 2020 206c 617a 7964 656c 7461         lazydelta
+00008ef0: 6261 7365 203d 2075 692e 636f 6e66 6967  base = ui.config
+00008f00: 626f 6f6c 280a 2020 2020 2020 2020 2020  bool(.          
+00008f10: 2020 6227 7374 6f72 6167 6527 2c20 6227    b'storage', b'
+00008f20: 7265 766c 6f67 2e72 6575 7365 2d65 7874  revlog.reuse-ext
+00008f30: 6572 6e61 6c2d 6465 6c74 612d 7061 7265  ernal-delta-pare
+00008f40: 6e74 270a 2020 2020 2020 2020 290a 2020  nt'.        ).  
+00008f50: 2020 6966 206c 617a 7964 656c 7461 6261    if lazydeltaba
+00008f60: 7365 2069 7320 4e6f 6e65 3a0a 2020 2020  se is None:.    
+00008f70: 2020 2020 6c61 7a79 6465 6c74 6162 6173      lazydeltabas
+00008f80: 6520 3d20 6e6f 7420 7363 6d75 7469 6c2e  e = not scmutil.
+00008f90: 6764 6465 6c74 6163 6f6e 6669 6728 7569  gddeltaconfig(ui
+00008fa0: 290a 2020 2020 6f70 7469 6f6e 735b 6227  ).    options[b'
+00008fb0: 6c61 7a79 6465 6c74 6127 5d20 3d20 6c61  lazydelta'] = la
+00008fc0: 7a79 6465 6c74 610a 2020 2020 6f70 7469  zydelta.    opti
+00008fd0: 6f6e 735b 6227 6c61 7a79 6465 6c74 6162  ons[b'lazydeltab
+00008fe0: 6173 6527 5d20 3d20 6c61 7a79 6465 6c74  ase'] = lazydelt
+00008ff0: 6162 6173 650a 0a20 2020 2063 6861 696e  abase..    chain
+00009000: 7370 616e 203d 2075 692e 636f 6e66 6967  span = ui.config
+00009010: 6279 7465 7328 6227 6578 7065 7269 6d65  bytes(b'experime
+00009020: 6e74 616c 272c 2062 276d 6178 6465 6c74  ntal', b'maxdelt
+00009030: 6163 6861 696e 7370 616e 2729 0a20 2020  achainspan').   
+00009040: 2069 6620 3020 3c3d 2063 6861 696e 7370   if 0 <= chainsp
+00009050: 616e 3a0a 2020 2020 2020 2020 6f70 7469  an:.        opti
+00009060: 6f6e 735b 6227 6d61 7864 656c 7461 6368  ons[b'maxdeltach
+00009070: 6169 6e73 7061 6e27 5d20 3d20 6368 6169  ainspan'] = chai
+00009080: 6e73 7061 6e0a 0a20 2020 206d 6d61 7069  nspan..    mmapi
+00009090: 6e64 6578 7468 7265 7368 6f6c 6420 3d20  ndexthreshold = 
+000090a0: 7569 2e63 6f6e 6669 6762 7974 6573 2862  ui.configbytes(b
+000090b0: 2765 7870 6572 696d 656e 7461 6c27 2c20  'experimental', 
+000090c0: 6227 6d6d 6170 696e 6465 7874 6872 6573  b'mmapindexthres
+000090d0: 686f 6c64 2729 0a20 2020 2069 6620 6d6d  hold').    if mm
+000090e0: 6170 696e 6465 7874 6872 6573 686f 6c64  apindexthreshold
+000090f0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00009100: 2020 2020 2020 6f70 7469 6f6e 735b 6227        options[b'
+00009110: 6d6d 6170 696e 6465 7874 6872 6573 686f  mmapindexthresho
+00009120: 6c64 275d 203d 206d 6d61 7069 6e64 6578  ld'] = mmapindex
+00009130: 7468 7265 7368 6f6c 640a 0a20 2020 2077  threshold..    w
+00009140: 6974 6873 7061 7273 6572 6561 6420 3d20  ithsparseread = 
+00009150: 7569 2e63 6f6e 6669 6762 6f6f 6c28 6227  ui.configbool(b'
+00009160: 6578 7065 7269 6d65 6e74 616c 272c 2062  experimental', b
+00009170: 2773 7061 7273 652d 7265 6164 2729 0a20  'sparse-read'). 
+00009180: 2020 2073 7264 656e 7369 7479 7468 7265     srdensitythre
+00009190: 7320 3d20 666c 6f61 7428 0a20 2020 2020  s = float(.     
+000091a0: 2020 2075 692e 636f 6e66 6967 2862 2765     ui.config(b'e
+000091b0: 7870 6572 696d 656e 7461 6c27 2c20 6227  xperimental', b'
+000091c0: 7370 6172 7365 2d72 6561 642e 6465 6e73  sparse-read.dens
+000091d0: 6974 792d 7468 7265 7368 6f6c 6427 290a  ity-threshold').
+000091e0: 2020 2020 290a 2020 2020 7372 6d69 6e67      ).    srming
+000091f0: 6170 7369 7a65 203d 2075 692e 636f 6e66  apsize = ui.conf
+00009200: 6967 6279 7465 7328 6227 6578 7065 7269  igbytes(b'experi
+00009210: 6d65 6e74 616c 272c 2062 2773 7061 7273  mental', b'spars
+00009220: 652d 7265 6164 2e6d 696e 2d67 6170 2d73  e-read.min-gap-s
+00009230: 697a 6527 290a 2020 2020 6f70 7469 6f6e  ize').    option
+00009240: 735b 6227 7769 7468 2d73 7061 7273 652d  s[b'with-sparse-
+00009250: 7265 6164 275d 203d 2077 6974 6873 7061  read'] = withspa
+00009260: 7273 6572 6561 640a 2020 2020 6f70 7469  rseread.    opti
+00009270: 6f6e 735b 6227 7370 6172 7365 2d72 6561  ons[b'sparse-rea
+00009280: 642d 6465 6e73 6974 792d 7468 7265 7368  d-density-thresh
+00009290: 6f6c 6427 5d20 3d20 7372 6465 6e73 6974  old'] = srdensit
+000092a0: 7974 6872 6573 0a20 2020 206f 7074 696f  ythres.    optio
+000092b0: 6e73 5b62 2773 7061 7273 652d 7265 6164  ns[b'sparse-read
+000092c0: 2d6d 696e 2d67 6170 2d73 697a 6527 5d20  -min-gap-size'] 
+000092d0: 3d20 7372 6d69 6e67 6170 7369 7a65 0a0a  = srmingapsize..
+000092e0: 2020 2020 7370 6172 7365 7265 766c 6f67      sparserevlog
+000092f0: 203d 2072 6571 7569 7265 6d65 6e74 736d   = requirementsm
+00009300: 6f64 2e53 5041 5253 4552 4556 4c4f 475f  od.SPARSEREVLOG_
+00009310: 5245 5155 4952 454d 454e 5420 696e 2072  REQUIREMENT in r
+00009320: 6571 7569 7265 6d65 6e74 730a 2020 2020  equirements.    
+00009330: 6f70 7469 6f6e 735b 6227 7370 6172 7365  options[b'sparse
+00009340: 2d72 6576 6c6f 6727 5d20 3d20 7370 6172  -revlog'] = spar
+00009350: 7365 7265 766c 6f67 0a20 2020 2069 6620  serevlog.    if 
+00009360: 7370 6172 7365 7265 766c 6f67 3a0a 2020  sparserevlog:.  
+00009370: 2020 2020 2020 6f70 7469 6f6e 735b 6227        options[b'
+00009380: 6765 6e65 7261 6c64 656c 7461 275d 203d  generaldelta'] =
+00009390: 2054 7275 650a 0a20 2020 206d 6178 6368   True..    maxch
+000093a0: 6169 6e6c 656e 203d 204e 6f6e 650a 2020  ainlen = None.  
+000093b0: 2020 6966 2073 7061 7273 6572 6576 6c6f    if sparserevlo
+000093c0: 673a 0a20 2020 2020 2020 206d 6178 6368  g:.        maxch
+000093d0: 6169 6e6c 656e 203d 2072 6576 6c6f 6763  ainlen = revlogc
+000093e0: 6f6e 7374 2e53 5041 5253 455f 5245 564c  onst.SPARSE_REVL
+000093f0: 4f47 5f4d 4158 5f43 4841 494e 5f4c 454e  OG_MAX_CHAIN_LEN
+00009400: 4754 480a 2020 2020 2320 6578 7065 7269  GTH.    # experi
+00009410: 6d65 6e74 616c 2063 6f6e 6669 673a 2066  mental config: f
+00009420: 6f72 6d61 742e 6d61 7863 6861 696e 6c65  ormat.maxchainle
+00009430: 6e0a 2020 2020 6d61 7863 6861 696e 6c65  n.    maxchainle
+00009440: 6e20 3d20 7569 2e63 6f6e 6669 6769 6e74  n = ui.configint
+00009450: 2862 2766 6f72 6d61 7427 2c20 6227 6d61  (b'format', b'ma
+00009460: 7863 6861 696e 6c65 6e27 2c20 6d61 7863  xchainlen', maxc
+00009470: 6861 696e 6c65 6e29 0a20 2020 2069 6620  hainlen).    if 
+00009480: 6d61 7863 6861 696e 6c65 6e20 6973 206e  maxchainlen is n
+00009490: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000094a0: 206f 7074 696f 6e73 5b62 276d 6178 6368   options[b'maxch
+000094b0: 6169 6e6c 656e 275d 203d 206d 6178 6368  ainlen'] = maxch
+000094c0: 6169 6e6c 656e 0a0a 2020 2020 666f 7220  ainlen..    for 
+000094d0: 7220 696e 2072 6571 7569 7265 6d65 6e74  r in requirement
+000094e0: 733a 0a20 2020 2020 2020 2023 2077 6520  s:.        # we 
+000094f0: 616c 6c6f 7720 6d75 6c74 6970 6c65 2063  allow multiple c
+00009500: 6f6d 7072 6573 7369 6f6e 2065 6e67 696e  ompression engin
+00009510: 6520 7265 7175 6972 656d 656e 7420 746f  e requirement to
+00009520: 2063 6f2d 6578 6973 7420 6265 6361 7573   co-exist becaus
+00009530: 650a 2020 2020 2020 2020 2320 7374 7269  e.        # stri
+00009540: 636b 6c79 2073 7065 616b 696e 672c 2072  ckly speaking, r
+00009550: 6576 6c6f 6720 7365 656d 7320 746f 2073  evlog seems to s
+00009560: 7570 706f 7274 206d 6978 6564 2063 6f6d  upport mixed com
+00009570: 7072 6573 7369 6f6e 2073 7479 6c65 2e0a  pression style..
+00009580: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
+00009590: 2020 2320 5468 6520 636f 6d70 7265 7373    # The compress
+000095a0: 696f 6e20 7573 6564 2066 6f72 206e 6577  ion used for new
+000095b0: 2065 6e74 7269 6573 2077 696c 6c20 6265   entries will be
+000095c0: 2022 7468 6520 6c61 7374 206f 6e65 220a   "the last one".
+000095d0: 2020 2020 2020 2020 7072 6566 6978 203d          prefix =
+000095e0: 2072 2e73 7461 7274 7377 6974 680a 2020   r.startswith.  
+000095f0: 2020 2020 2020 6966 2070 7265 6669 7828        if prefix(
+00009600: 6227 7265 766c 6f67 2d63 6f6d 7072 6573  b'revlog-compres
+00009610: 7369 6f6e 2d27 2920 6f72 2070 7265 6669  sion-') or prefi
+00009620: 7828 6227 6578 702d 636f 6d70 7265 7373  x(b'exp-compress
+00009630: 696f 6e2d 2729 3a0a 2020 2020 2020 2020  ion-'):.        
+00009640: 2020 2020 6f70 7469 6f6e 735b 6227 636f      options[b'co
+00009650: 6d70 656e 6769 6e65 275d 203d 2072 2e73  mpengine'] = r.s
+00009660: 706c 6974 2862 272d 272c 2032 295b 325d  plit(b'-', 2)[2]
+00009670: 0a0a 2020 2020 6f70 7469 6f6e 735b 6227  ..    options[b'
+00009680: 7a6c 6962 2e6c 6576 656c 275d 203d 2075  zlib.level'] = u
+00009690: 692e 636f 6e66 6967 696e 7428 6227 7374  i.configint(b'st
+000096a0: 6f72 6167 6527 2c20 6227 7265 766c 6f67  orage', b'revlog
+000096b0: 2e7a 6c69 622e 6c65 7665 6c27 290a 2020  .zlib.level').  
+000096c0: 2020 6966 206f 7074 696f 6e73 5b62 277a    if options[b'z
+000096d0: 6c69 622e 6c65 7665 6c27 5d20 6973 206e  lib.level'] is n
+000096e0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000096f0: 2069 6620 6e6f 7420 2830 203c 3d20 6f70   if not (0 <= op
+00009700: 7469 6f6e 735b 6227 7a6c 6962 2e6c 6576  tions[b'zlib.lev
+00009710: 656c 275d 203c 3d20 3929 3a0a 2020 2020  el'] <= 9):.    
+00009720: 2020 2020 2020 2020 6d73 6720 3d20 5f28          msg = _(
+00009730: 6227 696e 7661 6c69 6420 7661 6c75 6520  b'invalid value 
+00009740: 666f 7220 6073 746f 7261 6765 2e72 6576  for `storage.rev
+00009750: 6c6f 672e 7a6c 6962 2e6c 6576 656c 6020  log.zlib.level` 
+00009760: 636f 6e66 6967 3a20 2564 2729 0a20 2020  config: %d').   
+00009770: 2020 2020 2020 2020 2072 6169 7365 2065           raise e
+00009780: 7272 6f72 2e41 626f 7274 286d 7367 2025  rror.Abort(msg %
+00009790: 206f 7074 696f 6e73 5b62 277a 6c69 622e   options[b'zlib.
+000097a0: 6c65 7665 6c27 5d29 0a20 2020 206f 7074  level']).    opt
+000097b0: 696f 6e73 5b62 277a 7374 642e 6c65 7665  ions[b'zstd.leve
+000097c0: 6c27 5d20 3d20 7569 2e63 6f6e 6669 6769  l'] = ui.configi
+000097d0: 6e74 2862 2773 746f 7261 6765 272c 2062  nt(b'storage', b
+000097e0: 2772 6576 6c6f 672e 7a73 7464 2e6c 6576  'revlog.zstd.lev
+000097f0: 656c 2729 0a20 2020 2069 6620 6f70 7469  el').    if opti
+00009800: 6f6e 735b 6227 7a73 7464 2e6c 6576 656c  ons[b'zstd.level
+00009810: 275d 2069 7320 6e6f 7420 4e6f 6e65 3a0a  '] is not None:.
+00009820: 2020 2020 2020 2020 6966 206e 6f74 2028          if not (
+00009830: 3020 3c3d 206f 7074 696f 6e73 5b62 277a  0 <= options[b'z
+00009840: 7374 642e 6c65 7665 6c27 5d20 3c3d 2032  std.level'] <= 2
+00009850: 3229 3a0a 2020 2020 2020 2020 2020 2020  2):.            
+00009860: 6d73 6720 3d20 5f28 6227 696e 7661 6c69  msg = _(b'invali
+00009870: 6420 7661 6c75 6520 666f 7220 6073 746f  d value for `sto
+00009880: 7261 6765 2e72 6576 6c6f 672e 7a73 7464  rage.revlog.zstd
+00009890: 2e6c 6576 656c 6020 636f 6e66 6967 3a20  .level` config: 
+000098a0: 2564 2729 0a20 2020 2020 2020 2020 2020  %d').           
+000098b0: 2072 6169 7365 2065 7272 6f72 2e41 626f   raise error.Abo
+000098c0: 7274 286d 7367 2025 206f 7074 696f 6e73  rt(msg % options
+000098d0: 5b62 277a 7374 642e 6c65 7665 6c27 5d29  [b'zstd.level'])
+000098e0: 0a0a 2020 2020 6966 2072 6571 7569 7265  ..    if require
+000098f0: 6d65 6e74 736d 6f64 2e4e 4152 524f 575f  mentsmod.NARROW_
+00009900: 5245 5155 4952 454d 454e 5420 696e 2072  REQUIREMENT in r
+00009910: 6571 7569 7265 6d65 6e74 733a 0a20 2020  equirements:.   
+00009920: 2020 2020 206f 7074 696f 6e73 5b62 2765       options[b'e
+00009930: 6e61 626c 6565 6c6c 6970 7369 7327 5d20  nableellipsis'] 
+00009940: 3d20 5472 7565 0a0a 2020 2020 6966 2075  = True..    if u
+00009950: 692e 636f 6e66 6967 626f 6f6c 2862 2765  i.configbool(b'e
+00009960: 7870 6572 696d 656e 7461 6c27 2c20 6227  xperimental', b'
+00009970: 7275 7374 2e69 6e64 6578 2729 3a0a 2020  rust.index'):.  
+00009980: 2020 2020 2020 6f70 7469 6f6e 735b 6227        options[b'
+00009990: 7275 7374 2e69 6e64 6578 275d 203d 2054  rust.index'] = T
+000099a0: 7275 650a 2020 2020 6966 2072 6571 7569  rue.    if requi
+000099b0: 7265 6d65 6e74 736d 6f64 2e4e 4f44 454d  rementsmod.NODEM
+000099c0: 4150 5f52 4551 5549 5245 4d45 4e54 2069  AP_REQUIREMENT i
+000099d0: 6e20 7265 7175 6972 656d 656e 7473 3a0a  n requirements:.
+000099e0: 2020 2020 2020 2020 736c 6f77 5f70 6174          slow_pat
+000099f0: 6820 3d20 7569 2e63 6f6e 6669 6728 0a20  h = ui.config(. 
+00009a00: 2020 2020 2020 2020 2020 2062 2773 746f             b'sto
+00009a10: 7261 6765 272c 2062 2772 6576 6c6f 672e  rage', b'revlog.
+00009a20: 7065 7273 6973 7465 6e74 2d6e 6f64 656d  persistent-nodem
+00009a30: 6170 2e73 6c6f 772d 7061 7468 270a 2020  ap.slow-path'.  
+00009a40: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00009a50: 6966 2073 6c6f 775f 7061 7468 206e 6f74  if slow_path not
+00009a60: 2069 6e20 2862 2761 6c6c 6f77 272c 2062   in (b'allow', b
+00009a70: 2777 6172 6e27 2c20 6227 6162 6f72 7427  'warn', b'abort'
+00009a80: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
+00009a90: 6566 6175 6c74 203d 2075 692e 636f 6e66  efault = ui.conf
+00009aa0: 6967 5f64 6566 6175 6c74 280a 2020 2020  ig_default(.    
+00009ab0: 2020 2020 2020 2020 2020 2020 6227 7374              b'st
+00009ac0: 6f72 6167 6527 2c20 6227 7265 766c 6f67  orage', b'revlog
+00009ad0: 2e70 6572 7369 7374 656e 742d 6e6f 6465  .persistent-node
+00009ae0: 6d61 702e 736c 6f77 2d70 6174 6827 0a20  map.slow-path'. 
+00009af0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00009b00: 2020 2020 2020 2020 206d 7367 203d 205f           msg = _
+00009b10: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00009b20: 2020 6227 756e 6b6e 6f77 6e20 7661 6c75    b'unknown valu
+00009b30: 6520 666f 7220 636f 6e66 6967 2027 0a20  e for config '. 
+00009b40: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00009b50: 2722 7374 6f72 6167 652e 7265 766c 6f67  '"storage.revlog
+00009b60: 2e70 6572 7369 7374 656e 742d 6e6f 6465  .persistent-node
+00009b70: 6d61 702e 736c 6f77 2d70 6174 6822 3a20  map.slow-path": 
+00009b80: 2225 7322 5c6e 270a 2020 2020 2020 2020  "%s"\n'.        
+00009b90: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00009ba0: 2020 7569 2e77 6172 6e28 6d73 6720 2520    ui.warn(msg % 
+00009bb0: 736c 6f77 5f70 6174 6829 0a20 2020 2020  slow_path).     
+00009bc0: 2020 2020 2020 2069 6620 6e6f 7420 7569         if not ui
+00009bd0: 2e71 7569 6574 3a0a 2020 2020 2020 2020  .quiet:.        
+00009be0: 2020 2020 2020 2020 7569 2e77 6172 6e28          ui.warn(
+00009bf0: 5f28 6227 6661 6c6c 696e 6720 6261 636b  _(b'falling back
+00009c00: 2074 6f20 6465 6661 756c 7420 7661 6c75   to default valu
+00009c10: 653a 2025 735c 6e27 2920 2520 6465 6661  e: %s\n') % defa
+00009c20: 756c 7429 0a20 2020 2020 2020 2020 2020  ult).           
+00009c30: 2073 6c6f 775f 7061 7468 203d 2064 6566   slow_path = def
+00009c40: 6175 6c74 0a0a 2020 2020 2020 2020 6d73  ault..        ms
+00009c50: 6720 3d20 5f28 0a20 2020 2020 2020 2020  g = _(.         
+00009c60: 2020 2062 2261 6363 6573 7369 6e67 2060     b"accessing `
+00009c70: 7065 7273 6973 7465 6e74 2d6e 6f64 656d  persistent-nodem
+00009c80: 6170 6020 7265 706f 7369 746f 7279 2077  ap` repository w
+00009c90: 6974 686f 7574 2061 7373 6f63 6961 7465  ithout associate
+00009ca0: 6420 220a 2020 2020 2020 2020 2020 2020  d ".            
+00009cb0: 6222 6661 7374 2069 6d70 6c65 6d65 6e74  b"fast implement
+00009cc0: 6174 696f 6e2e 220a 2020 2020 2020 2020  ation.".        
+00009cd0: 290a 2020 2020 2020 2020 6869 6e74 203d  ).        hint =
+00009ce0: 205f 280a 2020 2020 2020 2020 2020 2020   _(.            
+00009cf0: 6222 6368 6563 6b20 6068 6720 6865 6c70  b"check `hg help
+00009d00: 2063 6f6e 6669 672e 666f 726d 6174 2e75   config.format.u
+00009d10: 7365 2d70 6572 7369 7374 656e 742d 6e6f  se-persistent-no
+00009d20: 6465 6d61 7060 2022 0a20 2020 2020 2020  demap` ".       
+00009d30: 2020 2020 2062 2266 6f72 2064 6574 6169       b"for detai
+00009d40: 6c73 220a 2020 2020 2020 2020 290a 2020  ls".        ).  
+00009d50: 2020 2020 2020 6966 206e 6f74 2072 6576        if not rev
+00009d60: 6c6f 672e 4841 535f 4641 5354 5f50 4552  log.HAS_FAST_PER
+00009d70: 5349 5354 454e 545f 4e4f 4445 4d41 503a  SISTENT_NODEMAP:
+00009d80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00009d90: 736c 6f77 5f70 6174 6820 3d3d 2062 2777  slow_path == b'w
+00009da0: 6172 6e27 3a0a 2020 2020 2020 2020 2020  arn':.          
+00009db0: 2020 2020 2020 6d73 6720 3d20 6222 7761        msg = b"wa
+00009dc0: 726e 696e 673a 2022 202b 206d 7367 202b  rning: " + msg +
+00009dd0: 2062 275c 6e27 0a20 2020 2020 2020 2020   b'\n'.         
+00009de0: 2020 2020 2020 2075 692e 7761 726e 286d         ui.warn(m
+00009df0: 7367 290a 2020 2020 2020 2020 2020 2020  sg).            
+00009e00: 2020 2020 6966 206e 6f74 2075 692e 7175      if not ui.qu
+00009e10: 6965 743a 0a20 2020 2020 2020 2020 2020  iet:.           
+00009e20: 2020 2020 2020 2020 2068 696e 7420 3d20           hint = 
+00009e30: 6227 2827 202b 2068 696e 7420 2b20 6227  b'(' + hint + b'
+00009e40: 295c 6e27 0a20 2020 2020 2020 2020 2020  )\n'.           
+00009e50: 2020 2020 2020 2020 2075 692e 7761 726e           ui.warn
+00009e60: 2868 696e 7429 0a20 2020 2020 2020 2020  (hint).         
+00009e70: 2020 2069 6620 736c 6f77 5f70 6174 6820     if slow_path 
+00009e80: 3d3d 2062 2761 626f 7274 273a 0a20 2020  == b'abort':.   
+00009e90: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00009ea0: 7365 2065 7272 6f72 2e41 626f 7274 286d  se error.Abort(m
+00009eb0: 7367 2c20 6869 6e74 3d68 696e 7429 0a20  sg, hint=hint). 
+00009ec0: 2020 2020 2020 206f 7074 696f 6e73 5b62         options[b
+00009ed0: 2770 6572 7369 7374 656e 742d 6e6f 6465  'persistent-node
+00009ee0: 6d61 7027 5d20 3d20 5472 7565 0a20 2020  map'] = True.   
+00009ef0: 2069 6620 7265 7175 6972 656d 656e 7473   if requirements
+00009f00: 6d6f 642e 4449 5253 5441 5445 5f56 325f  mod.DIRSTATE_V2_
+00009f10: 5245 5155 4952 454d 454e 5420 696e 2072  REQUIREMENT in r
+00009f20: 6571 7569 7265 6d65 6e74 733a 0a20 2020  equirements:.   
+00009f30: 2020 2020 2073 6c6f 775f 7061 7468 203d       slow_path =
+00009f40: 2075 692e 636f 6e66 6967 2862 2773 746f   ui.config(b'sto
+00009f50: 7261 6765 272c 2062 2764 6972 7374 6174  rage', b'dirstat
+00009f60: 652d 7632 2e73 6c6f 772d 7061 7468 2729  e-v2.slow-path')
+00009f70: 0a20 2020 2020 2020 2069 6620 736c 6f77  .        if slow
+00009f80: 5f70 6174 6820 6e6f 7420 696e 2028 6227  _path not in (b'
+00009f90: 616c 6c6f 7727 2c20 6227 7761 726e 272c  allow', b'warn',
+00009fa0: 2062 2761 626f 7274 2729 3a0a 2020 2020   b'abort'):.    
+00009fb0: 2020 2020 2020 2020 6465 6661 756c 7420          default 
+00009fc0: 3d20 7569 2e63 6f6e 6669 675f 6465 6661  = ui.config_defa
+00009fd0: 756c 7428 6227 7374 6f72 6167 6527 2c20  ult(b'storage', 
+00009fe0: 6227 6469 7273 7461 7465 2d76 322e 736c  b'dirstate-v2.sl
+00009ff0: 6f77 2d70 6174 6827 290a 2020 2020 2020  ow-path').      
+0000a000: 2020 2020 2020 6d73 6720 3d20 5f28 6227        msg = _(b'
+0000a010: 756e 6b6e 6f77 6e20 7661 6c75 6520 666f  unknown value fo
+0000a020: 7220 636f 6e66 6967 2022 6469 7273 7461  r config "dirsta
+0000a030: 7465 2d76 322e 736c 6f77 2d70 6174 6822  te-v2.slow-path"
+0000a040: 3a20 2225 7322 5c6e 2729 0a20 2020 2020  : "%s"\n').     
+0000a050: 2020 2020 2020 2075 692e 7761 726e 286d         ui.warn(m
+0000a060: 7367 2025 2073 6c6f 775f 7061 7468 290a  sg % slow_path).
+0000a070: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000a080: 6f74 2075 692e 7175 6965 743a 0a20 2020  ot ui.quiet:.   
+0000a090: 2020 2020 2020 2020 2020 2020 2075 692e               ui.
+0000a0a0: 7761 726e 285f 2862 2766 616c 6c69 6e67  warn(_(b'falling
+0000a0b0: 2062 6163 6b20 746f 2064 6566 6175 6c74   back to default
+0000a0c0: 2076 616c 7565 3a20 2573 5c6e 2729 2025   value: %s\n') %
+0000a0d0: 2064 6566 6175 6c74 290a 2020 2020 2020   default).      
+0000a0e0: 2020 2020 2020 736c 6f77 5f70 6174 6820        slow_path 
+0000a0f0: 3d20 6465 6661 756c 740a 0a20 2020 2020  = default..     
+0000a100: 2020 206d 7367 203d 205f 280a 2020 2020     msg = _(.    
+0000a110: 2020 2020 2020 2020 6222 6163 6365 7373          b"access
+0000a120: 696e 6720 6064 6972 7374 6174 652d 7632  ing `dirstate-v2
+0000a130: 6020 7265 706f 7369 746f 7279 2077 6974  ` repository wit
+0000a140: 686f 7574 2061 7373 6f63 6961 7465 6420  hout associated 
+0000a150: 220a 2020 2020 2020 2020 2020 2020 6222  ".            b"
+0000a160: 6661 7374 2069 6d70 6c65 6d65 6e74 6174  fast implementat
+0000a170: 696f 6e2e 220a 2020 2020 2020 2020 290a  ion.".        ).
+0000a180: 2020 2020 2020 2020 6869 6e74 203d 205f          hint = _
+0000a190: 280a 2020 2020 2020 2020 2020 2020 6222  (.            b"
+0000a1a0: 6368 6563 6b20 6068 6720 6865 6c70 2063  check `hg help c
+0000a1b0: 6f6e 6669 672e 666f 726d 6174 2e75 7365  onfig.format.use
+0000a1c0: 2d64 6972 7374 6174 652d 7632 6020 2220  -dirstate-v2` " 
+0000a1d0: 6222 666f 7220 6465 7461 696c 7322 0a20  b"for details". 
+0000a1e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000a1f0: 2069 6620 6e6f 7420 6469 7273 7461 7465   if not dirstate
+0000a200: 2e48 4153 5f46 4153 545f 4449 5253 5441  .HAS_FAST_DIRSTA
+0000a210: 5445 5f56 323a 0a20 2020 2020 2020 2020  TE_V2:.         
+0000a220: 2020 2069 6620 736c 6f77 5f70 6174 6820     if slow_path 
+0000a230: 3d3d 2062 2777 6172 6e27 3a0a 2020 2020  == b'warn':.    
+0000a240: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
+0000a250: 3d20 6222 7761 726e 696e 673a 2022 202b  = b"warning: " +
+0000a260: 206d 7367 202b 2062 275c 6e27 0a20 2020   msg + b'\n'.   
+0000a270: 2020 2020 2020 2020 2020 2020 2075 692e               ui.
+0000a280: 7761 726e 286d 7367 290a 2020 2020 2020  warn(msg).      
+0000a290: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000a2a0: 2075 692e 7175 6965 743a 0a20 2020 2020   ui.quiet:.     
+0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0000a2c0: 696e 7420 3d20 6227 2827 202b 2068 696e  int = b'(' + hin
+0000a2d0: 7420 2b20 6227 295c 6e27 0a20 2020 2020  t + b')\n'.     
+0000a2e0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0000a2f0: 692e 7761 726e 2868 696e 7429 0a20 2020  i.warn(hint).   
+0000a300: 2020 2020 2020 2020 2069 6620 736c 6f77           if slow
+0000a310: 5f70 6174 6820 3d3d 2062 2761 626f 7274  _path == b'abort
+0000a320: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+0000a330: 2020 2072 6169 7365 2065 7272 6f72 2e41     raise error.A
+0000a340: 626f 7274 286d 7367 2c20 6869 6e74 3d68  bort(msg, hint=h
+0000a350: 696e 7429 0a20 2020 2069 6620 7569 2e63  int).    if ui.c
+0000a360: 6f6e 6669 6762 6f6f 6c28 6227 7374 6f72  onfigbool(b'stor
+0000a370: 6167 6527 2c20 6227 7265 766c 6f67 2e70  age', b'revlog.p
+0000a380: 6572 7369 7374 656e 742d 6e6f 6465 6d61  ersistent-nodema
+0000a390: 702e 6d6d 6170 2729 3a0a 2020 2020 2020  p.mmap'):.      
+0000a3a0: 2020 6f70 7469 6f6e 735b 6227 7065 7273    options[b'pers
+0000a3b0: 6973 7465 6e74 2d6e 6f64 656d 6170 2e6d  istent-nodemap.m
+0000a3c0: 6d61 7027 5d20 3d20 5472 7565 0a20 2020  map'] = True.   
+0000a3d0: 2069 6620 7569 2e63 6f6e 6669 6762 6f6f   if ui.configboo
+0000a3e0: 6c28 6227 6465 7665 6c27 2c20 6227 7065  l(b'devel', b'pe
+0000a3f0: 7273 6973 7465 6e74 2d6e 6f64 656d 6170  rsistent-nodemap
+0000a400: 2729 3a0a 2020 2020 2020 2020 6f70 7469  '):.        opti
+0000a410: 6f6e 735b 6227 6465 7665 6c2d 666f 7263  ons[b'devel-forc
+0000a420: 652d 6e6f 6465 6d61 7027 5d20 3d20 5472  e-nodemap'] = Tr
+0000a430: 7565 0a0a 2020 2020 7265 7475 726e 206f  ue..    return o
+0000a440: 7074 696f 6e73 0a0a 0a64 6566 206d 616b  ptions...def mak
+0000a450: 656d 6169 6e28 2a2a 6b77 6172 6773 293a  emain(**kwargs):
+0000a460: 0a20 2020 2022 2222 5072 6f64 7563 6520  .    """Produce 
+0000a470: 6120 7479 7065 2063 6f6e 666f 726d 696e  a type conformin
+0000a480: 6720 746f 2060 6069 6c6f 6361 6c72 6570  g to ``ilocalrep
+0000a490: 6f73 6974 6f72 796d 6169 6e60 602e 2222  ositorymain``.""
+0000a4a0: 220a 2020 2020 7265 7475 726e 206c 6f63  ".    return loc
+0000a4b0: 616c 7265 706f 7369 746f 7279 0a0a 0a40  alrepository...@
+0000a4c0: 696e 7465 7266 6163 6575 7469 6c2e 696d  interfaceutil.im
+0000a4d0: 706c 656d 656e 7465 7228 7265 706f 7369  plementer(reposi
+0000a4e0: 746f 7279 2e69 6c6f 6361 6c72 6570 6f73  tory.ilocalrepos
+0000a4f0: 6974 6f72 7966 696c 6573 746f 7261 6765  itoryfilestorage
+0000a500: 290a 636c 6173 7320 7265 766c 6f67 6669  ).class revlogfi
+0000a510: 6c65 7374 6f72 6167 653a 0a20 2020 2022  lestorage:.    "
+0000a520: 2222 4669 6c65 2073 746f 7261 6765 2077  ""File storage w
+0000a530: 6865 6e20 7573 696e 6720 7265 766c 6f67  hen using revlog
+0000a540: 732e 2222 220a 0a20 2020 2064 6566 2066  s."""..    def f
+0000a550: 696c 6528 7365 6c66 2c20 7061 7468 293a  ile(self, path):
+0000a560: 0a20 2020 2020 2020 2069 6620 7061 7468  .        if path
+0000a570: 2e73 7461 7274 7377 6974 6828 6227 2f27  .startswith(b'/'
+0000a580: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+0000a590: 6174 6820 3d20 7061 7468 5b31 3a5d 0a0a  ath = path[1:]..
+0000a5a0: 2020 2020 2020 2020 7472 795f 7370 6c69          try_spli
+0000a5b0: 7420 3d20 280a 2020 2020 2020 2020 2020  t = (.          
+0000a5c0: 2020 7365 6c66 2e63 7572 7265 6e74 7472    self.currenttr
+0000a5d0: 616e 7361 6374 696f 6e28 2920 6973 206e  ansaction() is n
+0000a5e0: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
+0000a5f0: 2020 2020 6f72 2074 786e 7574 696c 2e6d      or txnutil.m
+0000a600: 6179 6861 7665 7065 6e64 696e 6728 7365  ayhavepending(se
+0000a610: 6c66 2e72 6f6f 7429 0a20 2020 2020 2020  lf.root).       
+0000a620: 2029 0a0a 2020 2020 2020 2020 7265 7475   )..        retu
+0000a630: 726e 2066 696c 656c 6f67 2e66 696c 656c  rn filelog.filel
+0000a640: 6f67 2873 656c 662e 7376 6673 2c20 7061  og(self.svfs, pa
+0000a650: 7468 2c20 7472 795f 7370 6c69 743d 7472  th, try_split=tr
+0000a660: 795f 7370 6c69 7429 0a0a 0a40 696e 7465  y_split)...@inte
+0000a670: 7266 6163 6575 7469 6c2e 696d 706c 656d  rfaceutil.implem
+0000a680: 656e 7465 7228 7265 706f 7369 746f 7279  enter(repository
+0000a690: 2e69 6c6f 6361 6c72 6570 6f73 6974 6f72  .ilocalrepositor
+0000a6a0: 7966 696c 6573 746f 7261 6765 290a 636c  yfilestorage).cl
+0000a6b0: 6173 7320 7265 766c 6f67 6e61 7272 6f77  ass revlognarrow
+0000a6c0: 6669 6c65 7374 6f72 6167 653a 0a20 2020  filestorage:.   
+0000a6d0: 2022 2222 4669 6c65 2073 746f 7261 6765   """File storage
+0000a6e0: 2077 6865 6e20 7573 696e 6720 7265 766c   when using revl
+0000a6f0: 6f67 7320 616e 6420 6e61 7272 6f77 2066  ogs and narrow f
+0000a700: 696c 6573 2e22 2222 0a0a 2020 2020 6465  iles."""..    de
+0000a710: 6620 6669 6c65 2873 656c 662c 2070 6174  f file(self, pat
+0000a720: 6829 3a0a 2020 2020 2020 2020 6966 2070  h):.        if p
+0000a730: 6174 682e 7374 6172 7473 7769 7468 2862  ath.startswith(b
+0000a740: 272f 2729 3a0a 2020 2020 2020 2020 2020  '/'):.          
+0000a750: 2020 7061 7468 203d 2070 6174 685b 313a    path = path[1:
+0000a760: 5d0a 0a20 2020 2020 2020 2074 7279 5f73  ]..        try_s
+0000a770: 706c 6974 203d 2028 0a20 2020 2020 2020  plit = (.       
+0000a780: 2020 2020 2073 656c 662e 6375 7272 656e       self.curren
+0000a790: 7474 7261 6e73 6163 7469 6f6e 2829 2069  ttransaction() i
+0000a7a0: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
+0000a7b0: 2020 2020 2020 206f 7220 7478 6e75 7469         or txnuti
+0000a7c0: 6c2e 6d61 7968 6176 6570 656e 6469 6e67  l.mayhavepending
+0000a7d0: 2873 656c 662e 726f 6f74 290a 2020 2020  (self.root).    
+0000a7e0: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+0000a7f0: 7475 726e 2066 696c 656c 6f67 2e6e 6172  turn filelog.nar
+0000a800: 726f 7766 696c 656c 6f67 280a 2020 2020  rowfilelog(.    
+0000a810: 2020 2020 2020 2020 7365 6c66 2e73 7666          self.svf
+0000a820: 732c 2070 6174 682c 2073 656c 662e 5f73  s, path, self._s
+0000a830: 746f 7265 6e61 7272 6f77 6d61 7463 682c  torenarrowmatch,
+0000a840: 2074 7279 5f73 706c 6974 3d74 7279 5f73   try_split=try_s
+0000a850: 706c 6974 0a20 2020 2020 2020 2029 0a0a  plit.        )..
+0000a860: 0a64 6566 206d 616b 6566 696c 6573 746f  .def makefilesto
+0000a870: 7261 6765 2872 6571 7569 7265 6d65 6e74  rage(requirement
+0000a880: 732c 2066 6561 7475 7265 732c 202a 2a6b  s, features, **k
+0000a890: 7761 7267 7329 3a0a 2020 2020 2222 2250  wargs):.    """P
+0000a8a0: 726f 6475 6365 2061 2074 7970 6520 636f  roduce a type co
+0000a8b0: 6e66 6f72 6d69 6e67 2074 6f20 6060 696c  nforming to ``il
+0000a8c0: 6f63 616c 7265 706f 7369 746f 7279 6669  ocalrepositoryfi
+0000a8d0: 6c65 7374 6f72 6167 6560 602e 2222 220a  lestorage``.""".
+0000a8e0: 2020 2020 6665 6174 7572 6573 2e61 6464      features.add
+0000a8f0: 2872 6570 6f73 6974 6f72 792e 5245 504f  (repository.REPO
+0000a900: 5f46 4541 5455 5245 5f52 4556 4c4f 475f  _FEATURE_REVLOG_
+0000a910: 4649 4c45 5f53 544f 5241 4745 290a 2020  FILE_STORAGE).  
+0000a920: 2020 6665 6174 7572 6573 2e61 6464 2872    features.add(r
+0000a930: 6570 6f73 6974 6f72 792e 5245 504f 5f46  epository.REPO_F
+0000a940: 4541 5455 5245 5f53 5452 4541 4d5f 434c  EATURE_STREAM_CL
+0000a950: 4f4e 4529 0a0a 2020 2020 6966 2072 6571  ONE)..    if req
+0000a960: 7569 7265 6d65 6e74 736d 6f64 2e4e 4152  uirementsmod.NAR
+0000a970: 524f 575f 5245 5155 4952 454d 454e 5420  ROW_REQUIREMENT 
+0000a980: 696e 2072 6571 7569 7265 6d65 6e74 733a  in requirements:
+0000a990: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000a9a0: 7265 766c 6f67 6e61 7272 6f77 6669 6c65  revlognarrowfile
+0000a9b0: 7374 6f72 6167 650a 2020 2020 656c 7365  storage.    else
+0000a9c0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000a9d0: 2072 6576 6c6f 6766 696c 6573 746f 7261   revlogfilestora
+0000a9e0: 6765 0a0a 0a23 204c 6973 7420 6f66 2072  ge...# List of r
+0000a9f0: 6570 6f73 6974 6f72 7920 696e 7465 7266  epository interf
+0000aa00: 6163 6573 2061 6e64 2066 6163 746f 7279  aces and factory
+0000aa10: 2066 756e 6374 696f 6e73 2066 6f72 2074   functions for t
+0000aa20: 6865 6d2e 2045 6163 680a 2320 7769 6c6c  hem. Each.# will
+0000aa30: 2062 6520 6361 6c6c 6564 2069 6e20 6f72   be called in or
+0000aa40: 6465 7220 6475 7269 6e67 2060 606d 616b  der during ``mak
+0000aa50: 656c 6f63 616c 7265 706f 7369 746f 7279  elocalrepository
+0000aa60: 2829 6060 2074 6f20 6974 6572 6174 6976  ()`` to iterativ
+0000aa70: 656c 790a 2320 6465 7269 7665 2074 6865  ely.# derive the
+0000aa80: 2066 696e 616c 2074 7970 6520 666f 7220   final type for 
+0000aa90: 6120 6c6f 6361 6c20 7265 706f 7369 746f  a local reposito
+0000aaa0: 7279 2069 6e73 7461 6e63 652e 2057 6520  ry instance. We 
+0000aab0: 6361 7074 7572 6520 7468 650a 2320 6675  capture the.# fu
+0000aac0: 6e63 7469 6f6e 2061 7320 6120 6c61 6d62  nction as a lamb
+0000aad0: 6461 2073 6f20 7765 2064 6f6e 2774 2068  da so we don't h
+0000aae0: 6f6c 6420 6120 7265 6665 7265 6e63 6520  old a reference 
+0000aaf0: 616e 6420 7468 6520 6d6f 6475 6c65 2d6c  and the module-l
+0000ab00: 6576 656c 0a23 2066 756e 6374 696f 6e73  evel.# functions
+0000ab10: 2063 616e 2062 6520 7772 6170 7065 642e   can be wrapped.
+0000ab20: 0a52 4550 4f5f 494e 5445 5246 4143 4553  .REPO_INTERFACES
+0000ab30: 203d 205b 0a20 2020 2028 7265 706f 7369   = [.    (reposi
+0000ab40: 746f 7279 2e69 6c6f 6361 6c72 6570 6f73  tory.ilocalrepos
+0000ab50: 6974 6f72 796d 6169 6e2c 206c 616d 6264  itorymain, lambd
+0000ab60: 613a 206d 616b 656d 6169 6e29 2c0a 2020  a: makemain),.  
+0000ab70: 2020 2872 6570 6f73 6974 6f72 792e 696c    (repository.il
+0000ab80: 6f63 616c 7265 706f 7369 746f 7279 6669  ocalrepositoryfi
+0000ab90: 6c65 7374 6f72 6167 652c 206c 616d 6264  lestorage, lambd
+0000aba0: 613a 206d 616b 6566 696c 6573 746f 7261  a: makefilestora
+0000abb0: 6765 292c 0a5d 0a0a 0a40 696e 7465 7266  ge),.]...@interf
+0000abc0: 6163 6575 7469 6c2e 696d 706c 656d 656e  aceutil.implemen
+0000abd0: 7465 7228 7265 706f 7369 746f 7279 2e69  ter(repository.i
+0000abe0: 6c6f 6361 6c72 6570 6f73 6974 6f72 796d  localrepositorym
+0000abf0: 6169 6e29 0a63 6c61 7373 206c 6f63 616c  ain).class local
+0000ac00: 7265 706f 7369 746f 7279 3a0a 2020 2020  repository:.    
+0000ac10: 2222 224d 6169 6e20 636c 6173 7320 666f  """Main class fo
+0000ac20: 7220 7265 7072 6573 656e 7469 6e67 206c  r representing l
+0000ac30: 6f63 616c 2072 6570 6f73 6974 6f72 6965  ocal repositorie
+0000ac40: 732e 0a0a 2020 2020 416c 6c20 6c6f 6361  s...    All loca
+0000ac50: 6c20 7265 706f 7369 746f 7269 6573 2061  l repositories a
+0000ac60: 7265 2069 6e73 7461 6e63 6573 206f 6620  re instances of 
+0000ac70: 7468 6973 2063 6c61 7373 2e0a 0a20 2020  this class...   
+0000ac80: 2043 6f6e 7374 7275 6374 6564 206f 6e20   Constructed on 
+0000ac90: 6974 7320 6f77 6e2c 2069 6e73 7461 6e63  its own, instanc
+0000aca0: 6573 206f 6620 7468 6973 2063 6c61 7373  es of this class
+0000acb0: 2061 7265 206e 6f74 2075 7361 626c 6520   are not usable 
+0000acc0: 6173 0a20 2020 2072 6570 6f73 6974 6f72  as.    repositor
+0000acd0: 7920 6f62 6a65 6374 732e 2054 6f20 6f62  y objects. To ob
+0000ace0: 7461 696e 2061 2075 7361 626c 6520 7265  tain a usable re
+0000acf0: 706f 7369 746f 7279 206f 626a 6563 742c  pository object,
+0000ad00: 2063 616c 6c0a 2020 2020 6060 6867 2e72   call.    ``hg.r
+0000ad10: 6570 6f73 6974 6f72 7928 2960 602c 2060  epository()``, `
+0000ad20: 606c 6f63 616c 7265 706f 2e69 6e73 7461  `localrepo.insta
+0000ad30: 6e63 6528 2960 602c 206f 720a 2020 2020  nce()``, or.    
+0000ad40: 6060 6c6f 6361 6c72 6570 6f2e 6d61 6b65  ``localrepo.make
+0000ad50: 6c6f 6361 6c72 6570 6f73 6974 6f72 7928  localrepository(
+0000ad60: 2960 602e 2054 6865 206c 6174 7465 7220  )``. The latter 
+0000ad70: 6973 2074 6865 206c 6f77 6573 742d 6c65  is the lowest-le
+0000ad80: 7665 6c2e 0a20 2020 2060 6069 6e73 7461  vel..    ``insta
+0000ad90: 6e63 6528 2960 6020 6164 6473 2073 7570  nce()`` adds sup
+0000ada0: 706f 7274 2066 6f72 2063 7265 6174 696e  port for creatin
+0000adb0: 6720 6e65 7720 7265 706f 7369 746f 7269  g new repositori
+0000adc0: 6573 2e0a 2020 2020 6060 6867 2e72 6570  es..    ``hg.rep
+0000add0: 6f73 6974 6f72 7928 2960 6020 6164 6473  ository()`` adds
+0000ade0: 206d 6f72 6520 6578 7465 6e73 696f 6e20   more extension 
+0000adf0: 696e 7465 6772 6174 696f 6e2c 2069 6e63  integration, inc
+0000ae00: 6c75 6469 6e67 2063 616c 6c69 6e67 0a20  luding calling. 
+0000ae10: 2020 2060 6072 6570 6f73 6574 7570 2829     ``reposetup()
+0000ae20: 6060 2e20 4765 6e65 7261 6c6c 7920 7370  ``. Generally sp
+0000ae30: 6561 6b69 6e67 2c20 6060 6867 2e72 6570  eaking, ``hg.rep
+0000ae40: 6f73 6974 6f72 7928 2960 6020 7368 6f75  ository()`` shou
+0000ae50: 6c64 2062 650a 2020 2020 7573 6564 2e0a  ld be.    used..
+0000ae60: 2020 2020 2222 220a 0a20 2020 205f 6261      """..    _ba
+0000ae70: 7365 7375 7070 6f72 7465 6420 3d20 7b0a  sesupported = {.
+0000ae80: 2020 2020 2020 2020 7265 7175 6972 656d          requirem
+0000ae90: 656e 7473 6d6f 642e 4152 4348 4956 4544  entsmod.ARCHIVED
+0000aea0: 5f50 4841 5345 5f52 4551 5549 5245 4d45  _PHASE_REQUIREME
+0000aeb0: 4e54 2c0a 2020 2020 2020 2020 7265 7175  NT,.        requ
+0000aec0: 6972 656d 656e 7473 6d6f 642e 424f 4f4b  irementsmod.BOOK
+0000aed0: 4d41 524b 535f 494e 5f53 544f 5245 5f52  MARKS_IN_STORE_R
+0000aee0: 4551 5549 5245 4d45 4e54 2c0a 2020 2020  EQUIREMENT,.    
+0000aef0: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
+0000af00: 6d6f 642e 4348 414e 4745 4c4f 4756 325f  mod.CHANGELOGV2_
+0000af10: 5245 5155 4952 454d 454e 542c 0a20 2020  REQUIREMENT,.   
+0000af20: 2020 2020 2072 6571 7569 7265 6d65 6e74       requirement
+0000af30: 736d 6f64 2e43 4f50 4945 5353 4443 5f52  smod.COPIESSDC_R
+0000af40: 4551 5549 5245 4d45 4e54 2c0a 2020 2020  EQUIREMENT,.    
+0000af50: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
+0000af60: 6d6f 642e 4449 5253 5441 5445 5f54 5241  mod.DIRSTATE_TRA
+0000af70: 434b 4544 5f48 494e 545f 5631 2c0a 2020  CKED_HINT_V1,.  
+0000af80: 2020 2020 2020 7265 7175 6972 656d 656e        requiremen
+0000af90: 7473 6d6f 642e 4449 5253 5441 5445 5f56  tsmod.DIRSTATE_V
+0000afa0: 325f 5245 5155 4952 454d 454e 542c 0a20  2_REQUIREMENT,. 
+0000afb0: 2020 2020 2020 2072 6571 7569 7265 6d65         requireme
+0000afc0: 6e74 736d 6f64 2e44 4f54 454e 434f 4445  ntsmod.DOTENCODE
+0000afd0: 5f52 4551 5549 5245 4d45 4e54 2c0a 2020  _REQUIREMENT,.  
+0000afe0: 2020 2020 2020 7265 7175 6972 656d 656e        requiremen
+0000aff0: 7473 6d6f 642e 464e 4341 4348 455f 5245  tsmod.FNCACHE_RE
+0000b000: 5155 4952 454d 454e 542c 0a20 2020 2020  QUIREMENT,.     
+0000b010: 2020 2072 6571 7569 7265 6d65 6e74 736d     requirementsm
+0000b020: 6f64 2e47 454e 4552 414c 4445 4c54 415f  od.GENERALDELTA_
+0000b030: 5245 5155 4952 454d 454e 542c 0a20 2020  REQUIREMENT,.   
+0000b040: 2020 2020 2072 6571 7569 7265 6d65 6e74       requirement
+0000b050: 736d 6f64 2e49 4e54 4552 4e41 4c5f 5048  smod.INTERNAL_PH
+0000b060: 4153 455f 5245 5155 4952 454d 454e 542c  ASE_REQUIREMENT,
+0000b070: 0a20 2020 2020 2020 2072 6571 7569 7265  .        require
+0000b080: 6d65 6e74 736d 6f64 2e4e 4f44 454d 4150  mentsmod.NODEMAP
+0000b090: 5f52 4551 5549 5245 4d45 4e54 2c0a 2020  _REQUIREMENT,.  
+0000b0a0: 2020 2020 2020 7265 7175 6972 656d 656e        requiremen
+0000b0b0: 7473 6d6f 642e 5245 4c41 5449 5645 5f53  tsmod.RELATIVE_S
+0000b0c0: 4841 5245 445f 5245 5155 4952 454d 454e  HARED_REQUIREMEN
+0000b0d0: 542c 0a20 2020 2020 2020 2072 6571 7569  T,.        requi
+0000b0e0: 7265 6d65 6e74 736d 6f64 2e52 4556 4c4f  rementsmod.REVLO
+0000b0f0: 4756 315f 5245 5155 4952 454d 454e 542c  GV1_REQUIREMENT,
+0000b100: 0a20 2020 2020 2020 2072 6571 7569 7265  .        require
+0000b110: 6d65 6e74 736d 6f64 2e52 4556 4c4f 4756  mentsmod.REVLOGV
+0000b120: 325f 5245 5155 4952 454d 454e 542c 0a20  2_REQUIREMENT,. 
+0000b130: 2020 2020 2020 2072 6571 7569 7265 6d65         requireme
+0000b140: 6e74 736d 6f64 2e53 4841 5245 445f 5245  ntsmod.SHARED_RE
+0000b150: 5155 4952 454d 454e 542c 0a20 2020 2020  QUIREMENT,.     
+0000b160: 2020 2072 6571 7569 7265 6d65 6e74 736d     requirementsm
+0000b170: 6f64 2e53 4841 5245 5341 4645 5f52 4551  od.SHARESAFE_REQ
+0000b180: 5549 5245 4d45 4e54 2c0a 2020 2020 2020  UIREMENT,.      
+0000b190: 2020 7265 7175 6972 656d 656e 7473 6d6f    requirementsmo
+0000b1a0: 642e 5350 4152 5345 5f52 4551 5549 5245  d.SPARSE_REQUIRE
+0000b1b0: 4d45 4e54 2c0a 2020 2020 2020 2020 7265  MENT,.        re
+0000b1c0: 7175 6972 656d 656e 7473 6d6f 642e 5350  quirementsmod.SP
+0000b1d0: 4152 5345 5245 564c 4f47 5f52 4551 5549  ARSEREVLOG_REQUI
+0000b1e0: 5245 4d45 4e54 2c0a 2020 2020 2020 2020  REMENT,.        
+0000b1f0: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
+0000b200: 5354 4f52 455f 5245 5155 4952 454d 454e  STORE_REQUIREMEN
+0000b210: 542c 0a20 2020 2020 2020 2072 6571 7569  T,.        requi
+0000b220: 7265 6d65 6e74 736d 6f64 2e54 5245 454d  rementsmod.TREEM
+0000b230: 414e 4946 4553 545f 5245 5155 4952 454d  ANIFEST_REQUIREM
+0000b240: 454e 542c 0a20 2020 207d 0a0a 2020 2020  ENT,.    }..    
+0000b250: 2320 6c69 7374 206f 6620 7072 6566 6978  # list of prefix
+0000b260: 2066 6f72 2066 696c 6520 7768 6963 6820   for file which 
+0000b270: 6361 6e20 6265 2077 7269 7474 656e 2077  can be written w
+0000b280: 6974 686f 7574 2027 776c 6f63 6b27 0a20  ithout 'wlock'. 
+0000b290: 2020 2023 2045 7874 656e 7369 6f6e 7320     # Extensions 
+0000b2a0: 7368 6f75 6c64 2065 7874 656e 6420 7468  should extend th
+0000b2b0: 6973 206c 6973 7420 7768 656e 206e 6565  is list when nee
+0000b2c0: 6465 640a 2020 2020 5f77 6c6f 636b 6672  ded.    _wlockfr
+0000b2d0: 6565 7072 6566 6978 203d 207b 0a20 2020  eeprefix = {.   
+0000b2e0: 2020 2020 2023 2057 6520 6d69 6768 2063       # We migh c
+0000b2f0: 6f6e 7369 6465 7220 7265 7175 6972 696e  onsider requirin
+0000b300: 6720 2777 6c6f 636b 2720 666f 7220 7468  g 'wlock' for th
+0000b310: 6520 6e65 7874 0a20 2020 2020 2020 2023  e next.        #
+0000b320: 2074 776f 2c20 6275 7420 7072 6574 7479   two, but pretty
+0000b330: 206d 7563 6820 616c 6c20 7468 6520 6578   much all the ex
+0000b340: 6973 7469 6e67 2063 6f64 6520 6173 7375  isting code assu
+0000b350: 6d65 0a20 2020 2020 2020 2023 2077 6c6f  me.        # wlo
+0000b360: 636b 2069 7320 6e6f 7420 6e65 6564 6564  ck is not needed
+0000b370: 2073 6f20 7765 206b 6565 7020 7468 656d   so we keep them
+0000b380: 2065 7863 6c75 6465 6420 666f 720a 2020   excluded for.  
+0000b390: 2020 2020 2020 2320 6e6f 772e 0a20 2020        # now..   
+0000b3a0: 2020 2020 2062 2768 6772 6327 2c0a 2020       b'hgrc',.  
+0000b3b0: 2020 2020 2020 6227 7265 7175 6972 6573        b'requires
+0000b3c0: 272c 0a20 2020 2020 2020 2023 2058 5858  ',.        # XXX
+0000b3d0: 2063 6163 6865 2069 7320 6120 636f 6d70   cache is a comp
+0000b3e0: 6c69 6361 7467 6564 2062 7573 696e 6573  licatged busines
+0000b3f0: 7320 736f 6d65 6f6e 650a 2020 2020 2020  s someone.      
+0000b400: 2020 2320 7368 6f75 6c64 2069 6e76 6573    # should inves
+0000b410: 7469 6761 7465 2074 6869 7320 696e 2064  tigate this in d
+0000b420: 6570 7468 2061 7420 736f 6d65 2070 6f69  epth at some poi
+0000b430: 6e74 0a20 2020 2020 2020 2062 2763 6163  nt.        b'cac
+0000b440: 6865 2f27 2c0a 2020 2020 2020 2020 2320  he/',.        # 
+0000b450: 5858 5820 6269 7365 6374 2077 6173 2073  XXX bisect was s
+0000b460: 7469 6c6c 2061 2062 6974 2074 6f6f 206d  till a bit too m
+0000b470: 6573 7379 2061 7420 7468 6520 7469 6d65  essy at the time
+0000b480: 0a20 2020 2020 2020 2023 2074 6869 7320  .        # this 
+0000b490: 6368 616e 6765 7365 7420 7761 7320 696e  changeset was in
+0000b4a0: 7472 6f64 7563 6564 2e20 536f 6d65 6f6e  troduced. Someon
+0000b4b0: 6520 7368 6f75 6c64 2066 6978 0a20 2020  e should fix.   
+0000b4c0: 2020 2020 2023 2074 6865 2072 656d 6169       # the remai
+0000b4d0: 6e69 6720 6269 7420 616e 6420 6472 6f70  nig bit and drop
+0000b4e0: 2074 6869 7320 6c69 6e65 0a20 2020 2020   this line.     
+0000b4f0: 2020 2062 2762 6973 6563 742e 7374 6174     b'bisect.stat
+0000b500: 6527 2c0a 2020 2020 7d0a 0a20 2020 2064  e',.    }..    d
+0000b510: 6566 205f 5f69 6e69 745f 5f28 0a20 2020  ef __init__(.   
+0000b520: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0000b530: 2020 2062 6173 6575 692c 0a20 2020 2020     baseui,.     
+0000b540: 2020 2075 692c 0a20 2020 2020 2020 206f     ui,.        o
+0000b550: 7269 6772 6f6f 743a 2062 7974 6573 2c0a  rigroot: bytes,.
+0000b560: 2020 2020 2020 2020 7764 6972 7666 733a          wdirvfs:
+0000b570: 2076 6673 6d6f 642e 7666 732c 0a20 2020   vfsmod.vfs,.   
+0000b580: 2020 2020 2068 6776 6673 3a20 7666 736d       hgvfs: vfsm
+0000b590: 6f64 2e76 6673 2c0a 2020 2020 2020 2020  od.vfs,.        
+0000b5a0: 7265 7175 6972 656d 656e 7473 2c0a 2020  requirements,.  
+0000b5b0: 2020 2020 2020 7375 7070 6f72 7465 6472        supportedr
+0000b5c0: 6571 7569 7265 6d65 6e74 732c 0a20 2020  equirements,.   
+0000b5d0: 2020 2020 2073 6861 7265 6470 6174 683a       sharedpath:
+0000b5e0: 2062 7974 6573 2c0a 2020 2020 2020 2020   bytes,.        
+0000b5f0: 7374 6f72 652c 0a20 2020 2020 2020 2063  store,.        c
+0000b600: 6163 6865 7666 733a 2076 6673 6d6f 642e  achevfs: vfsmod.
+0000b610: 7666 732c 0a20 2020 2020 2020 2077 6361  vfs,.        wca
+0000b620: 6368 6576 6673 3a20 7666 736d 6f64 2e76  chevfs: vfsmod.v
+0000b630: 6673 2c0a 2020 2020 2020 2020 6665 6174  fs,.        feat
+0000b640: 7572 6573 2c0a 2020 2020 2020 2020 696e  ures,.        in
+0000b650: 7465 6e74 733d 4e6f 6e65 2c0a 2020 2020  tents=None,.    
+0000b660: 293a 0a20 2020 2020 2020 2022 2222 4372  ):.        """Cr
+0000b670: 6561 7465 2061 206e 6577 206c 6f63 616c  eate a new local
+0000b680: 2072 6570 6f73 6974 6f72 7920 696e 7374   repository inst
+0000b690: 616e 6365 2e0a 0a20 2020 2020 2020 204d  ance...        M
+0000b6a0: 6f73 7420 6361 6c6c 6572 7320 7368 6f75  ost callers shou
+0000b6b0: 6c64 2075 7365 2060 6068 672e 7265 706f  ld use ``hg.repo
+0000b6c0: 7369 746f 7279 2829 6060 2c20 6060 6c6f  sitory()``, ``lo
+0000b6d0: 6361 6c72 6570 6f2e 696e 7374 616e 6365  calrepo.instance
+0000b6e0: 2829 6060 2c0a 2020 2020 2020 2020 6f72  ()``,.        or
+0000b6f0: 2060 606c 6f63 616c 7265 706f 2e6d 616b   ``localrepo.mak
+0000b700: 656c 6f63 616c 7265 706f 7369 746f 7279  elocalrepository
+0000b710: 2829 6060 2066 6f72 206f 6274 6169 6e69  ()`` for obtaini
+0000b720: 6e67 2061 206e 6577 2072 6570 6f73 6974  ng a new reposit
+0000b730: 6f72 790a 2020 2020 2020 2020 6f62 6a65  ory.        obje
+0000b740: 6374 2e0a 0a20 2020 2020 2020 2041 7267  ct...        Arg
+0000b750: 756d 656e 7473 3a0a 0a20 2020 2020 2020  uments:..       
+0000b760: 2062 6173 6575 690a 2020 2020 2020 2020   baseui.        
+0000b770: 2020 2060 6075 692e 7569 6060 2069 6e73     ``ui.ui`` ins
+0000b780: 7461 6e63 6520 7468 6174 2060 6075 6960  tance that ``ui`
+0000b790: 6020 6172 6775 6d65 6e74 2077 6173 2062  ` argument was b
+0000b7a0: 6173 6564 206f 6666 206f 662e 0a0a 2020  ased off of...  
+0000b7b0: 2020 2020 2020 7569 0a20 2020 2020 2020        ui.       
+0000b7c0: 2020 2020 6060 7569 2e75 6960 6020 696e      ``ui.ui`` in
+0000b7d0: 7374 616e 6365 2066 6f72 2075 7365 2062  stance for use b
+0000b7e0: 7920 7468 6520 7265 706f 7369 746f 7279  y the repository
+0000b7f0: 2e0a 0a20 2020 2020 2020 206f 7269 6772  ...        origr
+0000b800: 6f6f 740a 2020 2020 2020 2020 2020 2060  oot.           `
+0000b810: 6062 7974 6573 6060 2070 6174 6820 746f  `bytes`` path to
+0000b820: 2077 6f72 6b69 6e67 2064 6972 6563 746f   working directo
+0000b830: 7279 2072 6f6f 7420 6f66 2074 6869 7320  ry root of this 
+0000b840: 7265 706f 7369 746f 7279 2e0a 0a20 2020  repository...   
+0000b850: 2020 2020 2077 6469 7276 6673 0a20 2020       wdirvfs.   
+0000b860: 2020 2020 2020 2020 6060 7666 732e 7666          ``vfs.vf
+0000b870: 7360 6020 726f 6f74 6564 2061 7420 7468  s`` rooted at th
+0000b880: 6520 776f 726b 696e 6720 6469 7265 6374  e working direct
+0000b890: 6f72 792e 0a0a 2020 2020 2020 2020 6867  ory...        hg
+0000b8a0: 7666 730a 2020 2020 2020 2020 2020 2060  vfs.           `
+0000b8b0: 6076 6673 2e76 6673 6060 2072 6f6f 7465  `vfs.vfs`` roote
+0000b8c0: 6420 6174 202e 6867 2f0a 0a20 2020 2020  d at .hg/..     
+0000b8d0: 2020 2072 6571 7569 7265 6d65 6e74 730a     requirements.
+0000b8e0: 2020 2020 2020 2020 2020 2060 6073 6574             ``set
+0000b8f0: 6060 206f 6620 6279 7465 7374 7269 6e67  `` of bytestring
+0000b900: 7320 7265 7072 6573 656e 7469 6e67 2072  s representing r
+0000b910: 6570 6f73 6974 6f72 7920 6f70 656e 696e  epository openin
+0000b920: 6720 7265 7175 6972 656d 656e 7473 2e0a  g requirements..
+0000b930: 0a20 2020 2020 2020 2073 7570 706f 7274  .        support
+0000b940: 6564 7265 7175 6972 656d 656e 7473 0a20  edrequirements. 
+0000b950: 2020 2020 2020 2020 2020 6060 7365 7460            ``set`
+0000b960: 6020 6f66 2062 7974 6573 7472 696e 6773  ` of bytestrings
+0000b970: 2072 6570 7265 7365 6e74 696e 6720 7265   representing re
+0000b980: 706f 7369 746f 7279 2072 6571 7569 7265  pository require
+0000b990: 6d65 6e74 7320 7468 6174 2077 650a 2020  ments that we.  
+0000b9a0: 2020 2020 2020 2020 206b 6e6f 7720 686f           know ho
+0000b9b0: 7720 746f 206f 7065 6e2e 204d 6179 2062  w to open. May b
+0000b9c0: 6520 6120 7375 7065 7473 6574 206f 6620  e a supetset of 
+0000b9d0: 6060 7265 7175 6972 656d 656e 7473 6060  ``requirements``
+0000b9e0: 2e0a 0a20 2020 2020 2020 2073 6861 7265  ...        share
+0000b9f0: 6470 6174 680a 2020 2020 2020 2020 2020  dpath.          
+0000ba00: 2060 6062 7974 6573 6060 2044 6566 696e   ``bytes`` Defin
+0000ba10: 696e 6720 7061 7468 2074 6f20 7374 6f72  ing path to stor
+0000ba20: 6167 6520 6261 7365 2064 6972 6563 746f  age base directo
+0000ba30: 7279 2e20 506f 696e 7473 2074 6f20 610a  ry. Points to a.
+0000ba40: 2020 2020 2020 2020 2020 2060 602e 6867             ``.hg
+0000ba50: 2f60 6020 6469 7265 6374 6f72 7920 736f  /`` directory so
+0000ba60: 6d65 7768 6572 652e 0a0a 2020 2020 2020  mewhere...      
+0000ba70: 2020 7374 6f72 650a 2020 2020 2020 2020    store.        
+0000ba80: 2020 2060 6073 746f 7265 2e62 6173 6963     ``store.basic
+0000ba90: 7374 6f72 6560 6020 286f 7220 6465 7269  store`` (or deri
+0000baa0: 7665 6429 2069 6e73 7461 6e63 6520 7072  ved) instance pr
+0000bab0: 6f76 6964 696e 6720 6163 6365 7373 2074  oviding access t
+0000bac0: 6f0a 2020 2020 2020 2020 2020 2076 6572  o.           ver
+0000bad0: 7369 6f6e 6564 2073 746f 7261 6765 2e0a  sioned storage..
+0000bae0: 0a20 2020 2020 2020 2063 6163 6865 7666  .        cachevf
+0000baf0: 730a 2020 2020 2020 2020 2020 2060 6076  s.           ``v
+0000bb00: 6673 2e76 6673 6060 2075 7365 6420 666f  fs.vfs`` used fo
+0000bb10: 7220 6361 6368 6520 6669 6c65 732e 0a0a  r cache files...
+0000bb20: 2020 2020 2020 2020 7763 6163 6865 7666          wcachevf
+0000bb30: 730a 2020 2020 2020 2020 2020 2060 6076  s.           ``v
+0000bb40: 6673 2e76 6673 6060 2075 7365 6420 666f  fs.vfs`` used fo
+0000bb50: 7220 6361 6368 6520 6669 6c65 7320 7265  r cache files re
+0000bb60: 6c61 7465 6420 746f 2074 6865 2077 6f72  lated to the wor
+0000bb70: 6b69 6e67 2063 6f70 792e 0a0a 2020 2020  king copy...    
+0000bb80: 2020 2020 6665 6174 7572 6573 0a20 2020      features.   
+0000bb90: 2020 2020 2020 2020 6060 7365 7460 6020          ``set`` 
+0000bba0: 6f66 2062 7974 6573 7472 696e 6773 2064  of bytestrings d
+0000bbb0: 6566 696e 696e 6720 6665 6174 7572 6573  efining features
+0000bbc0: 2f63 6170 6162 696c 6974 6965 7320 6f66  /capabilities of
+0000bbd0: 2074 6869 730a 2020 2020 2020 2020 2020   this.          
+0000bbe0: 2069 6e73 7461 6e63 652e 0a0a 2020 2020   instance...    
+0000bbf0: 2020 2020 696e 7465 6e74 730a 2020 2020      intents.    
+0000bc00: 2020 2020 2020 2060 6073 6574 6060 206f         ``set`` o
+0000bc10: 6620 7379 7374 656d 2073 7472 696e 6773  f system strings
+0000bc20: 2069 6e64 6963 6174 696e 6720 7768 6174   indicating what
+0000bc30: 2074 6869 7320 7265 706f 2077 696c 6c20   this repo will 
+0000bc40: 6265 2075 7365 640a 2020 2020 2020 2020  be used.        
+0000bc50: 2020 2066 6f72 2e0a 2020 2020 2020 2020     for..        
+0000bc60: 2222 220a 2020 2020 2020 2020 7365 6c66  """.        self
+0000bc70: 2e62 6173 6575 6920 3d20 6261 7365 7569  .baseui = baseui
+0000bc80: 0a20 2020 2020 2020 2073 656c 662e 7569  .        self.ui
+0000bc90: 203d 2075 690a 2020 2020 2020 2020 7365   = ui.        se
+0000bca0: 6c66 2e6f 7269 6772 6f6f 7420 3d20 6f72  lf.origroot = or
+0000bcb0: 6967 726f 6f74 0a20 2020 2020 2020 2023  igroot.        #
+0000bcc0: 2076 6673 2072 6f6f 7465 6420 6174 2077   vfs rooted at w
+0000bcd0: 6f72 6b69 6e67 2064 6972 6563 746f 7279  orking directory
+0000bce0: 2e0a 2020 2020 2020 2020 7365 6c66 2e77  ..        self.w
+0000bcf0: 7666 7320 3d20 7764 6972 7666 730a 2020  vfs = wdirvfs.  
+0000bd00: 2020 2020 2020 7365 6c66 2e72 6f6f 7420        self.root 
+0000bd10: 3d20 7764 6972 7666 732e 6261 7365 0a20  = wdirvfs.base. 
+0000bd20: 2020 2020 2020 2023 2076 6673 2072 6f6f         # vfs roo
+0000bd30: 7465 6420 6174 202e 6867 2f2e 2055 7365  ted at .hg/. Use
+0000bd40: 6420 746f 2061 6363 6573 7320 6d6f 7374  d to access most
+0000bd50: 206e 6f6e 2d73 746f 7265 2070 6174 6873   non-store paths
+0000bd60: 2e0a 2020 2020 2020 2020 7365 6c66 2e76  ..        self.v
+0000bd70: 6673 203d 2068 6776 6673 0a20 2020 2020  fs = hgvfs.     
+0000bd80: 2020 2073 656c 662e 7061 7468 203d 2068     self.path = h
+0000bd90: 6776 6673 2e62 6173 650a 2020 2020 2020  gvfs.base.      
+0000bda0: 2020 7365 6c66 2e72 6571 7569 7265 6d65    self.requireme
+0000bdb0: 6e74 7320 3d20 7265 7175 6972 656d 656e  nts = requiremen
+0000bdc0: 7473 0a20 2020 2020 2020 2073 656c 662e  ts.        self.
+0000bdd0: 6e6f 6465 636f 6e73 7461 6e74 7320 3d20  nodeconstants = 
+0000bde0: 7368 6131 6e6f 6465 636f 6e73 7461 6e74  sha1nodeconstant
+0000bdf0: 730a 2020 2020 2020 2020 7365 6c66 2e6e  s.        self.n
+0000be00: 756c 6c69 6420 3d20 7365 6c66 2e6e 6f64  ullid = self.nod
+0000be10: 6563 6f6e 7374 616e 7473 2e6e 756c 6c69  econstants.nulli
+0000be20: 640a 2020 2020 2020 2020 7365 6c66 2e73  d.        self.s
+0000be30: 7570 706f 7274 6564 203d 2073 7570 706f  upported = suppo
+0000be40: 7274 6564 7265 7175 6972 656d 656e 7473  rtedrequirements
+0000be50: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
+0000be60: 6172 6564 7061 7468 203d 2073 6861 7265  aredpath = share
+0000be70: 6470 6174 680a 2020 2020 2020 2020 7365  dpath.        se
+0000be80: 6c66 2e73 746f 7265 203d 2073 746f 7265  lf.store = store
+0000be90: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
+0000bea0: 6368 6576 6673 203d 2063 6163 6865 7666  chevfs = cachevf
+0000beb0: 730a 2020 2020 2020 2020 7365 6c66 2e77  s.        self.w
+0000bec0: 6361 6368 6576 6673 203d 2077 6361 6368  cachevfs = wcach
+0000bed0: 6576 6673 0a20 2020 2020 2020 2073 656c  evfs.        sel
+0000bee0: 662e 6665 6174 7572 6573 203d 2066 6561  f.features = fea
+0000bef0: 7475 7265 730a 0a20 2020 2020 2020 2073  tures..        s
+0000bf00: 656c 662e 6669 6c74 6572 6e61 6d65 203d  elf.filtername =
+0000bf10: 204e 6f6e 650a 0a20 2020 2020 2020 2069   None..        i
+0000bf20: 6620 7365 6c66 2e75 692e 636f 6e66 6967  f self.ui.config
+0000bf30: 626f 6f6c 2862 2764 6576 656c 272c 2062  bool(b'devel', b
+0000bf40: 2761 6c6c 2d77 6172 6e69 6e67 7327 2920  'all-warnings') 
+0000bf50: 6f72 2073 656c 662e 7569 2e63 6f6e 6669  or self.ui.confi
+0000bf60: 6762 6f6f 6c28 0a20 2020 2020 2020 2020  gbool(.         
+0000bf70: 2020 2062 2764 6576 656c 272c 2062 2763     b'devel', b'c
+0000bf80: 6865 636b 2d6c 6f63 6b73 270a 2020 2020  heck-locks'.    
+0000bf90: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+0000bfa0: 2020 2073 656c 662e 7666 732e 6175 6469     self.vfs.audi
+0000bfb0: 7420 3d20 7365 6c66 2e5f 6765 7476 6673  t = self._getvfs
+0000bfc0: 7761 7264 2873 656c 662e 7666 732e 6175  ward(self.vfs.au
+0000bfd0: 6469 7429 0a20 2020 2020 2020 2023 2041  dit).        # A
+0000bfe0: 206c 6973 7420 6f66 2063 616c 6c62 6163   list of callbac
+0000bff0: 6b20 746f 2073 6861 7065 2074 6865 2070  k to shape the p
+0000c000: 6861 7365 2069 6620 6e6f 2064 6174 6120  hase if no data 
+0000c010: 7765 7265 2066 6f75 6e64 2e0a 2020 2020  were found..    
+0000c020: 2020 2020 2320 4361 6c6c 6261 636b 2061      # Callback a
+0000c030: 7265 2069 6e20 7468 6520 666f 726d 3a20  re in the form: 
+0000c040: 6675 6e63 2872 6570 6f2c 2072 6f6f 7473  func(repo, roots
+0000c050: 2920 2d2d 3e20 7072 6f63 6573 7365 6420  ) --> processed 
+0000c060: 726f 6f74 2e0a 2020 2020 2020 2020 2320  root..        # 
+0000c070: 5468 6973 206c 6973 7420 6974 2074 6f20  This list it to 
+0000c080: 6265 2066 696c 6c65 6420 6279 2065 7874  be filled by ext
+0000c090: 656e 7369 6f6e 2064 7572 696e 6720 7265  ension during re
+0000c0a0: 706f 2073 6574 7570 0a20 2020 2020 2020  po setup.       
+0000c0b0: 2073 656c 662e 5f70 6861 7365 6465 6661   self._phasedefa
+0000c0c0: 756c 7473 203d 205b 5d0a 0a20 2020 2020  ults = []..     
+0000c0d0: 2020 2063 6f6c 6f72 2e73 6574 7570 2873     color.setup(s
+0000c0e0: 656c 662e 7569 290a 0a20 2020 2020 2020  elf.ui)..       
+0000c0f0: 2073 656c 662e 7370 6174 6820 3d20 7365   self.spath = se
+0000c100: 6c66 2e73 746f 7265 2e70 6174 680a 2020  lf.store.path.  
+0000c110: 2020 2020 2020 7365 6c66 2e73 7666 7320        self.svfs 
+0000c120: 3d20 7365 6c66 2e73 746f 7265 2e76 6673  = self.store.vfs
+0000c130: 0a20 2020 2020 2020 2073 656c 662e 736a  .        self.sj
+0000c140: 6f69 6e20 3d20 7365 6c66 2e73 746f 7265  oin = self.store
+0000c150: 2e6a 6f69 6e0a 2020 2020 2020 2020 6966  .join.        if
+0000c160: 2073 656c 662e 7569 2e63 6f6e 6669 6762   self.ui.configb
+0000c170: 6f6f 6c28 6227 6465 7665 6c27 2c20 6227  ool(b'devel', b'
+0000c180: 616c 6c2d 7761 726e 696e 6773 2729 206f  all-warnings') o
+0000c190: 7220 7365 6c66 2e75 692e 636f 6e66 6967  r self.ui.config
+0000c1a0: 626f 6f6c 280a 2020 2020 2020 2020 2020  bool(.          
+0000c1b0: 2020 6227 6465 7665 6c27 2c20 6227 6368    b'devel', b'ch
+0000c1c0: 6563 6b2d 6c6f 636b 7327 0a20 2020 2020  eck-locks'.     
+0000c1d0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+0000c1e0: 2020 6966 2075 7469 6c2e 7361 6665 6861    if util.safeha
+0000c1f0: 7361 7474 7228 7365 6c66 2e73 7666 732c  sattr(self.svfs,
+0000c200: 2027 7666 7327 293a 2020 2320 7468 6973   'vfs'):  # this
+0000c210: 2069 7320 6669 6c74 6572 7666 730a 2020   is filtervfs.  
+0000c220: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000c230: 6c66 2e73 7666 732e 7666 732e 6175 6469  lf.svfs.vfs.audi
+0000c240: 7420 3d20 7365 6c66 2e5f 6765 7473 7666  t = self._getsvf
+0000c250: 7377 6172 6428 7365 6c66 2e73 7666 732e  sward(self.svfs.
+0000c260: 7666 732e 6175 6469 7429 0a20 2020 2020  vfs.audit).     
+0000c270: 2020 2020 2020 2065 6c73 653a 2020 2320         else:  # 
+0000c280: 7374 616e 6461 7264 2076 6673 0a20 2020  standard vfs.   
+0000c290: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000c2a0: 662e 7376 6673 2e61 7564 6974 203d 2073  f.svfs.audit = s
+0000c2b0: 656c 662e 5f67 6574 7376 6673 7761 7264  elf._getsvfsward
+0000c2c0: 2873 656c 662e 7376 6673 2e61 7564 6974  (self.svfs.audit
+0000c2d0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000c2e0: 5f64 6972 7374 6174 6576 616c 6964 6174  _dirstatevalidat
+0000c2f0: 6577 6172 6e65 6420 3d20 4661 6c73 650a  ewarned = False.
+0000c300: 0a20 2020 2020 2020 2073 656c 662e 5f62  .        self._b
+0000c310: 7261 6e63 6863 6163 6865 7320 3d20 6272  ranchcaches = br
+0000c320: 616e 6368 6d61 702e 4272 616e 6368 4d61  anchmap.BranchMa
+0000c330: 7043 6163 6865 2829 0a20 2020 2020 2020  pCache().       
+0000c340: 2073 656c 662e 5f72 6576 6272 616e 6368   self._revbranch
+0000c350: 6361 6368 6520 3d20 4e6f 6e65 0a20 2020  cache = None.   
+0000c360: 2020 2020 2073 656c 662e 5f66 696c 7465       self._filte
+0000c370: 7270 6174 7320 3d20 7b7d 0a20 2020 2020  rpats = {}.     
+0000c380: 2020 2073 656c 662e 5f64 6174 6166 696c     self._datafil
+0000c390: 7465 7273 203d 207b 7d0a 2020 2020 2020  ters = {}.      
+0000c3a0: 2020 7365 6c66 2e5f 7472 616e 7372 6566    self._transref
+0000c3b0: 203d 2073 656c 662e 5f6c 6f63 6b72 6566   = self._lockref
+0000c3c0: 203d 2073 656c 662e 5f77 6c6f 636b 7265   = self._wlockre
+0000c3d0: 6620 3d20 4e6f 6e65 0a0a 2020 2020 2020  f = None..      
+0000c3e0: 2020 2320 4120 6361 6368 6520 666f 7220    # A cache for 
+0000c3f0: 7661 7269 6f75 7320 6669 6c65 7320 756e  various files un
+0000c400: 6465 7220 2e68 672f 2074 6861 7420 7472  der .hg/ that tr
+0000c410: 6163 6b73 2066 696c 6520 6368 616e 6765  acks file change
+0000c420: 732c 0a20 2020 2020 2020 2023 2028 7573  s,.        # (us
+0000c430: 6564 2062 7920 7468 6520 6669 6c65 6361  ed by the fileca
+0000c440: 6368 6520 6465 636f 7261 746f 7229 0a20  che decorator). 
+0000c450: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
+0000c460: 2023 204d 6170 7320 6120 7072 6f70 6572   # Maps a proper
+0000c470: 7479 206e 616d 6520 746f 2069 7473 2075  ty name to its u
+0000c480: 7469 6c2e 6669 6c65 6361 6368 6565 6e74  til.filecacheent
+0000c490: 7279 0a20 2020 2020 2020 2073 656c 662e  ry.        self.
+0000c4a0: 5f66 696c 6563 6163 6865 203d 207b 7d0a  _filecache = {}.
+0000c4b0: 0a20 2020 2020 2020 2023 2068 6f6c 6420  .        # hold 
+0000c4c0: 7365 7473 206f 6620 7265 7669 7369 6f6e  sets of revision
+0000c4d0: 2074 6f20 6265 2066 696c 7465 7265 640a   to be filtered.
+0000c4e0: 2020 2020 2020 2020 2320 7368 6f75 6c64          # should
+0000c4f0: 2062 6520 636c 6561 7265 6420 7768 656e   be cleared when
+0000c500: 2073 6f6d 6574 6869 6e67 206d 6967 6874   something might
+0000c510: 2068 6176 6520 6368 616e 6765 6420 7468   have changed th
+0000c520: 6520 6669 6c74 6572 2076 616c 7565 3a0a  e filter value:.
+0000c530: 2020 2020 2020 2020 2320 2d20 6e65 7720          # - new 
+0000c540: 6368 616e 6765 7365 7473 2c0a 2020 2020  changesets,.    
+0000c550: 2020 2020 2320 2d20 7068 6173 6520 6368      # - phase ch
+0000c560: 616e 6765 2c0a 2020 2020 2020 2020 2320  ange,.        # 
+0000c570: 2d20 6e65 7720 6f62 736f 6c65 7363 656e  - new obsolescen
+0000c580: 6365 206d 6172 6b65 722c 0a20 2020 2020  ce marker,.     
+0000c590: 2020 2023 202d 2077 6f72 6b69 6e67 2064     # - working d
+0000c5a0: 6972 6563 746f 7279 2070 6172 656e 7420  irectory parent 
+0000c5b0: 6368 616e 6765 2c0a 2020 2020 2020 2020  change,.        
+0000c5c0: 2320 2d20 626f 6f6b 6d61 726b 2063 6861  # - bookmark cha
+0000c5d0: 6e67 6573 0a20 2020 2020 2020 2073 656c  nges.        sel
+0000c5e0: 662e 6669 6c74 6572 6564 7265 7663 6163  f.filteredrevcac
+0000c5f0: 6865 203d 207b 7d0a 0a20 2020 2020 2020  he = {}..       
+0000c600: 2073 656c 662e 5f64 6972 7374 6174 6520   self._dirstate 
+0000c610: 3d20 4e6f 6e65 0a20 2020 2020 2020 2023  = None.        #
+0000c620: 2070 6f73 742d 6469 7273 7461 7465 2d73   post-dirstate-s
+0000c630: 7461 7475 7320 686f 6f6b 730a 2020 2020  tatus hooks.    
+0000c640: 2020 2020 7365 6c66 2e5f 706f 7374 6473      self._postds
+0000c650: 7374 6174 7573 203d 205b 5d0a 0a20 2020  status = []..   
+0000c660: 2020 2020 2073 656c 662e 5f70 656e 6469       self._pendi
+0000c670: 6e67 5f6e 6172 726f 775f 7061 7473 203d  ng_narrow_pats =
+0000c680: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
+0000c690: 6c66 2e5f 7065 6e64 696e 675f 6e61 7272  lf._pending_narr
+0000c6a0: 6f77 5f70 6174 735f 6469 7273 7461 7465  ow_pats_dirstate
+0000c6b0: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
+0000c6c0: 2023 2067 656e 6572 6963 206d 6170 7069   # generic mappi
+0000c6d0: 6e67 2062 6574 7765 656e 206e 616d 6573  ng between names
+0000c6e0: 2061 6e64 206e 6f64 6573 0a20 2020 2020   and nodes.     
+0000c6f0: 2020 2073 656c 662e 6e61 6d65 7320 3d20     self.names = 
+0000c700: 6e61 6d65 7370 6163 6573 2e6e 616d 6573  namespaces.names
+0000c710: 7061 6365 7328 290a 0a20 2020 2020 2020  paces()..       
+0000c720: 2023 204b 6579 2074 6f20 7369 676e 6174   # Key to signat
+0000c730: 7572 6520 7661 6c75 652e 0a20 2020 2020  ure value..     
+0000c740: 2020 2073 656c 662e 5f73 7061 7273 6573     self._sparses
+0000c750: 6967 6e61 7475 7265 6361 6368 6520 3d20  ignaturecache = 
+0000c760: 7b7d 0a20 2020 2020 2020 2023 2053 6967  {}.        # Sig
+0000c770: 6e61 7475 7265 2074 6f20 6361 6368 6564  nature to cached
+0000c780: 206d 6174 6368 6572 2069 6e73 7461 6e63   matcher instanc
+0000c790: 652e 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+0000c7a0: 5f73 7061 7273 656d 6174 6368 6572 6361  _sparsematcherca
+0000c7b0: 6368 6520 3d20 7b7d 0a0a 2020 2020 2020  che = {}..      
+0000c7c0: 2020 7365 6c66 2e5f 6578 7472 6166 696c    self._extrafil
+0000c7d0: 7465 7269 6420 3d20 7265 706f 7669 6577  terid = repoview
+0000c7e0: 2e65 7874 7261 6669 6c74 6572 2875 6929  .extrafilter(ui)
+0000c7f0: 0a0a 2020 2020 2020 2020 7365 6c66 2e66  ..        self.f
+0000c800: 696c 6563 6f70 6965 736d 6f64 6520 3d20  ilecopiesmode = 
+0000c810: 4e6f 6e65 0a20 2020 2020 2020 2069 6620  None.        if 
+0000c820: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
+0000c830: 434f 5049 4553 5344 435f 5245 5155 4952  COPIESSDC_REQUIR
+0000c840: 454d 454e 5420 696e 2073 656c 662e 7265  EMENT in self.re
+0000c850: 7175 6972 656d 656e 7473 3a0a 2020 2020  quirements:.    
+0000c860: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
+0000c870: 6563 6f70 6965 736d 6f64 6520 3d20 6227  ecopiesmode = b'
+0000c880: 6368 616e 6765 7365 742d 7369 6465 6461  changeset-sideda
+0000c890: 7461 270a 0a20 2020 2020 2020 2073 656c  ta'..        sel
+0000c8a0: 662e 5f77 616e 7465 645f 7369 6465 6461  f._wanted_sideda
+0000c8b0: 7461 203d 2073 6574 2829 0a20 2020 2020  ta = set().     
+0000c8c0: 2020 2073 656c 662e 5f73 6964 6564 6174     self._sidedat
+0000c8d0: 615f 636f 6d70 7574 6572 7320 3d20 7b7d  a_computers = {}
+0000c8e0: 0a20 2020 2020 2020 2073 6964 6564 6174  .        sidedat
+0000c8f0: 616d 6f64 2e73 6574 5f73 6964 6564 6174  amod.set_sidedat
+0000c900: 615f 7370 6563 5f66 6f72 5f72 6570 6f28  a_spec_for_repo(
+0000c910: 7365 6c66 290a 0a20 2020 2064 6566 205f  self)..    def _
+0000c920: 6765 7476 6673 7761 7264 2873 656c 662c  getvfsward(self,
+0000c930: 206f 7269 6766 756e 6329 3a0a 2020 2020   origfunc):.    
+0000c940: 2020 2020 2222 2262 7569 6c64 2061 2077      """build a w
+0000c950: 6172 6420 666f 7220 7365 6c66 2e76 6673  ard for self.vfs
+0000c960: 2222 220a 2020 2020 2020 2020 7272 6566  """.        rref
+0000c970: 203d 2077 6561 6b72 6566 2e72 6566 2873   = weakref.ref(s
+0000c980: 656c 6629 0a0a 2020 2020 2020 2020 6465  elf)..        de
+0000c990: 6620 6368 6563 6b76 6673 2870 6174 682c  f checkvfs(path,
+0000c9a0: 206d 6f64 653d 4e6f 6e65 293a 0a20 2020   mode=None):.   
+0000c9b0: 2020 2020 2020 2020 2072 6574 203d 206f           ret = o
+0000c9c0: 7269 6766 756e 6328 7061 7468 2c20 6d6f  rigfunc(path, mo
+0000c9d0: 6465 3d6d 6f64 6529 0a20 2020 2020 2020  de=mode).       
+0000c9e0: 2020 2020 2072 6570 6f20 3d20 7272 6566       repo = rref
+0000c9f0: 2829 0a20 2020 2020 2020 2020 2020 2069  ().            i
+0000ca00: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+0000ca10: 2020 2020 7265 706f 2069 7320 4e6f 6e65      repo is None
+0000ca20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ca30: 206f 7220 6e6f 7420 7574 696c 2e73 6166   or not util.saf
+0000ca40: 6568 6173 6174 7472 2872 6570 6f2c 2027  ehasattr(repo, '
+0000ca50: 5f77 6c6f 636b 7265 6627 290a 2020 2020  _wlockref').    
+0000ca60: 2020 2020 2020 2020 2020 2020 6f72 206e              or n
+0000ca70: 6f74 2075 7469 6c2e 7361 6665 6861 7361  ot util.safehasa
+0000ca80: 7474 7228 7265 706f 2c20 275f 6c6f 636b  ttr(repo, '_lock
+0000ca90: 7265 6627 290a 2020 2020 2020 2020 2020  ref').          
+0000caa0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0000cab0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+0000cac0: 2020 2020 2020 2020 6966 206d 6f64 6520          if mode 
+0000cad0: 696e 2028 4e6f 6e65 2c20 6227 7227 2c20  in (None, b'r', 
+0000cae0: 6227 7262 2729 3a0a 2020 2020 2020 2020  b'rb'):.        
+0000caf0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+0000cb00: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
+0000cb10: 7468 2e73 7461 7274 7377 6974 6828 7265  th.startswith(re
+0000cb20: 706f 2e70 6174 6829 3a0a 2020 2020 2020  po.path):.      
+0000cb30: 2020 2020 2020 2020 2020 2320 7472 756e            # trun
+0000cb40: 6361 7465 206e 616d 6520 7265 6c61 7469  cate name relati
+0000cb50: 7665 2074 6f20 7468 6520 7265 706f 7369  ve to the reposi
+0000cb60: 746f 7279 2028 2e68 6729 0a20 2020 2020  tory (.hg).     
+0000cb70: 2020 2020 2020 2020 2020 2070 6174 6820             path 
+0000cb80: 3d20 7061 7468 5b6c 656e 2872 6570 6f2e  = path[len(repo.
+0000cb90: 7061 7468 2920 2b20 3120 3a5d 0a20 2020  path) + 1 :].   
+0000cba0: 2020 2020 2020 2020 2069 6620 7061 7468           if path
+0000cbb0: 2e73 7461 7274 7377 6974 6828 6227 6361  .startswith(b'ca
+0000cbc0: 6368 652f 2729 3a0a 2020 2020 2020 2020  che/'):.        
+0000cbd0: 2020 2020 2020 2020 6d73 6720 3d20 6227          msg = b'
+0000cbe0: 6163 6365 7373 696e 6720 6361 6368 6520  accessing cache 
+0000cbf0: 7769 7468 2076 6673 2069 6e73 7465 6164  with vfs instead
+0000cc00: 206f 6620 6361 6368 6576 6673 3a20 2225   of cachevfs: "%
+0000cc10: 7322 270a 2020 2020 2020 2020 2020 2020  s"'.            
+0000cc20: 2020 2020 7265 706f 2e75 692e 6465 7665      repo.ui.deve
+0000cc30: 6c77 6172 6e28 6d73 6720 2520 7061 7468  lwarn(msg % path
+0000cc40: 2c20 7374 6163 6b6c 6576 656c 3d33 2c20  , stacklevel=3, 
+0000cc50: 636f 6e66 6967 3d62 2263 6163 6865 2d76  config=b"cache-v
+0000cc60: 6673 2229 0a20 2020 2020 2020 2020 2020  fs").           
+0000cc70: 2023 2070 6174 6820 7072 6566 6978 6573   # path prefixes
+0000cc80: 2063 6f76 6572 6564 2062 7920 276c 6f63   covered by 'loc
+0000cc90: 6b27 0a20 2020 2020 2020 2020 2020 2076  k'.            v
+0000cca0: 6673 5f70 6174 685f 7072 6566 6978 6573  fs_path_prefixes
+0000ccb0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+0000ccc0: 2020 2020 2062 276a 6f75 726e 616c 2e27       b'journal.'
+0000ccd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cce0: 2020 6227 756e 646f 2e27 2c0a 2020 2020    b'undo.',.    
+0000ccf0: 2020 2020 2020 2020 2020 2020 6227 7374              b'st
+0000cd00: 7269 702d 6261 636b 7570 2f27 2c0a 2020  rip-backup/',.  
+0000cd10: 2020 2020 2020 2020 2020 2020 2020 6227                b'
+0000cd20: 6361 6368 652f 272c 0a20 2020 2020 2020  cache/',.       
+0000cd30: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000cd40: 2020 2069 6620 616e 7928 7061 7468 2e73     if any(path.s
+0000cd50: 7461 7274 7377 6974 6828 7072 6566 6978  tartswith(prefix
+0000cd60: 2920 666f 7220 7072 6566 6978 2069 6e20  ) for prefix in 
+0000cd70: 7666 735f 7061 7468 5f70 7265 6669 7865  vfs_path_prefixe
+0000cd80: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0000cd90: 2020 2020 6966 2072 6570 6f2e 5f63 7572      if repo._cur
+0000cda0: 7265 6e74 6c6f 636b 2872 6570 6f2e 5f6c  rentlock(repo._l
+0000cdb0: 6f63 6b72 6566 2920 6973 204e 6f6e 653a  ockref) is None:
+0000cdc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cdd0: 2020 2020 2072 6570 6f2e 7569 2e64 6576       repo.ui.dev
+0000cde0: 656c 7761 726e 280a 2020 2020 2020 2020  elwarn(.        
+0000cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce00: 6227 7772 6974 6520 7769 7468 206e 6f20  b'write with no 
+0000ce10: 6c6f 636b 3a20 2225 7322 2720 2520 7061  lock: "%s"' % pa
+0000ce20: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+0000ce30: 2020 2020 2020 2020 2020 2020 7374 6163              stac
+0000ce40: 6b6c 6576 656c 3d33 2c0a 2020 2020 2020  klevel=3,.      
+0000ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce60: 2020 636f 6e66 6967 3d62 2763 6865 636b    config=b'check
+0000ce70: 2d6c 6f63 6b73 272c 0a20 2020 2020 2020  -locks',.       
+0000ce80: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000ce90: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0000cea0: 7265 706f 2e5f 6375 7272 656e 746c 6f63  repo._currentloc
+0000ceb0: 6b28 7265 706f 2e5f 776c 6f63 6b72 6566  k(repo._wlockref
+0000cec0: 2920 6973 204e 6f6e 653a 0a20 2020 2020  ) is None:.     
+0000ced0: 2020 2020 2020 2020 2020 2023 2072 6573             # res
+0000cee0: 7420 6f66 2076 6673 2066 696c 6573 2061  t of vfs files a
+0000cef0: 7265 2063 6f76 6572 6564 2062 7920 2777  re covered by 'w
+0000cf00: 6c6f 636b 270a 2020 2020 2020 2020 2020  lock'.          
+0000cf10: 2020 2020 2020 230a 2020 2020 2020 2020        #.        
+0000cf20: 2020 2020 2020 2020 2320 6578 636c 7564          # exclud
+0000cf30: 6520 7370 6563 6961 6c20 6669 6c65 730a  e special files.
+0000cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf50: 666f 7220 7072 6566 6978 2069 6e20 7365  for prefix in se
+0000cf60: 6c66 2e5f 776c 6f63 6b66 7265 6570 7265  lf._wlockfreepre
+0000cf70: 6669 783a 0a20 2020 2020 2020 2020 2020  fix:.           
+0000cf80: 2020 2020 2020 2020 2069 6620 7061 7468           if path
+0000cf90: 2e73 7461 7274 7377 6974 6828 7072 6566  .startswith(pref
+0000cfa0: 6978 293a 0a20 2020 2020 2020 2020 2020  ix):.           
+0000cfb0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000cfc0: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
+0000cfd0: 2020 2020 7265 706f 2e75 692e 6465 7665      repo.ui.deve
+0000cfe0: 6c77 6172 6e28 0a20 2020 2020 2020 2020  lwarn(.         
+0000cff0: 2020 2020 2020 2020 2020 2062 2777 7269             b'wri
+0000d000: 7465 2077 6974 6820 6e6f 2077 6c6f 636b  te with no wlock
+0000d010: 3a20 2225 7322 2720 2520 7061 7468 2c0a  : "%s"' % path,.
+0000d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d030: 2020 2020 7374 6163 6b6c 6576 656c 3d33      stacklevel=3
+0000d040: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d050: 2020 2020 2020 636f 6e66 6967 3d62 2763        config=b'c
+0000d060: 6865 636b 2d6c 6f63 6b73 272c 0a20 2020  heck-locks',.   
+0000d070: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000d080: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000d090: 6e20 7265 740a 0a20 2020 2020 2020 2072  n ret..        r
+0000d0a0: 6574 7572 6e20 6368 6563 6b76 6673 0a0a  eturn checkvfs..
+0000d0b0: 2020 2020 6465 6620 5f67 6574 7376 6673      def _getsvfs
+0000d0c0: 7761 7264 2873 656c 662c 206f 7269 6766  ward(self, origf
+0000d0d0: 756e 6329 3a0a 2020 2020 2020 2020 2222  unc):.        ""
+0000d0e0: 2262 7569 6c64 2061 2077 6172 6420 666f  "build a ward fo
+0000d0f0: 7220 7365 6c66 2e73 7666 7322 2222 0a20  r self.svfs""". 
+0000d100: 2020 2020 2020 2072 7265 6620 3d20 7765         rref = we
+0000d110: 616b 7265 662e 7265 6628 7365 6c66 290a  akref.ref(self).
+0000d120: 0a20 2020 2020 2020 2064 6566 2063 6865  .        def che
+0000d130: 636b 7376 6673 2870 6174 682c 206d 6f64  cksvfs(path, mod
+0000d140: 653d 4e6f 6e65 293a 0a20 2020 2020 2020  e=None):.       
+0000d150: 2020 2020 2072 6574 203d 206f 7269 6766       ret = origf
+0000d160: 756e 6328 7061 7468 2c20 6d6f 6465 3d6d  unc(path, mode=m
+0000d170: 6f64 6529 0a20 2020 2020 2020 2020 2020  ode).           
+0000d180: 2072 6570 6f20 3d20 7272 6566 2829 0a20   repo = rref(). 
+0000d190: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+0000d1a0: 706f 2069 7320 4e6f 6e65 206f 7220 6e6f  po is None or no
+0000d1b0: 7420 7574 696c 2e73 6166 6568 6173 6174  t util.safehasat
+0000d1c0: 7472 2872 6570 6f2c 2027 5f6c 6f63 6b72  tr(repo, '_lockr
+0000d1d0: 6566 2729 3a0a 2020 2020 2020 2020 2020  ef'):.          
+0000d1e0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0000d1f0: 2020 2020 2020 2020 2069 6620 6d6f 6465           if mode
+0000d200: 2069 6e20 284e 6f6e 652c 2062 2772 272c   in (None, b'r',
+0000d210: 2062 2772 6227 293a 0a20 2020 2020 2020   b'rb'):.       
+0000d220: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0000d230: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+0000d240: 6174 682e 7374 6172 7473 7769 7468 2872  ath.startswith(r
+0000d250: 6570 6f2e 7368 6172 6564 7061 7468 293a  epo.sharedpath):
+0000d260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d270: 2023 2074 7275 6e63 6174 6520 6e61 6d65   # truncate name
+0000d280: 2072 656c 6174 6976 6520 746f 2074 6865   relative to the
+0000d290: 2072 6570 6f73 6974 6f72 7920 282e 6867   repository (.hg
+0000d2a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d2b0: 2020 7061 7468 203d 2070 6174 685b 6c65    path = path[le
+0000d2c0: 6e28 7265 706f 2e73 6861 7265 6470 6174  n(repo.sharedpat
+0000d2d0: 6829 202b 2031 203a 5d0a 2020 2020 2020  h) + 1 :].      
+0000d2e0: 2020 2020 2020 6966 2072 6570 6f2e 5f63        if repo._c
+0000d2f0: 7572 7265 6e74 6c6f 636b 2872 6570 6f2e  urrentlock(repo.
+0000d300: 5f6c 6f63 6b72 6566 2920 6973 204e 6f6e  _lockref) is Non
+0000d310: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000d320: 2020 2072 6570 6f2e 7569 2e64 6576 656c     repo.ui.devel
+0000d330: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
+0000d340: 2020 2020 2020 2020 2020 6227 7772 6974            b'writ
+0000d350: 6520 7769 7468 206e 6f20 6c6f 636b 3a20  e with no lock: 
+0000d360: 2225 7322 2720 2520 7061 7468 2c20 7374  "%s"' % path, st
+0000d370: 6163 6b6c 6576 656c 3d34 0a20 2020 2020  acklevel=4.     
+0000d380: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000d390: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000d3a0: 7265 740a 0a20 2020 2020 2020 2072 6574  ret..        ret
+0000d3b0: 7572 6e20 6368 6563 6b73 7666 730a 0a20  urn checksvfs.. 
+0000d3c0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+0000d3d0: 2064 6566 2076 6673 5f6d 6170 2873 656c   def vfs_map(sel
+0000d3e0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+0000d3f0: 726e 207b 0a20 2020 2020 2020 2020 2020  rn {.           
+0000d400: 2062 2727 3a20 7365 6c66 2e73 7666 732c   b'': self.svfs,
+0000d410: 0a20 2020 2020 2020 2020 2020 2062 2770  .            b'p
+0000d420: 6c61 696e 273a 2073 656c 662e 7666 732c  lain': self.vfs,
+0000d430: 0a20 2020 2020 2020 2020 2020 2062 2773  .            b's
+0000d440: 746f 7265 273a 2073 656c 662e 7376 6673  tore': self.svfs
+0000d450: 2c0a 2020 2020 2020 2020 7d0a 0a20 2020  ,.        }..   
+0000d460: 2064 6566 2063 6c6f 7365 2873 656c 6629   def close(self)
+0000d470: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+0000d480: 7772 6974 6563 6163 6865 7328 290a 0a20  writecaches().. 
+0000d490: 2020 2064 6566 205f 7772 6974 6563 6163     def _writecac
+0000d4a0: 6865 7328 7365 6c66 293a 0a20 2020 2020  hes(self):.     
+0000d4b0: 2020 2069 6620 7365 6c66 2e5f 7265 7662     if self._revb
+0000d4c0: 7261 6e63 6863 6163 6865 3a0a 2020 2020  ranchcache:.    
+0000d4d0: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
+0000d4e0: 7662 7261 6e63 6863 6163 6865 2e77 7269  vbranchcache.wri
+0000d4f0: 7465 2829 0a0a 2020 2020 6465 6620 5f72  te()..    def _r
+0000d500: 6573 7472 6963 7463 6170 6162 696c 6974  estrictcapabilit
+0000d510: 6965 7328 7365 6c66 2c20 6361 7073 293a  ies(self, caps):
+0000d520: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0000d530: 2e75 692e 636f 6e66 6967 626f 6f6c 2862  .ui.configbool(b
+0000d540: 2765 7870 6572 696d 656e 7461 6c27 2c20  'experimental', 
+0000d550: 6227 6275 6e64 6c65 322d 6164 7665 7274  b'bundle2-advert
+0000d560: 6973 6527 293a 0a20 2020 2020 2020 2020  ise'):.         
+0000d570: 2020 2063 6170 7320 3d20 7365 7428 6361     caps = set(ca
+0000d580: 7073 290a 2020 2020 2020 2020 2020 2020  ps).            
+0000d590: 6361 7073 626c 6f62 203d 2062 756e 646c  capsblob = bundl
+0000d5a0: 6532 2e65 6e63 6f64 6563 6170 7328 0a20  e2.encodecaps(. 
+0000d5b0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000d5c0: 756e 646c 6532 2e67 6574 7265 706f 6361  undle2.getrepoca
+0000d5d0: 7073 2873 656c 662c 2072 6f6c 653d 6227  ps(self, role=b'
+0000d5e0: 636c 6965 6e74 2729 0a20 2020 2020 2020  client').       
+0000d5f0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000d600: 2020 2063 6170 732e 6164 6428 6227 6275     caps.add(b'bu
+0000d610: 6e64 6c65 323d 2720 2b20 7572 6c72 6571  ndle2=' + urlreq
+0000d620: 2e71 756f 7465 2863 6170 7362 6c6f 6229  .quote(capsblob)
+0000d630: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
+0000d640: 662e 7569 2e63 6f6e 6669 6762 6f6f 6c28  f.ui.configbool(
+0000d650: 6227 6578 7065 7269 6d65 6e74 616c 272c  b'experimental',
+0000d660: 2062 276e 6172 726f 7727 293a 0a20 2020   b'narrow'):.   
+0000d670: 2020 2020 2020 2020 2063 6170 732e 6164           caps.ad
+0000d680: 6428 7769 7265 7072 6f74 6f74 7970 6573  d(wireprototypes
+0000d690: 2e4e 4152 524f 5743 4150 290a 2020 2020  .NARROWCAP).    
+0000d6a0: 2020 2020 7265 7475 726e 2063 6170 730a      return caps.
+0000d6b0: 0a20 2020 2023 2044 6f6e 2774 2063 6163  .    # Don't cac
+0000d6c0: 6865 2061 7564 6974 6f72 2f6e 6f66 7361  he auditor/nofsa
+0000d6d0: 7564 6974 6f72 2c20 6f72 2079 6f75 276c  uditor, or you'l
+0000d6e0: 6c20 656e 6420 7570 2077 6974 6820 7265  l end up with re
+0000d6f0: 6665 7265 6e63 6520 6379 636c 653a 0a20  ference cycle:. 
+0000d700: 2020 2023 2073 656c 6620 2d3e 2061 7564     # self -> aud
+0000d710: 6974 6f72 202d 3e20 7365 6c66 2e5f 6368  itor -> self._ch
+0000d720: 6563 6b6e 6573 7465 6420 2d3e 2073 656c  ecknested -> sel
+0000d730: 660a 0a20 2020 2040 7072 6f70 6572 7479  f..    @property
+0000d740: 0a20 2020 2064 6566 2061 7564 6974 6f72  .    def auditor
+0000d750: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000d760: 2320 5468 6973 2069 7320 6f6e 6c79 2075  # This is only u
+0000d770: 7365 6420 6279 2063 6f6e 7465 7874 2e77  sed by context.w
+0000d780: 6f72 6b69 6e67 6374 782e 6d61 7463 6820  orkingctx.match 
+0000d790: 696e 206f 7264 6572 2074 6f0a 2020 2020  in order to.    
+0000d7a0: 2020 2020 2320 6465 7465 6374 2066 696c      # detect fil
+0000d7b0: 6573 2069 6e20 7375 6272 6570 6f73 2e0a  es in subrepos..
+0000d7c0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+0000d7d0: 6174 6875 7469 6c2e 7061 7468 6175 6469  athutil.pathaudi
+0000d7e0: 746f 7228 7365 6c66 2e72 6f6f 742c 2063  tor(self.root, c
+0000d7f0: 616c 6c62 6163 6b3d 7365 6c66 2e5f 6368  allback=self._ch
+0000d800: 6563 6b6e 6573 7465 6429 0a0a 2020 2020  ecknested)..    
+0000d810: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+0000d820: 6620 6e6f 6673 6175 6469 746f 7228 7365  f nofsauditor(se
+0000d830: 6c66 293a 0a20 2020 2020 2020 2023 2054  lf):.        # T
+0000d840: 6869 7320 6973 206f 6e6c 7920 7573 6564  his is only used
+0000d850: 2062 7920 636f 6e74 6578 742e 6261 7365   by context.base
+0000d860: 6374 782e 6d61 7463 6820 696e 206f 7264  ctx.match in ord
+0000d870: 6572 2074 6f20 6465 7465 6374 0a20 2020  er to detect.   
+0000d880: 2020 2020 2023 2066 696c 6573 2069 6e20       # files in 
+0000d890: 7375 6272 6570 6f73 2e0a 2020 2020 2020  subrepos..      
+0000d8a0: 2020 7265 7475 726e 2070 6174 6875 7469    return pathuti
+0000d8b0: 6c2e 7061 7468 6175 6469 746f 7228 0a20  l.pathauditor(. 
+0000d8c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000d8d0: 726f 6f74 2c20 6361 6c6c 6261 636b 3d73  root, callback=s
+0000d8e0: 656c 662e 5f63 6865 636b 6e65 7374 6564  elf._checknested
+0000d8f0: 2c20 7265 616c 6673 3d46 616c 7365 2c20  , realfs=False, 
+0000d900: 6361 6368 6564 3d54 7275 650a 2020 2020  cached=True.    
+0000d910: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
+0000d920: 6368 6563 6b6e 6573 7465 6428 7365 6c66  checknested(self
+0000d930: 2c20 7061 7468 293a 0a20 2020 2020 2020  , path):.       
+0000d940: 2022 2222 4465 7465 726d 696e 6520 6966   """Determine if
+0000d950: 2070 6174 6820 6973 2061 206c 6567 616c   path is a legal
+0000d960: 206e 6573 7465 6420 7265 706f 7369 746f   nested reposito
+0000d970: 7279 2e22 2222 0a20 2020 2020 2020 2069  ry.""".        i
+0000d980: 6620 6e6f 7420 7061 7468 2e73 7461 7274  f not path.start
+0000d990: 7377 6974 6828 7365 6c66 2e72 6f6f 7429  swith(self.root)
+0000d9a0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000d9b0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+0000d9c0: 2020 2073 7562 7061 7468 203d 2070 6174     subpath = pat
+0000d9d0: 685b 6c65 6e28 7365 6c66 2e72 6f6f 7429  h[len(self.root)
+0000d9e0: 202b 2031 203a 5d0a 2020 2020 2020 2020   + 1 :].        
+0000d9f0: 6e6f 726d 7375 6270 6174 6820 3d20 7574  normsubpath = ut
+0000da00: 696c 2e70 636f 6e76 6572 7428 7375 6270  il.pconvert(subp
+0000da10: 6174 6829 0a0a 2020 2020 2020 2020 2320  ath)..        # 
+0000da20: 5858 583a 2043 6865 636b 696e 6720 6167  XXX: Checking ag
+0000da30: 6169 6e73 7420 7468 6520 6375 7272 656e  ainst the curren
+0000da40: 7420 776f 726b 696e 6720 636f 7079 2069  t working copy i
+0000da50: 7320 7772 6f6e 6720 696e 0a20 2020 2020  s wrong in.     
+0000da60: 2020 2023 2074 6865 2073 656e 7365 2074     # the sense t
+0000da70: 6861 7420 6974 2063 616e 2072 656a 6563  hat it can rejec
+0000da80: 7420 7468 696e 6773 206c 696b 650a 2020  t things like.  
+0000da90: 2020 2020 2020 230a 2020 2020 2020 2020        #.        
+0000daa0: 2320 2020 2420 6867 2063 6174 202d 7220  #   $ hg cat -r 
+0000dab0: 3130 2073 7562 2f78 2e74 7874 0a20 2020  10 sub/x.txt.   
+0000dac0: 2020 2020 2023 0a20 2020 2020 2020 2023       #.        #
+0000dad0: 2069 6620 7375 622f 2069 7320 6e6f 206c   if sub/ is no l
+0000dae0: 6f6e 6765 7220 6120 7375 6272 6570 6f73  onger a subrepos
+0000daf0: 6974 6f72 7920 696e 2074 6865 2077 6f72  itory in the wor
+0000db00: 6b69 6e67 2063 6f70 790a 2020 2020 2020  king copy.      
+0000db10: 2020 2320 7061 7265 6e74 2072 6576 6973    # parent revis
+0000db20: 696f 6e2e 0a20 2020 2020 2020 2023 0a20  ion..        #. 
+0000db30: 2020 2020 2020 2023 2048 6f77 6576 6572         # However
+0000db40: 2c20 6974 2063 616e 206f 6620 636f 7572  , it can of cour
+0000db50: 7365 2061 6c73 6f20 616c 6c6f 7720 7468  se also allow th
+0000db60: 696e 6773 2074 6861 7420 776f 756c 6420  ings that would 
+0000db70: 6861 7665 0a20 2020 2020 2020 2023 2062  have.        # b
+0000db80: 6565 6e20 7265 6a65 6374 6564 2062 6566  een rejected bef
+0000db90: 6f72 652c 2073 7563 6820 6173 2074 6865  ore, such as the
+0000dba0: 2061 626f 7665 2063 6174 2063 6f6d 6d61   above cat comma
+0000dbb0: 6e64 2069 6620 7375 622f 0a20 2020 2020  nd if sub/.     
+0000dbc0: 2020 2023 2069 7320 6120 7375 6272 6570     # is a subrep
+0000dbd0: 6f73 6974 6f72 7920 6e6f 772c 2062 7574  ository now, but
+0000dbe0: 2077 6173 2061 206e 6f72 6d61 6c20 6469   was a normal di
+0000dbf0: 7265 6374 6f72 7920 6265 666f 7265 2e0a  rectory before..
+0000dc00: 2020 2020 2020 2020 2320 5468 6520 6f6c          # The ol
+0000dc10: 6420 7061 7468 2061 7564 6974 6f72 2077  d path auditor w
+0000dc20: 6f75 6c64 2068 6176 6520 7265 6a65 6374  ould have reject
+0000dc30: 6564 2062 7920 6d69 7374 616b 6520 7369  ed by mistake si
+0000dc40: 6e63 6520 6974 0a20 2020 2020 2020 2023  nce it.        #
+0000dc50: 2070 616e 6963 7320 7768 656e 2069 7420   panics when it 
+0000dc60: 7365 6573 2073 7562 2f2e 6867 2f2e 0a20  sees sub/.hg/.. 
+0000dc70: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
+0000dc80: 2023 2041 6c6c 2069 6e20 616c 6c2c 2063   # All in all, c
+0000dc90: 6865 636b 696e 6720 6167 6169 6e73 7420  hecking against 
+0000dca0: 7468 6520 776f 726b 696e 6720 636f 7079  the working copy
+0000dcb0: 2073 6565 6d73 2073 656e 7369 626c 650a   seems sensible.
+0000dcc0: 2020 2020 2020 2020 2320 7369 6e63 6520          # since 
+0000dcd0: 7765 2077 616e 7420 746f 2070 7265 7665  we want to preve
+0000dce0: 6e74 2061 6363 6573 7320 746f 206e 6573  nt access to nes
+0000dcf0: 7465 6420 7265 706f 7369 746f 7269 6573  ted repositories
+0000dd00: 206f 6e0a 2020 2020 2020 2020 2320 7468   on.        # th
+0000dd10: 6520 6669 6c65 7379 7374 656d 202a 6e6f  e filesystem *no
+0000dd20: 772a 2e0a 2020 2020 2020 2020 6374 7820  w*..        ctx 
+0000dd30: 3d20 7365 6c66 5b4e 6f6e 655d 0a20 2020  = self[None].   
+0000dd40: 2020 2020 2070 6172 7473 203d 2075 7469       parts = uti
+0000dd50: 6c2e 7370 6c69 7470 6174 6828 7375 6270  l.splitpath(subp
+0000dd60: 6174 6829 0a20 2020 2020 2020 2077 6869  ath).        whi
+0000dd70: 6c65 2070 6172 7473 3a0a 2020 2020 2020  le parts:.      
+0000dd80: 2020 2020 2020 7072 6566 6978 203d 2062        prefix = b
+0000dd90: 272f 272e 6a6f 696e 2870 6172 7473 290a  '/'.join(parts).
+0000dda0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+0000ddb0: 7265 6669 7820 696e 2063 7478 2e73 7562  refix in ctx.sub
+0000ddc0: 7374 6174 653a 0a20 2020 2020 2020 2020  state:.         
+0000ddd0: 2020 2020 2020 2069 6620 7072 6566 6978         if prefix
+0000dde0: 203d 3d20 6e6f 726d 7375 6270 6174 683a   == normsubpath:
+0000ddf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000de00: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+0000de10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000de20: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000de30: 2020 2020 2020 2020 2020 2073 7562 203d             sub =
+0000de40: 2063 7478 2e73 7562 2870 7265 6669 7829   ctx.sub(prefix)
+0000de50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000de60: 2020 2020 2072 6574 7572 6e20 7375 622e       return sub.
+0000de70: 6368 6563 6b6e 6573 7465 6428 7375 6270  checknested(subp
+0000de80: 6174 685b 6c65 6e28 7072 6566 6978 2920  ath[len(prefix) 
+0000de90: 2b20 3120 3a5d 290a 2020 2020 2020 2020  + 1 :]).        
+0000dea0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000deb0: 2020 2020 2020 2020 2020 7061 7274 732e            parts.
+0000dec0: 706f 7028 290a 2020 2020 2020 2020 7265  pop().        re
+0000ded0: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
+0000dee0: 6465 6620 7065 6572 2873 656c 662c 2070  def peer(self, p
+0000def0: 6174 683d 4e6f 6e65 2c20 7265 6d6f 7465  ath=None, remote
+0000df00: 6869 6464 656e 3d46 616c 7365 293a 0a20  hidden=False):. 
+0000df10: 2020 2020 2020 2072 6574 7572 6e20 6c6f         return lo
+0000df20: 6361 6c70 6565 7228 0a20 2020 2020 2020  calpeer(.       
+0000df30: 2020 2020 2073 656c 662c 2070 6174 683d       self, path=
+0000df40: 7061 7468 2c20 7265 6d6f 7465 6869 6464  path, remotehidd
+0000df50: 656e 3d72 656d 6f74 6568 6964 6465 6e0a  en=remotehidden.
+0000df60: 2020 2020 2020 2020 2920 2023 206e 6f74          )  # not
+0000df70: 2063 6163 6865 6420 746f 2061 766f 6964   cached to avoid
+0000df80: 2072 6566 6572 656e 6365 2063 7963 6c65   reference cycle
+0000df90: 0a0a 2020 2020 6465 6620 756e 6669 6c74  ..    def unfilt
+0000dfa0: 6572 6564 2873 656c 6629 3a0a 2020 2020  ered(self):.    
+0000dfb0: 2020 2020 2222 2252 6574 7572 6e20 756e      """Return un
+0000dfc0: 6669 6c74 6572 6564 2076 6572 7369 6f6e  filtered version
+0000dfd0: 206f 6620 7468 6520 7265 706f 7369 746f   of the reposito
+0000dfe0: 7279 0a0a 2020 2020 2020 2020 496e 7465  ry..        Inte
+0000dff0: 6e64 6564 2074 6f20 6265 206f 7665 7277  nded to be overw
+0000e000: 7269 7474 656e 2062 7920 6669 6c74 6572  ritten by filter
+0000e010: 6564 2072 6570 6f2e 2222 220a 2020 2020  ed repo.""".    
+0000e020: 2020 2020 7265 7475 726e 2073 656c 660a      return self.
+0000e030: 0a20 2020 2064 6566 2066 696c 7465 7265  .    def filtere
+0000e040: 6428 7365 6c66 2c20 6e61 6d65 2c20 7669  d(self, name, vi
+0000e050: 7369 6269 6c69 7479 6578 6365 7074 696f  sibilityexceptio
+0000e060: 6e73 3d4e 6f6e 6529 3a0a 2020 2020 2020  ns=None):.      
+0000e070: 2020 2222 2252 6574 7572 6e20 6120 6669    """Return a fi
+0000e080: 6c74 6572 6564 2076 6572 7369 6f6e 206f  ltered version o
+0000e090: 6620 6120 7265 706f 7369 746f 7279 0a0a  f a repository..
+0000e0a0: 2020 2020 2020 2020 5468 6520 606e 616d          The `nam
+0000e0b0: 6560 2070 6172 616d 6574 6572 2069 7320  e` parameter is 
+0000e0c0: 7468 6520 6964 656e 7469 6669 6572 206f  the identifier o
+0000e0d0: 6620 7468 6520 7265 7175 6573 7465 6420  f the requested 
+0000e0e0: 7669 6577 2e20 5468 6973 0a20 2020 2020  view. This.     
+0000e0f0: 2020 2077 696c 6c20 7265 7475 726e 2061     will return a
+0000e100: 2072 6570 6f76 6965 7720 6f62 6a65 6374   repoview object
+0000e110: 2073 6574 2022 6578 6163 746c 7922 2074   set "exactly" t
+0000e120: 6f20 7468 6520 7370 6563 6966 6965 6420  o the specified 
+0000e130: 7669 6577 2e0a 0a20 2020 2020 2020 2054  view...        T
+0000e140: 6869 7320 6675 6e63 7469 6f6e 2064 6f65  his function doe
+0000e150: 7320 6e6f 7420 6170 706c 7920 7265 6375  s not apply recu
+0000e160: 7273 6976 6520 6669 6c74 6572 696e 6720  rsive filtering 
+0000e170: 746f 2061 2072 6570 6f73 6974 6f72 792e  to a repository.
+0000e180: 2046 6f72 0a20 2020 2020 2020 2065 7861   For.        exa
+0000e190: 6d70 6c65 2063 616c 6c69 6e67 2060 7265  mple calling `re
+0000e1a0: 706f 2e66 696c 7465 7265 6428 2273 6572  po.filtered("ser
+0000e1b0: 7665 6422 2960 2077 696c 6c20 7265 7475  ved")` will retu
+0000e1c0: 726e 2061 2072 6570 6f76 6965 7720 7573  rn a repoview us
+0000e1d0: 696e 670a 2020 2020 2020 2020 7468 6520  ing.        the 
+0000e1e0: 2273 6572 7665 6422 2076 6965 772c 2072  "served" view, r
+0000e1f0: 6567 6172 646c 6573 7320 6f66 2074 6865  egardless of the
+0000e200: 2069 6e69 7469 616c 2076 6965 7720 7573   initial view us
+0000e210: 6564 2062 7920 6072 6570 6f60 2e0a 0a20  ed by `repo`... 
+0000e220: 2020 2020 2020 2049 6e20 6f74 6865 7220         In other 
+0000e230: 776f 7264 2c20 7468 6572 6520 6973 2061  word, there is a
+0000e240: 6c77 6179 7320 6f6e 6c79 206f 6e65 206c  lways only one l
+0000e250: 6576 656c 206f 6620 6072 6570 6f76 6965  evel of `repovie
+0000e260: 7760 2022 6669 6c74 6572 696e 6722 2e0a  w` "filtering"..
+0000e270: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000e280: 2020 2020 6966 2073 656c 662e 5f65 7874      if self._ext
+0000e290: 7261 6669 6c74 6572 6964 2069 7320 6e6f  rafilterid is no
+0000e2a0: 7420 4e6f 6e65 2061 6e64 2062 2725 2720  t None and b'%' 
+0000e2b0: 6e6f 7420 696e 206e 616d 653a 0a20 2020  not in name:.   
+0000e2c0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+0000e2d0: 6e61 6d65 202b 2062 2725 2720 2b20 7365  name + b'%' + se
+0000e2e0: 6c66 2e5f 6578 7472 6166 696c 7465 7269  lf._extrafilteri
+0000e2f0: 640a 0a20 2020 2020 2020 2063 6c73 203d  d..        cls =
+0000e300: 2072 6570 6f76 6965 772e 6e65 7774 7970   repoview.newtyp
+0000e310: 6528 7365 6c66 2e75 6e66 696c 7465 7265  e(self.unfiltere
+0000e320: 6428 292e 5f5f 636c 6173 735f 5f29 0a20  d().__class__). 
+0000e330: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
+0000e340: 7328 7365 6c66 2c20 6e61 6d65 2c20 7669  s(self, name, vi
+0000e350: 7369 6269 6c69 7479 6578 6365 7074 696f  sibilityexceptio
+0000e360: 6e73 290a 0a20 2020 2040 6d69 7865 6472  ns)..    @mixedr
+0000e370: 6570 6f73 746f 7265 6361 6368 6528 0a20  epostorecache(. 
+0000e380: 2020 2020 2020 2028 6227 626f 6f6b 6d61         (b'bookma
+0000e390: 726b 7327 2c20 6227 706c 6169 6e27 292c  rks', b'plain'),
+0000e3a0: 0a20 2020 2020 2020 2028 6227 626f 6f6b  .        (b'book
+0000e3b0: 6d61 726b 732e 6375 7272 656e 7427 2c20  marks.current', 
+0000e3c0: 6227 706c 6169 6e27 292c 0a20 2020 2020  b'plain'),.     
+0000e3d0: 2020 2028 6227 626f 6f6b 6d61 726b 7327     (b'bookmarks'
+0000e3e0: 2c20 6227 2729 2c0a 2020 2020 2020 2020  , b''),.        
+0000e3f0: 2862 2730 3063 6861 6e67 656c 6f67 2e69  (b'00changelog.i
+0000e400: 272c 2062 2727 292c 0a20 2020 2029 0a20  ', b''),.    ). 
+0000e410: 2020 2064 6566 205f 626f 6f6b 6d61 726b     def _bookmark
+0000e420: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0000e430: 2023 2053 696e 6365 2074 6865 206d 756c   # Since the mul
+0000e440: 7469 706c 6520 6669 6c65 7320 696e 766f  tiple files invo
+0000e450: 6c76 6564 2069 6e20 7468 6520 7472 616e  lved in the tran
+0000e460: 7361 6374 696f 6e20 6361 6e6e 6f74 2062  saction cannot b
+0000e470: 650a 2020 2020 2020 2020 2320 7772 6974  e.        # writ
+0000e480: 7465 6e20 6174 6f6d 6963 616c 6c79 2028  ten atomically (
+0000e490: 7769 7468 2063 7572 7265 6e74 2072 6570  with current rep
+0000e4a0: 6f73 6974 6f72 7920 666f 726d 6174 292c  ository format),
+0000e4b0: 2074 6865 7265 2069 7320 6120 7261 6365   there is a race
+0000e4c0: 0a20 2020 2020 2020 2023 2063 6f6e 6469  .        # condi
+0000e4d0: 7469 6f6e 2068 6572 652e 0a20 2020 2020  tion here..     
+0000e4e0: 2020 2023 0a20 2020 2020 2020 2023 2031     #.        # 1
+0000e4f0: 2920 6368 616e 6765 6c6f 6720 636f 6e74  ) changelog cont
+0000e500: 656e 7420 4120 6973 2072 6561 640a 2020  ent A is read.  
+0000e510: 2020 2020 2020 2320 3229 206f 7574 7369        # 2) outsi
+0000e520: 6465 2074 7261 6e73 6163 7469 6f6e 2075  de transaction u
+0000e530: 7064 6174 6520 6368 616e 6765 6c6f 6720  pdate changelog 
+0000e540: 746f 2063 6f6e 7465 6e74 2042 0a20 2020  to content B.   
+0000e550: 2020 2020 2023 2033 2920 6f75 7473 6964       # 3) outsid
+0000e560: 6520 7472 616e 7361 6374 696f 6e20 7570  e transaction up
+0000e570: 6461 7465 2062 6f6f 6b6d 6172 6b20 6669  date bookmark fi
+0000e580: 6c65 2072 6566 6572 7269 6e67 2074 6f20  le referring to 
+0000e590: 636f 6e74 656e 7420 420a 2020 2020 2020  content B.      
+0000e5a0: 2020 2320 3429 2062 6f6f 6b6d 6172 6b73    # 4) bookmarks
+0000e5b0: 2066 696c 6520 636f 6e74 656e 7420 6973   file content is
+0000e5c0: 2072 6561 6420 616e 6420 6669 6c74 6572   read and filter
+0000e5d0: 6564 2061 6761 696e 7374 2063 6861 6e67  ed against chang
+0000e5e0: 656c 6f67 2d41 0a20 2020 2020 2020 2023  elog-A.        #
+0000e5f0: 0a20 2020 2020 2020 2023 2057 6865 6e20  .        # When 
+0000e600: 7468 6973 2068 6170 7065 6e73 2c20 626f  this happens, bo
+0000e610: 6f6b 6d61 726b 7320 6167 6169 6e73 7420  okmarks against 
+0000e620: 6e6f 6465 7320 6d69 7373 696e 6720 6672  nodes missing fr
+0000e630: 6f6d 2041 2061 7265 2064 726f 7070 6564  om A are dropped
+0000e640: 2e0a 2020 2020 2020 2020 230a 2020 2020  ..        #.    
+0000e650: 2020 2020 2320 4861 7669 6e67 2074 6869      # Having thi
+0000e660: 7320 6861 7070 656e 696e 6720 6475 7269  s happening duri
+0000e670: 6e67 2072 6561 6420 6973 206e 6f74 2067  ng read is not g
+0000e680: 7265 6174 2c20 6275 7420 6974 2062 6563  reat, but it bec
+0000e690: 6f6d 6520 776f 7273 650a 2020 2020 2020  ome worse.      
+0000e6a0: 2020 2320 7768 656e 2074 6869 7320 6861    # when this ha
+0000e6b0: 7070 656e 2064 7572 696e 6720 7772 6974  ppen during writ
+0000e6c0: 6520 6265 6361 7573 6520 7468 6520 626f  e because the bo
+0000e6d0: 6f6b 6d61 726b 7320 746f 2074 6865 2022  okmarks to the "
+0000e6e0: 756e 6b6e 6f77 6e22 0a20 2020 2020 2020  unknown".       
+0000e6f0: 2023 206e 6f64 6573 2077 696c 6c20 6265   # nodes will be
+0000e700: 2064 726f 7070 6564 2066 6f72 2067 6f6f   dropped for goo
+0000e710: 642e 2048 6f77 6576 6572 2c20 7772 6974  d. However, writ
+0000e720: 6573 2068 6170 7065 6e20 7769 7468 696e  es happen within
+0000e730: 206c 6f63 6b73 2e0a 2020 2020 2020 2020   locks..        
+0000e740: 2320 5468 6973 206c 6f63 6b69 6e67 206d  # This locking m
+0000e750: 616b 6573 2069 7420 706f 7373 6962 6c65  akes it possible
+0000e760: 2074 6f20 6861 7665 2061 2072 6163 6520   to have a race 
+0000e770: 6672 6565 2063 6f6e 7369 7374 656e 7420  free consistent 
+0000e780: 7265 6164 2e0a 2020 2020 2020 2020 2320  read..        # 
+0000e790: 466f 7220 7468 6973 2070 7572 706f 7365  For this purpose
+0000e7a0: 2064 6174 6120 7265 6164 2066 726f 6d20   data read from 
+0000e7b0: 6469 7363 2062 6566 6f72 6520 6c6f 636b  disc before lock
+0000e7c0: 696e 6720 2061 7265 0a20 2020 2020 2020  ing  are.       
+0000e7d0: 2023 2022 696e 7661 6c69 6461 7465 6422   # "invalidated"
+0000e7e0: 2072 6967 6874 2061 6674 6572 2074 6865   right after the
+0000e7f0: 206c 6f63 6b73 2061 7265 2074 616b 656e   locks are taken
+0000e800: 2e20 5468 6973 2069 6e76 616c 6964 6174  . This invalidat
+0000e810: 696f 6e73 2061 7265 0a20 2020 2020 2020  ions are.       
+0000e820: 2023 2022 6c69 6768 7422 2c20 7468 6520   # "light", the 
+0000e830: 6066 696c 6563 6163 6865 6020 6d65 6368  `filecache` mech
+0000e840: 616e 6973 6d20 6b65 6570 2074 6865 2064  anism keep the d
+0000e850: 6174 6120 696e 206d 656d 6f72 7920 616e  ata in memory an
+0000e860: 6420 7769 6c6c 0a20 2020 2020 2020 2023  d will.        #
+0000e870: 2072 6575 7365 2074 6865 6d20 6966 2074   reuse them if t
+0000e880: 6865 2075 6e64 6572 6c79 696e 6720 6669  he underlying fi
+0000e890: 6c65 7320 6469 6420 6e6f 7420 6368 616e  les did not chan
+0000e8a0: 6765 642e 204e 6f74 2070 6172 7369 6e67  ged. Not parsing
+0000e8b0: 2074 6865 0a20 2020 2020 2020 2023 2073   the.        # s
+0000e8c0: 616d 6520 6461 7461 206d 756c 7469 706c  ame data multipl
+0000e8d0: 6520 7469 6d65 7320 6865 6c70 7320 7065  e times helps pe
+0000e8e0: 7266 6f72 6d61 6e63 6573 2e0a 2020 2020  rformances..    
+0000e8f0: 2020 2020 230a 2020 2020 2020 2020 2320      #.        # 
+0000e900: 556e 666f 7274 756e 6174 656c 7920 696e  Unfortunately in
+0000e910: 2074 6865 2063 6173 6520 6465 7363 7269   the case descri
+0000e920: 6265 2061 626f 7665 2c20 7468 6520 6669  be above, the fi
+0000e930: 6c65 7320 7472 6163 6b65 6420 6279 2074  les tracked by t
+0000e940: 6865 0a20 2020 2020 2020 2023 2062 6f6f  he.        # boo
+0000e950: 6b6d 6172 6b73 2066 696c 6520 6361 6368  kmarks file cach
+0000e960: 6520 6d69 6768 7420 6e6f 7420 6861 7665  e might not have
+0000e970: 2063 6861 6e67 6564 2c20 6275 7420 7468   changed, but th
+0000e980: 6520 696e 2d6d 656d 6f72 790a 2020 2020  e in-memory.    
+0000e990: 2020 2020 2320 636f 6e74 656e 7420 6973      # content is
+0000e9a0: 2073 7469 6c6c 2022 7772 6f6e 6722 2062   still "wrong" b
+0000e9b0: 6563 6175 7365 2077 6520 7573 6564 2061  ecause we used a
+0000e9c0: 6e20 6f6c 6465 7220 6368 616e 6765 6c6f  n older changelo
+0000e9d0: 6720 636f 6e74 656e 740a 2020 2020 2020  g content.      
+0000e9e0: 2020 2320 746f 2070 726f 6365 7373 2074    # to process t
+0000e9f0: 6865 206f 6e2d 6469 736b 2064 6174 612e  he on-disk data.
+0000ea00: 2053 6f20 6166 7465 7220 6c6f 636b 696e   So after lockin
+0000ea10: 672c 2074 6865 2063 6861 6e67 656c 6f67  g, the changelog
+0000ea20: 2077 6f75 6c64 2062 650a 2020 2020 2020   would be.      
+0000ea30: 2020 2320 7265 6672 6573 6865 6420 6275    # refreshed bu
+0000ea40: 7420 605f 626f 6f6b 6d61 726b 7360 2077  t `_bookmarks` w
+0000ea50: 6f75 6c64 2062 6520 7072 6573 6572 7665  ould be preserve
+0000ea60: 642e 0a20 2020 2020 2020 2023 2041 6464  d..        # Add
+0000ea70: 696e 6720 6030 3063 6861 6e67 656c 6f67  ing `00changelog
+0000ea80: 2e69 6020 746f 2074 6865 206c 6973 7420  .i` to the list 
+0000ea90: 6f66 2074 7261 636b 6564 2066 696c 6520  of tracked file 
+0000eaa0: 6973 206e 6f74 0a20 2020 2020 2020 2023  is not.        #
+0000eab0: 2065 6e6f 7567 682c 2062 6563 6175 7365   enough, because
+0000eac0: 2061 7420 7468 6520 7469 6d65 2077 6520   at the time we 
+0000ead0: 6275 696c 6420 7468 6520 636f 6e74 656e  build the conten
+0000eae0: 7420 666f 7220 605f 626f 6f6b 6d61 726b  t for `_bookmark
+0000eaf0: 7360 2069 6e0a 2020 2020 2020 2020 2320  s` in.        # 
+0000eb00: 2834 292c 2074 6865 2063 6861 6e67 656c  (4), the changel
+0000eb10: 6f67 2066 696c 6520 6861 7320 616c 7265  og file has alre
+0000eb20: 6164 7920 6469 7665 7267 6564 2066 726f  ady diverged fro
+0000eb30: 6d20 7468 6520 636f 6e74 656e 7420 7573  m the content us
+0000eb40: 6564 0a20 2020 2020 2020 2023 2066 6f72  ed.        # for
+0000eb50: 206c 6f61 6469 6e67 2060 6368 616e 6765   loading `change
+0000eb60: 6c6f 6760 2069 6e20 2831 290a 2020 2020  log` in (1).    
+0000eb70: 2020 2020 230a 2020 2020 2020 2020 2320      #.        # 
+0000eb80: 546f 2070 7265 7665 6e74 2074 6865 2069  To prevent the i
+0000eb90: 7373 7565 2c20 7765 2066 6f72 6365 2074  ssue, we force t
+0000eba0: 6865 2063 6861 6e67 656c 6f67 2074 6f20  he changelog to 
+0000ebb0: 6265 2065 7870 6c69 6369 746c 790a 2020  be explicitly.  
+0000ebc0: 2020 2020 2020 2320 7265 6c6f 6164 6564        # reloaded
+0000ebd0: 2077 6869 6c65 2063 6f6d 7075 7469 6e67   while computing
+0000ebe0: 2060 5f62 6f6f 6b6d 6172 6b73 602e 2054   `_bookmarks`. T
+0000ebf0: 6865 2064 6174 6120 7261 6365 2063 616e  he data race can
+0000ec00: 2073 7469 6c6c 2068 6170 7065 6e0a 2020   still happen.  
+0000ec10: 2020 2020 2020 2320 7769 7468 6f75 7420        # without 
+0000ec20: 7468 6520 6c6f 636b 2028 7769 7468 2061  the lock (with a
+0000ec30: 206e 6172 726f 7765 7220 7769 6e64 6f77   narrower window
+0000ec40: 292c 2062 7574 2069 7420 776f 756c 6420  ), but it would 
+0000ec50: 6e6f 206c 6f6e 6765 7220 676f 0a20 2020  no longer go.   
+0000ec60: 2020 2020 2023 2075 6e64 6574 6563 7465       # undetecte
+0000ec70: 6420 6475 7269 6e67 2074 6865 206c 6f63  d during the loc
+0000ec80: 6b20 7469 6d65 2072 6566 7265 7368 2e0a  k time refresh..
+0000ec90: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
+0000eca0: 2020 2320 5468 6520 6e65 7720 7363 6865    # The new sche
+0000ecb0: 6475 6c65 2069 7320 6173 2066 6f6c 6c6f  dule is as follo
+0000ecc0: 770a 2020 2020 2020 2020 230a 2020 2020  w.        #.    
+0000ecd0: 2020 2020 2320 3129 2066 696c 6563 6163      # 1) filecac
+0000ece0: 6865 206c 6f67 6963 2064 6574 6563 7420  he logic detect 
+0000ecf0: 7468 6174 2060 5f62 6f6f 6b6d 6172 6b73  that `_bookmarks
+0000ed00: 6020 6e65 6564 7320 746f 2062 6520 636f  ` needs to be co
+0000ed10: 6d70 7574 6564 0a20 2020 2020 2020 2023  mputed.        #
+0000ed20: 2032 2920 6361 6368 6573 7461 7420 666f   2) cachestat fo
+0000ed30: 7220 6062 6f6f 6b6d 6172 6b73 6020 616e  r `bookmarks` an
+0000ed40: 6420 6063 6861 6e67 656c 6f67 6020 6172  d `changelog` ar
+0000ed50: 6520 6361 7074 7572 6564 2028 666f 7220  e captured (for 
+0000ed60: 626f 6f6b 290a 2020 2020 2020 2020 2320  book).        # 
+0000ed70: 3329 2057 6520 666f 7263 6520 6063 6861  3) We force `cha
+0000ed80: 6e67 656c 6f67 6020 6669 6c65 6361 6368  ngelog` filecach
+0000ed90: 6520 746f 2062 6520 7465 7374 6564 0a20  e to be tested. 
+0000eda0: 2020 2020 2020 2023 2034 2920 6361 6368         # 4) cach
+0000edb0: 6573 7461 7420 666f 7220 6063 6861 6e67  estat for `chang
+0000edc0: 656c 6f67 6020 6172 6520 6361 7074 7572  elog` are captur
+0000edd0: 6564 2028 666f 7220 6368 616e 6765 6c6f  ed (for changelo
+0000ede0: 6729 0a20 2020 2020 2020 2023 2035 2920  g).        # 5) 
+0000edf0: 605f 626f 6f6b 6d61 726b 7360 2069 7320  `_bookmarks` is 
+0000ee00: 636f 6d70 7574 6564 2061 6e64 2063 6163  computed and cac
+0000ee10: 6865 640a 2020 2020 2020 2020 230a 2020  hed.        #.  
+0000ee20: 2020 2020 2020 2320 5468 6520 7374 6570        # The step
+0000ee30: 2069 6e20 2833 2920 656e 7375 7265 2077   in (3) ensure w
+0000ee40: 6520 6861 7665 2061 2063 6861 6e67 656c  e have a changel
+0000ee50: 6f67 2061 7420 6c65 6173 7420 6173 2072  og at least as r
+0000ee60: 6563 656e 7420 6173 2074 6865 0a20 2020  ecent as the.   
+0000ee70: 2020 2020 2023 2063 6163 6865 2073 7461       # cache sta
+0000ee80: 7420 636f 6d70 7574 6564 2069 6e20 2831  t computed in (1
+0000ee90: 292e 2041 7320 6120 7265 7375 6c74 2061  ). As a result a
+0000eea0: 7420 6c6f 636b 696e 6720 7469 6d65 3a0a  t locking time:.
+0000eeb0: 2020 2020 2020 2020 2320 202a 2069 6620          #  * if 
+0000eec0: 7468 6520 6368 616e 6765 6c6f 6720 6469  the changelog di
+0000eed0: 6420 6e6f 7420 6368 616e 6765 6420 7369  d not changed si
+0000eee0: 6e63 6520 2831 2920 2d3e 2077 6520 6361  nce (1) -> we ca
+0000eef0: 6e20 7265 7573 6520 7468 6520 6461 7461  n reuse the data
+0000ef00: 0a20 2020 2020 2020 2023 2020 2a20 6f74  .        #  * ot
+0000ef10: 6865 7277 6973 6520 2d3e 2074 6865 2062  herwise -> the b
+0000ef20: 6f6f 6b6d 6172 6b73 2067 6574 2072 6566  ookmarks get ref
+0000ef30: 7265 7368 6564 2e0a 2020 2020 2020 2020  reshed..        
+0000ef40: 7365 6c66 2e5f 7265 6672 6573 6863 6861  self._refreshcha
+0000ef50: 6e67 656c 6f67 2829 0a20 2020 2020 2020  ngelog().       
+0000ef60: 2072 6574 7572 6e20 626f 6f6b 6d61 726b   return bookmark
+0000ef70: 732e 626d 7374 6f72 6528 7365 6c66 290a  s.bmstore(self).
+0000ef80: 0a20 2020 2064 6566 205f 7265 6672 6573  .    def _refres
+0000ef90: 6863 6861 6e67 656c 6f67 2873 656c 6629  hchangelog(self)
+0000efa0: 3a0a 2020 2020 2020 2020 2222 226d 616b  :.        """mak
+0000efb0: 6520 7375 7265 2074 6865 2069 6e20 6d65  e sure the in me
+0000efc0: 6d6f 7279 2063 6861 6e67 656c 6f67 206d  mory changelog m
+0000efd0: 6174 6368 2074 6865 206f 6e2d 6469 736b  atch the on-disk
+0000efe0: 206f 6e65 2222 220a 2020 2020 2020 2020   one""".        
+0000eff0: 6966 2027 6368 616e 6765 6c6f 6727 2069  if 'changelog' i
+0000f000: 6e20 7661 7273 2873 656c 6629 2061 6e64  n vars(self) and
+0000f010: 2073 656c 662e 6375 7272 656e 7474 7261   self.currenttra
+0000f020: 6e73 6163 7469 6f6e 2829 2069 7320 4e6f  nsaction() is No
+0000f030: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000f040: 6465 6c20 7365 6c66 2e63 6861 6e67 656c  del self.changel
+0000f050: 6f67 0a0a 2020 2020 4070 726f 7065 7274  og..    @propert
+0000f060: 790a 2020 2020 6465 6620 5f61 6374 6976  y.    def _activ
+0000f070: 6562 6f6f 6b6d 6172 6b28 7365 6c66 293a  ebookmark(self):
+0000f080: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f090: 7365 6c66 2e5f 626f 6f6b 6d61 726b 732e  self._bookmarks.
+0000f0a0: 6163 7469 7665 0a0a 2020 2020 2320 5f70  active..    # _p
+0000f0b0: 6861 7365 7365 7473 2064 6570 656e 6420  hasesets depend 
+0000f0c0: 6f6e 2063 6861 6e67 656c 6f67 2e20 7768  on changelog. wh
+0000f0d0: 6174 2077 6520 6e65 6564 2069 7320 746f  at we need is to
+0000f0e0: 2063 616c 6c0a 2020 2020 2320 5f70 6861   call.    # _pha
+0000f0f0: 7365 6361 6368 652e 696e 7661 6c69 6461  secache.invalida
+0000f100: 7465 2829 2069 6620 2730 3063 6861 6e67  te() if '00chang
+0000f110: 656c 6f67 2e69 2720 7761 7320 6368 616e  elog.i' was chan
+0000f120: 6765 642c 2062 7574 2069 740a 2020 2020  ged, but it.    
+0000f130: 2320 6361 6e27 7420 6265 2065 6173 696c  # can't be easil
+0000f140: 7920 6578 7072 6573 7365 6420 696e 2066  y expressed in f
+0000f150: 696c 6563 6163 6865 206d 6563 6861 6e69  ilecache mechani
+0000f160: 736d 2e0a 2020 2020 4073 746f 7265 6361  sm..    @storeca
+0000f170: 6368 6528 6227 7068 6173 6572 6f6f 7473  che(b'phaseroots
+0000f180: 272c 2062 2730 3063 6861 6e67 656c 6f67  ', b'00changelog
+0000f190: 2e69 2729 0a20 2020 2064 6566 205f 7068  .i').    def _ph
+0000f1a0: 6173 6563 6163 6865 2873 656c 6629 3a0a  asecache(self):.
+0000f1b0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+0000f1c0: 6861 7365 732e 7068 6173 6563 6163 6865  hases.phasecache
+0000f1d0: 2873 656c 662c 2073 656c 662e 5f70 6861  (self, self._pha
+0000f1e0: 7365 6465 6661 756c 7473 290a 0a20 2020  sedefaults)..   
+0000f1f0: 2040 7374 6f72 6563 6163 6865 2862 276f   @storecache(b'o
+0000f200: 6273 7374 6f72 6527 290a 2020 2020 6465  bsstore').    de
+0000f210: 6620 6f62 7373 746f 7265 2873 656c 6629  f obsstore(self)
+0000f220: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000f230: 206f 6273 6f6c 6574 652e 6d61 6b65 7374   obsolete.makest
+0000f240: 6f72 6528 7365 6c66 2e75 692c 2073 656c  ore(self.ui, sel
+0000f250: 6629 0a0a 2020 2020 4063 6861 6e67 656c  f)..    @changel
+0000f260: 6f67 6361 6368 6528 290a 2020 2020 6465  ogcache().    de
+0000f270: 6620 6368 616e 6765 6c6f 6728 7265 706f  f changelog(repo
+0000f280: 293a 0a20 2020 2020 2020 2023 206c 6f61  ):.        # loa
+0000f290: 6420 6469 7273 7461 7465 2062 6566 6f72  d dirstate befor
+0000f2a0: 6520 6368 616e 6765 6c6f 6720 746f 2061  e changelog to a
+0000f2b0: 766f 6964 2072 6163 6520 7365 6520 6973  void race see is
+0000f2c0: 7375 6536 3330 330a 2020 2020 2020 2020  sue6303.        
+0000f2d0: 7265 706f 2e64 6972 7374 6174 652e 7072  repo.dirstate.pr
+0000f2e0: 6566 6574 6368 5f70 6172 656e 7473 2829  efetch_parents()
+0000f2f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f300: 7265 706f 2e73 746f 7265 2e63 6861 6e67  repo.store.chang
+0000f310: 656c 6f67 280a 2020 2020 2020 2020 2020  elog(.          
+0000f320: 2020 7478 6e75 7469 6c2e 6d61 7968 6176    txnutil.mayhav
+0000f330: 6570 656e 6469 6e67 2872 6570 6f2e 726f  epending(repo.ro
+0000f340: 6f74 292c 0a20 2020 2020 2020 2020 2020  ot),.           
+0000f350: 2063 6f6e 6375 7272 656e 6379 6368 6563   concurrencychec
+0000f360: 6b65 723d 7265 766c 6f67 6368 6563 6b65  ker=revlogchecke
+0000f370: 722e 6765 745f 6368 6563 6b65 7228 7265  r.get_checker(re
+0000f380: 706f 2e75 692c 2062 2763 6861 6e67 656c  po.ui, b'changel
+0000f390: 6f67 2729 2c0a 2020 2020 2020 2020 290a  og'),.        ).
+0000f3a0: 0a20 2020 2040 6d61 6e69 6665 7374 6c6f  .    @manifestlo
+0000f3b0: 6763 6163 6865 2829 0a20 2020 2064 6566  gcache().    def
+0000f3c0: 206d 616e 6966 6573 746c 6f67 2873 656c   manifestlog(sel
+0000f3d0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+0000f3e0: 726e 2073 656c 662e 7374 6f72 652e 6d61  rn self.store.ma
+0000f3f0: 6e69 6665 7374 6c6f 6728 7365 6c66 2c20  nifestlog(self, 
+0000f400: 7365 6c66 2e5f 7374 6f72 656e 6172 726f  self._storenarro
+0000f410: 776d 6174 6368 290a 0a20 2020 2040 756e  wmatch)..    @un
+0000f420: 6669 6c74 6572 6564 7072 6f70 6572 7479  filteredproperty
+0000f430: 6361 6368 650a 2020 2020 6465 6620 6469  cache.    def di
+0000f440: 7273 7461 7465 2873 656c 6629 3a0a 2020  rstate(self):.  
+0000f450: 2020 2020 2020 6966 2073 656c 662e 5f64        if self._d
+0000f460: 6972 7374 6174 6520 6973 204e 6f6e 653a  irstate is None:
+0000f470: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f480: 662e 5f64 6972 7374 6174 6520 3d20 7365  f._dirstate = se
+0000f490: 6c66 2e5f 6d61 6b65 6469 7273 7461 7465  lf._makedirstate
+0000f4a0: 2829 0a20 2020 2020 2020 2065 6c73 653a  ().        else:
+0000f4b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f4c0: 662e 5f64 6972 7374 6174 652e 7265 6672  f._dirstate.refr
+0000f4d0: 6573 6828 290a 2020 2020 2020 2020 7265  esh().        re
+0000f4e0: 7475 726e 2073 656c 662e 5f64 6972 7374  turn self._dirst
+0000f4f0: 6174 650a 0a20 2020 2064 6566 205f 6d61  ate..    def _ma
+0000f500: 6b65 6469 7273 7461 7465 2873 656c 6629  kedirstate(self)
+0000f510: 3a0a 2020 2020 2020 2020 2222 2245 7874  :.        """Ext
+0000f520: 656e 7369 6f6e 2070 6f69 6e74 2066 6f72  ension point for
+0000f530: 2077 7261 7070 696e 6720 7468 6520 6469   wrapping the di
+0000f540: 7273 7461 7465 2070 6572 2d72 6570 6f2e  rstate per-repo.
+0000f550: 2222 220a 2020 2020 2020 2020 7370 6172  """.        spar
+0000f560: 7365 6d61 7463 6866 6e20 3d20 4e6f 6e65  sematchfn = None
+0000f570: 0a20 2020 2020 2020 2069 6620 7370 6172  .        if spar
+0000f580: 7365 2e75 7365 5f73 7061 7273 6528 7365  se.use_sparse(se
+0000f590: 6c66 293a 0a20 2020 2020 2020 2020 2020  lf):.           
+0000f5a0: 2073 7061 7273 656d 6174 6368 666e 203d   sparsematchfn =
+0000f5b0: 206c 616d 6264 613a 2073 7061 7273 652e   lambda: sparse.
+0000f5c0: 6d61 7463 6865 7228 7365 6c66 290a 2020  matcher(self).  
+0000f5d0: 2020 2020 2020 7632 5f72 6571 203d 2072        v2_req = r
+0000f5e0: 6571 7569 7265 6d65 6e74 736d 6f64 2e44  equirementsmod.D
+0000f5f0: 4952 5354 4154 455f 5632 5f52 4551 5549  IRSTATE_V2_REQUI
+0000f600: 5245 4d45 4e54 0a20 2020 2020 2020 2074  REMENT.        t
+0000f610: 6820 3d20 7265 7175 6972 656d 656e 7473  h = requirements
+0000f620: 6d6f 642e 4449 5253 5441 5445 5f54 5241  mod.DIRSTATE_TRA
+0000f630: 434b 4544 5f48 494e 545f 5631 0a20 2020  CKED_HINT_V1.   
+0000f640: 2020 2020 2075 7365 5f64 6972 7374 6174       use_dirstat
+0000f650: 655f 7632 203d 2076 325f 7265 7120 696e  e_v2 = v2_req in
+0000f660: 2073 656c 662e 7265 7175 6972 656d 656e   self.requiremen
+0000f670: 7473 0a20 2020 2020 2020 2075 7365 5f74  ts.        use_t
+0000f680: 7261 636b 6564 5f68 696e 7420 3d20 7468  racked_hint = th
+0000f690: 2069 6e20 7365 6c66 2e72 6571 7569 7265   in self.require
+0000f6a0: 6d65 6e74 730a 0a20 2020 2020 2020 2072  ments..        r
+0000f6b0: 6574 7572 6e20 6469 7273 7461 7465 2e64  eturn dirstate.d
+0000f6c0: 6972 7374 6174 6528 0a20 2020 2020 2020  irstate(.       
+0000f6d0: 2020 2020 2073 656c 662e 7666 732c 0a20       self.vfs,. 
+0000f6e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f6f0: 7569 2c0a 2020 2020 2020 2020 2020 2020  ui,.            
+0000f700: 7365 6c66 2e72 6f6f 742c 0a20 2020 2020  self.root,.     
+0000f710: 2020 2020 2020 2073 656c 662e 5f64 6972         self._dir
+0000f720: 7374 6174 6576 616c 6964 6174 652c 0a20  statevalidate,. 
+0000f730: 2020 2020 2020 2020 2020 2073 7061 7273             spars
+0000f740: 656d 6174 6368 666e 2c0a 2020 2020 2020  ematchfn,.      
+0000f750: 2020 2020 2020 7365 6c66 2e6e 6f64 6563        self.nodec
+0000f760: 6f6e 7374 616e 7473 2c0a 2020 2020 2020  onstants,.      
+0000f770: 2020 2020 2020 7573 655f 6469 7273 7461        use_dirsta
+0000f780: 7465 5f76 322c 0a20 2020 2020 2020 2020  te_v2,.         
+0000f790: 2020 2075 7365 5f74 7261 636b 6564 5f68     use_tracked_h
+0000f7a0: 696e 743d 7573 655f 7472 6163 6b65 645f  int=use_tracked_
+0000f7b0: 6869 6e74 2c0a 2020 2020 2020 2020 290a  hint,.        ).
+0000f7c0: 0a20 2020 2064 6566 205f 6469 7273 7461  .    def _dirsta
+0000f7d0: 7465 7661 6c69 6461 7465 2873 656c 662c  tevalidate(self,
+0000f7e0: 206e 6f64 6529 3a0a 2020 2020 2020 2020   node):.        
+0000f7f0: 6f6b 6179 203d 2054 7275 650a 2020 2020  okay = True.    
+0000f800: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000f810: 2020 2020 2073 656c 662e 6368 616e 6765       self.change
+0000f820: 6c6f 672e 7265 7628 6e6f 6465 290a 2020  log.rev(node).  
+0000f830: 2020 2020 2020 6578 6365 7074 2065 7272        except err
+0000f840: 6f72 2e4c 6f6f 6b75 7045 7272 6f72 3a0a  or.LookupError:.
+0000f850: 2020 2020 2020 2020 2020 2020 2320 4966              # If
+0000f860: 2074 6865 2070 6172 656e 7420 6172 6520   the parent are 
+0000f870: 756e 6b6e 6f77 6e20 6974 206d 6967 6874  unknown it might
+0000f880: 206a 7573 7420 6265 2062 6563 6175 7365   just be because
+0000f890: 2074 6865 2063 6861 6e67 656c 6f67 0a20   the changelog. 
+0000f8a0: 2020 2020 2020 2020 2020 2023 2069 6e20             # in 
+0000f8b0: 6d65 6d6f 7279 2069 7320 6c61 6767 696e  memory is laggin
+0000f8c0: 6720 6265 6869 6e64 2074 6865 2064 6972  g behind the dir
+0000f8d0: 7374 6174 6520 696e 206d 656d 6f72 792e  state in memory.
+0000f8e0: 2053 6f20 7472 7920 746f 0a20 2020 2020   So try to.     
+0000f8f0: 2020 2020 2020 2023 2072 6566 7265 7368         # refresh
+0000f900: 2074 6865 2063 6861 6e67 656c 6f67 2066   the changelog f
+0000f910: 6972 7374 2e0a 2020 2020 2020 2020 2020  irst..          
+0000f920: 2020 230a 2020 2020 2020 2020 2020 2020    #.            
+0000f930: 2320 5765 206f 6e6c 7920 646f 2073 6f20  # We only do so 
+0000f940: 6966 2077 6520 646f 6e27 7420 686f 6c64  if we don't hold
+0000f950: 2074 6865 206c 6f63 6b2c 2069 6620 7765   the lock, if we
+0000f960: 2064 6f20 686f 6c64 2074 6865 206c 6f63   do hold the loc
+0000f970: 6b0a 2020 2020 2020 2020 2020 2020 2320  k.            # 
+0000f980: 7468 6520 696e 7661 6c69 6461 7469 6f6e  the invalidation
+0000f990: 2061 7420 7468 6174 2074 696d 6520 7368   at that time sh
+0000f9a0: 6f75 6c64 2068 6176 6520 7461 6b65 6e20  ould have taken 
+0000f9b0: 6361 7265 206f 6620 7468 6973 2061 6e64  care of this and
+0000f9c0: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
+0000f9d0: 6f6d 6574 6869 6e67 2069 7320 7665 7279  omething is very
+0000f9e0: 2066 6973 6879 2e0a 2020 2020 2020 2020   fishy..        
+0000f9f0: 2020 2020 6966 2073 656c 662e 6375 7272      if self.curr
+0000fa00: 656e 746c 6f63 6b28 2920 6973 204e 6f6e  entlock() is Non
+0000fa10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000fa20: 2020 2073 656c 662e 696e 7661 6c69 6461     self.invalida
+0000fa30: 7465 2829 0a20 2020 2020 2020 2020 2020  te().           
+0000fa40: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000fa50: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000fa60: 6c66 2e63 6861 6e67 656c 6f67 2e72 6576  lf.changelog.rev
+0000fa70: 286e 6f64 6529 0a20 2020 2020 2020 2020  (node).         
+0000fa80: 2020 2020 2020 2065 7863 6570 7420 6572         except er
+0000fa90: 726f 722e 4c6f 6f6b 7570 4572 726f 723a  ror.LookupError:
+0000faa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fab0: 2020 2020 206f 6b61 7920 3d20 4661 6c73       okay = Fals
+0000fac0: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+0000fad0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000fae0: 2020 2020 2320 5858 5820 7765 2073 686f      # XXX we sho
+0000faf0: 756c 6420 636f 6e73 6964 6572 2072 6169  uld consider rai
+0000fb00: 7369 6e67 2061 6e20 6572 726f 7220 6865  sing an error he
+0000fb10: 7265 2e0a 2020 2020 2020 2020 2020 2020  re..            
+0000fb20: 2020 2020 6f6b 6179 203d 2046 616c 7365      okay = False
+0000fb30: 0a20 2020 2020 2020 2069 6620 6f6b 6179  .        if okay
+0000fb40: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000fb50: 7475 726e 206e 6f64 650a 2020 2020 2020  turn node.      
+0000fb60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000fb70: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0000fb80: 5f64 6972 7374 6174 6576 616c 6964 6174  _dirstatevalidat
+0000fb90: 6577 6172 6e65 643a 0a20 2020 2020 2020  ewarned:.       
+0000fba0: 2020 2020 2020 2020 2073 656c 662e 5f64           self._d
+0000fbb0: 6972 7374 6174 6576 616c 6964 6174 6577  irstatevalidatew
+0000fbc0: 6172 6e65 6420 3d20 5472 7565 0a20 2020  arned = True.   
+0000fbd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000fbe0: 662e 7569 2e77 6172 6e28 0a20 2020 2020  f.ui.warn(.     
+0000fbf0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0000fc00: 2862 2277 6172 6e69 6e67 3a20 6967 6e6f  (b"warning: igno
+0000fc10: 7269 6e67 2075 6e6b 6e6f 776e 2077 6f72  ring unknown wor
+0000fc20: 6b69 6e67 2070 6172 656e 7420 2573 215c  king parent %s!\
+0000fc30: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+0000fc40: 2020 2020 2020 2020 2520 7368 6f72 7428          % short(
+0000fc50: 6e6f 6465 290a 2020 2020 2020 2020 2020  node).          
+0000fc60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000fc70: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000fc80: 6e75 6c6c 6964 0a0a 2020 2020 4073 746f  nullid..    @sto
+0000fc90: 7265 6361 6368 6528 6e61 7272 6f77 7370  recache(narrowsp
+0000fca0: 6563 2e46 494c 454e 414d 4529 0a20 2020  ec.FILENAME).   
+0000fcb0: 2064 6566 206e 6172 726f 7770 6174 7328   def narrowpats(
+0000fcc0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0000fcd0: 2222 6d61 7463 6865 7220 7061 7474 6572  ""matcher patter
+0000fce0: 6e73 2066 6f72 2074 6869 7320 7265 706f  ns for this repo
+0000fcf0: 7369 746f 7279 2773 206e 6172 726f 7773  sitory's narrows
+0000fd00: 7065 630a 0a20 2020 2020 2020 2041 2074  pec..        A t
+0000fd10: 7570 6c65 206f 6620 2869 6e63 6c75 6465  uple of (include
+0000fd20: 732c 2065 7863 6c75 6465 7329 2e0a 2020  s, excludes)..  
+0000fd30: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000fd40: 2020 2320 7468 6520 6e61 7272 6f77 206d    # the narrow m
+0000fd50: 616e 6167 656d 656e 7420 7368 6f75 6c64  anagement should
+0000fd60: 2070 726f 6261 626c 7920 6d6f 7665 2069   probably move i
+0000fd70: 6e74 6f20 6974 7320 6f77 6e20 6f62 6a65  nto its own obje
+0000fd80: 6374 0a20 2020 2020 2020 2076 616c 203d  ct.        val =
+0000fd90: 2073 656c 662e 5f70 656e 6469 6e67 5f6e   self._pending_n
+0000fda0: 6172 726f 775f 7061 7473 0a20 2020 2020  arrow_pats.     
+0000fdb0: 2020 2069 6620 7661 6c20 6973 204e 6f6e     if val is Non
+0000fdc0: 653a 0a20 2020 2020 2020 2020 2020 2076  e:.            v
+0000fdd0: 616c 203d 206e 6172 726f 7773 7065 632e  al = narrowspec.
+0000fde0: 6c6f 6164 2873 656c 6629 0a20 2020 2020  load(self).     
+0000fdf0: 2020 2072 6574 7572 6e20 7661 6c0a 0a20     return val.. 
+0000fe00: 2020 2040 7374 6f72 6563 6163 6865 286e     @storecache(n
+0000fe10: 6172 726f 7773 7065 632e 4649 4c45 4e41  arrowspec.FILENA
+0000fe20: 4d45 290a 2020 2020 6465 6620 5f73 746f  ME).    def _sto
+0000fe30: 7265 6e61 7272 6f77 6d61 7463 6828 7365  renarrowmatch(se
+0000fe40: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
+0000fe50: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
+0000fe60: 4e41 5252 4f57 5f52 4551 5549 5245 4d45  NARROW_REQUIREME
+0000fe70: 4e54 206e 6f74 2069 6e20 7365 6c66 2e72  NT not in self.r
+0000fe80: 6571 7569 7265 6d65 6e74 733a 0a20 2020  equirements:.   
+0000fe90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000fea0: 6d61 7463 686d 6f64 2e61 6c77 6179 7328  matchmod.always(
+0000feb0: 290a 2020 2020 2020 2020 696e 636c 7564  ).        includ
+0000fec0: 652c 2065 7863 6c75 6465 203d 2073 656c  e, exclude = sel
+0000fed0: 662e 6e61 7272 6f77 7061 7473 0a20 2020  f.narrowpats.   
+0000fee0: 2020 2020 2072 6574 7572 6e20 6e61 7272       return narr
+0000fef0: 6f77 7370 6563 2e6d 6174 6368 2873 656c  owspec.match(sel
+0000ff00: 662e 726f 6f74 2c20 696e 636c 7564 653d  f.root, include=
+0000ff10: 696e 636c 7564 652c 2065 7863 6c75 6465  include, exclude
+0000ff20: 3d65 7863 6c75 6465 290a 0a20 2020 2040  =exclude)..    @
+0000ff30: 7374 6f72 6563 6163 6865 286e 6172 726f  storecache(narro
+0000ff40: 7773 7065 632e 4649 4c45 4e41 4d45 290a  wspec.FILENAME).
+0000ff50: 2020 2020 6465 6620 5f6e 6172 726f 776d      def _narrowm
+0000ff60: 6174 6368 2873 656c 6629 3a0a 2020 2020  atch(self):.    
+0000ff70: 2020 2020 6966 2072 6571 7569 7265 6d65      if requireme
+0000ff80: 6e74 736d 6f64 2e4e 4152 524f 575f 5245  ntsmod.NARROW_RE
+0000ff90: 5155 4952 454d 454e 5420 6e6f 7420 696e  QUIREMENT not in
+0000ffa0: 2073 656c 662e 7265 7175 6972 656d 656e   self.requiremen
+0000ffb0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+0000ffc0: 7265 7475 726e 206d 6174 6368 6d6f 642e  return matchmod.
+0000ffd0: 616c 7761 7973 2829 0a20 2020 2020 2020  always().       
+0000ffe0: 206e 6172 726f 7773 7065 632e 6368 6563   narrowspec.chec
+0000fff0: 6b77 6f72 6b69 6e67 636f 7079 6e61 7272  kworkingcopynarr
+00010000: 6f77 7370 6563 2873 656c 6629 0a20 2020  owspec(self).   
+00010010: 2020 2020 2069 6e63 6c75 6465 2c20 6578       include, ex
+00010020: 636c 7564 6520 3d20 7365 6c66 2e6e 6172  clude = self.nar
+00010030: 726f 7770 6174 730a 2020 2020 2020 2020  rowpats.        
+00010040: 7265 7475 726e 206e 6172 726f 7773 7065  return narrowspe
+00010050: 632e 6d61 7463 6828 7365 6c66 2e72 6f6f  c.match(self.roo
+00010060: 742c 2069 6e63 6c75 6465 3d69 6e63 6c75  t, include=inclu
+00010070: 6465 2c20 6578 636c 7564 653d 6578 636c  de, exclude=excl
+00010080: 7564 6529 0a0a 2020 2020 6465 6620 6e61  ude)..    def na
+00010090: 7272 6f77 6d61 7463 6828 7365 6c66 2c20  rrowmatch(self, 
+000100a0: 6d61 7463 683d 4e6f 6e65 2c20 696e 636c  match=None, incl
+000100b0: 7564 6565 7861 6374 3d46 616c 7365 293a  udeexact=False):
+000100c0: 0a20 2020 2020 2020 2022 2222 6d61 7463  .        """matc
+000100d0: 6865 7220 636f 7272 6573 706f 6e64 696e  her correspondin
+000100e0: 6720 7468 6520 7468 6520 7265 706f 2773  g the the repo's
+000100f0: 206e 6172 726f 7773 7065 630a 0a20 2020   narrowspec..   
+00010100: 2020 2020 2049 6620 606d 6174 6368 6020       If `match` 
+00010110: 6973 2067 6976 656e 2c20 7468 656e 2074  is given, then t
+00010120: 6861 7420 7769 6c6c 2062 6520 696e 7465  hat will be inte
+00010130: 7273 6563 7465 6420 7769 7468 2074 6865  rsected with the
+00010140: 206e 6172 726f 770a 2020 2020 2020 2020   narrow.        
+00010150: 6d61 7463 6865 722e 0a0a 2020 2020 2020  matcher...      
+00010160: 2020 4966 2060 696e 636c 7564 6565 7861    If `includeexa
+00010170: 6374 6020 6973 2054 7275 652c 2074 6865  ct` is True, the
+00010180: 6e20 616e 7920 6578 6163 7420 6d61 7463  n any exact matc
+00010190: 6865 7320 6672 6f6d 2060 6d61 7463 6860  hes from `match`
+000101a0: 2077 696c 6c0a 2020 2020 2020 2020 6265   will.        be
+000101b0: 2069 6e63 6c75 6465 6420 6576 656e 2069   included even i
+000101c0: 6620 7468 6579 2772 6520 6f75 7473 6964  f they're outsid
+000101d0: 6520 7468 6520 6e61 7272 6f77 7370 6563  e the narrowspec
+000101e0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000101f0: 2020 2020 2020 6966 206d 6174 6368 3a0a        if match:.
+00010200: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00010210: 6e63 6c75 6465 6578 6163 7420 616e 6420  ncludeexact and 
+00010220: 6e6f 7420 7365 6c66 2e5f 6e61 7272 6f77  not self._narrow
+00010230: 6d61 7463 682e 616c 7761 7973 2829 3a0a  match.always():.
 00010240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010250: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00010260: 2020 2020 2020 2020 2020 6e20 3d20 636c            n = cl
-00010270: 2e6e 6f64 6528 7229 0a20 2020 2020 2020  .node(r).       
-00010280: 2020 2020 2020 2020 2070 6169 7220 3d20           pair = 
-00010290: 2872 2c20 6e29 0a20 2020 2020 2020 2020  (r, n).         
-000102a0: 2020 2020 2020 2071 7569 636b 5b72 5d20         quick[r] 
-000102b0: 3d20 7061 6972 0a20 2020 2020 2020 2020  = pair.         
-000102c0: 2020 2020 2020 2071 7569 636b 5b6e 5d20         quick[n] 
-000102d0: 3d20 7061 6972 0a20 2020 2020 2020 2070  = pair.        p
-000102e0: 316e 6f64 6520 3d20 7365 6c66 2e64 6972  1node = self.dir
-000102f0: 7374 6174 652e 7031 2829 0a20 2020 2020  state.p1().     
-00010300: 2020 2069 6620 7031 6e6f 6465 2021 3d20     if p1node != 
-00010310: 7365 6c66 2e6e 756c 6c69 643a 0a20 2020  self.nullid:.   
-00010320: 2020 2020 2020 2020 2071 7569 636b 5b62           quick[b
-00010330: 272e 275d 203d 2071 7569 636b 5b70 316e  '.'] = quick[p1n
-00010340: 6f64 655d 0a20 2020 2020 2020 2072 6574  ode].        ret
-00010350: 7572 6e20 7175 6963 6b0a 0a20 2020 2040  urn quick..    @
-00010360: 756e 6669 6c74 6572 6564 6d65 7468 6f64  unfilteredmethod
-00010370: 0a20 2020 2064 6566 205f 7175 6963 6b5f  .    def _quick_
-00010380: 6163 6365 7373 5f63 6861 6e67 6569 645f  access_changeid_
-00010390: 696e 7661 6c69 6461 7465 2873 656c 6629  invalidate(self)
-000103a0: 3a0a 2020 2020 2020 2020 6966 2027 5f71  :.        if '_q
-000103b0: 7569 636b 5f61 6363 6573 735f 6368 616e  uick_access_chan
-000103c0: 6765 6964 5f77 6327 2069 6e20 7661 7273  geid_wc' in vars
-000103d0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000103e0: 2020 2020 6465 6c20 7365 6c66 2e5f 5f64      del self.__d
-000103f0: 6963 745f 5f5b 275f 7175 6963 6b5f 6163  ict__['_quick_ac
-00010400: 6365 7373 5f63 6861 6e67 6569 645f 7763  cess_changeid_wc
-00010410: 275d 0a0a 2020 2020 4070 726f 7065 7274  ']..    @propert
-00010420: 790a 2020 2020 6465 6620 5f71 7569 636b  y.    def _quick
-00010430: 5f61 6363 6573 735f 6368 616e 6765 6964  _access_changeid
-00010440: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00010450: 2222 2261 6e20 6865 6c70 6572 2064 6963  """an helper dic
-00010460: 7469 6f6e 6e61 7279 2066 6f72 205f 5f67  tionnary for __g
-00010470: 6574 6974 656d 5f5f 2063 616c 6c73 0a0a  etitem__ calls..
-00010480: 2020 2020 2020 2020 5468 6973 2063 6f6e          This con
-00010490: 7461 696e 7320 6120 6c69 7374 206f 6620  tains a list of 
-000104a0: 7379 6d62 6f6c 2077 6520 6361 6e20 7265  symbol we can re
-000104b0: 636f 676e 6973 6520 7269 6768 7420 6177  cognise right aw
-000104c0: 6179 2077 6974 686f 7574 0a20 2020 2020  ay without.     
-000104d0: 2020 2066 7572 7468 6572 2070 726f 6365     further proce
-000104e0: 7373 696e 672e 0a20 2020 2020 2020 2022  ssing..        "
-000104f0: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
-00010500: 6c66 2e66 696c 7465 726e 616d 6520 696e  lf.filtername in
-00010510: 2072 6570 6f76 6965 772e 6669 6c74 6572   repoview.filter
-00010520: 5f68 6173 5f77 633a 0a20 2020 2020 2020  _has_wc:.       
-00010530: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00010540: 2e5f 7175 6963 6b5f 6163 6365 7373 5f63  ._quick_access_c
-00010550: 6861 6e67 6569 645f 7763 0a20 2020 2020  hangeid_wc.     
-00010560: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00010570: 7175 6963 6b5f 6163 6365 7373 5f63 6861  quick_access_cha
-00010580: 6e67 6569 645f 6e75 6c6c 0a0a 2020 2020  ngeid_null..    
-00010590: 6465 6620 5f5f 6765 7469 7465 6d5f 5f28  def __getitem__(
-000105a0: 7365 6c66 2c20 6368 616e 6765 6964 293a  self, changeid):
-000105b0: 0a20 2020 2020 2020 2023 2064 6561 6c69  .        # deali
-000105c0: 6e67 2077 6974 6820 7370 6563 6961 6c20  ng with special 
-000105d0: 6361 7365 730a 2020 2020 2020 2020 6966  cases.        if
-000105e0: 2063 6861 6e67 6569 6420 6973 204e 6f6e   changeid is Non
-000105f0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00010600: 6574 7572 6e20 636f 6e74 6578 742e 776f  eturn context.wo
-00010610: 726b 696e 6763 7478 2873 656c 6629 0a20  rkingctx(self). 
-00010620: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00010630: 616e 6365 2863 6861 6e67 6569 642c 2063  ance(changeid, c
-00010640: 6f6e 7465 7874 2e62 6173 6563 7478 293a  ontext.basectx):
-00010650: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00010660: 7572 6e20 6368 616e 6765 6964 0a0a 2020  urn changeid..  
-00010670: 2020 2020 2020 2320 6465 616c 696e 6720        # dealing 
-00010680: 7769 7468 206d 756c 7469 706c 6520 7265  with multiple re
-00010690: 7669 7369 6f6e 730a 2020 2020 2020 2020  visions.        
-000106a0: 6966 2069 7369 6e73 7461 6e63 6528 6368  if isinstance(ch
-000106b0: 616e 6765 6964 2c20 736c 6963 6529 3a0a  angeid, slice):.
-000106c0: 2020 2020 2020 2020 2020 2020 2320 7764              # wd
-000106d0: 6972 7265 7620 6973 6e27 7420 636f 6e74  irrev isn't cont
-000106e0: 6967 756f 7573 2073 6f20 7468 6520 736c  iguous so the sl
-000106f0: 6963 6520 7368 6f75 6c64 6e27 7420 696e  ice shouldn't in
-00010700: 636c 7564 6520 6974 0a20 2020 2020 2020  clude it.       
-00010710: 2020 2020 2072 6574 7572 6e20 5b0a 2020       return [.  
-00010720: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00010730: 6c66 5b69 5d0a 2020 2020 2020 2020 2020  lf[i].          
-00010740: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00010750: 616e 6765 282a 6368 616e 6765 6964 2e69  ange(*changeid.i
-00010760: 6e64 6963 6573 286c 656e 2873 656c 6629  ndices(len(self)
-00010770: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00010780: 2020 2069 6620 6920 6e6f 7420 696e 2073     if i not in s
-00010790: 656c 662e 6368 616e 6765 6c6f 672e 6669  elf.changelog.fi
-000107a0: 6c74 6572 6564 7265 7673 0a20 2020 2020  lteredrevs.     
-000107b0: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
-000107c0: 2020 2320 6465 616c 696e 6720 7769 7468    # dealing with
-000107d0: 2073 6f6d 6520 7370 6563 6961 6c20 7661   some special va
-000107e0: 6c75 6573 0a20 2020 2020 2020 2071 7569  lues.        qui
-000107f0: 636b 5f61 6363 6573 7320 3d20 7365 6c66  ck_access = self
-00010800: 2e5f 7175 6963 6b5f 6163 6365 7373 5f63  ._quick_access_c
-00010810: 6861 6e67 6569 642e 6765 7428 6368 616e  hangeid.get(chan
-00010820: 6765 6964 290a 2020 2020 2020 2020 6966  geid).        if
-00010830: 2071 7569 636b 5f61 6363 6573 7320 6973   quick_access is
-00010840: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00010850: 2020 2020 2020 2072 6576 2c20 6e6f 6465         rev, node
-00010860: 203d 2071 7569 636b 5f61 6363 6573 730a   = quick_access.
-00010870: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00010880: 726e 2063 6f6e 7465 7874 2e63 6861 6e67  rn context.chang
-00010890: 6563 7478 2873 656c 662c 2072 6576 2c20  ectx(self, rev, 
-000108a0: 6e6f 6465 2c20 6d61 7962 655f 6669 6c74  node, maybe_filt
-000108b0: 6572 6564 3d46 616c 7365 290a 2020 2020  ered=False).    
-000108c0: 2020 2020 6966 2063 6861 6e67 6569 6420      if changeid 
-000108d0: 3d3d 2062 2774 6970 273a 0a20 2020 2020  == b'tip':.     
-000108e0: 2020 2020 2020 206e 6f64 6520 3d20 7365         node = se
-000108f0: 6c66 2e63 6861 6e67 656c 6f67 2e74 6970  lf.changelog.tip
-00010900: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
-00010910: 6576 203d 2073 656c 662e 6368 616e 6765  ev = self.change
-00010920: 6c6f 672e 7265 7628 6e6f 6465 290a 2020  log.rev(node).  
-00010930: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00010940: 2063 6f6e 7465 7874 2e63 6861 6e67 6563   context.changec
-00010950: 7478 2873 656c 662c 2072 6576 2c20 6e6f  tx(self, rev, no
-00010960: 6465 290a 0a20 2020 2020 2020 2023 2064  de)..        # d
-00010970: 6561 6c69 6e67 2077 6974 6820 6172 6269  ealing with arbi
-00010980: 7472 6172 7920 7661 6c75 6573 0a20 2020  trary values.   
-00010990: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-000109a0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-000109b0: 6e63 6528 6368 616e 6765 6964 2c20 696e  nce(changeid, in
-000109c0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-000109d0: 2020 2020 6e6f 6465 203d 2073 656c 662e      node = self.
-000109e0: 6368 616e 6765 6c6f 672e 6e6f 6465 2863  changelog.node(c
-000109f0: 6861 6e67 6569 6429 0a20 2020 2020 2020  hangeid).       
-00010a00: 2020 2020 2020 2020 2072 6576 203d 2063           rev = c
-00010a10: 6861 6e67 6569 640a 2020 2020 2020 2020  hangeid.        
-00010a20: 2020 2020 656c 6966 2063 6861 6e67 6569      elif changei
-00010a30: 6420 3d3d 2062 272e 273a 0a20 2020 2020  d == b'.':.     
-00010a40: 2020 2020 2020 2020 2020 2023 2074 6869             # thi
-00010a50: 7320 6973 2061 2068 6163 6b20 746f 2064  s is a hack to d
-00010a60: 656c 6179 2f61 766f 6964 206c 6f61 6469  elay/avoid loadi
-00010a70: 6e67 206f 6273 6d61 726b 6572 730a 2020  ng obsmarkers.  
-00010a80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00010a90: 7768 656e 2077 6520 6b6e 6f77 2074 6861  when we know tha
-00010aa0: 7420 272e 2720 776f 6e27 7420 6265 2068  t '.' won't be h
-00010ab0: 6964 6465 6e0a 2020 2020 2020 2020 2020  idden.          
-00010ac0: 2020 2020 2020 6e6f 6465 203d 2073 656c        node = sel
-00010ad0: 662e 6469 7273 7461 7465 2e70 3128 290a  f.dirstate.p1().
-00010ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010af0: 7265 7620 3d20 7365 6c66 2e75 6e66 696c  rev = self.unfil
-00010b00: 7465 7265 6428 292e 6368 616e 6765 6c6f  tered().changelo
-00010b10: 672e 7265 7628 6e6f 6465 290a 2020 2020  g.rev(node).    
-00010b20: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
-00010b30: 2863 6861 6e67 6569 6429 203d 3d20 7365  (changeid) == se
-00010b40: 6c66 2e6e 6f64 6563 6f6e 7374 616e 7473  lf.nodeconstants
-00010b50: 2e6e 6f64 656c 656e 3a0a 2020 2020 2020  .nodelen:.      
-00010b60: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00010b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b80: 2020 206e 6f64 6520 3d20 6368 616e 6765     node = change
-00010b90: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
-00010ba0: 2020 2020 2020 2072 6576 203d 2073 656c         rev = sel
-00010bb0: 662e 6368 616e 6765 6c6f 672e 7265 7628  f.changelog.rev(
-00010bc0: 6368 616e 6765 6964 290a 2020 2020 2020  changeid).      
-00010bd0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00010be0: 2065 7272 6f72 2e46 696c 7465 7265 644c   error.FilteredL
-00010bf0: 6f6f 6b75 7045 7272 6f72 3a0a 2020 2020  ookupError:.    
-00010c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c10: 6368 616e 6765 6964 203d 2068 6578 2863  changeid = hex(c
-00010c20: 6861 6e67 6569 6429 2020 2320 666f 7220  hangeid)  # for 
-00010c30: 7468 6520 6572 726f 7220 6d65 7373 6167  the error messag
-00010c40: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00010c50: 2020 2020 2020 7261 6973 650a 2020 2020        raise.    
-00010c60: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00010c70: 7074 204c 6f6f 6b75 7045 7272 6f72 3a0a  pt LookupError:.
-00010c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c90: 2020 2020 2320 6368 6563 6b20 6966 2069      # check if i
-00010ca0: 7420 6d69 6768 7420 6861 7665 2063 6f6d  t might have com
-00010cb0: 6520 6672 6f6d 2064 616d 6167 6564 2064  e from damaged d
-00010cc0: 6972 7374 6174 650a 2020 2020 2020 2020  irstate.        
-00010cd0: 2020 2020 2020 2020 2020 2020 230a 2020              #.  
-00010ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010cf0: 2020 2320 5858 5820 7765 2063 6f75 6c64    # XXX we could
-00010d00: 2061 766f 6964 2074 6865 2075 6e66 696c   avoid the unfil
-00010d10: 7465 7265 6420 6966 2077 6520 6861 6420  tered if we had 
-00010d20: 6120 7265 636f 676e 697a 6162 6c65 0a20  a recognizable. 
-00010d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d40: 2020 2023 2065 7863 6570 7469 6f6e 2066     # exception f
-00010d50: 6f72 2066 696c 7465 7265 6420 6368 616e  or filtered chan
-00010d60: 6765 7365 7420 6163 6365 7373 0a20 2020  geset access.   
-00010d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d80: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
-00010d90: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00010da0: 6c66 2e6c 6f63 616c 2829 0a20 2020 2020  lf.local().     
-00010db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010dc0: 2020 2061 6e64 2063 6861 6e67 6569 6420     and changeid 
-00010dd0: 696e 2073 656c 662e 756e 6669 6c74 6572  in self.unfilter
-00010de0: 6564 2829 2e64 6972 7374 6174 652e 7061  ed().dirstate.pa
-00010df0: 7265 6e74 7328 290a 2020 2020 2020 2020  rents().        
-00010e00: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-00010e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e20: 2020 2020 2020 206d 7367 203d 205f 2862         msg = _(b
-00010e30: 2277 6f72 6b69 6e67 2064 6972 6563 746f  "working directo
-00010e40: 7279 2068 6173 2075 6e6b 6e6f 776e 2070  ry has unknown p
-00010e50: 6172 656e 7420 2725 7327 2122 290a 2020  arent '%s'!").  
-00010e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e70: 2020 2020 2020 7261 6973 6520 6572 726f        raise erro
-00010e80: 722e 4162 6f72 7428 6d73 6720 2520 7368  r.Abort(msg % sh
-00010e90: 6f72 7428 6368 616e 6765 6964 2929 0a20  ort(changeid)). 
-00010ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010eb0: 2020 2063 6861 6e67 6569 6420 3d20 6865     changeid = he
-00010ec0: 7828 6368 616e 6765 6964 2920 2023 2066  x(changeid)  # f
-00010ed0: 6f72 2074 6865 2065 7272 6f72 206d 6573  or the error mes
-00010ee0: 7361 6765 0a20 2020 2020 2020 2020 2020  sage.           
-00010ef0: 2020 2020 2020 2020 2072 6169 7365 0a0a           raise..
-00010f00: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00010f10: 206c 656e 2863 6861 6e67 6569 6429 203d   len(changeid) =
-00010f20: 3d20 3220 2a20 7365 6c66 2e6e 6f64 6563  = 2 * self.nodec
-00010f30: 6f6e 7374 616e 7473 2e6e 6f64 656c 656e  onstants.nodelen
-00010f40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010f50: 2020 6e6f 6465 203d 2062 696e 2863 6861    node = bin(cha
-00010f60: 6e67 6569 6429 0a20 2020 2020 2020 2020  ngeid).         
-00010f70: 2020 2020 2020 2072 6576 203d 2073 656c         rev = sel
-00010f80: 662e 6368 616e 6765 6c6f 672e 7265 7628  f.changelog.rev(
-00010f90: 6e6f 6465 290a 2020 2020 2020 2020 2020  node).          
-00010fa0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00010fb0: 2020 2020 2020 2020 7261 6973 6520 6572          raise er
-00010fc0: 726f 722e 5072 6f67 7261 6d6d 696e 6745  ror.ProgrammingE
-00010fd0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00010fe0: 2020 2020 2020 2020 2020 6222 756e 7375            b"unsu
-00010ff0: 7070 6f72 7465 6420 6368 616e 6765 6964  pported changeid
-00011000: 2027 2573 2720 6f66 2074 7970 6520 2573   '%s' of type %s
-00011010: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00011020: 2020 2020 2020 2520 2863 6861 6e67 6569        % (changei
-00011030: 642c 2070 7963 6f6d 7061 742e 6279 7465  d, pycompat.byte
-00011040: 7374 7228 7479 7065 2863 6861 6e67 6569  str(type(changei
-00011050: 6429 2929 0a20 2020 2020 2020 2020 2020  d))).           
-00011060: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00011070: 2020 2020 7265 7475 726e 2063 6f6e 7465      return conte
-00011080: 7874 2e63 6861 6e67 6563 7478 2873 656c  xt.changectx(sel
-00011090: 662c 2072 6576 2c20 6e6f 6465 290a 0a20  f, rev, node).. 
-000110a0: 2020 2020 2020 2065 7863 6570 7420 2865         except (e
-000110b0: 7272 6f72 2e46 696c 7465 7265 6449 6e64  rror.FilteredInd
-000110c0: 6578 4572 726f 722c 2065 7272 6f72 2e46  exError, error.F
-000110d0: 696c 7465 7265 644c 6f6f 6b75 7045 7272  ilteredLookupErr
-000110e0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-000110f0: 2072 6169 7365 2065 7272 6f72 2e46 696c   raise error.Fil
-00011100: 7465 7265 6452 6570 6f4c 6f6f 6b75 7045  teredRepoLookupE
-00011110: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00011120: 2020 2020 2020 5f28 6222 6669 6c74 6572        _(b"filter
-00011130: 6564 2072 6576 6973 696f 6e20 2725 7327  ed revision '%s'
-00011140: 2229 2025 2070 7963 6f6d 7061 742e 6279  ") % pycompat.by
-00011150: 7465 7374 7228 6368 616e 6765 6964 290a  testr(changeid).
-00011160: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00011170: 2020 2020 2020 6578 6365 7074 2028 496e        except (In
-00011180: 6465 7845 7272 6f72 2c20 4c6f 6f6b 7570  dexError, Lookup
-00011190: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-000111a0: 2020 2020 7261 6973 6520 6572 726f 722e      raise error.
-000111b0: 5265 706f 4c6f 6f6b 7570 4572 726f 7228  RepoLookupError(
-000111c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000111d0: 205f 2862 2275 6e6b 6e6f 776e 2072 6576   _(b"unknown rev
-000111e0: 6973 696f 6e20 2725 7327 2229 2025 2070  ision '%s'") % p
-000111f0: 7963 6f6d 7061 742e 6279 7465 7374 7228  ycompat.bytestr(
-00011200: 6368 616e 6765 6964 290a 2020 2020 2020  changeid).      
-00011210: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00011220: 6578 6365 7074 2065 7272 6f72 2e57 6469  except error.Wdi
-00011230: 7255 6e73 7570 706f 7274 6564 3a0a 2020  rUnsupported:.  
-00011240: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00011250: 2063 6f6e 7465 7874 2e77 6f72 6b69 6e67   context.working
-00011260: 6374 7828 7365 6c66 290a 0a20 2020 2064  ctx(self)..    d
-00011270: 6566 205f 5f63 6f6e 7461 696e 735f 5f28  ef __contains__(
-00011280: 7365 6c66 2c20 6368 616e 6765 6964 293a  self, changeid):
-00011290: 0a20 2020 2020 2020 2022 2222 5472 7565  .        """True
-000112a0: 2069 6620 7468 6520 6769 7665 6e20 6368   if the given ch
-000112b0: 616e 6765 6964 2065 7869 7374 7322 2222  angeid exists"""
-000112c0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-000112d0: 2020 2020 2020 2020 2020 7365 6c66 5b63            self[c
-000112e0: 6861 6e67 6569 645d 0a20 2020 2020 2020  hangeid].       
-000112f0: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00011300: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00011310: 6572 726f 722e 5265 706f 4c6f 6f6b 7570  error.RepoLookup
-00011320: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-00011330: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-00011340: 0a20 2020 2064 6566 205f 5f6e 6f6e 7a65  .    def __nonze
-00011350: 726f 5f5f 2873 656c 6629 3a0a 2020 2020  ro__(self):.    
-00011360: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
-00011370: 0a20 2020 205f 5f62 6f6f 6c5f 5f20 3d20  .    __bool__ = 
-00011380: 5f5f 6e6f 6e7a 6572 6f5f 5f0a 0a20 2020  __nonzero__..   
-00011390: 2064 6566 205f 5f6c 656e 5f5f 2873 656c   def __len__(sel
-000113a0: 6629 3a0a 2020 2020 2020 2020 2320 6e6f  f):.        # no
-000113b0: 206e 6565 6420 746f 2070 6179 2074 6865   need to pay the
-000113c0: 2063 6f73 7420 6f66 2072 6570 6f76 6965   cost of repovie
-000113d0: 772e 6368 616e 6765 6c6f 670a 2020 2020  w.changelog.    
-000113e0: 2020 2020 756e 6669 203d 2073 656c 662e      unfi = self.
-000113f0: 756e 6669 6c74 6572 6564 2829 0a20 2020  unfiltered().   
-00011400: 2020 2020 2072 6574 7572 6e20 6c65 6e28       return len(
-00011410: 756e 6669 2e63 6861 6e67 656c 6f67 290a  unfi.changelog).
-00011420: 0a20 2020 2064 6566 205f 5f69 7465 725f  .    def __iter_
-00011430: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-00011440: 2072 6574 7572 6e20 6974 6572 2873 656c   return iter(sel
-00011450: 662e 6368 616e 6765 6c6f 6729 0a0a 2020  f.changelog)..  
-00011460: 2020 6465 6620 7265 7673 2873 656c 662c    def revs(self,
-00011470: 2065 7870 723a 2062 7974 6573 2c20 2a61   expr: bytes, *a
-00011480: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
-00011490: 2246 696e 6420 7265 7669 7369 6f6e 7320  "Find revisions 
-000114a0: 6d61 7463 6869 6e67 2061 2072 6576 7365  matching a revse
-000114b0: 742e 0a0a 2020 2020 2020 2020 5468 6520  t...        The 
-000114c0: 7265 7673 6574 2069 7320 7370 6563 6966  revset is specif
-000114d0: 6965 6420 6173 2061 2073 7472 696e 6720  ied as a string 
-000114e0: 6060 6578 7072 6060 2074 6861 7420 6d61  ``expr`` that ma
-000114f0: 7920 636f 6e74 6169 6e0a 2020 2020 2020  y contain.      
-00011500: 2020 252d 666f 726d 6174 7469 6e67 2074    %-formatting t
-00011510: 6f20 6573 6361 7065 2063 6572 7461 696e  o escape certain
-00011520: 2074 7970 6573 2e20 5365 6520 6060 7265   types. See ``re
-00011530: 7673 6574 6c61 6e67 2e66 6f72 6d61 7473  vsetlang.formats
-00011540: 7065 6360 602e 0a0a 2020 2020 2020 2020  pec``...        
-00011550: 5265 7673 6574 2061 6c69 6173 6573 2066  Revset aliases f
-00011560: 726f 6d20 7468 6520 636f 6e66 6967 7572  rom the configur
-00011570: 6174 696f 6e20 6172 6520 6e6f 7420 6578  ation are not ex
-00011580: 7061 6e64 6564 2e20 546f 2065 7870 616e  panded. To expan
-00011590: 640a 2020 2020 2020 2020 7573 6572 2061  d.        user a
-000115a0: 6c69 6173 6573 2c20 636f 6e73 6964 6572  liases, consider
-000115b0: 2063 616c 6c69 6e67 2060 6073 636d 7574   calling ``scmut
-000115c0: 696c 2e72 6576 7261 6e67 6528 2960 6020  il.revrange()`` 
-000115d0: 6f72 0a20 2020 2020 2020 2060 6072 6570  or.        ``rep
-000115e0: 6f2e 616e 7972 6576 7328 5b65 7870 725d  o.anyrevs([expr]
-000115f0: 2c20 7573 6572 3d54 7275 6529 6060 2e0a  , user=True)``..
-00011600: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00011610: 2061 2073 6d61 7274 7365 742e 6162 7374   a smartset.abst
-00011620: 7261 6374 736d 6172 7473 6574 2c20 7768  ractsmartset, wh
-00011630: 6963 6820 6973 2061 206c 6973 742d 6c69  ich is a list-li
-00011640: 6b65 2069 6e74 6572 6661 6365 0a20 2020  ke interface.   
-00011650: 2020 2020 2074 6861 7420 636f 6e74 6169       that contai
-00011660: 6e73 2069 6e74 6567 6572 2072 6576 6973  ns integer revis
-00011670: 696f 6e73 2e0a 2020 2020 2020 2020 2222  ions..        ""
-00011680: 220a 2020 2020 2020 2020 7472 6565 203d  ".        tree =
-00011690: 2072 6576 7365 746c 616e 672e 7370 6563   revsetlang.spec
-000116a0: 7472 6565 2865 7870 722c 202a 6172 6773  tree(expr, *args
-000116b0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000116c0: 2072 6576 7365 742e 6d61 6b65 6d61 7463   revset.makematc
-000116d0: 6865 7228 7472 6565 2928 7365 6c66 290a  her(tree)(self).
-000116e0: 0a20 2020 2064 6566 2073 6574 2873 656c  .    def set(sel
-000116f0: 662c 2065 7870 723a 2062 7974 6573 2c20  f, expr: bytes, 
-00011700: 2a61 7267 7329 3a0a 2020 2020 2020 2020  *args):.        
-00011710: 2222 2246 696e 6420 7265 7669 7369 6f6e  """Find revision
-00011720: 7320 6d61 7463 6869 6e67 2061 2072 6576  s matching a rev
-00011730: 7365 7420 616e 6420 656d 6974 2063 6861  set and emit cha
-00011740: 6e67 6563 7478 2069 6e73 7461 6e63 6573  ngectx instances
-00011750: 2e0a 0a20 2020 2020 2020 2054 6869 7320  ...        This 
-00011760: 6973 2061 2063 6f6e 7665 6e69 656e 6365  is a convenience
-00011770: 2077 7261 7070 6572 2061 726f 756e 6420   wrapper around 
-00011780: 6060 7265 7673 2829 6060 2074 6861 7420  ``revs()`` that 
-00011790: 6974 6572 6174 6573 2074 6865 0a20 2020  iterates the.   
-000117a0: 2020 2020 2072 6573 756c 7420 616e 6420       result and 
-000117b0: 6973 2061 2067 656e 6572 6174 6f72 206f  is a generator o
-000117c0: 6620 6368 616e 6765 6374 7820 696e 7374  f changectx inst
-000117d0: 616e 6365 732e 0a0a 2020 2020 2020 2020  ances...        
-000117e0: 5265 7673 6574 2061 6c69 6173 6573 2066  Revset aliases f
-000117f0: 726f 6d20 7468 6520 636f 6e66 6967 7572  rom the configur
-00011800: 6174 696f 6e20 6172 6520 6e6f 7420 6578  ation are not ex
-00011810: 7061 6e64 6564 2e20 546f 2065 7870 616e  panded. To expan
-00011820: 640a 2020 2020 2020 2020 7573 6572 2061  d.        user a
-00011830: 6c69 6173 6573 2c20 636f 6e73 6964 6572  liases, consider
-00011840: 2063 616c 6c69 6e67 2060 6073 636d 7574   calling ``scmut
-00011850: 696c 2e72 6576 7261 6e67 6528 2960 602e  il.revrange()``.
-00011860: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00011870: 2020 2020 2066 6f72 2072 2069 6e20 7365       for r in se
-00011880: 6c66 2e72 6576 7328 6578 7072 2c20 2a61  lf.revs(expr, *a
-00011890: 7267 7329 3a0a 2020 2020 2020 2020 2020  rgs):.          
-000118a0: 2020 7969 656c 6420 7365 6c66 5b72 5d0a    yield self[r].
-000118b0: 0a20 2020 2064 6566 2061 6e79 7265 7673  .    def anyrevs
-000118c0: 2873 656c 662c 2073 7065 6373 3a20 6279  (self, specs: by
-000118d0: 7465 732c 2075 7365 723d 4661 6c73 652c  tes, user=False,
-000118e0: 206c 6f63 616c 616c 6961 733d 4e6f 6e65   localalias=None
-000118f0: 293a 0a20 2020 2020 2020 2022 2222 4669  ):.        """Fi
-00011900: 6e64 2072 6576 6973 696f 6e73 206d 6174  nd revisions mat
-00011910: 6368 696e 6720 6f6e 6520 6f66 2074 6865  ching one of the
-00011920: 2067 6976 656e 2072 6576 7365 7473 2e0a   given revsets..
-00011930: 0a20 2020 2020 2020 2052 6576 7365 7420  .        Revset 
-00011940: 616c 6961 7365 7320 6672 6f6d 2074 6865  aliases from the
-00011950: 2063 6f6e 6669 6775 7261 7469 6f6e 2061   configuration a
-00011960: 7265 206e 6f74 2065 7870 616e 6465 6420  re not expanded 
-00011970: 6279 2064 6566 6175 6c74 2e20 546f 0a20  by default. To. 
-00011980: 2020 2020 2020 2065 7870 616e 6420 7573         expand us
-00011990: 6572 2061 6c69 6173 6573 2c20 7370 6563  er aliases, spec
-000119a0: 6966 7920 6060 7573 6572 3d54 7275 6560  ify ``user=True`
-000119b0: 602e 2054 6f20 7072 6f76 6964 6520 736f  `. To provide so
-000119c0: 6d65 206c 6f63 616c 0a20 2020 2020 2020  me local.       
-000119d0: 2064 6566 696e 6974 696f 6e73 206f 7665   definitions ove
-000119e0: 7272 6964 696e 6720 7573 6572 2061 6c69  rriding user ali
-000119f0: 6173 6573 2c20 7365 7420 6060 6c6f 6361  ases, set ``loca
-00011a00: 6c61 6c69 6173 6060 2074 6f0a 2020 2020  lalias`` to.    
-00011a10: 2020 2020 6060 7b6e 616d 653a 2064 6566      ``{name: def
-00011a20: 696e 6974 696f 6e73 7472 696e 677d 6060  initionstring}``
-00011a30: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00011a40: 2020 2020 2020 6966 2073 7065 6373 203d        if specs =
-00011a50: 3d20 5b62 276e 756c 6c27 5d3a 0a20 2020  = [b'null']:.   
-00011a60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00011a70: 7265 7673 6574 2e62 6173 6573 6574 285b  revset.baseset([
-00011a80: 6e75 6c6c 7265 765d 290a 2020 2020 2020  nullrev]).      
-00011a90: 2020 6966 2073 7065 6373 203d 3d20 5b62    if specs == [b
-00011aa0: 272e 275d 3a0a 2020 2020 2020 2020 2020  '.']:.          
-00011ab0: 2020 7175 6963 6b5f 6461 7461 203d 2073    quick_data = s
-00011ac0: 656c 662e 5f71 7569 636b 5f61 6363 6573  elf._quick_acces
-00011ad0: 735f 6368 616e 6765 6964 2e67 6574 2862  s_changeid.get(b
-00011ae0: 272e 2729 0a20 2020 2020 2020 2020 2020  '.').           
-00011af0: 2069 6620 7175 6963 6b5f 6461 7461 2069   if quick_data i
-00011b00: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00011b10: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00011b20: 726e 2072 6576 7365 742e 6261 7365 7365  rn revset.basese
-00011b30: 7428 5b71 7569 636b 5f64 6174 615b 305d  t([quick_data[0]
-00011b40: 5d29 0a20 2020 2020 2020 2069 6620 7573  ]).        if us
-00011b50: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00011b60: 6d20 3d20 7265 7673 6574 2e6d 6174 6368  m = revset.match
-00011b70: 616e 7928 0a20 2020 2020 2020 2020 2020  any(.           
-00011b80: 2020 2020 2073 656c 662e 7569 2c0a 2020       self.ui,.  
-00011b90: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-00011ba0: 6563 732c 0a20 2020 2020 2020 2020 2020  ecs,.           
-00011bb0: 2020 2020 206c 6f6f 6b75 703d 7265 7673       lookup=revs
-00011bc0: 6574 2e6c 6f6f 6b75 7066 6e28 7365 6c66  et.lookupfn(self
-00011bd0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00011be0: 2020 206c 6f63 616c 616c 6961 733d 6c6f     localalias=lo
-00011bf0: 6361 6c61 6c69 6173 2c0a 2020 2020 2020  calalias,.      
-00011c00: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00011c10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00011c20: 2020 6d20 3d20 7265 7673 6574 2e6d 6174    m = revset.mat
-00011c30: 6368 616e 7928 4e6f 6e65 2c20 7370 6563  chany(None, spec
-00011c40: 732c 206c 6f63 616c 616c 6961 733d 6c6f  s, localalias=lo
-00011c50: 6361 6c61 6c69 6173 290a 2020 2020 2020  calalias).      
-00011c60: 2020 7265 7475 726e 206d 2873 656c 6629    return m(self)
-00011c70: 0a0a 2020 2020 6465 6620 7572 6c28 7365  ..    def url(se
-00011c80: 6c66 2920 2d3e 2062 7974 6573 3a0a 2020  lf) -> bytes:.  
-00011c90: 2020 2020 2020 7265 7475 726e 2062 2766        return b'f
-00011ca0: 696c 653a 2720 2b20 7365 6c66 2e72 6f6f  ile:' + self.roo
-00011cb0: 740a 0a20 2020 2064 6566 2068 6f6f 6b28  t..    def hook(
-00011cc0: 7365 6c66 2c20 6e61 6d65 2c20 7468 726f  self, name, thro
-00011cd0: 773d 4661 6c73 652c 202a 2a61 7267 7329  w=False, **args)
-00011ce0: 3a0a 2020 2020 2020 2020 2222 2243 616c  :.        """Cal
-00011cf0: 6c20 6120 686f 6f6b 2c20 7061 7373 696e  l a hook, passin
-00011d00: 6720 7468 6973 2072 6570 6f20 696e 7374  g this repo inst
-00011d10: 616e 6365 2e0a 0a20 2020 2020 2020 2054  ance...        T
-00011d20: 6869 7320 6120 636f 6e76 656e 6965 6e63  his a convenienc
-00011d30: 6520 6d65 7468 6f64 2074 6f20 6169 6420  e method to aid 
-00011d40: 696e 766f 6b69 6e67 2068 6f6f 6b73 2e20  invoking hooks. 
-00011d50: 4578 7465 6e73 696f 6e73 206c 696b 656c  Extensions likel
-00011d60: 790a 2020 2020 2020 2020 776f 6e27 7420  y.        won't 
-00011d70: 6361 6c6c 2074 6869 7320 756e 6c65 7373  call this unless
-00011d80: 2074 6865 7920 6861 7665 2072 6567 6973   they have regis
-00011d90: 7465 7265 6420 6120 6375 7374 6f6d 2068  tered a custom h
-00011da0: 6f6f 6b20 6f72 2061 7265 0a20 2020 2020  ook or are.     
-00011db0: 2020 2072 6570 6c61 6369 6e67 2063 6f64     replacing cod
-00011dc0: 6520 7468 6174 2069 7320 6578 7065 6374  e that is expect
-00011dd0: 6564 2074 6f20 6361 6c6c 2061 2068 6f6f  ed to call a hoo
-00011de0: 6b2e 0a20 2020 2020 2020 2022 2222 0a20  k..        """. 
-00011df0: 2020 2020 2020 2072 6574 7572 6e20 686f         return ho
-00011e00: 6f6b 2e68 6f6f 6b28 7365 6c66 2e75 692c  ok.hook(self.ui,
-00011e10: 2073 656c 662c 206e 616d 652c 2074 6872   self, name, thr
-00011e20: 6f77 2c20 2a2a 6172 6773 290a 0a20 2020  ow, **args)..   
-00011e30: 2040 6669 6c74 6572 6564 7072 6f70 6572   @filteredproper
-00011e40: 7479 6361 6368 650a 2020 2020 6465 6620  tycache.    def 
-00011e50: 5f74 6167 7363 6163 6865 2873 656c 6629  _tagscache(self)
-00011e60: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00011e70: 7572 6e73 2061 2074 6167 7363 6163 6865  urns a tagscache
-00011e80: 206f 626a 6563 7420 7468 6174 2063 6f6e   object that con
-00011e90: 7461 696e 7320 7661 7269 6f75 7320 7461  tains various ta
-00011ea0: 6773 2072 656c 6174 6564 0a20 2020 2020  gs related.     
-00011eb0: 2020 2063 6163 6865 732e 2222 220a 0a20     caches.""".. 
-00011ec0: 2020 2020 2020 2023 2054 6869 7320 7369         # This si
-00011ed0: 6d70 6c69 6669 6573 2069 7473 2063 6163  mplifies its cac
-00011ee0: 6865 206d 616e 6167 656d 656e 7420 6279  he management by
-00011ef0: 2068 6176 696e 6720 6f6e 6520 6465 636f   having one deco
-00011f00: 7261 7465 640a 2020 2020 2020 2020 2320  rated.        # 
-00011f10: 6675 6e63 7469 6f6e 2028 7468 6973 206f  function (this o
-00011f20: 6e65 2920 616e 6420 7468 6520 7265 7374  ne) and the rest
-00011f30: 2073 696d 706c 7920 6665 7463 6820 7468   simply fetch th
-00011f40: 696e 6773 2066 726f 6d20 6974 2e0a 2020  ings from it..  
-00011f50: 2020 2020 2020 636c 6173 7320 7461 6773        class tags
-00011f60: 6361 6368 653a 0a20 2020 2020 2020 2020  cache:.         
-00011f70: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00011f80: 7365 6c66 293a 0a20 2020 2020 2020 2020  self):.         
-00011f90: 2020 2020 2020 2023 2054 6865 7365 2074         # These t
-00011fa0: 776f 2064 6566 696e 6520 7468 6520 7365  wo define the se
-00011fb0: 7420 6f66 2074 6167 7320 666f 7220 7468  t of tags for th
-00011fc0: 6973 2072 6570 6f73 6974 6f72 792e 2074  is repository. t
-00011fd0: 6167 730a 2020 2020 2020 2020 2020 2020  ags.            
-00011fe0: 2020 2020 2320 6d61 7073 2074 6167 206e      # maps tag n
-00011ff0: 616d 6520 746f 206e 6f64 653b 2074 6167  ame to node; tag
-00012000: 7479 7065 7320 6d61 7073 2074 6167 206e  types maps tag n
-00012010: 616d 6520 746f 2027 676c 6f62 616c 2720  ame to 'global' 
-00012020: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
-00012030: 2020 2023 2027 6c6f 6361 6c27 2e20 2847     # 'local'. (G
-00012040: 6c6f 6261 6c20 7461 6773 2061 7265 2064  lobal tags are d
-00012050: 6566 696e 6564 2062 7920 2e68 6774 6167  efined by .hgtag
-00012060: 7320 6163 726f 7373 2061 6c6c 0a20 2020  s across all.   
-00012070: 2020 2020 2020 2020 2020 2020 2023 2068               # h
-00012080: 6561 6473 2c20 616e 6420 6c6f 6361 6c20  eads, and local 
-00012090: 7461 6773 2061 7265 2064 6566 696e 6564  tags are defined
-000120a0: 2069 6e20 2e68 672f 6c6f 6361 6c74 6167   in .hg/localtag
-000120b0: 732e 290a 2020 2020 2020 2020 2020 2020  s.).            
-000120c0: 2020 2020 2320 5468 6579 2063 6f6e 7374      # They const
-000120d0: 6974 7574 6520 7468 6520 696e 2d6d 656d  itute the in-mem
-000120e0: 6f72 7920 6361 6368 6520 6f66 2074 6167  ory cache of tag
-000120f0: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
-00012100: 2020 2073 656c 662e 7461 6773 203d 2073     self.tags = s
-00012110: 656c 662e 7461 6774 7970 6573 203d 204e  elf.tagtypes = N
-00012120: 6f6e 650a 0a20 2020 2020 2020 2020 2020  one..           
-00012130: 2020 2020 2073 656c 662e 6e6f 6465 7461       self.nodeta
-00012140: 6773 6361 6368 6520 3d20 7365 6c66 2e74  gscache = self.t
-00012150: 6167 736c 6973 7420 3d20 4e6f 6e65 0a0a  agslist = None..
-00012160: 2020 2020 2020 2020 6361 6368 6520 3d20          cache = 
-00012170: 7461 6773 6361 6368 6528 290a 2020 2020  tagscache().    
-00012180: 2020 2020 6361 6368 652e 7461 6773 2c20      cache.tags, 
-00012190: 6361 6368 652e 7461 6774 7970 6573 203d  cache.tagtypes =
-000121a0: 2073 656c 662e 5f66 696e 6474 6167 7328   self._findtags(
-000121b0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-000121c0: 6e20 6361 6368 650a 0a20 2020 2064 6566  n cache..    def
-000121d0: 2074 6167 7328 7365 6c66 293a 0a20 2020   tags(self):.   
-000121e0: 2020 2020 2027 2727 7265 7475 726e 2061       '''return a
-000121f0: 206d 6170 7069 6e67 206f 6620 7461 6720   mapping of tag 
-00012200: 746f 206e 6f64 6527 2727 0a20 2020 2020  to node'''.     
-00012210: 2020 2074 203d 207b 7d0a 2020 2020 2020     t = {}.      
-00012220: 2020 6966 2073 656c 662e 6368 616e 6765    if self.change
-00012230: 6c6f 672e 6669 6c74 6572 6564 7265 7673  log.filteredrevs
-00012240: 3a0a 2020 2020 2020 2020 2020 2020 7461  :.            ta
-00012250: 6773 2c20 7474 203d 2073 656c 662e 5f66  gs, tt = self._f
-00012260: 696e 6474 6167 7328 290a 2020 2020 2020  indtags().      
-00012270: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00012280: 2020 2020 7461 6773 203d 2073 656c 662e      tags = self.
-00012290: 5f74 6167 7363 6163 6865 2e74 6167 730a  _tagscache.tags.
-000122a0: 2020 2020 2020 2020 7265 7620 3d20 7365          rev = se
-000122b0: 6c66 2e63 6861 6e67 656c 6f67 2e72 6576  lf.changelog.rev
-000122c0: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
-000122d0: 7620 696e 2074 6167 732e 6974 656d 7328  v in tags.items(
-000122e0: 293a 0a20 2020 2020 2020 2020 2020 2074  ):.            t
-000122f0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00012300: 2020 2020 2320 6967 6e6f 7265 2074 6167      # ignore tag
-00012310: 7320 746f 2075 6e6b 6e6f 776e 206e 6f64  s to unknown nod
-00012320: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-00012330: 2020 2072 6576 2876 290a 2020 2020 2020     rev(v).      
-00012340: 2020 2020 2020 2020 2020 745b 6b5d 203d            t[k] =
-00012350: 2076 0a20 2020 2020 2020 2020 2020 2065   v.            e
-00012360: 7863 6570 7420 2865 7272 6f72 2e4c 6f6f  xcept (error.Loo
-00012370: 6b75 7045 7272 6f72 2c20 5661 6c75 6545  kupError, ValueE
-00012380: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
-00012390: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-000123a0: 2020 2020 7265 7475 726e 2074 0a0a 2020      return t..  
-000123b0: 2020 6465 6620 5f66 696e 6474 6167 7328    def _findtags(
-000123c0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-000123d0: 2222 446f 2074 6865 2068 6172 6420 776f  ""Do the hard wo
-000123e0: 726b 206f 6620 6669 6e64 696e 6720 7461  rk of finding ta
-000123f0: 6773 2e20 2052 6574 7572 6e20 6120 7061  gs.  Return a pa
-00012400: 6972 206f 6620 6469 6374 730a 2020 2020  ir of dicts.    
-00012410: 2020 2020 2874 6167 732c 2074 6167 7479      (tags, tagty
-00012420: 7065 7329 2077 6865 7265 2074 6167 7320  pes) where tags 
-00012430: 6d61 7073 2074 6167 206e 616d 6520 746f  maps tag name to
-00012440: 206e 6f64 652c 2061 6e64 2074 6167 7479   node, and tagty
-00012450: 7065 730a 2020 2020 2020 2020 6d61 7073  pes.        maps
-00012460: 2074 6167 206e 616d 6520 746f 2061 2073   tag name to a s
-00012470: 7472 696e 6720 6c69 6b65 205c 2767 6c6f  tring like \'glo
-00012480: 6261 6c5c 2720 6f72 205c 276c 6f63 616c  bal\' or \'local
-00012490: 5c27 2e0a 2020 2020 2020 2020 5375 6263  \'..        Subc
-000124a0: 6c61 7373 6573 206f 7220 6578 7465 6e73  lasses or extens
-000124b0: 696f 6e73 2061 7265 2066 7265 6520 746f  ions are free to
-000124c0: 2061 6464 2074 6865 6972 206f 776e 2074   add their own t
-000124d0: 6167 732c 2062 7574 0a20 2020 2020 2020  ags, but.       
-000124e0: 2073 686f 756c 6420 6265 2061 7761 7265   should be aware
-000124f0: 2074 6861 7420 7468 6520 7265 7475 726e   that the return
-00012500: 6564 2064 6963 7473 2077 696c 6c20 6265  ed dicts will be
-00012510: 2072 6574 6169 6e65 6420 666f 7220 7468   retained for th
-00012520: 650a 2020 2020 2020 2020 6475 7261 7469  e.        durati
-00012530: 6f6e 206f 6620 7468 6520 6c6f 6361 6c72  on of the localr
-00012540: 6570 6f20 6f62 6a65 6374 2e22 2222 0a0a  epo object."""..
-00012550: 2020 2020 2020 2020 2320 5858 5820 7768          # XXX wh
-00012560: 6174 2074 6167 7479 7065 2073 686f 756c  at tagtype shoul
-00012570: 6420 7375 6263 6c61 7373 6573 2f65 7874  d subclasses/ext
-00012580: 656e 7369 6f6e 7320 7573 653f 2020 4375  ensions use?  Cu
-00012590: 7272 656e 746c 790a 2020 2020 2020 2020  rrently.        
-000125a0: 2320 6d71 2061 6e64 2062 6f6f 6b6d 6172  # mq and bookmar
-000125b0: 6b73 2061 6464 2074 6167 732c 2062 7574  ks add tags, but
-000125c0: 2064 6f20 6e6f 7420 7365 7420 7468 6520   do not set the 
-000125d0: 7461 6774 7970 6520 6174 2061 6c6c 2e0a  tagtype at all..
-000125e0: 2020 2020 2020 2020 2320 5368 6f75 6c64          # Should
-000125f0: 2065 6163 6820 6578 7465 6e73 696f 6e20   each extension 
-00012600: 696e 7665 6e74 2069 7473 206f 776e 2074  invent its own t
-00012610: 6167 2074 7970 653f 2020 5368 6f75 6c64  ag type?  Should
-00012620: 2074 6865 7265 0a20 2020 2020 2020 2023   there.        #
-00012630: 2062 6520 6f6e 6520 7461 6774 7970 6520   be one tagtype 
-00012640: 666f 7220 616c 6c20 7375 6368 2022 7669  for all such "vi
-00012650: 7274 7561 6c22 2074 6167 733f 2020 4f72  rtual" tags?  Or
-00012660: 2069 7320 7468 6520 7374 6174 7573 0a20   is the status. 
-00012670: 2020 2020 2020 2023 2071 756f 2066 696e         # quo fin
-00012680: 653f 0a0a 2020 2020 2020 2020 2320 6d61  e?..        # ma
-00012690: 7020 7461 6720 6e61 6d65 2074 6f20 286e  p tag name to (n
-000126a0: 6f64 652c 2068 6973 7429 0a20 2020 2020  ode, hist).     
-000126b0: 2020 2061 6c6c 7461 6773 203d 2074 6167     alltags = tag
-000126c0: 736d 6f64 2e66 696e 6467 6c6f 6261 6c74  smod.findglobalt
-000126d0: 6167 7328 7365 6c66 2e75 692c 2073 656c  ags(self.ui, sel
-000126e0: 6629 0a20 2020 2020 2020 2023 206d 6170  f).        # map
-000126f0: 2074 6167 206e 616d 6520 746f 2074 6167   tag name to tag
-00012700: 2074 7970 650a 2020 2020 2020 2020 7461   type.        ta
-00012710: 6774 7970 6573 203d 207b 7461 673a 2062  gtypes = {tag: b
-00012720: 2767 6c6f 6261 6c27 2066 6f72 2074 6167  'global' for tag
-00012730: 2069 6e20 616c 6c74 6167 737d 0a0a 2020   in alltags}..  
-00012740: 2020 2020 2020 7461 6773 6d6f 642e 7265        tagsmod.re
-00012750: 6164 6c6f 6361 6c74 6167 7328 7365 6c66  adlocaltags(self
-00012760: 2e75 692c 2073 656c 662c 2061 6c6c 7461  .ui, self, allta
-00012770: 6773 2c20 7461 6774 7970 6573 290a 0a20  gs, tagtypes).. 
-00012780: 2020 2020 2020 2023 2042 7569 6c64 2074         # Build t
-00012790: 6865 2072 6574 7572 6e20 6469 6374 732e  he return dicts.
-000127a0: 2020 4861 7665 2074 6f20 7265 2d65 6e63    Have to re-enc
-000127b0: 6f64 6520 7461 6720 6e61 6d65 7320 6265  ode tag names be
-000127c0: 6361 7573 650a 2020 2020 2020 2020 2320  cause.        # 
-000127d0: 7468 6520 7461 6773 206d 6f64 756c 6520  the tags module 
-000127e0: 616c 7761 7973 2075 7365 7320 5554 462d  always uses UTF-
-000127f0: 3820 2869 6e20 6f72 6465 7220 6e6f 7420  8 (in order not 
-00012800: 746f 206c 6f73 6520 696e 666f 0a20 2020  to lose info.   
-00012810: 2020 2020 2023 2077 7269 7469 6e67 2074       # writing t
-00012820: 6f20 7468 6520 6361 6368 6529 2c20 6275  o the cache), bu
-00012830: 7420 7468 6520 7265 7374 206f 6620 4d65  t the rest of Me
-00012840: 7263 7572 6961 6c20 7761 6e74 7320 7468  rcurial wants th
-00012850: 656d 2069 6e0a 2020 2020 2020 2020 2320  em in.        # 
-00012860: 6c6f 6361 6c20 656e 636f 6469 6e67 2e0a  local encoding..
-00012870: 2020 2020 2020 2020 7461 6773 203d 207b          tags = {
-00012880: 7d0a 2020 2020 2020 2020 666f 7220 6e61  }.        for na
-00012890: 6d65 2c20 286e 6f64 652c 2068 6973 7429  me, (node, hist)
-000128a0: 2069 6e20 616c 6c74 6167 732e 6974 656d   in alltags.item
-000128b0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-000128c0: 2069 6620 6e6f 6465 2021 3d20 7365 6c66   if node != self
-000128d0: 2e6e 756c 6c69 643a 0a20 2020 2020 2020  .nullid:.       
-000128e0: 2020 2020 2020 2020 2074 6167 735b 656e           tags[en
-000128f0: 636f 6469 6e67 2e74 6f6c 6f63 616c 286e  coding.tolocal(n
-00012900: 616d 6529 5d20 3d20 6e6f 6465 0a20 2020  ame)] = node.   
-00012910: 2020 2020 2074 6167 735b 6227 7469 7027       tags[b'tip'
-00012920: 5d20 3d20 7365 6c66 2e63 6861 6e67 656c  ] = self.changel
-00012930: 6f67 2e74 6970 2829 0a20 2020 2020 2020  og.tip().       
-00012940: 2074 6167 7479 7065 7320 3d20 7b0a 2020   tagtypes = {.  
-00012950: 2020 2020 2020 2020 2020 656e 636f 6469            encodi
-00012960: 6e67 2e74 6f6c 6f63 616c 286e 616d 6529  ng.tolocal(name)
-00012970: 3a20 7661 6c75 6520 666f 7220 286e 616d  : value for (nam
-00012980: 652c 2076 616c 7565 2920 696e 2074 6167  e, value) in tag
-00012990: 7479 7065 732e 6974 656d 7328 290a 2020  types.items().  
-000129a0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-000129b0: 7265 7475 726e 2028 7461 6773 2c20 7461  return (tags, ta
-000129c0: 6774 7970 6573 290a 0a20 2020 2064 6566  gtypes)..    def
-000129d0: 2074 6167 7479 7065 2873 656c 662c 2074   tagtype(self, t
-000129e0: 6167 6e61 6d65 293a 0a20 2020 2020 2020  agname):.       
-000129f0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-00012a00: 7572 6e20 7468 6520 7479 7065 206f 6620  urn the type of 
-00012a10: 7468 6520 6769 7665 6e20 7461 672e 2072  the given tag. r
-00012a20: 6573 756c 7420 6361 6e20 6265 3a0a 0a20  esult can be:.. 
-00012a30: 2020 2020 2020 2027 6c6f 6361 6c27 2020         'local'  
-00012a40: 3a20 6120 6c6f 6361 6c20 7461 670a 2020  : a local tag.  
-00012a50: 2020 2020 2020 2767 6c6f 6261 6c27 203a        'global' :
-00012a60: 2061 2067 6c6f 6261 6c20 7461 670a 2020   a global tag.  
-00012a70: 2020 2020 2020 4e6f 6e65 2020 2020 203a        None     :
-00012a80: 2074 6167 2064 6f65 7320 6e6f 7420 6578   tag does not ex
-00012a90: 6973 740a 2020 2020 2020 2020 2222 220a  ist.        """.
-00012aa0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012ab0: 7365 6c66 2e5f 7461 6773 6361 6368 652e  self._tagscache.
-00012ac0: 7461 6774 7970 6573 2e67 6574 2874 6167  tagtypes.get(tag
-00012ad0: 6e61 6d65 290a 0a20 2020 2064 6566 2074  name)..    def t
-00012ae0: 6167 736c 6973 7428 7365 6c66 293a 0a20  agslist(self):. 
-00012af0: 2020 2020 2020 2027 2727 7265 7475 726e         '''return
-00012b00: 2061 206c 6973 7420 6f66 2074 6167 7320   a list of tags 
-00012b10: 6f72 6465 7265 6420 6279 2072 6576 6973  ordered by revis
-00012b20: 696f 6e27 2727 0a20 2020 2020 2020 2069  ion'''.        i
-00012b30: 6620 6e6f 7420 7365 6c66 2e5f 7461 6773  f not self._tags
-00012b40: 6361 6368 652e 7461 6773 6c69 7374 3a0a  cache.tagslist:.
-00012b50: 2020 2020 2020 2020 2020 2020 6c20 3d20              l = 
-00012b60: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
-00012b70: 6f72 2074 2c20 6e20 696e 2073 656c 662e  or t, n in self.
-00012b80: 7461 6773 2829 2e69 7465 6d73 2829 3a0a  tags().items():.
-00012b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ba0: 6c2e 6170 7065 6e64 2828 7365 6c66 2e63  l.append((self.c
-00012bb0: 6861 6e67 656c 6f67 2e72 6576 286e 292c  hangelog.rev(n),
-00012bc0: 2074 2c20 6e29 290a 2020 2020 2020 2020   t, n)).        
-00012bd0: 2020 2020 7365 6c66 2e5f 7461 6773 6361      self._tagsca
-00012be0: 6368 652e 7461 6773 6c69 7374 203d 205b  che.tagslist = [
-00012bf0: 2874 2c20 6e29 2066 6f72 2072 2c20 742c  (t, n) for r, t,
-00012c00: 206e 2069 6e20 736f 7274 6564 286c 295d   n in sorted(l)]
-00012c10: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00012c20: 2073 656c 662e 5f74 6167 7363 6163 6865   self._tagscache
-00012c30: 2e74 6167 736c 6973 740a 0a20 2020 2064  .tagslist..    d
-00012c40: 6566 206e 6f64 6574 6167 7328 7365 6c66  ef nodetags(self
-00012c50: 2c20 6e6f 6465 293a 0a20 2020 2020 2020  , node):.       
-00012c60: 2027 2727 7265 7475 726e 2074 6865 2074   '''return the t
-00012c70: 6167 7320 6173 736f 6369 6174 6564 2077  ags associated w
-00012c80: 6974 6820 6120 6e6f 6465 2727 270a 2020  ith a node'''.  
-00012c90: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00012ca0: 662e 5f74 6167 7363 6163 6865 2e6e 6f64  f._tagscache.nod
-00012cb0: 6574 6167 7363 6163 6865 3a0a 2020 2020  etagscache:.    
-00012cc0: 2020 2020 2020 2020 6e6f 6465 7461 6773          nodetags
-00012cd0: 6361 6368 6520 3d20 7b7d 0a20 2020 2020  cache = {}.     
-00012ce0: 2020 2020 2020 2066 6f72 2074 2c20 6e20         for t, n 
-00012cf0: 696e 2073 656c 662e 5f74 6167 7363 6163  in self._tagscac
-00012d00: 6865 2e74 6167 732e 6974 656d 7328 293a  he.tags.items():
-00012d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012d20: 206e 6f64 6574 6167 7363 6163 6865 2e73   nodetagscache.s
-00012d30: 6574 6465 6661 756c 7428 6e2c 205b 5d29  etdefault(n, [])
-00012d40: 2e61 7070 656e 6428 7429 0a20 2020 2020  .append(t).     
-00012d50: 2020 2020 2020 2066 6f72 2074 6167 7320         for tags 
-00012d60: 696e 206e 6f64 6574 6167 7363 6163 6865  in nodetagscache
-00012d70: 2e76 616c 7565 7328 293a 0a20 2020 2020  .values():.     
-00012d80: 2020 2020 2020 2020 2020 2074 6167 732e             tags.
-00012d90: 736f 7274 2829 0a20 2020 2020 2020 2020  sort().         
-00012da0: 2020 2073 656c 662e 5f74 6167 7363 6163     self._tagscac
-00012db0: 6865 2e6e 6f64 6574 6167 7363 6163 6865  he.nodetagscache
-00012dc0: 203d 206e 6f64 6574 6167 7363 6163 6865   = nodetagscache
-00012dd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012de0: 7365 6c66 2e5f 7461 6773 6361 6368 652e  self._tagscache.
-00012df0: 6e6f 6465 7461 6773 6361 6368 652e 6765  nodetagscache.ge
-00012e00: 7428 6e6f 6465 2c20 5b5d 290a 0a20 2020  t(node, [])..   
-00012e10: 2064 6566 206e 6f64 6562 6f6f 6b6d 6172   def nodebookmar
-00012e20: 6b73 2873 656c 662c 206e 6f64 6529 3a0a  ks(self, node):.
-00012e30: 2020 2020 2020 2020 2222 2272 6574 7572          """retur
-00012e40: 6e20 7468 6520 6c69 7374 206f 6620 626f  n the list of bo
-00012e50: 6f6b 6d61 726b 7320 706f 696e 7469 6e67  okmarks pointing
-00012e60: 2074 6f20 7468 6520 7370 6563 6966 6965   to the specifie
-00012e70: 6420 6e6f 6465 2222 220a 2020 2020 2020  d node""".      
-00012e80: 2020 7265 7475 726e 2073 656c 662e 5f62    return self._b
-00012e90: 6f6f 6b6d 6172 6b73 2e6e 616d 6573 286e  ookmarks.names(n
-00012ea0: 6f64 6529 0a0a 2020 2020 6465 6620 6272  ode)..    def br
-00012eb0: 616e 6368 6d61 7028 7365 6c66 293a 0a20  anchmap(self):. 
-00012ec0: 2020 2020 2020 2022 2222 7265 7475 726e         """return
-00012ed0: 7320 6120 6469 6374 696f 6e61 7279 207b  s a dictionary {
-00012ee0: 6272 616e 6368 3a20 5b62 7261 6e63 6868  branch: [branchh
-00012ef0: 6561 6473 5d7d 2077 6974 6820 6272 616e  eads]} with bran
-00012f00: 6368 6865 6164 730a 2020 2020 2020 2020  chheads.        
-00012f10: 6f72 6465 7265 6420 6279 2069 6e63 7265  ordered by incre
-00012f20: 6173 696e 6720 7265 7669 7369 6f6e 206e  asing revision n
-00012f30: 756d 6265 7222 2222 0a20 2020 2020 2020  umber""".       
-00012f40: 2072 6574 7572 6e20 7365 6c66 2e5f 6272   return self._br
-00012f50: 616e 6368 6361 6368 6573 5b73 656c 665d  anchcaches[self]
-00012f60: 0a0a 2020 2020 4075 6e66 696c 7465 7265  ..    @unfiltere
-00012f70: 646d 6574 686f 640a 2020 2020 6465 6620  dmethod.    def 
-00012f80: 7265 7662 7261 6e63 6863 6163 6865 2873  revbranchcache(s
-00012f90: 656c 6629 3a0a 2020 2020 2020 2020 6966  elf):.        if
-00012fa0: 206e 6f74 2073 656c 662e 5f72 6576 6272   not self._revbr
-00012fb0: 616e 6368 6361 6368 653a 0a20 2020 2020  anchcache:.     
-00012fc0: 2020 2020 2020 2073 656c 662e 5f72 6576         self._rev
-00012fd0: 6272 616e 6368 6361 6368 6520 3d20 6272  branchcache = br
-00012fe0: 616e 6368 6d61 702e 7265 7662 7261 6e63  anchmap.revbranc
-00012ff0: 6863 6163 6865 2873 656c 662e 756e 6669  hcache(self.unfi
-00013000: 6c74 6572 6564 2829 290a 2020 2020 2020  ltered()).      
-00013010: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
-00013020: 6576 6272 616e 6368 6361 6368 650a 0a20  evbranchcache.. 
-00013030: 2020 2064 6566 2072 6567 6973 7465 725f     def register_
-00013040: 6368 616e 6765 7365 7428 7365 6c66 2c20  changeset(self, 
-00013050: 7265 762c 2063 6861 6e67 656c 6f67 7265  rev, changelogre
-00013060: 7669 7369 6f6e 293a 0a20 2020 2020 2020  vision):.       
-00013070: 2073 656c 662e 7265 7662 7261 6e63 6863   self.revbranchc
-00013080: 6163 6865 2829 2e73 6574 6461 7461 2872  ache().setdata(r
-00013090: 6576 2c20 6368 616e 6765 6c6f 6772 6576  ev, changelogrev
-000130a0: 6973 696f 6e29 0a0a 2020 2020 6465 6620  ision)..    def 
-000130b0: 6272 616e 6368 7469 7028 7365 6c66 2c20  branchtip(self, 
-000130c0: 6272 616e 6368 2c20 6967 6e6f 7265 6d69  branch, ignoremi
-000130d0: 7373 696e 673d 4661 6c73 6529 3a0a 2020  ssing=False):.  
-000130e0: 2020 2020 2020 2222 2272 6574 7572 6e20        """return 
-000130f0: 7468 6520 7469 7020 6e6f 6465 2066 6f72  the tip node for
-00013100: 2061 2067 6976 656e 2062 7261 6e63 680a   a given branch.
-00013110: 0a20 2020 2020 2020 2049 6620 6967 6e6f  .        If igno
-00013120: 7265 6d69 7373 696e 6720 6973 2054 7275  remissing is Tru
-00013130: 652c 2074 6865 6e20 7468 6973 206d 6574  e, then this met
-00013140: 686f 6420 7769 6c6c 206e 6f74 2072 6169  hod will not rai
-00013150: 7365 2061 6e20 6572 726f 722e 0a20 2020  se an error..   
-00013160: 2020 2020 2054 6869 7320 6973 2068 656c       This is hel
-00013170: 7066 756c 2066 6f72 2063 616c 6c65 7273  pful for callers
-00013180: 2074 6861 7420 6f6e 6c79 2065 7870 6563   that only expec
-00013190: 7420 4e6f 6e65 2066 6f72 2061 206d 6973  t None for a mis
-000131a0: 7369 6e67 2062 7261 6e63 680a 2020 2020  sing branch.    
-000131b0: 2020 2020 2865 2e67 2e20 6e61 6d65 7370      (e.g. namesp
-000131c0: 6163 6529 2e0a 0a20 2020 2020 2020 2022  ace)...        "
-000131d0: 2222 0a20 2020 2020 2020 2074 7279 3a0a  "".        try:.
-000131e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000131f0: 726e 2073 656c 662e 6272 616e 6368 6d61  rn self.branchma
-00013200: 7028 292e 6272 616e 6368 7469 7028 6272  p().branchtip(br
-00013210: 616e 6368 290a 2020 2020 2020 2020 6578  anch).        ex
-00013220: 6365 7074 204b 6579 4572 726f 723a 0a20  cept KeyError:. 
-00013230: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00013240: 7420 6967 6e6f 7265 6d69 7373 696e 673a  t ignoremissing:
-00013250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013260: 2072 6169 7365 2065 7272 6f72 2e52 6570   raise error.Rep
-00013270: 6f4c 6f6f 6b75 7045 7272 6f72 285f 2862  oLookupError(_(b
-00013280: 2275 6e6b 6e6f 776e 2062 7261 6e63 6820  "unknown branch 
-00013290: 2725 7327 2229 2025 2062 7261 6e63 6829  '%s'") % branch)
-000132a0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000132b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000132c0: 2020 2070 6173 730a 0a20 2020 2064 6566     pass..    def
-000132d0: 206c 6f6f 6b75 7028 7365 6c66 2c20 6b65   lookup(self, ke
-000132e0: 7929 3a0a 2020 2020 2020 2020 6e6f 6465  y):.        node
-000132f0: 203d 2073 636d 7574 696c 2e72 6576 7379   = scmutil.revsy
-00013300: 6d62 6f6c 2873 656c 662c 206b 6579 292e  mbol(self, key).
-00013310: 6e6f 6465 2829 0a20 2020 2020 2020 2069  node().        i
-00013320: 6620 6e6f 6465 2069 7320 4e6f 6e65 3a0a  f node is None:.
-00013330: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00013340: 6520 6572 726f 722e 5265 706f 4c6f 6f6b  e error.RepoLook
-00013350: 7570 4572 726f 7228 5f28 6222 756e 6b6e  upError(_(b"unkn
-00013360: 6f77 6e20 7265 7669 7369 6f6e 2027 2573  own revision '%s
-00013370: 2722 2920 2520 6b65 7929 0a20 2020 2020  '") % key).     
-00013380: 2020 2072 6574 7572 6e20 6e6f 6465 0a0a     return node..
-00013390: 2020 2020 6465 6620 6c6f 6f6b 7570 6272      def lookupbr
-000133a0: 616e 6368 2873 656c 662c 206b 6579 293a  anch(self, key):
-000133b0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000133c0: 2e62 7261 6e63 686d 6170 2829 2e68 6173  .branchmap().has
-000133d0: 6272 616e 6368 286b 6579 293a 0a20 2020  branch(key):.   
-000133e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000133f0: 6b65 790a 0a20 2020 2020 2020 2072 6574  key..        ret
-00013400: 7572 6e20 7363 6d75 7469 6c2e 7265 7673  urn scmutil.revs
-00013410: 796d 626f 6c28 7365 6c66 2c20 6b65 7929  ymbol(self, key)
-00013420: 2e62 7261 6e63 6828 290a 0a20 2020 2064  .branch()..    d
-00013430: 6566 206b 6e6f 776e 2873 656c 662c 206e  ef known(self, n
-00013440: 6f64 6573 293a 0a20 2020 2020 2020 2063  odes):.        c
-00013450: 6c20 3d20 7365 6c66 2e63 6861 6e67 656c  l = self.changel
-00013460: 6f67 0a20 2020 2020 2020 2067 6574 5f72  og.        get_r
-00013470: 6576 203d 2063 6c2e 696e 6465 782e 6765  ev = cl.index.ge
-00013480: 745f 7265 760a 2020 2020 2020 2020 6669  t_rev.        fi
-00013490: 6c74 6572 6564 203d 2063 6c2e 6669 6c74  ltered = cl.filt
-000134a0: 6572 6564 7265 7673 0a20 2020 2020 2020  eredrevs.       
-000134b0: 2072 6573 756c 7420 3d20 5b5d 0a20 2020   result = [].   
-000134c0: 2020 2020 2066 6f72 206e 2069 6e20 6e6f       for n in no
-000134d0: 6465 733a 0a20 2020 2020 2020 2020 2020  des:.           
-000134e0: 2072 203d 2067 6574 5f72 6576 286e 290a   r = get_rev(n).
-000134f0: 2020 2020 2020 2020 2020 2020 7265 7370              resp
-00013500: 203d 206e 6f74 2028 7220 6973 204e 6f6e   = not (r is Non
-00013510: 6520 6f72 2072 2069 6e20 6669 6c74 6572  e or r in filter
-00013520: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
-00013530: 7265 7375 6c74 2e61 7070 656e 6428 7265  result.append(re
-00013540: 7370 290a 2020 2020 2020 2020 7265 7475  sp).        retu
-00013550: 726e 2072 6573 756c 740a 0a20 2020 2064  rn result..    d
-00013560: 6566 206c 6f63 616c 2873 656c 6629 3a0a  ef local(self):.
-00013570: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00013580: 656c 660a 0a20 2020 2064 6566 2070 7562  elf..    def pub
-00013590: 6c69 7368 696e 6728 7365 6c66 293a 0a20  lishing(self):. 
-000135a0: 2020 2020 2020 2023 2069 7427 7320 7361         # it's sa
-000135b0: 6665 2028 616e 6420 6465 7369 7261 626c  fe (and desirabl
-000135c0: 6529 2074 6f20 7472 7573 7420 7468 6520  e) to trust the 
-000135d0: 7075 626c 6973 6820 666c 6167 2075 6e63  publish flag unc
-000135e0: 6f6e 6469 7469 6f6e 616c 6c79 0a20 2020  onditionally.   
-000135f0: 2020 2020 2023 2073 6f20 7468 6174 2077       # so that w
-00013600: 6520 646f 6e27 7420 6669 6e61 6c69 7a65  e don't finalize
-00013610: 2063 6861 6e67 6573 2073 6861 7265 6420   changes shared 
-00013620: 6265 7477 6565 6e20 7573 6572 7320 7669  between users vi
-00013630: 6120 7373 6820 6f72 206e 6673 0a20 2020  a ssh or nfs.   
-00013640: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00013650: 2e75 692e 636f 6e66 6967 626f 6f6c 2862  .ui.configbool(b
-00013660: 2770 6861 7365 7327 2c20 6227 7075 626c  'phases', b'publ
-00013670: 6973 6827 2c20 756e 7472 7573 7465 643d  ish', untrusted=
-00013680: 5472 7565 290a 0a20 2020 2064 6566 2063  True)..    def c
-00013690: 616e 636f 7079 2873 656c 6629 3a0a 2020  ancopy(self):.  
-000136a0: 2020 2020 2020 2320 736f 2073 7461 7469        # so stati
-000136b0: 6368 7474 7072 6570 6f27 7320 6f76 6572  chttprepo's over
-000136c0: 7269 6465 206f 6620 6c6f 6361 6c28 2920  ride of local() 
-000136d0: 776f 726b 730a 2020 2020 2020 2020 6966  works.        if
-000136e0: 206e 6f74 2073 656c 662e 6c6f 6361 6c28   not self.local(
-000136f0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00013700: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00013710: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00013720: 7075 626c 6973 6869 6e67 2829 3a0a 2020  publishing():.  
-00013730: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00013740: 2054 7275 650a 2020 2020 2020 2020 2320   True.        # 
-00013750: 6966 2070 7562 6c69 7368 696e 6720 7765  if publishing we
-00013760: 2063 616e 2774 2063 6f70 7920 6966 2074   can't copy if t
-00013770: 6865 7265 2069 7320 6669 6c74 6572 6564  here is filtered
-00013780: 2063 6f6e 7465 6e74 0a20 2020 2020 2020   content.       
-00013790: 2072 6574 7572 6e20 6e6f 7420 7365 6c66   return not self
-000137a0: 2e66 696c 7465 7265 6428 6227 7669 7369  .filtered(b'visi
-000137b0: 626c 6527 292e 6368 616e 6765 6c6f 672e  ble').changelog.
-000137c0: 6669 6c74 6572 6564 7265 7673 0a0a 2020  filteredrevs..  
-000137d0: 2020 6465 6620 7368 6172 6564 2873 656c    def shared(sel
-000137e0: 6629 3a0a 2020 2020 2020 2020 2727 2774  f):.        '''t
-000137f0: 6865 2074 7970 6520 6f66 2073 6861 7265  he type of share
-00013800: 6420 7265 706f 7369 746f 7279 2028 4e6f  d repository (No
-00013810: 6e65 2069 6620 6e6f 7420 7368 6172 6564  ne if not shared
-00013820: 2927 2727 0a20 2020 2020 2020 2069 6620  )'''.        if 
-00013830: 7365 6c66 2e73 6861 7265 6470 6174 6820  self.sharedpath 
-00013840: 213d 2073 656c 662e 7061 7468 3a0a 2020  != self.path:.  
-00013850: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00013860: 2062 2773 746f 7265 270a 2020 2020 2020   b'store'.      
-00013870: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-00013880: 2020 2064 6566 2077 6a6f 696e 2873 656c     def wjoin(sel
-00013890: 662c 2066 3a20 6279 7465 732c 202a 696e  f, f: bytes, *in
-000138a0: 7369 6465 663a 2062 7974 6573 2920 2d3e  sidef: bytes) ->
-000138b0: 2062 7974 6573 3a0a 2020 2020 2020 2020   bytes:.        
-000138c0: 7265 7475 726e 2073 656c 662e 7666 732e  return self.vfs.
-000138d0: 7265 6c6a 6f69 6e28 7365 6c66 2e72 6f6f  reljoin(self.roo
-000138e0: 742c 2066 2c20 2a69 6e73 6964 6566 290a  t, f, *insidef).
-000138f0: 0a20 2020 2064 6566 2073 6574 7061 7265  .    def setpare
-00013900: 6e74 7328 7365 6c66 2c20 7031 2c20 7032  nts(self, p1, p2
-00013910: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00013920: 6966 2070 3220 6973 204e 6f6e 653a 0a20  if p2 is None:. 
-00013930: 2020 2020 2020 2020 2020 2070 3220 3d20             p2 = 
-00013940: 7365 6c66 2e6e 756c 6c69 640a 2020 2020  self.nullid.    
-00013950: 2020 2020 7365 6c66 5b4e 6f6e 655d 2e73      self[None].s
-00013960: 6574 7061 7265 6e74 7328 7031 2c20 7032  etparents(p1, p2
-00013970: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-00013980: 7175 6963 6b5f 6163 6365 7373 5f63 6861  quick_access_cha
-00013990: 6e67 6569 645f 696e 7661 6c69 6461 7465  ngeid_invalidate
-000139a0: 2829 0a0a 2020 2020 6465 6620 6669 6c65  ()..    def file
-000139b0: 6374 7828 7365 6c66 2c20 7061 7468 3a20  ctx(self, path: 
-000139c0: 6279 7465 732c 2063 6861 6e67 6569 643d  bytes, changeid=
-000139d0: 4e6f 6e65 2c20 6669 6c65 6964 3d4e 6f6e  None, fileid=Non
-000139e0: 652c 2063 6861 6e67 6563 7478 3d4e 6f6e  e, changectx=Non
-000139f0: 6529 3a0a 2020 2020 2020 2020 2222 2263  e):.        """c
-00013a00: 6861 6e67 6569 6420 6d75 7374 2062 6520  hangeid must be 
-00013a10: 6120 6368 616e 6765 7365 7420 7265 7669  a changeset revi
-00013a20: 7369 6f6e 2c20 6966 2073 7065 6369 6669  sion, if specifi
-00013a30: 6564 2e0a 2020 2020 2020 2020 6669 6c65  ed..        file
-00013a40: 6964 2063 616e 2062 6520 6120 6669 6c65  id can be a file
-00013a50: 2072 6576 6973 696f 6e20 6f72 206e 6f64   revision or nod
-00013a60: 652e 2222 220a 2020 2020 2020 2020 7265  e.""".        re
-00013a70: 7475 726e 2063 6f6e 7465 7874 2e66 696c  turn context.fil
-00013a80: 6563 7478 280a 2020 2020 2020 2020 2020  ectx(.          
-00013a90: 2020 7365 6c66 2c20 7061 7468 2c20 6368    self, path, ch
-00013aa0: 616e 6765 6964 2c20 6669 6c65 6964 2c20  angeid, fileid, 
-00013ab0: 6368 616e 6765 6374 783d 6368 616e 6765  changectx=change
-00013ac0: 6374 780a 2020 2020 2020 2020 290a 0a20  ctx.        ).. 
-00013ad0: 2020 2064 6566 2067 6574 6377 6428 7365     def getcwd(se
-00013ae0: 6c66 2920 2d3e 2062 7974 6573 3a0a 2020  lf) -> bytes:.  
-00013af0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00013b00: 662e 6469 7273 7461 7465 2e67 6574 6377  f.dirstate.getcw
-00013b10: 6428 290a 0a20 2020 2064 6566 2070 6174  d()..    def pat
-00013b20: 6874 6f28 7365 6c66 2c20 663a 2062 7974  hto(self, f: byt
-00013b30: 6573 2c20 6377 643a 204f 7074 696f 6e61  es, cwd: Optiona
-00013b40: 6c5b 6279 7465 735d 203d 204e 6f6e 6529  l[bytes] = None)
-00013b50: 202d 3e20 6279 7465 733a 0a20 2020 2020   -> bytes:.     
-00013b60: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
-00013b70: 6972 7374 6174 652e 7061 7468 746f 2866  irstate.pathto(f
-00013b80: 2c20 6377 6429 0a0a 2020 2020 6465 6620  , cwd)..    def 
-00013b90: 5f6c 6f61 6466 696c 7465 7228 7365 6c66  _loadfilter(self
-00013ba0: 2c20 6669 6c74 6572 293a 0a20 2020 2020  , filter):.     
-00013bb0: 2020 2069 6620 6669 6c74 6572 206e 6f74     if filter not
-00013bc0: 2069 6e20 7365 6c66 2e5f 6669 6c74 6572   in self._filter
-00013bd0: 7061 7473 3a0a 2020 2020 2020 2020 2020  pats:.          
-00013be0: 2020 6c20 3d20 5b5d 0a20 2020 2020 2020    l = [].       
-00013bf0: 2020 2020 2066 6f72 2070 6174 2c20 636d       for pat, cm
-00013c00: 6420 696e 2073 656c 662e 7569 2e63 6f6e  d in self.ui.con
-00013c10: 6669 6769 7465 6d73 2866 696c 7465 7229  figitems(filter)
-00013c20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013c30: 2020 6966 2063 6d64 203d 3d20 6227 2127    if cmd == b'!'
-00013c40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013c50: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-00013c60: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00013c70: 6620 3d20 6d61 7463 686d 6f64 2e6d 6174  f = matchmod.mat
-00013c80: 6368 2873 656c 662e 726f 6f74 2c20 6227  ch(self.root, b'
-00013c90: 272c 205b 7061 745d 290a 2020 2020 2020  ', [pat]).      
-00013ca0: 2020 2020 2020 2020 2020 666e 203d 204e            fn = N
-00013cb0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00013cc0: 2020 2020 7061 7261 6d73 203d 2063 6d64      params = cmd
-00013cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013ce0: 2066 6f72 206e 616d 652c 2066 696c 7465   for name, filte
-00013cf0: 7266 6e20 696e 2073 656c 662e 5f64 6174  rfn in self._dat
-00013d00: 6166 696c 7465 7273 2e69 7465 6d73 2829  afilters.items()
-00013d10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013d20: 2020 2020 2020 6966 2063 6d64 2e73 7461        if cmd.sta
-00013d30: 7274 7377 6974 6828 6e61 6d65 293a 0a20  rtswith(name):. 
-00013d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d50: 2020 2020 2020 2066 6e20 3d20 6669 6c74         fn = filt
-00013d60: 6572 666e 0a20 2020 2020 2020 2020 2020  erfn.           
-00013d70: 2020 2020 2020 2020 2020 2020 2070 6172               par
-00013d80: 616d 7320 3d20 636d 645b 6c65 6e28 6e61  ams = cmd[len(na
-00013d90: 6d65 2920 3a5d 2e6c 7374 7269 7028 290a  me) :].lstrip().
-00013da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013db0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-00013dc0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00013dd0: 206e 6f74 2066 6e3a 0a20 2020 2020 2020   not fn:.       
-00013de0: 2020 2020 2020 2020 2020 2020 2066 6e20               fn 
-00013df0: 3d20 6c61 6d62 6461 2073 2c20 632c 202a  = lambda s, c, *
-00013e00: 2a6b 7761 7267 733a 2070 726f 6375 7469  *kwargs: procuti
-00013e10: 6c2e 6669 6c74 6572 2873 2c20 6329 0a20  l.filter(s, c). 
-00013e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e30: 2020 2066 6e2e 5f5f 6e61 6d65 5f5f 203d     fn.__name__ =
-00013e40: 2027 636f 6d6d 616e 6466 696c 7465 7227   'commandfilter'
-00013e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013e60: 2023 2057 7261 7020 6f6c 6420 6669 6c74   # Wrap old filt
-00013e70: 6572 7320 6e6f 7420 7375 7070 6f72 7469  ers not supporti
-00013e80: 6e67 206b 6579 776f 7264 2061 7267 756d  ng keyword argum
-00013e90: 656e 7473 0a20 2020 2020 2020 2020 2020  ents.           
-00013ea0: 2020 2020 2069 6620 6e6f 7420 7079 636f       if not pyco
-00013eb0: 6d70 6174 2e67 6574 6172 6773 7065 6328  mpat.getargspec(
-00013ec0: 666e 295b 325d 3a0a 2020 2020 2020 2020  fn)[2]:.        
-00013ed0: 2020 2020 2020 2020 2020 2020 6f6c 6466              oldf
-00013ee0: 6e20 3d20 666e 0a20 2020 2020 2020 2020  n = fn.         
-00013ef0: 2020 2020 2020 2020 2020 2066 6e20 3d20             fn = 
-00013f00: 6c61 6d62 6461 2073 2c20 632c 206f 6c64  lambda s, c, old
-00013f10: 666e 3d6f 6c64 666e 2c20 2a2a 6b77 6172  fn=oldfn, **kwar
-00013f20: 6773 3a20 6f6c 6466 6e28 732c 2063 290a  gs: oldfn(s, c).
-00013f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f40: 2020 2020 666e 2e5f 5f6e 616d 655f 5f20      fn.__name__ 
-00013f50: 3d20 2763 6f6d 7061 742d 2720 2b20 6f6c  = 'compat-' + ol
-00013f60: 6466 6e2e 5f5f 6e61 6d65 5f5f 0a20 2020  dfn.__name__.   
-00013f70: 2020 2020 2020 2020 2020 2020 206c 2e61               l.a
-00013f80: 7070 656e 6428 286d 662c 2066 6e2c 2070  ppend((mf, fn, p
-00013f90: 6172 616d 7329 290a 2020 2020 2020 2020  arams)).        
-00013fa0: 2020 2020 7365 6c66 2e5f 6669 6c74 6572      self._filter
-00013fb0: 7061 7473 5b66 696c 7465 725d 203d 206c  pats[filter] = l
-00013fc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00013fd0: 7365 6c66 2e5f 6669 6c74 6572 7061 7473  self._filterpats
-00013fe0: 5b66 696c 7465 725d 0a0a 2020 2020 6465  [filter]..    de
-00013ff0: 6620 5f66 696c 7465 7228 7365 6c66 2c20  f _filter(self, 
-00014000: 6669 6c74 6572 7061 7473 2c20 6669 6c65  filterpats, file
-00014010: 6e61 6d65 2c20 6461 7461 293a 0a20 2020  name, data):.   
-00014020: 2020 2020 2066 6f72 206d 662c 2066 6e2c       for mf, fn,
-00014030: 2063 6d64 2069 6e20 6669 6c74 6572 7061   cmd in filterpa
-00014040: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00014050: 6966 206d 6628 6669 6c65 6e61 6d65 293a  if mf(filename):
-00014060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014070: 2073 656c 662e 7569 2e64 6562 7567 280a   self.ui.debug(.
-00014080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014090: 2020 2020 6222 6669 6c74 6572 696e 6720      b"filtering 
-000140a0: 2573 2074 6872 6f75 6768 2025 735c 6e22  %s through %s\n"
-000140b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000140c0: 2020 2020 2025 2028 6669 6c65 6e61 6d65       % (filename
-000140d0: 2c20 636d 6420 6f72 2070 7963 6f6d 7061  , cmd or pycompa
-000140e0: 742e 7379 7362 7974 6573 2866 6e2e 5f5f  t.sysbytes(fn.__
-000140f0: 6e61 6d65 5f5f 2929 0a20 2020 2020 2020  name__)).       
-00014100: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00014110: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-00014120: 3d20 666e 2864 6174 612c 2063 6d64 2c20  = fn(data, cmd, 
-00014130: 7569 3d73 656c 662e 7569 2c20 7265 706f  ui=self.ui, repo
-00014140: 3d73 656c 662c 2066 696c 656e 616d 653d  =self, filename=
-00014150: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
-00014160: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00014170: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00014180: 6461 7461 0a0a 2020 2020 4075 6e66 696c  data..    @unfil
-00014190: 7465 7265 6470 726f 7065 7274 7963 6163  teredpropertycac
-000141a0: 6865 0a20 2020 2064 6566 205f 656e 636f  he.    def _enco
-000141b0: 6465 6669 6c74 6572 7061 7473 2873 656c  defilterpats(sel
-000141c0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-000141d0: 726e 2073 656c 662e 5f6c 6f61 6466 696c  rn self._loadfil
-000141e0: 7465 7228 6227 656e 636f 6465 2729 0a0a  ter(b'encode')..
-000141f0: 2020 2020 4075 6e66 696c 7465 7265 6470      @unfilteredp
-00014200: 726f 7065 7274 7963 6163 6865 0a20 2020  ropertycache.   
-00014210: 2064 6566 205f 6465 636f 6465 6669 6c74   def _decodefilt
-00014220: 6572 7061 7473 2873 656c 6629 3a0a 2020  erpats(self):.  
-00014230: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00014240: 662e 5f6c 6f61 6466 696c 7465 7228 6227  f._loadfilter(b'
-00014250: 6465 636f 6465 2729 0a0a 2020 2020 6465  decode')..    de
-00014260: 6620 6164 6464 6174 6166 696c 7465 7228  f adddatafilter(
-00014270: 7365 6c66 2c20 6e61 6d65 2c20 6669 6c74  self, name, filt
-00014280: 6572 293a 0a20 2020 2020 2020 2073 656c  er):.        sel
-00014290: 662e 5f64 6174 6166 696c 7465 7273 5b6e  f._datafilters[n
-000142a0: 616d 655d 203d 2066 696c 7465 720a 0a20  ame] = filter.. 
-000142b0: 2020 2064 6566 2077 7265 6164 2873 656c     def wread(sel
-000142c0: 662c 2066 696c 656e 616d 653a 2062 7974  f, filename: byt
-000142d0: 6573 2920 2d3e 2062 7974 6573 3a0a 2020  es) -> bytes:.  
-000142e0: 2020 2020 2020 6966 2073 656c 662e 7776        if self.wv
-000142f0: 6673 2e69 736c 696e 6b28 6669 6c65 6e61  fs.islink(filena
-00014300: 6d65 293a 0a20 2020 2020 2020 2020 2020  me):.           
-00014310: 2064 6174 6120 3d20 7365 6c66 2e77 7666   data = self.wvf
-00014320: 732e 7265 6164 6c69 6e6b 2866 696c 656e  s.readlink(filen
-00014330: 616d 6529 0a20 2020 2020 2020 2065 6c73  ame).        els
-00014340: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
-00014350: 6174 6120 3d20 7365 6c66 2e77 7666 732e  ata = self.wvfs.
-00014360: 7265 6164 2866 696c 656e 616d 6529 0a20  read(filename). 
-00014370: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00014380: 6c66 2e5f 6669 6c74 6572 2873 656c 662e  lf._filter(self.
-00014390: 5f65 6e63 6f64 6566 696c 7465 7270 6174  _encodefilterpat
-000143a0: 732c 2066 696c 656e 616d 652c 2064 6174  s, filename, dat
-000143b0: 6129 0a0a 2020 2020 6465 6620 7777 7269  a)..    def wwri
-000143c0: 7465 280a 2020 2020 2020 2020 7365 6c66  te(.        self
-000143d0: 2c0a 2020 2020 2020 2020 6669 6c65 6e61  ,.        filena
-000143e0: 6d65 3a20 6279 7465 732c 0a20 2020 2020  me: bytes,.     
-000143f0: 2020 2064 6174 613a 2062 7974 6573 2c0a     data: bytes,.
-00014400: 2020 2020 2020 2020 666c 6167 733a 2062          flags: b
-00014410: 7974 6573 2c0a 2020 2020 2020 2020 6261  ytes,.        ba
-00014420: 636b 6772 6f75 6e64 636c 6f73 653d 4661  ckgroundclose=Fa
-00014430: 6c73 652c 0a20 2020 2020 2020 202a 2a6b  lse,.        **k
-00014440: 7761 7267 730a 2020 2020 2920 2d3e 2069  wargs.    ) -> i
-00014450: 6e74 3a0a 2020 2020 2020 2020 2222 2277  nt:.        """w
-00014460: 7269 7465 2060 6064 6174 6160 6020 696e  rite ``data`` in
-00014470: 746f 2060 6066 696c 656e 616d 6560 6020  to ``filename`` 
-00014480: 696e 2074 6865 2077 6f72 6b69 6e67 2064  in the working d
-00014490: 6972 6563 746f 7279 0a0a 2020 2020 2020  irectory..      
-000144a0: 2020 5468 6973 2072 6574 7572 6e73 206c    This returns l
-000144b0: 656e 6774 6820 6f66 2077 7269 7474 656e  ength of written
-000144c0: 2028 6d61 7962 6520 6465 636f 6465 6429   (maybe decoded)
-000144d0: 2064 6174 612e 0a20 2020 2020 2020 2022   data..        "
-000144e0: 2222 0a20 2020 2020 2020 2064 6174 6120  "".        data 
-000144f0: 3d20 7365 6c66 2e5f 6669 6c74 6572 2873  = self._filter(s
-00014500: 656c 662e 5f64 6563 6f64 6566 696c 7465  elf._decodefilte
-00014510: 7270 6174 732c 2066 696c 656e 616d 652c  rpats, filename,
-00014520: 2064 6174 6129 0a20 2020 2020 2020 2069   data).        i
-00014530: 6620 6227 6c27 2069 6e20 666c 6167 733a  f b'l' in flags:
-00014540: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00014550: 662e 7776 6673 2e73 796d 6c69 6e6b 2864  f.wvfs.symlink(d
-00014560: 6174 612c 2066 696c 656e 616d 6529 0a20  ata, filename). 
-00014570: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00014580: 2020 2020 2020 2020 2073 656c 662e 7776           self.wv
-00014590: 6673 2e77 7269 7465 280a 2020 2020 2020  fs.write(.      
-000145a0: 2020 2020 2020 2020 2020 6669 6c65 6e61            filena
-000145b0: 6d65 2c20 6461 7461 2c20 6261 636b 6772  me, data, backgr
-000145c0: 6f75 6e64 636c 6f73 653d 6261 636b 6772  oundclose=backgr
-000145d0: 6f75 6e64 636c 6f73 652c 202a 2a6b 7761  oundclose, **kwa
-000145e0: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
-000145f0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00014600: 2062 2778 2720 696e 2066 6c61 6773 3a0a   b'x' in flags:.
-00014610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014620: 7365 6c66 2e77 7666 732e 7365 7466 6c61  self.wvfs.setfla
-00014630: 6773 2866 696c 656e 616d 652c 2046 616c  gs(filename, Fal
-00014640: 7365 2c20 5472 7565 290a 2020 2020 2020  se, True).      
-00014650: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00014660: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00014670: 2e77 7666 732e 7365 7466 6c61 6773 2866  .wvfs.setflags(f
-00014680: 696c 656e 616d 652c 2046 616c 7365 2c20  ilename, False, 
-00014690: 4661 6c73 6529 0a20 2020 2020 2020 2072  False).        r
-000146a0: 6574 7572 6e20 6c65 6e28 6461 7461 290a  eturn len(data).
-000146b0: 0a20 2020 2064 6566 2077 7772 6974 6564  .    def wwrited
-000146c0: 6174 6128 7365 6c66 2c20 6669 6c65 6e61  ata(self, filena
-000146d0: 6d65 3a20 6279 7465 732c 2064 6174 613a  me: bytes, data:
-000146e0: 2062 7974 6573 2920 2d3e 2062 7974 6573   bytes) -> bytes
-000146f0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00014700: 2073 656c 662e 5f66 696c 7465 7228 7365   self._filter(se
-00014710: 6c66 2e5f 6465 636f 6465 6669 6c74 6572  lf._decodefilter
-00014720: 7061 7473 2c20 6669 6c65 6e61 6d65 2c20  pats, filename, 
-00014730: 6461 7461 290a 0a20 2020 2064 6566 2063  data)..    def c
-00014740: 7572 7265 6e74 7472 616e 7361 6374 696f  urrenttransactio
-00014750: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
-00014760: 2022 2222 7265 7475 726e 2074 6865 2063   """return the c
-00014770: 7572 7265 6e74 2074 7261 6e73 6163 7469  urrent transacti
-00014780: 6f6e 206f 7220 4e6f 6e65 2069 6620 6e6f  on or None if no
-00014790: 6e20 6578 6973 7473 2222 220a 2020 2020  n exists""".    
-000147a0: 2020 2020 6966 2073 656c 662e 5f74 7261      if self._tra
-000147b0: 6e73 7265 663a 0a20 2020 2020 2020 2020  nsref:.         
-000147c0: 2020 2074 7220 3d20 7365 6c66 2e5f 7472     tr = self._tr
-000147d0: 616e 7372 6566 2829 0a20 2020 2020 2020  ansref().       
-000147e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000147f0: 2020 2074 7220 3d20 4e6f 6e65 0a0a 2020     tr = None..  
-00014800: 2020 2020 2020 6966 2074 7220 616e 6420        if tr and 
-00014810: 7472 2e72 756e 6e69 6e67 2829 3a0a 2020  tr.running():.  
-00014820: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00014830: 2074 720a 2020 2020 2020 2020 7265 7475   tr.        retu
-00014840: 726e 204e 6f6e 650a 0a20 2020 2064 6566  rn None..    def
-00014850: 2074 7261 6e73 6163 7469 6f6e 2873 656c   transaction(sel
-00014860: 662c 2064 6573 632c 2072 6570 6f72 743d  f, desc, report=
-00014870: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
-00014880: 6620 7365 6c66 2e75 692e 636f 6e66 6967  f self.ui.config
-00014890: 626f 6f6c 2862 2764 6576 656c 272c 2062  bool(b'devel', b
-000148a0: 2761 6c6c 2d77 6172 6e69 6e67 7327 2920  'all-warnings') 
-000148b0: 6f72 2073 656c 662e 7569 2e63 6f6e 6669  or self.ui.confi
-000148c0: 6762 6f6f 6c28 0a20 2020 2020 2020 2020  gbool(.         
-000148d0: 2020 2062 2764 6576 656c 272c 2062 2763     b'devel', b'c
-000148e0: 6865 636b 2d6c 6f63 6b73 270a 2020 2020  heck-locks'.    
-000148f0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00014900: 2020 2069 6620 7365 6c66 2e5f 6375 7272     if self._curr
-00014910: 656e 746c 6f63 6b28 7365 6c66 2e5f 6c6f  entlock(self._lo
-00014920: 636b 7265 6629 2069 7320 4e6f 6e65 3a0a  ckref) is None:.
-00014930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014940: 7261 6973 6520 6572 726f 722e 5072 6f67  raise error.Prog
-00014950: 7261 6d6d 696e 6745 7272 6f72 2862 2774  rammingError(b't
-00014960: 7261 6e73 6163 7469 6f6e 2072 6571 7569  ransaction requi
-00014970: 7265 7320 6c6f 636b 696e 6727 290a 2020  res locking').  
-00014980: 2020 2020 2020 7472 203d 2073 656c 662e        tr = self.
-00014990: 6375 7272 656e 7474 7261 6e73 6163 7469  currenttransacti
-000149a0: 6f6e 2829 0a20 2020 2020 2020 2069 6620  on().        if 
-000149b0: 7472 2069 7320 6e6f 7420 4e6f 6e65 3a0a  tr is not None:.
-000149c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000149d0: 726e 2074 722e 6e65 7374 286e 616d 653d  rn tr.nest(name=
-000149e0: 6465 7363 290a 0a20 2020 2020 2020 2023  desc)..        #
-000149f0: 2061 626f 7274 2068 6572 6520 6966 2074   abort here if t
-00014a00: 6865 206a 6f75 726e 616c 2061 6c72 6561  he journal alrea
-00014a10: 6479 2065 7869 7374 730a 2020 2020 2020  dy exists.      
-00014a20: 2020 6966 2073 656c 662e 7376 6673 2e65    if self.svfs.e
-00014a30: 7869 7374 7328 6222 6a6f 7572 6e61 6c22  xists(b"journal"
-00014a40: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00014a50: 6169 7365 2065 7272 6f72 2e52 6570 6f45  aise error.RepoE
-00014a60: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00014a70: 2020 2020 2020 5f28 6222 6162 616e 646f        _(b"abando
-00014a80: 6e65 6420 7472 616e 7361 6374 696f 6e20  ned transaction 
-00014a90: 666f 756e 6422 292c 0a20 2020 2020 2020  found"),.       
-00014aa0: 2020 2020 2020 2020 2068 696e 743d 5f28           hint=_(
-00014ab0: 6222 7275 6e20 2768 6720 7265 636f 7665  b"run 'hg recove
-00014ac0: 7227 2074 6f20 636c 6561 6e20 7570 2074  r' to clean up t
-00014ad0: 7261 6e73 6163 7469 6f6e 2229 2c0a 2020  ransaction"),.  
-00014ae0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00014af0: 2020 2020 2023 2041 7420 7468 6174 2070       # At that p
-00014b00: 6f69 6e74 2079 6f75 7220 6469 7273 7461  oint your dirsta
-00014b10: 7465 2073 686f 756c 6420 6265 2063 6c65  te should be cle
-00014b20: 616e 3a0a 2020 2020 2020 2020 230a 2020  an:.        #.  
-00014b30: 2020 2020 2020 2320 2d20 4966 2079 6f75        # - If you
-00014b40: 2064 6f6e 2774 2068 6176 6520 7468 6520   don't have the 
-00014b50: 776c 6f63 6b2c 2077 6879 2077 6f75 6c64  wlock, why would
-00014b60: 2079 6f75 2073 7469 6c6c 2068 6176 6520   you still have 
-00014b70: 6120 6469 7274 790a 2020 2020 2020 2020  a dirty.        
-00014b80: 2320 2020 6469 7273 7461 7465 203f 0a20  #   dirstate ?. 
-00014b90: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
-00014ba0: 2023 202d 2049 6620 796f 7520 686f 6c64   # - If you hold
-00014bb0: 2074 6865 2077 6c6f 636b 2c20 796f 7520   the wlock, you 
-00014bc0: 7368 6f75 6c64 206e 6f74 2062 6520 6f70  should not be op
-00014bd0: 656e 696e 6720 6120 7472 616e 7361 6374  ening a transact
-00014be0: 696f 6e20 696e 0a20 2020 2020 2020 2023  ion in.        #
-00014bf0: 2020 2074 6865 206d 6964 646c 6520 6f66     the middle of
-00014c00: 2061 2060 6469 7374 6174 652e 6368 616e   a `distate.chan
-00014c10: 6769 6e67 5f2a 6020 626c 6f63 6b2e 2054  ging_*` block. T
-00014c20: 6865 2074 7261 6e73 6163 7469 6f6e 206e  he transaction n
-00014c30: 6565 6473 2074 6f0a 2020 2020 2020 2020  eeds to.        
-00014c40: 2320 2020 6265 206f 7065 6e20 6265 666f  #   be open befo
-00014c50: 7265 2074 6861 7420 616e 6420 7772 6170  re that and wrap
-00014c60: 2074 6865 2063 6861 6e67 652d 636f 6e74   the change-cont
-00014c70: 6578 742e 0a20 2020 2020 2020 2023 0a20  ext..        #. 
-00014c80: 2020 2020 2020 2023 202d 2049 6620 796f         # - If yo
-00014c90: 7520 6172 6520 6e6f 7420 7769 7468 696e  u are not within
-00014ca0: 2061 2060 6469 7273 7461 7465 2e63 6861   a `dirstate.cha
-00014cb0: 6e67 696e 675f 2a60 2063 6f6e 7465 7874  nging_*` context
-00014cc0: 2c20 7768 7920 6973 206f 7572 0a20 2020  , why is our.   
-00014cd0: 2020 2020 2023 2020 2064 6972 7374 6174       #   dirstat
-00014ce0: 6520 6469 7274 793f 0a20 2020 2020 2020  e dirty?.       
-00014cf0: 2069 6620 7365 6c66 2e64 6972 7374 6174   if self.dirstat
-00014d00: 652e 5f64 6972 7479 3a0a 2020 2020 2020  e._dirty:.      
-00014d10: 2020 2020 2020 6d20 3d20 2263 616e 6e6f        m = "canno
-00014d20: 7420 6f70 656e 2061 2074 7261 6e73 6163  t open a transac
-00014d30: 7469 6f6e 2077 6974 6820 6120 6469 7274  tion with a dirt
-00014d40: 7920 6469 7273 7461 7465 220a 2020 2020  y dirstate".    
-00014d50: 2020 2020 2020 2020 7261 6973 6520 6572          raise er
-00014d60: 726f 722e 5072 6f67 7261 6d6d 696e 6745  ror.ProgrammingE
-00014d70: 7272 6f72 286d 290a 0a20 2020 2020 2020  rror(m)..       
-00014d80: 2069 6462 6173 6520 3d20 6222 252e 3430   idbase = b"%.40
-00014d90: 6623 2566 2220 2520 2872 616e 646f 6d2e  f#%f" % (random.
-00014da0: 7261 6e64 6f6d 2829 2c20 7469 6d65 2e74  random(), time.t
-00014db0: 696d 6528 2929 0a20 2020 2020 2020 2068  ime()).        h
-00014dc0: 6120 3d20 6865 7828 6861 7368 7574 696c  a = hex(hashutil
-00014dd0: 2e73 6861 3128 6964 6261 7365 292e 6469  .sha1(idbase).di
-00014de0: 6765 7374 2829 290a 2020 2020 2020 2020  gest()).        
-00014df0: 7478 6e69 6420 3d20 6227 5458 4e3a 2720  txnid = b'TXN:' 
-00014e00: 2b20 6861 0a20 2020 2020 2020 2073 656c  + ha.        sel
-00014e10: 662e 686f 6f6b 2862 2770 7265 7478 6e6f  f.hook(b'pretxno
-00014e20: 7065 6e27 2c20 7468 726f 773d 5472 7565  pen', throw=True
-00014e30: 2c20 7478 6e6e 616d 653d 6465 7363 2c20  , txnname=desc, 
-00014e40: 7478 6e69 643d 7478 6e69 6429 0a0a 2020  txnid=txnid)..  
-00014e50: 2020 2020 2020 7365 6c66 2e5f 7772 6974        self._writ
-00014e60: 656a 6f75 726e 616c 2864 6573 6329 0a20  ejournal(desc). 
-00014e70: 2020 2020 2020 2072 656e 616d 6573 203d         renames =
-00014e80: 205b 2876 6673 2c20 782c 2075 6e64 6f6e   [(vfs, x, undon
-00014e90: 616d 6528 7829 2920 666f 7220 7666 732c  ame(x)) for vfs,
-00014ea0: 2078 2069 6e20 7365 6c66 2e5f 6a6f 7572   x in self._jour
-00014eb0: 6e61 6c66 696c 6573 2829 5d0a 2020 2020  nalfiles()].    
-00014ec0: 2020 2020 6966 2072 6570 6f72 743a 0a20      if report:. 
-00014ed0: 2020 2020 2020 2020 2020 2072 7020 3d20             rp = 
-00014ee0: 7265 706f 7274 0a20 2020 2020 2020 2065  report.        e
-00014ef0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00014f00: 2072 7020 3d20 7365 6c66 2e75 692e 7761   rp = self.ui.wa
-00014f10: 726e 0a20 2020 2020 2020 2076 6673 6d61  rn.        vfsma
-00014f20: 7020 3d20 7b62 2770 6c61 696e 273a 2073  p = {b'plain': s
-00014f30: 656c 662e 7666 732c 2062 2773 746f 7265  elf.vfs, b'store
-00014f40: 273a 2073 656c 662e 7376 6673 7d20 2023  ': self.svfs}  #
-00014f50: 2072 6f6f 7420 6f66 202e 6867 2f0a 2020   root of .hg/.  
-00014f60: 2020 2020 2020 2320 7765 206d 7573 7420        # we must 
-00014f70: 6176 6f69 6420 6379 636c 6963 2072 6566  avoid cyclic ref
-00014f80: 6572 656e 6365 2062 6574 7765 656e 2072  erence between r
-00014f90: 6570 6f20 616e 6420 7472 616e 7361 6374  epo and transact
-00014fa0: 696f 6e2e 0a20 2020 2020 2020 2072 6570  ion..        rep
-00014fb0: 6f72 6566 203d 2077 6561 6b72 6566 2e72  oref = weakref.r
-00014fc0: 6566 2873 656c 6629 0a20 2020 2020 2020  ef(self).       
-00014fd0: 2023 2043 6f64 6520 746f 2074 7261 636b   # Code to track
-00014fe0: 2074 6167 206d 6f76 656d 656e 740a 2020   tag movement.  
-00014ff0: 2020 2020 2020 230a 2020 2020 2020 2020        #.        
-00015000: 2320 5369 6e63 6520 7461 6773 2061 7265  # Since tags are
-00015010: 2061 6c6c 2068 616e 646c 6564 2061 7320   all handled as 
-00015020: 6669 6c65 2063 6f6e 7465 6e74 2c20 6974  file content, it
-00015030: 2069 7320 6163 7475 616c 6c79 2071 7569   is actually qui
-00015040: 7465 2068 6172 640a 2020 2020 2020 2020  te hard.        
-00015050: 2320 746f 2074 7261 636b 2074 6865 7365  # to track these
-00015060: 206d 6f76 656d 656e 7420 6672 6f6d 2061   movement from a
-00015070: 2063 6f64 6520 7065 7273 7065 6374 6976   code perspectiv
-00015080: 652e 2053 6f20 7765 2066 616c 6c62 6163  e. So we fallbac
-00015090: 6b20 746f 2061 0a20 2020 2020 2020 2023  k to a.        #
-000150a0: 2074 7261 636b 696e 6720 6174 2074 6865   tracking at the
-000150b0: 2072 6570 6f73 6974 6f72 7920 6c65 7665   repository leve
-000150c0: 6c2e 204f 6e65 2063 6f75 6c64 2065 6e76  l. One could env
-000150d0: 6973 696f 6e20 746f 2074 7261 636b 2063  ision to track c
-000150e0: 6861 6e67 6573 0a20 2020 2020 2020 2023  hanges.        #
-000150f0: 2074 6f20 7468 6520 272e 6867 7461 6773   to the '.hgtags
-00015100: 2720 6669 6c65 2074 6872 6f75 6768 2063  ' file through c
-00015110: 6861 6e67 6567 726f 7570 2061 7070 6c79  hangegroup apply
-00015120: 2062 7574 2074 6861 7420 6661 696c 7320   but that fails 
-00015130: 746f 0a20 2020 2020 2020 2023 2063 6f70  to.        # cop
-00015140: 6520 7769 7468 2063 6173 6520 7768 6572  e with case wher
-00015150: 6520 7472 616e 7361 6374 696f 6e20 6578  e transaction ex
-00015160: 706f 7365 206e 6577 2068 6561 6473 2077  pose new heads w
-00015170: 6974 686f 7574 2063 6861 6e67 6567 726f  ithout changegro
-00015180: 7570 0a20 2020 2020 2020 2023 2062 6569  up.        # bei
-00015190: 6e67 2069 6e76 6f6c 7665 6420 2865 673a  ng involved (eg:
-000151a0: 2070 6861 7365 206d 6f76 656d 656e 7429   phase movement)
-000151b0: 2e0a 2020 2020 2020 2020 230a 2020 2020  ..        #.    
-000151c0: 2020 2020 2320 466f 7220 6e6f 772c 2057      # For now, W
-000151d0: 6520 6761 7465 2074 6865 2066 6561 7475  e gate the featu
-000151e0: 7265 2062 6568 696e 6420 6120 666c 6167  re behind a flag
-000151f0: 2073 696e 6365 2074 6869 7320 6c69 6b65   since this like
-00015200: 6c79 2063 6f6d 6573 0a20 2020 2020 2020  ly comes.       
-00015210: 2023 2077 6974 6820 7065 7266 6f72 6d61   # with performa
-00015220: 6e63 6520 696d 7061 6374 732e 2054 6865  nce impacts. The
-00015230: 2063 7572 7265 6e74 2063 6f64 6520 7275   current code ru
-00015240: 6e20 6d6f 7265 206f 6674 656e 2074 6861  n more often tha
-00015250: 6e20 6e65 6564 6564 0a20 2020 2020 2020  n needed.       
-00015260: 2023 2061 6e64 2064 6f20 6e6f 7420 7573   # and do not us
-00015270: 6520 6361 6368 6573 2061 7320 6d75 6368  e caches as much
-00015280: 2061 7320 6974 2063 6f75 6c64 2e20 2054   as it could.  T
-00015290: 6865 2063 7572 7265 6e74 2066 6f63 7573  he current focus
-000152a0: 2069 7320 6f6e 0a20 2020 2020 2020 2023   is on.        #
-000152b0: 2074 6865 2062 6568 6176 696f 7220 6f66   the behavior of
-000152c0: 2074 6865 2066 6561 7475 7265 2073 6f20   the feature so 
-000152d0: 7765 2064 6973 6162 6c65 2069 7420 6279  we disable it by
-000152e0: 2064 6566 6175 6c74 2e20 5468 6520 666c   default. The fl
-000152f0: 6167 0a20 2020 2020 2020 2023 2077 696c  ag.        # wil
-00015300: 6c20 6265 2072 656d 6f76 6564 2077 6865  l be removed whe
-00015310: 6e20 7765 2061 7265 2068 6170 7079 2077  n we are happy w
-00015320: 6974 6820 7468 6520 7065 7266 6f72 6d61  ith the performa
-00015330: 6e63 6520 696d 7061 6374 2e0a 2020 2020  nce impact..    
-00015340: 2020 2020 230a 2020 2020 2020 2020 2320      #.        # 
-00015350: 4f6e 6365 2074 6869 7320 6665 6174 7572  Once this featur
-00015360: 6520 6973 206e 6f20 6c6f 6e67 6572 2065  e is no longer e
-00015370: 7870 6572 696d 656e 7461 6c20 6d6f 7665  xperimental move
-00015380: 2074 6865 2066 6f6c 6c6f 7769 6e67 0a20   the following. 
-00015390: 2020 2020 2020 2023 2064 6f63 756d 656e         # documen
-000153a0: 7461 7469 6f6e 2074 6f20 7468 6520 6170  tation to the ap
-000153b0: 7072 6f70 7269 6174 6520 6865 6c70 2073  propriate help s
-000153c0: 6563 7469 6f6e 3a0a 2020 2020 2020 2020  ection:.        
-000153d0: 230a 2020 2020 2020 2020 2320 5468 6520  #.        # The 
-000153e0: 6060 4847 5f54 4147 5f4d 4f56 4544 6060  ``HG_TAG_MOVED``
-000153f0: 2076 6172 6961 626c 6520 7769 6c6c 2062   variable will b
-00015400: 6520 7365 7420 6966 2074 6865 2074 7261  e set if the tra
-00015410: 6e73 6163 7469 6f6e 2074 6f75 6368 6564  nsaction touched
-00015420: 0a20 2020 2020 2020 2023 2074 6167 7320  .        # tags 
-00015430: 286e 6577 206f 7220 6368 616e 6765 6420  (new or changed 
-00015440: 6f72 2064 656c 6574 6564 2074 6167 7329  or deleted tags)
-00015450: 2e20 496e 2061 6464 6974 696f 6e20 7468  . In addition th
-00015460: 6520 6465 7461 696c 7320 6f66 0a20 2020  e details of.   
-00015470: 2020 2020 2023 2074 6865 7365 2063 6861       # these cha
-00015480: 6e67 6573 2061 7265 206d 6164 6520 6176  nges are made av
-00015490: 6169 6c61 626c 6520 696e 2061 2066 696c  ailable in a fil
-000154a0: 6520 6174 3a0a 2020 2020 2020 2020 2320  e at:.        # 
-000154b0: 2020 2020 6060 5245 504f 524f 4f54 2f2e      ``REPOROOT/.
-000154c0: 6867 2f63 6861 6e67 6573 2f74 6167 732e  hg/changes/tags.
-000154d0: 6368 616e 6765 7360 602e 0a20 2020 2020  changes``..     
-000154e0: 2020 2023 204d 616b 6520 7375 7265 2079     # Make sure y
-000154f0: 6f75 2063 6865 636b 2066 6f72 2048 475f  ou check for HG_
-00015500: 5441 475f 4d4f 5645 4420 6265 666f 7265  TAG_MOVED before
-00015510: 2072 6561 6469 6e67 2074 6861 7420 6669   reading that fi
-00015520: 6c65 2061 7320 6974 0a20 2020 2020 2020  le as it.       
-00015530: 2023 206d 6967 6874 2065 7869 7374 2066   # might exist f
-00015540: 726f 6d20 6120 7072 6576 696f 7573 2074  rom a previous t
-00015550: 7261 6e73 6163 7469 6f6e 2065 7665 6e20  ransaction even 
-00015560: 6966 206e 6f20 7461 6720 7765 7265 2074  if no tag were t
-00015570: 6f75 6368 6564 0a20 2020 2020 2020 2023  ouched.        #
-00015580: 2069 6e20 7468 6973 206f 6e65 2e20 4368   in this one. Ch
-00015590: 616e 6765 7320 6172 6520 7265 636f 7264  anges are record
-000155a0: 6564 2069 6e20 6120 6c69 6e65 2062 6173  ed in a line bas
-000155b0: 6520 666f 726d 6174 3a3a 0a20 2020 2020  e format::.     
-000155c0: 2020 2023 0a20 2020 2020 2020 2023 2020     #.        #  
-000155d0: 2020 203c 6163 7469 6f6e 3e20 3c68 6578     <action> <hex
-000155e0: 2d6e 6f64 653e 203c 7461 672d 6e61 6d65  -node> <tag-name
-000155f0: 3e5c 6e0a 2020 2020 2020 2020 230a 2020  >\n.        #.  
-00015600: 2020 2020 2020 2320 4163 7469 6f6e 7320        # Actions 
-00015610: 6172 6520 6465 6669 6e65 6420 6173 2066  are defined as f
-00015620: 6f6c 6c6f 773a 0a20 2020 2020 2020 2023  ollow:.        #
-00015630: 2020 2022 2d52 223a 2074 6167 2069 7320     "-R": tag is 
-00015640: 7265 6d6f 7665 642c 0a20 2020 2020 2020  removed,.       
-00015650: 2023 2020 2022 2b41 223a 2074 6167 2069   #   "+A": tag i
-00015660: 7320 6164 6465 642c 0a20 2020 2020 2020  s added,.       
-00015670: 2023 2020 2022 2d4d 223a 2074 6167 2069   #   "-M": tag i
-00015680: 7320 6d6f 7665 6420 286f 6c64 2076 616c  s moved (old val
-00015690: 7565 292c 0a20 2020 2020 2020 2023 2020  ue),.        #  
-000156a0: 2022 2b4d 223a 2074 6167 2069 7320 6d6f   "+M": tag is mo
-000156b0: 7665 6420 286e 6577 2076 616c 7565 292c  ved (new value),
-000156c0: 0a20 2020 2020 2020 2074 7261 636b 7461  .        trackta
-000156d0: 6773 203d 206c 616d 6264 6120 783a 204e  gs = lambda x: N
-000156e0: 6f6e 650a 2020 2020 2020 2020 2320 6578  one.        # ex
-000156f0: 7065 7269 6d65 6e74 616c 2063 6f6e 6669  perimental confi
-00015700: 673a 2065 7870 6572 696d 656e 7461 6c2e  g: experimental.
-00015710: 686f 6f6b 2d74 7261 636b 2d74 6167 730a  hook-track-tags.
-00015720: 2020 2020 2020 2020 7368 6f75 6c64 7472          shouldtr
-00015730: 6163 6b74 6167 7320 3d20 7365 6c66 2e75  acktags = self.u
-00015740: 692e 636f 6e66 6967 626f 6f6c 280a 2020  i.configbool(.  
-00015750: 2020 2020 2020 2020 2020 6227 6578 7065            b'expe
-00015760: 7269 6d65 6e74 616c 272c 2062 2768 6f6f  rimental', b'hoo
-00015770: 6b2d 7472 6163 6b2d 7461 6773 270a 2020  k-track-tags'.  
-00015780: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00015790: 6966 2064 6573 6320 213d 2062 2773 7472  if desc != b'str
-000157a0: 6970 2720 616e 6420 7368 6f75 6c64 7472  ip' and shouldtr
-000157b0: 6163 6b74 6167 733a 0a20 2020 2020 2020  acktags:.       
-000157c0: 2020 2020 206f 6c64 6865 6164 7320 3d20       oldheads = 
-000157d0: 7365 6c66 2e63 6861 6e67 656c 6f67 2e68  self.changelog.h
-000157e0: 6561 6472 6576 7328 290a 0a20 2020 2020  eadrevs()..     
-000157f0: 2020 2020 2020 2064 6566 2074 7261 636b         def track
-00015800: 7461 6773 2874 7232 293a 0a20 2020 2020  tags(tr2):.     
-00015810: 2020 2020 2020 2020 2020 2072 6570 6f20             repo 
-00015820: 3d20 7265 706f 7265 6628 290a 2020 2020  = reporef().    
-00015830: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00015840: 7274 2072 6570 6f20 6973 206e 6f74 204e  rt repo is not N
-00015850: 6f6e 6520 2023 2068 656c 7020 7079 7479  one  # help pyty
-00015860: 7065 0a20 2020 2020 2020 2020 2020 2020  pe.             
-00015870: 2020 206f 6c64 666e 6f64 6573 203d 2074     oldfnodes = t
-00015880: 6167 736d 6f64 2e66 6e6f 6465 7265 7673  agsmod.fnoderevs
-00015890: 2872 6570 6f2e 7569 2c20 7265 706f 2c20  (repo.ui, repo, 
-000158a0: 6f6c 6468 6561 6473 290a 2020 2020 2020  oldheads).      
-000158b0: 2020 2020 2020 2020 2020 6e65 7768 6561            newhea
-000158c0: 6473 203d 2072 6570 6f2e 6368 616e 6765  ds = repo.change
-000158d0: 6c6f 672e 6865 6164 7265 7673 2829 0a20  log.headrevs(). 
-000158e0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000158f0: 6577 666e 6f64 6573 203d 2074 6167 736d  ewfnodes = tagsm
-00015900: 6f64 2e66 6e6f 6465 7265 7673 2872 6570  od.fnoderevs(rep
-00015910: 6f2e 7569 2c20 7265 706f 2c20 6e65 7768  o.ui, repo, newh
-00015920: 6561 6473 290a 2020 2020 2020 2020 2020  eads).          
-00015930: 2020 2020 2020 2320 6e6f 7465 733a 2077        # notes: w
-00015940: 6520 636f 6d70 6172 6520 6c69 7374 7320  e compare lists 
-00015950: 6865 7265 2e0a 2020 2020 2020 2020 2020  here..          
-00015960: 2020 2020 2020 2320 4173 2077 6520 646f        # As we do
-00015970: 2069 7420 6f6e 6c79 206f 6e63 6520 6275   it only once bu
-00015980: 6964 696e 6720 7365 7420 776f 756c 6420  iding set would 
-00015990: 6e6f 7420 6265 2063 6865 6170 6572 0a20  not be cheaper. 
-000159a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000159b0: 6861 6e67 6573 203d 2074 6167 736d 6f64  hanges = tagsmod
-000159c0: 2e64 6966 6674 6167 7328 7265 706f 2e75  .difftags(repo.u
-000159d0: 692c 2072 6570 6f2c 206f 6c64 666e 6f64  i, repo, oldfnod
-000159e0: 6573 2c20 6e65 7766 6e6f 6465 7329 0a20  es, newfnodes). 
-000159f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00015a00: 6620 6368 616e 6765 733a 0a20 2020 2020  f changes:.     
-00015a10: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00015a20: 7232 2e68 6f6f 6b61 7267 735b 6227 7461  r2.hookargs[b'ta
-00015a30: 675f 6d6f 7665 6427 5d20 3d20 6227 3127  g_moved'] = b'1'
-00015a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015a50: 2020 2020 2077 6974 6820 7265 706f 2e76       with repo.v
-00015a60: 6673 280a 2020 2020 2020 2020 2020 2020  fs(.            
-00015a70: 2020 2020 2020 2020 2020 2020 6227 6368              b'ch
-00015a80: 616e 6765 732f 7461 6773 2e63 6861 6e67  anges/tags.chang
-00015a90: 6573 272c 2062 2777 272c 2061 746f 6d69  es', b'w', atomi
-00015aa0: 6374 656d 703d 5472 7565 0a20 2020 2020  ctemp=True.     
-00015ab0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00015ac0: 2061 7320 6368 616e 6765 7366 696c 653a   as changesfile:
-00015ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015ae0: 2020 2020 2020 2020 2023 206e 6f74 653a           # note:
-00015af0: 2077 6520 646f 206e 6f74 2072 6567 6973   we do not regis
-00015b00: 7465 7220 7468 6520 6669 6c65 2074 6f20  ter the file to 
-00015b10: 7468 6520 7472 616e 7361 6374 696f 6e0a  the transaction.
-00015b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b30: 2020 2020 2020 2020 2320 6265 6361 7573          # becaus
-00015b40: 6520 7765 206e 6565 6473 2069 7420 746f  e we needs it to
-00015b50: 2073 7469 6c6c 2065 7869 7374 206f 6e20   still exist on 
-00015b60: 7468 6520 7472 616e 7361 6374 696f 6e0a  the transaction.
-00015b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b80: 2020 2020 2020 2020 2320 6973 2063 6c6f          # is clo
-00015b90: 7365 2028 666f 7220 7478 6e63 6c6f 7365  se (for txnclose
-00015ba0: 2068 6f6f 6b73 290a 2020 2020 2020 2020   hooks).        
-00015bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015bc0: 7461 6773 6d6f 642e 7772 6974 6564 6966  tagsmod.writedif
-00015bd0: 6628 6368 616e 6765 7366 696c 652c 2063  f(changesfile, c
-00015be0: 6861 6e67 6573 290a 0a20 2020 2020 2020  hanges)..       
-00015bf0: 2064 6566 2076 616c 6964 6174 6528 7472   def validate(tr
-00015c00: 3229 3a0a 2020 2020 2020 2020 2020 2020  2):.            
-00015c10: 2222 2277 696c 6c20 7275 6e20 7072 652d  """will run pre-
-00015c20: 636c 6f73 696e 6720 686f 6f6b 7322 2222  closing hooks"""
-00015c30: 0a20 2020 2020 2020 2020 2020 2023 2058  .            # X
-00015c40: 5858 2074 6865 2074 7261 6e73 6163 7469  XX the transacti
-00015c50: 6f6e 2041 5049 2069 7320 6120 6269 7420  on API is a bit 
-00015c60: 6c61 636b 696e 6720 6865 7265 2073 6f20  lacking here so 
-00015c70: 7765 2074 616b 6520 6120 6861 636b 790a  we take a hacky.
-00015c80: 2020 2020 2020 2020 2020 2020 2320 7061              # pa
-00015c90: 7468 2066 6f72 206e 6f77 0a20 2020 2020  th for now.     
-00015ca0: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
-00015cb0: 2020 2020 2023 2057 6520 6361 6e6e 6f74       # We cannot
-00015cc0: 2061 6464 2074 6869 7320 6173 2061 2022   add this as a "
-00015cd0: 7065 6e64 696e 6722 2068 6f6f 6b73 2073  pending" hooks s
-00015ce0: 696e 6365 2074 6865 2027 7472 2e68 6f6f  ince the 'tr.hoo
-00015cf0: 6b61 7267 7327 0a20 2020 2020 2020 2020  kargs'.         
-00015d00: 2020 2023 2064 6963 7420 6973 2063 6f70     # dict is cop
-00015d10: 6965 6420 6265 666f 7265 2074 6865 7365  ied before these
-00015d20: 2072 756e 2e20 496e 2061 6464 6974 696f   run. In additio
-00015d30: 6e20 7765 206e 6565 6473 2074 6865 2064  n we needs the d
-00015d40: 6174 610a 2020 2020 2020 2020 2020 2020  ata.            
-00015d50: 2320 6176 6169 6c61 626c 6520 746f 2069  # available to i
-00015d60: 6e20 6d65 6d6f 7279 2068 6f6f 6b73 2074  n memory hooks t
-00015d70: 6f6f 2e0a 2020 2020 2020 2020 2020 2020  oo..            
-00015d80: 230a 2020 2020 2020 2020 2020 2020 2320  #.            # 
-00015d90: 4d6f 7265 6f76 6572 2c20 7765 2061 6c73  Moreover, we als
-00015da0: 6f20 6e65 6564 2074 6f20 6d61 6b65 2073  o need to make s
-00015db0: 7572 6520 7468 6973 2072 756e 7320 6265  ure this runs be
-00015dc0: 666f 7265 2074 786e 636c 6f73 650a 2020  fore txnclose.  
-00015dd0: 2020 2020 2020 2020 2020 2320 686f 6f6b            # hook
-00015de0: 7320 616e 6420 7468 6572 6520 6973 206e  s and there is n
-00015df0: 6f20 2270 656e 6469 6e67 2220 6d65 6368  o "pending" mech
-00015e00: 616e 6973 6d20 7468 6174 2077 6f75 6c64  anism that would
-00015e10: 2065 7865 6375 7465 0a20 2020 2020 2020   execute.       
-00015e20: 2020 2020 2023 206c 6f67 6963 206f 6e6c       # logic onl
-00015e30: 7920 6966 2068 6f6f 6b73 2061 7265 2061  y if hooks are a
-00015e40: 626f 7574 2074 6f20 7275 6e2e 0a20 2020  bout to run..   
-00015e50: 2020 2020 2020 2020 2023 0a20 2020 2020           #.     
-00015e60: 2020 2020 2020 2023 2046 6978 696e 6720         # Fixing 
-00015e70: 7468 6973 206c 696d 6974 6174 696f 6e20  this limitation 
-00015e80: 6f66 2074 6865 2074 7261 6e73 6163 7469  of the transacti
-00015e90: 6f6e 2069 7320 616c 736f 206e 6565 6465  on is also neede
-00015ea0: 6420 746f 2074 7261 636b 0a20 2020 2020  d to track.     
-00015eb0: 2020 2020 2020 2023 206f 7468 6572 2066         # other f
-00015ec0: 616d 696c 6965 7320 6f66 2063 6861 6e67  amilies of chang
-00015ed0: 6573 2028 626f 6f6b 6d61 726b 732c 2070  es (bookmarks, p
-00015ee0: 6861 7365 732c 206f 6273 6f6c 6573 6365  hases, obsolesce
-00015ef0: 6e63 6529 2e0a 2020 2020 2020 2020 2020  nce)..          
-00015f00: 2020 230a 2020 2020 2020 2020 2020 2020    #.            
-00015f10: 2320 5468 6973 2077 696c 6c20 6861 7665  # This will have
-00015f20: 2074 6f20 6265 2066 6978 6564 2062 6566   to be fixed bef
-00015f30: 6f72 6520 7765 2072 656d 6f76 6520 7468  ore we remove th
-00015f40: 6520 6578 7065 7269 6d65 6e74 616c 0a20  e experimental. 
-00015f50: 2020 2020 2020 2020 2020 2023 2067 6174             # gat
-00015f60: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
-00015f70: 2074 7261 636b 7461 6773 2874 7232 290a   tracktags(tr2).
-00015f80: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00015f90: 203d 2072 6570 6f72 6566 2829 0a20 2020   = reporef().   
-00015fa0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00015fb0: 7265 706f 2069 7320 6e6f 7420 4e6f 6e65  repo is not None
-00015fc0: 2020 2320 6865 6c70 2070 7974 7970 650a    # help pytype.
-00015fd0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
-00015fe0: 676c 6568 6561 646f 7074 203d 2028 6227  gleheadopt = (b'
-00015ff0: 6578 7065 7269 6d65 6e74 616c 272c 2062  experimental', b
-00016000: 2773 696e 676c 652d 6865 6164 2d70 6572  'single-head-per
-00016010: 2d62 7261 6e63 6827 290a 2020 2020 2020  -branch').      
-00016020: 2020 2020 2020 7369 6e67 6c65 6865 6164        singlehead
-00016030: 203d 2072 6570 6f2e 7569 2e63 6f6e 6669   = repo.ui.confi
-00016040: 6762 6f6f 6c28 2a73 696e 676c 6568 6561  gbool(*singlehea
-00016050: 646f 7074 290a 2020 2020 2020 2020 2020  dopt).          
-00016060: 2020 6966 2073 696e 676c 6568 6561 643a    if singlehead:
-00016070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016080: 2073 696e 676c 6568 6561 6473 7562 203d   singleheadsub =
-00016090: 2072 6570 6f2e 7569 2e63 6f6e 6669 6773   repo.ui.configs
-000160a0: 7562 6f70 7469 6f6e 7328 2a73 696e 676c  uboptions(*singl
-000160b0: 6568 6561 646f 7074 295b 315d 0a20 2020  eheadopt)[1].   
-000160c0: 2020 2020 2020 2020 2020 2020 2061 6363               acc
-000160d0: 6f75 6e74 636c 6f73 6564 203d 2073 696e  ountclosed = sin
-000160e0: 676c 6568 6561 6473 7562 2e67 6574 280a  gleheadsub.get(.
-000160f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016100: 2020 2020 6222 6163 636f 756e 742d 636c      b"account-cl
-00016110: 6f73 6564 2d68 6561 6473 222c 2046 616c  osed-heads", Fal
-00016120: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-00016130: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00016140: 2020 2020 2069 6620 7369 6e67 6c65 6865       if singlehe
-00016150: 6164 7375 622e 6765 7428 6222 7075 626c  adsub.get(b"publ
-00016160: 6963 2d63 6861 6e67 6573 2d6f 6e6c 7922  ic-changes-only"
-00016170: 2c20 4661 6c73 6529 3a0a 2020 2020 2020  , False):.      
-00016180: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00016190: 6c74 6572 6e61 6d65 203d 2062 2269 6d6d  ltername = b"imm
-000161a0: 7574 6162 6c65 220a 2020 2020 2020 2020  utable".        
-000161b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00010250: 2320 646f 206e 6f74 2065 7863 6c75 6465  # do not exclude
+00010260: 2065 7870 6c69 6369 746c 792d 7370 6563   explicitly-spec
+00010270: 6966 6965 6420 7061 7468 7320 736f 2074  ified paths so t
+00010280: 6861 7420 7468 6579 2063 616e 0a20 2020  hat they can.   
+00010290: 2020 2020 2020 2020 2020 2020 2023 2062               # b
+000102a0: 6520 7761 726e 6564 206c 6174 6572 206f  e warned later o
+000102b0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+000102c0: 2020 656d 203d 206d 6174 6368 6d6f 642e    em = matchmod.
+000102d0: 6578 6163 7428 6d61 7463 682e 6669 6c65  exact(match.file
+000102e0: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
+000102f0: 2020 2020 206e 6d20 3d20 6d61 7463 686d       nm = matchm
+00010300: 6f64 2e75 6e69 6f6e 6d61 7463 6865 7228  od.unionmatcher(
+00010310: 5b73 656c 662e 5f6e 6172 726f 776d 6174  [self._narrowmat
+00010320: 6368 2c20 656d 5d29 0a20 2020 2020 2020  ch, em]).       
+00010330: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00010340: 6d61 7463 686d 6f64 2e69 6e74 6572 7365  matchmod.interse
+00010350: 6374 6d61 7463 6865 7273 286d 6174 6368  ctmatchers(match
+00010360: 2c20 6e6d 290a 2020 2020 2020 2020 2020  , nm).          
+00010370: 2020 7265 7475 726e 206d 6174 6368 6d6f    return matchmo
+00010380: 642e 696e 7465 7273 6563 746d 6174 6368  d.intersectmatch
+00010390: 6572 7328 6d61 7463 682c 2073 656c 662e  ers(match, self.
+000103a0: 5f6e 6172 726f 776d 6174 6368 290a 2020  _narrowmatch).  
+000103b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000103c0: 662e 5f6e 6172 726f 776d 6174 6368 0a0a  f._narrowmatch..
+000103d0: 2020 2020 6465 6620 7365 746e 6172 726f      def setnarro
+000103e0: 7770 6174 7328 7365 6c66 2c20 6e65 7769  wpats(self, newi
+000103f0: 6e63 6c75 6465 732c 206e 6577 6578 636c  ncludes, newexcl
+00010400: 7564 6573 293a 0a20 2020 2020 2020 206e  udes):.        n
+00010410: 6172 726f 7773 7065 632e 7361 7665 2873  arrowspec.save(s
+00010420: 656c 662c 206e 6577 696e 636c 7564 6573  elf, newincludes
+00010430: 2c20 6e65 7765 7863 6c75 6465 7329 0a20  , newexcludes). 
+00010440: 2020 2020 2020 2073 656c 662e 696e 7661         self.inva
+00010450: 6c69 6461 7465 2863 6c65 6172 6669 6c65  lidate(clearfile
+00010460: 6361 6368 653d 5472 7565 290a 0a20 2020  cache=True)..   
+00010470: 2040 756e 6669 6c74 6572 6564 7072 6f70   @unfilteredprop
+00010480: 6572 7479 6361 6368 650a 2020 2020 6465  ertycache.    de
+00010490: 6620 5f71 7569 636b 5f61 6363 6573 735f  f _quick_access_
+000104a0: 6368 616e 6765 6964 5f6e 756c 6c28 7365  changeid_null(se
+000104b0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+000104c0: 7572 6e20 7b0a 2020 2020 2020 2020 2020  urn {.          
+000104d0: 2020 6227 6e75 6c6c 273a 2028 6e75 6c6c    b'null': (null
+000104e0: 7265 762c 2073 656c 662e 6e6f 6465 636f  rev, self.nodeco
+000104f0: 6e73 7461 6e74 732e 6e75 6c6c 6964 292c  nstants.nullid),
+00010500: 0a20 2020 2020 2020 2020 2020 206e 756c  .            nul
+00010510: 6c72 6576 3a20 286e 756c 6c72 6576 2c20  lrev: (nullrev, 
+00010520: 7365 6c66 2e6e 6f64 6563 6f6e 7374 616e  self.nodeconstan
+00010530: 7473 2e6e 756c 6c69 6429 2c0a 2020 2020  ts.nullid),.    
+00010540: 2020 2020 2020 2020 7365 6c66 2e6e 756c          self.nul
+00010550: 6c69 643a 2028 6e75 6c6c 7265 762c 2073  lid: (nullrev, s
+00010560: 656c 662e 6e75 6c6c 6964 292c 0a20 2020  elf.nullid),.   
+00010570: 2020 2020 207d 0a0a 2020 2020 4075 6e66       }..    @unf
+00010580: 696c 7465 7265 6470 726f 7065 7274 7963  ilteredpropertyc
+00010590: 6163 6865 0a20 2020 2064 6566 205f 7175  ache.    def _qu
+000105a0: 6963 6b5f 6163 6365 7373 5f63 6861 6e67  ick_access_chang
+000105b0: 6569 645f 7763 2873 656c 6629 3a0a 2020  eid_wc(self):.  
+000105c0: 2020 2020 2020 2320 616c 736f 2066 6173        # also fas
+000105d0: 7420 7061 7468 2061 6363 6573 7320 746f  t path access to
+000105e0: 2074 6865 2077 6f72 6b69 6e67 2063 6f70   the working cop
+000105f0: 7920 7061 7265 6e74 730a 2020 2020 2020  y parents.      
+00010600: 2020 2320 686f 7765 7665 722c 206f 6e6c    # however, onl
+00010610: 7920 646f 2069 7420 666f 7220 6669 6c74  y do it for filt
+00010620: 6572 2074 6861 7420 656e 7375 7265 2077  er that ensure w
+00010630: 6320 6973 2076 6973 6962 6c65 2e0a 2020  c is visible..  
+00010640: 2020 2020 2020 7175 6963 6b20 3d20 7365        quick = se
+00010650: 6c66 2e5f 7175 6963 6b5f 6163 6365 7373  lf._quick_access
+00010660: 5f63 6861 6e67 6569 645f 6e75 6c6c 2e63  _changeid_null.c
+00010670: 6f70 7928 290a 2020 2020 2020 2020 636c  opy().        cl
+00010680: 203d 2073 656c 662e 756e 6669 6c74 6572   = self.unfilter
+00010690: 6564 2829 2e63 6861 6e67 656c 6f67 0a20  ed().changelog. 
+000106a0: 2020 2020 2020 2066 6f72 206e 6f64 6520         for node 
+000106b0: 696e 2073 656c 662e 6469 7273 7461 7465  in self.dirstate
+000106c0: 2e70 6172 656e 7473 2829 3a0a 2020 2020  .parents():.    
+000106d0: 2020 2020 2020 2020 6966 206e 6f64 6520          if node 
+000106e0: 3d3d 2073 656c 662e 6e75 6c6c 6964 3a0a  == self.nullid:.
+000106f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010700: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+00010710: 2020 2020 2072 6576 203d 2063 6c2e 696e       rev = cl.in
+00010720: 6465 782e 6765 745f 7265 7628 6e6f 6465  dex.get_rev(node
+00010730: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00010740: 2072 6576 2069 7320 4e6f 6e65 3a0a 2020   rev is None:.  
+00010750: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00010760: 756e 6b6e 6f77 6e20 776f 726b 696e 6720  unknown working 
+00010770: 636f 7079 2070 6172 656e 7420 6361 7365  copy parent case
+00010780: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010790: 2020 230a 2020 2020 2020 2020 2020 2020    #.            
+000107a0: 2020 2020 2320 2020 736b 6970 2074 6865      #   skip the
+000107b0: 2066 6173 7420 7061 7468 2061 6e64 206c   fast path and l
+000107c0: 6574 2068 6967 6865 7220 636f 6465 2064  et higher code d
+000107d0: 6561 6c20 7769 7468 2069 740a 2020 2020  eal with it.    
+000107e0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+000107f0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00010800: 2070 6169 7220 3d20 2872 6576 2c20 6e6f   pair = (rev, no
+00010810: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
+00010820: 7175 6963 6b5b 7265 765d 203d 2070 6169  quick[rev] = pai
+00010830: 720a 2020 2020 2020 2020 2020 2020 7175  r.            qu
+00010840: 6963 6b5b 6e6f 6465 5d20 3d20 7061 6972  ick[node] = pair
+00010850: 0a20 2020 2020 2020 2020 2020 2023 2061  .            # a
+00010860: 6c73 6f20 6164 6420 7468 6520 7061 7265  lso add the pare
+00010870: 6e74 7320 6f66 2074 6865 2070 6172 656e  nts of the paren
+00010880: 7473 0a20 2020 2020 2020 2020 2020 2066  ts.            f
+00010890: 6f72 2072 2069 6e20 636c 2e70 6172 656e  or r in cl.paren
+000108a0: 7472 6576 7328 7265 7629 3a0a 2020 2020  trevs(rev):.    
+000108b0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+000108c0: 203d 3d20 6e75 6c6c 7265 763a 0a20 2020   == nullrev:.   
+000108d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000108e0: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+000108f0: 2020 2020 2020 2020 2020 6e20 3d20 636c            n = cl
+00010900: 2e6e 6f64 6528 7229 0a20 2020 2020 2020  .node(r).       
+00010910: 2020 2020 2020 2020 2070 6169 7220 3d20           pair = 
+00010920: 2872 2c20 6e29 0a20 2020 2020 2020 2020  (r, n).         
+00010930: 2020 2020 2020 2071 7569 636b 5b72 5d20         quick[r] 
+00010940: 3d20 7061 6972 0a20 2020 2020 2020 2020  = pair.         
+00010950: 2020 2020 2020 2071 7569 636b 5b6e 5d20         quick[n] 
+00010960: 3d20 7061 6972 0a20 2020 2020 2020 2070  = pair.        p
+00010970: 316e 6f64 6520 3d20 7365 6c66 2e64 6972  1node = self.dir
+00010980: 7374 6174 652e 7031 2829 0a20 2020 2020  state.p1().     
+00010990: 2020 2069 6620 7031 6e6f 6465 2021 3d20     if p1node != 
+000109a0: 7365 6c66 2e6e 756c 6c69 643a 0a20 2020  self.nullid:.   
+000109b0: 2020 2020 2020 2020 2071 7569 636b 5b62           quick[b
+000109c0: 272e 275d 203d 2071 7569 636b 5b70 316e  '.'] = quick[p1n
+000109d0: 6f64 655d 0a20 2020 2020 2020 2072 6574  ode].        ret
+000109e0: 7572 6e20 7175 6963 6b0a 0a20 2020 2040  urn quick..    @
+000109f0: 756e 6669 6c74 6572 6564 6d65 7468 6f64  unfilteredmethod
+00010a00: 0a20 2020 2064 6566 205f 7175 6963 6b5f  .    def _quick_
+00010a10: 6163 6365 7373 5f63 6861 6e67 6569 645f  access_changeid_
+00010a20: 696e 7661 6c69 6461 7465 2873 656c 6629  invalidate(self)
+00010a30: 3a0a 2020 2020 2020 2020 6966 2027 5f71  :.        if '_q
+00010a40: 7569 636b 5f61 6363 6573 735f 6368 616e  uick_access_chan
+00010a50: 6765 6964 5f77 6327 2069 6e20 7661 7273  geid_wc' in vars
+00010a60: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00010a70: 2020 2020 6465 6c20 7365 6c66 2e5f 5f64      del self.__d
+00010a80: 6963 745f 5f5b 275f 7175 6963 6b5f 6163  ict__['_quick_ac
+00010a90: 6365 7373 5f63 6861 6e67 6569 645f 7763  cess_changeid_wc
+00010aa0: 275d 0a0a 2020 2020 4070 726f 7065 7274  ']..    @propert
+00010ab0: 790a 2020 2020 6465 6620 5f71 7569 636b  y.    def _quick
+00010ac0: 5f61 6363 6573 735f 6368 616e 6765 6964  _access_changeid
+00010ad0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00010ae0: 2222 2261 6e20 6865 6c70 6572 2064 6963  """an helper dic
+00010af0: 7469 6f6e 6e61 7279 2066 6f72 205f 5f67  tionnary for __g
+00010b00: 6574 6974 656d 5f5f 2063 616c 6c73 0a0a  etitem__ calls..
+00010b10: 2020 2020 2020 2020 5468 6973 2063 6f6e          This con
+00010b20: 7461 696e 7320 6120 6c69 7374 206f 6620  tains a list of 
+00010b30: 7379 6d62 6f6c 2077 6520 6361 6e20 7265  symbol we can re
+00010b40: 636f 676e 6973 6520 7269 6768 7420 6177  cognise right aw
+00010b50: 6179 2077 6974 686f 7574 0a20 2020 2020  ay without.     
+00010b60: 2020 2066 7572 7468 6572 2070 726f 6365     further proce
+00010b70: 7373 696e 672e 0a20 2020 2020 2020 2022  ssing..        "
+00010b80: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
+00010b90: 6c66 2e66 696c 7465 726e 616d 6520 696e  lf.filtername in
+00010ba0: 2072 6570 6f76 6965 772e 6669 6c74 6572   repoview.filter
+00010bb0: 5f68 6173 5f77 633a 0a20 2020 2020 2020  _has_wc:.       
+00010bc0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00010bd0: 2e5f 7175 6963 6b5f 6163 6365 7373 5f63  ._quick_access_c
+00010be0: 6861 6e67 6569 645f 7763 0a20 2020 2020  hangeid_wc.     
+00010bf0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00010c00: 7175 6963 6b5f 6163 6365 7373 5f63 6861  quick_access_cha
+00010c10: 6e67 6569 645f 6e75 6c6c 0a0a 2020 2020  ngeid_null..    
+00010c20: 6465 6620 5f5f 6765 7469 7465 6d5f 5f28  def __getitem__(
+00010c30: 7365 6c66 2c20 6368 616e 6765 6964 293a  self, changeid):
+00010c40: 0a20 2020 2020 2020 2023 2064 6561 6c69  .        # deali
+00010c50: 6e67 2077 6974 6820 7370 6563 6961 6c20  ng with special 
+00010c60: 6361 7365 730a 2020 2020 2020 2020 6966  cases.        if
+00010c70: 2063 6861 6e67 6569 6420 6973 204e 6f6e   changeid is Non
+00010c80: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00010c90: 6574 7572 6e20 636f 6e74 6578 742e 776f  eturn context.wo
+00010ca0: 726b 696e 6763 7478 2873 656c 6629 0a20  rkingctx(self). 
+00010cb0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00010cc0: 616e 6365 2863 6861 6e67 6569 642c 2063  ance(changeid, c
+00010cd0: 6f6e 7465 7874 2e62 6173 6563 7478 293a  ontext.basectx):
+00010ce0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00010cf0: 7572 6e20 6368 616e 6765 6964 0a0a 2020  urn changeid..  
+00010d00: 2020 2020 2020 2320 6465 616c 696e 6720        # dealing 
+00010d10: 7769 7468 206d 756c 7469 706c 6520 7265  with multiple re
+00010d20: 7669 7369 6f6e 730a 2020 2020 2020 2020  visions.        
+00010d30: 6966 2069 7369 6e73 7461 6e63 6528 6368  if isinstance(ch
+00010d40: 616e 6765 6964 2c20 736c 6963 6529 3a0a  angeid, slice):.
+00010d50: 2020 2020 2020 2020 2020 2020 2320 7764              # wd
+00010d60: 6972 7265 7620 6973 6e27 7420 636f 6e74  irrev isn't cont
+00010d70: 6967 756f 7573 2073 6f20 7468 6520 736c  iguous so the sl
+00010d80: 6963 6520 7368 6f75 6c64 6e27 7420 696e  ice shouldn't in
+00010d90: 636c 7564 6520 6974 0a20 2020 2020 2020  clude it.       
+00010da0: 2020 2020 2072 6574 7572 6e20 5b0a 2020       return [.  
+00010db0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00010dc0: 6c66 5b69 5d0a 2020 2020 2020 2020 2020  lf[i].          
+00010dd0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00010de0: 616e 6765 282a 6368 616e 6765 6964 2e69  ange(*changeid.i
+00010df0: 6e64 6963 6573 286c 656e 2873 656c 6629  ndices(len(self)
+00010e00: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00010e10: 2020 2069 6620 6920 6e6f 7420 696e 2073     if i not in s
+00010e20: 656c 662e 6368 616e 6765 6c6f 672e 6669  elf.changelog.fi
+00010e30: 6c74 6572 6564 7265 7673 0a20 2020 2020  lteredrevs.     
+00010e40: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
+00010e50: 2020 2320 6465 616c 696e 6720 7769 7468    # dealing with
+00010e60: 2073 6f6d 6520 7370 6563 6961 6c20 7661   some special va
+00010e70: 6c75 6573 0a20 2020 2020 2020 2071 7569  lues.        qui
+00010e80: 636b 5f61 6363 6573 7320 3d20 7365 6c66  ck_access = self
+00010e90: 2e5f 7175 6963 6b5f 6163 6365 7373 5f63  ._quick_access_c
+00010ea0: 6861 6e67 6569 642e 6765 7428 6368 616e  hangeid.get(chan
+00010eb0: 6765 6964 290a 2020 2020 2020 2020 6966  geid).        if
+00010ec0: 2071 7569 636b 5f61 6363 6573 7320 6973   quick_access is
+00010ed0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00010ee0: 2020 2020 2020 2072 6576 2c20 6e6f 6465         rev, node
+00010ef0: 203d 2071 7569 636b 5f61 6363 6573 730a   = quick_access.
+00010f00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00010f10: 726e 2063 6f6e 7465 7874 2e63 6861 6e67  rn context.chang
+00010f20: 6563 7478 2873 656c 662c 2072 6576 2c20  ectx(self, rev, 
+00010f30: 6e6f 6465 2c20 6d61 7962 655f 6669 6c74  node, maybe_filt
+00010f40: 6572 6564 3d46 616c 7365 290a 2020 2020  ered=False).    
+00010f50: 2020 2020 6966 2063 6861 6e67 6569 6420      if changeid 
+00010f60: 3d3d 2062 2774 6970 273a 0a20 2020 2020  == b'tip':.     
+00010f70: 2020 2020 2020 206e 6f64 6520 3d20 7365         node = se
+00010f80: 6c66 2e63 6861 6e67 656c 6f67 2e74 6970  lf.changelog.tip
+00010f90: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
+00010fa0: 6576 203d 2073 656c 662e 6368 616e 6765  ev = self.change
+00010fb0: 6c6f 672e 7265 7628 6e6f 6465 290a 2020  log.rev(node).  
+00010fc0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00010fd0: 2063 6f6e 7465 7874 2e63 6861 6e67 6563   context.changec
+00010fe0: 7478 2873 656c 662c 2072 6576 2c20 6e6f  tx(self, rev, no
+00010ff0: 6465 290a 0a20 2020 2020 2020 2023 2064  de)..        # d
+00011000: 6561 6c69 6e67 2077 6974 6820 6172 6269  ealing with arbi
+00011010: 7472 6172 7920 7661 6c75 6573 0a20 2020  trary values.   
+00011020: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00011030: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00011040: 6e63 6528 6368 616e 6765 6964 2c20 696e  nce(changeid, in
+00011050: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+00011060: 2020 2020 6e6f 6465 203d 2073 656c 662e      node = self.
+00011070: 6368 616e 6765 6c6f 672e 6e6f 6465 2863  changelog.node(c
+00011080: 6861 6e67 6569 6429 0a20 2020 2020 2020  hangeid).       
+00011090: 2020 2020 2020 2020 2072 6576 203d 2063           rev = c
+000110a0: 6861 6e67 6569 640a 2020 2020 2020 2020  hangeid.        
+000110b0: 2020 2020 656c 6966 2063 6861 6e67 6569      elif changei
+000110c0: 6420 3d3d 2062 272e 273a 0a20 2020 2020  d == b'.':.     
+000110d0: 2020 2020 2020 2020 2020 2023 2074 6869             # thi
+000110e0: 7320 6973 2061 2068 6163 6b20 746f 2064  s is a hack to d
+000110f0: 656c 6179 2f61 766f 6964 206c 6f61 6469  elay/avoid loadi
+00011100: 6e67 206f 6273 6d61 726b 6572 730a 2020  ng obsmarkers.  
+00011110: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00011120: 7768 656e 2077 6520 6b6e 6f77 2074 6861  when we know tha
+00011130: 7420 272e 2720 776f 6e27 7420 6265 2068  t '.' won't be h
+00011140: 6964 6465 6e0a 2020 2020 2020 2020 2020  idden.          
+00011150: 2020 2020 2020 6e6f 6465 203d 2073 656c        node = sel
+00011160: 662e 6469 7273 7461 7465 2e70 3128 290a  f.dirstate.p1().
+00011170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011180: 7265 7620 3d20 7365 6c66 2e75 6e66 696c  rev = self.unfil
+00011190: 7465 7265 6428 292e 6368 616e 6765 6c6f  tered().changelo
+000111a0: 672e 7265 7628 6e6f 6465 290a 2020 2020  g.rev(node).    
+000111b0: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
+000111c0: 2863 6861 6e67 6569 6429 203d 3d20 7365  (changeid) == se
+000111d0: 6c66 2e6e 6f64 6563 6f6e 7374 616e 7473  lf.nodeconstants
+000111e0: 2e6e 6f64 656c 656e 3a0a 2020 2020 2020  .nodelen:.      
+000111f0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00011200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011210: 2020 206e 6f64 6520 3d20 6368 616e 6765     node = change
+00011220: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
+00011230: 2020 2020 2020 2072 6576 203d 2073 656c         rev = sel
+00011240: 662e 6368 616e 6765 6c6f 672e 7265 7628  f.changelog.rev(
+00011250: 6368 616e 6765 6964 290a 2020 2020 2020  changeid).      
+00011260: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00011270: 2065 7272 6f72 2e46 696c 7465 7265 644c   error.FilteredL
+00011280: 6f6f 6b75 7045 7272 6f72 3a0a 2020 2020  ookupError:.    
+00011290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112a0: 6368 616e 6765 6964 203d 2068 6578 2863  changeid = hex(c
+000112b0: 6861 6e67 6569 6429 2020 2320 666f 7220  hangeid)  # for 
+000112c0: 7468 6520 6572 726f 7220 6d65 7373 6167  the error messag
+000112d0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000112e0: 2020 2020 2020 7261 6973 650a 2020 2020        raise.    
+000112f0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00011300: 7074 204c 6f6f 6b75 7045 7272 6f72 3a0a  pt LookupError:.
+00011310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011320: 2020 2020 2320 6368 6563 6b20 6966 2069      # check if i
+00011330: 7420 6d69 6768 7420 6861 7665 2063 6f6d  t might have com
+00011340: 6520 6672 6f6d 2064 616d 6167 6564 2064  e from damaged d
+00011350: 6972 7374 6174 650a 2020 2020 2020 2020  irstate.        
+00011360: 2020 2020 2020 2020 2020 2020 230a 2020              #.  
+00011370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011380: 2020 2320 5858 5820 7765 2063 6f75 6c64    # XXX we could
+00011390: 2061 766f 6964 2074 6865 2075 6e66 696c   avoid the unfil
+000113a0: 7465 7265 6420 6966 2077 6520 6861 6420  tered if we had 
+000113b0: 6120 7265 636f 676e 697a 6162 6c65 0a20  a recognizable. 
+000113c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000113d0: 2020 2023 2065 7863 6570 7469 6f6e 2066     # exception f
+000113e0: 6f72 2066 696c 7465 7265 6420 6368 616e  or filtered chan
+000113f0: 6765 7365 7420 6163 6365 7373 0a20 2020  geset access.   
+00011400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011410: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00011420: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00011430: 6c66 2e6c 6f63 616c 2829 0a20 2020 2020  lf.local().     
+00011440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011450: 2020 2061 6e64 2063 6861 6e67 6569 6420     and changeid 
+00011460: 696e 2073 656c 662e 756e 6669 6c74 6572  in self.unfilter
+00011470: 6564 2829 2e64 6972 7374 6174 652e 7061  ed().dirstate.pa
+00011480: 7265 6e74 7328 290a 2020 2020 2020 2020  rents().        
+00011490: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
+000114a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114b0: 2020 2020 2020 206d 7367 203d 205f 2862         msg = _(b
+000114c0: 2277 6f72 6b69 6e67 2064 6972 6563 746f  "working directo
+000114d0: 7279 2068 6173 2075 6e6b 6e6f 776e 2070  ry has unknown p
+000114e0: 6172 656e 7420 2725 7327 2122 290a 2020  arent '%s'!").  
+000114f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011500: 2020 2020 2020 7261 6973 6520 6572 726f        raise erro
+00011510: 722e 4162 6f72 7428 6d73 6720 2520 7368  r.Abort(msg % sh
+00011520: 6f72 7428 6368 616e 6765 6964 2929 0a20  ort(changeid)). 
+00011530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011540: 2020 2063 6861 6e67 6569 6420 3d20 6865     changeid = he
+00011550: 7828 6368 616e 6765 6964 2920 2023 2066  x(changeid)  # f
+00011560: 6f72 2074 6865 2065 7272 6f72 206d 6573  or the error mes
+00011570: 7361 6765 0a20 2020 2020 2020 2020 2020  sage.           
+00011580: 2020 2020 2020 2020 2072 6169 7365 0a0a           raise..
+00011590: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000115a0: 206c 656e 2863 6861 6e67 6569 6429 203d   len(changeid) =
+000115b0: 3d20 3220 2a20 7365 6c66 2e6e 6f64 6563  = 2 * self.nodec
+000115c0: 6f6e 7374 616e 7473 2e6e 6f64 656c 656e  onstants.nodelen
+000115d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000115e0: 2020 6e6f 6465 203d 2062 696e 2863 6861    node = bin(cha
+000115f0: 6e67 6569 6429 0a20 2020 2020 2020 2020  ngeid).         
+00011600: 2020 2020 2020 2072 6576 203d 2073 656c         rev = sel
+00011610: 662e 6368 616e 6765 6c6f 672e 7265 7628  f.changelog.rev(
+00011620: 6e6f 6465 290a 2020 2020 2020 2020 2020  node).          
+00011630: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00011640: 2020 2020 2020 2020 7261 6973 6520 6572          raise er
+00011650: 726f 722e 5072 6f67 7261 6d6d 696e 6745  ror.ProgrammingE
+00011660: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00011670: 2020 2020 2020 2020 2020 6222 756e 7375            b"unsu
+00011680: 7070 6f72 7465 6420 6368 616e 6765 6964  pported changeid
+00011690: 2027 2573 2720 6f66 2074 7970 6520 2573   '%s' of type %s
+000116a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000116b0: 2020 2020 2020 2520 2863 6861 6e67 6569        % (changei
+000116c0: 642c 2070 7963 6f6d 7061 742e 6279 7465  d, pycompat.byte
+000116d0: 7374 7228 7479 7065 2863 6861 6e67 6569  str(type(changei
+000116e0: 6429 2929 0a20 2020 2020 2020 2020 2020  d))).           
+000116f0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00011700: 2020 2020 7265 7475 726e 2063 6f6e 7465      return conte
+00011710: 7874 2e63 6861 6e67 6563 7478 2873 656c  xt.changectx(sel
+00011720: 662c 2072 6576 2c20 6e6f 6465 290a 0a20  f, rev, node).. 
+00011730: 2020 2020 2020 2065 7863 6570 7420 2865         except (e
+00011740: 7272 6f72 2e46 696c 7465 7265 6449 6e64  rror.FilteredInd
+00011750: 6578 4572 726f 722c 2065 7272 6f72 2e46  exError, error.F
+00011760: 696c 7465 7265 644c 6f6f 6b75 7045 7272  ilteredLookupErr
+00011770: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+00011780: 2072 6169 7365 2065 7272 6f72 2e46 696c   raise error.Fil
+00011790: 7465 7265 6452 6570 6f4c 6f6f 6b75 7045  teredRepoLookupE
+000117a0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+000117b0: 2020 2020 2020 5f28 6222 6669 6c74 6572        _(b"filter
+000117c0: 6564 2072 6576 6973 696f 6e20 2725 7327  ed revision '%s'
+000117d0: 2229 2025 2070 7963 6f6d 7061 742e 6279  ") % pycompat.by
+000117e0: 7465 7374 7228 6368 616e 6765 6964 290a  testr(changeid).
+000117f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00011800: 2020 2020 2020 6578 6365 7074 2028 496e        except (In
+00011810: 6465 7845 7272 6f72 2c20 4c6f 6f6b 7570  dexError, Lookup
+00011820: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+00011830: 2020 2020 7261 6973 6520 6572 726f 722e      raise error.
+00011840: 5265 706f 4c6f 6f6b 7570 4572 726f 7228  RepoLookupError(
+00011850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011860: 205f 2862 2275 6e6b 6e6f 776e 2072 6576   _(b"unknown rev
+00011870: 6973 696f 6e20 2725 7327 2229 2025 2070  ision '%s'") % p
+00011880: 7963 6f6d 7061 742e 6279 7465 7374 7228  ycompat.bytestr(
+00011890: 6368 616e 6765 6964 290a 2020 2020 2020  changeid).      
+000118a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000118b0: 6578 6365 7074 2065 7272 6f72 2e57 6469  except error.Wdi
+000118c0: 7255 6e73 7570 706f 7274 6564 3a0a 2020  rUnsupported:.  
+000118d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000118e0: 2063 6f6e 7465 7874 2e77 6f72 6b69 6e67   context.working
+000118f0: 6374 7828 7365 6c66 290a 0a20 2020 2064  ctx(self)..    d
+00011900: 6566 205f 5f63 6f6e 7461 696e 735f 5f28  ef __contains__(
+00011910: 7365 6c66 2c20 6368 616e 6765 6964 293a  self, changeid):
+00011920: 0a20 2020 2020 2020 2022 2222 5472 7565  .        """True
+00011930: 2069 6620 7468 6520 6769 7665 6e20 6368   if the given ch
+00011940: 616e 6765 6964 2065 7869 7374 7322 2222  angeid exists"""
+00011950: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00011960: 2020 2020 2020 2020 2020 7365 6c66 5b63            self[c
+00011970: 6861 6e67 6569 645d 0a20 2020 2020 2020  hangeid].       
+00011980: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00011990: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+000119a0: 6572 726f 722e 5265 706f 4c6f 6f6b 7570  error.RepoLookup
+000119b0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+000119c0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+000119d0: 0a20 2020 2064 6566 205f 5f6e 6f6e 7a65  .    def __nonze
+000119e0: 726f 5f5f 2873 656c 6629 3a0a 2020 2020  ro__(self):.    
+000119f0: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+00011a00: 0a20 2020 205f 5f62 6f6f 6c5f 5f20 3d20  .    __bool__ = 
+00011a10: 5f5f 6e6f 6e7a 6572 6f5f 5f0a 0a20 2020  __nonzero__..   
+00011a20: 2064 6566 205f 5f6c 656e 5f5f 2873 656c   def __len__(sel
+00011a30: 6629 3a0a 2020 2020 2020 2020 2320 6e6f  f):.        # no
+00011a40: 206e 6565 6420 746f 2070 6179 2074 6865   need to pay the
+00011a50: 2063 6f73 7420 6f66 2072 6570 6f76 6965   cost of repovie
+00011a60: 772e 6368 616e 6765 6c6f 670a 2020 2020  w.changelog.    
+00011a70: 2020 2020 756e 6669 203d 2073 656c 662e      unfi = self.
+00011a80: 756e 6669 6c74 6572 6564 2829 0a20 2020  unfiltered().   
+00011a90: 2020 2020 2072 6574 7572 6e20 6c65 6e28       return len(
+00011aa0: 756e 6669 2e63 6861 6e67 656c 6f67 290a  unfi.changelog).
+00011ab0: 0a20 2020 2064 6566 205f 5f69 7465 725f  .    def __iter_
+00011ac0: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+00011ad0: 2072 6574 7572 6e20 6974 6572 2873 656c   return iter(sel
+00011ae0: 662e 6368 616e 6765 6c6f 6729 0a0a 2020  f.changelog)..  
+00011af0: 2020 6465 6620 7265 7673 2873 656c 662c    def revs(self,
+00011b00: 2065 7870 723a 2062 7974 6573 2c20 2a61   expr: bytes, *a
+00011b10: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+00011b20: 2246 696e 6420 7265 7669 7369 6f6e 7320  "Find revisions 
+00011b30: 6d61 7463 6869 6e67 2061 2072 6576 7365  matching a revse
+00011b40: 742e 0a0a 2020 2020 2020 2020 5468 6520  t...        The 
+00011b50: 7265 7673 6574 2069 7320 7370 6563 6966  revset is specif
+00011b60: 6965 6420 6173 2061 2073 7472 696e 6720  ied as a string 
+00011b70: 6060 6578 7072 6060 2074 6861 7420 6d61  ``expr`` that ma
+00011b80: 7920 636f 6e74 6169 6e0a 2020 2020 2020  y contain.      
+00011b90: 2020 252d 666f 726d 6174 7469 6e67 2074    %-formatting t
+00011ba0: 6f20 6573 6361 7065 2063 6572 7461 696e  o escape certain
+00011bb0: 2074 7970 6573 2e20 5365 6520 6060 7265   types. See ``re
+00011bc0: 7673 6574 6c61 6e67 2e66 6f72 6d61 7473  vsetlang.formats
+00011bd0: 7065 6360 602e 0a0a 2020 2020 2020 2020  pec``...        
+00011be0: 5265 7673 6574 2061 6c69 6173 6573 2066  Revset aliases f
+00011bf0: 726f 6d20 7468 6520 636f 6e66 6967 7572  rom the configur
+00011c00: 6174 696f 6e20 6172 6520 6e6f 7420 6578  ation are not ex
+00011c10: 7061 6e64 6564 2e20 546f 2065 7870 616e  panded. To expan
+00011c20: 640a 2020 2020 2020 2020 7573 6572 2061  d.        user a
+00011c30: 6c69 6173 6573 2c20 636f 6e73 6964 6572  liases, consider
+00011c40: 2063 616c 6c69 6e67 2060 6073 636d 7574   calling ``scmut
+00011c50: 696c 2e72 6576 7261 6e67 6528 2960 6020  il.revrange()`` 
+00011c60: 6f72 0a20 2020 2020 2020 2060 6072 6570  or.        ``rep
+00011c70: 6f2e 616e 7972 6576 7328 5b65 7870 725d  o.anyrevs([expr]
+00011c80: 2c20 7573 6572 3d54 7275 6529 6060 2e0a  , user=True)``..
+00011c90: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00011ca0: 2061 2073 6d61 7274 7365 742e 6162 7374   a smartset.abst
+00011cb0: 7261 6374 736d 6172 7473 6574 2c20 7768  ractsmartset, wh
+00011cc0: 6963 6820 6973 2061 206c 6973 742d 6c69  ich is a list-li
+00011cd0: 6b65 2069 6e74 6572 6661 6365 0a20 2020  ke interface.   
+00011ce0: 2020 2020 2074 6861 7420 636f 6e74 6169       that contai
+00011cf0: 6e73 2069 6e74 6567 6572 2072 6576 6973  ns integer revis
+00011d00: 696f 6e73 2e0a 2020 2020 2020 2020 2222  ions..        ""
+00011d10: 220a 2020 2020 2020 2020 7472 6565 203d  ".        tree =
+00011d20: 2072 6576 7365 746c 616e 672e 7370 6563   revsetlang.spec
+00011d30: 7472 6565 2865 7870 722c 202a 6172 6773  tree(expr, *args
+00011d40: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00011d50: 2072 6576 7365 742e 6d61 6b65 6d61 7463   revset.makematc
+00011d60: 6865 7228 7472 6565 2928 7365 6c66 290a  her(tree)(self).
+00011d70: 0a20 2020 2064 6566 2073 6574 2873 656c  .    def set(sel
+00011d80: 662c 2065 7870 723a 2062 7974 6573 2c20  f, expr: bytes, 
+00011d90: 2a61 7267 7329 3a0a 2020 2020 2020 2020  *args):.        
+00011da0: 2222 2246 696e 6420 7265 7669 7369 6f6e  """Find revision
+00011db0: 7320 6d61 7463 6869 6e67 2061 2072 6576  s matching a rev
+00011dc0: 7365 7420 616e 6420 656d 6974 2063 6861  set and emit cha
+00011dd0: 6e67 6563 7478 2069 6e73 7461 6e63 6573  ngectx instances
+00011de0: 2e0a 0a20 2020 2020 2020 2054 6869 7320  ...        This 
+00011df0: 6973 2061 2063 6f6e 7665 6e69 656e 6365  is a convenience
+00011e00: 2077 7261 7070 6572 2061 726f 756e 6420   wrapper around 
+00011e10: 6060 7265 7673 2829 6060 2074 6861 7420  ``revs()`` that 
+00011e20: 6974 6572 6174 6573 2074 6865 0a20 2020  iterates the.   
+00011e30: 2020 2020 2072 6573 756c 7420 616e 6420       result and 
+00011e40: 6973 2061 2067 656e 6572 6174 6f72 206f  is a generator o
+00011e50: 6620 6368 616e 6765 6374 7820 696e 7374  f changectx inst
+00011e60: 616e 6365 732e 0a0a 2020 2020 2020 2020  ances...        
+00011e70: 5265 7673 6574 2061 6c69 6173 6573 2066  Revset aliases f
+00011e80: 726f 6d20 7468 6520 636f 6e66 6967 7572  rom the configur
+00011e90: 6174 696f 6e20 6172 6520 6e6f 7420 6578  ation are not ex
+00011ea0: 7061 6e64 6564 2e20 546f 2065 7870 616e  panded. To expan
+00011eb0: 640a 2020 2020 2020 2020 7573 6572 2061  d.        user a
+00011ec0: 6c69 6173 6573 2c20 636f 6e73 6964 6572  liases, consider
+00011ed0: 2063 616c 6c69 6e67 2060 6073 636d 7574   calling ``scmut
+00011ee0: 696c 2e72 6576 7261 6e67 6528 2960 602e  il.revrange()``.
+00011ef0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00011f00: 2020 2020 2066 6f72 2072 2069 6e20 7365       for r in se
+00011f10: 6c66 2e72 6576 7328 6578 7072 2c20 2a61  lf.revs(expr, *a
+00011f20: 7267 7329 3a0a 2020 2020 2020 2020 2020  rgs):.          
+00011f30: 2020 7969 656c 6420 7365 6c66 5b72 5d0a    yield self[r].
+00011f40: 0a20 2020 2064 6566 2061 6e79 7265 7673  .    def anyrevs
+00011f50: 2873 656c 662c 2073 7065 6373 3a20 6279  (self, specs: by
+00011f60: 7465 732c 2075 7365 723d 4661 6c73 652c  tes, user=False,
+00011f70: 206c 6f63 616c 616c 6961 733d 4e6f 6e65   localalias=None
+00011f80: 293a 0a20 2020 2020 2020 2022 2222 4669  ):.        """Fi
+00011f90: 6e64 2072 6576 6973 696f 6e73 206d 6174  nd revisions mat
+00011fa0: 6368 696e 6720 6f6e 6520 6f66 2074 6865  ching one of the
+00011fb0: 2067 6976 656e 2072 6576 7365 7473 2e0a   given revsets..
+00011fc0: 0a20 2020 2020 2020 2052 6576 7365 7420  .        Revset 
+00011fd0: 616c 6961 7365 7320 6672 6f6d 2074 6865  aliases from the
+00011fe0: 2063 6f6e 6669 6775 7261 7469 6f6e 2061   configuration a
+00011ff0: 7265 206e 6f74 2065 7870 616e 6465 6420  re not expanded 
+00012000: 6279 2064 6566 6175 6c74 2e20 546f 0a20  by default. To. 
+00012010: 2020 2020 2020 2065 7870 616e 6420 7573         expand us
+00012020: 6572 2061 6c69 6173 6573 2c20 7370 6563  er aliases, spec
+00012030: 6966 7920 6060 7573 6572 3d54 7275 6560  ify ``user=True`
+00012040: 602e 2054 6f20 7072 6f76 6964 6520 736f  `. To provide so
+00012050: 6d65 206c 6f63 616c 0a20 2020 2020 2020  me local.       
+00012060: 2064 6566 696e 6974 696f 6e73 206f 7665   definitions ove
+00012070: 7272 6964 696e 6720 7573 6572 2061 6c69  rriding user ali
+00012080: 6173 6573 2c20 7365 7420 6060 6c6f 6361  ases, set ``loca
+00012090: 6c61 6c69 6173 6060 2074 6f0a 2020 2020  lalias`` to.    
+000120a0: 2020 2020 6060 7b6e 616d 653a 2064 6566      ``{name: def
+000120b0: 696e 6974 696f 6e73 7472 696e 677d 6060  initionstring}``
+000120c0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000120d0: 2020 2020 2020 6966 2073 7065 6373 203d        if specs =
+000120e0: 3d20 5b62 276e 756c 6c27 5d3a 0a20 2020  = [b'null']:.   
+000120f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00012100: 7265 7673 6574 2e62 6173 6573 6574 285b  revset.baseset([
+00012110: 6e75 6c6c 7265 765d 290a 2020 2020 2020  nullrev]).      
+00012120: 2020 6966 2073 7065 6373 203d 3d20 5b62    if specs == [b
+00012130: 272e 275d 3a0a 2020 2020 2020 2020 2020  '.']:.          
+00012140: 2020 7175 6963 6b5f 6461 7461 203d 2073    quick_data = s
+00012150: 656c 662e 5f71 7569 636b 5f61 6363 6573  elf._quick_acces
+00012160: 735f 6368 616e 6765 6964 2e67 6574 2862  s_changeid.get(b
+00012170: 272e 2729 0a20 2020 2020 2020 2020 2020  '.').           
+00012180: 2069 6620 7175 6963 6b5f 6461 7461 2069   if quick_data i
+00012190: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000121a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000121b0: 726e 2072 6576 7365 742e 6261 7365 7365  rn revset.basese
+000121c0: 7428 5b71 7569 636b 5f64 6174 615b 305d  t([quick_data[0]
+000121d0: 5d29 0a20 2020 2020 2020 2069 6620 7573  ]).        if us
+000121e0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+000121f0: 6d20 3d20 7265 7673 6574 2e6d 6174 6368  m = revset.match
+00012200: 616e 7928 0a20 2020 2020 2020 2020 2020  any(.           
+00012210: 2020 2020 2073 656c 662e 7569 2c0a 2020       self.ui,.  
+00012220: 2020 2020 2020 2020 2020 2020 2020 7370                sp
+00012230: 6563 732c 0a20 2020 2020 2020 2020 2020  ecs,.           
+00012240: 2020 2020 206c 6f6f 6b75 703d 7265 7673       lookup=revs
+00012250: 6574 2e6c 6f6f 6b75 7066 6e28 7365 6c66  et.lookupfn(self
+00012260: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00012270: 2020 206c 6f63 616c 616c 6961 733d 6c6f     localalias=lo
+00012280: 6361 6c61 6c69 6173 2c0a 2020 2020 2020  calalias,.      
+00012290: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000122a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000122b0: 2020 6d20 3d20 7265 7673 6574 2e6d 6174    m = revset.mat
+000122c0: 6368 616e 7928 4e6f 6e65 2c20 7370 6563  chany(None, spec
+000122d0: 732c 206c 6f63 616c 616c 6961 733d 6c6f  s, localalias=lo
+000122e0: 6361 6c61 6c69 6173 290a 2020 2020 2020  calalias).      
+000122f0: 2020 7265 7475 726e 206d 2873 656c 6629    return m(self)
+00012300: 0a0a 2020 2020 6465 6620 7572 6c28 7365  ..    def url(se
+00012310: 6c66 2920 2d3e 2062 7974 6573 3a0a 2020  lf) -> bytes:.  
+00012320: 2020 2020 2020 7265 7475 726e 2062 2766        return b'f
+00012330: 696c 653a 2720 2b20 7365 6c66 2e72 6f6f  ile:' + self.roo
+00012340: 740a 0a20 2020 2064 6566 2068 6f6f 6b28  t..    def hook(
+00012350: 7365 6c66 2c20 6e61 6d65 2c20 7468 726f  self, name, thro
+00012360: 773d 4661 6c73 652c 202a 2a61 7267 7329  w=False, **args)
+00012370: 3a0a 2020 2020 2020 2020 2222 2243 616c  :.        """Cal
+00012380: 6c20 6120 686f 6f6b 2c20 7061 7373 696e  l a hook, passin
+00012390: 6720 7468 6973 2072 6570 6f20 696e 7374  g this repo inst
+000123a0: 616e 6365 2e0a 0a20 2020 2020 2020 2054  ance...        T
+000123b0: 6869 7320 6120 636f 6e76 656e 6965 6e63  his a convenienc
+000123c0: 6520 6d65 7468 6f64 2074 6f20 6169 6420  e method to aid 
+000123d0: 696e 766f 6b69 6e67 2068 6f6f 6b73 2e20  invoking hooks. 
+000123e0: 4578 7465 6e73 696f 6e73 206c 696b 656c  Extensions likel
+000123f0: 790a 2020 2020 2020 2020 776f 6e27 7420  y.        won't 
+00012400: 6361 6c6c 2074 6869 7320 756e 6c65 7373  call this unless
+00012410: 2074 6865 7920 6861 7665 2072 6567 6973   they have regis
+00012420: 7465 7265 6420 6120 6375 7374 6f6d 2068  tered a custom h
+00012430: 6f6f 6b20 6f72 2061 7265 0a20 2020 2020  ook or are.     
+00012440: 2020 2072 6570 6c61 6369 6e67 2063 6f64     replacing cod
+00012450: 6520 7468 6174 2069 7320 6578 7065 6374  e that is expect
+00012460: 6564 2074 6f20 6361 6c6c 2061 2068 6f6f  ed to call a hoo
+00012470: 6b2e 0a20 2020 2020 2020 2022 2222 0a20  k..        """. 
+00012480: 2020 2020 2020 2072 6574 7572 6e20 686f         return ho
+00012490: 6f6b 2e68 6f6f 6b28 7365 6c66 2e75 692c  ok.hook(self.ui,
+000124a0: 2073 656c 662c 206e 616d 652c 2074 6872   self, name, thr
+000124b0: 6f77 2c20 2a2a 6172 6773 290a 0a20 2020  ow, **args)..   
+000124c0: 2040 6669 6c74 6572 6564 7072 6f70 6572   @filteredproper
+000124d0: 7479 6361 6368 650a 2020 2020 6465 6620  tycache.    def 
+000124e0: 5f74 6167 7363 6163 6865 2873 656c 6629  _tagscache(self)
+000124f0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00012500: 7572 6e73 2061 2074 6167 7363 6163 6865  urns a tagscache
+00012510: 206f 626a 6563 7420 7468 6174 2063 6f6e   object that con
+00012520: 7461 696e 7320 7661 7269 6f75 7320 7461  tains various ta
+00012530: 6773 2072 656c 6174 6564 0a20 2020 2020  gs related.     
+00012540: 2020 2063 6163 6865 732e 2222 220a 0a20     caches.""".. 
+00012550: 2020 2020 2020 2023 2054 6869 7320 7369         # This si
+00012560: 6d70 6c69 6669 6573 2069 7473 2063 6163  mplifies its cac
+00012570: 6865 206d 616e 6167 656d 656e 7420 6279  he management by
+00012580: 2068 6176 696e 6720 6f6e 6520 6465 636f   having one deco
+00012590: 7261 7465 640a 2020 2020 2020 2020 2320  rated.        # 
+000125a0: 6675 6e63 7469 6f6e 2028 7468 6973 206f  function (this o
+000125b0: 6e65 2920 616e 6420 7468 6520 7265 7374  ne) and the rest
+000125c0: 2073 696d 706c 7920 6665 7463 6820 7468   simply fetch th
+000125d0: 696e 6773 2066 726f 6d20 6974 2e0a 2020  ings from it..  
+000125e0: 2020 2020 2020 636c 6173 7320 7461 6773        class tags
+000125f0: 6361 6368 653a 0a20 2020 2020 2020 2020  cache:.         
+00012600: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00012610: 7365 6c66 293a 0a20 2020 2020 2020 2020  self):.         
+00012620: 2020 2020 2020 2023 2054 6865 7365 2074         # These t
+00012630: 776f 2064 6566 696e 6520 7468 6520 7365  wo define the se
+00012640: 7420 6f66 2074 6167 7320 666f 7220 7468  t of tags for th
+00012650: 6973 2072 6570 6f73 6974 6f72 792e 2074  is repository. t
+00012660: 6167 730a 2020 2020 2020 2020 2020 2020  ags.            
+00012670: 2020 2020 2320 6d61 7073 2074 6167 206e      # maps tag n
+00012680: 616d 6520 746f 206e 6f64 653b 2074 6167  ame to node; tag
+00012690: 7479 7065 7320 6d61 7073 2074 6167 206e  types maps tag n
+000126a0: 616d 6520 746f 2027 676c 6f62 616c 2720  ame to 'global' 
+000126b0: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
+000126c0: 2020 2023 2027 6c6f 6361 6c27 2e20 2847     # 'local'. (G
+000126d0: 6c6f 6261 6c20 7461 6773 2061 7265 2064  lobal tags are d
+000126e0: 6566 696e 6564 2062 7920 2e68 6774 6167  efined by .hgtag
+000126f0: 7320 6163 726f 7373 2061 6c6c 0a20 2020  s across all.   
+00012700: 2020 2020 2020 2020 2020 2020 2023 2068               # h
+00012710: 6561 6473 2c20 616e 6420 6c6f 6361 6c20  eads, and local 
+00012720: 7461 6773 2061 7265 2064 6566 696e 6564  tags are defined
+00012730: 2069 6e20 2e68 672f 6c6f 6361 6c74 6167   in .hg/localtag
+00012740: 732e 290a 2020 2020 2020 2020 2020 2020  s.).            
+00012750: 2020 2020 2320 5468 6579 2063 6f6e 7374      # They const
+00012760: 6974 7574 6520 7468 6520 696e 2d6d 656d  itute the in-mem
+00012770: 6f72 7920 6361 6368 6520 6f66 2074 6167  ory cache of tag
+00012780: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
+00012790: 2020 2073 656c 662e 7461 6773 203d 2073     self.tags = s
+000127a0: 656c 662e 7461 6774 7970 6573 203d 204e  elf.tagtypes = N
+000127b0: 6f6e 650a 0a20 2020 2020 2020 2020 2020  one..           
+000127c0: 2020 2020 2073 656c 662e 6e6f 6465 7461       self.nodeta
+000127d0: 6773 6361 6368 6520 3d20 7365 6c66 2e74  gscache = self.t
+000127e0: 6167 736c 6973 7420 3d20 4e6f 6e65 0a0a  agslist = None..
+000127f0: 2020 2020 2020 2020 6361 6368 6520 3d20          cache = 
+00012800: 7461 6773 6361 6368 6528 290a 2020 2020  tagscache().    
+00012810: 2020 2020 6361 6368 652e 7461 6773 2c20      cache.tags, 
+00012820: 6361 6368 652e 7461 6774 7970 6573 203d  cache.tagtypes =
+00012830: 2073 656c 662e 5f66 696e 6474 6167 7328   self._findtags(
+00012840: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00012850: 6e20 6361 6368 650a 0a20 2020 2064 6566  n cache..    def
+00012860: 2074 6167 7328 7365 6c66 293a 0a20 2020   tags(self):.   
+00012870: 2020 2020 2027 2727 7265 7475 726e 2061       '''return a
+00012880: 206d 6170 7069 6e67 206f 6620 7461 6720   mapping of tag 
+00012890: 746f 206e 6f64 6527 2727 0a20 2020 2020  to node'''.     
+000128a0: 2020 2074 203d 207b 7d0a 2020 2020 2020     t = {}.      
+000128b0: 2020 6966 2073 656c 662e 6368 616e 6765    if self.change
+000128c0: 6c6f 672e 6669 6c74 6572 6564 7265 7673  log.filteredrevs
+000128d0: 3a0a 2020 2020 2020 2020 2020 2020 7461  :.            ta
+000128e0: 6773 2c20 7474 203d 2073 656c 662e 5f66  gs, tt = self._f
+000128f0: 696e 6474 6167 7328 290a 2020 2020 2020  indtags().      
+00012900: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00012910: 2020 2020 7461 6773 203d 2073 656c 662e      tags = self.
+00012920: 5f74 6167 7363 6163 6865 2e74 6167 730a  _tagscache.tags.
+00012930: 2020 2020 2020 2020 7265 7620 3d20 7365          rev = se
+00012940: 6c66 2e63 6861 6e67 656c 6f67 2e72 6576  lf.changelog.rev
+00012950: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
+00012960: 7620 696e 2074 6167 732e 6974 656d 7328  v in tags.items(
+00012970: 293a 0a20 2020 2020 2020 2020 2020 2074  ):.            t
+00012980: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00012990: 2020 2020 2320 6967 6e6f 7265 2074 6167      # ignore tag
+000129a0: 7320 746f 2075 6e6b 6e6f 776e 206e 6f64  s to unknown nod
+000129b0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+000129c0: 2020 2072 6576 2876 290a 2020 2020 2020     rev(v).      
+000129d0: 2020 2020 2020 2020 2020 745b 6b5d 203d            t[k] =
+000129e0: 2076 0a20 2020 2020 2020 2020 2020 2065   v.            e
+000129f0: 7863 6570 7420 2865 7272 6f72 2e4c 6f6f  xcept (error.Loo
+00012a00: 6b75 7045 7272 6f72 2c20 5661 6c75 6545  kupError, ValueE
+00012a10: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+00012a20: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+00012a30: 2020 2020 7265 7475 726e 2074 0a0a 2020      return t..  
+00012a40: 2020 6465 6620 5f66 696e 6474 6167 7328    def _findtags(
+00012a50: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00012a60: 2222 446f 2074 6865 2068 6172 6420 776f  ""Do the hard wo
+00012a70: 726b 206f 6620 6669 6e64 696e 6720 7461  rk of finding ta
+00012a80: 6773 2e20 2052 6574 7572 6e20 6120 7061  gs.  Return a pa
+00012a90: 6972 206f 6620 6469 6374 730a 2020 2020  ir of dicts.    
+00012aa0: 2020 2020 2874 6167 732c 2074 6167 7479      (tags, tagty
+00012ab0: 7065 7329 2077 6865 7265 2074 6167 7320  pes) where tags 
+00012ac0: 6d61 7073 2074 6167 206e 616d 6520 746f  maps tag name to
+00012ad0: 206e 6f64 652c 2061 6e64 2074 6167 7479   node, and tagty
+00012ae0: 7065 730a 2020 2020 2020 2020 6d61 7073  pes.        maps
+00012af0: 2074 6167 206e 616d 6520 746f 2061 2073   tag name to a s
+00012b00: 7472 696e 6720 6c69 6b65 205c 2767 6c6f  tring like \'glo
+00012b10: 6261 6c5c 2720 6f72 205c 276c 6f63 616c  bal\' or \'local
+00012b20: 5c27 2e0a 2020 2020 2020 2020 5375 6263  \'..        Subc
+00012b30: 6c61 7373 6573 206f 7220 6578 7465 6e73  lasses or extens
+00012b40: 696f 6e73 2061 7265 2066 7265 6520 746f  ions are free to
+00012b50: 2061 6464 2074 6865 6972 206f 776e 2074   add their own t
+00012b60: 6167 732c 2062 7574 0a20 2020 2020 2020  ags, but.       
+00012b70: 2073 686f 756c 6420 6265 2061 7761 7265   should be aware
+00012b80: 2074 6861 7420 7468 6520 7265 7475 726e   that the return
+00012b90: 6564 2064 6963 7473 2077 696c 6c20 6265  ed dicts will be
+00012ba0: 2072 6574 6169 6e65 6420 666f 7220 7468   retained for th
+00012bb0: 650a 2020 2020 2020 2020 6475 7261 7469  e.        durati
+00012bc0: 6f6e 206f 6620 7468 6520 6c6f 6361 6c72  on of the localr
+00012bd0: 6570 6f20 6f62 6a65 6374 2e22 2222 0a0a  epo object."""..
+00012be0: 2020 2020 2020 2020 2320 5858 5820 7768          # XXX wh
+00012bf0: 6174 2074 6167 7479 7065 2073 686f 756c  at tagtype shoul
+00012c00: 6420 7375 6263 6c61 7373 6573 2f65 7874  d subclasses/ext
+00012c10: 656e 7369 6f6e 7320 7573 653f 2020 4375  ensions use?  Cu
+00012c20: 7272 656e 746c 790a 2020 2020 2020 2020  rrently.        
+00012c30: 2320 6d71 2061 6e64 2062 6f6f 6b6d 6172  # mq and bookmar
+00012c40: 6b73 2061 6464 2074 6167 732c 2062 7574  ks add tags, but
+00012c50: 2064 6f20 6e6f 7420 7365 7420 7468 6520   do not set the 
+00012c60: 7461 6774 7970 6520 6174 2061 6c6c 2e0a  tagtype at all..
+00012c70: 2020 2020 2020 2020 2320 5368 6f75 6c64          # Should
+00012c80: 2065 6163 6820 6578 7465 6e73 696f 6e20   each extension 
+00012c90: 696e 7665 6e74 2069 7473 206f 776e 2074  invent its own t
+00012ca0: 6167 2074 7970 653f 2020 5368 6f75 6c64  ag type?  Should
+00012cb0: 2074 6865 7265 0a20 2020 2020 2020 2023   there.        #
+00012cc0: 2062 6520 6f6e 6520 7461 6774 7970 6520   be one tagtype 
+00012cd0: 666f 7220 616c 6c20 7375 6368 2022 7669  for all such "vi
+00012ce0: 7274 7561 6c22 2074 6167 733f 2020 4f72  rtual" tags?  Or
+00012cf0: 2069 7320 7468 6520 7374 6174 7573 0a20   is the status. 
+00012d00: 2020 2020 2020 2023 2071 756f 2066 696e         # quo fin
+00012d10: 653f 0a0a 2020 2020 2020 2020 2320 6d61  e?..        # ma
+00012d20: 7020 7461 6720 6e61 6d65 2074 6f20 286e  p tag name to (n
+00012d30: 6f64 652c 2068 6973 7429 0a20 2020 2020  ode, hist).     
+00012d40: 2020 2061 6c6c 7461 6773 203d 2074 6167     alltags = tag
+00012d50: 736d 6f64 2e66 696e 6467 6c6f 6261 6c74  smod.findglobalt
+00012d60: 6167 7328 7365 6c66 2e75 692c 2073 656c  ags(self.ui, sel
+00012d70: 6629 0a20 2020 2020 2020 2023 206d 6170  f).        # map
+00012d80: 2074 6167 206e 616d 6520 746f 2074 6167   tag name to tag
+00012d90: 2074 7970 650a 2020 2020 2020 2020 7461   type.        ta
+00012da0: 6774 7970 6573 203d 207b 7461 673a 2062  gtypes = {tag: b
+00012db0: 2767 6c6f 6261 6c27 2066 6f72 2074 6167  'global' for tag
+00012dc0: 2069 6e20 616c 6c74 6167 737d 0a0a 2020   in alltags}..  
+00012dd0: 2020 2020 2020 7461 6773 6d6f 642e 7265        tagsmod.re
+00012de0: 6164 6c6f 6361 6c74 6167 7328 7365 6c66  adlocaltags(self
+00012df0: 2e75 692c 2073 656c 662c 2061 6c6c 7461  .ui, self, allta
+00012e00: 6773 2c20 7461 6774 7970 6573 290a 0a20  gs, tagtypes).. 
+00012e10: 2020 2020 2020 2023 2042 7569 6c64 2074         # Build t
+00012e20: 6865 2072 6574 7572 6e20 6469 6374 732e  he return dicts.
+00012e30: 2020 4861 7665 2074 6f20 7265 2d65 6e63    Have to re-enc
+00012e40: 6f64 6520 7461 6720 6e61 6d65 7320 6265  ode tag names be
+00012e50: 6361 7573 650a 2020 2020 2020 2020 2320  cause.        # 
+00012e60: 7468 6520 7461 6773 206d 6f64 756c 6520  the tags module 
+00012e70: 616c 7761 7973 2075 7365 7320 5554 462d  always uses UTF-
+00012e80: 3820 2869 6e20 6f72 6465 7220 6e6f 7420  8 (in order not 
+00012e90: 746f 206c 6f73 6520 696e 666f 0a20 2020  to lose info.   
+00012ea0: 2020 2020 2023 2077 7269 7469 6e67 2074       # writing t
+00012eb0: 6f20 7468 6520 6361 6368 6529 2c20 6275  o the cache), bu
+00012ec0: 7420 7468 6520 7265 7374 206f 6620 4d65  t the rest of Me
+00012ed0: 7263 7572 6961 6c20 7761 6e74 7320 7468  rcurial wants th
+00012ee0: 656d 2069 6e0a 2020 2020 2020 2020 2320  em in.        # 
+00012ef0: 6c6f 6361 6c20 656e 636f 6469 6e67 2e0a  local encoding..
+00012f00: 2020 2020 2020 2020 7461 6773 203d 207b          tags = {
+00012f10: 7d0a 2020 2020 2020 2020 666f 7220 6e61  }.        for na
+00012f20: 6d65 2c20 286e 6f64 652c 2068 6973 7429  me, (node, hist)
+00012f30: 2069 6e20 616c 6c74 6167 732e 6974 656d   in alltags.item
+00012f40: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00012f50: 2069 6620 6e6f 6465 2021 3d20 7365 6c66   if node != self
+00012f60: 2e6e 756c 6c69 643a 0a20 2020 2020 2020  .nullid:.       
+00012f70: 2020 2020 2020 2020 2074 6167 735b 656e           tags[en
+00012f80: 636f 6469 6e67 2e74 6f6c 6f63 616c 286e  coding.tolocal(n
+00012f90: 616d 6529 5d20 3d20 6e6f 6465 0a20 2020  ame)] = node.   
+00012fa0: 2020 2020 2074 6167 735b 6227 7469 7027       tags[b'tip'
+00012fb0: 5d20 3d20 7365 6c66 2e63 6861 6e67 656c  ] = self.changel
+00012fc0: 6f67 2e74 6970 2829 0a20 2020 2020 2020  og.tip().       
+00012fd0: 2074 6167 7479 7065 7320 3d20 7b0a 2020   tagtypes = {.  
+00012fe0: 2020 2020 2020 2020 2020 656e 636f 6469            encodi
+00012ff0: 6e67 2e74 6f6c 6f63 616c 286e 616d 6529  ng.tolocal(name)
+00013000: 3a20 7661 6c75 6520 666f 7220 286e 616d  : value for (nam
+00013010: 652c 2076 616c 7565 2920 696e 2074 6167  e, value) in tag
+00013020: 7479 7065 732e 6974 656d 7328 290a 2020  types.items().  
+00013030: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00013040: 7265 7475 726e 2028 7461 6773 2c20 7461  return (tags, ta
+00013050: 6774 7970 6573 290a 0a20 2020 2064 6566  gtypes)..    def
+00013060: 2074 6167 7479 7065 2873 656c 662c 2074   tagtype(self, t
+00013070: 6167 6e61 6d65 293a 0a20 2020 2020 2020  agname):.       
+00013080: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00013090: 7572 6e20 7468 6520 7479 7065 206f 6620  urn the type of 
+000130a0: 7468 6520 6769 7665 6e20 7461 672e 2072  the given tag. r
+000130b0: 6573 756c 7420 6361 6e20 6265 3a0a 0a20  esult can be:.. 
+000130c0: 2020 2020 2020 2027 6c6f 6361 6c27 2020         'local'  
+000130d0: 3a20 6120 6c6f 6361 6c20 7461 670a 2020  : a local tag.  
+000130e0: 2020 2020 2020 2767 6c6f 6261 6c27 203a        'global' :
+000130f0: 2061 2067 6c6f 6261 6c20 7461 670a 2020   a global tag.  
+00013100: 2020 2020 2020 4e6f 6e65 2020 2020 203a        None     :
+00013110: 2074 6167 2064 6f65 7320 6e6f 7420 6578   tag does not ex
+00013120: 6973 740a 2020 2020 2020 2020 2222 220a  ist.        """.
+00013130: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00013140: 7365 6c66 2e5f 7461 6773 6361 6368 652e  self._tagscache.
+00013150: 7461 6774 7970 6573 2e67 6574 2874 6167  tagtypes.get(tag
+00013160: 6e61 6d65 290a 0a20 2020 2064 6566 2074  name)..    def t
+00013170: 6167 736c 6973 7428 7365 6c66 293a 0a20  agslist(self):. 
+00013180: 2020 2020 2020 2027 2727 7265 7475 726e         '''return
+00013190: 2061 206c 6973 7420 6f66 2074 6167 7320   a list of tags 
+000131a0: 6f72 6465 7265 6420 6279 2072 6576 6973  ordered by revis
+000131b0: 696f 6e27 2727 0a20 2020 2020 2020 2069  ion'''.        i
+000131c0: 6620 6e6f 7420 7365 6c66 2e5f 7461 6773  f not self._tags
+000131d0: 6361 6368 652e 7461 6773 6c69 7374 3a0a  cache.tagslist:.
+000131e0: 2020 2020 2020 2020 2020 2020 6c20 3d20              l = 
+000131f0: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
+00013200: 6f72 2074 2c20 6e20 696e 2073 656c 662e  or t, n in self.
+00013210: 7461 6773 2829 2e69 7465 6d73 2829 3a0a  tags().items():.
+00013220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013230: 6c2e 6170 7065 6e64 2828 7365 6c66 2e63  l.append((self.c
+00013240: 6861 6e67 656c 6f67 2e72 6576 286e 292c  hangelog.rev(n),
+00013250: 2074 2c20 6e29 290a 2020 2020 2020 2020   t, n)).        
+00013260: 2020 2020 7365 6c66 2e5f 7461 6773 6361      self._tagsca
+00013270: 6368 652e 7461 6773 6c69 7374 203d 205b  che.tagslist = [
+00013280: 2874 2c20 6e29 2066 6f72 2072 2c20 742c  (t, n) for r, t,
+00013290: 206e 2069 6e20 736f 7274 6564 286c 295d   n in sorted(l)]
+000132a0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000132b0: 2073 656c 662e 5f74 6167 7363 6163 6865   self._tagscache
+000132c0: 2e74 6167 736c 6973 740a 0a20 2020 2064  .tagslist..    d
+000132d0: 6566 206e 6f64 6574 6167 7328 7365 6c66  ef nodetags(self
+000132e0: 2c20 6e6f 6465 293a 0a20 2020 2020 2020  , node):.       
+000132f0: 2027 2727 7265 7475 726e 2074 6865 2074   '''return the t
+00013300: 6167 7320 6173 736f 6369 6174 6564 2077  ags associated w
+00013310: 6974 6820 6120 6e6f 6465 2727 270a 2020  ith a node'''.  
+00013320: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00013330: 662e 5f74 6167 7363 6163 6865 2e6e 6f64  f._tagscache.nod
+00013340: 6574 6167 7363 6163 6865 3a0a 2020 2020  etagscache:.    
+00013350: 2020 2020 2020 2020 6e6f 6465 7461 6773          nodetags
+00013360: 6361 6368 6520 3d20 7b7d 0a20 2020 2020  cache = {}.     
+00013370: 2020 2020 2020 2066 6f72 2074 2c20 6e20         for t, n 
+00013380: 696e 2073 656c 662e 5f74 6167 7363 6163  in self._tagscac
+00013390: 6865 2e74 6167 732e 6974 656d 7328 293a  he.tags.items():
+000133a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000133b0: 206e 6f64 6574 6167 7363 6163 6865 2e73   nodetagscache.s
+000133c0: 6574 6465 6661 756c 7428 6e2c 205b 5d29  etdefault(n, [])
+000133d0: 2e61 7070 656e 6428 7429 0a20 2020 2020  .append(t).     
+000133e0: 2020 2020 2020 2066 6f72 2074 6167 7320         for tags 
+000133f0: 696e 206e 6f64 6574 6167 7363 6163 6865  in nodetagscache
+00013400: 2e76 616c 7565 7328 293a 0a20 2020 2020  .values():.     
+00013410: 2020 2020 2020 2020 2020 2074 6167 732e             tags.
+00013420: 736f 7274 2829 0a20 2020 2020 2020 2020  sort().         
+00013430: 2020 2073 656c 662e 5f74 6167 7363 6163     self._tagscac
+00013440: 6865 2e6e 6f64 6574 6167 7363 6163 6865  he.nodetagscache
+00013450: 203d 206e 6f64 6574 6167 7363 6163 6865   = nodetagscache
+00013460: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00013470: 7365 6c66 2e5f 7461 6773 6361 6368 652e  self._tagscache.
+00013480: 6e6f 6465 7461 6773 6361 6368 652e 6765  nodetagscache.ge
+00013490: 7428 6e6f 6465 2c20 5b5d 290a 0a20 2020  t(node, [])..   
+000134a0: 2064 6566 206e 6f64 6562 6f6f 6b6d 6172   def nodebookmar
+000134b0: 6b73 2873 656c 662c 206e 6f64 6529 3a0a  ks(self, node):.
+000134c0: 2020 2020 2020 2020 2222 2272 6574 7572          """retur
+000134d0: 6e20 7468 6520 6c69 7374 206f 6620 626f  n the list of bo
+000134e0: 6f6b 6d61 726b 7320 706f 696e 7469 6e67  okmarks pointing
+000134f0: 2074 6f20 7468 6520 7370 6563 6966 6965   to the specifie
+00013500: 6420 6e6f 6465 2222 220a 2020 2020 2020  d node""".      
+00013510: 2020 7265 7475 726e 2073 656c 662e 5f62    return self._b
+00013520: 6f6f 6b6d 6172 6b73 2e6e 616d 6573 286e  ookmarks.names(n
+00013530: 6f64 6529 0a0a 2020 2020 6465 6620 6272  ode)..    def br
+00013540: 616e 6368 6d61 7028 7365 6c66 293a 0a20  anchmap(self):. 
+00013550: 2020 2020 2020 2022 2222 7265 7475 726e         """return
+00013560: 7320 6120 6469 6374 696f 6e61 7279 207b  s a dictionary {
+00013570: 6272 616e 6368 3a20 5b62 7261 6e63 6868  branch: [branchh
+00013580: 6561 6473 5d7d 2077 6974 6820 6272 616e  eads]} with bran
+00013590: 6368 6865 6164 730a 2020 2020 2020 2020  chheads.        
+000135a0: 6f72 6465 7265 6420 6279 2069 6e63 7265  ordered by incre
+000135b0: 6173 696e 6720 7265 7669 7369 6f6e 206e  asing revision n
+000135c0: 756d 6265 7222 2222 0a20 2020 2020 2020  umber""".       
+000135d0: 2072 6574 7572 6e20 7365 6c66 2e5f 6272   return self._br
+000135e0: 616e 6368 6361 6368 6573 5b73 656c 665d  anchcaches[self]
+000135f0: 0a0a 2020 2020 4075 6e66 696c 7465 7265  ..    @unfiltere
+00013600: 646d 6574 686f 640a 2020 2020 6465 6620  dmethod.    def 
+00013610: 7265 7662 7261 6e63 6863 6163 6865 2873  revbranchcache(s
+00013620: 656c 6629 3a0a 2020 2020 2020 2020 6966  elf):.        if
+00013630: 206e 6f74 2073 656c 662e 5f72 6576 6272   not self._revbr
+00013640: 616e 6368 6361 6368 653a 0a20 2020 2020  anchcache:.     
+00013650: 2020 2020 2020 2073 656c 662e 5f72 6576         self._rev
+00013660: 6272 616e 6368 6361 6368 6520 3d20 6272  branchcache = br
+00013670: 616e 6368 6d61 702e 7265 7662 7261 6e63  anchmap.revbranc
+00013680: 6863 6163 6865 2873 656c 662e 756e 6669  hcache(self.unfi
+00013690: 6c74 6572 6564 2829 290a 2020 2020 2020  ltered()).      
+000136a0: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+000136b0: 6576 6272 616e 6368 6361 6368 650a 0a20  evbranchcache.. 
+000136c0: 2020 2064 6566 2072 6567 6973 7465 725f     def register_
+000136d0: 6368 616e 6765 7365 7428 7365 6c66 2c20  changeset(self, 
+000136e0: 7265 762c 2063 6861 6e67 656c 6f67 7265  rev, changelogre
+000136f0: 7669 7369 6f6e 293a 0a20 2020 2020 2020  vision):.       
+00013700: 2073 656c 662e 7265 7662 7261 6e63 6863   self.revbranchc
+00013710: 6163 6865 2829 2e73 6574 6461 7461 2872  ache().setdata(r
+00013720: 6576 2c20 6368 616e 6765 6c6f 6772 6576  ev, changelogrev
+00013730: 6973 696f 6e29 0a0a 2020 2020 6465 6620  ision)..    def 
+00013740: 6272 616e 6368 7469 7028 7365 6c66 2c20  branchtip(self, 
+00013750: 6272 616e 6368 2c20 6967 6e6f 7265 6d69  branch, ignoremi
+00013760: 7373 696e 673d 4661 6c73 6529 3a0a 2020  ssing=False):.  
+00013770: 2020 2020 2020 2222 2272 6574 7572 6e20        """return 
+00013780: 7468 6520 7469 7020 6e6f 6465 2066 6f72  the tip node for
+00013790: 2061 2067 6976 656e 2062 7261 6e63 680a   a given branch.
+000137a0: 0a20 2020 2020 2020 2049 6620 6967 6e6f  .        If igno
+000137b0: 7265 6d69 7373 696e 6720 6973 2054 7275  remissing is Tru
+000137c0: 652c 2074 6865 6e20 7468 6973 206d 6574  e, then this met
+000137d0: 686f 6420 7769 6c6c 206e 6f74 2072 6169  hod will not rai
+000137e0: 7365 2061 6e20 6572 726f 722e 0a20 2020  se an error..   
+000137f0: 2020 2020 2054 6869 7320 6973 2068 656c       This is hel
+00013800: 7066 756c 2066 6f72 2063 616c 6c65 7273  pful for callers
+00013810: 2074 6861 7420 6f6e 6c79 2065 7870 6563   that only expec
+00013820: 7420 4e6f 6e65 2066 6f72 2061 206d 6973  t None for a mis
+00013830: 7369 6e67 2062 7261 6e63 680a 2020 2020  sing branch.    
+00013840: 2020 2020 2865 2e67 2e20 6e61 6d65 7370      (e.g. namesp
+00013850: 6163 6529 2e0a 0a20 2020 2020 2020 2022  ace)...        "
+00013860: 2222 0a20 2020 2020 2020 2074 7279 3a0a  "".        try:.
+00013870: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00013880: 726e 2073 656c 662e 6272 616e 6368 6d61  rn self.branchma
+00013890: 7028 292e 6272 616e 6368 7469 7028 6272  p().branchtip(br
+000138a0: 616e 6368 290a 2020 2020 2020 2020 6578  anch).        ex
+000138b0: 6365 7074 204b 6579 4572 726f 723a 0a20  cept KeyError:. 
+000138c0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000138d0: 7420 6967 6e6f 7265 6d69 7373 696e 673a  t ignoremissing:
+000138e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000138f0: 2072 6169 7365 2065 7272 6f72 2e52 6570   raise error.Rep
+00013900: 6f4c 6f6f 6b75 7045 7272 6f72 285f 2862  oLookupError(_(b
+00013910: 2275 6e6b 6e6f 776e 2062 7261 6e63 6820  "unknown branch 
+00013920: 2725 7327 2229 2025 2062 7261 6e63 6829  '%s'") % branch)
+00013930: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00013940: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00013950: 2020 2070 6173 730a 0a20 2020 2064 6566     pass..    def
+00013960: 206c 6f6f 6b75 7028 7365 6c66 2c20 6b65   lookup(self, ke
+00013970: 7929 3a0a 2020 2020 2020 2020 6e6f 6465  y):.        node
+00013980: 203d 2073 636d 7574 696c 2e72 6576 7379   = scmutil.revsy
+00013990: 6d62 6f6c 2873 656c 662c 206b 6579 292e  mbol(self, key).
+000139a0: 6e6f 6465 2829 0a20 2020 2020 2020 2069  node().        i
+000139b0: 6620 6e6f 6465 2069 7320 4e6f 6e65 3a0a  f node is None:.
+000139c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000139d0: 6520 6572 726f 722e 5265 706f 4c6f 6f6b  e error.RepoLook
+000139e0: 7570 4572 726f 7228 5f28 6222 756e 6b6e  upError(_(b"unkn
+000139f0: 6f77 6e20 7265 7669 7369 6f6e 2027 2573  own revision '%s
+00013a00: 2722 2920 2520 6b65 7929 0a20 2020 2020  '") % key).     
+00013a10: 2020 2072 6574 7572 6e20 6e6f 6465 0a0a     return node..
+00013a20: 2020 2020 6465 6620 6c6f 6f6b 7570 6272      def lookupbr
+00013a30: 616e 6368 2873 656c 662c 206b 6579 293a  anch(self, key):
+00013a40: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00013a50: 2e62 7261 6e63 686d 6170 2829 2e68 6173  .branchmap().has
+00013a60: 6272 616e 6368 286b 6579 293a 0a20 2020  branch(key):.   
+00013a70: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00013a80: 6b65 790a 0a20 2020 2020 2020 2072 6574  key..        ret
+00013a90: 7572 6e20 7363 6d75 7469 6c2e 7265 7673  urn scmutil.revs
+00013aa0: 796d 626f 6c28 7365 6c66 2c20 6b65 7929  ymbol(self, key)
+00013ab0: 2e62 7261 6e63 6828 290a 0a20 2020 2064  .branch()..    d
+00013ac0: 6566 206b 6e6f 776e 2873 656c 662c 206e  ef known(self, n
+00013ad0: 6f64 6573 293a 0a20 2020 2020 2020 2063  odes):.        c
+00013ae0: 6c20 3d20 7365 6c66 2e63 6861 6e67 656c  l = self.changel
+00013af0: 6f67 0a20 2020 2020 2020 2067 6574 5f72  og.        get_r
+00013b00: 6576 203d 2063 6c2e 696e 6465 782e 6765  ev = cl.index.ge
+00013b10: 745f 7265 760a 2020 2020 2020 2020 6669  t_rev.        fi
+00013b20: 6c74 6572 6564 203d 2063 6c2e 6669 6c74  ltered = cl.filt
+00013b30: 6572 6564 7265 7673 0a20 2020 2020 2020  eredrevs.       
+00013b40: 2072 6573 756c 7420 3d20 5b5d 0a20 2020   result = [].   
+00013b50: 2020 2020 2066 6f72 206e 2069 6e20 6e6f       for n in no
+00013b60: 6465 733a 0a20 2020 2020 2020 2020 2020  des:.           
+00013b70: 2072 203d 2067 6574 5f72 6576 286e 290a   r = get_rev(n).
+00013b80: 2020 2020 2020 2020 2020 2020 7265 7370              resp
+00013b90: 203d 206e 6f74 2028 7220 6973 204e 6f6e   = not (r is Non
+00013ba0: 6520 6f72 2072 2069 6e20 6669 6c74 6572  e or r in filter
+00013bb0: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
+00013bc0: 7265 7375 6c74 2e61 7070 656e 6428 7265  result.append(re
+00013bd0: 7370 290a 2020 2020 2020 2020 7265 7475  sp).        retu
+00013be0: 726e 2072 6573 756c 740a 0a20 2020 2064  rn result..    d
+00013bf0: 6566 206c 6f63 616c 2873 656c 6629 3a0a  ef local(self):.
+00013c00: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00013c10: 656c 660a 0a20 2020 2064 6566 2070 7562  elf..    def pub
+00013c20: 6c69 7368 696e 6728 7365 6c66 293a 0a20  lishing(self):. 
+00013c30: 2020 2020 2020 2023 2069 7427 7320 7361         # it's sa
+00013c40: 6665 2028 616e 6420 6465 7369 7261 626c  fe (and desirabl
+00013c50: 6529 2074 6f20 7472 7573 7420 7468 6520  e) to trust the 
+00013c60: 7075 626c 6973 6820 666c 6167 2075 6e63  publish flag unc
+00013c70: 6f6e 6469 7469 6f6e 616c 6c79 0a20 2020  onditionally.   
+00013c80: 2020 2020 2023 2073 6f20 7468 6174 2077       # so that w
+00013c90: 6520 646f 6e27 7420 6669 6e61 6c69 7a65  e don't finalize
+00013ca0: 2063 6861 6e67 6573 2073 6861 7265 6420   changes shared 
+00013cb0: 6265 7477 6565 6e20 7573 6572 7320 7669  between users vi
+00013cc0: 6120 7373 6820 6f72 206e 6673 0a20 2020  a ssh or nfs.   
+00013cd0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00013ce0: 2e75 692e 636f 6e66 6967 626f 6f6c 2862  .ui.configbool(b
+00013cf0: 2770 6861 7365 7327 2c20 6227 7075 626c  'phases', b'publ
+00013d00: 6973 6827 2c20 756e 7472 7573 7465 643d  ish', untrusted=
+00013d10: 5472 7565 290a 0a20 2020 2064 6566 2063  True)..    def c
+00013d20: 616e 636f 7079 2873 656c 6629 3a0a 2020  ancopy(self):.  
+00013d30: 2020 2020 2020 2320 736f 2073 7461 7469        # so stati
+00013d40: 6368 7474 7072 6570 6f27 7320 6f76 6572  chttprepo's over
+00013d50: 7269 6465 206f 6620 6c6f 6361 6c28 2920  ride of local() 
+00013d60: 776f 726b 730a 2020 2020 2020 2020 6966  works.        if
+00013d70: 206e 6f74 2073 656c 662e 6c6f 6361 6c28   not self.local(
+00013d80: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00013d90: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+00013da0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00013db0: 7075 626c 6973 6869 6e67 2829 3a0a 2020  publishing():.  
+00013dc0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00013dd0: 2054 7275 650a 2020 2020 2020 2020 2320   True.        # 
+00013de0: 6966 2070 7562 6c69 7368 696e 6720 7765  if publishing we
+00013df0: 2063 616e 2774 2063 6f70 7920 6966 2074   can't copy if t
+00013e00: 6865 7265 2069 7320 6669 6c74 6572 6564  here is filtered
+00013e10: 2063 6f6e 7465 6e74 0a20 2020 2020 2020   content.       
+00013e20: 2072 6574 7572 6e20 6e6f 7420 7365 6c66   return not self
+00013e30: 2e66 696c 7465 7265 6428 6227 7669 7369  .filtered(b'visi
+00013e40: 626c 6527 292e 6368 616e 6765 6c6f 672e  ble').changelog.
+00013e50: 6669 6c74 6572 6564 7265 7673 0a0a 2020  filteredrevs..  
+00013e60: 2020 6465 6620 7368 6172 6564 2873 656c    def shared(sel
+00013e70: 6629 3a0a 2020 2020 2020 2020 2727 2774  f):.        '''t
+00013e80: 6865 2074 7970 6520 6f66 2073 6861 7265  he type of share
+00013e90: 6420 7265 706f 7369 746f 7279 2028 4e6f  d repository (No
+00013ea0: 6e65 2069 6620 6e6f 7420 7368 6172 6564  ne if not shared
+00013eb0: 2927 2727 0a20 2020 2020 2020 2069 6620  )'''.        if 
+00013ec0: 7365 6c66 2e73 6861 7265 6470 6174 6820  self.sharedpath 
+00013ed0: 213d 2073 656c 662e 7061 7468 3a0a 2020  != self.path:.  
+00013ee0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00013ef0: 2062 2773 746f 7265 270a 2020 2020 2020   b'store'.      
+00013f00: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
+00013f10: 2020 2064 6566 2077 6a6f 696e 2873 656c     def wjoin(sel
+00013f20: 662c 2066 3a20 6279 7465 732c 202a 696e  f, f: bytes, *in
+00013f30: 7369 6465 663a 2062 7974 6573 2920 2d3e  sidef: bytes) ->
+00013f40: 2062 7974 6573 3a0a 2020 2020 2020 2020   bytes:.        
+00013f50: 7265 7475 726e 2073 656c 662e 7666 732e  return self.vfs.
+00013f60: 7265 6c6a 6f69 6e28 7365 6c66 2e72 6f6f  reljoin(self.roo
+00013f70: 742c 2066 2c20 2a69 6e73 6964 6566 290a  t, f, *insidef).
+00013f80: 0a20 2020 2064 6566 2073 6574 7061 7265  .    def setpare
+00013f90: 6e74 7328 7365 6c66 2c20 7031 2c20 7032  nts(self, p1, p2
+00013fa0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00013fb0: 6966 2070 3220 6973 204e 6f6e 653a 0a20  if p2 is None:. 
+00013fc0: 2020 2020 2020 2020 2020 2070 3220 3d20             p2 = 
+00013fd0: 7365 6c66 2e6e 756c 6c69 640a 2020 2020  self.nullid.    
+00013fe0: 2020 2020 7365 6c66 5b4e 6f6e 655d 2e73      self[None].s
+00013ff0: 6574 7061 7265 6e74 7328 7031 2c20 7032  etparents(p1, p2
+00014000: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+00014010: 7175 6963 6b5f 6163 6365 7373 5f63 6861  quick_access_cha
+00014020: 6e67 6569 645f 696e 7661 6c69 6461 7465  ngeid_invalidate
+00014030: 2829 0a0a 2020 2020 6465 6620 6669 6c65  ()..    def file
+00014040: 6374 7828 7365 6c66 2c20 7061 7468 3a20  ctx(self, path: 
+00014050: 6279 7465 732c 2063 6861 6e67 6569 643d  bytes, changeid=
+00014060: 4e6f 6e65 2c20 6669 6c65 6964 3d4e 6f6e  None, fileid=Non
+00014070: 652c 2063 6861 6e67 6563 7478 3d4e 6f6e  e, changectx=Non
+00014080: 6529 3a0a 2020 2020 2020 2020 2222 2263  e):.        """c
+00014090: 6861 6e67 6569 6420 6d75 7374 2062 6520  hangeid must be 
+000140a0: 6120 6368 616e 6765 7365 7420 7265 7669  a changeset revi
+000140b0: 7369 6f6e 2c20 6966 2073 7065 6369 6669  sion, if specifi
+000140c0: 6564 2e0a 2020 2020 2020 2020 6669 6c65  ed..        file
+000140d0: 6964 2063 616e 2062 6520 6120 6669 6c65  id can be a file
+000140e0: 2072 6576 6973 696f 6e20 6f72 206e 6f64   revision or nod
+000140f0: 652e 2222 220a 2020 2020 2020 2020 7265  e.""".        re
+00014100: 7475 726e 2063 6f6e 7465 7874 2e66 696c  turn context.fil
+00014110: 6563 7478 280a 2020 2020 2020 2020 2020  ectx(.          
+00014120: 2020 7365 6c66 2c20 7061 7468 2c20 6368    self, path, ch
+00014130: 616e 6765 6964 2c20 6669 6c65 6964 2c20  angeid, fileid, 
+00014140: 6368 616e 6765 6374 783d 6368 616e 6765  changectx=change
+00014150: 6374 780a 2020 2020 2020 2020 290a 0a20  ctx.        ).. 
+00014160: 2020 2064 6566 2067 6574 6377 6428 7365     def getcwd(se
+00014170: 6c66 2920 2d3e 2062 7974 6573 3a0a 2020  lf) -> bytes:.  
+00014180: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00014190: 662e 6469 7273 7461 7465 2e67 6574 6377  f.dirstate.getcw
+000141a0: 6428 290a 0a20 2020 2064 6566 2070 6174  d()..    def pat
+000141b0: 6874 6f28 7365 6c66 2c20 663a 2062 7974  hto(self, f: byt
+000141c0: 6573 2c20 6377 643a 204f 7074 696f 6e61  es, cwd: Optiona
+000141d0: 6c5b 6279 7465 735d 203d 204e 6f6e 6529  l[bytes] = None)
+000141e0: 202d 3e20 6279 7465 733a 0a20 2020 2020   -> bytes:.     
+000141f0: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
+00014200: 6972 7374 6174 652e 7061 7468 746f 2866  irstate.pathto(f
+00014210: 2c20 6377 6429 0a0a 2020 2020 6465 6620  , cwd)..    def 
+00014220: 5f6c 6f61 6466 696c 7465 7228 7365 6c66  _loadfilter(self
+00014230: 2c20 6669 6c74 6572 293a 0a20 2020 2020  , filter):.     
+00014240: 2020 2069 6620 6669 6c74 6572 206e 6f74     if filter not
+00014250: 2069 6e20 7365 6c66 2e5f 6669 6c74 6572   in self._filter
+00014260: 7061 7473 3a0a 2020 2020 2020 2020 2020  pats:.          
+00014270: 2020 6c20 3d20 5b5d 0a20 2020 2020 2020    l = [].       
+00014280: 2020 2020 2066 6f72 2070 6174 2c20 636d       for pat, cm
+00014290: 6420 696e 2073 656c 662e 7569 2e63 6f6e  d in self.ui.con
+000142a0: 6669 6769 7465 6d73 2866 696c 7465 7229  figitems(filter)
+000142b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000142c0: 2020 6966 2063 6d64 203d 3d20 6227 2127    if cmd == b'!'
+000142d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000142e0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+000142f0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00014300: 6620 3d20 6d61 7463 686d 6f64 2e6d 6174  f = matchmod.mat
+00014310: 6368 2873 656c 662e 726f 6f74 2c20 6227  ch(self.root, b'
+00014320: 272c 205b 7061 745d 290a 2020 2020 2020  ', [pat]).      
+00014330: 2020 2020 2020 2020 2020 666e 203d 204e            fn = N
+00014340: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00014350: 2020 2020 7061 7261 6d73 203d 2063 6d64      params = cmd
+00014360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014370: 2066 6f72 206e 616d 652c 2066 696c 7465   for name, filte
+00014380: 7266 6e20 696e 2073 656c 662e 5f64 6174  rfn in self._dat
+00014390: 6166 696c 7465 7273 2e69 7465 6d73 2829  afilters.items()
+000143a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000143b0: 2020 2020 2020 6966 2063 6d64 2e73 7461        if cmd.sta
+000143c0: 7274 7377 6974 6828 6e61 6d65 293a 0a20  rtswith(name):. 
+000143d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000143e0: 2020 2020 2020 2066 6e20 3d20 6669 6c74         fn = filt
+000143f0: 6572 666e 0a20 2020 2020 2020 2020 2020  erfn.           
+00014400: 2020 2020 2020 2020 2020 2020 2070 6172               par
+00014410: 616d 7320 3d20 636d 645b 6c65 6e28 6e61  ams = cmd[len(na
+00014420: 6d65 2920 3a5d 2e6c 7374 7269 7028 290a  me) :].lstrip().
+00014430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014440: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00014450: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00014460: 206e 6f74 2066 6e3a 0a20 2020 2020 2020   not fn:.       
+00014470: 2020 2020 2020 2020 2020 2020 2066 6e20               fn 
+00014480: 3d20 6c61 6d62 6461 2073 2c20 632c 202a  = lambda s, c, *
+00014490: 2a6b 7761 7267 733a 2070 726f 6375 7469  *kwargs: procuti
+000144a0: 6c2e 6669 6c74 6572 2873 2c20 6329 0a20  l.filter(s, c). 
+000144b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144c0: 2020 2066 6e2e 5f5f 6e61 6d65 5f5f 203d     fn.__name__ =
+000144d0: 2027 636f 6d6d 616e 6466 696c 7465 7227   'commandfilter'
+000144e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000144f0: 2023 2057 7261 7020 6f6c 6420 6669 6c74   # Wrap old filt
+00014500: 6572 7320 6e6f 7420 7375 7070 6f72 7469  ers not supporti
+00014510: 6e67 206b 6579 776f 7264 2061 7267 756d  ng keyword argum
+00014520: 656e 7473 0a20 2020 2020 2020 2020 2020  ents.           
+00014530: 2020 2020 2069 6620 6e6f 7420 7079 636f       if not pyco
+00014540: 6d70 6174 2e67 6574 6172 6773 7065 6328  mpat.getargspec(
+00014550: 666e 295b 325d 3a0a 2020 2020 2020 2020  fn)[2]:.        
+00014560: 2020 2020 2020 2020 2020 2020 6f6c 6466              oldf
+00014570: 6e20 3d20 666e 0a20 2020 2020 2020 2020  n = fn.         
+00014580: 2020 2020 2020 2020 2020 2066 6e20 3d20             fn = 
+00014590: 6c61 6d62 6461 2073 2c20 632c 206f 6c64  lambda s, c, old
+000145a0: 666e 3d6f 6c64 666e 2c20 2a2a 6b77 6172  fn=oldfn, **kwar
+000145b0: 6773 3a20 6f6c 6466 6e28 732c 2063 290a  gs: oldfn(s, c).
+000145c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145d0: 2020 2020 666e 2e5f 5f6e 616d 655f 5f20      fn.__name__ 
+000145e0: 3d20 2763 6f6d 7061 742d 2720 2b20 6f6c  = 'compat-' + ol
+000145f0: 6466 6e2e 5f5f 6e61 6d65 5f5f 0a20 2020  dfn.__name__.   
+00014600: 2020 2020 2020 2020 2020 2020 206c 2e61               l.a
+00014610: 7070 656e 6428 286d 662c 2066 6e2c 2070  ppend((mf, fn, p
+00014620: 6172 616d 7329 290a 2020 2020 2020 2020  arams)).        
+00014630: 2020 2020 7365 6c66 2e5f 6669 6c74 6572      self._filter
+00014640: 7061 7473 5b66 696c 7465 725d 203d 206c  pats[filter] = l
+00014650: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00014660: 7365 6c66 2e5f 6669 6c74 6572 7061 7473  self._filterpats
+00014670: 5b66 696c 7465 725d 0a0a 2020 2020 6465  [filter]..    de
+00014680: 6620 5f66 696c 7465 7228 7365 6c66 2c20  f _filter(self, 
+00014690: 6669 6c74 6572 7061 7473 2c20 6669 6c65  filterpats, file
+000146a0: 6e61 6d65 2c20 6461 7461 293a 0a20 2020  name, data):.   
+000146b0: 2020 2020 2066 6f72 206d 662c 2066 6e2c       for mf, fn,
+000146c0: 2063 6d64 2069 6e20 6669 6c74 6572 7061   cmd in filterpa
+000146d0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+000146e0: 6966 206d 6628 6669 6c65 6e61 6d65 293a  if mf(filename):
+000146f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014700: 2073 656c 662e 7569 2e64 6562 7567 280a   self.ui.debug(.
+00014710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014720: 2020 2020 6222 6669 6c74 6572 696e 6720      b"filtering 
+00014730: 2573 2074 6872 6f75 6768 2025 735c 6e22  %s through %s\n"
+00014740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014750: 2020 2020 2025 2028 6669 6c65 6e61 6d65       % (filename
+00014760: 2c20 636d 6420 6f72 2070 7963 6f6d 7061  , cmd or pycompa
+00014770: 742e 7379 7362 7974 6573 2866 6e2e 5f5f  t.sysbytes(fn.__
+00014780: 6e61 6d65 5f5f 2929 0a20 2020 2020 2020  name__)).       
+00014790: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000147a0: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+000147b0: 3d20 666e 2864 6174 612c 2063 6d64 2c20  = fn(data, cmd, 
+000147c0: 7569 3d73 656c 662e 7569 2c20 7265 706f  ui=self.ui, repo
+000147d0: 3d73 656c 662c 2066 696c 656e 616d 653d  =self, filename=
+000147e0: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
+000147f0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+00014800: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00014810: 6461 7461 0a0a 2020 2020 4075 6e66 696c  data..    @unfil
+00014820: 7465 7265 6470 726f 7065 7274 7963 6163  teredpropertycac
+00014830: 6865 0a20 2020 2064 6566 205f 656e 636f  he.    def _enco
+00014840: 6465 6669 6c74 6572 7061 7473 2873 656c  defilterpats(sel
+00014850: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+00014860: 726e 2073 656c 662e 5f6c 6f61 6466 696c  rn self._loadfil
+00014870: 7465 7228 6227 656e 636f 6465 2729 0a0a  ter(b'encode')..
+00014880: 2020 2020 4075 6e66 696c 7465 7265 6470      @unfilteredp
+00014890: 726f 7065 7274 7963 6163 6865 0a20 2020  ropertycache.   
+000148a0: 2064 6566 205f 6465 636f 6465 6669 6c74   def _decodefilt
+000148b0: 6572 7061 7473 2873 656c 6629 3a0a 2020  erpats(self):.  
+000148c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000148d0: 662e 5f6c 6f61 6466 696c 7465 7228 6227  f._loadfilter(b'
+000148e0: 6465 636f 6465 2729 0a0a 2020 2020 6465  decode')..    de
+000148f0: 6620 6164 6464 6174 6166 696c 7465 7228  f adddatafilter(
+00014900: 7365 6c66 2c20 6e61 6d65 2c20 6669 6c74  self, name, filt
+00014910: 6572 293a 0a20 2020 2020 2020 2073 656c  er):.        sel
+00014920: 662e 5f64 6174 6166 696c 7465 7273 5b6e  f._datafilters[n
+00014930: 616d 655d 203d 2066 696c 7465 720a 0a20  ame] = filter.. 
+00014940: 2020 2064 6566 2077 7265 6164 2873 656c     def wread(sel
+00014950: 662c 2066 696c 656e 616d 653a 2062 7974  f, filename: byt
+00014960: 6573 2920 2d3e 2062 7974 6573 3a0a 2020  es) -> bytes:.  
+00014970: 2020 2020 2020 6966 2073 656c 662e 7776        if self.wv
+00014980: 6673 2e69 736c 696e 6b28 6669 6c65 6e61  fs.islink(filena
+00014990: 6d65 293a 0a20 2020 2020 2020 2020 2020  me):.           
+000149a0: 2064 6174 6120 3d20 7365 6c66 2e77 7666   data = self.wvf
+000149b0: 732e 7265 6164 6c69 6e6b 2866 696c 656e  s.readlink(filen
+000149c0: 616d 6529 0a20 2020 2020 2020 2065 6c73  ame).        els
+000149d0: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
+000149e0: 6174 6120 3d20 7365 6c66 2e77 7666 732e  ata = self.wvfs.
+000149f0: 7265 6164 2866 696c 656e 616d 6529 0a20  read(filename). 
+00014a00: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00014a10: 6c66 2e5f 6669 6c74 6572 2873 656c 662e  lf._filter(self.
+00014a20: 5f65 6e63 6f64 6566 696c 7465 7270 6174  _encodefilterpat
+00014a30: 732c 2066 696c 656e 616d 652c 2064 6174  s, filename, dat
+00014a40: 6129 0a0a 2020 2020 6465 6620 7777 7269  a)..    def wwri
+00014a50: 7465 280a 2020 2020 2020 2020 7365 6c66  te(.        self
+00014a60: 2c0a 2020 2020 2020 2020 6669 6c65 6e61  ,.        filena
+00014a70: 6d65 3a20 6279 7465 732c 0a20 2020 2020  me: bytes,.     
+00014a80: 2020 2064 6174 613a 2062 7974 6573 2c0a     data: bytes,.
+00014a90: 2020 2020 2020 2020 666c 6167 733a 2062          flags: b
+00014aa0: 7974 6573 2c0a 2020 2020 2020 2020 6261  ytes,.        ba
+00014ab0: 636b 6772 6f75 6e64 636c 6f73 653d 4661  ckgroundclose=Fa
+00014ac0: 6c73 652c 0a20 2020 2020 2020 202a 2a6b  lse,.        **k
+00014ad0: 7761 7267 730a 2020 2020 2920 2d3e 2069  wargs.    ) -> i
+00014ae0: 6e74 3a0a 2020 2020 2020 2020 2222 2277  nt:.        """w
+00014af0: 7269 7465 2060 6064 6174 6160 6020 696e  rite ``data`` in
+00014b00: 746f 2060 6066 696c 656e 616d 6560 6020  to ``filename`` 
+00014b10: 696e 2074 6865 2077 6f72 6b69 6e67 2064  in the working d
+00014b20: 6972 6563 746f 7279 0a0a 2020 2020 2020  irectory..      
+00014b30: 2020 5468 6973 2072 6574 7572 6e73 206c    This returns l
+00014b40: 656e 6774 6820 6f66 2077 7269 7474 656e  ength of written
+00014b50: 2028 6d61 7962 6520 6465 636f 6465 6429   (maybe decoded)
+00014b60: 2064 6174 612e 0a20 2020 2020 2020 2022   data..        "
+00014b70: 2222 0a20 2020 2020 2020 2064 6174 6120  "".        data 
+00014b80: 3d20 7365 6c66 2e5f 6669 6c74 6572 2873  = self._filter(s
+00014b90: 656c 662e 5f64 6563 6f64 6566 696c 7465  elf._decodefilte
+00014ba0: 7270 6174 732c 2066 696c 656e 616d 652c  rpats, filename,
+00014bb0: 2064 6174 6129 0a20 2020 2020 2020 2069   data).        i
+00014bc0: 6620 6227 6c27 2069 6e20 666c 6167 733a  f b'l' in flags:
+00014bd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00014be0: 662e 7776 6673 2e73 796d 6c69 6e6b 2864  f.wvfs.symlink(d
+00014bf0: 6174 612c 2066 696c 656e 616d 6529 0a20  ata, filename). 
+00014c00: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00014c10: 2020 2020 2020 2020 2073 656c 662e 7776           self.wv
+00014c20: 6673 2e77 7269 7465 280a 2020 2020 2020  fs.write(.      
+00014c30: 2020 2020 2020 2020 2020 6669 6c65 6e61            filena
+00014c40: 6d65 2c20 6461 7461 2c20 6261 636b 6772  me, data, backgr
+00014c50: 6f75 6e64 636c 6f73 653d 6261 636b 6772  oundclose=backgr
+00014c60: 6f75 6e64 636c 6f73 652c 202a 2a6b 7761  oundclose, **kwa
+00014c70: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
+00014c80: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00014c90: 2062 2778 2720 696e 2066 6c61 6773 3a0a   b'x' in flags:.
+00014ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014cb0: 7365 6c66 2e77 7666 732e 7365 7466 6c61  self.wvfs.setfla
+00014cc0: 6773 2866 696c 656e 616d 652c 2046 616c  gs(filename, Fal
+00014cd0: 7365 2c20 5472 7565 290a 2020 2020 2020  se, True).      
+00014ce0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00014cf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00014d00: 2e77 7666 732e 7365 7466 6c61 6773 2866  .wvfs.setflags(f
+00014d10: 696c 656e 616d 652c 2046 616c 7365 2c20  ilename, False, 
+00014d20: 4661 6c73 6529 0a20 2020 2020 2020 2072  False).        r
+00014d30: 6574 7572 6e20 6c65 6e28 6461 7461 290a  eturn len(data).
+00014d40: 0a20 2020 2064 6566 2077 7772 6974 6564  .    def wwrited
+00014d50: 6174 6128 7365 6c66 2c20 6669 6c65 6e61  ata(self, filena
+00014d60: 6d65 3a20 6279 7465 732c 2064 6174 613a  me: bytes, data:
+00014d70: 2062 7974 6573 2920 2d3e 2062 7974 6573   bytes) -> bytes
+00014d80: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00014d90: 2073 656c 662e 5f66 696c 7465 7228 7365   self._filter(se
+00014da0: 6c66 2e5f 6465 636f 6465 6669 6c74 6572  lf._decodefilter
+00014db0: 7061 7473 2c20 6669 6c65 6e61 6d65 2c20  pats, filename, 
+00014dc0: 6461 7461 290a 0a20 2020 2064 6566 2063  data)..    def c
+00014dd0: 7572 7265 6e74 7472 616e 7361 6374 696f  urrenttransactio
+00014de0: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
+00014df0: 2022 2222 7265 7475 726e 2074 6865 2063   """return the c
+00014e00: 7572 7265 6e74 2074 7261 6e73 6163 7469  urrent transacti
+00014e10: 6f6e 206f 7220 4e6f 6e65 2069 6620 6e6f  on or None if no
+00014e20: 6e20 6578 6973 7473 2222 220a 2020 2020  n exists""".    
+00014e30: 2020 2020 6966 2073 656c 662e 5f74 7261      if self._tra
+00014e40: 6e73 7265 663a 0a20 2020 2020 2020 2020  nsref:.         
+00014e50: 2020 2074 7220 3d20 7365 6c66 2e5f 7472     tr = self._tr
+00014e60: 616e 7372 6566 2829 0a20 2020 2020 2020  ansref().       
+00014e70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00014e80: 2020 2074 7220 3d20 4e6f 6e65 0a0a 2020     tr = None..  
+00014e90: 2020 2020 2020 6966 2074 7220 616e 6420        if tr and 
+00014ea0: 7472 2e72 756e 6e69 6e67 2829 3a0a 2020  tr.running():.  
+00014eb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00014ec0: 2074 720a 2020 2020 2020 2020 7265 7475   tr.        retu
+00014ed0: 726e 204e 6f6e 650a 0a20 2020 2064 6566  rn None..    def
+00014ee0: 2074 7261 6e73 6163 7469 6f6e 2873 656c   transaction(sel
+00014ef0: 662c 2064 6573 632c 2072 6570 6f72 743d  f, desc, report=
+00014f00: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
+00014f10: 6620 7365 6c66 2e75 692e 636f 6e66 6967  f self.ui.config
+00014f20: 626f 6f6c 2862 2764 6576 656c 272c 2062  bool(b'devel', b
+00014f30: 2761 6c6c 2d77 6172 6e69 6e67 7327 2920  'all-warnings') 
+00014f40: 6f72 2073 656c 662e 7569 2e63 6f6e 6669  or self.ui.confi
+00014f50: 6762 6f6f 6c28 0a20 2020 2020 2020 2020  gbool(.         
+00014f60: 2020 2062 2764 6576 656c 272c 2062 2763     b'devel', b'c
+00014f70: 6865 636b 2d6c 6f63 6b73 270a 2020 2020  heck-locks'.    
+00014f80: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00014f90: 2020 2069 6620 7365 6c66 2e5f 6375 7272     if self._curr
+00014fa0: 656e 746c 6f63 6b28 7365 6c66 2e5f 6c6f  entlock(self._lo
+00014fb0: 636b 7265 6629 2069 7320 4e6f 6e65 3a0a  ckref) is None:.
+00014fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014fd0: 7261 6973 6520 6572 726f 722e 5072 6f67  raise error.Prog
+00014fe0: 7261 6d6d 696e 6745 7272 6f72 2862 2774  rammingError(b't
+00014ff0: 7261 6e73 6163 7469 6f6e 2072 6571 7569  ransaction requi
+00015000: 7265 7320 6c6f 636b 696e 6727 290a 2020  res locking').  
+00015010: 2020 2020 2020 7472 203d 2073 656c 662e        tr = self.
+00015020: 6375 7272 656e 7474 7261 6e73 6163 7469  currenttransacti
+00015030: 6f6e 2829 0a20 2020 2020 2020 2069 6620  on().        if 
+00015040: 7472 2069 7320 6e6f 7420 4e6f 6e65 3a0a  tr is not None:.
+00015050: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00015060: 726e 2074 722e 6e65 7374 286e 616d 653d  rn tr.nest(name=
+00015070: 6465 7363 290a 0a20 2020 2020 2020 2023  desc)..        #
+00015080: 2061 626f 7274 2068 6572 6520 6966 2074   abort here if t
+00015090: 6865 206a 6f75 726e 616c 2061 6c72 6561  he journal alrea
+000150a0: 6479 2065 7869 7374 730a 2020 2020 2020  dy exists.      
+000150b0: 2020 6966 2073 656c 662e 7376 6673 2e65    if self.svfs.e
+000150c0: 7869 7374 7328 6222 6a6f 7572 6e61 6c22  xists(b"journal"
+000150d0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+000150e0: 6169 7365 2065 7272 6f72 2e52 6570 6f45  aise error.RepoE
+000150f0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00015100: 2020 2020 2020 5f28 6222 6162 616e 646f        _(b"abando
+00015110: 6e65 6420 7472 616e 7361 6374 696f 6e20  ned transaction 
+00015120: 666f 756e 6422 292c 0a20 2020 2020 2020  found"),.       
+00015130: 2020 2020 2020 2020 2068 696e 743d 5f28           hint=_(
+00015140: 6222 7275 6e20 2768 6720 7265 636f 7665  b"run 'hg recove
+00015150: 7227 2074 6f20 636c 6561 6e20 7570 2074  r' to clean up t
+00015160: 7261 6e73 6163 7469 6f6e 2229 2c0a 2020  ransaction"),.  
+00015170: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00015180: 2020 2020 2023 2041 7420 7468 6174 2070       # At that p
+00015190: 6f69 6e74 2079 6f75 7220 6469 7273 7461  oint your dirsta
+000151a0: 7465 2073 686f 756c 6420 6265 2063 6c65  te should be cle
+000151b0: 616e 3a0a 2020 2020 2020 2020 230a 2020  an:.        #.  
+000151c0: 2020 2020 2020 2320 2d20 4966 2079 6f75        # - If you
+000151d0: 2064 6f6e 2774 2068 6176 6520 7468 6520   don't have the 
+000151e0: 776c 6f63 6b2c 2077 6879 2077 6f75 6c64  wlock, why would
+000151f0: 2079 6f75 2073 7469 6c6c 2068 6176 6520   you still have 
+00015200: 6120 6469 7274 790a 2020 2020 2020 2020  a dirty.        
+00015210: 2320 2020 6469 7273 7461 7465 203f 0a20  #   dirstate ?. 
+00015220: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
+00015230: 2023 202d 2049 6620 796f 7520 686f 6c64   # - If you hold
+00015240: 2074 6865 2077 6c6f 636b 2c20 796f 7520   the wlock, you 
+00015250: 7368 6f75 6c64 206e 6f74 2062 6520 6f70  should not be op
+00015260: 656e 696e 6720 6120 7472 616e 7361 6374  ening a transact
+00015270: 696f 6e20 696e 0a20 2020 2020 2020 2023  ion in.        #
+00015280: 2020 2074 6865 206d 6964 646c 6520 6f66     the middle of
+00015290: 2061 2060 6469 7374 6174 652e 6368 616e   a `distate.chan
+000152a0: 6769 6e67 5f2a 6020 626c 6f63 6b2e 2054  ging_*` block. T
+000152b0: 6865 2074 7261 6e73 6163 7469 6f6e 206e  he transaction n
+000152c0: 6565 6473 2074 6f0a 2020 2020 2020 2020  eeds to.        
+000152d0: 2320 2020 6265 206f 7065 6e20 6265 666f  #   be open befo
+000152e0: 7265 2074 6861 7420 616e 6420 7772 6170  re that and wrap
+000152f0: 2074 6865 2063 6861 6e67 652d 636f 6e74   the change-cont
+00015300: 6578 742e 0a20 2020 2020 2020 2023 0a20  ext..        #. 
+00015310: 2020 2020 2020 2023 202d 2049 6620 796f         # - If yo
+00015320: 7520 6172 6520 6e6f 7420 7769 7468 696e  u are not within
+00015330: 2061 2060 6469 7273 7461 7465 2e63 6861   a `dirstate.cha
+00015340: 6e67 696e 675f 2a60 2063 6f6e 7465 7874  nging_*` context
+00015350: 2c20 7768 7920 6973 206f 7572 0a20 2020  , why is our.   
+00015360: 2020 2020 2023 2020 2064 6972 7374 6174       #   dirstat
+00015370: 6520 6469 7274 793f 0a20 2020 2020 2020  e dirty?.       
+00015380: 2069 6620 7365 6c66 2e64 6972 7374 6174   if self.dirstat
+00015390: 652e 5f64 6972 7479 3a0a 2020 2020 2020  e._dirty:.      
+000153a0: 2020 2020 2020 6d20 3d20 2263 616e 6e6f        m = "canno
+000153b0: 7420 6f70 656e 2061 2074 7261 6e73 6163  t open a transac
+000153c0: 7469 6f6e 2077 6974 6820 6120 6469 7274  tion with a dirt
+000153d0: 7920 6469 7273 7461 7465 220a 2020 2020  y dirstate".    
+000153e0: 2020 2020 2020 2020 7261 6973 6520 6572          raise er
+000153f0: 726f 722e 5072 6f67 7261 6d6d 696e 6745  ror.ProgrammingE
+00015400: 7272 6f72 286d 290a 0a20 2020 2020 2020  rror(m)..       
+00015410: 2069 6462 6173 6520 3d20 6222 252e 3430   idbase = b"%.40
+00015420: 6623 2566 2220 2520 2872 616e 646f 6d2e  f#%f" % (random.
+00015430: 7261 6e64 6f6d 2829 2c20 7469 6d65 2e74  random(), time.t
+00015440: 696d 6528 2929 0a20 2020 2020 2020 2068  ime()).        h
+00015450: 6120 3d20 6865 7828 6861 7368 7574 696c  a = hex(hashutil
+00015460: 2e73 6861 3128 6964 6261 7365 292e 6469  .sha1(idbase).di
+00015470: 6765 7374 2829 290a 2020 2020 2020 2020  gest()).        
+00015480: 7478 6e69 6420 3d20 6227 5458 4e3a 2720  txnid = b'TXN:' 
+00015490: 2b20 6861 0a20 2020 2020 2020 2073 656c  + ha.        sel
+000154a0: 662e 686f 6f6b 2862 2770 7265 7478 6e6f  f.hook(b'pretxno
+000154b0: 7065 6e27 2c20 7468 726f 773d 5472 7565  pen', throw=True
+000154c0: 2c20 7478 6e6e 616d 653d 6465 7363 2c20  , txnname=desc, 
+000154d0: 7478 6e69 643d 7478 6e69 6429 0a0a 2020  txnid=txnid)..  
+000154e0: 2020 2020 2020 7365 6c66 2e5f 7772 6974        self._writ
+000154f0: 656a 6f75 726e 616c 2864 6573 6329 0a20  ejournal(desc). 
+00015500: 2020 2020 2020 2069 6620 7265 706f 7274         if report
+00015510: 3a0a 2020 2020 2020 2020 2020 2020 7270  :.            rp
+00015520: 203d 2072 6570 6f72 740a 2020 2020 2020   = report.      
+00015530: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00015540: 2020 2020 7270 203d 2073 656c 662e 7569      rp = self.ui
+00015550: 2e77 6172 6e0a 2020 2020 2020 2020 7666  .warn.        vf
+00015560: 736d 6170 203d 2073 656c 662e 7666 735f  smap = self.vfs_
+00015570: 6d61 700a 2020 2020 2020 2020 2320 7765  map.        # we
+00015580: 206d 7573 7420 6176 6f69 6420 6379 636c   must avoid cycl
+00015590: 6963 2072 6566 6572 656e 6365 2062 6574  ic reference bet
+000155a0: 7765 656e 2072 6570 6f20 616e 6420 7472  ween repo and tr
+000155b0: 616e 7361 6374 696f 6e2e 0a20 2020 2020  ansaction..     
+000155c0: 2020 2072 6570 6f72 6566 203d 2077 6561     reporef = wea
+000155d0: 6b72 6566 2e72 6566 2873 656c 6629 0a20  kref.ref(self). 
+000155e0: 2020 2020 2020 2023 2043 6f64 6520 746f         # Code to
+000155f0: 2074 7261 636b 2074 6167 206d 6f76 656d   track tag movem
+00015600: 656e 740a 2020 2020 2020 2020 230a 2020  ent.        #.  
+00015610: 2020 2020 2020 2320 5369 6e63 6520 7461        # Since ta
+00015620: 6773 2061 7265 2061 6c6c 2068 616e 646c  gs are all handl
+00015630: 6564 2061 7320 6669 6c65 2063 6f6e 7465  ed as file conte
+00015640: 6e74 2c20 6974 2069 7320 6163 7475 616c  nt, it is actual
+00015650: 6c79 2071 7569 7465 2068 6172 640a 2020  ly quite hard.  
+00015660: 2020 2020 2020 2320 746f 2074 7261 636b        # to track
+00015670: 2074 6865 7365 206d 6f76 656d 656e 7420   these movement 
+00015680: 6672 6f6d 2061 2063 6f64 6520 7065 7273  from a code pers
+00015690: 7065 6374 6976 652e 2053 6f20 7765 2066  pective. So we f
+000156a0: 616c 6c62 6163 6b20 746f 2061 0a20 2020  allback to a.   
+000156b0: 2020 2020 2023 2074 7261 636b 696e 6720       # tracking 
+000156c0: 6174 2074 6865 2072 6570 6f73 6974 6f72  at the repositor
+000156d0: 7920 6c65 7665 6c2e 204f 6e65 2063 6f75  y level. One cou
+000156e0: 6c64 2065 6e76 6973 696f 6e20 746f 2074  ld envision to t
+000156f0: 7261 636b 2063 6861 6e67 6573 0a20 2020  rack changes.   
+00015700: 2020 2020 2023 2074 6f20 7468 6520 272e       # to the '.
+00015710: 6867 7461 6773 2720 6669 6c65 2074 6872  hgtags' file thr
+00015720: 6f75 6768 2063 6861 6e67 6567 726f 7570  ough changegroup
+00015730: 2061 7070 6c79 2062 7574 2074 6861 7420   apply but that 
+00015740: 6661 696c 7320 746f 0a20 2020 2020 2020  fails to.       
+00015750: 2023 2063 6f70 6520 7769 7468 2063 6173   # cope with cas
+00015760: 6520 7768 6572 6520 7472 616e 7361 6374  e where transact
+00015770: 696f 6e20 6578 706f 7365 206e 6577 2068  ion expose new h
+00015780: 6561 6473 2077 6974 686f 7574 2063 6861  eads without cha
+00015790: 6e67 6567 726f 7570 0a20 2020 2020 2020  ngegroup.       
+000157a0: 2023 2062 6569 6e67 2069 6e76 6f6c 7665   # being involve
+000157b0: 6420 2865 673a 2070 6861 7365 206d 6f76  d (eg: phase mov
+000157c0: 656d 656e 7429 2e0a 2020 2020 2020 2020  ement)..        
+000157d0: 230a 2020 2020 2020 2020 2320 466f 7220  #.        # For 
+000157e0: 6e6f 772c 2057 6520 6761 7465 2074 6865  now, We gate the
+000157f0: 2066 6561 7475 7265 2062 6568 696e 6420   feature behind 
+00015800: 6120 666c 6167 2073 696e 6365 2074 6869  a flag since thi
+00015810: 7320 6c69 6b65 6c79 2063 6f6d 6573 0a20  s likely comes. 
+00015820: 2020 2020 2020 2023 2077 6974 6820 7065         # with pe
+00015830: 7266 6f72 6d61 6e63 6520 696d 7061 6374  rformance impact
+00015840: 732e 2054 6865 2063 7572 7265 6e74 2063  s. The current c
+00015850: 6f64 6520 7275 6e20 6d6f 7265 206f 6674  ode run more oft
+00015860: 656e 2074 6861 6e20 6e65 6564 6564 0a20  en than needed. 
+00015870: 2020 2020 2020 2023 2061 6e64 2064 6f20         # and do 
+00015880: 6e6f 7420 7573 6520 6361 6368 6573 2061  not use caches a
+00015890: 7320 6d75 6368 2061 7320 6974 2063 6f75  s much as it cou
+000158a0: 6c64 2e20 2054 6865 2063 7572 7265 6e74  ld.  The current
+000158b0: 2066 6f63 7573 2069 7320 6f6e 0a20 2020   focus is on.   
+000158c0: 2020 2020 2023 2074 6865 2062 6568 6176       # the behav
+000158d0: 696f 7220 6f66 2074 6865 2066 6561 7475  ior of the featu
+000158e0: 7265 2073 6f20 7765 2064 6973 6162 6c65  re so we disable
+000158f0: 2069 7420 6279 2064 6566 6175 6c74 2e20   it by default. 
+00015900: 5468 6520 666c 6167 0a20 2020 2020 2020  The flag.       
+00015910: 2023 2077 696c 6c20 6265 2072 656d 6f76   # will be remov
+00015920: 6564 2077 6865 6e20 7765 2061 7265 2068  ed when we are h
+00015930: 6170 7079 2077 6974 6820 7468 6520 7065  appy with the pe
+00015940: 7266 6f72 6d61 6e63 6520 696d 7061 6374  rformance impact
+00015950: 2e0a 2020 2020 2020 2020 230a 2020 2020  ..        #.    
+00015960: 2020 2020 2320 4f6e 6365 2074 6869 7320      # Once this 
+00015970: 6665 6174 7572 6520 6973 206e 6f20 6c6f  feature is no lo
+00015980: 6e67 6572 2065 7870 6572 696d 656e 7461  nger experimenta
+00015990: 6c20 6d6f 7665 2074 6865 2066 6f6c 6c6f  l move the follo
+000159a0: 7769 6e67 0a20 2020 2020 2020 2023 2064  wing.        # d
+000159b0: 6f63 756d 656e 7461 7469 6f6e 2074 6f20  ocumentation to 
+000159c0: 7468 6520 6170 7072 6f70 7269 6174 6520  the appropriate 
+000159d0: 6865 6c70 2073 6563 7469 6f6e 3a0a 2020  help section:.  
+000159e0: 2020 2020 2020 230a 2020 2020 2020 2020        #.        
+000159f0: 2320 5468 6520 6060 4847 5f54 4147 5f4d  # The ``HG_TAG_M
+00015a00: 4f56 4544 6060 2076 6172 6961 626c 6520  OVED`` variable 
+00015a10: 7769 6c6c 2062 6520 7365 7420 6966 2074  will be set if t
+00015a20: 6865 2074 7261 6e73 6163 7469 6f6e 2074  he transaction t
+00015a30: 6f75 6368 6564 0a20 2020 2020 2020 2023  ouched.        #
+00015a40: 2074 6167 7320 286e 6577 206f 7220 6368   tags (new or ch
+00015a50: 616e 6765 6420 6f72 2064 656c 6574 6564  anged or deleted
+00015a60: 2074 6167 7329 2e20 496e 2061 6464 6974   tags). In addit
+00015a70: 696f 6e20 7468 6520 6465 7461 696c 7320  ion the details 
+00015a80: 6f66 0a20 2020 2020 2020 2023 2074 6865  of.        # the
+00015a90: 7365 2063 6861 6e67 6573 2061 7265 206d  se changes are m
+00015aa0: 6164 6520 6176 6169 6c61 626c 6520 696e  ade available in
+00015ab0: 2061 2066 696c 6520 6174 3a0a 2020 2020   a file at:.    
+00015ac0: 2020 2020 2320 2020 2020 6060 5245 504f      #     ``REPO
+00015ad0: 524f 4f54 2f2e 6867 2f63 6861 6e67 6573  ROOT/.hg/changes
+00015ae0: 2f74 6167 732e 6368 616e 6765 7360 602e  /tags.changes``.
+00015af0: 0a20 2020 2020 2020 2023 204d 616b 6520  .        # Make 
+00015b00: 7375 7265 2079 6f75 2063 6865 636b 2066  sure you check f
+00015b10: 6f72 2048 475f 5441 475f 4d4f 5645 4420  or HG_TAG_MOVED 
+00015b20: 6265 666f 7265 2072 6561 6469 6e67 2074  before reading t
+00015b30: 6861 7420 6669 6c65 2061 7320 6974 0a20  hat file as it. 
+00015b40: 2020 2020 2020 2023 206d 6967 6874 2065         # might e
+00015b50: 7869 7374 2066 726f 6d20 6120 7072 6576  xist from a prev
+00015b60: 696f 7573 2074 7261 6e73 6163 7469 6f6e  ious transaction
+00015b70: 2065 7665 6e20 6966 206e 6f20 7461 6720   even if no tag 
+00015b80: 7765 7265 2074 6f75 6368 6564 0a20 2020  were touched.   
+00015b90: 2020 2020 2023 2069 6e20 7468 6973 206f       # in this o
+00015ba0: 6e65 2e20 4368 616e 6765 7320 6172 6520  ne. Changes are 
+00015bb0: 7265 636f 7264 6564 2069 6e20 6120 6c69  recorded in a li
+00015bc0: 6e65 2062 6173 6520 666f 726d 6174 3a3a  ne base format::
+00015bd0: 0a20 2020 2020 2020 2023 0a20 2020 2020  .        #.     
+00015be0: 2020 2023 2020 2020 203c 6163 7469 6f6e     #     <action
+00015bf0: 3e20 3c68 6578 2d6e 6f64 653e 203c 7461  > <hex-node> <ta
+00015c00: 672d 6e61 6d65 3e5c 6e0a 2020 2020 2020  g-name>\n.      
+00015c10: 2020 230a 2020 2020 2020 2020 2320 4163    #.        # Ac
+00015c20: 7469 6f6e 7320 6172 6520 6465 6669 6e65  tions are define
+00015c30: 6420 6173 2066 6f6c 6c6f 773a 0a20 2020  d as follow:.   
+00015c40: 2020 2020 2023 2020 2022 2d52 223a 2074       #   "-R": t
+00015c50: 6167 2069 7320 7265 6d6f 7665 642c 0a20  ag is removed,. 
+00015c60: 2020 2020 2020 2023 2020 2022 2b41 223a         #   "+A":
+00015c70: 2074 6167 2069 7320 6164 6465 642c 0a20   tag is added,. 
+00015c80: 2020 2020 2020 2023 2020 2022 2d4d 223a         #   "-M":
+00015c90: 2074 6167 2069 7320 6d6f 7665 6420 286f   tag is moved (o
+00015ca0: 6c64 2076 616c 7565 292c 0a20 2020 2020  ld value),.     
+00015cb0: 2020 2023 2020 2022 2b4d 223a 2074 6167     #   "+M": tag
+00015cc0: 2069 7320 6d6f 7665 6420 286e 6577 2076   is moved (new v
+00015cd0: 616c 7565 292c 0a20 2020 2020 2020 2074  alue),.        t
+00015ce0: 7261 636b 7461 6773 203d 206c 616d 6264  racktags = lambd
+00015cf0: 6120 783a 204e 6f6e 650a 2020 2020 2020  a x: None.      
+00015d00: 2020 2320 6578 7065 7269 6d65 6e74 616c    # experimental
+00015d10: 2063 6f6e 6669 673a 2065 7870 6572 696d   config: experim
+00015d20: 656e 7461 6c2e 686f 6f6b 2d74 7261 636b  ental.hook-track
+00015d30: 2d74 6167 730a 2020 2020 2020 2020 7368  -tags.        sh
+00015d40: 6f75 6c64 7472 6163 6b74 6167 7320 3d20  ouldtracktags = 
+00015d50: 7365 6c66 2e75 692e 636f 6e66 6967 626f  self.ui.configbo
+00015d60: 6f6c 280a 2020 2020 2020 2020 2020 2020  ol(.            
+00015d70: 6227 6578 7065 7269 6d65 6e74 616c 272c  b'experimental',
+00015d80: 2062 2768 6f6f 6b2d 7472 6163 6b2d 7461   b'hook-track-ta
+00015d90: 6773 270a 2020 2020 2020 2020 290a 2020  gs'.        ).  
+00015da0: 2020 2020 2020 6966 2064 6573 6320 213d        if desc !=
+00015db0: 2062 2773 7472 6970 2720 616e 6420 7368   b'strip' and sh
+00015dc0: 6f75 6c64 7472 6163 6b74 6167 733a 0a20  ouldtracktags:. 
+00015dd0: 2020 2020 2020 2020 2020 206f 6c64 6865             oldhe
+00015de0: 6164 7320 3d20 7365 6c66 2e63 6861 6e67  ads = self.chang
+00015df0: 656c 6f67 2e68 6561 6472 6576 7328 290a  elog.headrevs().
+00015e00: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00015e10: 2074 7261 636b 7461 6773 2874 7232 293a   tracktags(tr2):
+00015e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015e30: 2072 6570 6f20 3d20 7265 706f 7265 6628   repo = reporef(
+00015e40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015e50: 2020 6173 7365 7274 2072 6570 6f20 6973    assert repo is
+00015e60: 206e 6f74 204e 6f6e 6520 2023 2068 656c   not None  # hel
+00015e70: 7020 7079 7479 7065 0a20 2020 2020 2020  p pytype.       
+00015e80: 2020 2020 2020 2020 206f 6c64 666e 6f64           oldfnod
+00015e90: 6573 203d 2074 6167 736d 6f64 2e66 6e6f  es = tagsmod.fno
+00015ea0: 6465 7265 7673 2872 6570 6f2e 7569 2c20  derevs(repo.ui, 
+00015eb0: 7265 706f 2c20 6f6c 6468 6561 6473 290a  repo, oldheads).
+00015ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ed0: 6e65 7768 6561 6473 203d 2072 6570 6f2e  newheads = repo.
+00015ee0: 6368 616e 6765 6c6f 672e 6865 6164 7265  changelog.headre
+00015ef0: 7673 2829 0a20 2020 2020 2020 2020 2020  vs().           
+00015f00: 2020 2020 206e 6577 666e 6f64 6573 203d       newfnodes =
+00015f10: 2074 6167 736d 6f64 2e66 6e6f 6465 7265   tagsmod.fnodere
+00015f20: 7673 2872 6570 6f2e 7569 2c20 7265 706f  vs(repo.ui, repo
+00015f30: 2c20 6e65 7768 6561 6473 290a 2020 2020  , newheads).    
+00015f40: 2020 2020 2020 2020 2020 2020 2320 6e6f              # no
+00015f50: 7465 733a 2077 6520 636f 6d70 6172 6520  tes: we compare 
+00015f60: 6c69 7374 7320 6865 7265 2e0a 2020 2020  lists here..    
+00015f70: 2020 2020 2020 2020 2020 2020 2320 4173              # As
+00015f80: 2077 6520 646f 2069 7420 6f6e 6c79 206f   we do it only o
+00015f90: 6e63 6520 6275 6964 696e 6720 7365 7420  nce buiding set 
+00015fa0: 776f 756c 6420 6e6f 7420 6265 2063 6865  would not be che
+00015fb0: 6170 6572 0a20 2020 2020 2020 2020 2020  aper.           
+00015fc0: 2020 2020 2063 6861 6e67 6573 203d 2074       changes = t
+00015fd0: 6167 736d 6f64 2e64 6966 6674 6167 7328  agsmod.difftags(
+00015fe0: 7265 706f 2e75 692c 2072 6570 6f2c 206f  repo.ui, repo, o
+00015ff0: 6c64 666e 6f64 6573 2c20 6e65 7766 6e6f  ldfnodes, newfno
+00016000: 6465 7329 0a20 2020 2020 2020 2020 2020  des).           
+00016010: 2020 2020 2069 6620 6368 616e 6765 733a       if changes:
+00016020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016030: 2020 2020 2074 7232 2e68 6f6f 6b61 7267       tr2.hookarg
+00016040: 735b 6227 7461 675f 6d6f 7665 6427 5d20  s[b'tag_moved'] 
+00016050: 3d20 6227 3127 0a20 2020 2020 2020 2020  = b'1'.         
+00016060: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00016070: 7265 706f 2e76 6673 280a 2020 2020 2020  repo.vfs(.      
+00016080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016090: 2020 6227 6368 616e 6765 732f 7461 6773    b'changes/tags
+000160a0: 2e63 6861 6e67 6573 272c 2062 2777 272c  .changes', b'w',
+000160b0: 2061 746f 6d69 6374 656d 703d 5472 7565   atomictemp=True
+000160c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000160d0: 2020 2020 2029 2061 7320 6368 616e 6765       ) as change
+000160e0: 7366 696c 653a 0a20 2020 2020 2020 2020  sfile:.         
+000160f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00016100: 206e 6f74 653a 2077 6520 646f 206e 6f74   note: we do not
+00016110: 2072 6567 6973 7465 7220 7468 6520 6669   register the fi
+00016120: 6c65 2074 6f20 7468 6520 7472 616e 7361  le to the transa
+00016130: 6374 696f 6e0a 2020 2020 2020 2020 2020  ction.          
+00016140: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00016150: 6265 6361 7573 6520 7765 206e 6565 6473  because we needs
+00016160: 2069 7420 746f 2073 7469 6c6c 2065 7869   it to still exi
+00016170: 7374 206f 6e20 7468 6520 7472 616e 7361  st on the transa
+00016180: 6374 696f 6e0a 2020 2020 2020 2020 2020  ction.          
+00016190: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000161a0: 6973 2063 6c6f 7365 2028 666f 7220 7478  is close (for tx
+000161b0: 6e63 6c6f 7365 2068 6f6f 6b73 290a 2020  nclose hooks).  
 000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161d0: 2020 6669 6c74 6572 6e61 6d65 203d 2062    filtername = b
-000161e0: 2276 6973 6962 6c65 220a 2020 2020 2020  "visible".      
-000161f0: 2020 2020 2020 2020 2020 7363 6d75 7469            scmuti
-00016200: 6c2e 656e 666f 7263 6573 696e 676c 6568  l.enforcesingleh
-00016210: 6561 6428 0a20 2020 2020 2020 2020 2020  ead(.           
-00016220: 2020 2020 2020 2020 2072 6570 6f2c 2074           repo, t
-00016230: 7232 2c20 6465 7363 2c20 6163 636f 756e  r2, desc, accoun
-00016240: 7463 6c6f 7365 642c 2066 696c 7465 726e  tclosed, filtern
-00016250: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-00016260: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00016270: 2020 6966 2068 6f6f 6b2e 6861 7368 6f6f    if hook.hashoo
-00016280: 6b28 7265 706f 2e75 692c 2062 2770 7265  k(repo.ui, b'pre
-00016290: 7478 6e63 6c6f 7365 2d62 6f6f 6b6d 6172  txnclose-bookmar
-000162a0: 6b27 293a 0a20 2020 2020 2020 2020 2020  k'):.           
-000162b0: 2020 2020 2066 6f72 206e 616d 652c 2028       for name, (
-000162c0: 6f6c 642c 206e 6577 2920 696e 2073 6f72  old, new) in sor
-000162d0: 7465 6428 0a20 2020 2020 2020 2020 2020  ted(.           
-000162e0: 2020 2020 2020 2020 2074 722e 6368 616e           tr.chan
-000162f0: 6765 735b 6227 626f 6f6b 6d61 726b 7327  ges[b'bookmarks'
-00016300: 5d2e 6974 656d 7328 290a 2020 2020 2020  ].items().      
-00016310: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-00016320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016330: 2061 7267 7320 3d20 7472 2e68 6f6f 6b61   args = tr.hooka
-00016340: 7267 732e 636f 7079 2829 0a20 2020 2020  rgs.copy().     
-00016350: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00016360: 7267 732e 7570 6461 7465 2862 6f6f 6b6d  rgs.update(bookm
-00016370: 6172 6b73 2e70 7265 7061 7265 686f 6f6b  arks.preparehook
-00016380: 6172 6773 286e 616d 652c 206f 6c64 2c20  args(name, old, 
-00016390: 6e65 7729 290a 2020 2020 2020 2020 2020  new)).          
-000163a0: 2020 2020 2020 2020 2020 7265 706f 2e68            repo.h
-000163b0: 6f6f 6b28 0a20 2020 2020 2020 2020 2020  ook(.           
-000163c0: 2020 2020 2020 2020 2020 2020 2062 2770               b'p
-000163d0: 7265 7478 6e63 6c6f 7365 2d62 6f6f 6b6d  retxnclose-bookm
-000163e0: 6172 6b27 2c0a 2020 2020 2020 2020 2020  ark',.          
-000163f0: 2020 2020 2020 2020 2020 2020 2020 7468                th
-00016400: 726f 773d 5472 7565 2c0a 2020 2020 2020  row=True,.      
-00016410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016420: 2020 2a2a 7079 636f 6d70 6174 2e73 7472    **pycompat.str
-00016430: 6b77 6172 6773 2861 7267 7329 0a20 2020  kwargs(args).   
-00016440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016450: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
-00016460: 6620 686f 6f6b 2e68 6173 686f 6f6b 2872  f hook.hashook(r
-00016470: 6570 6f2e 7569 2c20 6227 7072 6574 786e  epo.ui, b'pretxn
-00016480: 636c 6f73 652d 7068 6173 6527 293a 0a20  close-phase'):. 
-00016490: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000164a0: 6c20 3d20 7265 706f 2e75 6e66 696c 7465  l = repo.unfilte
-000164b0: 7265 6428 292e 6368 616e 6765 6c6f 670a  red().changelog.
-000164c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000164d0: 666f 7220 7265 7673 2c20 286f 6c64 2c20  for revs, (old, 
-000164e0: 6e65 7729 2069 6e20 7472 2e63 6861 6e67  new) in tr.chang
-000164f0: 6573 5b62 2770 6861 7365 7327 5d3a 0a20  es[b'phases']:. 
-00016500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016510: 2020 2066 6f72 2072 6576 2069 6e20 7265     for rev in re
-00016520: 7673 3a0a 2020 2020 2020 2020 2020 2020  vs:.            
-00016530: 2020 2020 2020 2020 2020 2020 6172 6773              args
-00016540: 203d 2074 722e 686f 6f6b 6172 6773 2e63   = tr.hookargs.c
-00016550: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-00016560: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-00016570: 6465 203d 2068 6578 2863 6c2e 6e6f 6465  de = hex(cl.node
-00016580: 2872 6576 2929 0a20 2020 2020 2020 2020  (rev)).         
-00016590: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000165a0: 7267 732e 7570 6461 7465 2870 6861 7365  rgs.update(phase
-000165b0: 732e 7072 6570 6172 6568 6f6f 6b61 7267  s.preparehookarg
-000165c0: 7328 6e6f 6465 2c20 6f6c 642c 206e 6577  s(node, old, new
-000165d0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-000165e0: 2020 2020 2020 2020 2020 2072 6570 6f2e             repo.
-000165f0: 686f 6f6b 280a 2020 2020 2020 2020 2020  hook(.          
-00016600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016610: 2020 6227 7072 6574 786e 636c 6f73 652d    b'pretxnclose-
-00016620: 7068 6173 6527 2c0a 2020 2020 2020 2020  phase',.        
-00016630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016640: 2020 2020 7468 726f 773d 5472 7565 2c0a      throw=True,.
-00016650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016660: 2020 2020 2020 2020 2020 2020 2a2a 7079              **py
-00016670: 636f 6d70 6174 2e73 7472 6b77 6172 6773  compat.strkwargs
-00016680: 2861 7267 7329 0a20 2020 2020 2020 2020  (args).         
-00016690: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000166a0: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-000166b0: 706f 2e68 6f6f 6b28 0a20 2020 2020 2020  po.hook(.       
-000166c0: 2020 2020 2020 2020 2062 2770 7265 7478           b'pretx
-000166d0: 6e63 6c6f 7365 272c 2074 6872 6f77 3d54  nclose', throw=T
-000166e0: 7275 652c 202a 2a70 7963 6f6d 7061 742e  rue, **pycompat.
-000166f0: 7374 726b 7761 7267 7328 7472 2e68 6f6f  strkwargs(tr.hoo
-00016700: 6b61 7267 7329 0a20 2020 2020 2020 2020  kargs).         
-00016710: 2020 2029 0a0a 2020 2020 2020 2020 6465     )..        de
-00016720: 6620 7265 6c65 6173 6566 6e28 7472 2c20  f releasefn(tr, 
-00016730: 7375 6363 6573 7329 3a0a 2020 2020 2020  success):.      
-00016740: 2020 2020 2020 7265 706f 203d 2072 6570        repo = rep
-00016750: 6f72 6566 2829 0a20 2020 2020 2020 2020  oref().         
-00016760: 2020 2069 6620 7265 706f 2069 7320 4e6f     if repo is No
-00016770: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00016780: 2020 2020 2320 4966 2074 6865 2072 6570      # If the rep
-00016790: 6f20 6861 7320 6265 656e 2047 4327 6420  o has been GC'd 
-000167a0: 2861 6e64 2074 6869 7320 7265 6c65 6173  (and this releas
-000167b0: 6520 6675 6e63 7469 6f6e 2069 7320 6265  e function is be
-000167c0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-000167d0: 2020 2020 2320 6361 6c6c 6564 2066 726f      # called fro
-000167e0: 6d20 7472 616e 7361 6374 696f 6e2e 5f5f  m transaction.__
-000167f0: 6465 6c5f 5f29 2c20 7468 6572 6527 7320  del__), there's 
-00016800: 6e6f 7420 6d75 6368 2077 6520 6361 6e20  not much we can 
-00016810: 646f 2c0a 2020 2020 2020 2020 2020 2020  do,.            
-00016820: 2020 2020 2320 736f 206a 7573 7420 6c65      # so just le
-00016830: 6176 6520 7468 6520 756e 6669 6e69 7368  ave the unfinish
-00016840: 6564 2074 7261 6e73 6163 7469 6f6e 2074  ed transaction t
-00016850: 6865 7265 2061 6e64 206c 6574 2074 6865  here and let the
-00016860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016870: 2023 2075 7365 7220 7275 6e20 6068 6720   # user run `hg 
-00016880: 7265 636f 7665 7260 2e0a 2020 2020 2020  recover`..      
-00016890: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000168a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000168b0: 7375 6363 6573 733a 0a20 2020 2020 2020  success:.       
-000168c0: 2020 2020 2020 2020 2023 2074 6869 7320           # this 
-000168d0: 7368 6f75 6c64 2062 6520 6578 706c 6963  should be explic
-000168e0: 6974 6c79 2069 6e76 6f6b 6564 2068 6572  itly invoked her
-000168f0: 652c 2062 6563 6175 7365 0a20 2020 2020  e, because.     
-00016900: 2020 2020 2020 2020 2020 2023 2069 6e2d             # in-
-00016910: 6d65 6d6f 7279 2063 6861 6e67 6573 2061  memory changes a
-00016920: 7265 6e27 7420 7772 6974 7465 6e20 6f75  ren't written ou
-00016930: 7420 6174 2063 6c6f 7369 6e67 0a20 2020  t at closing.   
-00016940: 2020 2020 2020 2020 2020 2020 2023 2074               # t
-00016950: 7261 6e73 6163 7469 6f6e 2c20 6966 2074  ransaction, if t
-00016960: 722e 6164 6466 696c 6567 656e 6572 6174  r.addfilegenerat
-00016970: 6f72 2028 7669 610a 2020 2020 2020 2020  or (via.        
-00016980: 2020 2020 2020 2020 2320 6469 7273 7461          # dirsta
-00016990: 7465 2e77 7269 7465 206f 7220 736f 2920  te.write or so) 
-000169a0: 6973 6e27 7420 696e 766f 6b65 6420 7768  isn't invoked wh
-000169b0: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
-000169c0: 2020 2020 2320 7472 616e 7361 6374 696f      # transactio
-000169d0: 6e20 7275 6e6e 696e 670a 2020 2020 2020  n running.      
-000169e0: 2020 2020 2020 2020 2020 7265 706f 2e64            repo.d
-000169f0: 6972 7374 6174 652e 7772 6974 6528 4e6f  irstate.write(No
-00016a00: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-00016a10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00016a20: 2020 2020 2020 2320 6469 7363 6172 6420        # discard 
-00016a30: 616c 6c20 6368 616e 6765 7320 2869 6e63  all changes (inc
-00016a40: 6c75 6469 6e67 206f 6e65 7320 616c 7265  luding ones alre
-00016a50: 6164 7920 7772 6974 7465 6e0a 2020 2020  ady written.    
-00016a60: 2020 2020 2020 2020 2020 2020 2320 6f75              # ou
-00016a70: 7429 2069 6e20 7468 6973 2074 7261 6e73  t) in this trans
-00016a80: 6163 7469 6f6e 0a20 2020 2020 2020 2020  action.         
-00016a90: 2020 2020 2020 2072 6570 6f2e 696e 7661         repo.inva
-00016aa0: 6c69 6461 7465 2863 6c65 6172 6669 6c65  lidate(clearfile
-00016ab0: 6361 6368 653d 5472 7565 290a 0a20 2020  cache=True)..   
-00016ac0: 2020 2020 2074 7220 3d20 7472 616e 7361       tr = transa
-00016ad0: 6374 696f 6e2e 7472 616e 7361 6374 696f  ction.transactio
-00016ae0: 6e28 0a20 2020 2020 2020 2020 2020 2072  n(.            r
-00016af0: 702c 0a20 2020 2020 2020 2020 2020 2073  p,.            s
-00016b00: 656c 662e 7376 6673 2c0a 2020 2020 2020  elf.svfs,.      
-00016b10: 2020 2020 2020 7666 736d 6170 2c0a 2020        vfsmap,.  
-00016b20: 2020 2020 2020 2020 2020 6222 6a6f 7572            b"jour
-00016b30: 6e61 6c22 2c0a 2020 2020 2020 2020 2020  nal",.          
-00016b40: 2020 6222 756e 646f 222c 0a20 2020 2020    b"undo",.     
-00016b50: 2020 2020 2020 2061 6674 6572 7472 616e         aftertran
-00016b60: 7328 7265 6e61 6d65 7329 2c0a 2020 2020  s(renames),.    
-00016b70: 2020 2020 2020 2020 7365 6c66 2e73 746f          self.sto
-00016b80: 7265 2e63 7265 6174 656d 6f64 652c 0a20  re.createmode,. 
-00016b90: 2020 2020 2020 2020 2020 2076 616c 6964             valid
-00016ba0: 6174 6f72 3d76 616c 6964 6174 652c 0a20  ator=validate,. 
-00016bb0: 2020 2020 2020 2020 2020 2072 656c 6561             relea
-00016bc0: 7365 666e 3d72 656c 6561 7365 666e 2c0a  sefn=releasefn,.
-00016bd0: 2020 2020 2020 2020 2020 2020 6368 6563              chec
-00016be0: 6b61 6d62 6967 6669 6c65 733d 5f63 6163  kambigfiles=_cac
-00016bf0: 6865 6466 696c 6573 2c0a 2020 2020 2020  hedfiles,.      
-00016c00: 2020 2020 2020 6e61 6d65 3d64 6573 632c        name=desc,
-00016c10: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00016c20: 2020 2074 722e 6368 616e 6765 735b 6227     tr.changes[b'
-00016c30: 6f72 6967 7265 706f 6c65 6e27 5d20 3d20  origrepolen'] = 
-00016c40: 6c65 6e28 7365 6c66 290a 2020 2020 2020  len(self).      
-00016c50: 2020 7472 2e63 6861 6e67 6573 5b62 276f    tr.changes[b'o
-00016c60: 6273 6d61 726b 6572 7327 5d20 3d20 7365  bsmarkers'] = se
-00016c70: 7428 290a 2020 2020 2020 2020 7472 2e63  t().        tr.c
-00016c80: 6861 6e67 6573 5b62 2770 6861 7365 7327  hanges[b'phases'
-00016c90: 5d20 3d20 5b5d 0a20 2020 2020 2020 2074  ] = [].        t
-00016ca0: 722e 6368 616e 6765 735b 6227 626f 6f6b  r.changes[b'book
-00016cb0: 6d61 726b 7327 5d20 3d20 7b7d 0a0a 2020  marks'] = {}..  
-00016cc0: 2020 2020 2020 7472 2e68 6f6f 6b61 7267        tr.hookarg
-00016cd0: 735b 6227 7478 6e69 6427 5d20 3d20 7478  s[b'txnid'] = tx
-00016ce0: 6e69 640a 2020 2020 2020 2020 7472 2e68  nid.        tr.h
-00016cf0: 6f6f 6b61 7267 735b 6227 7478 6e6e 616d  ookargs[b'txnnam
-00016d00: 6527 5d20 3d20 6465 7363 0a20 2020 2020  e'] = desc.     
-00016d10: 2020 2074 722e 686f 6f6b 6172 6773 5b62     tr.hookargs[b
-00016d20: 2763 6861 6e67 6573 275d 203d 2074 722e  'changes'] = tr.
-00016d30: 6368 616e 6765 730a 2020 2020 2020 2020  changes.        
-00016d40: 2320 6e6f 7465 3a20 7772 6974 696e 6720  # note: writing 
-00016d50: 7468 6520 666e 6361 6368 6520 6f6e 6c79  the fncache only
-00016d60: 2064 7572 696e 6720 6669 6e61 6c69 7a65   during finalize
-00016d70: 206d 6561 6e20 7468 6174 2074 6865 2066   mean that the f
-00016d80: 696c 6520 6973 0a20 2020 2020 2020 2023  ile is.        #
-00016d90: 206f 7574 6461 7465 6420 7768 656e 2072   outdated when r
-00016da0: 756e 6e69 6e67 2068 6f6f 6b73 2e20 4173  unning hooks. As
-00016db0: 2066 6e63 6163 6865 2069 7320 7573 6564   fncache is used
-00016dc0: 2066 6f72 2073 7472 6561 6d69 6e67 2063   for streaming c
-00016dd0: 6c6f 6e65 2c0a 2020 2020 2020 2020 2320  lone,.        # 
-00016de0: 7468 6973 2069 7320 6e6f 7420 6578 7065  this is not expe
-00016df0: 6374 6564 2074 6f20 6272 6561 6b20 616e  cted to break an
-00016e00: 7974 6869 6e67 2074 6861 7420 6861 7070  ything that happ
-00016e10: 656e 2064 7572 696e 6720 7468 6520 686f  en during the ho
-00016e20: 6f6b 732e 0a20 2020 2020 2020 2074 722e  oks..        tr.
-00016e30: 6164 6466 696e 616c 697a 6528 6227 666c  addfinalize(b'fl
-00016e40: 7573 682d 666e 6361 6368 6527 2c20 7365  ush-fncache', se
-00016e50: 6c66 2e73 746f 7265 2e77 7269 7465 290a  lf.store.write).
-00016e60: 0a20 2020 2020 2020 2064 6566 2074 786e  .        def txn
-00016e70: 636c 6f73 6568 6f6f 6b28 7472 3229 3a0a  closehook(tr2):.
-00016e80: 2020 2020 2020 2020 2020 2020 2222 2254              """T
-00016e90: 6f20 6265 2072 756e 2069 6620 7472 616e  o be run if tran
-00016ea0: 7361 6374 696f 6e20 6973 2073 7563 6365  saction is succe
-00016eb0: 7373 6675 6c2c 2077 696c 6c20 7363 6865  ssful, will sche
-00016ec0: 6475 6c65 2061 2068 6f6f 6b20 7275 6e22  dule a hook run"
-00016ed0: 2222 0a20 2020 2020 2020 2020 2020 2023  "".            #
-00016ee0: 2044 6f6e 2774 2072 6566 6572 656e 6365   Don't reference
-00016ef0: 2074 7232 2069 6e20 686f 6f6b 2829 2073   tr2 in hook() s
-00016f00: 6f20 7765 2064 6f6e 2774 2068 6f6c 6420  o we don't hold 
-00016f10: 6120 7265 6665 7265 6e63 652e 0a20 2020  a reference..   
-00016f20: 2020 2020 2020 2020 2023 2054 6869 7320           # This 
-00016f30: 7265 6475 6365 7320 6d65 6d6f 7279 2063  reduces memory c
-00016f40: 6f6e 7375 6d70 7469 6f6e 2077 6865 6e20  onsumption when 
-00016f50: 7468 6572 6520 6172 6520 6d75 6c74 6970  there are multip
-00016f60: 6c65 0a20 2020 2020 2020 2020 2020 2023  le.            #
-00016f70: 2074 7261 6e73 6163 7469 6f6e 7320 7065   transactions pe
-00016f80: 7220 6c6f 636b 2e20 5468 6973 2063 616e  r lock. This can
-00016f90: 206c 696b 656c 7920 676f 2061 7761 7920   likely go away 
-00016fa0: 6966 2069 7373 7565 3530 3435 0a20 2020  if issue5045.   
-00016fb0: 2020 2020 2020 2020 2023 2066 6978 6573           # fixes
-00016fc0: 2074 6865 2066 756e 6374 696f 6e20 6163   the function ac
-00016fd0: 6375 6d75 6c61 7469 6f6e 2e0a 2020 2020  cumulation..    
-00016fe0: 2020 2020 2020 2020 686f 6f6b 6172 6773          hookargs
-00016ff0: 203d 2074 7232 2e68 6f6f 6b61 7267 730a   = tr2.hookargs.
-00017000: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00017010: 2068 6f6f 6b66 756e 6328 756e 7573 6564   hookfunc(unused
-00017020: 5f73 7563 6365 7373 293a 0a20 2020 2020  _success):.     
-00017030: 2020 2020 2020 2020 2020 2072 6570 6f20             repo 
-00017040: 3d20 7265 706f 7265 6628 290a 2020 2020  = reporef().    
-00017050: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00017060: 7274 2072 6570 6f20 6973 206e 6f74 204e  rt repo is not N
-00017070: 6f6e 6520 2023 2068 656c 7020 7079 7479  one  # help pyty
-00017080: 7065 0a0a 2020 2020 2020 2020 2020 2020  pe..            
-00017090: 2020 2020 6966 2068 6f6f 6b2e 6861 7368      if hook.hash
-000170a0: 6f6f 6b28 7265 706f 2e75 692c 2062 2774  ook(repo.ui, b't
-000170b0: 786e 636c 6f73 652d 626f 6f6b 6d61 726b  xnclose-bookmark
-000170c0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-000170d0: 2020 2020 2020 2020 626d 6368 616e 6765          bmchange
-000170e0: 7320 3d20 736f 7274 6564 2874 722e 6368  s = sorted(tr.ch
-000170f0: 616e 6765 735b 6227 626f 6f6b 6d61 726b  anges[b'bookmark
-00017100: 7327 5d2e 6974 656d 7328 2929 0a20 2020  s'].items()).   
-00017110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017120: 2066 6f72 206e 616d 652c 2028 6f6c 642c   for name, (old,
-00017130: 206e 6577 2920 696e 2062 6d63 6861 6e67   new) in bmchang
-00017140: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00017150: 2020 2020 2020 2020 2020 2020 6172 6773              args
-00017160: 203d 2074 722e 686f 6f6b 6172 6773 2e63   = tr.hookargs.c
-00017170: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-00017180: 2020 2020 2020 2020 2020 2020 2020 6172                ar
-00017190: 6773 2e75 7064 6174 6528 626f 6f6b 6d61  gs.update(bookma
-000171a0: 726b 732e 7072 6570 6172 6568 6f6f 6b61  rks.preparehooka
-000171b0: 7267 7328 6e61 6d65 2c20 6f6c 642c 206e  rgs(name, old, n
-000171c0: 6577 2929 0a20 2020 2020 2020 2020 2020  ew)).           
-000171d0: 2020 2020 2020 2020 2020 2020 2072 6570               rep
-000171e0: 6f2e 686f 6f6b 280a 2020 2020 2020 2020  o.hook(.        
-000171f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017200: 2020 2020 6227 7478 6e63 6c6f 7365 2d62      b'txnclose-b
-00017210: 6f6f 6b6d 6172 6b27 2c0a 2020 2020 2020  ookmark',.      
-00017220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017230: 2020 2020 2020 7468 726f 773d 4661 6c73        throw=Fals
-00017240: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00017250: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00017260: 2a70 7963 6f6d 7061 742e 7374 726b 7761  *pycompat.strkwa
-00017270: 7267 7328 6172 6773 290a 2020 2020 2020  rgs(args).      
-00017280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017290: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-000172a0: 2020 2020 2069 6620 686f 6f6b 2e68 6173       if hook.has
-000172b0: 686f 6f6b 2872 6570 6f2e 7569 2c20 6227  hook(repo.ui, b'
-000172c0: 7478 6e63 6c6f 7365 2d70 6861 7365 2729  txnclose-phase')
-000172d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000172e0: 2020 2020 2020 636c 203d 2072 6570 6f2e        cl = repo.
-000172f0: 756e 6669 6c74 6572 6564 2829 2e63 6861  unfiltered().cha
-00017300: 6e67 656c 6f67 0a20 2020 2020 2020 2020  ngelog.         
-00017310: 2020 2020 2020 2020 2020 2070 6861 7365             phase
-00017320: 6d76 203d 2073 6f72 7465 6428 0a20 2020  mv = sorted(.   
-00017330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017340: 2020 2020 2074 722e 6368 616e 6765 735b       tr.changes[
-00017350: 6227 7068 6173 6573 275d 2c20 6b65 793d  b'phases'], key=
-00017360: 6c61 6d62 6461 2072 3a20 725b 305d 5b30  lambda r: r[0][0
-00017370: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00017380: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00017390: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000173a0: 7265 7673 2c20 286f 6c64 2c20 6e65 7729  revs, (old, new)
-000173b0: 2069 6e20 7068 6173 656d 763a 0a20 2020   in phasemv:.   
-000173c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173d0: 2020 2020 2066 6f72 2072 6576 2069 6e20       for rev in 
-000173e0: 7265 7673 3a0a 2020 2020 2020 2020 2020  revs:.          
-000173f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017400: 2020 6172 6773 203d 2074 722e 686f 6f6b    args = tr.hook
-00017410: 6172 6773 2e63 6f70 7928 290a 2020 2020  args.copy().    
-00017420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017430: 2020 2020 2020 2020 6e6f 6465 203d 2068          node = h
-00017440: 6578 2863 6c2e 6e6f 6465 2872 6576 2929  ex(cl.node(rev))
-00017450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017460: 2020 2020 2020 2020 2020 2020 2061 7267               arg
-00017470: 732e 7570 6461 7465 2870 6861 7365 732e  s.update(phases.
-00017480: 7072 6570 6172 6568 6f6f 6b61 7267 7328  preparehookargs(
-00017490: 6e6f 6465 2c20 6f6c 642c 206e 6577 2929  node, old, new))
-000174a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000174b0: 2020 2020 2020 2020 2020 2020 2072 6570               rep
-000174c0: 6f2e 686f 6f6b 280a 2020 2020 2020 2020  o.hook(.        
-000174d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174e0: 2020 2020 2020 2020 6227 7478 6e63 6c6f          b'txnclo
-000174f0: 7365 2d70 6861 7365 272c 0a20 2020 2020  se-phase',.     
-00017500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017510: 2020 2020 2020 2020 2020 2074 6872 6f77             throw
-00017520: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00017530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017540: 2020 2020 2020 2020 2a2a 7079 636f 6d70          **pycomp
-00017550: 6174 2e73 7472 6b77 6172 6773 2861 7267  at.strkwargs(arg
-00017560: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00017570: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00017580: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017590: 2020 7265 706f 2e68 6f6f 6b28 0a20 2020    repo.hook(.   
-000175a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000175b0: 2062 2774 786e 636c 6f73 6527 2c20 7468   b'txnclose', th
-000175c0: 726f 773d 4661 6c73 652c 202a 2a70 7963  row=False, **pyc
-000175d0: 6f6d 7061 742e 7374 726b 7761 7267 7328  ompat.strkwargs(
-000175e0: 686f 6f6b 6172 6773 290a 2020 2020 2020  hookargs).      
-000175f0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00017600: 2020 2020 2020 2020 2072 6570 6f20 3d20           repo = 
-00017610: 7265 706f 7265 6628 290a 2020 2020 2020  reporef().      
-00017620: 2020 2020 2020 6173 7365 7274 2072 6570        assert rep
-00017630: 6f20 6973 206e 6f74 204e 6f6e 6520 2023  o is not None  #
-00017640: 2068 656c 7020 7079 7479 7065 0a20 2020   help pytype.   
-00017650: 2020 2020 2020 2020 2072 6570 6f2e 5f61           repo._a
-00017660: 6674 6572 6c6f 636b 2868 6f6f 6b66 756e  fterlock(hookfun
-00017670: 6329 0a0a 2020 2020 2020 2020 7472 2e61  c)..        tr.a
-00017680: 6464 6669 6e61 6c69 7a65 2862 2774 786e  ddfinalize(b'txn
-00017690: 636c 6f73 652d 686f 6f6b 272c 2074 786e  close-hook', txn
-000176a0: 636c 6f73 6568 6f6f 6b29 0a20 2020 2020  closehook).     
-000176b0: 2020 2023 2049 6e63 6c75 6465 2061 206c     # Include a l
-000176c0: 6561 6469 6e67 2022 2d22 2074 6f20 6d61  eading "-" to ma
-000176d0: 6b65 2069 7420 6861 7070 656e 2062 6566  ke it happen bef
-000176e0: 6f72 6520 7468 6520 7472 616e 7361 6374  ore the transact
-000176f0: 696f 6e20 7375 6d6d 6172 790a 2020 2020  ion summary.    
-00017700: 2020 2020 2320 7265 706f 7274 7320 7265      # reports re
-00017710: 6769 7374 6572 6564 2076 6961 2073 636d  gistered via scm
-00017720: 7574 696c 2e72 6567 6973 7465 7273 756d  util.registersum
-00017730: 6d61 7279 6361 6c6c 6261 636b 2829 2077  marycallback() w
-00017740: 686f 7365 206e 616d 6573 0a20 2020 2020  hose names.     
-00017750: 2020 2023 2061 7265 2030 302d 7478 6e72     # are 00-txnr
-00017760: 6570 6f72 7420 6574 632e 2054 6861 7420  eport etc. That 
-00017770: 7761 792c 2074 6865 2063 6163 6865 7320  way, the caches 
-00017780: 7769 6c6c 2062 6520 7761 726d 2077 6865  will be warm whe
-00017790: 6e20 7468 650a 2020 2020 2020 2020 2320  n the.        # 
-000177a0: 6361 6c6c 6261 636b 7320 7275 6e2e 0a20  callbacks run.. 
-000177b0: 2020 2020 2020 2074 722e 6164 6470 6f73         tr.addpos
-000177c0: 7463 6c6f 7365 2862 272d 7761 726d 2d63  tclose(b'-warm-c
-000177d0: 6163 6865 272c 2073 656c 662e 5f62 7569  ache', self._bui
-000177e0: 6c64 6361 6368 6575 7064 6174 6572 2874  ldcacheupdater(t
-000177f0: 7229 290a 0a20 2020 2020 2020 2064 6566  r))..        def
-00017800: 2074 786e 6162 6f72 7468 6f6f 6b28 7472   txnaborthook(tr
-00017810: 3229 3a0a 2020 2020 2020 2020 2020 2020  2):.            
-00017820: 2222 2254 6f20 6265 2072 756e 2069 6620  """To be run if 
-00017830: 7472 616e 7361 6374 696f 6e20 6973 2061  transaction is a
-00017840: 626f 7274 6564 2222 220a 2020 2020 2020  borted""".      
-00017850: 2020 2020 2020 7265 706f 203d 2072 6570        repo = rep
-00017860: 6f72 6566 2829 0a20 2020 2020 2020 2020  oref().         
-00017870: 2020 2061 7373 6572 7420 7265 706f 2069     assert repo i
-00017880: 7320 6e6f 7420 4e6f 6e65 2020 2320 6865  s not None  # he
-00017890: 6c70 2070 7974 7970 650a 2020 2020 2020  lp pytype.      
-000178a0: 2020 2020 2020 7265 706f 2e68 6f6f 6b28        repo.hook(
-000178b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000178c0: 2062 2774 786e 6162 6f72 7427 2c20 7468   b'txnabort', th
-000178d0: 726f 773d 4661 6c73 652c 202a 2a70 7963  row=False, **pyc
-000178e0: 6f6d 7061 742e 7374 726b 7761 7267 7328  ompat.strkwargs(
-000178f0: 7472 322e 686f 6f6b 6172 6773 290a 2020  tr2.hookargs).  
-00017900: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00017910: 2020 2020 2074 722e 6164 6461 626f 7274       tr.addabort
-00017920: 2862 2774 786e 6162 6f72 742d 686f 6f6b  (b'txnabort-hook
-00017930: 272c 2074 786e 6162 6f72 7468 6f6f 6b29  ', txnaborthook)
-00017940: 0a20 2020 2020 2020 2023 2061 766f 6964  .        # avoid
-00017950: 2065 6167 6572 2063 6163 6865 2069 6e76   eager cache inv
-00017960: 616c 6964 6174 696f 6e2e 2069 6e2d 6d65  alidation. in-me
-00017970: 6d6f 7279 2064 6174 6120 7368 6f75 6c64  mory data should
-00017980: 2062 6520 6964 656e 7469 6361 6c0a 2020   be identical.  
-00017990: 2020 2020 2020 2320 746f 2073 746f 7265        # to store
-000179a0: 6420 6461 7461 2069 6620 7472 616e 7361  d data if transa
-000179b0: 6374 696f 6e20 6861 7320 6e6f 2065 7272  ction has no err
-000179c0: 6f72 2e0a 2020 2020 2020 2020 7472 2e61  or..        tr.a
-000179d0: 6464 706f 7374 636c 6f73 6528 6227 7265  ddpostclose(b're
-000179e0: 6672 6573 682d 6669 6c65 6361 6368 6573  fresh-filecaches
-000179f0: 7461 7473 272c 2073 656c 662e 5f72 6566  tats', self._ref
-00017a00: 7265 7368 6669 6c65 6361 6368 6573 7461  reshfilecachesta
-00017a10: 7473 290a 2020 2020 2020 2020 7365 6c66  ts).        self
-00017a20: 2e5f 7472 616e 7372 6566 203d 2077 6561  ._transref = wea
-00017a30: 6b72 6566 2e72 6566 2874 7229 0a20 2020  kref.ref(tr).   
-00017a40: 2020 2020 2073 636d 7574 696c 2e72 6567       scmutil.reg
-00017a50: 6973 7465 7273 756d 6d61 7279 6361 6c6c  istersummarycall
-00017a60: 6261 636b 2873 656c 662c 2074 722c 2064  back(self, tr, d
-00017a70: 6573 6329 0a20 2020 2020 2020 2023 2054  esc).        # T
-00017a80: 6869 7320 6f6e 6c79 2065 7869 7374 2074  his only exist t
-00017a90: 6f20 6465 616c 2077 6974 6820 7468 6520  o deal with the 
-00017aa0: 6e65 6564 206f 6620 726f 6c6c 6261 636b  need of rollback
-00017ab0: 2074 6f20 6861 7665 2076 6961 626c 650a   to have viable.
-00017ac0: 2020 2020 2020 2020 2320 7061 7265 6e74          # parent
-00017ad0: 7320 6174 2074 6865 2065 6e64 206f 6620  s at the end of 
-00017ae0: 7468 6520 6f70 6572 6174 696f 6e2e 2053  the operation. S
-00017af0: 6f20 6261 636b 7570 2076 6961 626c 6520  o backup viable 
-00017b00: 7061 7265 6e74 7320 6174 2074 6865 0a20  parents at the. 
-00017b10: 2020 2020 2020 2023 2074 696d 6520 6f66         # time of
-00017b20: 2074 6869 7320 6f70 6572 6174 696f 6e2e   this operation.
-00017b30: 0a20 2020 2020 2020 2023 0a20 2020 2020  .        #.     
-00017b40: 2020 2023 2057 6520 6f6e 6c79 2064 6f20     # We only do 
-00017b50: 6974 2077 6865 6e20 7468 6520 6077 6c6f  it when the `wlo
-00017b60: 636b 6020 6973 2074 616b 656e 2c20 6f74  ck` is taken, ot
-00017b70: 6865 7277 6973 6520 6f74 6865 7220 6d69  herwise other mi
-00017b80: 6768 7420 6265 0a20 2020 2020 2020 2023  ght be.        #
-00017b90: 2061 6c74 6572 696e 6720 7468 6520 6469   altering the di
-00017ba0: 7273 7461 7465 2075 6e64 6572 2075 732e  rstate under us.
-00017bb0: 0a20 2020 2020 2020 2023 0a20 2020 2020  .        #.     
-00017bc0: 2020 2023 2054 6869 7320 6973 2072 6561     # This is rea
-00017bd0: 6c6c 7920 6e6f 7420 6120 6772 6561 7420  lly not a great 
-00017be0: 7761 7920 746f 2064 6f20 7468 6973 2028  way to do this (
-00017bf0: 6669 7273 742c 2062 6563 6175 7365 2077  first, because w
-00017c00: 6520 6361 6e6e 6f74 0a20 2020 2020 2020  e cannot.       
-00017c10: 2023 2061 6c77 6179 7320 646f 2069 7429   # always do it)
-00017c20: 2e20 5468 6572 6520 6172 6520 6d6f 7265  . There are more
-00017c30: 2076 6961 626c 6520 616c 7465 726e 6174   viable alternat
-00017c40: 6976 6520 7468 6174 2065 7869 7374 730a  ive that exists.
-00017c50: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
-00017c60: 2020 2320 2d20 6261 636b 696e 6720 6f6e    # - backing on
-00017c70: 6c79 2074 6865 2077 6f72 6b69 6e67 2063  ly the working c
-00017c80: 6f70 7920 7061 7265 6e74 2069 6e20 6120  opy parent in a 
-00017c90: 6465 6469 6361 7465 6420 6669 6c65 7320  dedicated files 
-00017ca0: 616e 6420 646f 696e 670a 2020 2020 2020  and doing.      
-00017cb0: 2020 2320 2020 6120 636c 6561 6e20 226b    #   a clean "k
-00017cc0: 6565 702d 7570 6461 7465 2220 746f 2074  eep-update" to t
-00017cd0: 6865 6d20 6f6e 2060 6867 2072 6f6c 6c62  hem on `hg rollb
-00017ce0: 6163 6b60 2e0a 2020 2020 2020 2020 230a  ack`..        #.
-00017cf0: 2020 2020 2020 2020 2320 2d20 736c 6967          # - slig
-00017d00: 6874 6c79 2063 6861 6e67 696e 6720 7468  htly changing th
-00017d10: 6520 6265 6861 7669 6f72 2061 6e20 6170  e behavior an ap
-00017d20: 706c 7969 6e67 2061 206c 6f67 6963 2073  plying a logic s
-00017d30: 696d 696c 6172 2074 6f20 2268 670a 2020  imilar to "hg.  
-00017d40: 2020 2020 2020 2320 7374 7269 7022 2074        # strip" t
-00017d50: 6f20 7069 636b 2061 2077 6f72 6b69 6e67  o pick a working
-00017d60: 2063 6f70 7920 6465 7374 696e 6174 696f   copy destinatio
-00017d70: 6e20 6f6e 2060 6867 2072 6f6c 6c62 6163  n on `hg rollbac
-00017d80: 6b60 0a20 2020 2020 2020 2069 6620 7365  k`.        if se
-00017d90: 6c66 2e63 7572 7265 6e74 776c 6f63 6b28  lf.currentwlock(
-00017da0: 2920 6973 206e 6f74 204e 6f6e 653a 0a20  ) is not None:. 
-00017db0: 2020 2020 2020 2020 2020 2064 7320 3d20             ds = 
-00017dc0: 7365 6c66 2e64 6972 7374 6174 650a 2020  self.dirstate.  
-00017dd0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00017de0: 2073 656c 662e 7666 732e 6578 6973 7473   self.vfs.exists
-00017df0: 2862 2762 7261 6e63 6827 293a 0a20 2020  (b'branch'):.   
-00017e00: 2020 2020 2020 2020 2020 2020 2023 2066               # f
-00017e10: 6f72 6365 2061 2066 696c 6520 746f 2062  orce a file to b
-00017e20: 6520 7772 6974 7465 6e20 6966 204e 6f6e  e written if Non
-00017e30: 6520 6578 6973 740a 2020 2020 2020 2020  e exist.        
-00017e40: 2020 2020 2020 2020 6473 2e73 6574 6272          ds.setbr
-00017e50: 616e 6368 2862 2764 6566 6175 6c74 272c  anch(b'default',
-00017e60: 204e 6f6e 6529 0a0a 2020 2020 2020 2020   None)..        
-00017e70: 2020 2020 6465 6620 6261 636b 7570 5f64      def backup_d
-00017e80: 6972 7374 6174 6528 7472 293a 0a20 2020  irstate(tr):.   
-00017e90: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00017ea0: 2066 2069 6e20 6473 2e61 6c6c 5f66 696c   f in ds.all_fil
-00017eb0: 655f 6e61 6d65 7328 293a 0a20 2020 2020  e_names():.     
-00017ec0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00017ed0: 2068 6172 646c 696e 6b20 6261 636b 7570   hardlink backup
-00017ee0: 2069 7320 6f6b 6179 2062 6563 6175 7365   is okay because
-00017ef0: 2060 6469 7273 7461 7465 6020 6973 2061   `dirstate` is a
-00017f00: 6c77 6179 730a 2020 2020 2020 2020 2020  lways.          
-00017f10: 2020 2020 2020 2020 2020 2320 6174 6f6d            # atom
-00017f20: 6963 616c 6c79 2077 7269 7474 656e 2061  ically written a
-00017f30: 6e64 2070 6f73 7369 626c 6520 6461 7461  nd possible data
-00017f40: 2066 696c 6520 6172 6520 6170 7065 6e64   file are append
-00017f50: 206f 6e6c 790a 2020 2020 2020 2020 2020   only.          
-00017f60: 2020 2020 2020 2020 2020 2320 616e 6420            # and 
-00017f70: 7265 7369 7374 616e 7420 746f 2074 7261  resistant to tra
-00017f80: 696c 696e 6720 6461 7461 2e0a 2020 2020  iling data..    
-00017f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fa0: 7472 2e61 6464 6261 636b 7570 2866 2c20  tr.addbackup(f, 
-00017fb0: 6861 7264 6c69 6e6b 3d54 7275 652c 206c  hardlink=True, l
-00017fc0: 6f63 6174 696f 6e3d 6227 706c 6169 6e27  ocation=b'plain'
-00017fd0: 290a 0a20 2020 2020 2020 2020 2020 2074  )..            t
-00017fe0: 722e 6164 6476 616c 6964 6174 6f72 2862  r.addvalidator(b
-00017ff0: 2764 6972 7374 6174 652d 6261 636b 7570  'dirstate-backup
-00018000: 272c 2062 6163 6b75 705f 6469 7273 7461  ', backup_dirsta
-00018010: 7465 290a 2020 2020 2020 2020 7265 7475  te).        retu
-00018020: 726e 2074 720a 0a20 2020 2064 6566 205f  rn tr..    def _
-00018030: 6a6f 7572 6e61 6c66 696c 6573 2873 656c  journalfiles(sel
-00018040: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-00018050: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
-00018060: 2028 7365 6c66 2e73 7666 732c 2062 276a   (self.svfs, b'j
-00018070: 6f75 726e 616c 2729 2c0a 2020 2020 2020  ournal'),.      
-00018080: 2020 2020 2020 2873 656c 662e 7666 732c        (self.vfs,
-00018090: 2062 276a 6f75 726e 616c 2e64 6573 6327   b'journal.desc'
-000180a0: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
-000180b0: 2020 6465 6620 756e 646f 6669 6c65 7328    def undofiles(
-000180c0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-000180d0: 6574 7572 6e20 5b28 7666 732c 2075 6e64  eturn [(vfs, und
-000180e0: 6f6e 616d 6528 7829 2920 666f 7220 7666  oname(x)) for vf
-000180f0: 732c 2078 2069 6e20 7365 6c66 2e5f 6a6f  s, x in self._jo
-00018100: 7572 6e61 6c66 696c 6573 2829 5d0a 0a20  urnalfiles()].. 
-00018110: 2020 2040 756e 6669 6c74 6572 6564 6d65     @unfilteredme
-00018120: 7468 6f64 0a20 2020 2064 6566 205f 7772  thod.    def _wr
-00018130: 6974 656a 6f75 726e 616c 2873 656c 662c  itejournal(self,
-00018140: 2064 6573 6329 3a0a 2020 2020 2020 2020   desc):.        
-00018150: 7365 6c66 2e76 6673 2e77 7269 7465 2862  self.vfs.write(b
-00018160: 226a 6f75 726e 616c 2e64 6573 6322 2c20  "journal.desc", 
-00018170: 6222 2564 5c6e 2573 5c6e 2220 2520 286c  b"%d\n%s\n" % (l
-00018180: 656e 2873 656c 6629 2c20 6465 7363 2929  en(self), desc))
-00018190: 0a0a 2020 2020 6465 6620 7265 636f 7665  ..    def recove
-000181a0: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
-000181b0: 2077 6974 6820 7365 6c66 2e6c 6f63 6b28   with self.lock(
-000181c0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-000181d0: 6620 7365 6c66 2e73 7666 732e 6578 6973  f self.svfs.exis
-000181e0: 7473 2862 226a 6f75 726e 616c 2229 3a0a  ts(b"journal"):.
-000181f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018200: 7365 6c66 2e75 692e 7374 6174 7573 285f  self.ui.status(_
-00018210: 2862 2272 6f6c 6c69 6e67 2062 6163 6b20  (b"rolling back 
-00018220: 696e 7465 7272 7570 7465 6420 7472 616e  interrupted tran
-00018230: 7361 6374 696f 6e5c 6e22 2929 0a20 2020  saction\n")).   
-00018240: 2020 2020 2020 2020 2020 2020 2076 6673               vfs
-00018250: 6d61 7020 3d20 7b0a 2020 2020 2020 2020  map = {.        
-00018260: 2020 2020 2020 2020 2020 2020 6227 273a              b'':
-00018270: 2073 656c 662e 7376 6673 2c0a 2020 2020   self.svfs,.    
-00018280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018290: 6227 706c 6169 6e27 3a20 7365 6c66 2e76  b'plain': self.v
-000182a0: 6673 2c0a 2020 2020 2020 2020 2020 2020  fs,.            
-000182b0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-000182c0: 2020 2020 2020 7472 616e 7361 6374 696f        transactio
-000182d0: 6e2e 726f 6c6c 6261 636b 280a 2020 2020  n.rollback(.    
-000182e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182f0: 7365 6c66 2e73 7666 732c 0a20 2020 2020  self.svfs,.     
-00018300: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00018310: 6673 6d61 702c 0a20 2020 2020 2020 2020  fsmap,.         
-00018320: 2020 2020 2020 2020 2020 2062 226a 6f75             b"jou
-00018330: 726e 616c 222c 0a20 2020 2020 2020 2020  rnal",.         
-00018340: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00018350: 7569 2e77 6172 6e2c 0a20 2020 2020 2020  ui.warn,.       
-00018360: 2020 2020 2020 2020 2020 2020 2063 6865               che
-00018370: 636b 616d 6269 6766 696c 6573 3d5f 6361  ckambigfiles=_ca
-00018380: 6368 6564 6669 6c65 732c 0a20 2020 2020  chedfiles,.     
-00018390: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000183a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000183b0: 662e 696e 7661 6c69 6461 7465 2829 0a20  f.invalidate(). 
-000183c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000183d0: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-000183e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000183f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00018400: 662e 7569 2e77 6172 6e28 5f28 6222 6e6f  f.ui.warn(_(b"no
-00018410: 2069 6e74 6572 7275 7074 6564 2074 7261   interrupted tra
-00018420: 6e73 6163 7469 6f6e 2061 7661 696c 6162  nsaction availab
-00018430: 6c65 5c6e 2229 290a 2020 2020 2020 2020  le\n")).        
-00018440: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00018450: 616c 7365 0a0a 2020 2020 6465 6620 726f  alse..    def ro
-00018460: 6c6c 6261 636b 2873 656c 662c 2064 7279  llback(self, dry
-00018470: 7275 6e3d 4661 6c73 652c 2066 6f72 6365  run=False, force
-00018480: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-00018490: 2077 6c6f 636b 203d 206c 6f63 6b20 3d20   wlock = lock = 
-000184a0: 4e6f 6e65 0a20 2020 2020 2020 2074 7279  None.        try
-000184b0: 3a0a 2020 2020 2020 2020 2020 2020 776c  :.            wl
-000184c0: 6f63 6b20 3d20 7365 6c66 2e77 6c6f 636b  ock = self.wlock
-000184d0: 2829 0a20 2020 2020 2020 2020 2020 206c  ().            l
-000184e0: 6f63 6b20 3d20 7365 6c66 2e6c 6f63 6b28  ock = self.lock(
-000184f0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00018500: 2073 656c 662e 7376 6673 2e65 7869 7374   self.svfs.exist
-00018510: 7328 6222 756e 646f 2229 3a0a 2020 2020  s(b"undo"):.    
-00018520: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00018530: 726e 2073 656c 662e 5f72 6f6c 6c62 6163  rn self._rollbac
-00018540: 6b28 6472 7972 756e 2c20 666f 7263 6529  k(dryrun, force)
-00018550: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00018560: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00018570: 2020 2073 656c 662e 7569 2e77 6172 6e28     self.ui.warn(
-00018580: 5f28 6222 6e6f 2072 6f6c 6c62 6163 6b20  _(b"no rollback 
-00018590: 696e 666f 726d 6174 696f 6e20 6176 6169  information avai
-000185a0: 6c61 626c 655c 6e22 2929 0a20 2020 2020  lable\n")).     
-000185b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000185c0: 6e20 310a 2020 2020 2020 2020 6669 6e61  n 1.        fina
-000185d0: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
-000185e0: 2072 656c 6561 7365 286c 6f63 6b2c 2077   release(lock, w
-000185f0: 6c6f 636b 290a 0a20 2020 2040 756e 6669  lock)..    @unfi
-00018600: 6c74 6572 6564 6d65 7468 6f64 2020 2320  lteredmethod  # 
-00018610: 556e 7469 6c20 7765 2067 6574 2073 6d61  Until we get sma
-00018620: 7274 6572 2063 6163 6865 206d 616e 6167  rter cache manag
-00018630: 656d 656e 740a 2020 2020 6465 6620 5f72  ement.    def _r
-00018640: 6f6c 6c62 6163 6b28 7365 6c66 2c20 6472  ollback(self, dr
-00018650: 7972 756e 2c20 666f 7263 6529 3a0a 2020  yrun, force):.  
-00018660: 2020 2020 2020 7569 203d 2073 656c 662e        ui = self.
-00018670: 7569 0a0a 2020 2020 2020 2020 7061 7265  ui..        pare
-00018680: 6e74 7320 3d20 7365 6c66 2e64 6972 7374  nts = self.dirst
-00018690: 6174 652e 7061 7265 6e74 7328 290a 2020  ate.parents().  
-000186a0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000186b0: 2020 2020 2020 2061 7267 7320 3d20 7365         args = se
-000186c0: 6c66 2e76 6673 2e72 6561 6428 6227 756e  lf.vfs.read(b'un
-000186d0: 646f 2e64 6573 6327 292e 7370 6c69 746c  do.desc').splitl
-000186e0: 696e 6573 2829 0a20 2020 2020 2020 2020  ines().         
-000186f0: 2020 2028 6f6c 646c 656e 2c20 6465 7363     (oldlen, desc
-00018700: 2c20 6465 7461 696c 2920 3d20 2869 6e74  , detail) = (int
-00018710: 2861 7267 735b 305d 292c 2061 7267 735b  (args[0]), args[
-00018720: 315d 2c20 4e6f 6e65 290a 2020 2020 2020  1], None).      
-00018730: 2020 2020 2020 6966 206c 656e 2861 7267        if len(arg
-00018740: 7329 203e 3d20 333a 0a20 2020 2020 2020  s) >= 3:.       
-00018750: 2020 2020 2020 2020 2064 6574 6169 6c20           detail 
-00018760: 3d20 6172 6773 5b32 5d0a 2020 2020 2020  = args[2].      
-00018770: 2020 2020 2020 6f6c 6474 6970 203d 206f        oldtip = o
-00018780: 6c64 6c65 6e20 2d20 310a 0a20 2020 2020  ldlen - 1..     
-00018790: 2020 2020 2020 2069 6620 6465 7461 696c         if detail
-000187a0: 2061 6e64 2075 692e 7665 7262 6f73 653a   and ui.verbose:
-000187b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000187c0: 206d 7367 203d 205f 280a 2020 2020 2020   msg = _(.      
-000187d0: 2020 2020 2020 2020 2020 2020 2020 6227                b'
-000187e0: 7265 706f 7369 746f 7279 2074 6970 2072  repository tip r
-000187f0: 6f6c 6c65 6420 6261 636b 2074 6f20 7265  olled back to re
-00018800: 7669 7369 6f6e 2025 6427 0a20 2020 2020  vision %d'.     
-00018810: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00018820: 2720 2875 6e64 6f20 2573 3a20 2573 295c  ' (undo %s: %s)\
-00018830: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
-00018840: 2020 2029 2025 2028 6f6c 6474 6970 2c20     ) % (oldtip, 
-00018850: 6465 7363 2c20 6465 7461 696c 290a 2020  desc, detail).  
-00018860: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00018870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018880: 6d73 6720 3d20 5f28 0a20 2020 2020 2020  msg = _(.       
-00018890: 2020 2020 2020 2020 2020 2020 2062 2772               b'r
-000188a0: 6570 6f73 6974 6f72 7920 7469 7020 726f  epository tip ro
-000188b0: 6c6c 6564 2062 6163 6b20 746f 2072 6576  lled back to rev
-000188c0: 6973 696f 6e20 2564 2028 756e 646f 2025  ision %d (undo %
-000188d0: 7329 5c6e 270a 2020 2020 2020 2020 2020  s)\n'.          
-000188e0: 2020 2020 2020 2920 2520 286f 6c64 7469        ) % (oldti
-000188f0: 702c 2064 6573 6329 0a20 2020 2020 2020  p, desc).       
-00018900: 2020 2020 2070 6172 656e 7467 6f6e 6520       parentgone 
-00018910: 3d20 616e 7928 7365 6c66 5b70 5d2e 7265  = any(self[p].re
-00018920: 7628 2920 3e20 6f6c 6474 6970 2066 6f72  v() > oldtip for
-00018930: 2070 2069 6e20 7061 7265 6e74 7329 0a20   p in parents). 
-00018940: 2020 2020 2020 2065 7863 6570 7420 494f         except IO
-00018950: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-00018960: 2020 206d 7367 203d 205f 2862 2772 6f6c     msg = _(b'rol
-00018970: 6c69 6e67 2062 6163 6b20 756e 6b6e 6f77  ling back unknow
-00018980: 6e20 7472 616e 7361 6374 696f 6e5c 6e27  n transaction\n'
-00018990: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-000189a0: 7363 203d 204e 6f6e 650a 2020 2020 2020  sc = None.      
-000189b0: 2020 2020 2020 7061 7265 6e74 676f 6e65        parentgone
-000189c0: 203d 2054 7275 650a 0a20 2020 2020 2020   = True..       
-000189d0: 2069 6620 6e6f 7420 666f 7263 6520 616e   if not force an
-000189e0: 6420 7365 6c66 5b62 272e 275d 2021 3d20  d self[b'.'] != 
-000189f0: 7365 6c66 5b62 2774 6970 275d 2061 6e64  self[b'tip'] and
-00018a00: 2064 6573 6320 3d3d 2062 2763 6f6d 6d69   desc == b'commi
-00018a10: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
-00018a20: 7261 6973 6520 6572 726f 722e 4162 6f72  raise error.Abor
-00018a30: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00018a40: 2020 205f 280a 2020 2020 2020 2020 2020     _(.          
-00018a50: 2020 2020 2020 2020 2020 6227 726f 6c6c            b'roll
-00018a60: 6261 636b 206f 6620 6c61 7374 2063 6f6d  back of last com
-00018a70: 6d69 7420 7768 696c 6520 6e6f 7420 6368  mit while not ch
-00018a80: 6563 6b65 6420 6f75 7420 270a 2020 2020  ecked out '.    
-00018a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018aa0: 6227 6d61 7920 6c6f 7365 2064 6174 6127  b'may lose data'
-00018ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018ac0: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-00018ad0: 2020 2020 6869 6e74 3d5f 2862 2775 7365      hint=_(b'use
-00018ae0: 202d 6620 746f 2066 6f72 6365 2729 2c0a   -f to force'),.
-00018af0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00018b00: 2020 2020 2020 2075 692e 7374 6174 7573         ui.status
-00018b10: 286d 7367 290a 2020 2020 2020 2020 6966  (msg).        if
-00018b20: 2064 7279 7275 6e3a 0a20 2020 2020 2020   dryrun:.       
-00018b30: 2020 2020 2072 6574 7572 6e20 300a 0a20       return 0.. 
-00018b40: 2020 2020 2020 2073 656c 662e 6465 7374         self.dest
-00018b50: 726f 7969 6e67 2829 0a20 2020 2020 2020  roying().       
-00018b60: 2076 6673 6d61 7020 3d20 7b62 2770 6c61   vfsmap = {b'pla
-00018b70: 696e 273a 2073 656c 662e 7666 732c 2062  in': self.vfs, b
-00018b80: 2727 3a20 7365 6c66 2e73 7666 737d 0a20  '': self.svfs}. 
-00018b90: 2020 2020 2020 2073 6b69 705f 6a6f 7572         skip_jour
-00018ba0: 6e61 6c5f 7061 7474 6572 6e20 3d20 4e6f  nal_pattern = No
-00018bb0: 6e65 0a20 2020 2020 2020 2069 6620 6e6f  ne.        if no
-00018bc0: 7420 7061 7265 6e74 676f 6e65 3a0a 2020  t parentgone:.  
-00018bd0: 2020 2020 2020 2020 2020 736b 6970 5f6a            skip_j
-00018be0: 6f75 726e 616c 5f70 6174 7465 726e 203d  ournal_pattern =
-00018bf0: 2052 455f 534b 4950 5f44 4952 5354 4154   RE_SKIP_DIRSTAT
-00018c00: 455f 524f 4c4c 4241 434b 0a20 2020 2020  E_ROLLBACK.     
-00018c10: 2020 2074 7261 6e73 6163 7469 6f6e 2e72     transaction.r
-00018c20: 6f6c 6c62 6163 6b28 0a20 2020 2020 2020  ollback(.       
-00018c30: 2020 2020 2073 656c 662e 7376 6673 2c0a       self.svfs,.
-00018c40: 2020 2020 2020 2020 2020 2020 7666 736d              vfsm
-00018c50: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
-00018c60: 6227 756e 646f 272c 0a20 2020 2020 2020  b'undo',.       
-00018c70: 2020 2020 2075 692e 7761 726e 2c0a 2020       ui.warn,.  
-00018c80: 2020 2020 2020 2020 2020 6368 6563 6b61            checka
-00018c90: 6d62 6967 6669 6c65 733d 5f63 6163 6865  mbigfiles=_cache
-00018ca0: 6466 696c 6573 2c0a 2020 2020 2020 2020  dfiles,.        
-00018cb0: 2020 2020 736b 6970 5f6a 6f75 726e 616c      skip_journal
-00018cc0: 5f70 6174 7465 726e 3d73 6b69 705f 6a6f  _pattern=skip_jo
-00018cd0: 7572 6e61 6c5f 7061 7474 6572 6e2c 0a20  urnal_pattern,. 
-00018ce0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00018cf0: 2073 656c 662e 696e 7661 6c69 6461 7465   self.invalidate
-00018d00: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00018d10: 6469 7273 7461 7465 2e69 6e76 616c 6964  dirstate.invalid
-00018d20: 6174 6528 290a 0a20 2020 2020 2020 2069  ate()..        i
-00018d30: 6620 7061 7265 6e74 676f 6e65 3a0a 2020  f parentgone:.  
-00018d40: 2020 2020 2020 2020 2020 2320 7265 706c            # repl
-00018d50: 6163 6520 7468 6973 2077 6974 6820 736f  ace this with so
-00018d60: 6d65 2065 7870 6c69 6369 7420 7061 7265  me explicit pare
-00018d70: 6e74 2075 7064 6174 6520 696e 2074 6865  nt update in the
-00018d80: 2066 7574 7572 652e 0a20 2020 2020 2020   future..       
-00018d90: 2020 2020 2068 6173 5f6e 6f64 6520 3d20       has_node = 
-00018da0: 7365 6c66 2e63 6861 6e67 656c 6f67 2e69  self.changelog.i
-00018db0: 6e64 6578 2e68 6173 5f6e 6f64 650a 2020  ndex.has_node.  
-00018dc0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00018dd0: 2061 6c6c 2868 6173 5f6e 6f64 6528 7029   all(has_node(p)
-00018de0: 2066 6f72 2070 2069 6e20 7365 6c66 2e64   for p in self.d
-00018df0: 6972 7374 6174 652e 5f70 6c29 3a0a 2020  irstate._pl):.  
-00018e00: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00018e10: 5468 6572 6520 7761 7320 6e6f 2064 6972  There was no dir
-00018e20: 7374 6174 6520 746f 2062 6163 6b75 7020  state to backup 
-00018e30: 696e 6974 6961 6c6c 792c 2077 6520 6e65  initially, we ne
-00018e40: 6564 2074 6f20 6472 6f70 0a20 2020 2020  ed to drop.     
-00018e50: 2020 2020 2020 2020 2020 2023 2074 6865             # the
-00018e60: 2065 7869 7374 696e 6720 6f6e 652e 0a20   existing one.. 
-00018e70: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00018e80: 6974 6820 7365 6c66 2e64 6972 7374 6174  ith self.dirstat
-00018e90: 652e 6368 616e 6769 6e67 5f70 6172 656e  e.changing_paren
-00018ea0: 7473 2873 656c 6629 3a0a 2020 2020 2020  ts(self):.      
-00018eb0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00018ec0: 6c66 2e64 6972 7374 6174 652e 7365 7470  lf.dirstate.setp
-00018ed0: 6172 656e 7473 2873 656c 662e 6e75 6c6c  arents(self.null
-00018ee0: 6964 290a 2020 2020 2020 2020 2020 2020  id).            
-00018ef0: 2020 2020 2020 2020 7365 6c66 2e64 6972          self.dir
-00018f00: 7374 6174 652e 636c 6561 7228 290a 0a20  state.clear().. 
-00018f10: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-00018f20: 7473 203d 2074 7570 6c65 285b 702e 7265  ts = tuple([p.re
-00018f30: 7628 2920 666f 7220 7020 696e 2073 656c  v() for p in sel
-00018f40: 665b 4e6f 6e65 5d2e 7061 7265 6e74 7328  f[None].parents(
-00018f50: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
-00018f60: 6966 206c 656e 2870 6172 656e 7473 2920  if len(parents) 
-00018f70: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
-00018f80: 2020 2020 2075 692e 7374 6174 7573 280a       ui.status(.
-00018f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018fa0: 2020 2020 5f28 0a20 2020 2020 2020 2020      _(.         
-00018fb0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00018fc0: 2777 6f72 6b69 6e67 2064 6972 6563 746f  'working directo
-00018fd0: 7279 206e 6f77 2062 6173 6564 206f 6e20  ry now based on 
-00018fe0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00018ff0: 2020 2020 2020 2020 2020 6227 7265 7669            b'revi
-00019000: 7369 6f6e 7320 2564 2061 6e64 2025 645c  sions %d and %d\
-00019010: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
-00019020: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00019030: 2020 2020 2020 2020 2020 2020 2025 2070               % p
-00019040: 6172 656e 7473 0a20 2020 2020 2020 2020  arents.         
-00019050: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00019060: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00019070: 2020 2020 2020 2020 2020 2075 692e 7374             ui.st
-00019080: 6174 7573 280a 2020 2020 2020 2020 2020  atus(.          
-00019090: 2020 2020 2020 2020 2020 5f28 6227 776f            _(b'wo
-000190a0: 726b 696e 6720 6469 7265 6374 6f72 7920  rking directory 
-000190b0: 6e6f 7720 6261 7365 6420 6f6e 2072 6576  now based on rev
-000190c0: 6973 696f 6e20 2564 5c6e 2729 2025 2070  ision %d\n') % p
-000190d0: 6172 656e 7473 0a20 2020 2020 2020 2020  arents.         
-000190e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000190f0: 2020 2020 206d 6572 6765 7374 6174 656d       mergestatem
-00019100: 6f64 2e6d 6572 6765 7374 6174 652e 636c  od.mergestate.cl
-00019110: 6561 6e28 7365 6c66 290a 0a20 2020 2020  ean(self)..     
-00019120: 2020 2023 2054 4f44 4f3a 2069 6620 7765     # TODO: if we
-00019130: 206b 6e6f 7720 7768 6963 6820 6e65 7720   know which new 
-00019140: 6865 6164 7320 6d61 7920 7265 7375 6c74  heads may result
-00019150: 2066 726f 6d20 7468 6973 2072 6f6c 6c62   from this rollb
-00019160: 6163 6b2c 2070 6173 730a 2020 2020 2020  ack, pass.      
-00019170: 2020 2320 7468 656d 2074 6f20 6465 7374    # them to dest
-00019180: 726f 7928 292c 2077 6869 6368 2077 696c  roy(), which wil
-00019190: 6c20 7072 6576 656e 7420 7468 6520 6272  l prevent the br
-000191a0: 616e 6368 6865 6164 2063 6163 6865 2066  anchhead cache f
-000191b0: 726f 6d20 6265 696e 670a 2020 2020 2020  rom being.      
-000191c0: 2020 2320 696e 7661 6c69 6461 7465 642e    # invalidated.
-000191d0: 0a20 2020 2020 2020 2073 656c 662e 6465  .        self.de
-000191e0: 7374 726f 7965 6428 290a 2020 2020 2020  stroyed().      
-000191f0: 2020 7265 7475 726e 2030 0a0a 2020 2020    return 0..    
-00019200: 6465 6620 5f62 7569 6c64 6361 6368 6575  def _buildcacheu
-00019210: 7064 6174 6572 2873 656c 662c 206e 6577  pdater(self, new
-00019220: 7472 616e 7361 6374 696f 6e29 3a0a 2020  transaction):.  
-00019230: 2020 2020 2020 2222 2263 616c 6c65 6420        """called 
-00019240: 6475 7269 6e67 2074 7261 6e73 6163 7469  during transacti
-00019250: 6f6e 2074 6f20 6275 696c 6420 7468 6520  on to build the 
-00019260: 6361 6c6c 6261 636b 2075 7064 6174 696e  callback updatin
-00019270: 6720 6361 6368 650a 0a20 2020 2020 2020  g cache..       
-00019280: 204c 6976 6573 206f 6e20 7468 6520 7265   Lives on the re
-00019290: 706f 7369 746f 7279 2074 6f20 6865 6c70  pository to help
-000192a0: 2065 7874 656e 7369 6f6e 2077 686f 206d   extension who m
-000192b0: 6967 6874 2077 616e 7420 746f 2061 7567  ight want to aug
-000192c0: 6d65 6e74 0a20 2020 2020 2020 2074 6869  ment.        thi
-000192d0: 7320 6c6f 6769 632e 2046 6f72 2074 6869  s logic. For thi
-000192e0: 7320 7075 7270 6f73 652c 2074 6865 2063  s purpose, the c
-000192f0: 7265 6174 6564 2074 7261 6e73 6163 7469  reated transacti
-00019300: 6f6e 2069 7320 7061 7373 6564 2074 6f20  on is passed to 
-00019310: 7468 650a 2020 2020 2020 2020 6d65 7468  the.        meth
-00019320: 6f64 2e0a 2020 2020 2020 2020 2222 220a  od..        """.
-00019330: 2020 2020 2020 2020 2320 7765 206d 7573          # we mus
-00019340: 7420 6176 6f69 6420 6379 636c 6963 2072  t avoid cyclic r
-00019350: 6566 6572 656e 6365 2062 6574 7765 656e  eference between
-00019360: 2072 6570 6f20 616e 6420 7472 616e 7361   repo and transa
-00019370: 6374 696f 6e2e 0a20 2020 2020 2020 2072  ction..        r
-00019380: 6570 6f72 6566 203d 2077 6561 6b72 6566  eporef = weakref
-00019390: 2e72 6566 2873 656c 6629 0a0a 2020 2020  .ref(self)..    
-000193a0: 2020 2020 6465 6620 7570 6461 7465 7228      def updater(
-000193b0: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
-000193c0: 2072 6570 6f20 3d20 7265 706f 7265 6628   repo = reporef(
-000193d0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-000193e0: 7365 7274 2072 6570 6f20 6973 206e 6f74  sert repo is not
-000193f0: 204e 6f6e 6520 2023 2068 656c 7020 7079   None  # help py
-00019400: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
-00019410: 2072 6570 6f2e 7570 6461 7465 6361 6368   repo.updatecach
-00019420: 6573 2874 7229 0a0a 2020 2020 2020 2020  es(tr)..        
-00019430: 7265 7475 726e 2075 7064 6174 6572 0a0a  return updater..
-00019440: 2020 2020 4075 6e66 696c 7465 7265 646d      @unfilteredm
-00019450: 6574 686f 640a 2020 2020 6465 6620 7570  ethod.    def up
-00019460: 6461 7465 6361 6368 6573 2873 656c 662c  datecaches(self,
-00019470: 2074 723d 4e6f 6e65 2c20 6675 6c6c 3d46   tr=None, full=F
-00019480: 616c 7365 2c20 6361 6368 6573 3d4e 6f6e  alse, caches=Non
-00019490: 6529 3a0a 2020 2020 2020 2020 2222 2277  e):.        """w
-000194a0: 6172 6d20 6170 7072 6f70 7269 6174 6520  arm appropriate 
-000194b0: 6361 6368 6573 0a0a 2020 2020 2020 2020  caches..        
-000194c0: 4966 2074 6869 7320 6675 6e63 7469 6f6e  If this function
-000194d0: 2069 7320 6361 6c6c 6564 2061 6674 6572   is called after
-000194e0: 2061 2074 7261 6e73 6163 7469 6f6e 2063   a transaction c
-000194f0: 6c6f 7365 642e 2054 6865 2074 7261 6e73  losed. The trans
-00019500: 6163 7469 6f6e 0a20 2020 2020 2020 2077  action.        w
-00019510: 696c 6c20 6265 2061 7661 696c 6162 6c65  ill be available
-00019520: 2069 6e20 7468 6520 2774 7227 2061 7267   in the 'tr' arg
-00019530: 756d 656e 742e 2054 6869 7320 6361 6e20  ument. This can 
-00019540: 6265 2075 7365 6420 746f 2073 656c 6563  be used to selec
-00019550: 7469 7665 6c79 0a20 2020 2020 2020 2075  tively.        u
-00019560: 7064 6174 6520 6361 6368 6573 2072 656c  pdate caches rel
-00019570: 6576 616e 7420 746f 2074 6865 2063 6861  evant to the cha
-00019580: 6e67 6573 2069 6e20 7468 6174 2074 7261  nges in that tra
-00019590: 6e73 6163 7469 6f6e 2e0a 0a20 2020 2020  nsaction...     
-000195a0: 2020 2049 6620 2766 756c 6c27 2069 7320     If 'full' is 
-000195b0: 7365 742c 206d 616b 6520 7375 7265 2061  set, make sure a
-000195c0: 6c6c 2063 6163 6865 7320 7468 6520 6675  ll caches the fu
-000195d0: 6e63 7469 6f6e 206b 6e6f 7773 2061 626f  nction knows abo
-000195e0: 7574 2068 6176 650a 2020 2020 2020 2020  ut have.        
-000195f0: 7570 2d74 6f2d 6461 7465 2064 6174 612e  up-to-date data.
-00019600: 2045 7665 6e20 7468 6520 6f6e 6573 2075   Even the ones u
-00019610: 7375 616c 6c79 206c 6f61 6465 6420 6d6f  sually loaded mo
-00019620: 7265 206c 617a 696c 792e 0a0a 2020 2020  re lazily...    
-00019630: 2020 2020 5468 6520 6066 756c 6c60 2061      The `full` a
-00019640: 7267 756d 656e 7420 6361 6e20 7461 6b65  rgument can take
-00019650: 2061 2073 7065 6369 616c 2022 706f 7374   a special "post
-00019660: 2d63 6c6f 6e65 2220 7661 6c75 652e 2049  -clone" value. I
-00019670: 6e20 7468 6973 2063 6173 650a 2020 2020  n this case.    
-00019680: 2020 2020 7468 6520 6361 6368 6520 7761      the cache wa
-00019690: 726d 696e 6720 6973 206d 6164 6520 6166  rming is made af
-000196a0: 7465 7220 6120 636c 6f6e 6520 616e 6420  ter a clone and 
-000196b0: 6f66 2074 6865 2073 6c6f 7765 7220 6361  of the slower ca
-000196c0: 6368 6520 6d69 6768 740a 2020 2020 2020  che might.      
-000196d0: 2020 6265 2073 6b69 7070 6564 2c20 6e61    be skipped, na
-000196e0: 6d65 6c79 2074 6865 2060 2e66 6e6f 6465  mely the `.fnode
-000196f0: 7461 6773 6020 6f6e 652e 2054 6869 7320  tags` one. This 
-00019700: 6172 6775 6d65 6e74 2069 7320 352e 3820  argument is 5.8 
-00019710: 7370 6563 6966 6963 0a20 2020 2020 2020  specific.       
-00019720: 2061 7320 7765 2070 6c61 6e20 666f 7220   as we plan for 
-00019730: 6120 636c 6561 6e65 7220 7761 7920 746f  a cleaner way to
-00019740: 2064 6561 6c20 7769 7468 2074 6869 7320   deal with this 
-00019750: 666f 7220 352e 392e 0a20 2020 2020 2020  for 5.9..       
-00019760: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00019770: 7472 2069 7320 6e6f 7420 4e6f 6e65 2061  tr is not None a
-00019780: 6e64 2074 722e 686f 6f6b 6172 6773 2e67  nd tr.hookargs.g
-00019790: 6574 2862 2773 6f75 7263 6527 2920 3d3d  et(b'source') ==
-000197a0: 2062 2773 7472 6970 273a 0a20 2020 2020   b'strip':.     
-000197b0: 2020 2020 2020 2023 2044 7572 696e 6720         # During 
-000197c0: 7374 7269 702c 206d 616e 7920 6361 6368  strip, many cach
-000197d0: 6573 2061 7265 2069 6e76 616c 6964 2062  es are invalid b
-000197e0: 7574 0a20 2020 2020 2020 2020 2020 2023  ut.            #
-000197f0: 206c 6174 6572 2063 616c 6c20 746f 2060   later call to `
-00019800: 6465 7374 726f 7965 6460 2077 696c 6c20  destroyed` will 
-00019810: 7265 6672 6573 6820 7468 656d 2e0a 2020  refresh them..  
-00019820: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00019830: 0a0a 2020 2020 2020 2020 756e 6669 203d  ..        unfi =
-00019840: 2073 656c 662e 756e 6669 6c74 6572 6564   self.unfiltered
-00019850: 2829 0a0a 2020 2020 2020 2020 6966 2066  ()..        if f
-00019860: 756c 6c3a 0a20 2020 2020 2020 2020 2020  ull:.           
-00019870: 206d 7367 203d 2028 0a20 2020 2020 2020   msg = (.       
-00019880: 2020 2020 2020 2020 2022 6066 756c 6c60           "`full`
-00019890: 2061 7267 756d 656e 7420 666f 7220 6072   argument for `r
-000198a0: 6570 6f2e 7570 6461 7465 6361 6368 6573  epo.updatecaches
-000198b0: 6020 6973 2064 6570 7265 6361 7465 645c  ` is deprecated\
-000198c0: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
-000198d0: 2020 2022 2875 7365 2060 6361 6368 6573     "(use `caches
-000198e0: 3d72 6570 6f73 6974 6f72 792e 4341 4348  =repository.CACH
-000198f0: 455f 414c 4c60 2069 6e73 7465 6164 2922  E_ALL` instead)"
-00019900: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00019910: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00019920: 7569 2e64 6570 7265 6377 6172 6e28 6d73  ui.deprecwarn(ms
-00019930: 672c 2062 2235 2e39 2229 0a20 2020 2020  g, b"5.9").     
-00019940: 2020 2020 2020 2063 6163 6865 7320 3d20         caches = 
-00019950: 7265 706f 7369 746f 7279 2e43 4143 4845  repository.CACHE
-00019960: 535f 414c 4c0a 2020 2020 2020 2020 2020  S_ALL.          
-00019970: 2020 6966 2066 756c 6c20 3d3d 2062 2270    if full == b"p
-00019980: 6f73 742d 636c 6f6e 6522 3a0a 2020 2020  ost-clone":.    
-00019990: 2020 2020 2020 2020 2020 2020 6361 6368              cach
-000199a0: 6573 203d 2072 6570 6f73 6974 6f72 792e  es = repository.
-000199b0: 4341 4348 4553 5f50 4f53 545f 434c 4f4e  CACHES_POST_CLON
-000199c0: 450a 2020 2020 2020 2020 2020 2020 6361  E.            ca
-000199d0: 6368 6573 203d 2072 6570 6f73 6974 6f72  ches = repositor
-000199e0: 792e 4341 4348 4553 5f41 4c4c 0a20 2020  y.CACHES_ALL.   
-000199f0: 2020 2020 2065 6c69 6620 6361 6368 6573       elif caches
-00019a00: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00019a10: 2020 2020 2020 6361 6368 6573 203d 2072        caches = r
-00019a20: 6570 6f73 6974 6f72 792e 4341 4348 4553  epository.CACHES
-00019a30: 5f44 4546 4155 4c54 0a0a 2020 2020 2020  _DEFAULT..      
-00019a40: 2020 6966 2072 6570 6f73 6974 6f72 792e    if repository.
-00019a50: 4341 4348 455f 4252 414e 4348 4d41 505f  CACHE_BRANCHMAP_
-00019a60: 5345 5256 4544 2069 6e20 6361 6368 6573  SERVED in caches
-00019a70: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00019a80: 2074 7220 6973 204e 6f6e 6520 6f72 2074   tr is None or t
-00019a90: 722e 6368 616e 6765 735b 6227 6f72 6967  r.changes[b'orig
-00019aa0: 7265 706f 6c65 6e27 5d20 3c20 6c65 6e28  repolen'] < len(
-00019ab0: 7365 6c66 293a 0a20 2020 2020 2020 2020  self):.         
-00019ac0: 2020 2020 2020 2023 2061 6363 6573 7369         # accessi
-00019ad0: 6e67 2074 6865 2027 7365 7276 6564 2720  ng the 'served' 
-00019ae0: 6272 616e 6368 6d61 7020 7368 6f75 6c64  branchmap should
-00019af0: 2072 6566 7265 7368 2061 6c6c 2074 6865   refresh all the
-00019b00: 206f 7468 6572 732c 0a20 2020 2020 2020   others,.       
-00019b10: 2020 2020 2020 2020 2073 656c 662e 7569           self.ui
-00019b20: 2e64 6562 7567 2862 2775 7064 6174 696e  .debug(b'updatin
-00019b30: 6720 7468 6520 6272 616e 6368 2063 6163  g the branch cac
-00019b40: 6865 5c6e 2729 0a20 2020 2020 2020 2020  he\n').         
-00019b50: 2020 2020 2020 2073 656c 662e 6669 6c74         self.filt
-00019b60: 6572 6564 2862 2773 6572 7665 6427 292e  ered(b'served').
-00019b70: 6272 616e 6368 6d61 7028 290a 2020 2020  branchmap().    
-00019b80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00019b90: 2e66 696c 7465 7265 6428 6227 7365 7276  .filtered(b'serv
-00019ba0: 6564 2e68 6964 6465 6e27 292e 6272 616e  ed.hidden').bran
-00019bb0: 6368 6d61 7028 290a 2020 2020 2020 2020  chmap().        
-00019bc0: 2020 2020 2020 2020 2320 666c 7573 6820          # flush 
-00019bd0: 616c 6c20 706f 7373 6962 6c79 2064 656c  all possibly del
-00019be0: 6179 6564 2077 7269 7465 2e0a 2020 2020  ayed write..    
-00019bf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00019c00: 2e5f 6272 616e 6368 6361 6368 6573 2e77  ._branchcaches.w
-00019c10: 7269 7465 5f64 656c 6179 6564 2873 656c  rite_delayed(sel
-00019c20: 6629 0a0a 2020 2020 2020 2020 6966 2072  f)..        if r
-00019c30: 6570 6f73 6974 6f72 792e 4341 4348 455f  epository.CACHE_
-00019c40: 4348 414e 4745 4c4f 475f 4341 4348 4520  CHANGELOG_CACHE 
-00019c50: 696e 2063 6163 6865 733a 0a20 2020 2020  in caches:.     
-00019c60: 2020 2020 2020 2073 656c 662e 6368 616e         self.chan
-00019c70: 6765 6c6f 672e 7570 6461 7465 5f63 6163  gelog.update_cac
-00019c80: 6865 7328 7472 616e 7361 6374 696f 6e3d  hes(transaction=
-00019c90: 7472 290a 0a20 2020 2020 2020 2069 6620  tr)..        if 
-00019ca0: 7265 706f 7369 746f 7279 2e43 4143 4845  repository.CACHE
-00019cb0: 5f4d 414e 4946 4553 544c 4f47 5f43 4143  _MANIFESTLOG_CAC
-00019cc0: 4845 2069 6e20 6361 6368 6573 3a0a 2020  HE in caches:.  
-00019cd0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00019ce0: 616e 6966 6573 746c 6f67 2e75 7064 6174  anifestlog.updat
-00019cf0: 655f 6361 6368 6573 2874 7261 6e73 6163  e_caches(transac
-00019d00: 7469 6f6e 3d74 7229 0a0a 2020 2020 2020  tion=tr)..      
-00019d10: 2020 6966 2072 6570 6f73 6974 6f72 792e    if repository.
-00019d20: 4341 4348 455f 5245 565f 4252 414e 4348  CACHE_REV_BRANCH
-00019d30: 2069 6e20 6361 6368 6573 3a0a 2020 2020   in caches:.    
-00019d40: 2020 2020 2020 2020 7262 6320 3d20 756e          rbc = un
-00019d50: 6669 2e72 6576 6272 616e 6368 6361 6368  fi.revbranchcach
-00019d60: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00019d70: 666f 7220 7220 696e 2075 6e66 692e 6368  for r in unfi.ch
-00019d80: 616e 6765 6c6f 673a 0a20 2020 2020 2020  angelog:.       
-00019d90: 2020 2020 2020 2020 2072 6263 2e62 7261           rbc.bra
-00019da0: 6e63 6869 6e66 6f28 7229 0a20 2020 2020  nchinfo(r).     
-00019db0: 2020 2020 2020 2072 6263 2e77 7269 7465         rbc.write
-00019dc0: 2829 0a0a 2020 2020 2020 2020 6966 2072  ()..        if r
-00019dd0: 6570 6f73 6974 6f72 792e 4341 4348 455f  epository.CACHE_
-00019de0: 4655 4c4c 5f4d 414e 4946 4553 5420 696e  FULL_MANIFEST in
-00019df0: 2063 6163 6865 733a 0a20 2020 2020 2020   caches:.       
-00019e00: 2020 2020 2023 2065 6e73 7572 6520 7468       # ensure th
-00019e10: 6520 776f 726b 696e 6720 636f 7079 2070  e working copy p
-00019e20: 6172 656e 7473 2061 7265 2069 6e20 7468  arents are in th
-00019e30: 6520 6d61 6e69 6665 7374 6675 6c6c 7465  e manifestfullte
-00019e40: 7874 6361 6368 650a 2020 2020 2020 2020  xtcache.        
-00019e50: 2020 2020 666f 7220 6374 7820 696e 2073      for ctx in s
-00019e60: 656c 665b 6227 2e27 5d2e 7061 7265 6e74  elf[b'.'].parent
-00019e70: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00019e80: 2020 2020 2063 7478 2e6d 616e 6966 6573       ctx.manifes
-00019e90: 7428 2920 2023 2061 6363 6573 7369 6e67  t()  # accessing
-00019ea0: 2074 6865 206d 616e 6966 6573 7420 6973   the manifest is
-00019eb0: 2065 6e6f 7567 680a 0a20 2020 2020 2020   enough..       
-00019ec0: 2069 6620 7265 706f 7369 746f 7279 2e43   if repository.C
-00019ed0: 4143 4845 5f46 494c 455f 4e4f 4445 5f54  ACHE_FILE_NODE_T
-00019ee0: 4147 5320 696e 2063 6163 6865 733a 0a20  AGS in caches:. 
-00019ef0: 2020 2020 2020 2020 2020 2023 2061 6363             # acc
-00019f00: 6573 7369 6e67 2066 6e6f 6465 2063 6163  essing fnode cac
-00019f10: 6865 2077 6172 6d73 2074 6865 2063 6163  he warms the cac
-00019f20: 6865 0a20 2020 2020 2020 2020 2020 2074  he.            t
-00019f30: 6167 736d 6f64 2e66 6e6f 6465 7265 7673  agsmod.fnoderevs
-00019f40: 2873 656c 662e 7569 2c20 756e 6669 2c20  (self.ui, unfi, 
-00019f50: 756e 6669 2e63 6861 6e67 656c 6f67 2e72  unfi.changelog.r
-00019f60: 6576 7328 2929 0a0a 2020 2020 2020 2020  evs())..        
-00019f70: 6966 2072 6570 6f73 6974 6f72 792e 4341  if repository.CA
-00019f80: 4348 455f 5441 4753 5f44 4546 4155 4c54  CHE_TAGS_DEFAULT
-00019f90: 2069 6e20 6361 6368 6573 3a0a 2020 2020   in caches:.    
-00019fa0: 2020 2020 2020 2020 2320 6163 6365 7373          # access
-00019fb0: 696e 6720 7461 6773 2077 6172 6d20 7468  ing tags warm th
-00019fc0: 6520 6361 6368 650a 2020 2020 2020 2020  e cache.        
-00019fd0: 2020 2020 7365 6c66 2e74 6167 7328 290a      self.tags().
-00019fe0: 2020 2020 2020 2020 6966 2072 6570 6f73          if repos
-00019ff0: 6974 6f72 792e 4341 4348 455f 5441 4753  itory.CACHE_TAGS
-0001a000: 5f53 4552 5645 4420 696e 2063 6163 6865  _SERVED in cache
-0001a010: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-0001a020: 656c 662e 6669 6c74 6572 6564 2862 2773  elf.filtered(b's
-0001a030: 6572 7665 6427 292e 7461 6773 2829 0a0a  erved').tags()..
-0001a040: 2020 2020 2020 2020 6966 2072 6570 6f73          if repos
-0001a050: 6974 6f72 792e 4341 4348 455f 4252 414e  itory.CACHE_BRAN
-0001a060: 4348 4d41 505f 414c 4c20 696e 2063 6163  CHMAP_ALL in cac
-0001a070: 6865 733a 0a20 2020 2020 2020 2020 2020  hes:.           
-0001a080: 2023 2054 6865 2043 4143 4845 5f42 5241   # The CACHE_BRA
-0001a090: 4e43 484d 4150 5f41 4c4c 2075 7064 6174  NCHMAP_ALL updat
-0001a0a0: 6573 206c 617a 696c 792d 6c6f 6164 6564  es lazily-loaded
-0001a0b0: 2063 6163 6865 7320 696d 6d65 6469 6174   caches immediat
-0001a0c0: 656c 792c 0a20 2020 2020 2020 2020 2020  ely,.           
-0001a0d0: 2023 2073 6f20 7765 2772 6520 666f 7263   # so we're forc
-0001a0e0: 696e 6720 6120 7772 6974 6520 746f 2063  ing a write to c
-0001a0f0: 6175 7365 2074 6865 7365 2063 6163 6865  ause these cache
-0001a100: 7320 746f 2062 6520 7761 726d 6564 2075  s to be warmed u
-0001a110: 700a 2020 2020 2020 2020 2020 2020 2320  p.            # 
-0001a120: 6576 656e 2069 6620 7468 6579 2068 6176  even if they hav
-0001a130: 656e 2774 2065 7870 6c69 6369 746c 7920  en't explicitly 
-0001a140: 6265 656e 2072 6571 7565 7374 6564 2079  been requested y
-0001a150: 6574 2028 6966 2074 6865 7927 7665 0a20  et (if they've. 
-0001a160: 2020 2020 2020 2020 2020 2023 206e 6576             # nev
-0001a170: 6572 2062 6565 6e20 7573 6564 2062 7920  er been used by 
-0001a180: 6867 2c20 7468 6579 2077 6f6e 2774 2065  hg, they won't e
-0001a190: 7665 7220 6861 7665 2062 6565 6e20 7772  ver have been wr
-0001a1a0: 6974 7465 6e2c 2065 7665 6e20 6966 0a20  itten, even if. 
-0001a1b0: 2020 2020 2020 2020 2020 2023 2074 6865             # the
-0001a1c0: 7927 7265 2061 2073 7562 7365 7420 6f66  y're a subset of
-0001a1d0: 2061 6e6f 7468 6572 206b 696e 6420 6f66   another kind of
-0001a1e0: 2063 6163 6865 2074 6861 7420 2a68 6173   cache that *has
-0001a1f0: 2a20 6265 656e 2075 7365 6429 2e0a 2020  * been used)..  
-0001a200: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-0001a210: 6c74 2069 6e20 7265 706f 7669 6577 2e66  lt in repoview.f
-0001a220: 696c 7465 7274 6162 6c65 2e6b 6579 7328  iltertable.keys(
-0001a230: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001a240: 2020 2066 696c 7465 7265 6420 3d20 7365     filtered = se
-0001a250: 6c66 2e66 696c 7465 7265 6428 6669 6c74  lf.filtered(filt
-0001a260: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a270: 2020 6669 6c74 6572 6564 2e62 7261 6e63    filtered.branc
-0001a280: 686d 6170 2829 2e77 7269 7465 2866 696c  hmap().write(fil
-0001a290: 7465 7265 6429 0a0a 2020 2020 6465 6620  tered)..    def 
-0001a2a0: 696e 7661 6c69 6461 7465 6361 6368 6573  invalidatecaches
-0001a2b0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001a2c0: 6966 2027 5f74 6167 7363 6163 6865 2720  if '_tagscache' 
-0001a2d0: 696e 2076 6172 7328 7365 6c66 293a 0a20  in vars(self):. 
-0001a2e0: 2020 2020 2020 2020 2020 2023 2063 616e             # can
-0001a2f0: 2774 2075 7365 2064 656c 6174 7472 206f  't use delattr o
-0001a300: 6e20 7072 6f78 790a 2020 2020 2020 2020  n proxy.        
-0001a310: 2020 2020 6465 6c20 7365 6c66 2e5f 5f64      del self.__d
-0001a320: 6963 745f 5f5b 275f 7461 6773 6361 6368  ict__['_tagscach
-0001a330: 6527 5d0a 0a20 2020 2020 2020 2073 656c  e']..        sel
-0001a340: 662e 5f62 7261 6e63 6863 6163 6865 732e  f._branchcaches.
-0001a350: 636c 6561 7228 290a 2020 2020 2020 2020  clear().        
-0001a360: 7365 6c66 2e69 6e76 616c 6964 6174 6576  self.invalidatev
-0001a370: 6f6c 6174 696c 6573 6574 7328 290a 2020  olatilesets().  
-0001a380: 2020 2020 2020 7365 6c66 2e5f 7370 6172        self._spar
-0001a390: 7365 7369 676e 6174 7572 6563 6163 6865  sesignaturecache
-0001a3a0: 2e63 6c65 6172 2829 0a0a 2020 2020 6465  .clear()..    de
-0001a3b0: 6620 696e 7661 6c69 6461 7465 766f 6c61  f invalidatevola
-0001a3c0: 7469 6c65 7365 7473 2873 656c 6629 3a0a  tilesets(self):.
-0001a3d0: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
-0001a3e0: 7465 7265 6472 6576 6361 6368 652e 636c  teredrevcache.cl
-0001a3f0: 6561 7228 290a 2020 2020 2020 2020 6f62  ear().        ob
-0001a400: 736f 6c65 7465 2e63 6c65 6172 6f62 7363  solete.clearobsc
-0001a410: 6163 6865 7328 7365 6c66 290a 2020 2020  aches(self).    
-0001a420: 2020 2020 7365 6c66 2e5f 7175 6963 6b5f      self._quick_
-0001a430: 6163 6365 7373 5f63 6861 6e67 6569 645f  access_changeid_
-0001a440: 696e 7661 6c69 6461 7465 2829 0a0a 2020  invalidate()..  
-0001a450: 2020 6465 6620 696e 7661 6c69 6461 7465    def invalidate
-0001a460: 6469 7273 7461 7465 2873 656c 6629 3a0a  dirstate(self):.
-0001a470: 2020 2020 2020 2020 2222 2249 6e76 616c          """Inval
-0001a480: 6964 6174 6573 2074 6865 2064 6972 7374  idates the dirst
-0001a490: 6174 652c 2063 6175 7369 6e67 2074 6865  ate, causing the
-0001a4a0: 206e 6578 7420 6361 6c6c 2074 6f20 6469   next call to di
-0001a4b0: 7273 7461 7465 0a20 2020 2020 2020 2074  rstate.        t
-0001a4c0: 6f20 6368 6563 6b20 6966 2069 7420 7761  o check if it wa
-0001a4d0: 7320 6d6f 6469 6669 6564 2073 696e 6365  s modified since
-0001a4e0: 2074 6865 206c 6173 7420 7469 6d65 2069   the last time i
-0001a4f0: 7420 7761 7320 7265 6164 2c0a 2020 2020  t was read,.    
-0001a500: 2020 2020 7265 7265 6164 696e 6720 6974      rereading it
-0001a510: 2069 6620 6974 2068 6173 2e0a 0a20 2020   if it has...   
-0001a520: 2020 2020 2054 6869 7320 6973 2064 6966       This is dif
-0001a530: 6665 7265 6e74 2074 6f20 6469 7273 7461  ferent to dirsta
-0001a540: 7465 2e69 6e76 616c 6964 6174 6528 2920  te.invalidate() 
-0001a550: 7468 6174 2069 7420 646f 6573 6e27 7420  that it doesn't 
-0001a560: 616c 7761 7973 0a20 2020 2020 2020 2072  always.        r
-0001a570: 6572 6561 6473 2074 6865 2064 6972 7374  ereads the dirst
-0001a580: 6174 652e 2055 7365 2064 6972 7374 6174  ate. Use dirstat
-0001a590: 652e 696e 7661 6c69 6461 7465 2829 2069  e.invalidate() i
-0001a5a0: 6620 796f 7520 7761 6e74 2074 6f0a 2020  f you want to.  
-0001a5b0: 2020 2020 2020 6578 706c 6963 6974 6c79        explicitly
-0001a5c0: 2072 6561 6420 7468 6520 6469 7273 7461   read the dirsta
-0001a5d0: 7465 2061 6761 696e 2028 692e 652e 2072  te again (i.e. r
-0001a5e0: 6573 746f 7269 6e67 2069 7420 746f 2061  estoring it to a
-0001a5f0: 2070 7265 7669 6f75 730a 2020 2020 2020   previous.      
-0001a600: 2020 6b6e 6f77 6e20 676f 6f64 2073 7461    known good sta
-0001a610: 7465 292e 2222 220a 2020 2020 2020 2020  te).""".        
-0001a620: 756e 6669 203d 2073 656c 662e 756e 6669  unfi = self.unfi
-0001a630: 6c74 6572 6564 2829 0a20 2020 2020 2020  ltered().       
-0001a640: 2069 6620 2764 6972 7374 6174 6527 2069   if 'dirstate' i
-0001a650: 6e20 756e 6669 2e5f 5f64 6963 745f 5f3a  n unfi.__dict__:
-0001a660: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-0001a670: 2075 6e66 692e 5f5f 6469 6374 5f5f 5b27   unfi.__dict__['
-0001a680: 6469 7273 7461 7465 275d 0a0a 2020 2020  dirstate']..    
-0001a690: 6465 6620 696e 7661 6c69 6461 7465 2873  def invalidate(s
-0001a6a0: 656c 662c 2063 6c65 6172 6669 6c65 6361  elf, clearfileca
-0001a6b0: 6368 653d 4661 6c73 6529 3a0a 2020 2020  che=False):.    
-0001a6c0: 2020 2020 2222 2249 6e76 616c 6964 6174      """Invalidat
-0001a6d0: 6573 2062 6f74 6820 7374 6f72 6520 616e  es both store an
-0001a6e0: 6420 6e6f 6e2d 7374 6f72 6520 7061 7274  d non-store part
-0001a6f0: 7320 6f74 6865 7220 7468 616e 2064 6972  s other than dir
-0001a700: 7374 6174 650a 0a20 2020 2020 2020 2049  state..        I
-0001a710: 6620 6120 7472 616e 7361 6374 696f 6e20  f a transaction 
-0001a720: 6973 2072 756e 6e69 6e67 2c20 696e 7661  is running, inva
-0001a730: 6c69 6461 7469 6f6e 206f 6620 7374 6f72  lidation of stor
-0001a740: 6520 6973 206f 6d69 7474 6564 2c0a 2020  e is omitted,.  
-0001a750: 2020 2020 2020 6265 6361 7573 6520 6469        because di
-0001a760: 7363 6172 6469 6e67 2069 6e2d 6d65 6d6f  scarding in-memo
-0001a770: 7279 2063 6861 6e67 6573 206d 6967 6874  ry changes might
-0001a780: 2063 6175 7365 2069 6e63 6f6e 7369 7374   cause inconsist
-0001a790: 656e 6379 0a20 2020 2020 2020 2028 652e  ency.        (e.
-0001a7a0: 672e 2069 6e63 6f6d 706c 6574 6520 666e  g. incomplete fn
-0001a7b0: 6361 6368 6520 6361 7573 6573 2075 6e69  cache causes uni
-0001a7c0: 6e74 656e 7469 6f6e 616c 2066 6169 6c75  ntentional failu
-0001a7d0: 7265 2c20 6275 740a 2020 2020 2020 2020  re, but.        
-0001a7e0: 7265 6475 6e64 616e 7420 6f6e 6520 646f  redundant one do
-0001a7f0: 6573 6e27 7429 2e0a 2020 2020 2020 2020  esn't)..        
-0001a800: 2222 220a 2020 2020 2020 2020 756e 6669  """.        unfi
-0001a810: 6c74 6572 6564 203d 2073 656c 662e 756e  ltered = self.un
-0001a820: 6669 6c74 6572 6564 2829 2020 2320 616c  filtered()  # al
-0001a830: 6c20 6669 6c65 2063 6163 6865 7320 6172  l file caches ar
-0001a840: 6520 7374 6f72 6564 2075 6e66 696c 7465  e stored unfilte
-0001a850: 7265 640a 2020 2020 2020 2020 666f 7220  red.        for 
-0001a860: 6b20 696e 206c 6973 7428 7365 6c66 2e5f  k in list(self._
-0001a870: 6669 6c65 6361 6368 652e 6b65 7973 2829  filecache.keys()
-0001a880: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0001a890: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-0001a8a0: 2020 2020 6b20 3d3d 2062 2763 6861 6e67      k == b'chang
-0001a8b0: 656c 6f67 270a 2020 2020 2020 2020 2020  elog'.          
-0001a8c0: 2020 2020 2020 616e 6420 7365 6c66 2e63        and self.c
-0001a8d0: 7572 7265 6e74 7472 616e 7361 6374 696f  urrenttransactio
-0001a8e0: 6e28 290a 2020 2020 2020 2020 2020 2020  n().            
-0001a8f0: 2020 2020 616e 6420 7365 6c66 2e63 6861      and self.cha
-0001a900: 6e67 656c 6f67 2e5f 6465 6c61 7965 640a  ngelog._delayed.
-0001a910: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-0001a920: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001a930: 2054 6865 2063 6861 6e67 656c 6f67 206f   The changelog o
-0001a940: 626a 6563 7420 6d61 7920 7374 6f72 6520  bject may store 
-0001a950: 756e 7772 6974 7465 6e20 7265 7669 7369  unwritten revisi
-0001a960: 6f6e 732e 2057 6520 646f 6e27 740a 2020  ons. We don't.  
-0001a970: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001a980: 7761 6e74 2074 6f20 6c6f 7365 2074 6865  want to lose the
-0001a990: 6d2e 0a20 2020 2020 2020 2020 2020 2020  m..             
-0001a9a0: 2020 2023 2054 4f44 4f3a 2053 6f6c 7665     # TODO: Solve
-0001a9b0: 2074 6865 2070 726f 626c 656d 2069 6e73   the problem ins
-0001a9c0: 7465 6164 206f 6620 776f 726b 696e 6720  tead of working 
-0001a9d0: 6172 6f75 6e64 2069 742e 0a20 2020 2020  around it..     
-0001a9e0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0001a9f0: 6e75 650a 0a20 2020 2020 2020 2020 2020  nue..           
-0001aa00: 2069 6620 636c 6561 7266 696c 6563 6163   if clearfilecac
-0001aa10: 6865 3a0a 2020 2020 2020 2020 2020 2020  he:.            
-0001aa20: 2020 2020 6465 6c20 7365 6c66 2e5f 6669      del self._fi
-0001aa30: 6c65 6361 6368 655b 6b5d 0a20 2020 2020  lecache[k].     
-0001aa40: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0001aa50: 2020 2020 2020 2020 2020 2020 6465 6c61              dela
-0001aa60: 7474 7228 756e 6669 6c74 6572 6564 2c20  ttr(unfiltered, 
-0001aa70: 6b29 0a20 2020 2020 2020 2020 2020 2065  k).            e
-0001aa80: 7863 6570 7420 4174 7472 6962 7574 6545  xcept AttributeE
-0001aa90: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-0001aaa0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-0001aab0: 2020 2073 656c 662e 696e 7661 6c69 6461     self.invalida
-0001aac0: 7465 6361 6368 6573 2829 0a20 2020 2020  tecaches().     
-0001aad0: 2020 2069 6620 6e6f 7420 7365 6c66 2e63     if not self.c
-0001aae0: 7572 7265 6e74 7472 616e 7361 6374 696f  urrenttransactio
-0001aaf0: 6e28 293a 0a20 2020 2020 2020 2020 2020  n():.           
-0001ab00: 2023 2054 4f44 4f3a 2043 6861 6e67 696e   # TODO: Changin
-0001ab10: 6720 636f 6e74 656e 7473 206f 6620 7374  g contents of st
-0001ab20: 6f72 6520 6f75 7473 6964 6520 7472 616e  ore outside tran
-0001ab30: 7361 6374 696f 6e0a 2020 2020 2020 2020  saction.        
-0001ab40: 2020 2020 2320 6361 7573 6573 2069 6e63      # causes inc
-0001ab50: 6f6e 7369 7374 656e 6379 2e20 5765 2073  onsistency. We s
-0001ab60: 686f 756c 6420 6d61 6b65 2069 6e2d 6d65  hould make in-me
-0001ab70: 6d6f 7279 2073 746f 7265 0a20 2020 2020  mory store.     
-0001ab80: 2020 2020 2020 2023 2063 6861 6e67 6573         # changes
-0001ab90: 2064 6574 6563 7461 626c 652c 2061 6e64   detectable, and
-0001aba0: 2061 626f 7274 2069 6620 6368 616e 6765   abort if change
-0001abb0: 642e 0a20 2020 2020 2020 2020 2020 2073  d..            s
-0001abc0: 656c 662e 7374 6f72 652e 696e 7661 6c69  elf.store.invali
-0001abd0: 6461 7465 6361 6368 6573 2829 0a0a 2020  datecaches()..  
-0001abe0: 2020 6465 6620 696e 7661 6c69 6461 7465    def invalidate
-0001abf0: 616c 6c28 7365 6c66 293a 0a20 2020 2020  all(self):.     
-0001ac00: 2020 2022 2222 4675 6c6c 7920 696e 7661     """Fully inva
-0001ac10: 6c69 6461 7465 7320 626f 7468 2073 746f  lidates both sto
-0001ac20: 7265 2061 6e64 206e 6f6e 2d73 746f 7265  re and non-store
-0001ac30: 2070 6172 7473 2c20 6361 7573 696e 6720   parts, causing 
-0001ac40: 7468 650a 2020 2020 2020 2020 7375 6273  the.        subs
-0001ac50: 6571 7565 6e74 206f 7065 7261 7469 6f6e  equent operation
-0001ac60: 2074 6f20 7265 7265 6164 2061 6e79 206f   to reread any o
-0001ac70: 7574 7369 6465 2063 6861 6e67 6573 2e22  utside changes."
-0001ac80: 2222 0a20 2020 2020 2020 2023 2065 7874  "".        # ext
-0001ac90: 656e 7369 6f6e 2073 686f 756c 6420 686f  ension should ho
-0001aca0: 6f6b 2074 6869 7320 746f 2069 6e76 616c  ok this to inval
-0001acb0: 6964 6174 6520 6974 7320 6361 6368 6573  idate its caches
-0001acc0: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-0001acd0: 7661 6c69 6461 7465 2829 0a20 2020 2020  validate().     
-0001ace0: 2020 2073 656c 662e 696e 7661 6c69 6461     self.invalida
-0001acf0: 7465 6469 7273 7461 7465 2829 0a0a 2020  tedirstate()..  
-0001ad00: 2020 4075 6e66 696c 7465 7265 646d 6574    @unfilteredmet
-0001ad10: 686f 640a 2020 2020 6465 6620 5f72 6566  hod.    def _ref
-0001ad20: 7265 7368 6669 6c65 6361 6368 6573 7461  reshfilecachesta
-0001ad30: 7473 2873 656c 662c 2074 7229 3a0a 2020  ts(self, tr):.  
-0001ad40: 2020 2020 2020 2222 2252 656c 6f61 6420        """Reload 
-0001ad50: 7374 6174 7320 6f66 2063 6163 6865 6420  stats of cached 
-0001ad60: 6669 6c65 7320 736f 2074 6861 7420 7468  files so that th
-0001ad70: 6579 2061 7265 2066 6c61 6767 6564 2061  ey are flagged a
-0001ad80: 7320 7661 6c69 6422 2222 0a20 2020 2020  s valid""".     
-0001ad90: 2020 2066 6f72 206b 2c20 6365 2069 6e20     for k, ce in 
-0001ada0: 7365 6c66 2e5f 6669 6c65 6361 6368 652e  self._filecache.
-0001adb0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0001adc0: 2020 2020 206b 203d 2070 7963 6f6d 7061       k = pycompa
-0001add0: 742e 7379 7373 7472 286b 290a 2020 2020  t.sysstr(k).    
-0001ade0: 2020 2020 2020 2020 6966 206b 203d 3d20          if k == 
-0001adf0: 2764 6972 7374 6174 6527 206f 7220 6b20  'dirstate' or k 
-0001ae00: 6e6f 7420 696e 2073 656c 662e 5f5f 6469  not in self.__di
-0001ae10: 6374 5f5f 3a0a 2020 2020 2020 2020 2020  ct__:.          
-0001ae20: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0001ae30: 2020 2020 2020 2020 2020 2063 652e 7265             ce.re
-0001ae40: 6672 6573 6828 290a 0a20 2020 2064 6566  fresh()..    def
-0001ae50: 205f 6c6f 636b 280a 2020 2020 2020 2020   _lock(.        
-0001ae60: 7365 6c66 2c0a 2020 2020 2020 2020 7666  self,.        vf
-0001ae70: 732c 0a20 2020 2020 2020 206c 6f63 6b6e  s,.        lockn
-0001ae80: 616d 652c 0a20 2020 2020 2020 2077 6169  ame,.        wai
-0001ae90: 742c 0a20 2020 2020 2020 2072 656c 6561  t,.        relea
-0001aea0: 7365 666e 2c0a 2020 2020 2020 2020 6163  sefn,.        ac
-0001aeb0: 7175 6972 6566 6e2c 0a20 2020 2020 2020  quirefn,.       
-0001aec0: 2064 6573 632c 0a20 2020 2029 3a0a 2020   desc,.    ):.  
-0001aed0: 2020 2020 2020 7469 6d65 6f75 7420 3d20        timeout = 
-0001aee0: 300a 2020 2020 2020 2020 7761 726e 7469  0.        warnti
-0001aef0: 6d65 6f75 7420 3d20 300a 2020 2020 2020  meout = 0.      
-0001af00: 2020 6966 2077 6169 743a 0a20 2020 2020    if wait:.     
-0001af10: 2020 2020 2020 2074 696d 656f 7574 203d         timeout =
-0001af20: 2073 656c 662e 7569 2e63 6f6e 6669 6769   self.ui.configi
-0001af30: 6e74 2862 2275 6922 2c20 6222 7469 6d65  nt(b"ui", b"time
-0001af40: 6f75 7422 290a 2020 2020 2020 2020 2020  out").          
-0001af50: 2020 7761 726e 7469 6d65 6f75 7420 3d20    warntimeout = 
-0001af60: 7365 6c66 2e75 692e 636f 6e66 6967 696e  self.ui.configin
-0001af70: 7428 6222 7569 222c 2062 2274 696d 656f  t(b"ui", b"timeo
-0001af80: 7574 2e77 6172 6e22 290a 2020 2020 2020  ut.warn").      
-0001af90: 2020 2320 696e 7465 726e 616c 2063 6f6e    # internal con
-0001afa0: 6669 673a 2075 692e 7369 676e 616c 2d73  fig: ui.signal-s
-0001afb0: 6166 652d 6c6f 636b 0a20 2020 2020 2020  afe-lock.       
-0001afc0: 2073 6967 6e61 6c73 6166 6520 3d20 7365   signalsafe = se
-0001afd0: 6c66 2e75 692e 636f 6e66 6967 626f 6f6c  lf.ui.configbool
-0001afe0: 2862 2775 6927 2c20 6227 7369 676e 616c  (b'ui', b'signal
-0001aff0: 2d73 6166 652d 6c6f 636b 2729 0a0a 2020  -safe-lock')..  
-0001b000: 2020 2020 2020 6c20 3d20 6c6f 636b 6d6f        l = lockmo
-0001b010: 642e 7472 796c 6f63 6b28 0a20 2020 2020  d.trylock(.     
-0001b020: 2020 2020 2020 2073 656c 662e 7569 2c0a         self.ui,.
-0001b030: 2020 2020 2020 2020 2020 2020 7666 732c              vfs,
-0001b040: 0a20 2020 2020 2020 2020 2020 206c 6f63  .            loc
-0001b050: 6b6e 616d 652c 0a20 2020 2020 2020 2020  kname,.         
-0001b060: 2020 2074 696d 656f 7574 2c0a 2020 2020     timeout,.    
-0001b070: 2020 2020 2020 2020 7761 726e 7469 6d65          warntime
-0001b080: 6f75 742c 0a20 2020 2020 2020 2020 2020  out,.           
-0001b090: 2072 656c 6561 7365 666e 3d72 656c 6561   releasefn=relea
-0001b0a0: 7365 666e 2c0a 2020 2020 2020 2020 2020  sefn,.          
-0001b0b0: 2020 6163 7175 6972 6566 6e3d 6163 7175    acquirefn=acqu
-0001b0c0: 6972 6566 6e2c 0a20 2020 2020 2020 2020  irefn,.         
-0001b0d0: 2020 2064 6573 633d 6465 7363 2c0a 2020     desc=desc,.  
-0001b0e0: 2020 2020 2020 2020 2020 7369 676e 616c            signal
-0001b0f0: 7361 6665 3d73 6967 6e61 6c73 6166 652c  safe=signalsafe,
-0001b100: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-0001b110: 2020 2072 6574 7572 6e20 6c0a 0a20 2020     return l..   
-0001b120: 2064 6566 205f 6166 7465 726c 6f63 6b28   def _afterlock(
-0001b130: 7365 6c66 2c20 6361 6c6c 6261 636b 293a  self, callback):
-0001b140: 0a20 2020 2020 2020 2022 2222 6164 6420  .        """add 
-0001b150: 6120 6361 6c6c 6261 636b 2074 6f20 6265  a callback to be
-0001b160: 2072 756e 2077 6865 6e20 7468 6520 7265   run when the re
-0001b170: 706f 7369 746f 7279 2069 7320 6675 6c6c  pository is full
-0001b180: 7920 756e 6c6f 636b 6564 0a0a 2020 2020  y unlocked..    
-0001b190: 2020 2020 5468 6520 6361 6c6c 6261 636b      The callback
-0001b1a0: 2077 696c 6c20 6265 2065 7865 6375 7465   will be execute
-0001b1b0: 6420 7768 656e 2074 6865 206f 7574 6572  d when the outer
-0001b1c0: 6d6f 7374 206c 6f63 6b20 6973 2072 656c  most lock is rel
-0001b1d0: 6561 7365 640a 2020 2020 2020 2020 2877  eased.        (w
-0001b1e0: 6974 6820 776c 6f63 6b20 6265 696e 6720  ith wlock being 
-0001b1f0: 6869 6768 6572 206c 6576 656c 2074 6861  higher level tha
-0001b200: 6e20 276c 6f63 6b27 292e 2222 220a 2020  n 'lock').""".  
-0001b210: 2020 2020 2020 666f 7220 7265 6620 696e        for ref in
-0001b220: 2028 7365 6c66 2e5f 776c 6f63 6b72 6566   (self._wlockref
-0001b230: 2c20 7365 6c66 2e5f 6c6f 636b 7265 6629  , self._lockref)
-0001b240: 3a0a 2020 2020 2020 2020 2020 2020 6c20  :.            l 
-0001b250: 3d20 7265 6620 616e 6420 7265 6628 290a  = ref and ref().
-0001b260: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0001b270: 2061 6e64 206c 2e68 656c 643a 0a20 2020   and l.held:.   
-0001b280: 2020 2020 2020 2020 2020 2020 206c 2e70               l.p
-0001b290: 6f73 7472 656c 6561 7365 2e61 7070 656e  ostrelease.appen
-0001b2a0: 6428 6361 6c6c 6261 636b 290a 2020 2020  d(callback).    
-0001b2b0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0001b2c0: 6b0a 2020 2020 2020 2020 656c 7365 3a20  k.        else: 
-0001b2d0: 2023 206e 6f20 6c6f 636b 2068 6176 6520   # no lock have 
-0001b2e0: 6265 656e 2066 6f75 6e64 2e0a 2020 2020  been found..    
-0001b2f0: 2020 2020 2020 2020 6361 6c6c 6261 636b          callback
-0001b300: 2854 7275 6529 0a0a 2020 2020 6465 6620  (True)..    def 
-0001b310: 6c6f 636b 2873 656c 662c 2077 6169 743d  lock(self, wait=
-0001b320: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
-0001b330: 2222 4c6f 636b 2074 6865 2072 6570 6f73  ""Lock the repos
-0001b340: 6974 6f72 7920 7374 6f72 6520 282e 6867  itory store (.hg
-0001b350: 2f73 746f 7265 2920 616e 6420 7265 7475  /store) and retu
-0001b360: 726e 2061 2077 6561 6b20 7265 6665 7265  rn a weak refere
-0001b370: 6e63 650a 2020 2020 2020 2020 746f 2074  nce.        to t
-0001b380: 6865 206c 6f63 6b2e 2055 7365 2074 6869  he lock. Use thi
-0001b390: 7320 6265 666f 7265 206d 6f64 6966 7969  s before modifyi
-0001b3a0: 6e67 2074 6865 2073 746f 7265 2028 652e  ng the store (e.
-0001b3b0: 672e 2063 6f6d 6d69 7474 696e 6720 6f72  g. committing or
-0001b3c0: 0a20 2020 2020 2020 2073 7472 6970 7069  .        strippi
-0001b3d0: 6e67 292e 2049 6620 796f 7520 6172 6520  ng). If you are 
-0001b3e0: 6f70 656e 696e 6720 6120 7472 616e 7361  opening a transa
-0001b3f0: 6374 696f 6e2c 2067 6574 2061 206c 6f63  ction, get a loc
-0001b400: 6b20 6173 2077 656c 6c2e 290a 0a20 2020  k as well.)..   
-0001b410: 2020 2020 2049 6620 626f 7468 2027 6c6f       If both 'lo
-0001b420: 636b 2720 616e 6420 2777 6c6f 636b 2720  ck' and 'wlock' 
-0001b430: 6d75 7374 2062 6520 6163 7175 6972 6564  must be acquired
-0001b440: 2c20 656e 7375 7265 2079 6f75 2061 6c77  , ensure you alw
-0001b450: 6179 7320 6163 7175 6972 6573 0a20 2020  ays acquires.   
-0001b460: 2020 2020 2027 776c 6f63 6b27 2066 6972       'wlock' fir
-0001b470: 7374 2074 6f20 6176 6f69 6420 6120 6465  st to avoid a de
-0001b480: 6164 2d6c 6f63 6b20 6861 7a61 7264 2e22  ad-lock hazard."
-0001b490: 2222 0a20 2020 2020 2020 206c 203d 2073  "".        l = s
-0001b4a0: 656c 662e 5f63 7572 7265 6e74 6c6f 636b  elf._currentlock
-0001b4b0: 2873 656c 662e 5f6c 6f63 6b72 6566 290a  (self._lockref).
-0001b4c0: 2020 2020 2020 2020 6966 206c 2069 7320          if l is 
-0001b4d0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0001b4e0: 2020 2020 2020 6c2e 6c6f 636b 2829 0a20        l.lock(). 
-0001b4f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001b500: 6e20 6c0a 0a20 2020 2020 2020 206c 203d  n l..        l =
-0001b510: 2073 656c 662e 5f6c 6f63 6b28 0a20 2020   self._lock(.   
-0001b520: 2020 2020 2020 2020 2076 6673 3d73 656c           vfs=sel
-0001b530: 662e 7376 6673 2c0a 2020 2020 2020 2020  f.svfs,.        
-0001b540: 2020 2020 6c6f 636b 6e61 6d65 3d62 226c      lockname=b"l
-0001b550: 6f63 6b22 2c0a 2020 2020 2020 2020 2020  ock",.          
-0001b560: 2020 7761 6974 3d77 6169 742c 0a20 2020    wait=wait,.   
-0001b570: 2020 2020 2020 2020 2072 656c 6561 7365           release
-0001b580: 666e 3d4e 6f6e 652c 0a20 2020 2020 2020  fn=None,.       
-0001b590: 2020 2020 2061 6371 7569 7265 666e 3d73       acquirefn=s
-0001b5a0: 656c 662e 696e 7661 6c69 6461 7465 2c0a  elf.invalidate,.
-0001b5b0: 2020 2020 2020 2020 2020 2020 6465 7363              desc
-0001b5c0: 3d5f 2862 2772 6570 6f73 6974 6f72 7920  =_(b'repository 
-0001b5d0: 2573 2729 2025 2073 656c 662e 6f72 6967  %s') % self.orig
-0001b5e0: 726f 6f74 2c0a 2020 2020 2020 2020 290a  root,.        ).
-0001b5f0: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-0001b600: 636b 7265 6620 3d20 7765 616b 7265 662e  ckref = weakref.
-0001b610: 7265 6628 6c29 0a20 2020 2020 2020 2072  ref(l).        r
-0001b620: 6574 7572 6e20 6c0a 0a20 2020 2064 6566  eturn l..    def
-0001b630: 2077 6c6f 636b 2873 656c 662c 2077 6169   wlock(self, wai
-0001b640: 743d 5472 7565 293a 0a20 2020 2020 2020  t=True):.       
-0001b650: 2022 2222 4c6f 636b 2074 6865 206e 6f6e   """Lock the non
-0001b660: 2d73 746f 7265 2070 6172 7473 206f 6620  -store parts of 
-0001b670: 7468 6520 7265 706f 7369 746f 7279 2028  the repository (
-0001b680: 6576 6572 7974 6869 6e67 2075 6e64 6572  everything under
-0001b690: 0a20 2020 2020 2020 202e 6867 2065 7863  .        .hg exc
-0001b6a0: 6570 7420 2e68 672f 7374 6f72 6529 2061  ept .hg/store) a
-0001b6b0: 6e64 2072 6574 7572 6e20 6120 7765 616b  nd return a weak
-0001b6c0: 2072 6566 6572 656e 6365 2074 6f20 7468   reference to th
-0001b6d0: 6520 6c6f 636b 2e0a 0a20 2020 2020 2020  e lock...       
-0001b6e0: 2055 7365 2074 6869 7320 6265 666f 7265   Use this before
-0001b6f0: 206d 6f64 6966 7969 6e67 2066 696c 6573   modifying files
-0001b700: 2069 6e20 2e68 672e 0a0a 2020 2020 2020   in .hg...      
-0001b710: 2020 4966 2062 6f74 6820 276c 6f63 6b27    If both 'lock'
-0001b720: 2061 6e64 2027 776c 6f63 6b27 206d 7573   and 'wlock' mus
-0001b730: 7420 6265 2061 6371 7569 7265 642c 2065  t be acquired, e
-0001b740: 6e73 7572 6520 796f 7520 616c 7761 7973  nsure you always
-0001b750: 2061 6371 7569 7265 730a 2020 2020 2020   acquires.      
-0001b760: 2020 2777 6c6f 636b 2720 6669 7273 7420    'wlock' first 
-0001b770: 746f 2061 766f 6964 2061 2064 6561 642d  to avoid a dead-
-0001b780: 6c6f 636b 2068 617a 6172 642e 2222 220a  lock hazard.""".
-0001b790: 2020 2020 2020 2020 6c20 3d20 7365 6c66          l = self
-0001b7a0: 2e5f 776c 6f63 6b72 6566 2829 2069 6620  ._wlockref() if 
-0001b7b0: 7365 6c66 2e5f 776c 6f63 6b72 6566 2065  self._wlockref e
-0001b7c0: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
-0001b7d0: 2069 6620 6c20 6973 206e 6f74 204e 6f6e   if l is not Non
-0001b7e0: 6520 616e 6420 6c2e 6865 6c64 3a0a 2020  e and l.held:.  
-0001b7f0: 2020 2020 2020 2020 2020 6c2e 6c6f 636b            l.lock
-0001b800: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
-0001b810: 6574 7572 6e20 6c0a 0a20 2020 2020 2020  eturn l..       
-0001b820: 2023 2057 6520 646f 206e 6f74 206e 6565   # We do not nee
-0001b830: 6420 746f 2063 6865 636b 2066 6f72 206e  d to check for n
-0001b840: 6f6e 2d77 6169 7469 6e67 206c 6f63 6b20  on-waiting lock 
-0001b850: 6163 7175 6973 6974 696f 6e2e 2020 5375  acquisition.  Su
-0001b860: 6368 0a20 2020 2020 2020 2023 2061 6371  ch.        # acq
-0001b870: 7569 7369 7469 6f6e 2077 6f75 6c64 206e  uisition would n
-0001b880: 6f74 2063 6175 7365 2064 6561 642d 6c6f  ot cause dead-lo
-0001b890: 636b 2061 7320 7468 6579 2077 6f75 6c64  ck as they would
-0001b8a0: 206a 7573 7420 6661 696c 2e0a 2020 2020   just fail..    
-0001b8b0: 2020 2020 6966 2077 6169 7420 616e 6420      if wait and 
-0001b8c0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-0001b8d0: 6c66 2e75 692e 636f 6e66 6967 626f 6f6c  lf.ui.configbool
-0001b8e0: 2862 2764 6576 656c 272c 2062 2761 6c6c  (b'devel', b'all
-0001b8f0: 2d77 6172 6e69 6e67 7327 290a 2020 2020  -warnings').    
-0001b900: 2020 2020 2020 2020 6f72 2073 656c 662e          or self.
-0001b910: 7569 2e63 6f6e 6669 6762 6f6f 6c28 6227  ui.configbool(b'
-0001b920: 6465 7665 6c27 2c20 6227 6368 6563 6b2d  devel', b'check-
-0001b930: 6c6f 636b 7327 290a 2020 2020 2020 2020  locks').        
-0001b940: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0001b950: 6620 7365 6c66 2e5f 6375 7272 656e 746c  f self._currentl
-0001b960: 6f63 6b28 7365 6c66 2e5f 6c6f 636b 7265  ock(self._lockre
-0001b970: 6629 2069 7320 6e6f 7420 4e6f 6e65 3a0a  f) is not None:.
-0001b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b990: 7365 6c66 2e75 692e 6465 7665 6c77 6172  self.ui.develwar
-0001b9a0: 6e28 6227 2277 6c6f 636b 2220 6163 7175  n(b'"wlock" acqu
-0001b9b0: 6972 6564 2061 6674 6572 2022 6c6f 636b  ired after "lock
-0001b9c0: 2227 290a 0a20 2020 2020 2020 2064 6566  "')..        def
-0001b9d0: 2075 6e6c 6f63 6b28 293a 0a20 2020 2020   unlock():.     
-0001b9e0: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
-0001b9f0: 6972 7374 6174 652e 6973 5f63 6861 6e67  irstate.is_chang
-0001ba00: 696e 675f 616e 793a 0a20 2020 2020 2020  ing_any:.       
-0001ba10: 2020 2020 2020 2020 206d 7367 203d 2062           msg = b
-0001ba20: 2277 6c6f 636b 2072 656c 6561 7365 2069  "wlock release i
-0001ba30: 6e20 7468 6520 6d69 6464 6c65 206f 6620  n the middle of 
-0001ba40: 6120 6368 616e 6769 6e67 2070 6172 656e  a changing paren
-0001ba50: 7473 220a 2020 2020 2020 2020 2020 2020  ts".            
-0001ba60: 2020 2020 7365 6c66 2e75 692e 6465 7665      self.ui.deve
-0001ba70: 6c77 6172 6e28 6d73 6729 0a20 2020 2020  lwarn(msg).     
-0001ba80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001ba90: 6469 7273 7461 7465 2e69 6e76 616c 6964  dirstate.invalid
-0001baa0: 6174 6528 290a 2020 2020 2020 2020 2020  ate().          
-0001bab0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001bac0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001bad0: 6469 7273 7461 7465 2e5f 6469 7274 793a  dirstate._dirty:
-0001bae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001baf0: 2020 2020 206d 7367 203d 2062 2264 6972       msg = b"dir
-0001bb00: 7479 2064 6972 7374 6174 6520 6f6e 2077  ty dirstate on w
-0001bb10: 6c6f 636b 2072 656c 6561 7365 220a 2020  lock release".  
-0001bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb30: 2020 7365 6c66 2e75 692e 6465 7665 6c77    self.ui.develw
-0001bb40: 6172 6e28 6d73 6729 0a20 2020 2020 2020  arn(msg).       
-0001bb50: 2020 2020 2020 2020 2073 656c 662e 6469           self.di
-0001bb60: 7273 7461 7465 2e77 7269 7465 284e 6f6e  rstate.write(Non
-0001bb70: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-0001bb80: 756e 6669 203d 2073 656c 662e 756e 6669  unfi = self.unfi
-0001bb90: 6c74 6572 6564 2829 0a20 2020 2020 2020  ltered().       
-0001bba0: 2020 2020 2069 6620 2764 6972 7374 6174       if 'dirstat
-0001bbb0: 6527 2069 6e20 756e 6669 2e5f 5f64 6963  e' in unfi.__dic
-0001bbc0: 745f 5f3a 0a20 2020 2020 2020 2020 2020  t__:.           
-0001bbd0: 2020 2020 2064 656c 2075 6e66 692e 5f5f       del unfi.__
-0001bbe0: 6469 6374 5f5f 5b27 6469 7273 7461 7465  dict__['dirstate
-0001bbf0: 275d 0a0a 2020 2020 2020 2020 6c20 3d20  ']..        l = 
-0001bc00: 7365 6c66 2e5f 6c6f 636b 280a 2020 2020  self._lock(.    
-0001bc10: 2020 2020 2020 2020 7365 6c66 2e76 6673          self.vfs
-0001bc20: 2c0a 2020 2020 2020 2020 2020 2020 6222  ,.            b"
-0001bc30: 776c 6f63 6b22 2c0a 2020 2020 2020 2020  wlock",.        
-0001bc40: 2020 2020 7761 6974 2c0a 2020 2020 2020      wait,.      
-0001bc50: 2020 2020 2020 756e 6c6f 636b 2c0a 2020        unlock,.  
-0001bc60: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-0001bc70: 6e76 616c 6964 6174 6564 6972 7374 6174  nvalidatedirstat
-0001bc80: 652c 0a20 2020 2020 2020 2020 2020 205f  e,.            _
-0001bc90: 2862 2777 6f72 6b69 6e67 2064 6972 6563  (b'working direc
-0001bca0: 746f 7279 206f 6620 2573 2729 2025 2073  tory of %s') % s
-0001bcb0: 656c 662e 6f72 6967 726f 6f74 2c0a 2020  elf.origroot,.  
-0001bcc0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001bcd0: 7365 6c66 2e5f 776c 6f63 6b72 6566 203d  self._wlockref =
-0001bce0: 2077 6561 6b72 6566 2e72 6566 286c 290a   weakref.ref(l).
-0001bcf0: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-0001bd00: 0a0a 2020 2020 6465 6620 5f63 7572 7265  ..    def _curre
-0001bd10: 6e74 6c6f 636b 2873 656c 662c 206c 6f63  ntlock(self, loc
-0001bd20: 6b72 6566 293a 0a20 2020 2020 2020 2022  kref):.        "
-0001bd30: 2222 5265 7475 726e 7320 7468 6520 6c6f  ""Returns the lo
-0001bd40: 636b 2069 6620 6974 2773 2068 656c 642c  ck if it's held,
-0001bd50: 206f 7220 4e6f 6e65 2069 6620 6974 2773   or None if it's
-0001bd60: 206e 6f74 2e22 2222 0a20 2020 2020 2020   not.""".       
-0001bd70: 2069 6620 6c6f 636b 7265 6620 6973 204e   if lockref is N
-0001bd80: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0001bd90: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-0001bda0: 2020 2020 206c 203d 206c 6f63 6b72 6566       l = lockref
-0001bdb0: 2829 0a20 2020 2020 2020 2069 6620 6c20  ().        if l 
-0001bdc0: 6973 204e 6f6e 6520 6f72 206e 6f74 206c  is None or not l
-0001bdd0: 2e68 656c 643a 0a20 2020 2020 2020 2020  .held:.         
-0001bde0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
-0001bdf0: 2020 2020 2020 2072 6574 7572 6e20 6c0a         return l.
-0001be00: 0a20 2020 2064 6566 2063 7572 7265 6e74  .    def current
-0001be10: 776c 6f63 6b28 7365 6c66 293a 0a20 2020  wlock(self):.   
-0001be20: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-0001be30: 7468 6520 776c 6f63 6b20 6966 2069 7427  the wlock if it'
-0001be40: 7320 6865 6c64 2c20 6f72 204e 6f6e 6520  s held, or None 
-0001be50: 6966 2069 7427 7320 6e6f 742e 2222 220a  if it's not.""".
-0001be60: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001be70: 656c 662e 5f63 7572 7265 6e74 6c6f 636b  elf._currentlock
-0001be80: 2873 656c 662e 5f77 6c6f 636b 7265 6629  (self._wlockref)
-0001be90: 0a0a 2020 2020 6465 6620 6368 6563 6b63  ..    def checkc
-0001bea0: 6f6d 6d69 7470 6174 7465 726e 7328 7365  ommitpatterns(se
-0001beb0: 6c66 2c20 7763 7478 2c20 6d61 7463 682c  lf, wctx, match,
-0001bec0: 2073 7461 7475 732c 2066 6169 6c29 3a0a   status, fail):.
-0001bed0: 2020 2020 2020 2020 2222 2263 6865 636b          """check
-0001bee0: 2066 6f72 2063 6f6d 6d69 7420 6172 6775   for commit argu
-0001bef0: 6d65 6e74 7320 7468 6174 2061 7265 6e27  ments that aren'
-0001bf00: 7420 636f 6d6d 6974 7461 626c 6522 2222  t committable"""
-0001bf10: 0a20 2020 2020 2020 2069 6620 6d61 7463  .        if matc
-0001bf20: 682e 6973 6578 6163 7428 2920 6f72 206d  h.isexact() or m
-0001bf30: 6174 6368 2e70 7265 6669 7828 293a 0a20  atch.prefix():. 
-0001bf40: 2020 2020 2020 2020 2020 206d 6174 6368             match
-0001bf50: 6564 203d 2073 6574 2873 7461 7475 732e  ed = set(status.
-0001bf60: 6d6f 6469 6669 6564 202b 2073 7461 7475  modified + statu
-0001bf70: 732e 6164 6465 6420 2b20 7374 6174 7573  s.added + status
-0001bf80: 2e72 656d 6f76 6564 290a 0a20 2020 2020  .removed)..     
-0001bf90: 2020 2020 2020 2066 6f72 2066 2069 6e20         for f in 
-0001bfa0: 6d61 7463 682e 6669 6c65 7328 293a 0a20  match.files():. 
-0001bfb0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001bfc0: 203d 2073 656c 662e 6469 7273 7461 7465   = self.dirstate
-0001bfd0: 2e6e 6f72 6d61 6c69 7a65 2866 290a 2020  .normalize(f).  
-0001bfe0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001bff0: 2066 203d 3d20 6227 2e27 206f 7220 6620   f == b'.' or f 
-0001c000: 696e 206d 6174 6368 6564 206f 7220 6620  in matched or f 
-0001c010: 696e 2077 6374 782e 7375 6273 7461 7465  in wctx.substate
-0001c020: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c030: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0001c040: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001c050: 6620 6620 696e 2073 7461 7475 732e 6465  f f in status.de
-0001c060: 6c65 7465 643a 0a20 2020 2020 2020 2020  leted:.         
-0001c070: 2020 2020 2020 2020 2020 2066 6169 6c28             fail(
-0001c080: 662c 205f 2862 2766 696c 6520 6e6f 7420  f, _(b'file not 
-0001c090: 666f 756e 6421 2729 290a 2020 2020 2020  found!')).      
-0001c0a0: 2020 2020 2020 2020 2020 2320 4973 2069            # Is i
-0001c0b0: 7420 6120 6469 7265 6374 6f72 7920 7468  t a directory th
-0001c0c0: 6174 2065 7869 7374 7320 6f72 2075 7365  at exists or use
-0001c0d0: 6420 746f 2065 7869 7374 3f0a 2020 2020  d to exist?.    
-0001c0e0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0001c0f0: 656c 662e 7776 6673 2e69 7364 6972 2866  elf.wvfs.isdir(f
-0001c100: 2920 6f72 2077 6374 782e 7031 2829 2e68  ) or wctx.p1().h
-0001c110: 6173 6469 7228 6629 3a0a 2020 2020 2020  asdir(f):.      
-0001c120: 2020 2020 2020 2020 2020 2020 2020 6420                d 
-0001c130: 3d20 6620 2b20 6227 2f27 0a20 2020 2020  = f + b'/'.     
-0001c140: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001c150: 6f72 206d 6620 696e 206d 6174 6368 6564  or mf in matched
-0001c160: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c170: 2020 2020 2020 2020 2020 6966 206d 662e            if mf.
-0001c180: 7374 6172 7473 7769 7468 2864 293a 0a20  startswith(d):. 
-0001c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1a0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-0001c1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c1c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1e0: 2020 2066 6169 6c28 662c 205f 2862 226e     fail(f, _(b"n
-0001c1f0: 6f20 6d61 7463 6820 756e 6465 7220 6469  o match under di
-0001c200: 7265 6374 6f72 7921 2229 290a 2020 2020  rectory!")).    
-0001c210: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0001c220: 2066 206e 6f74 2069 6e20 7365 6c66 2e64   f not in self.d
-0001c230: 6972 7374 6174 653a 0a20 2020 2020 2020  irstate:.       
-0001c240: 2020 2020 2020 2020 2020 2020 2066 6169               fai
-0001c250: 6c28 662c 205f 2862 2266 696c 6520 6e6f  l(f, _(b"file no
-0001c260: 7420 7472 6163 6b65 6421 2229 290a 0a20  t tracked!")).. 
-0001c270: 2020 2040 756e 6669 6c74 6572 6564 6d65     @unfilteredme
-0001c280: 7468 6f64 0a20 2020 2064 6566 2063 6f6d  thod.    def com
-0001c290: 6d69 7428 0a20 2020 2020 2020 2073 656c  mit(.        sel
-0001c2a0: 662c 0a20 2020 2020 2020 2074 6578 743d  f,.        text=
-0001c2b0: 6222 222c 0a20 2020 2020 2020 2075 7365  b"",.        use
-0001c2c0: 723d 4e6f 6e65 2c0a 2020 2020 2020 2020  r=None,.        
-0001c2d0: 6461 7465 3d4e 6f6e 652c 0a20 2020 2020  date=None,.     
-0001c2e0: 2020 206d 6174 6368 3d4e 6f6e 652c 0a20     match=None,. 
-0001c2f0: 2020 2020 2020 2066 6f72 6365 3d46 616c         force=Fal
-0001c300: 7365 2c0a 2020 2020 2020 2020 6564 6974  se,.        edit
-0001c310: 6f72 3d4e 6f6e 652c 0a20 2020 2020 2020  or=None,.       
-0001c320: 2065 7874 7261 3d4e 6f6e 652c 0a20 2020   extra=None,.   
-0001c330: 2029 3a0a 2020 2020 2020 2020 2222 2241   ):.        """A
-0001c340: 6464 2061 206e 6577 2072 6576 6973 696f  dd a new revisio
-0001c350: 6e20 746f 2063 7572 7265 6e74 2072 6570  n to current rep
-0001c360: 6f73 6974 6f72 792e 0a0a 2020 2020 2020  ository...      
-0001c370: 2020 5265 7669 7369 6f6e 2069 6e66 6f72    Revision infor
-0001c380: 6d61 7469 6f6e 2069 7320 6761 7468 6572  mation is gather
-0001c390: 6564 2066 726f 6d20 7468 6520 776f 726b  ed from the work
-0001c3a0: 696e 6720 6469 7265 6374 6f72 792c 0a20  ing directory,. 
-0001c3b0: 2020 2020 2020 206d 6174 6368 2063 616e         match can
-0001c3c0: 2062 6520 7573 6564 2074 6f20 6669 6c74   be used to filt
-0001c3d0: 6572 2074 6865 2063 6f6d 6d69 7474 6564  er the committed
-0001c3e0: 2066 696c 6573 2e20 4966 2065 6469 746f   files. If edito
-0001c3f0: 7220 6973 0a20 2020 2020 2020 2073 7570  r is.        sup
-0001c400: 706c 6965 642c 2069 7420 6973 2063 616c  plied, it is cal
-0001c410: 6c65 6420 746f 2067 6574 2061 2063 6f6d  led to get a com
-0001c420: 6d69 7420 6d65 7373 6167 652e 0a20 2020  mit message..   
-0001c430: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001c440: 2069 6620 6578 7472 6120 6973 204e 6f6e   if extra is Non
-0001c450: 653a 0a20 2020 2020 2020 2020 2020 2065  e:.            e
-0001c460: 7874 7261 203d 207b 7d0a 0a20 2020 2020  xtra = {}..     
-0001c470: 2020 2064 6566 2066 6169 6c28 662c 206d     def fail(f, m
-0001c480: 7367 293a 0a20 2020 2020 2020 2020 2020  sg):.           
-0001c490: 2072 6169 7365 2065 7272 6f72 2e49 6e70   raise error.Inp
-0001c4a0: 7574 4572 726f 7228 6227 2573 3a20 2573  utError(b'%s: %s
-0001c4b0: 2720 2520 2866 2c20 6d73 6729 290a 0a20  ' % (f, msg)).. 
-0001c4c0: 2020 2020 2020 2069 6620 6e6f 7420 6d61         if not ma
-0001c4d0: 7463 683a 0a20 2020 2020 2020 2020 2020  tch:.           
-0001c4e0: 206d 6174 6368 203d 206d 6174 6368 6d6f   match = matchmo
-0001c4f0: 642e 616c 7761 7973 2829 0a0a 2020 2020  d.always()..    
-0001c500: 2020 2020 6966 206e 6f74 2066 6f72 6365      if not force
-0001c510: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-0001c520: 7463 682e 6261 6420 3d20 6661 696c 0a0a  tch.bad = fail..
-0001c530: 2020 2020 2020 2020 2320 6c6f 636b 2829          # lock()
-0001c540: 2066 6f72 2072 6563 656e 7420 6368 616e   for recent chan
-0001c550: 6765 6c6f 6720 2873 6565 2069 7373 7565  gelog (see issue
-0001c560: 3433 3638 290a 2020 2020 2020 2020 7769  4368).        wi
-0001c570: 7468 2073 656c 662e 776c 6f63 6b28 292c  th self.wlock(),
-0001c580: 2073 656c 662e 6c6f 636b 2829 3a0a 2020   self.lock():.  
-0001c590: 2020 2020 2020 2020 2020 7763 7478 203d            wctx =
-0001c5a0: 2073 656c 665b 4e6f 6e65 5d0a 2020 2020   self[None].    
-0001c5b0: 2020 2020 2020 2020 6d65 7267 6520 3d20          merge = 
-0001c5c0: 6c65 6e28 7763 7478 2e70 6172 656e 7473  len(wctx.parents
-0001c5d0: 2829 2920 3e20 310a 0a20 2020 2020 2020  ()) > 1..       
-0001c5e0: 2020 2020 2069 6620 6e6f 7420 666f 7263       if not forc
-0001c5f0: 6520 616e 6420 6d65 7267 6520 616e 6420  e and merge and 
-0001c600: 6e6f 7420 6d61 7463 682e 616c 7761 7973  not match.always
-0001c610: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0001c620: 2020 2020 7261 6973 6520 6572 726f 722e      raise error.
-0001c630: 4162 6f72 7428 0a20 2020 2020 2020 2020  Abort(.         
-0001c640: 2020 2020 2020 2020 2020 205f 280a 2020             _(.  
-0001c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c660: 2020 2020 2020 6227 6361 6e6e 6f74 2070        b'cannot p
-0001c670: 6172 7469 616c 6c79 2063 6f6d 6d69 7420  artially commit 
-0001c680: 6120 6d65 7267 6520 270a 2020 2020 2020  a merge '.      
-0001c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6a0: 2020 6227 2864 6f20 6e6f 7420 7370 6563    b'(do not spec
-0001c6b0: 6966 7920 6669 6c65 7320 6f72 2070 6174  ify files or pat
-0001c6c0: 7465 726e 7329 270a 2020 2020 2020 2020  terns)'.        
-0001c6d0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001c6e0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0001c6f0: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-0001c700: 7475 7320 3d20 7365 6c66 2e73 7461 7475  tus = self.statu
-0001c710: 7328 6d61 7463 683d 6d61 7463 682c 2063  s(match=match, c
-0001c720: 6c65 616e 3d66 6f72 6365 290a 2020 2020  lean=force).    
-0001c730: 2020 2020 2020 2020 6966 2066 6f72 6365          if force
-0001c740: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c750: 2020 7374 6174 7573 2e6d 6f64 6966 6965    status.modifie
-0001c760: 642e 6578 7465 6e64 280a 2020 2020 2020  d.extend(.      
-0001c770: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0001c780: 6174 7573 2e63 6c65 616e 0a20 2020 2020  atus.clean.     
-0001c790: 2020 2020 2020 2020 2020 2029 2020 2320             )  # 
-0001c7a0: 6d71 206d 6179 2063 6f6d 6d69 7420 636c  mq may commit cl
-0001c7b0: 6561 6e20 6669 6c65 730a 0a20 2020 2020  ean files..     
-0001c7c0: 2020 2020 2020 2023 2063 6865 636b 2073         # check s
-0001c7d0: 7562 7265 706f 730a 2020 2020 2020 2020  ubrepos.        
-0001c7e0: 2020 2020 7375 6273 2c20 636f 6d6d 6974      subs, commit
-0001c7f0: 7375 6273 2c20 6e65 7773 7461 7465 203d  subs, newstate =
-0001c800: 2073 7562 7265 706f 7574 696c 2e70 7265   subrepoutil.pre
-0001c810: 636f 6d6d 6974 280a 2020 2020 2020 2020  commit(.        
-0001c820: 2020 2020 2020 2020 7365 6c66 2e75 692c          self.ui,
-0001c830: 2077 6374 782c 2073 7461 7475 732c 206d   wctx, status, m
-0001c840: 6174 6368 2c20 666f 7263 653d 666f 7263  atch, force=forc
-0001c850: 650a 2020 2020 2020 2020 2020 2020 290a  e.            ).
-0001c860: 0a20 2020 2020 2020 2020 2020 2023 206d  .            # m
-0001c870: 616b 6520 7375 7265 2061 6c6c 2065 7870  ake sure all exp
-0001c880: 6c69 6369 7420 7061 7474 6572 6e73 2061  licit patterns a
-0001c890: 7265 206d 6174 6368 6564 0a20 2020 2020  re matched.     
-0001c8a0: 2020 2020 2020 2069 6620 6e6f 7420 666f         if not fo
-0001c8b0: 7263 653a 0a20 2020 2020 2020 2020 2020  rce:.           
-0001c8c0: 2020 2020 2073 656c 662e 6368 6563 6b63       self.checkc
-0001c8d0: 6f6d 6d69 7470 6174 7465 726e 7328 7763  ommitpatterns(wc
-0001c8e0: 7478 2c20 6d61 7463 682c 2073 7461 7475  tx, match, statu
-0001c8f0: 732c 2066 6169 6c29 0a0a 2020 2020 2020  s, fail)..      
-0001c900: 2020 2020 2020 6363 7478 203d 2063 6f6e        cctx = con
-0001c910: 7465 7874 2e77 6f72 6b69 6e67 636f 6d6d  text.workingcomm
-0001c920: 6974 6374 7828 0a20 2020 2020 2020 2020  itctx(.         
-0001c930: 2020 2020 2020 2073 656c 662c 2073 7461         self, sta
-0001c940: 7475 732c 2074 6578 742c 2075 7365 722c  tus, text, user,
-0001c950: 2064 6174 652c 2065 7874 7261 0a20 2020   date, extra.   
-0001c960: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0001c970: 2020 2020 2020 2020 6d73 203d 206d 6572          ms = mer
-0001c980: 6765 7374 6174 656d 6f64 2e6d 6572 6765  gestatemod.merge
-0001c990: 7374 6174 652e 7265 6164 2873 656c 6629  state.read(self)
-0001c9a0: 0a20 2020 2020 2020 2020 2020 206d 6572  .            mer
-0001c9b0: 6765 7574 696c 2e63 6865 636b 756e 7265  geutil.checkunre
-0001c9c0: 736f 6c76 6564 286d 7329 0a0a 2020 2020  solved(ms)..    
-0001c9d0: 2020 2020 2020 2020 2320 696e 7465 726e          # intern
-0001c9e0: 616c 2063 6f6e 6669 673a 2075 692e 616c  al config: ui.al
-0001c9f0: 6c6f 7765 6d70 7479 636f 6d6d 6974 0a20  lowemptycommit. 
-0001ca00: 2020 2020 2020 2020 2020 2069 6620 6363             if cc
-0001ca10: 7478 2e69 7365 6d70 7479 2829 2061 6e64  tx.isempty() and
-0001ca20: 206e 6f74 2073 656c 662e 7569 2e63 6f6e   not self.ui.con
-0001ca30: 6669 6762 6f6f 6c28 0a20 2020 2020 2020  figbool(.       
-0001ca40: 2020 2020 2020 2020 2062 2775 6927 2c20           b'ui', 
-0001ca50: 6227 616c 6c6f 7765 6d70 7479 636f 6d6d  b'allowemptycomm
-0001ca60: 6974 270a 2020 2020 2020 2020 2020 2020  it'.            
-0001ca70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001ca80: 2020 2073 656c 662e 7569 2e64 6562 7567     self.ui.debug
-0001ca90: 2862 276e 6f74 6869 6e67 2074 6f20 636f  (b'nothing to co
-0001caa0: 6d6d 6974 2c20 636c 6561 7269 6e67 206d  mmit, clearing m
-0001cab0: 6572 6765 2073 7461 7465 5c6e 2729 0a20  erge state\n'). 
-0001cac0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0001cad0: 732e 7265 7365 7428 290a 2020 2020 2020  s.reset().      
-0001cae0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001caf0: 204e 6f6e 650a 0a20 2020 2020 2020 2020   None..         
-0001cb00: 2020 2069 6620 6d65 7267 6520 616e 6420     if merge and 
-0001cb10: 6363 7478 2e64 656c 6574 6564 2829 3a0a  cctx.deleted():.
-0001cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb30: 7261 6973 6520 6572 726f 722e 4162 6f72  raise error.Abor
-0001cb40: 7428 5f28 6222 6361 6e6e 6f74 2063 6f6d  t(_(b"cannot com
-0001cb50: 6d69 7420 6d65 7267 6520 7769 7468 206d  mit merge with m
-0001cb60: 6973 7369 6e67 2066 696c 6573 2229 290a  issing files")).
-0001cb70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001cb80: 6564 6974 6f72 3a0a 2020 2020 2020 2020  editor:.        
-0001cb90: 2020 2020 2020 2020 6363 7478 2e5f 7465          cctx._te
-0001cba0: 7874 203d 2065 6469 746f 7228 7365 6c66  xt = editor(self
-0001cbb0: 2c20 6363 7478 2c20 7375 6273 290a 2020  , cctx, subs).  
-0001cbc0: 2020 2020 2020 2020 2020 6564 6974 6564            edited
-0001cbd0: 203d 2074 6578 7420 213d 2063 6374 782e   = text != cctx.
-0001cbe0: 5f74 6578 740a 0a20 2020 2020 2020 2020  _text..         
-0001cbf0: 2020 2023 2053 6176 6520 636f 6d6d 6974     # Save commit
-0001cc00: 206d 6573 7361 6765 2069 6e20 6361 7365   message in case
-0001cc10: 2074 6869 7320 7472 616e 7361 6374 696f   this transactio
-0001cc20: 6e20 6765 7473 2072 6f6c 6c65 6420 6261  n gets rolled ba
-0001cc30: 636b 0a20 2020 2020 2020 2020 2020 2023  ck.            #
-0001cc40: 2028 652e 672e 2062 7920 6120 7072 6574   (e.g. by a pret
-0001cc50: 786e 636f 6d6d 6974 2068 6f6f 6b29 2e20  xncommit hook). 
-0001cc60: 204c 6561 7665 2074 6865 2063 6f6e 7465   Leave the conte
-0001cc70: 6e74 2061 6c6f 6e65 206f 6e0a 2020 2020  nt alone on.    
-0001cc80: 2020 2020 2020 2020 2320 7468 6520 6173          # the as
-0001cc90: 7375 6d70 7469 6f6e 2074 6861 7420 7468  sumption that th
-0001cca0: 6520 7573 6572 2077 696c 6c20 7573 6520  e user will use 
-0001ccb0: 7468 6520 7361 6d65 2065 6469 746f 7220  the same editor 
-0001ccc0: 6167 6169 6e2e 0a20 2020 2020 2020 2020  again..         
-0001ccd0: 2020 206d 7367 5f70 6174 6820 3d20 7365     msg_path = se
-0001cce0: 6c66 2e73 6176 6563 6f6d 6d69 746d 6573  lf.savecommitmes
-0001ccf0: 7361 6765 2863 6374 782e 5f74 6578 7429  sage(cctx._text)
-0001cd00: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0001cd10: 636f 6d6d 6974 2073 7562 7320 616e 6420  commit subs and 
-0001cd20: 7772 6974 6520 6e65 7720 7374 6174 650a  write new state.
-0001cd30: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0001cd40: 7562 733a 0a20 2020 2020 2020 2020 2020  ubs:.           
-0001cd50: 2020 2020 2075 6970 6174 6866 6e20 3d20       uipathfn = 
-0001cd60: 7363 6d75 7469 6c2e 6765 7475 6970 6174  scmutil.getuipat
-0001cd70: 6866 6e28 7365 6c66 290a 2020 2020 2020  hfn(self).      
-0001cd80: 2020 2020 2020 2020 2020 666f 7220 7320            for s 
-0001cd90: 696e 2073 6f72 7465 6428 636f 6d6d 6974  in sorted(commit
-0001cda0: 7375 6273 293a 0a20 2020 2020 2020 2020  subs):.         
-0001cdb0: 2020 2020 2020 2020 2020 2073 7562 203d             sub =
-0001cdc0: 2077 6374 782e 7375 6228 7329 0a20 2020   wctx.sub(s).   
-0001cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cde0: 2073 656c 662e 7569 2e73 7461 7475 7328   self.ui.status(
-0001cdf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ce00: 2020 2020 2020 2020 205f 2862 2763 6f6d           _(b'com
-0001ce10: 6d69 7474 696e 6720 7375 6272 6570 6f73  mitting subrepos
-0001ce20: 6974 6f72 7920 2573 5c6e 2729 0a20 2020  itory %s\n').   
-0001ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce40: 2020 2020 2025 2075 6970 6174 6866 6e28       % uipathfn(
-0001ce50: 7375 6272 6570 6f75 7469 6c2e 7375 6272  subrepoutil.subr
-0001ce60: 656c 7061 7468 2873 7562 2929 0a20 2020  elpath(sub)).   
-0001ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce80: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0001ce90: 2020 2020 2020 2073 7220 3d20 7375 622e         sr = sub.
-0001cea0: 636f 6d6d 6974 2863 6374 782e 5f74 6578  commit(cctx._tex
-0001ceb0: 742c 2075 7365 722c 2064 6174 6529 0a20  t, user, date). 
-0001cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ced0: 2020 206e 6577 7374 6174 655b 735d 203d     newstate[s] =
-0001cee0: 2028 6e65 7773 7461 7465 5b73 5d5b 305d   (newstate[s][0]
-0001cef0: 2c20 7372 290a 2020 2020 2020 2020 2020  , sr).          
-0001cf00: 2020 2020 2020 7375 6272 6570 6f75 7469        subrepouti
-0001cf10: 6c2e 7772 6974 6573 7461 7465 2873 656c  l.writestate(sel
-0001cf20: 662c 206e 6577 7374 6174 6529 0a0a 2020  f, newstate)..  
-0001cf30: 2020 2020 2020 2020 2020 7031 2c20 7032            p1, p2
-0001cf40: 203d 2073 656c 662e 6469 7273 7461 7465   = self.dirstate
-0001cf50: 2e70 6172 656e 7473 2829 0a20 2020 2020  .parents().     
-0001cf60: 2020 2020 2020 2068 6f6f 6b70 312c 2068         hookp1, h
-0001cf70: 6f6f 6b70 3220 3d20 6865 7828 7031 292c  ookp2 = hex(p1),
-0001cf80: 2028 7032 2021 3d20 7365 6c66 2e6e 756c   (p2 != self.nul
-0001cf90: 6c69 6420 616e 6420 6865 7828 7032 2920  lid and hex(p2) 
-0001cfa0: 6f72 2062 2727 290a 2020 2020 2020 2020  or b'').        
-0001cfb0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0001cfc0: 2020 2020 2020 2020 2073 656c 662e 686f           self.ho
-0001cfd0: 6f6b 280a 2020 2020 2020 2020 2020 2020  ok(.            
-0001cfe0: 2020 2020 2020 2020 6222 7072 6563 6f6d          b"precom
-0001cff0: 6d69 7422 2c20 7468 726f 773d 5472 7565  mit", throw=True
-0001d000: 2c20 7061 7265 6e74 313d 686f 6f6b 7031  , parent1=hookp1
-0001d010: 2c20 7061 7265 6e74 323d 686f 6f6b 7032  , parent2=hookp2
-0001d020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d030: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0001d040: 2020 2077 6974 6820 7365 6c66 2e74 7261     with self.tra
-0001d050: 6e73 6163 7469 6f6e 2862 2763 6f6d 6d69  nsaction(b'commi
-0001d060: 7427 293a 0a20 2020 2020 2020 2020 2020  t'):.           
-0001d070: 2020 2020 2020 2020 2072 6574 203d 2073           ret = s
-0001d080: 656c 662e 636f 6d6d 6974 6374 7828 6363  elf.commitctx(cc
-0001d090: 7478 2c20 5472 7565 290a 2020 2020 2020  tx, True).      
-0001d0a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001d0b0: 7570 6461 7465 2062 6f6f 6b6d 6172 6b73  update bookmarks
-0001d0c0: 2c20 6469 7273 7461 7465 2061 6e64 206d  , dirstate and m
-0001d0d0: 6572 6765 7374 6174 650a 2020 2020 2020  ergestate.      
-0001d0e0: 2020 2020 2020 2020 2020 2020 2020 626f                bo
-0001d0f0: 6f6b 6d61 726b 732e 7570 6461 7465 2873  okmarks.update(s
-0001d100: 656c 662c 205b 7031 2c20 7032 5d2c 2072  elf, [p1, p2], r
-0001d110: 6574 290a 2020 2020 2020 2020 2020 2020  et).            
-0001d120: 2020 2020 2020 2020 6363 7478 2e6d 6172          cctx.mar
-0001d130: 6b63 6f6d 6d69 7474 6564 2872 6574 290a  kcommitted(ret).
-0001d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d150: 2020 2020 6d73 2e72 6573 6574 2829 0a20      ms.reset(). 
-0001d160: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0001d170: 743a 2020 2320 7265 2d72 6169 7365 730a  t:  # re-raises.
-0001d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d190: 6966 2065 6469 7465 643a 0a20 2020 2020  if edited:.     
-0001d1a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001d1b0: 656c 662e 7569 2e77 7269 7465 280a 2020  elf.ui.write(.  
-0001d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1d0: 2020 2020 2020 5f28 6227 6e6f 7465 3a20        _(b'note: 
-0001d1e0: 636f 6d6d 6974 206d 6573 7361 6765 2073  commit message s
-0001d1f0: 6176 6564 2069 6e20 2573 5c6e 2729 2025  aved in %s\n') %
-0001d200: 206d 7367 5f70 6174 680a 2020 2020 2020   msg_path.      
-0001d210: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0001d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d230: 2020 2020 7365 6c66 2e75 692e 7772 6974      self.ui.writ
-0001d240: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-0001d250: 2020 2020 2020 2020 2020 205f 280a 2020             _(.  
-0001d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d270: 2020 2020 2020 2020 2020 6222 6e6f 7465            b"note
-0001d280: 3a20 7573 6520 2768 6720 636f 6d6d 6974  : use 'hg commit
-0001d290: 202d 2d6c 6f67 6669 6c65 2022 0a20 2020   --logfile ".   
-0001d2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2b0: 2020 2020 2020 2020 2062 2225 7320 2d2d           b"%s --
-0001d2c0: 6564 6974 2720 746f 2072 6575 7365 2069  edit' to reuse i
-0001d2d0: 745c 6e22 0a20 2020 2020 2020 2020 2020  t\n".           
-0001d2e0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0001d2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d300: 2020 2020 2020 2025 206d 7367 5f70 6174         % msg_pat
-0001d310: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
-0001d320: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001d330: 2020 2020 2020 2020 7261 6973 650a 0a20          raise.. 
-0001d340: 2020 2020 2020 2064 6566 2063 6f6d 6d69         def commi
-0001d350: 7468 6f6f 6b28 756e 7573 6564 5f73 7563  thook(unused_suc
-0001d360: 6365 7373 293a 0a20 2020 2020 2020 2020  cess):.         
-0001d370: 2020 2023 2068 6163 6b20 666f 7220 636f     # hack for co
-0001d380: 6d6d 616e 6420 7468 6174 2075 7365 2061  mmand that use a
-0001d390: 2074 656d 706f 7261 7279 2063 6f6d 6d69   temporary commi
-0001d3a0: 7420 2865 673a 2068 6973 7465 6469 7429  t (eg: histedit)
-0001d3b0: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
-0001d3c0: 656d 706f 7261 7279 2063 6f6d 6d69 7420  emporary commit 
-0001d3d0: 676f 7420 7374 7269 7070 6564 2062 6566  got stripped bef
-0001d3e0: 6f72 6520 686f 6f6b 2072 656c 6561 7365  ore hook release
-0001d3f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001d400: 7365 6c66 2e63 6861 6e67 656c 6f67 2e68  self.changelog.h
-0001d410: 6173 6e6f 6465 2872 6574 293a 0a20 2020  asnode(ret):.   
-0001d420: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001d430: 662e 686f 6f6b 280a 2020 2020 2020 2020  f.hook(.        
-0001d440: 2020 2020 2020 2020 2020 2020 6222 636f              b"co
-0001d450: 6d6d 6974 222c 206e 6f64 653d 6865 7828  mmit", node=hex(
-0001d460: 7265 7429 2c20 7061 7265 6e74 313d 686f  ret), parent1=ho
-0001d470: 6f6b 7031 2c20 7061 7265 6e74 323d 686f  okp1, parent2=ho
-0001d480: 6f6b 7032 0a20 2020 2020 2020 2020 2020  okp2.           
-0001d490: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0001d4a0: 7365 6c66 2e5f 6166 7465 726c 6f63 6b28  self._afterlock(
-0001d4b0: 636f 6d6d 6974 686f 6f6b 290a 2020 2020  commithook).    
-0001d4c0: 2020 2020 7265 7475 726e 2072 6574 0a0a      return ret..
-0001d4d0: 2020 2020 4075 6e66 696c 7465 7265 646d      @unfilteredm
-0001d4e0: 6574 686f 640a 2020 2020 6465 6620 636f  ethod.    def co
-0001d4f0: 6d6d 6974 6374 7828 7365 6c66 2c20 6374  mmitctx(self, ct
-0001d500: 782c 2065 7272 6f72 3d46 616c 7365 2c20  x, error=False, 
-0001d510: 6f72 6967 6374 783d 4e6f 6e65 293a 0a20  origctx=None):. 
-0001d520: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-0001d530: 6d6d 6974 2e63 6f6d 6d69 7463 7478 2873  mmit.commitctx(s
-0001d540: 656c 662c 2063 7478 2c20 6572 726f 723d  elf, ctx, error=
-0001d550: 6572 726f 722c 206f 7269 6763 7478 3d6f  error, origctx=o
-0001d560: 7269 6763 7478 290a 0a20 2020 2040 756e  rigctx)..    @un
-0001d570: 6669 6c74 6572 6564 6d65 7468 6f64 0a20  filteredmethod. 
-0001d580: 2020 2064 6566 2064 6573 7472 6f79 696e     def destroyin
-0001d590: 6728 7365 6c66 293a 0a20 2020 2020 2020  g(self):.       
-0001d5a0: 2022 2222 496e 666f 726d 2074 6865 2072   """Inform the r
-0001d5b0: 6570 6f73 6974 6f72 7920 7468 6174 206e  epository that n
-0001d5c0: 6f64 6573 2061 7265 2061 626f 7574 2074  odes are about t
-0001d5d0: 6f20 6265 2064 6573 7472 6f79 6564 2e0a  o be destroyed..
-0001d5e0: 2020 2020 2020 2020 496e 7465 6e64 6564          Intended
-0001d5f0: 2066 6f72 2075 7365 2062 7920 7374 7269   for use by stri
-0001d600: 7020 616e 6420 726f 6c6c 6261 636b 2c20  p and rollback, 
-0001d610: 736f 2074 6865 7265 2773 2061 2063 6f6d  so there's a com
-0001d620: 6d6f 6e0a 2020 2020 2020 2020 706c 6163  mon.        plac
-0001d630: 6520 666f 7220 616e 7974 6869 6e67 2074  e for anything t
-0001d640: 6861 7420 6861 7320 746f 2062 6520 646f  hat has to be do
-0001d650: 6e65 2062 6566 6f72 6520 6465 7374 726f  ne before destro
-0001d660: 7969 6e67 2068 6973 746f 7279 2e0a 0a20  ying history... 
-0001d670: 2020 2020 2020 2054 6869 7320 6973 206d         This is m
-0001d680: 6f73 746c 7920 7573 6566 756c 2066 6f72  ostly useful for
-0001d690: 2073 6176 696e 6720 7374 6174 6520 7468   saving state th
-0001d6a0: 6174 2069 7320 696e 206d 656d 6f72 7920  at is in memory 
-0001d6b0: 616e 6420 7761 6974 696e 670a 2020 2020  and waiting.    
-0001d6c0: 2020 2020 746f 2062 6520 666c 7573 6865      to be flushe
-0001d6d0: 6420 7768 656e 2074 6865 2063 7572 7265  d when the curre
-0001d6e0: 6e74 206c 6f63 6b20 6973 2072 656c 6561  nt lock is relea
-0001d6f0: 7365 642e 2042 6563 6175 7365 2061 2063  sed. Because a c
-0001d700: 616c 6c20 746f 0a20 2020 2020 2020 2064  all to.        d
-0001d710: 6573 7472 6f79 6564 2069 7320 696d 6d69  estroyed is immi
-0001d720: 6e65 6e74 2c20 7468 6520 7265 706f 2077  nent, the repo w
-0001d730: 696c 6c20 6265 2069 6e76 616c 6964 6174  ill be invalidat
-0001d740: 6564 2063 6175 7369 6e67 2074 686f 7365  ed causing those
-0001d750: 0a20 2020 2020 2020 2063 6861 6e67 6573  .        changes
-0001d760: 2074 6f20 7374 6179 2069 6e20 6d65 6d6f   to stay in memo
-0001d770: 7279 2028 7761 6974 696e 6720 666f 7220  ry (waiting for 
-0001d780: 7468 6520 6e65 7874 2075 6e6c 6f63 6b29  the next unlock)
-0001d790: 2c20 6f72 2076 616e 6973 680a 2020 2020  , or vanish.    
-0001d7a0: 2020 2020 636f 6d70 6c65 7465 6c79 2e0a      completely..
-0001d7b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001d7c0: 2020 2020 2320 5768 656e 2075 7369 6e67      # When using
-0001d7d0: 2074 6865 2073 616d 6520 6c6f 636b 2074   the same lock t
-0001d7e0: 6f20 636f 6d6d 6974 2061 6e64 2073 7472  o commit and str
-0001d7f0: 6970 2c20 7468 6520 7068 6173 6563 6163  ip, the phasecac
-0001d800: 6865 2069 7320 6c65 6674 0a20 2020 2020  he is left.     
-0001d810: 2020 2023 2064 6972 7479 2061 6674 6572     # dirty after
-0001d820: 2063 6f6d 6d69 7474 696e 672e 2054 6865   committing. The
-0001d830: 6e20 7768 656e 2077 6520 7374 7269 702c  n when we strip,
-0001d840: 2074 6865 2072 6570 6f20 6973 2069 6e76   the repo is inv
-0001d850: 616c 6964 6174 6564 2c0a 2020 2020 2020  alidated,.      
-0001d860: 2020 2320 6361 7573 696e 6720 7468 6f73    # causing thos
-0001d870: 6520 6368 616e 6765 7320 746f 2064 6973  e changes to dis
-0001d880: 6170 7065 6172 2e0a 2020 2020 2020 2020  appear..        
-0001d890: 6966 2027 5f70 6861 7365 6361 6368 6527  if '_phasecache'
-0001d8a0: 2069 6e20 7661 7273 2873 656c 6629 3a0a   in vars(self):.
-0001d8b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001d8c0: 2e5f 7068 6173 6563 6163 6865 2e77 7269  ._phasecache.wri
-0001d8d0: 7465 2829 0a0a 2020 2020 4075 6e66 696c  te()..    @unfil
-0001d8e0: 7465 7265 646d 6574 686f 640a 2020 2020  teredmethod.    
-0001d8f0: 6465 6620 6465 7374 726f 7965 6428 7365  def destroyed(se
-0001d900: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0001d910: 496e 666f 726d 2074 6865 2072 6570 6f73  Inform the repos
-0001d920: 6974 6f72 7920 7468 6174 206e 6f64 6573  itory that nodes
-0001d930: 2068 6176 6520 6265 656e 2064 6573 7472   have been destr
-0001d940: 6f79 6564 2e0a 2020 2020 2020 2020 496e  oyed..        In
-0001d950: 7465 6e64 6564 2066 6f72 2075 7365 2062  tended for use b
-0001d960: 7920 7374 7269 7020 616e 6420 726f 6c6c  y strip and roll
-0001d970: 6261 636b 2c20 736f 2074 6865 7265 2773  back, so there's
-0001d980: 2061 2063 6f6d 6d6f 6e0a 2020 2020 2020   a common.      
-0001d990: 2020 706c 6163 6520 666f 7220 616e 7974    place for anyt
-0001d9a0: 6869 6e67 2074 6861 7420 6861 7320 746f  hing that has to
-0001d9b0: 2062 6520 646f 6e65 2061 6674 6572 2064   be done after d
-0001d9c0: 6573 7472 6f79 696e 6720 6869 7374 6f72  estroying histor
-0001d9d0: 792e 0a20 2020 2020 2020 2022 2222 0a20  y..        """. 
-0001d9e0: 2020 2020 2020 2023 2057 6865 6e20 6f6e         # When on
-0001d9f0: 6520 7472 6965 7320 746f 3a0a 2020 2020  e tries to:.    
-0001da00: 2020 2020 2320 3129 2064 6573 7472 6f79      # 1) destroy
-0001da10: 206e 6f64 6573 2074 6875 7320 6361 6c6c   nodes thus call
-0001da20: 696e 6720 7468 6973 206d 6574 686f 6420  ing this method 
-0001da30: 2865 2e67 2e20 7374 7269 7029 0a20 2020  (e.g. strip).   
-0001da40: 2020 2020 2023 2032 2920 7573 6520 7068       # 2) use ph
-0001da50: 6173 6563 6163 6865 2073 6f6d 6577 6865  asecache somewhe
-0001da60: 7265 2028 652e 672e 2063 6f6d 6d69 7429  re (e.g. commit)
-0001da70: 0a20 2020 2020 2020 2023 0a20 2020 2020  .        #.     
-0001da80: 2020 2023 2074 6865 6e20 3229 2077 696c     # then 2) wil
-0001da90: 6c20 6661 696c 2062 6563 6175 7365 2074  l fail because t
-0001daa0: 6865 2070 6861 7365 6361 6368 6520 636f  he phasecache co
-0001dab0: 6e74 6169 6e73 206e 6f64 6573 2074 6861  ntains nodes tha
-0001dac0: 7420 7765 7265 0a20 2020 2020 2020 2023  t were.        #
-0001dad0: 2072 656d 6f76 6564 2e20 5765 2063 616e   removed. We can
-0001dae0: 2065 6974 6865 7220 7265 6d6f 7665 2070   either remove p
-0001daf0: 6861 7365 6361 6368 6520 6672 6f6d 2074  hasecache from t
-0001db00: 6865 2066 696c 6563 6163 6865 2c0a 2020  he filecache,.  
-0001db10: 2020 2020 2020 2320 6361 7573 696e 6720        # causing 
-0001db20: 6974 2074 6f20 7265 6c6f 6164 206e 6578  it to reload nex
-0001db30: 7420 7469 6d65 2069 7420 6973 2061 6363  t time it is acc
-0001db40: 6573 7365 642c 206f 7220 7369 6d70 6c79  essed, or simply
-0001db50: 2066 696c 7465 720a 2020 2020 2020 2020   filter.        
-0001db60: 2320 7468 6520 7265 6d6f 7665 6420 6e6f  # the removed no
-0001db70: 6465 7320 6e6f 7720 616e 6420 7772 6974  des now and writ
-0001db80: 6520 7468 6520 7570 6461 7465 6420 6361  e the updated ca
-0001db90: 6368 652e 0a20 2020 2020 2020 2073 656c  che..        sel
-0001dba0: 662e 5f70 6861 7365 6361 6368 652e 6669  f._phasecache.fi
-0001dbb0: 6c74 6572 756e 6b6e 6f77 6e28 7365 6c66  lterunknown(self
-0001dbc0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-0001dbd0: 7068 6173 6563 6163 6865 2e77 7269 7465  phasecache.write
-0001dbe0: 2829 0a0a 2020 2020 2020 2020 2320 7265  ()..        # re
-0001dbf0: 6672 6573 6820 616c 6c20 7265 706f 7369  fresh all reposi
-0001dc00: 746f 7279 2063 6163 6865 730a 2020 2020  tory caches.    
-0001dc10: 2020 2020 7365 6c66 2e75 7064 6174 6563      self.updatec
-0001dc20: 6163 6865 7328 290a 0a20 2020 2020 2020  aches()..       
-0001dc30: 2023 2045 6e73 7572 6520 7468 6520 7065   # Ensure the pe
-0001dc40: 7273 6973 7465 6e74 2074 6167 2063 6163  rsistent tag cac
-0001dc50: 6865 2069 7320 7570 6461 7465 642e 2020  he is updated.  
-0001dc60: 446f 696e 6720 6974 206e 6f77 0a20 2020  Doing it now.   
-0001dc70: 2020 2020 2023 206d 6561 6e73 2074 6861       # means tha
-0001dc80: 7420 7468 6520 7461 6720 6361 6368 6520  t the tag cache 
-0001dc90: 6f6e 6c79 2068 6173 2074 6f20 776f 7272  only has to worr
-0001dca0: 7920 6162 6f75 7420 6465 7374 726f 7965  y about destroye
-0001dcb0: 640a 2020 2020 2020 2020 2320 6865 6164  d.        # head
-0001dcc0: 7320 696d 6d65 6469 6174 656c 7920 6166  s immediately af
-0001dcd0: 7465 7220 6120 7374 7269 702f 726f 6c6c  ter a strip/roll
-0001dce0: 6261 636b 2e20 2054 6861 7420 696e 2074  back.  That in t
-0001dcf0: 7572 6e0a 2020 2020 2020 2020 2320 6775  urn.        # gu
-0001dd00: 6172 616e 7465 6573 2074 6861 7420 2263  arantees that "c
-0001dd10: 6163 6865 7469 7020 3d3d 2063 7572 7265  achetip == curre
-0001dd20: 6e74 7469 7022 2028 636f 6d70 6172 696e  nttip" (comparin
-0001dd30: 6720 626f 7468 2072 6576 0a20 2020 2020  g both rev.     
-0001dd40: 2020 2023 2061 6e64 206e 6f64 6529 2061     # and node) a
-0001dd50: 6c77 6179 7320 6d65 616e 7320 6e6f 206e  lways means no n
-0001dd60: 6f64 6573 2068 6176 6520 6265 656e 2061  odes have been a
-0001dd70: 6464 6564 206f 7220 6465 7374 726f 7965  dded or destroye
-0001dd80: 642e 0a0a 2020 2020 2020 2020 2320 5858  d...        # XX
-0001dd90: 5820 7468 6973 2069 7320 7375 626f 7074  X this is subopt
-0001dda0: 696d 616c 2077 6865 6e20 7172 6566 7265  imal when qrefre
-0001ddb0: 7368 2769 6e67 3a20 7765 2073 7472 6970  sh'ing: we strip
-0001ddc0: 2074 6865 2063 7572 7265 6e74 0a20 2020   the current.   
-0001ddd0: 2020 2020 2023 2068 6561 642c 2072 6566       # head, ref
-0001dde0: 7265 7368 2074 6865 2074 6167 2063 6163  resh the tag cac
-0001ddf0: 6865 2c20 7468 656e 2069 6d6d 6564 6961  he, then immedia
-0001de00: 7465 6c79 2061 6464 2061 206e 6577 2068  tely add a new h
-0001de10: 6561 642e 0a20 2020 2020 2020 2023 2042  ead..        # B
-0001de20: 7574 2049 2074 6869 6e6b 2064 6f69 6e67  ut I think doing
-0001de30: 2069 7420 7468 6973 2077 6179 2069 7320   it this way is 
-0001de40: 6e65 6365 7373 6172 7920 666f 7220 7468  necessary for th
-0001de50: 6520 2269 6e73 7461 6e74 0a20 2020 2020  e "instant.     
-0001de60: 2020 2023 2074 6167 2063 6163 6865 2072     # tag cache r
-0001de70: 6574 7269 6576 616c 2220 6361 7365 2074  etrieval" case t
-0001de80: 6f20 776f 726b 2e0a 2020 2020 2020 2020  o work..        
-0001de90: 7365 6c66 2e69 6e76 616c 6964 6174 6528  self.invalidate(
-0001dea0: 290a 0a20 2020 2064 6566 2073 7461 7475  )..    def statu
-0001deb0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-0001dec0: 0a20 2020 2020 2020 206e 6f64 6531 3d62  .        node1=b
-0001ded0: 272e 272c 0a20 2020 2020 2020 206e 6f64  '.',.        nod
-0001dee0: 6532 3d4e 6f6e 652c 0a20 2020 2020 2020  e2=None,.       
-0001def0: 206d 6174 6368 3d4e 6f6e 652c 0a20 2020   match=None,.   
-0001df00: 2020 2020 2069 676e 6f72 6564 3d46 616c       ignored=Fal
-0001df10: 7365 2c0a 2020 2020 2020 2020 636c 6561  se,.        clea
-0001df20: 6e3d 4661 6c73 652c 0a20 2020 2020 2020  n=False,.       
-0001df30: 2075 6e6b 6e6f 776e 3d46 616c 7365 2c0a   unknown=False,.
-0001df40: 2020 2020 2020 2020 6c69 7374 7375 6272          listsubr
-0001df50: 6570 6f73 3d46 616c 7365 2c0a 2020 2020  epos=False,.    
-0001df60: 293a 0a20 2020 2020 2020 2027 2727 6120  ):.        '''a 
-0001df70: 636f 6e76 656e 6965 6e63 6520 6d65 7468  convenience meth
-0001df80: 6f64 2074 6861 7420 6361 6c6c 7320 6e6f  od that calls no
-0001df90: 6465 312e 7374 6174 7573 286e 6f64 6532  de1.status(node2
-0001dfa0: 2927 2727 0a20 2020 2020 2020 2072 6574  )'''.        ret
-0001dfb0: 7572 6e20 7365 6c66 5b6e 6f64 6531 5d2e  urn self[node1].
-0001dfc0: 7374 6174 7573 280a 2020 2020 2020 2020  status(.        
-0001dfd0: 2020 2020 6e6f 6465 322c 206d 6174 6368      node2, match
-0001dfe0: 2c20 6967 6e6f 7265 642c 2063 6c65 616e  , ignored, clean
-0001dff0: 2c20 756e 6b6e 6f77 6e2c 206c 6973 7473  , unknown, lists
-0001e000: 7562 7265 706f 730a 2020 2020 2020 2020  ubrepos.        
-0001e010: 290a 0a20 2020 2064 6566 2061 6464 706f  )..    def addpo
-0001e020: 7374 6473 7374 6174 7573 2873 656c 662c  stdsstatus(self,
-0001e030: 2070 7329 3a0a 2020 2020 2020 2020 2222   ps):.        ""
-0001e040: 2241 6464 2061 2063 616c 6c62 6163 6b20  "Add a callback 
-0001e050: 746f 2072 756e 2077 6974 6869 6e20 7468  to run within th
-0001e060: 6520 776c 6f63 6b2c 2061 7420 7468 6520  e wlock, at the 
-0001e070: 706f 696e 7420 6174 2077 6869 6368 2073  point at which s
-0001e080: 7461 7475 730a 2020 2020 2020 2020 6669  tatus.        fi
-0001e090: 7875 7073 2068 6170 7065 6e2e 0a0a 2020  xups happen...  
-0001e0a0: 2020 2020 2020 4f6e 2073 7461 7475 7320        On status 
-0001e0b0: 636f 6d70 6c65 7469 6f6e 2c20 6361 6c6c  completion, call
-0001e0c0: 6261 636b 2877 6374 782c 2073 7461 7475  back(wctx, statu
-0001e0d0: 7329 2077 696c 6c20 6265 2063 616c 6c65  s) will be calle
-0001e0e0: 6420 7769 7468 2074 6865 0a20 2020 2020  d with the.     
-0001e0f0: 2020 2077 6c6f 636b 2068 656c 642c 2075     wlock held, u
-0001e100: 6e6c 6573 7320 7468 6520 6469 7273 7461  nless the dirsta
-0001e110: 7465 2068 6173 2063 6861 6e67 6564 2066  te has changed f
-0001e120: 726f 6d20 756e 6465 726e 6561 7468 206f  rom underneath o
-0001e130: 7220 7468 6520 776c 6f63 6b0a 2020 2020  r the wlock.    
-0001e140: 2020 2020 636f 756c 646e 2774 2062 6520      couldn't be 
-0001e150: 6772 6162 6265 642e 0a0a 2020 2020 2020  grabbed...      
-0001e160: 2020 4361 6c6c 6261 636b 7320 7368 6f75    Callbacks shou
-0001e170: 6c64 206e 6f74 2063 6170 7475 7265 2061  ld not capture a
-0001e180: 6e64 2075 7365 2061 2063 6163 6865 6420  nd use a cached 
-0001e190: 636f 7079 206f 6620 7468 6520 6469 7273  copy of the dirs
-0001e1a0: 7461 7465 202d 2d0a 2020 2020 2020 2020  tate --.        
-0001e1b0: 6974 206d 6967 6874 2063 6861 6e67 6520  it might change 
-0001e1c0: 696e 2074 6865 206d 6561 6e77 6869 6c65  in the meanwhile
-0001e1d0: 2e20 496e 7374 6561 642c 2074 6865 7920  . Instead, they 
-0001e1e0: 7368 6f75 6c64 2061 6363 6573 7320 7468  should access th
-0001e1f0: 650a 2020 2020 2020 2020 6469 7273 7461  e.        dirsta
-0001e200: 7465 2076 6961 2077 6374 782e 7265 706f  te via wctx.repo
-0001e210: 2829 2e64 6972 7374 6174 652e 0a0a 2020  ().dirstate...  
-0001e220: 2020 2020 2020 5468 6973 206c 6973 7420        This list 
-0001e230: 6973 2065 6d70 7469 6564 206f 7574 2061  is emptied out a
-0001e240: 6674 6572 2065 6163 6820 7374 6174 7573  fter each status
-0001e250: 2072 756e 202d 2d20 6578 7465 6e73 696f   run -- extensio
-0001e260: 6e73 2073 686f 756c 640a 2020 2020 2020  ns should.      
-0001e270: 2020 6d61 6b65 2073 7572 6520 6974 2061    make sure it a
-0001e280: 6464 7320 746f 2074 6869 7320 6c69 7374  dds to this list
-0001e290: 2065 6163 6820 7469 6d65 2064 6972 7374   each time dirst
-0001e2a0: 6174 652e 7374 6174 7573 2069 7320 6361  ate.status is ca
-0001e2b0: 6c6c 6564 2e0a 2020 2020 2020 2020 4578  lled..        Ex
-0001e2c0: 7465 6e73 696f 6e73 2073 686f 756c 6420  tensions should 
-0001e2d0: 616c 736f 206d 616b 6520 7375 7265 2074  also make sure t
-0001e2e0: 6865 7920 646f 6e27 7420 6361 6c6c 2074  hey don't call t
-0001e2f0: 6869 7320 666f 7220 7374 6174 7573 6573  his for statuses
-0001e300: 0a20 2020 2020 2020 2074 6861 7420 646f  .        that do
-0001e310: 6e27 7420 696e 766f 6c76 6520 7468 6520  n't involve the 
-0001e320: 6469 7273 7461 7465 2e0a 2020 2020 2020  dirstate..      
-0001e330: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
-0001e340: 2054 6865 206c 6973 7420 6973 206c 6f63   The list is loc
-0001e350: 6174 6564 2068 6572 6520 666f 7220 756e  ated here for un
-0001e360: 6971 7565 6e65 7373 2072 6561 736f 6e73  iqueness reasons
-0001e370: 202d 2d20 6974 2069 7320 6163 7475 616c   -- it is actual
-0001e380: 6c79 0a20 2020 2020 2020 2023 206d 616e  ly.        # man
-0001e390: 6167 6564 2062 7920 7468 6520 776f 726b  aged by the work
-0001e3a0: 696e 6763 7478 2c20 6275 7420 7468 6174  ingctx, but that
-0001e3b0: 2069 736e 2774 2075 6e69 7175 6520 7065   isn't unique pe
-0001e3c0: 722d 7265 706f 2e0a 2020 2020 2020 2020  r-repo..        
-0001e3d0: 7365 6c66 2e5f 706f 7374 6473 7374 6174  self._postdsstat
-0001e3e0: 7573 2e61 7070 656e 6428 7073 290a 0a20  us.append(ps).. 
-0001e3f0: 2020 2064 6566 2070 6f73 7464 7373 7461     def postdssta
-0001e400: 7475 7328 7365 6c66 293a 0a20 2020 2020  tus(self):.     
-0001e410: 2020 2022 2222 5573 6564 2062 7920 776f     """Used by wo
-0001e420: 726b 696e 6763 7478 2074 6f20 6765 7420  rkingctx to get 
-0001e430: 7468 6520 6c69 7374 206f 6620 706f 7374  the list of post
-0001e440: 2d64 6972 7374 6174 652d 7374 6174 7573  -dirstate-status
-0001e450: 2068 6f6f 6b73 2e22 2222 0a20 2020 2020   hooks.""".     
-0001e460: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0001e470: 706f 7374 6473 7374 6174 7573 0a0a 2020  postdsstatus..  
-0001e480: 2020 6465 6620 636c 6561 7270 6f73 7464    def clearpostd
-0001e490: 7373 7461 7475 7328 7365 6c66 293a 0a20  sstatus(self):. 
-0001e4a0: 2020 2020 2020 2022 2222 5573 6564 2062         """Used b
-0001e4b0: 7920 776f 726b 696e 6763 7478 2074 6f20  y workingctx to 
-0001e4c0: 636c 6561 7220 706f 7374 2d64 6972 7374  clear post-dirst
-0001e4d0: 6174 652d 7374 6174 7573 2068 6f6f 6b73  ate-status hooks
-0001e4e0: 2e22 2222 0a20 2020 2020 2020 2064 656c  .""".        del
-0001e4f0: 2073 656c 662e 5f70 6f73 7464 7373 7461   self._postdssta
-0001e500: 7475 735b 3a5d 0a0a 2020 2020 6465 6620  tus[:]..    def 
-0001e510: 6865 6164 7328 7365 6c66 2c20 7374 6172  heads(self, star
-0001e520: 743d 4e6f 6e65 293a 0a20 2020 2020 2020  t=None):.       
-0001e530: 2069 6620 7374 6172 7420 6973 204e 6f6e   if start is Non
-0001e540: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-0001e550: 6c20 3d20 7365 6c66 2e63 6861 6e67 656c  l = self.changel
-0001e560: 6f67 0a20 2020 2020 2020 2020 2020 2068  og.            h
-0001e570: 6561 6472 6576 7320 3d20 7265 7665 7273  eadrevs = revers
-0001e580: 6564 2863 6c2e 6865 6164 7265 7673 2829  ed(cl.headrevs()
-0001e590: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0001e5a0: 7475 726e 205b 636c 2e6e 6f64 6528 7265  turn [cl.node(re
-0001e5b0: 7629 2066 6f72 2072 6576 2069 6e20 6865  v) for rev in he
-0001e5c0: 6164 7265 7673 5d0a 0a20 2020 2020 2020  adrevs]..       
-0001e5d0: 2068 6561 6473 203d 2073 656c 662e 6368   heads = self.ch
-0001e5e0: 616e 6765 6c6f 672e 6865 6164 7328 7374  angelog.heads(st
-0001e5f0: 6172 7429 0a20 2020 2020 2020 2023 2073  art).        # s
-0001e600: 6f72 7420 7468 6520 6f75 7470 7574 2069  ort the output i
-0001e610: 6e20 7265 7620 6465 7363 656e 6469 6e67  n rev descending
-0001e620: 206f 7264 6572 0a20 2020 2020 2020 2072   order.        r
-0001e630: 6574 7572 6e20 736f 7274 6564 2868 6561  eturn sorted(hea
-0001e640: 6473 2c20 6b65 793d 7365 6c66 2e63 6861  ds, key=self.cha
-0001e650: 6e67 656c 6f67 2e72 6576 2c20 7265 7665  ngelog.rev, reve
-0001e660: 7273 653d 5472 7565 290a 0a20 2020 2064  rse=True)..    d
-0001e670: 6566 2062 7261 6e63 6868 6561 6473 2873  ef branchheads(s
-0001e680: 656c 662c 2062 7261 6e63 683d 4e6f 6e65  elf, branch=None
-0001e690: 2c20 7374 6172 743d 4e6f 6e65 2c20 636c  , start=None, cl
-0001e6a0: 6f73 6564 3d46 616c 7365 293a 0a20 2020  osed=False):.   
-0001e6b0: 2020 2020 2022 2222 7265 7475 726e 2061       """return a
-0001e6c0: 2028 706f 7373 6962 6c79 2066 696c 7465   (possibly filte
-0001e6d0: 7265 6429 206c 6973 7420 6f66 2068 6561  red) list of hea
-0001e6e0: 6473 2066 6f72 2074 6865 2067 6976 656e  ds for the given
-0001e6f0: 2062 7261 6e63 680a 0a20 2020 2020 2020   branch..       
-0001e700: 2048 6561 6473 2061 7265 2072 6574 7572   Heads are retur
-0001e710: 6e65 6420 696e 2074 6f70 6f6c 6f67 6963  ned in topologic
-0001e720: 616c 206f 7264 6572 2c20 6672 6f6d 206e  al order, from n
-0001e730: 6577 6573 7420 746f 206f 6c64 6573 742e  ewest to oldest.
-0001e740: 0a20 2020 2020 2020 2049 6620 6272 616e  .        If bran
-0001e750: 6368 2069 7320 4e6f 6e65 2c20 7573 6520  ch is None, use 
-0001e760: 7468 6520 6469 7273 7461 7465 2062 7261  the dirstate bra
-0001e770: 6e63 682e 0a20 2020 2020 2020 2049 6620  nch..        If 
-0001e780: 7374 6172 7420 6973 206e 6f74 204e 6f6e  start is not Non
-0001e790: 652c 2072 6574 7572 6e20 6f6e 6c79 2068  e, return only h
-0001e7a0: 6561 6473 2072 6561 6368 6162 6c65 2066  eads reachable f
-0001e7b0: 726f 6d20 7374 6172 742e 0a20 2020 2020  rom start..     
-0001e7c0: 2020 2049 6620 636c 6f73 6564 2069 7320     If closed is 
-0001e7d0: 5472 7565 2c20 7265 7475 726e 2068 6561  True, return hea
-0001e7e0: 6473 2074 6861 7420 6172 6520 6d61 726b  ds that are mark
-0001e7f0: 6564 2061 7320 636c 6f73 6564 2061 7320  ed as closed as 
-0001e800: 7765 6c6c 2e0a 2020 2020 2020 2020 2222  well..        ""
-0001e810: 220a 2020 2020 2020 2020 6966 2062 7261  ".        if bra
-0001e820: 6e63 6820 6973 204e 6f6e 653a 0a20 2020  nch is None:.   
-0001e830: 2020 2020 2020 2020 2062 7261 6e63 6820           branch 
-0001e840: 3d20 7365 6c66 5b4e 6f6e 655d 2e62 7261  = self[None].bra
-0001e850: 6e63 6828 290a 2020 2020 2020 2020 6272  nch().        br
-0001e860: 616e 6368 6573 203d 2073 656c 662e 6272  anches = self.br
-0001e870: 616e 6368 6d61 7028 290a 2020 2020 2020  anchmap().      
-0001e880: 2020 6966 206e 6f74 2062 7261 6e63 6865    if not branche
-0001e890: 732e 6861 7362 7261 6e63 6828 6272 616e  s.hasbranch(bran
-0001e8a0: 6368 293a 0a20 2020 2020 2020 2020 2020  ch):.           
-0001e8b0: 2072 6574 7572 6e20 5b5d 0a20 2020 2020   return [].     
-0001e8c0: 2020 2023 2074 6865 2063 6163 6865 2072     # the cache r
-0001e8d0: 6574 7572 6e73 2068 6561 6473 206f 7264  eturns heads ord
-0001e8e0: 6572 6564 206c 6f77 6573 7420 746f 2068  ered lowest to h
-0001e8f0: 6967 6865 7374 0a20 2020 2020 2020 2062  ighest.        b
-0001e900: 6865 6164 7320 3d20 6c69 7374 2872 6576  heads = list(rev
-0001e910: 6572 7365 6428 6272 616e 6368 6573 2e62  ersed(branches.b
-0001e920: 7261 6e63 6868 6561 6473 2862 7261 6e63  ranchheads(branc
-0001e930: 682c 2063 6c6f 7365 643d 636c 6f73 6564  h, closed=closed
-0001e940: 2929 290a 2020 2020 2020 2020 6966 2073  ))).        if s
-0001e950: 7461 7274 2069 7320 6e6f 7420 4e6f 6e65  tart is not None
-0001e960: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0001e970: 6669 6c74 6572 206f 7574 2074 6865 2068  filter out the h
-0001e980: 6561 6473 2074 6861 7420 6361 6e6e 6f74  eads that cannot
-0001e990: 2062 6520 7265 6163 6865 6420 6672 6f6d   be reached from
-0001e9a0: 2073 7461 7274 7265 760a 2020 2020 2020   startrev.      
-0001e9b0: 2020 2020 2020 6662 6865 6164 7320 3d20        fbheads = 
-0001e9c0: 7365 7428 7365 6c66 2e63 6861 6e67 656c  set(self.changel
-0001e9d0: 6f67 2e6e 6f64 6573 6265 7477 6565 6e28  og.nodesbetween(
-0001e9e0: 5b73 7461 7274 5d2c 2062 6865 6164 7329  [start], bheads)
-0001e9f0: 5b32 5d29 0a20 2020 2020 2020 2020 2020  [2]).           
-0001ea00: 2062 6865 6164 7320 3d20 5b68 2066 6f72   bheads = [h for
-0001ea10: 2068 2069 6e20 6268 6561 6473 2069 6620   h in bheads if 
-0001ea20: 6820 696e 2066 6268 6561 6473 5d0a 2020  h in fbheads].  
-0001ea30: 2020 2020 2020 7265 7475 726e 2062 6865        return bhe
-0001ea40: 6164 730a 0a20 2020 2064 6566 2062 7261  ads..    def bra
-0001ea50: 6e63 6865 7328 7365 6c66 2c20 6e6f 6465  nches(self, node
-0001ea60: 7329 3a0a 2020 2020 2020 2020 6966 206e  s):.        if n
-0001ea70: 6f74 206e 6f64 6573 3a0a 2020 2020 2020  ot nodes:.      
-0001ea80: 2020 2020 2020 6e6f 6465 7320 3d20 5b73        nodes = [s
-0001ea90: 656c 662e 6368 616e 6765 6c6f 672e 7469  elf.changelog.ti
-0001eaa0: 7028 295d 0a20 2020 2020 2020 2062 203d  p()].        b =
-0001eab0: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
-0001eac0: 6e20 696e 206e 6f64 6573 3a0a 2020 2020  n in nodes:.    
-0001ead0: 2020 2020 2020 2020 7420 3d20 6e0a 2020          t = n.  
-0001eae0: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-0001eaf0: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
-0001eb00: 2020 2020 2020 7020 3d20 7365 6c66 2e63        p = self.c
-0001eb10: 6861 6e67 656c 6f67 2e70 6172 656e 7473  hangelog.parents
-0001eb20: 286e 290a 2020 2020 2020 2020 2020 2020  (n).            
-0001eb30: 2020 2020 6966 2070 5b31 5d20 213d 2073      if p[1] != s
-0001eb40: 656c 662e 6e75 6c6c 6964 206f 7220 705b  elf.nullid or p[
-0001eb50: 305d 203d 3d20 7365 6c66 2e6e 756c 6c69  0] == self.nulli
-0001eb60: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-0001eb70: 2020 2020 2020 2062 2e61 7070 656e 6428         b.append(
-0001eb80: 2874 2c20 6e2c 2070 5b30 5d2c 2070 5b31  (t, n, p[0], p[1
-0001eb90: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-0001eba0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0001ebb0: 2020 2020 2020 2020 2020 2020 2020 6e20                n 
-0001ebc0: 3d20 705b 305d 0a20 2020 2020 2020 2072  = p[0].        r
-0001ebd0: 6574 7572 6e20 620a 0a20 2020 2064 6566  eturn b..    def
-0001ebe0: 2062 6574 7765 656e 2873 656c 662c 2070   between(self, p
-0001ebf0: 6169 7273 293a 0a20 2020 2020 2020 2072  airs):.        r
-0001ec00: 203d 205b 5d0a 0a20 2020 2020 2020 2066   = []..        f
-0001ec10: 6f72 2074 6f70 2c20 626f 7474 6f6d 2069  or top, bottom i
-0001ec20: 6e20 7061 6972 733a 0a20 2020 2020 2020  n pairs:.       
-0001ec30: 2020 2020 206e 2c20 6c2c 2069 203d 2074       n, l, i = t
-0001ec40: 6f70 2c20 5b5d 2c20 300a 2020 2020 2020  op, [], 0.      
-0001ec50: 2020 2020 2020 6620 3d20 310a 0a20 2020        f = 1..   
-0001ec60: 2020 2020 2020 2020 2077 6869 6c65 206e           while n
-0001ec70: 2021 3d20 626f 7474 6f6d 2061 6e64 206e   != bottom and n
-0001ec80: 2021 3d20 7365 6c66 2e6e 756c 6c69 643a   != self.nullid:
-0001ec90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001eca0: 2070 203d 2073 656c 662e 6368 616e 6765   p = self.change
-0001ecb0: 6c6f 672e 7061 7265 6e74 7328 6e29 5b30  log.parents(n)[0
-0001ecc0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001ecd0: 2020 6966 2069 203d 3d20 663a 0a20 2020    if i == f:.   
-0001ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ecf0: 206c 2e61 7070 656e 6428 6e29 0a20 2020   l.append(n).   
-0001ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed10: 2066 203d 2066 202a 2032 0a20 2020 2020   f = f * 2.     
-0001ed20: 2020 2020 2020 2020 2020 206e 203d 2070             n = p
-0001ed30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ed40: 2069 202b 3d20 310a 0a20 2020 2020 2020   i += 1..       
-0001ed50: 2020 2020 2072 2e61 7070 656e 6428 6c29       r.append(l)
-0001ed60: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0001ed70: 2072 0a0a 2020 2020 6465 6620 6368 6563   r..    def chec
-0001ed80: 6b70 7573 6828 7365 6c66 2c20 7075 7368  kpush(self, push
-0001ed90: 6f70 293a 0a20 2020 2020 2020 2022 2222  op):.        """
-0001eda0: 4578 7465 6e73 696f 6e73 2063 616e 206f  Extensions can o
-0001edb0: 7665 7272 6964 6520 7468 6973 2066 756e  verride this fun
-0001edc0: 6374 696f 6e20 6966 2061 6464 6974 696f  ction if additio
-0001edd0: 6e61 6c20 6368 6563 6b73 2068 6176 650a  nal checks have.
-0001ede0: 2020 2020 2020 2020 746f 2062 6520 7065          to be pe
-0001edf0: 7266 6f72 6d65 6420 6265 666f 7265 2070  rformed before p
-0001ee00: 7573 6869 6e67 2c20 6f72 2063 616c 6c20  ushing, or call 
-0001ee10: 6974 2069 6620 7468 6579 206f 7665 7272  it if they overr
-0001ee20: 6964 6520 7075 7368 0a20 2020 2020 2020  ide push.       
-0001ee30: 2063 6f6d 6d61 6e64 2e0a 2020 2020 2020   command..      
-0001ee40: 2020 2222 220a 0a20 2020 2040 756e 6669    """..    @unfi
-0001ee50: 6c74 6572 6564 7072 6f70 6572 7479 6361  lteredpropertyca
-0001ee60: 6368 650a 2020 2020 6465 6620 7072 6570  che.    def prep
-0001ee70: 7573 686f 7574 676f 696e 6768 6f6f 6b73  ushoutgoinghooks
-0001ee80: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001ee90: 2222 2252 6574 7572 6e20 7574 696c 2e68  """Return util.h
-0001eea0: 6f6f 6b73 2063 6f6e 7369 7374 7320 6f66  ooks consists of
-0001eeb0: 2061 2070 7573 686f 7020 7769 7468 2072   a pushop with r
-0001eec0: 6570 6f2c 2072 656d 6f74 652c 206f 7574  epo, remote, out
-0001eed0: 676f 696e 670a 2020 2020 2020 2020 6d65  going.        me
-0001eee0: 7468 6f64 732c 2077 6869 6368 2061 7265  thods, which are
-0001eef0: 2063 616c 6c65 6420 6265 666f 7265 2070   called before p
-0001ef00: 7573 6869 6e67 2063 6861 6e67 6573 6574  ushing changeset
-0001ef10: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
-0001ef20: 2020 2020 2020 2072 6574 7572 6e20 7574         return ut
-0001ef30: 696c 2e68 6f6f 6b73 2829 0a0a 2020 2020  il.hooks()..    
-0001ef40: 6465 6620 7075 7368 6b65 7928 7365 6c66  def pushkey(self
-0001ef50: 2c20 6e61 6d65 7370 6163 652c 206b 6579  , namespace, key
-0001ef60: 2c20 6f6c 642c 206e 6577 293a 0a20 2020  , old, new):.   
-0001ef70: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0001ef80: 2020 2020 2020 7472 203d 2073 656c 662e        tr = self.
-0001ef90: 6375 7272 656e 7474 7261 6e73 6163 7469  currenttransacti
-0001efa0: 6f6e 2829 0a20 2020 2020 2020 2020 2020  on().           
-0001efb0: 2068 6f6f 6b61 7267 7320 3d20 7b7d 0a20   hookargs = {}. 
-0001efc0: 2020 2020 2020 2020 2020 2069 6620 7472             if tr
-0001efd0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0001efe0: 2020 2020 2020 2020 2020 2020 2020 686f                ho
-0001eff0: 6f6b 6172 6773 2e75 7064 6174 6528 7472  okargs.update(tr
-0001f000: 2e68 6f6f 6b61 7267 7329 0a20 2020 2020  .hookargs).     
-0001f010: 2020 2020 2020 2068 6f6f 6b61 7267 7320         hookargs 
-0001f020: 3d20 7079 636f 6d70 6174 2e73 7472 6b77  = pycompat.strkw
-0001f030: 6172 6773 2868 6f6f 6b61 7267 7329 0a20  args(hookargs). 
-0001f040: 2020 2020 2020 2020 2020 2068 6f6f 6b61             hooka
-0001f050: 7267 735b 276e 616d 6573 7061 6365 275d  rgs['namespace']
-0001f060: 203d 206e 616d 6573 7061 6365 0a20 2020   = namespace.   
-0001f070: 2020 2020 2020 2020 2068 6f6f 6b61 7267           hookarg
-0001f080: 735b 276b 6579 275d 203d 206b 6579 0a20  s['key'] = key. 
-0001f090: 2020 2020 2020 2020 2020 2068 6f6f 6b61             hooka
-0001f0a0: 7267 735b 276f 6c64 275d 203d 206f 6c64  rgs['old'] = old
-0001f0b0: 0a20 2020 2020 2020 2020 2020 2068 6f6f  .            hoo
-0001f0c0: 6b61 7267 735b 276e 6577 275d 203d 206e  kargs['new'] = n
-0001f0d0: 6577 0a20 2020 2020 2020 2020 2020 2073  ew.            s
-0001f0e0: 656c 662e 686f 6f6b 2862 2770 7265 7075  elf.hook(b'prepu
-0001f0f0: 7368 6b65 7927 2c20 7468 726f 773d 5472  shkey', throw=Tr
-0001f100: 7565 2c20 2a2a 686f 6f6b 6172 6773 290a  ue, **hookargs).
-0001f110: 2020 2020 2020 2020 6578 6365 7074 2065          except e
-0001f120: 7272 6f72 2e48 6f6f 6b41 626f 7274 2061  rror.HookAbort a
-0001f130: 7320 6578 633a 0a20 2020 2020 2020 2020  s exc:.         
-0001f140: 2020 2073 656c 662e 7569 2e77 7269 7465     self.ui.write
-0001f150: 5f65 7272 285f 2862 2270 7573 686b 6579  _err(_(b"pushkey
-0001f160: 2d61 626f 7274 3a20 2573 5c6e 2229 2025  -abort: %s\n") %
-0001f170: 2065 7863 290a 2020 2020 2020 2020 2020   exc).          
-0001f180: 2020 6966 2065 7863 2e68 696e 743a 0a20    if exc.hint:. 
-0001f190: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001f1a0: 656c 662e 7569 2e77 7269 7465 5f65 7272  elf.ui.write_err
-0001f1b0: 285f 2862 2228 2573 295c 6e22 2920 2520  (_(b"(%s)\n") % 
-0001f1c0: 6578 632e 6869 6e74 290a 2020 2020 2020  exc.hint).      
-0001f1d0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0001f1e0: 7365 0a20 2020 2020 2020 2073 656c 662e  se.        self.
-0001f1f0: 7569 2e64 6562 7567 2862 2770 7573 6869  ui.debug(b'pushi
-0001f200: 6e67 206b 6579 2066 6f72 2022 2573 3a25  ng key for "%s:%
-0001f210: 7322 5c6e 2720 2520 286e 616d 6573 7061  s"\n' % (namespa
-0001f220: 6365 2c20 6b65 7929 290a 2020 2020 2020  ce, key)).      
-0001f230: 2020 7265 7420 3d20 7075 7368 6b65 792e    ret = pushkey.
-0001f240: 7075 7368 2873 656c 662c 206e 616d 6573  push(self, names
-0001f250: 7061 6365 2c20 6b65 792c 206f 6c64 2c20  pace, key, old, 
-0001f260: 6e65 7729 0a0a 2020 2020 2020 2020 6465  new)..        de
-0001f270: 6620 7275 6e68 6f6f 6b28 756e 7573 6564  f runhook(unused
-0001f280: 5f73 7563 6365 7373 293a 0a20 2020 2020  _success):.     
-0001f290: 2020 2020 2020 2073 656c 662e 686f 6f6b         self.hook
-0001f2a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001f2b0: 2020 6227 7075 7368 6b65 7927 2c0a 2020    b'pushkey',.  
-0001f2c0: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-0001f2d0: 6d65 7370 6163 653d 6e61 6d65 7370 6163  mespace=namespac
-0001f2e0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0001f2f0: 2020 206b 6579 3d6b 6579 2c0a 2020 2020     key=key,.    
-0001f300: 2020 2020 2020 2020 2020 2020 6f6c 643d              old=
-0001f310: 6f6c 642c 0a20 2020 2020 2020 2020 2020  old,.           
-0001f320: 2020 2020 206e 6577 3d6e 6577 2c0a 2020       new=new,.  
-0001f330: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001f340: 743d 7265 742c 0a20 2020 2020 2020 2020  t=ret,.         
-0001f350: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
-0001f360: 6c66 2e5f 6166 7465 726c 6f63 6b28 7275  lf._afterlock(ru
-0001f370: 6e68 6f6f 6b29 0a20 2020 2020 2020 2072  nhook).        r
-0001f380: 6574 7572 6e20 7265 740a 0a20 2020 2064  eturn ret..    d
-0001f390: 6566 206c 6973 746b 6579 7328 7365 6c66  ef listkeys(self
-0001f3a0: 2c20 6e61 6d65 7370 6163 6529 3a0a 2020  , namespace):.  
-0001f3b0: 2020 2020 2020 7365 6c66 2e68 6f6f 6b28        self.hook(
-0001f3c0: 6227 7072 656c 6973 746b 6579 7327 2c20  b'prelistkeys', 
-0001f3d0: 7468 726f 773d 5472 7565 2c20 6e61 6d65  throw=True, name
-0001f3e0: 7370 6163 653d 6e61 6d65 7370 6163 6529  space=namespace)
-0001f3f0: 0a20 2020 2020 2020 2073 656c 662e 7569  .        self.ui
-0001f400: 2e64 6562 7567 2862 276c 6973 7469 6e67  .debug(b'listing
-0001f410: 206b 6579 7320 666f 7220 2225 7322 5c6e   keys for "%s"\n
-0001f420: 2720 2520 6e61 6d65 7370 6163 6529 0a20  ' % namespace). 
-0001f430: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
-0001f440: 7075 7368 6b65 792e 6c69 7374 2873 656c  pushkey.list(sel
-0001f450: 662c 206e 616d 6573 7061 6365 290a 2020  f, namespace).  
-0001f460: 2020 2020 2020 7365 6c66 2e68 6f6f 6b28        self.hook(
-0001f470: 6227 6c69 7374 6b65 7973 272c 206e 616d  b'listkeys', nam
-0001f480: 6573 7061 6365 3d6e 616d 6573 7061 6365  espace=namespace
-0001f490: 2c20 7661 6c75 6573 3d76 616c 7565 7329  , values=values)
-0001f4a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001f4b0: 7661 6c75 6573 0a0a 2020 2020 6465 6620  values..    def 
-0001f4c0: 6465 6275 6777 6972 6561 7267 7328 7365  debugwireargs(se
-0001f4d0: 6c66 2c20 6f6e 652c 2074 776f 2c20 7468  lf, one, two, th
-0001f4e0: 7265 653d 4e6f 6e65 2c20 666f 7572 3d4e  ree=None, four=N
-0001f4f0: 6f6e 652c 2066 6976 653d 4e6f 6e65 293a  one, five=None):
-0001f500: 0a20 2020 2020 2020 2027 2727 7573 6564  .        '''used
-0001f510: 2074 6f20 7465 7374 2061 7267 756d 656e   to test argumen
-0001f520: 7420 7061 7373 696e 6720 6f76 6572 2074  t passing over t
-0001f530: 6865 2077 6972 6527 2727 0a20 2020 2020  he wire'''.     
-0001f540: 2020 2072 6574 7572 6e20 6222 2573 2025     return b"%s %
-0001f550: 7320 2573 2025 7320 2573 2220 2520 280a  s %s %s %s" % (.
-0001f560: 2020 2020 2020 2020 2020 2020 6f6e 652c              one,
-0001f570: 0a20 2020 2020 2020 2020 2020 2074 776f  .            two
-0001f580: 2c0a 2020 2020 2020 2020 2020 2020 7079  ,.            py
-0001f590: 636f 6d70 6174 2e62 7974 6573 7472 2874  compat.bytestr(t
-0001f5a0: 6872 6565 292c 0a20 2020 2020 2020 2020  hree),.         
-0001f5b0: 2020 2070 7963 6f6d 7061 742e 6279 7465     pycompat.byte
-0001f5c0: 7374 7228 666f 7572 292c 0a20 2020 2020  str(four),.     
-0001f5d0: 2020 2020 2020 2070 7963 6f6d 7061 742e         pycompat.
-0001f5e0: 6279 7465 7374 7228 6669 7665 292c 0a20  bytestr(five),. 
-0001f5f0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0001f600: 6620 7361 7665 636f 6d6d 6974 6d65 7373  f savecommitmess
-0001f610: 6167 6528 7365 6c66 2c20 7465 7874 293a  age(self, text):
-0001f620: 0a20 2020 2020 2020 2066 7020 3d20 7365  .        fp = se
-0001f630: 6c66 2e76 6673 2862 276c 6173 742d 6d65  lf.vfs(b'last-me
-0001f640: 7373 6167 652e 7478 7427 2c20 6227 7762  ssage.txt', b'wb
-0001f650: 2729 0a20 2020 2020 2020 2074 7279 3a0a  ').        try:.
-0001f660: 2020 2020 2020 2020 2020 2020 6670 2e77              fp.w
-0001f670: 7269 7465 2874 6578 7429 0a20 2020 2020  rite(text).     
-0001f680: 2020 2066 696e 616c 6c79 3a0a 2020 2020     finally:.    
-0001f690: 2020 2020 2020 2020 6670 2e63 6c6f 7365          fp.close
-0001f6a0: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-0001f6b0: 6e20 7365 6c66 2e70 6174 6874 6f28 6670  n self.pathto(fp
-0001f6c0: 2e6e 616d 655b 6c65 6e28 7365 6c66 2e72  .name[len(self.r
-0001f6d0: 6f6f 7429 202b 2031 203a 5d29 0a0a 2020  oot) + 1 :])..  
-0001f6e0: 2020 6465 6620 7265 6769 7374 6572 5f77    def register_w
-0001f6f0: 616e 7465 645f 7369 6465 6461 7461 2873  anted_sidedata(s
-0001f700: 656c 662c 2063 6174 6567 6f72 7929 3a0a  elf, category):.
-0001f710: 2020 2020 2020 2020 6966 2072 6570 6f73          if repos
-0001f720: 6974 6f72 792e 5245 504f 5f46 4541 5455  itory.REPO_FEATU
-0001f730: 5245 5f53 4944 455f 4441 5441 206e 6f74  RE_SIDE_DATA not
-0001f740: 2069 6e20 7365 6c66 2e66 6561 7475 7265   in self.feature
-0001f750: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-0001f760: 204f 6e6c 7920 7265 766c 6f67 7632 2072   Only revlogv2 r
-0001f770: 6570 6f73 2063 616e 2077 616e 7420 7369  epos can want si
-0001f780: 6465 6461 7461 2e0a 2020 2020 2020 2020  dedata..        
-0001f790: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0001f7a0: 2020 2073 656c 662e 5f77 616e 7465 645f     self._wanted_
-0001f7b0: 7369 6465 6461 7461 2e61 6464 2870 7963  sidedata.add(pyc
-0001f7c0: 6f6d 7061 742e 6279 7465 7374 7228 6361  ompat.bytestr(ca
-0001f7d0: 7465 676f 7279 2929 0a0a 2020 2020 6465  tegory))..    de
-0001f7e0: 6620 7265 6769 7374 6572 5f73 6964 6564  f register_sided
-0001f7f0: 6174 615f 636f 6d70 7574 6572 280a 2020  ata_computer(.  
-0001f800: 2020 2020 2020 7365 6c66 2c20 6b69 6e64        self, kind
-0001f810: 2c20 6361 7465 676f 7279 2c20 6b65 7973  , category, keys
-0001f820: 2c20 636f 6d70 7574 6572 2c20 666c 6167  , computer, flag
-0001f830: 732c 2072 6570 6c61 6365 3d46 616c 7365  s, replace=False
-0001f840: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-0001f850: 6966 206b 696e 6420 6e6f 7420 696e 2072  if kind not in r
-0001f860: 6576 6c6f 6763 6f6e 7374 2e41 4c4c 5f4b  evlogconst.ALL_K
-0001f870: 494e 4453 3a0a 2020 2020 2020 2020 2020  INDS:.          
-0001f880: 2020 6d73 6720 3d20 5f28 6222 756e 6578    msg = _(b"unex
-0001f890: 7065 6374 6564 2072 6576 6c6f 6720 6b69  pected revlog ki
-0001f8a0: 6e64 2027 2573 272e 2229 0a20 2020 2020  nd '%s'.").     
-0001f8b0: 2020 2020 2020 2072 6169 7365 2065 7272         raise err
-0001f8c0: 6f72 2e50 726f 6772 616d 6d69 6e67 4572  or.ProgrammingEr
-0001f8d0: 726f 7228 6d73 6720 2520 6b69 6e64 290a  ror(msg % kind).
-0001f8e0: 2020 2020 2020 2020 6361 7465 676f 7279          category
-0001f8f0: 203d 2070 7963 6f6d 7061 742e 6279 7465   = pycompat.byte
-0001f900: 7374 7228 6361 7465 676f 7279 290a 2020  str(category).  
-0001f910: 2020 2020 2020 616c 7265 6164 795f 7265        already_re
-0001f920: 6769 7374 6572 6564 203d 2063 6174 6567  gistered = categ
-0001f930: 6f72 7920 696e 2073 656c 662e 5f73 6964  ory in self._sid
-0001f940: 6564 6174 615f 636f 6d70 7574 6572 732e  edata_computers.
-0001f950: 6765 7428 6b69 6e64 2c20 5b5d 290a 2020  get(kind, []).  
-0001f960: 2020 2020 2020 6966 2061 6c72 6561 6479        if already
-0001f970: 5f72 6567 6973 7465 7265 6420 616e 6420  _registered and 
-0001f980: 6e6f 7420 7265 706c 6163 653a 0a20 2020  not replace:.   
-0001f990: 2020 2020 2020 2020 206d 7367 203d 205f           msg = _
-0001f9a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001f9b0: 2020 6222 6361 6e6e 6f74 2072 6567 6973    b"cannot regis
-0001f9c0: 7465 7220 6120 7369 6465 6461 7461 2063  ter a sidedata c
-0001f9d0: 6f6d 7075 7465 7220 7477 6963 6520 666f  omputer twice fo
-0001f9e0: 7220 6361 7465 676f 7279 2027 2573 272e  r category '%s'.
-0001f9f0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-0001fa00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001fa10: 6520 6572 726f 722e 5072 6f67 7261 6d6d  e error.Programm
-0001fa20: 696e 6745 7272 6f72 286d 7367 2025 2063  ingError(msg % c
-0001fa30: 6174 6567 6f72 7929 0a20 2020 2020 2020  ategory).       
-0001fa40: 2069 6620 7265 706c 6163 6520 616e 6420   if replace and 
-0001fa50: 6e6f 7420 616c 7265 6164 795f 7265 6769  not already_regi
-0001fa60: 7374 6572 6564 3a0a 2020 2020 2020 2020  stered:.        
-0001fa70: 2020 2020 6d73 6720 3d20 5f28 0a20 2020      msg = _(.   
-0001fa80: 2020 2020 2020 2020 2020 2020 2062 2263               b"c
-0001fa90: 616e 6e6f 7420 7265 706c 6163 6520 6120  annot replace a 
-0001faa0: 7369 6465 6461 7461 2063 6f6d 7075 7465  sidedata compute
-0001fab0: 7220 7468 6174 2069 736e 2774 2072 6567  r that isn't reg
-0001fac0: 6973 7465 7265 6420 220a 2020 2020 2020  istered ".      
-0001fad0: 2020 2020 2020 2020 2020 6222 666f 7220            b"for 
-0001fae0: 6361 7465 676f 7279 2027 2573 272e 220a  category '%s'.".
-0001faf0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001fb00: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001fb10: 6572 726f 722e 5072 6f67 7261 6d6d 696e  error.Programmin
-0001fb20: 6745 7272 6f72 286d 7367 2025 2063 6174  gError(msg % cat
-0001fb30: 6567 6f72 7929 0a20 2020 2020 2020 2073  egory).        s
-0001fb40: 656c 662e 5f73 6964 6564 6174 615f 636f  elf._sidedata_co
-0001fb50: 6d70 7574 6572 732e 7365 7464 6566 6175  mputers.setdefau
-0001fb60: 6c74 286b 696e 642c 207b 7d29 0a20 2020  lt(kind, {}).   
-0001fb70: 2020 2020 2073 656c 662e 5f73 6964 6564       self._sided
-0001fb80: 6174 615f 636f 6d70 7574 6572 735b 6b69  ata_computers[ki
-0001fb90: 6e64 5d5b 6361 7465 676f 7279 5d20 3d20  nd][category] = 
-0001fba0: 286b 6579 732c 2063 6f6d 7075 7465 722c  (keys, computer,
-0001fbb0: 2066 6c61 6773 290a 0a0a 2320 7573 6564   flags)...# used
-0001fbc0: 2074 6f20 6176 6f69 6420 6369 7263 756c   to avoid circul
-0001fbd0: 6172 2072 6566 6572 656e 6365 7320 736f  ar references so
-0001fbe0: 2064 6573 7472 7563 746f 7273 2077 6f72   destructors wor
-0001fbf0: 6b0a 6465 6620 6166 7465 7274 7261 6e73  k.def aftertrans
-0001fc00: 2866 696c 6573 293a 0a20 2020 2072 656e  (files):.    ren
-0001fc10: 616d 6566 696c 6573 203d 205b 7475 706c  amefiles = [tupl
-0001fc20: 6528 7429 2066 6f72 2074 2069 6e20 6669  e(t) for t in fi
-0001fc30: 6c65 735d 0a0a 2020 2020 6465 6620 6128  les]..    def a(
-0001fc40: 293a 0a20 2020 2020 2020 2066 6f72 2076  ):.        for v
-0001fc50: 6673 2c20 7372 632c 2064 6573 7420 696e  fs, src, dest in
-0001fc60: 2072 656e 616d 6566 696c 6573 3a0a 2020   renamefiles:.  
-0001fc70: 2020 2020 2020 2020 2020 2320 6966 2073            # if s
-0001fc80: 7263 2061 6e64 2064 6573 7420 7265 6665  rc and dest refe
-0001fc90: 7220 746f 2061 2073 616d 6520 6669 6c65  r to a same file
-0001fca0: 2c20 7666 732e 7265 6e61 6d65 2069 7320  , vfs.rename is 
-0001fcb0: 6120 6e6f 2d6f 702c 0a20 2020 2020 2020  a no-op,.       
-0001fcc0: 2020 2020 2023 206c 6561 7669 6e67 2062       # leaving b
-0001fcd0: 6f74 6820 7372 6320 616e 6420 6465 7374  oth src and dest
-0001fce0: 206f 6e20 6469 736b 2e20 6465 6c65 7465   on disk. delete
-0001fcf0: 2064 6573 7420 746f 206d 616b 6520 7375   dest to make su
-0001fd00: 7265 0a20 2020 2020 2020 2020 2020 2023  re.            #
-0001fd10: 2074 6865 2072 656e 616d 6520 636f 756c   the rename coul
-0001fd20: 646e 2774 2062 6520 7375 6368 2061 206e  dn't be such a n
-0001fd30: 6f2d 6f70 2e0a 2020 2020 2020 2020 2020  o-op..          
-0001fd40: 2020 7666 732e 7472 7975 6e6c 696e 6b28    vfs.tryunlink(
-0001fd50: 6465 7374 290a 2020 2020 2020 2020 2020  dest).          
-0001fd60: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001fd70: 2020 2020 2020 2076 6673 2e72 656e 616d         vfs.renam
-0001fd80: 6528 7372 632c 2064 6573 7429 0a20 2020  e(src, dest).   
-0001fd90: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0001fda0: 4669 6c65 4e6f 7446 6f75 6e64 4572 726f  FileNotFoundErro
-0001fdb0: 723a 2020 2320 6a6f 7572 6e61 6c20 6669  r:  # journal fi
-0001fdc0: 6c65 2064 6f65 7320 6e6f 7420 7965 7420  le does not yet 
-0001fdd0: 6578 6973 740a 2020 2020 2020 2020 2020  exist.          
-0001fde0: 2020 2020 2020 7061 7373 0a0a 2020 2020        pass..    
-0001fdf0: 7265 7475 726e 2061 0a0a 0a64 6566 2075  return a...def u
-0001fe00: 6e64 6f6e 616d 6528 666e 3a20 6279 7465  ndoname(fn: byte
-0001fe10: 7329 202d 3e20 6279 7465 733a 0a20 2020  s) -> bytes:.   
-0001fe20: 2062 6173 652c 206e 616d 6520 3d20 6f73   base, name = os
-0001fe30: 2e70 6174 682e 7370 6c69 7428 666e 290a  .path.split(fn).
-0001fe40: 2020 2020 6173 7365 7274 206e 616d 652e      assert name.
-0001fe50: 7374 6172 7473 7769 7468 2862 276a 6f75  startswith(b'jou
-0001fe60: 726e 616c 2729 0a20 2020 2072 6574 7572  rnal').    retur
-0001fe70: 6e20 6f73 2e70 6174 682e 6a6f 696e 2862  n os.path.join(b
-0001fe80: 6173 652c 206e 616d 652e 7265 706c 6163  ase, name.replac
-0001fe90: 6528 6227 6a6f 7572 6e61 6c27 2c20 6227  e(b'journal', b'
-0001fea0: 756e 646f 272c 2031 2929 0a0a 0a64 6566  undo', 1))...def
-0001feb0: 2069 6e73 7461 6e63 6528 7569 2c20 7061   instance(ui, pa
-0001fec0: 7468 3a20 6279 7465 732c 2063 7265 6174  th: bytes, creat
-0001fed0: 652c 2069 6e74 656e 7473 3d4e 6f6e 652c  e, intents=None,
-0001fee0: 2063 7265 6174 656f 7074 733d 4e6f 6e65   createopts=None
-0001fef0: 293a 0a20 2020 2023 2070 7265 7665 6e74  ):.    # prevent
-0001ff00: 2063 7963 6c69 6320 696d 706f 7274 206c   cyclic import l
-0001ff10: 6f63 616c 7265 706f 202d 3e20 7570 6772  ocalrepo -> upgr
-0001ff20: 6164 6520 2d3e 206c 6f63 616c 7265 706f  ade -> localrepo
-0001ff30: 0a20 2020 2066 726f 6d20 2e20 696d 706f  .    from . impo
-0001ff40: 7274 2075 7067 7261 6465 0a0a 2020 2020  rt upgrade..    
-0001ff50: 6c6f 6361 6c70 6174 6820 3d20 7572 6c75  localpath = urlu
-0001ff60: 7469 6c2e 7572 6c6c 6f63 616c 7061 7468  til.urllocalpath
-0001ff70: 2870 6174 6829 0a20 2020 2069 6620 6372  (path).    if cr
-0001ff80: 6561 7465 3a0a 2020 2020 2020 2020 6372  eate:.        cr
-0001ff90: 6561 7465 7265 706f 7369 746f 7279 2875  eaterepository(u
-0001ffa0: 692c 206c 6f63 616c 7061 7468 2c20 6372  i, localpath, cr
-0001ffb0: 6561 7465 6f70 7473 3d63 7265 6174 656f  eateopts=createo
-0001ffc0: 7074 7329 0a0a 2020 2020 6465 6620 7265  pts)..    def re
-0001ffd0: 706f 5f6d 616b 6572 2829 3a0a 2020 2020  po_maker():.    
-0001ffe0: 2020 2020 7265 7475 726e 206d 616b 656c      return makel
-0001fff0: 6f63 616c 7265 706f 7369 746f 7279 2875  ocalrepository(u
-00020000: 692c 206c 6f63 616c 7061 7468 2c20 696e  i, localpath, in
-00020010: 7465 6e74 733d 696e 7465 6e74 7329 0a0a  tents=intents)..
-00020020: 2020 2020 7265 706f 203d 2072 6570 6f5f      repo = repo_
-00020030: 6d61 6b65 7228 290a 2020 2020 7265 706f  maker().    repo
-00020040: 203d 2075 7067 7261 6465 2e6d 6179 5f61   = upgrade.may_a
-00020050: 7574 6f5f 7570 6772 6164 6528 7265 706f  uto_upgrade(repo
-00020060: 2c20 7265 706f 5f6d 616b 6572 290a 2020  , repo_maker).  
-00020070: 2020 7265 7475 726e 2072 6570 6f0a 0a0a    return repo...
-00020080: 6465 6620 6973 6c6f 6361 6c28 7061 7468  def islocal(path
-00020090: 3a20 6279 7465 7329 202d 3e20 626f 6f6c  : bytes) -> bool
-000200a0: 3a0a 2020 2020 7265 7475 726e 2054 7275  :.    return Tru
-000200b0: 650a 0a0a 6465 6620 6465 6661 756c 7463  e...def defaultc
-000200c0: 7265 6174 656f 7074 7328 7569 2c20 6372  reateopts(ui, cr
-000200d0: 6561 7465 6f70 7473 3d4e 6f6e 6529 3a0a  eateopts=None):.
-000200e0: 2020 2020 2222 2250 6f70 756c 6174 6520      """Populate 
-000200f0: 7468 6520 6465 6661 756c 7420 6372 6561  the default crea
-00020100: 7469 6f6e 206f 7074 696f 6e73 2066 6f72  tion options for
-00020110: 2061 2072 6570 6f73 6974 6f72 792e 0a0a   a repository...
-00020120: 2020 2020 4120 6469 6374 696f 6e61 7279      A dictionary
-00020130: 206f 6620 6578 706c 6963 6974 6c79 2072   of explicitly r
-00020140: 6571 7565 7374 6564 2063 7265 6174 696f  equested creatio
-00020150: 6e20 6f70 7469 6f6e 7320 6361 6e20 6265  n options can be
-00020160: 2070 6173 7365 640a 2020 2020 696e 2e20   passed.    in. 
-00020170: 4d69 7373 696e 6720 6b65 7973 2077 696c  Missing keys wil
-00020180: 6c20 6265 2070 6f70 756c 6174 6564 2e0a  l be populated..
-00020190: 2020 2020 2222 220a 2020 2020 6372 6561      """.    crea
-000201a0: 7465 6f70 7473 203d 2064 6963 7428 6372  teopts = dict(cr
-000201b0: 6561 7465 6f70 7473 206f 7220 7b7d 290a  eateopts or {}).
-000201c0: 0a20 2020 2069 6620 6227 6261 636b 656e  .    if b'backen
-000201d0: 6427 206e 6f74 2069 6e20 6372 6561 7465  d' not in create
-000201e0: 6f70 7473 3a0a 2020 2020 2020 2020 2320  opts:.        # 
-000201f0: 6578 7065 7269 6d65 6e74 616c 2063 6f6e  experimental con
-00020200: 6669 673a 2073 746f 7261 6765 2e6e 6577  fig: storage.new
-00020210: 2d72 6570 6f2d 6261 636b 656e 640a 2020  -repo-backend.  
-00020220: 2020 2020 2020 6372 6561 7465 6f70 7473        createopts
-00020230: 5b62 2762 6163 6b65 6e64 275d 203d 2075  [b'backend'] = u
-00020240: 692e 636f 6e66 6967 2862 2773 746f 7261  i.config(b'stora
-00020250: 6765 272c 2062 276e 6577 2d72 6570 6f2d  ge', b'new-repo-
-00020260: 6261 636b 656e 6427 290a 0a20 2020 2072  backend')..    r
-00020270: 6574 7572 6e20 6372 6561 7465 6f70 7473  eturn createopts
-00020280: 0a0a 0a64 6566 2063 6c6f 6e65 5f72 6571  ...def clone_req
-00020290: 7569 7265 6d65 6e74 7328 7569 2c20 6372  uirements(ui, cr
-000202a0: 6561 7465 6f70 7473 2c20 7372 6372 6570  eateopts, srcrep
-000202b0: 6f29 3a0a 2020 2020 2222 2263 6c6f 6e65  o):.    """clone
-000202c0: 2074 6865 2072 6571 7569 7265 6d65 6e74   the requirement
-000202d0: 7320 6f66 2061 206c 6f63 616c 2072 6570  s of a local rep
-000202e0: 6f20 666f 7220 6120 6c6f 6361 6c20 636c  o for a local cl
-000202f0: 6f6e 650a 0a20 2020 2054 6865 2073 746f  one..    The sto
-00020300: 7265 2072 6571 7569 7265 6d65 6e74 7320  re requirements 
-00020310: 6172 6520 756e 6368 616e 6765 6420 7768  are unchanged wh
-00020320: 696c 6520 7468 6520 776f 726b 696e 6720  ile the working 
-00020330: 636f 7079 2072 6571 7569 7265 6d65 6e74  copy requirement
-00020340: 730a 2020 2020 6465 7065 6e64 7320 6f6e  s.    depends on
-00020350: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
-00020360: 6f6e 0a20 2020 2022 2222 0a20 2020 2074  on.    """.    t
-00020370: 6172 6765 745f 7265 7175 6972 656d 656e  arget_requiremen
-00020380: 7473 203d 2073 6574 2829 0a20 2020 2069  ts = set().    i
-00020390: 6620 6e6f 7420 7372 6372 6570 6f2e 7265  f not srcrepo.re
-000203a0: 7175 6972 656d 656e 7473 3a0a 2020 2020  quirements:.    
-000203b0: 2020 2020 2320 7468 6973 2069 7320 6120      # this is a 
-000203c0: 6c65 6761 6379 2072 6576 6c6f 6720 2276  legacy revlog "v
-000203d0: 3022 2072 6570 6f73 6974 6f72 792c 2077  0" repository, w
-000203e0: 6520 6361 6e6e 6f74 2064 6f20 616e 7974  e cannot do anyt
-000203f0: 6869 6e67 2066 616e 6379 0a20 2020 2020  hing fancy.     
-00020400: 2020 2023 2077 6974 6820 6974 2e0a 2020     # with it..  
-00020410: 2020 2020 2020 7265 7475 726e 2074 6172        return tar
-00020420: 6765 745f 7265 7175 6972 656d 656e 7473  get_requirements
-00020430: 0a20 2020 2063 7265 6174 656f 7074 7320  .    createopts 
-00020440: 3d20 6465 6661 756c 7463 7265 6174 656f  = defaultcreateo
-00020450: 7074 7328 7569 2c20 6372 6561 7465 6f70  pts(ui, createop
-00020460: 7473 3d63 7265 6174 656f 7074 7329 0a20  ts=createopts). 
-00020470: 2020 2066 6f72 2072 2069 6e20 6e65 7772     for r in newr
-00020480: 6570 6f72 6571 7569 7265 6d65 6e74 7328  eporequirements(
-00020490: 7569 2c20 6372 6561 7465 6f70 7473 293a  ui, createopts):
-000204a0: 0a20 2020 2020 2020 2069 6620 7220 696e  .        if r in
-000204b0: 2072 6571 7569 7265 6d65 6e74 736d 6f64   requirementsmod
-000204c0: 2e57 4f52 4b49 4e47 5f44 4952 5f52 4551  .WORKING_DIR_REQ
-000204d0: 5549 5245 4d45 4e54 533a 0a20 2020 2020  UIREMENTS:.     
-000204e0: 2020 2020 2020 2074 6172 6765 745f 7265         target_re
-000204f0: 7175 6972 656d 656e 7473 2e61 6464 2872  quirements.add(r
-00020500: 290a 0a20 2020 2066 6f72 2072 2069 6e20  )..    for r in 
-00020510: 7372 6372 6570 6f2e 7265 7175 6972 656d  srcrepo.requirem
-00020520: 656e 7473 3a0a 2020 2020 2020 2020 6966  ents:.        if
-00020530: 2072 206e 6f74 2069 6e20 7265 7175 6972   r not in requir
-00020540: 656d 656e 7473 6d6f 642e 574f 524b 494e  ementsmod.WORKIN
-00020550: 475f 4449 525f 5245 5155 4952 454d 454e  G_DIR_REQUIREMEN
-00020560: 5453 3a0a 2020 2020 2020 2020 2020 2020  TS:.            
-00020570: 7461 7267 6574 5f72 6571 7569 7265 6d65  target_requireme
-00020580: 6e74 732e 6164 6428 7229 0a20 2020 2072  nts.add(r).    r
-00020590: 6574 7572 6e20 7461 7267 6574 5f72 6571  eturn target_req
-000205a0: 7569 7265 6d65 6e74 730a 0a0a 6465 6620  uirements...def 
-000205b0: 6e65 7772 6570 6f72 6571 7569 7265 6d65  newreporequireme
-000205c0: 6e74 7328 7569 2c20 6372 6561 7465 6f70  nts(ui, createop
-000205d0: 7473 293a 0a20 2020 2022 2222 4465 7465  ts):.    """Dete
-000205e0: 726d 696e 6520 7468 6520 7365 7420 6f66  rmine the set of
-000205f0: 2072 6571 7569 7265 6d65 6e74 7320 666f   requirements fo
-00020600: 7220 6120 6e65 7720 6c6f 6361 6c20 7265  r a new local re
-00020610: 706f 7369 746f 7279 2e0a 0a20 2020 2045  pository...    E
-00020620: 7874 656e 7369 6f6e 7320 6361 6e20 7772  xtensions can wr
-00020630: 6170 2074 6869 7320 6675 6e63 7469 6f6e  ap this function
-00020640: 2074 6f20 7370 6563 6966 7920 6375 7374   to specify cust
-00020650: 6f6d 2072 6571 7569 7265 6d65 6e74 7320  om requirements 
-00020660: 666f 720a 2020 2020 6e65 7720 7265 706f  for.    new repo
-00020670: 7369 746f 7269 6573 2e0a 2020 2020 2222  sitories..    ""
-00020680: 220a 0a20 2020 2069 6620 6227 6261 636b  "..    if b'back
-00020690: 656e 6427 206e 6f74 2069 6e20 6372 6561  end' not in crea
-000206a0: 7465 6f70 7473 3a0a 2020 2020 2020 2020  teopts:.        
-000206b0: 7261 6973 6520 6572 726f 722e 5072 6f67  raise error.Prog
-000206c0: 7261 6d6d 696e 6745 7272 6f72 280a 2020  rammingError(.  
-000206d0: 2020 2020 2020 2020 2020 6227 6261 636b            b'back
-000206e0: 656e 6420 6b65 7920 6e6f 7420 7072 6573  end key not pres
-000206f0: 656e 7420 696e 2063 7265 6174 656f 7074  ent in createopt
-00020700: 733b 2027 0a20 2020 2020 2020 2020 2020  s; '.           
-00020710: 2062 2777 6173 2064 6566 6175 6c74 6372   b'was defaultcr
-00020720: 6561 7465 6f70 7473 2829 2063 616c 6c65  eateopts() calle
-00020730: 643f 270a 2020 2020 2020 2020 290a 0a20  d?'.        ).. 
-00020740: 2020 2069 6620 6372 6561 7465 6f70 7473     if createopts
-00020750: 5b62 2762 6163 6b65 6e64 275d 2021 3d20  [b'backend'] != 
-00020760: 6227 7265 766c 6f67 7631 273a 0a20 2020  b'revlogv1':.   
-00020770: 2020 2020 2072 6169 7365 2065 7272 6f72       raise error
-00020780: 2e41 626f 7274 280a 2020 2020 2020 2020  .Abort(.        
-00020790: 2020 2020 5f28 0a20 2020 2020 2020 2020      _(.         
-000207a0: 2020 2020 2020 2062 2775 6e61 626c 6520         b'unable 
-000207b0: 746f 2064 6574 6572 6d69 6e65 2072 6570  to determine rep
-000207c0: 6f73 6974 6f72 7920 7265 7175 6972 656d  ository requirem
-000207d0: 656e 7473 2066 6f72 2027 0a20 2020 2020  ents for '.     
-000207e0: 2020 2020 2020 2020 2020 2062 2773 746f             b'sto
-000207f0: 7261 6765 2062 6163 6b65 6e64 3a20 2573  rage backend: %s
-00020800: 270a 2020 2020 2020 2020 2020 2020 290a  '.            ).
-00020810: 2020 2020 2020 2020 2020 2020 2520 6372              % cr
-00020820: 6561 7465 6f70 7473 5b62 2762 6163 6b65  eateopts[b'backe
-00020830: 6e64 275d 0a20 2020 2020 2020 2029 0a0a  nd'].        )..
-00020840: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
-00020850: 203d 207b 7265 7175 6972 656d 656e 7473   = {requirements
-00020860: 6d6f 642e 5245 564c 4f47 5631 5f52 4551  mod.REVLOGV1_REQ
-00020870: 5549 5245 4d45 4e54 7d0a 2020 2020 6966  UIREMENT}.    if
-00020880: 2075 692e 636f 6e66 6967 626f 6f6c 2862   ui.configbool(b
-00020890: 2766 6f72 6d61 7427 2c20 6227 7573 6573  'format', b'uses
-000208a0: 746f 7265 2729 3a0a 2020 2020 2020 2020  tore'):.        
-000208b0: 7265 7175 6972 656d 656e 7473 2e61 6464  requirements.add
-000208c0: 2872 6571 7569 7265 6d65 6e74 736d 6f64  (requirementsmod
-000208d0: 2e53 544f 5245 5f52 4551 5549 5245 4d45  .STORE_REQUIREME
-000208e0: 4e54 290a 2020 2020 2020 2020 6966 2075  NT).        if u
-000208f0: 692e 636f 6e66 6967 626f 6f6c 2862 2766  i.configbool(b'f
-00020900: 6f72 6d61 7427 2c20 6227 7573 6566 6e63  ormat', b'usefnc
-00020910: 6163 6865 2729 3a0a 2020 2020 2020 2020  ache'):.        
-00020920: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
-00020930: 2e61 6464 2872 6571 7569 7265 6d65 6e74  .add(requirement
-00020940: 736d 6f64 2e46 4e43 4143 4845 5f52 4551  smod.FNCACHE_REQ
-00020950: 5549 5245 4d45 4e54 290a 2020 2020 2020  UIREMENT).      
-00020960: 2020 2020 2020 6966 2075 692e 636f 6e66        if ui.conf
-00020970: 6967 626f 6f6c 2862 2766 6f72 6d61 7427  igbool(b'format'
-00020980: 2c20 6227 646f 7465 6e63 6f64 6527 293a  , b'dotencode'):
-00020990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000209a0: 2072 6571 7569 7265 6d65 6e74 732e 6164   requirements.ad
-000209b0: 6428 7265 7175 6972 656d 656e 7473 6d6f  d(requirementsmo
-000209c0: 642e 444f 5445 4e43 4f44 455f 5245 5155  d.DOTENCODE_REQU
-000209d0: 4952 454d 454e 5429 0a0a 2020 2020 636f  IREMENT)..    co
-000209e0: 6d70 656e 6769 6e65 7320 3d20 7569 2e63  mpengines = ui.c
-000209f0: 6f6e 6669 676c 6973 7428 6227 666f 726d  onfiglist(b'form
-00020a00: 6174 272c 2062 2772 6576 6c6f 672d 636f  at', b'revlog-co
-00020a10: 6d70 7265 7373 696f 6e27 290a 2020 2020  mpression').    
-00020a20: 666f 7220 636f 6d70 656e 6769 6e65 2069  for compengine i
-00020a30: 6e20 636f 6d70 656e 6769 6e65 733a 0a20  n compengines:. 
-00020a40: 2020 2020 2020 2069 6620 636f 6d70 656e         if compen
-00020a50: 6769 6e65 2069 6e20 7574 696c 2e63 6f6d  gine in util.com
-00020a60: 7065 6e67 696e 6573 3a0a 2020 2020 2020  pengines:.      
-00020a70: 2020 2020 2020 656e 6769 6e65 203d 2075        engine = u
-00020a80: 7469 6c2e 636f 6d70 656e 6769 6e65 735b  til.compengines[
-00020a90: 636f 6d70 656e 6769 6e65 5d0a 2020 2020  compengine].    
-00020aa0: 2020 2020 2020 2020 6966 2065 6e67 696e          if engin
-00020ab0: 652e 6176 6169 6c61 626c 6528 2920 616e  e.available() an
-00020ac0: 6420 656e 6769 6e65 2e72 6576 6c6f 6768  d engine.revlogh
-00020ad0: 6561 6465 7228 293a 0a20 2020 2020 2020  eader():.       
-00020ae0: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-00020af0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00020b00: 2072 6169 7365 2065 7272 6f72 2e41 626f   raise error.Abo
-00020b10: 7274 280a 2020 2020 2020 2020 2020 2020  rt(.            
-00020b20: 5f28 0a20 2020 2020 2020 2020 2020 2020  _(.             
-00020b30: 2020 2062 2763 6f6d 7072 6573 7369 6f6e     b'compression
-00020b40: 2065 6e67 696e 6573 2025 7320 6465 6669   engines %s defi
-00020b50: 6e65 6420 6279 2027 0a20 2020 2020 2020  ned by '.       
-00020b60: 2020 2020 2020 2020 2062 2766 6f72 6d61           b'forma
-00020b70: 742e 7265 766c 6f67 2d63 6f6d 7072 6573  t.revlog-compres
-00020b80: 7369 6f6e 206e 6f74 2061 7661 696c 6162  sion not availab
-00020b90: 6c65 270a 2020 2020 2020 2020 2020 2020  le'.            
-00020ba0: 290a 2020 2020 2020 2020 2020 2020 2520  ).            % 
-00020bb0: 6227 2c20 272e 6a6f 696e 2862 2722 2573  b', '.join(b'"%s
-00020bc0: 2227 2025 2065 2066 6f72 2065 2069 6e20  "' % e for e in 
-00020bd0: 636f 6d70 656e 6769 6e65 7329 2c0a 2020  compengines),.  
-00020be0: 2020 2020 2020 2020 2020 6869 6e74 3d5f            hint=_
-00020bf0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00020c00: 2020 6227 7275 6e20 2268 6720 6465 6275    b'run "hg debu
-00020c10: 6769 6e73 7461 6c6c 2220 746f 206c 6973  ginstall" to lis
-00020c20: 7420 6176 6169 6c61 626c 6520 270a 2020  t available '.  
-00020c30: 2020 2020 2020 2020 2020 2020 2020 6227                b'
-00020c40: 636f 6d70 7265 7373 696f 6e20 656e 6769  compression engi
-00020c50: 6e65 7327 0a20 2020 2020 2020 2020 2020  nes'.           
-00020c60: 2029 2c0a 2020 2020 2020 2020 290a 0a20   ),.        ).. 
-00020c70: 2020 2023 207a 6c69 6220 6973 2074 6865     # zlib is the
-00020c80: 2068 6973 746f 7269 6361 6c20 6465 6661   historical defa
-00020c90: 756c 7420 616e 6420 646f 6573 6e27 7420  ult and doesn't 
-00020ca0: 6e65 6564 2061 6e20 6578 706c 6963 6974  need an explicit
-00020cb0: 2072 6571 7569 7265 6d65 6e74 2e0a 2020   requirement..  
-00020cc0: 2020 6966 2063 6f6d 7065 6e67 696e 6520    if compengine 
-00020cd0: 3d3d 2062 277a 7374 6427 3a0a 2020 2020  == b'zstd':.    
-00020ce0: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
-00020cf0: 2e61 6464 2862 2772 6576 6c6f 672d 636f  .add(b'revlog-co
-00020d00: 6d70 7265 7373 696f 6e2d 7a73 7464 2729  mpression-zstd')
-00020d10: 0a20 2020 2065 6c69 6620 636f 6d70 656e  .    elif compen
-00020d20: 6769 6e65 2021 3d20 6227 7a6c 6962 273a  gine != b'zlib':
-00020d30: 0a20 2020 2020 2020 2072 6571 7569 7265  .        require
-00020d40: 6d65 6e74 732e 6164 6428 6227 6578 702d  ments.add(b'exp-
-00020d50: 636f 6d70 7265 7373 696f 6e2d 2573 2720  compression-%s' 
-00020d60: 2520 636f 6d70 656e 6769 6e65 290a 0a20  % compengine).. 
-00020d70: 2020 2069 6620 7363 6d75 7469 6c2e 6764     if scmutil.gd
-00020d80: 696e 6974 636f 6e66 6967 2875 6929 3a0a  initconfig(ui):.
-00020d90: 2020 2020 2020 2020 7265 7175 6972 656d          requirem
-00020da0: 656e 7473 2e61 6464 2872 6571 7569 7265  ents.add(require
-00020db0: 6d65 6e74 736d 6f64 2e47 454e 4552 414c  mentsmod.GENERAL
-00020dc0: 4445 4c54 415f 5245 5155 4952 454d 454e  DELTA_REQUIREMEN
-00020dd0: 5429 0a20 2020 2020 2020 2069 6620 7569  T).        if ui
-00020de0: 2e63 6f6e 6669 6762 6f6f 6c28 6227 666f  .configbool(b'fo
-00020df0: 726d 6174 272c 2062 2773 7061 7273 652d  rmat', b'sparse-
-00020e00: 7265 766c 6f67 2729 3a0a 2020 2020 2020  revlog'):.      
-00020e10: 2020 2020 2020 7265 7175 6972 656d 656e        requiremen
-00020e20: 7473 2e61 6464 2872 6571 7569 7265 6d65  ts.add(requireme
-00020e30: 6e74 736d 6f64 2e53 5041 5253 4552 4556  ntsmod.SPARSEREV
-00020e40: 4c4f 475f 5245 5155 4952 454d 454e 5429  LOG_REQUIREMENT)
-00020e50: 0a0a 2020 2020 2320 6578 7065 7269 6d65  ..    # experime
-00020e60: 6e74 616c 2063 6f6e 6669 673a 2066 6f72  ntal config: for
-00020e70: 6d61 742e 7573 652d 6469 7273 7461 7465  mat.use-dirstate
-00020e80: 2d76 320a 2020 2020 2320 4b65 6570 2074  -v2.    # Keep t
-00020e90: 6869 7320 6c6f 6769 6320 696e 2073 796e  his logic in syn
-00020ea0: 6320 7769 7468 2060 6861 735f 6469 7273  c with `has_dirs
-00020eb0: 7461 7465 5f76 3228 2960 2069 6e20 6074  tate_v2()` in `t
-00020ec0: 6573 7473 2f68 6768 6176 652e 7079 600a  ests/hghave.py`.
-00020ed0: 2020 2020 6966 2075 692e 636f 6e66 6967      if ui.config
-00020ee0: 626f 6f6c 2862 2766 6f72 6d61 7427 2c20  bool(b'format', 
-00020ef0: 6227 7573 652d 6469 7273 7461 7465 2d76  b'use-dirstate-v
-00020f00: 3227 293a 0a20 2020 2020 2020 2072 6571  2'):.        req
-00020f10: 7569 7265 6d65 6e74 732e 6164 6428 7265  uirements.add(re
-00020f20: 7175 6972 656d 656e 7473 6d6f 642e 4449  quirementsmod.DI
-00020f30: 5253 5441 5445 5f56 325f 5245 5155 4952  RSTATE_V2_REQUIR
-00020f40: 454d 454e 5429 0a0a 2020 2020 2320 6578  EMENT)..    # ex
-00020f50: 7065 7269 6d65 6e74 616c 2063 6f6e 6669  perimental confi
-00020f60: 673a 2066 6f72 6d61 742e 6578 702d 7573  g: format.exp-us
-00020f70: 652d 636f 7069 6573 2d73 6964 652d 6461  e-copies-side-da
-00020f80: 7461 2d63 6861 6e67 6573 6574 0a20 2020  ta-changeset.   
-00020f90: 2069 6620 7569 2e63 6f6e 6669 6762 6f6f   if ui.configboo
-00020fa0: 6c28 6227 666f 726d 6174 272c 2062 2765  l(b'format', b'e
-00020fb0: 7870 2d75 7365 2d63 6f70 6965 732d 7369  xp-use-copies-si
-00020fc0: 6465 2d64 6174 612d 6368 616e 6765 7365  de-data-changese
-00020fd0: 7427 293a 0a20 2020 2020 2020 2072 6571  t'):.        req
-00020fe0: 7569 7265 6d65 6e74 732e 6164 6428 7265  uirements.add(re
-00020ff0: 7175 6972 656d 656e 7473 6d6f 642e 4348  quirementsmod.CH
-00021000: 414e 4745 4c4f 4756 325f 5245 5155 4952  ANGELOGV2_REQUIR
-00021010: 454d 454e 5429 0a20 2020 2020 2020 2072  EMENT).        r
-00021020: 6571 7569 7265 6d65 6e74 732e 6164 6428  equirements.add(
-00021030: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
-00021040: 434f 5049 4553 5344 435f 5245 5155 4952  COPIESSDC_REQUIR
-00021050: 454d 454e 5429 0a20 2020 2069 6620 7569  EMENT).    if ui
-00021060: 2e63 6f6e 6669 6762 6f6f 6c28 6227 6578  .configbool(b'ex
-00021070: 7065 7269 6d65 6e74 616c 272c 2062 2774  perimental', b't
-00021080: 7265 656d 616e 6966 6573 7427 293a 0a20  reemanifest'):. 
-00021090: 2020 2020 2020 2072 6571 7569 7265 6d65         requireme
-000210a0: 6e74 732e 6164 6428 7265 7175 6972 656d  nts.add(requirem
-000210b0: 656e 7473 6d6f 642e 5452 4545 4d41 4e49  entsmod.TREEMANI
-000210c0: 4645 5354 5f52 4551 5549 5245 4d45 4e54  FEST_REQUIREMENT
-000210d0: 290a 0a20 2020 2063 6861 6e67 656c 6f67  )..    changelog
-000210e0: 7632 203d 2075 692e 636f 6e66 6967 2862  v2 = ui.config(b
-000210f0: 2766 6f72 6d61 7427 2c20 6227 6578 702d  'format', b'exp-
-00021100: 7573 652d 6368 616e 6765 6c6f 672d 7632  use-changelog-v2
-00021110: 2729 0a20 2020 2069 6620 6368 616e 6765  ').    if change
-00021120: 6c6f 6776 3220 3d3d 2062 2765 6e61 626c  logv2 == b'enabl
-00021130: 652d 756e 7374 6162 6c65 2d66 6f72 6d61  e-unstable-forma
-00021140: 742d 616e 642d 636f 7272 7570 742d 6d79  t-and-corrupt-my
-00021150: 2d64 6174 6127 3a0a 2020 2020 2020 2020  -data':.        
-00021160: 7265 7175 6972 656d 656e 7473 2e61 6464  requirements.add
-00021170: 2872 6571 7569 7265 6d65 6e74 736d 6f64  (requirementsmod
-00021180: 2e43 4841 4e47 454c 4f47 5632 5f52 4551  .CHANGELOGV2_REQ
-00021190: 5549 5245 4d45 4e54 290a 0a20 2020 2072  UIREMENT)..    r
-000211a0: 6576 6c6f 6776 3220 3d20 7569 2e63 6f6e  evlogv2 = ui.con
-000211b0: 6669 6728 6227 6578 7065 7269 6d65 6e74  fig(b'experiment
-000211c0: 616c 272c 2062 2772 6576 6c6f 6776 3227  al', b'revlogv2'
-000211d0: 290a 2020 2020 6966 2072 6576 6c6f 6776  ).    if revlogv
-000211e0: 3220 3d3d 2062 2765 6e61 626c 652d 756e  2 == b'enable-un
-000211f0: 7374 6162 6c65 2d66 6f72 6d61 742d 616e  stable-format-an
-00021200: 642d 636f 7272 7570 742d 6d79 2d64 6174  d-corrupt-my-dat
-00021210: 6127 3a0a 2020 2020 2020 2020 7265 7175  a':.        requ
-00021220: 6972 656d 656e 7473 2e64 6973 6361 7264  irements.discard
-00021230: 2872 6571 7569 7265 6d65 6e74 736d 6f64  (requirementsmod
-00021240: 2e52 4556 4c4f 4756 315f 5245 5155 4952  .REVLOGV1_REQUIR
-00021250: 454d 454e 5429 0a20 2020 2020 2020 2072  EMENT).        r
-00021260: 6571 7569 7265 6d65 6e74 732e 6164 6428  equirements.add(
-00021270: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
-00021280: 5245 564c 4f47 5632 5f52 4551 5549 5245  REVLOGV2_REQUIRE
-00021290: 4d45 4e54 290a 2020 2020 2320 6578 7065  MENT).    # expe
-000212a0: 7269 6d65 6e74 616c 2063 6f6e 6669 673a  rimental config:
-000212b0: 2066 6f72 6d61 742e 696e 7465 726e 616c   format.internal
-000212c0: 2d70 6861 7365 0a20 2020 2069 6620 7569  -phase.    if ui
-000212d0: 2e63 6f6e 6669 6762 6f6f 6c28 6227 666f  .configbool(b'fo
-000212e0: 726d 6174 272c 2062 2775 7365 2d69 6e74  rmat', b'use-int
-000212f0: 6572 6e61 6c2d 7068 6173 6527 293a 0a20  ernal-phase'):. 
-00021300: 2020 2020 2020 2072 6571 7569 7265 6d65         requireme
-00021310: 6e74 732e 6164 6428 7265 7175 6972 656d  nts.add(requirem
-00021320: 656e 7473 6d6f 642e 494e 5445 524e 414c  entsmod.INTERNAL
-00021330: 5f50 4841 5345 5f52 4551 5549 5245 4d45  _PHASE_REQUIREME
-00021340: 4e54 290a 0a20 2020 2023 2065 7870 6572  NT)..    # exper
-00021350: 696d 656e 7461 6c20 636f 6e66 6967 3a20  imental config: 
-00021360: 666f 726d 6174 2e65 7870 2d61 7263 6869  format.exp-archi
-00021370: 7665 642d 7068 6173 650a 2020 2020 6966  ved-phase.    if
-00021380: 2075 692e 636f 6e66 6967 626f 6f6c 2862   ui.configbool(b
-00021390: 2766 6f72 6d61 7427 2c20 6227 6578 702d  'format', b'exp-
-000213a0: 6172 6368 6976 6564 2d70 6861 7365 2729  archived-phase')
-000213b0: 3a0a 2020 2020 2020 2020 7265 7175 6972  :.        requir
-000213c0: 656d 656e 7473 2e61 6464 2872 6571 7569  ements.add(requi
-000213d0: 7265 6d65 6e74 736d 6f64 2e41 5243 4849  rementsmod.ARCHI
-000213e0: 5645 445f 5048 4153 455f 5245 5155 4952  VED_PHASE_REQUIR
-000213f0: 454d 454e 5429 0a0a 2020 2020 6966 2063  EMENT)..    if c
-00021400: 7265 6174 656f 7074 732e 6765 7428 6227  reateopts.get(b'
-00021410: 6e61 7272 6f77 6669 6c65 7327 293a 0a20  narrowfiles'):. 
-00021420: 2020 2020 2020 2072 6571 7569 7265 6d65         requireme
-00021430: 6e74 732e 6164 6428 7265 7175 6972 656d  nts.add(requirem
-00021440: 656e 7473 6d6f 642e 4e41 5252 4f57 5f52  entsmod.NARROW_R
-00021450: 4551 5549 5245 4d45 4e54 290a 0a20 2020  EQUIREMENT)..   
-00021460: 2069 6620 6372 6561 7465 6f70 7473 2e67   if createopts.g
-00021470: 6574 2862 276c 6673 2729 3a0a 2020 2020  et(b'lfs'):.    
-00021480: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
-00021490: 2e61 6464 2862 276c 6673 2729 0a0a 2020  .add(b'lfs')..  
-000214a0: 2020 6966 2075 692e 636f 6e66 6967 626f    if ui.configbo
-000214b0: 6f6c 2862 2766 6f72 6d61 7427 2c20 6227  ol(b'format', b'
-000214c0: 626f 6f6b 6d61 726b 732d 696e 2d73 746f  bookmarks-in-sto
-000214d0: 7265 2729 3a0a 2020 2020 2020 2020 7265  re'):.        re
-000214e0: 7175 6972 656d 656e 7473 2e61 6464 2872  quirements.add(r
-000214f0: 6571 7569 7265 6d65 6e74 736d 6f64 2e42  equirementsmod.B
-00021500: 4f4f 4b4d 4152 4b53 5f49 4e5f 5354 4f52  OOKMARKS_IN_STOR
-00021510: 455f 5245 5155 4952 454d 454e 5429 0a0a  E_REQUIREMENT)..
-00021520: 2020 2020 6966 2075 692e 636f 6e66 6967      if ui.config
-00021530: 626f 6f6c 2862 2766 6f72 6d61 7427 2c20  bool(b'format', 
-00021540: 6227 7573 652d 7065 7273 6973 7465 6e74  b'use-persistent
-00021550: 2d6e 6f64 656d 6170 2729 3a0a 2020 2020  -nodemap'):.    
-00021560: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
-00021570: 2e61 6464 2872 6571 7569 7265 6d65 6e74  .add(requirement
-00021580: 736d 6f64 2e4e 4f44 454d 4150 5f52 4551  smod.NODEMAP_REQ
-00021590: 5549 5245 4d45 4e54 290a 0a20 2020 2023  UIREMENT)..    #
-000215a0: 2069 6620 7368 6172 652d 7361 6665 2069   if share-safe i
-000215b0: 7320 656e 6162 6c65 642c 206c 6574 2773  s enabled, let's
-000215c0: 2063 7265 6174 6520 7468 6520 6e65 7720   create the new 
-000215d0: 7265 706f 7369 746f 7279 2077 6974 6820  repository with 
-000215e0: 7468 6520 6e65 770a 2020 2020 2320 7265  the new.    # re
-000215f0: 7175 6972 656d 656e 740a 2020 2020 6966  quirement.    if
-00021600: 2075 692e 636f 6e66 6967 626f 6f6c 2862   ui.configbool(b
-00021610: 2766 6f72 6d61 7427 2c20 6227 7573 652d  'format', b'use-
-00021620: 7368 6172 652d 7361 6665 2729 3a0a 2020  share-safe'):.  
-00021630: 2020 2020 2020 7265 7175 6972 656d 656e        requiremen
-00021640: 7473 2e61 6464 2872 6571 7569 7265 6d65  ts.add(requireme
-00021650: 6e74 736d 6f64 2e53 4841 5245 5341 4645  ntsmod.SHARESAFE
-00021660: 5f52 4551 5549 5245 4d45 4e54 290a 0a20  _REQUIREMENT).. 
-00021670: 2020 2023 2069 6620 7765 2061 7265 2063     # if we are c
-00021680: 7265 6174 696e 6720 6120 7368 6172 652d  reating a share-
-00021690: 7265 706f c2b9 2020 7765 2068 6176 6520  repo..  we have 
-000216a0: 746f 2068 616e 646c 6520 7265 7175 6972  to handle requir
-000216b0: 656d 656e 740a 2020 2020 2320 6469 6666  ement.    # diff
-000216c0: 6572 656e 746c 792e 0a20 2020 2023 0a20  erently..    #. 
-000216d0: 2020 2023 205b 315d 2028 692e 652e 2072     # [1] (i.e. r
-000216e0: 6575 7369 6e67 2074 6865 2073 746f 7265  eusing the store
-000216f0: 2066 726f 6d20 616e 6f74 6865 7220 7265   from another re
-00021700: 706f 7369 746f 7279 2c20 6a75 7374 2068  pository, just h
-00021710: 6176 696e 6720 610a 2020 2020 2320 776f  aving a.    # wo
-00021720: 726b 696e 6720 636f 7079 290a 2020 2020  rking copy).    
-00021730: 6966 2062 2773 6861 7265 6472 6570 6f27  if b'sharedrepo'
-00021740: 2069 6e20 6372 6561 7465 6f70 7473 3a0a   in createopts:.
-00021750: 2020 2020 2020 2020 736f 7572 6365 5f72          source_r
-00021760: 6571 7569 7265 6d65 6e74 7320 3d20 7365  equirements = se
-00021770: 7428 6372 6561 7465 6f70 7473 5b62 2773  t(createopts[b's
-00021780: 6861 7265 6472 6570 6f27 5d2e 7265 7175  haredrepo'].requ
-00021790: 6972 656d 656e 7473 290a 0a20 2020 2020  irements)..     
-000217a0: 2020 2069 6620 7265 7175 6972 656d 656e     if requiremen
-000217b0: 7473 6d6f 642e 5348 4152 4553 4146 455f  tsmod.SHARESAFE_
-000217c0: 5245 5155 4952 454d 454e 5420 6e6f 7420  REQUIREMENT not 
-000217d0: 696e 2073 6f75 7263 655f 7265 7175 6972  in source_requir
-000217e0: 656d 656e 7473 3a0a 2020 2020 2020 2020  ements:.        
-000217f0: 2020 2020 2320 7368 6172 6520 746f 2061      # share to a
-00021800: 6e20 6f6c 6420 7363 686f 6f6c 2072 6570  n old school rep
-00021810: 6f73 6974 6f72 792c 2077 6520 6861 7665  ository, we have
-00021820: 2074 6f20 636f 7079 2074 6865 0a20 2020   to copy the.   
-00021830: 2020 2020 2020 2020 2023 2072 6571 7569           # requi
-00021840: 7265 6d65 6e74 7320 616e 6420 686f 7065  rements and hope
-00021850: 2066 6f72 2074 6865 2062 6573 742e 0a20   for the best.. 
-00021860: 2020 2020 2020 2020 2020 2072 6571 7569             requi
-00021870: 7265 6d65 6e74 7320 3d20 736f 7572 6365  rements = source
-00021880: 5f72 6571 7569 7265 6d65 6e74 730a 2020  _requirements.  
-00021890: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000218a0: 2020 2020 2020 2020 2320 5765 2068 6176          # We hav
-000218b0: 6520 636f 6e74 726f 6c20 6f6e 2074 6865  e control on the
-000218c0: 2077 6f72 6b69 6e67 2063 6f70 7920 6f6e   working copy on
-000218d0: 6c79 2c20 736f 2022 636f 7079 2220 7468  ly, so "copy" th
-000218e0: 6520 6e6f 6e0a 2020 2020 2020 2020 2020  e non.          
-000218f0: 2020 2320 776f 726b 696e 6720 636f 7079    # working copy
-00021900: 2070 6172 7420 6f76 6572 2c20 6967 6e6f   part over, igno
-00021910: 7269 6e67 2070 7265 7669 6f75 7320 6c6f  ring previous lo
-00021920: 6769 632e 0a20 2020 2020 2020 2020 2020  gic..           
-00021930: 2074 6f5f 6472 6f70 203d 2073 6574 2829   to_drop = set()
-00021940: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00021950: 2072 6571 2069 6e20 7265 7175 6972 656d   req in requirem
-00021960: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
-00021970: 2020 2020 2020 6966 2072 6571 2069 6e20        if req in 
-00021980: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
-00021990: 574f 524b 494e 475f 4449 525f 5245 5155  WORKING_DIR_REQU
-000219a0: 4952 454d 454e 5453 3a0a 2020 2020 2020  IREMENTS:.      
-000219b0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000219c0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-000219d0: 2020 2020 2020 2069 6620 7265 7120 696e         if req in
-000219e0: 2073 6f75 7263 655f 7265 7175 6972 656d   source_requirem
-000219f0: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
-00021a00: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00021a10: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00021a20: 2020 2074 6f5f 6472 6f70 2e61 6464 2872     to_drop.add(r
-00021a30: 6571 290a 2020 2020 2020 2020 2020 2020  eq).            
-00021a40: 7265 7175 6972 656d 656e 7473 202d 3d20  requirements -= 
-00021a50: 746f 5f64 726f 700a 2020 2020 2020 2020  to_drop.        
-00021a60: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
-00021a70: 207c 3d20 736f 7572 6365 5f72 6571 7569   |= source_requi
-00021a80: 7265 6d65 6e74 730a 0a20 2020 2020 2020  rements..       
-00021a90: 2069 6620 6372 6561 7465 6f70 7473 2e67   if createopts.g
-00021aa0: 6574 2862 2773 6861 7265 6472 656c 6174  et(b'sharedrelat
-00021ab0: 6976 6527 293a 0a20 2020 2020 2020 2020  ive'):.         
-00021ac0: 2020 2072 6571 7569 7265 6d65 6e74 732e     requirements.
-00021ad0: 6164 6428 7265 7175 6972 656d 656e 7473  add(requirements
-00021ae0: 6d6f 642e 5245 4c41 5449 5645 5f53 4841  mod.RELATIVE_SHA
-00021af0: 5245 445f 5245 5155 4952 454d 454e 5429  RED_REQUIREMENT)
-00021b00: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00021b10: 2020 2020 2020 2020 2020 2072 6571 7569             requi
-00021b20: 7265 6d65 6e74 732e 6164 6428 7265 7175  rements.add(requ
-00021b30: 6972 656d 656e 7473 6d6f 642e 5348 4152  irementsmod.SHAR
-00021b40: 4544 5f52 4551 5549 5245 4d45 4e54 290a  ED_REQUIREMENT).
-00021b50: 0a20 2020 2069 6620 7569 2e63 6f6e 6669  .    if ui.confi
-00021b60: 6762 6f6f 6c28 6227 666f 726d 6174 272c  gbool(b'format',
-00021b70: 2062 2775 7365 2d64 6972 7374 6174 652d   b'use-dirstate-
-00021b80: 7472 6163 6b65 642d 6869 6e74 2729 3a0a  tracked-hint'):.
-00021b90: 2020 2020 2020 2020 7665 7273 696f 6e20          version 
-00021ba0: 3d20 7569 2e63 6f6e 6669 6769 6e74 2862  = ui.configint(b
-00021bb0: 2766 6f72 6d61 7427 2c20 6227 7573 652d  'format', b'use-
-00021bc0: 6469 7273 7461 7465 2d74 7261 636b 6564  dirstate-tracked
-00021bd0: 2d68 696e 742e 7665 7273 696f 6e27 290a  -hint.version').
-00021be0: 2020 2020 2020 2020 6d73 6720 3d20 5f28          msg = _(
-00021bf0: 6222 6967 6e6f 7269 6e67 2075 6e6b 6e6f  b"ignoring unkno
-00021c00: 776e 2074 7261 636b 6564 206b 6579 2076  wn tracked key v
-00021c10: 6572 7369 6f6e 3a20 2564 5c6e 2229 0a20  ersion: %d\n"). 
-00021c20: 2020 2020 2020 2068 696e 7420 3d20 5f28         hint = _(
-00021c30: 0a20 2020 2020 2020 2020 2020 2062 2273  .            b"s
-00021c40: 6565 2060 6867 2068 656c 7020 636f 6e66  ee `hg help conf
-00021c50: 6967 2e66 6f72 6d61 742e 7573 652d 6469  ig.format.use-di
-00021c60: 7273 7461 7465 2d74 7261 636b 6564 2d68  rstate-tracked-h
-00021c70: 696e 742d 7665 7273 696f 6e22 0a20 2020  int-version".   
-00021c80: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
-00021c90: 6620 7665 7273 696f 6e20 213d 2031 3a0a  f version != 1:.
-00021ca0: 2020 2020 2020 2020 2020 2020 7569 2e77              ui.w
-00021cb0: 6172 6e28 6d73 6720 2520 7665 7273 696f  arn(msg % versio
-00021cc0: 6e2c 2068 696e 743d 6869 6e74 290a 2020  n, hint=hint).  
-00021cd0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00021ce0: 2020 2020 2020 2020 7265 7175 6972 656d          requirem
-00021cf0: 656e 7473 2e61 6464 2872 6571 7569 7265  ents.add(require
-00021d00: 6d65 6e74 736d 6f64 2e44 4952 5354 4154  mentsmod.DIRSTAT
-00021d10: 455f 5452 4143 4b45 445f 4849 4e54 5f56  E_TRACKED_HINT_V
-00021d20: 3129 0a0a 2020 2020 7265 7475 726e 2072  1)..    return r
-00021d30: 6571 7569 7265 6d65 6e74 730a 0a0a 6465  equirements...de
-00021d40: 6620 6368 6563 6b72 6571 7569 7265 6d65  f checkrequireme
-00021d50: 6e74 7363 6f6d 7061 7428 7569 2c20 7265  ntscompat(ui, re
-00021d60: 7175 6972 656d 656e 7473 293a 0a20 2020  quirements):.   
-00021d70: 2022 2222 4368 6563 6b73 2063 6f6d 7061   """Checks compa
-00021d80: 7469 6269 6c69 7479 206f 6620 7265 706f  tibility of repo
-00021d90: 7369 746f 7279 2072 6571 7569 7265 6d65  sitory requireme
-00021da0: 6e74 7320 656e 6162 6c65 6420 616e 6420  nts enabled and 
-00021db0: 6469 7361 626c 6564 2e0a 0a20 2020 2052  disabled...    R
-00021dc0: 6574 7572 6e73 2061 2073 6574 206f 6620  eturns a set of 
-00021dd0: 7265 7175 6972 656d 656e 7473 2077 6869  requirements whi
-00021de0: 6368 206e 6565 6473 2074 6f20 6265 2064  ch needs to be d
-00021df0: 726f 7070 6564 2062 6563 6175 7365 2064  ropped because d
-00021e00: 6570 656e 6465 6e64 0a20 2020 2072 6571  ependend.    req
-00021e10: 7569 7265 6d65 6e74 7320 6172 6520 6e6f  uirements are no
-00021e20: 7420 656e 6162 6c65 642e 2041 6c73 6f20  t enabled. Also 
-00021e30: 7761 726e 7320 7573 6572 7320 6162 6f75  warns users abou
-00021e40: 7420 6974 2222 220a 0a20 2020 2064 726f  t it"""..    dro
-00021e50: 7070 6564 203d 2073 6574 2829 0a0a 2020  pped = set()..  
-00021e60: 2020 6966 2072 6571 7569 7265 6d65 6e74    if requirement
-00021e70: 736d 6f64 2e53 544f 5245 5f52 4551 5549  smod.STORE_REQUI
-00021e80: 5245 4d45 4e54 206e 6f74 2069 6e20 7265  REMENT not in re
-00021e90: 7175 6972 656d 656e 7473 3a0a 2020 2020  quirements:.    
-00021ea0: 2020 2020 6966 2072 6571 7569 7265 6d65      if requireme
-00021eb0: 6e74 736d 6f64 2e42 4f4f 4b4d 4152 4b53  ntsmod.BOOKMARKS
-00021ec0: 5f49 4e5f 5354 4f52 455f 5245 5155 4952  _IN_STORE_REQUIR
-00021ed0: 454d 454e 5420 696e 2072 6571 7569 7265  EMENT in require
-00021ee0: 6d65 6e74 733a 0a20 2020 2020 2020 2020  ments:.         
-00021ef0: 2020 2075 692e 7761 726e 280a 2020 2020     ui.warn(.    
-00021f00: 2020 2020 2020 2020 2020 2020 5f28 0a20              _(. 
-00021f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021f20: 2020 2062 2769 676e 6f72 696e 6720 656e     b'ignoring en
-00021f30: 6162 6c65 6420 5c27 666f 726d 6174 2e62  abled \'format.b
-00021f40: 6f6f 6b6d 6172 6b73 2d69 6e2d 7374 6f72  ookmarks-in-stor
-00021f50: 655c 2720 636f 6e66 6967 2027 0a20 2020  e\' config '.   
+000161d0: 2020 2020 2020 7461 6773 6d6f 642e 7772        tagsmod.wr
+000161e0: 6974 6564 6966 6628 6368 616e 6765 7366  itediff(changesf
+000161f0: 696c 652c 2063 6861 6e67 6573 290a 0a20  ile, changes).. 
+00016200: 2020 2020 2020 2064 6566 2076 616c 6964         def valid
+00016210: 6174 6528 7472 3229 3a0a 2020 2020 2020  ate(tr2):.      
+00016220: 2020 2020 2020 2222 2277 696c 6c20 7275        """will ru
+00016230: 6e20 7072 652d 636c 6f73 696e 6720 686f  n pre-closing ho
+00016240: 6f6b 7322 2222 0a20 2020 2020 2020 2020  oks""".         
+00016250: 2020 2023 2058 5858 2074 6865 2074 7261     # XXX the tra
+00016260: 6e73 6163 7469 6f6e 2041 5049 2069 7320  nsaction API is 
+00016270: 6120 6269 7420 6c61 636b 696e 6720 6865  a bit lacking he
+00016280: 7265 2073 6f20 7765 2074 616b 6520 6120  re so we take a 
+00016290: 6861 636b 790a 2020 2020 2020 2020 2020  hacky.          
+000162a0: 2020 2320 7061 7468 2066 6f72 206e 6f77    # path for now
+000162b0: 0a20 2020 2020 2020 2020 2020 2023 0a20  .            #. 
+000162c0: 2020 2020 2020 2020 2020 2023 2057 6520             # We 
+000162d0: 6361 6e6e 6f74 2061 6464 2074 6869 7320  cannot add this 
+000162e0: 6173 2061 2022 7065 6e64 696e 6722 2068  as a "pending" h
+000162f0: 6f6f 6b73 2073 696e 6365 2074 6865 2027  ooks since the '
+00016300: 7472 2e68 6f6f 6b61 7267 7327 0a20 2020  tr.hookargs'.   
+00016310: 2020 2020 2020 2020 2023 2064 6963 7420           # dict 
+00016320: 6973 2063 6f70 6965 6420 6265 666f 7265  is copied before
+00016330: 2074 6865 7365 2072 756e 2e20 496e 2061   these run. In a
+00016340: 6464 6974 696f 6e20 7765 206e 6565 6473  ddition we needs
+00016350: 2074 6865 2064 6174 610a 2020 2020 2020   the data.      
+00016360: 2020 2020 2020 2320 6176 6169 6c61 626c        # availabl
+00016370: 6520 746f 2069 6e20 6d65 6d6f 7279 2068  e to in memory h
+00016380: 6f6f 6b73 2074 6f6f 2e0a 2020 2020 2020  ooks too..      
+00016390: 2020 2020 2020 230a 2020 2020 2020 2020        #.        
+000163a0: 2020 2020 2320 4d6f 7265 6f76 6572 2c20      # Moreover, 
+000163b0: 7765 2061 6c73 6f20 6e65 6564 2074 6f20  we also need to 
+000163c0: 6d61 6b65 2073 7572 6520 7468 6973 2072  make sure this r
+000163d0: 756e 7320 6265 666f 7265 2074 786e 636c  uns before txncl
+000163e0: 6f73 650a 2020 2020 2020 2020 2020 2020  ose.            
+000163f0: 2320 686f 6f6b 7320 616e 6420 7468 6572  # hooks and ther
+00016400: 6520 6973 206e 6f20 2270 656e 6469 6e67  e is no "pending
+00016410: 2220 6d65 6368 616e 6973 6d20 7468 6174  " mechanism that
+00016420: 2077 6f75 6c64 2065 7865 6375 7465 0a20   would execute. 
+00016430: 2020 2020 2020 2020 2020 2023 206c 6f67             # log
+00016440: 6963 206f 6e6c 7920 6966 2068 6f6f 6b73  ic only if hooks
+00016450: 2061 7265 2061 626f 7574 2074 6f20 7275   are about to ru
+00016460: 6e2e 0a20 2020 2020 2020 2020 2020 2023  n..            #
+00016470: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
+00016480: 6978 696e 6720 7468 6973 206c 696d 6974  ixing this limit
+00016490: 6174 696f 6e20 6f66 2074 6865 2074 7261  ation of the tra
+000164a0: 6e73 6163 7469 6f6e 2069 7320 616c 736f  nsaction is also
+000164b0: 206e 6565 6465 6420 746f 2074 7261 636b   needed to track
+000164c0: 0a20 2020 2020 2020 2020 2020 2023 206f  .            # o
+000164d0: 7468 6572 2066 616d 696c 6965 7320 6f66  ther families of
+000164e0: 2063 6861 6e67 6573 2028 626f 6f6b 6d61   changes (bookma
+000164f0: 726b 732c 2070 6861 7365 732c 206f 6273  rks, phases, obs
+00016500: 6f6c 6573 6365 6e63 6529 2e0a 2020 2020  olescence)..    
+00016510: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
+00016520: 2020 2020 2020 2320 5468 6973 2077 696c        # This wil
+00016530: 6c20 6861 7665 2074 6f20 6265 2066 6978  l have to be fix
+00016540: 6564 2062 6566 6f72 6520 7765 2072 656d  ed before we rem
+00016550: 6f76 6520 7468 6520 6578 7065 7269 6d65  ove the experime
+00016560: 6e74 616c 0a20 2020 2020 2020 2020 2020  ntal.           
+00016570: 2023 2067 6174 696e 672e 0a20 2020 2020   # gating..     
+00016580: 2020 2020 2020 2074 7261 636b 7461 6773         tracktags
+00016590: 2874 7232 290a 2020 2020 2020 2020 2020  (tr2).          
+000165a0: 2020 7265 706f 203d 2072 6570 6f72 6566    repo = reporef
+000165b0: 2829 0a20 2020 2020 2020 2020 2020 2061  ().            a
+000165c0: 7373 6572 7420 7265 706f 2069 7320 6e6f  ssert repo is no
+000165d0: 7420 4e6f 6e65 2020 2320 6865 6c70 2070  t None  # help p
+000165e0: 7974 7970 650a 0a20 2020 2020 2020 2020  ytype..         
+000165f0: 2020 2073 696e 676c 6568 6561 646f 7074     singleheadopt
+00016600: 203d 2028 6227 6578 7065 7269 6d65 6e74   = (b'experiment
+00016610: 616c 272c 2062 2773 696e 676c 652d 6865  al', b'single-he
+00016620: 6164 2d70 6572 2d62 7261 6e63 6827 290a  ad-per-branch').
+00016630: 2020 2020 2020 2020 2020 2020 7369 6e67              sing
+00016640: 6c65 6865 6164 203d 2072 6570 6f2e 7569  lehead = repo.ui
+00016650: 2e63 6f6e 6669 6762 6f6f 6c28 2a73 696e  .configbool(*sin
+00016660: 676c 6568 6561 646f 7074 290a 2020 2020  gleheadopt).    
+00016670: 2020 2020 2020 2020 6966 2073 696e 676c          if singl
+00016680: 6568 6561 643a 0a20 2020 2020 2020 2020  ehead:.         
+00016690: 2020 2020 2020 2073 696e 676c 6568 6561         singlehea
+000166a0: 6473 7562 203d 2072 6570 6f2e 7569 2e63  dsub = repo.ui.c
+000166b0: 6f6e 6669 6773 7562 6f70 7469 6f6e 7328  onfigsuboptions(
+000166c0: 2a73 696e 676c 6568 6561 646f 7074 295b  *singleheadopt)[
+000166d0: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+000166e0: 2020 2061 6363 6f75 6e74 636c 6f73 6564     accountclosed
+000166f0: 203d 2073 696e 676c 6568 6561 6473 7562   = singleheadsub
+00016700: 2e67 6574 280a 2020 2020 2020 2020 2020  .get(.          
+00016710: 2020 2020 2020 2020 2020 6222 6163 636f            b"acco
+00016720: 756e 742d 636c 6f73 6564 2d68 6561 6473  unt-closed-heads
+00016730: 222c 2046 616c 7365 0a20 2020 2020 2020  ", False.       
+00016740: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00016750: 2020 2020 2020 2020 2020 2069 6620 7369             if si
+00016760: 6e67 6c65 6865 6164 7375 622e 6765 7428  ngleheadsub.get(
+00016770: 6222 7075 626c 6963 2d63 6861 6e67 6573  b"public-changes
+00016780: 2d6f 6e6c 7922 2c20 4661 6c73 6529 3a0a  -only", False):.
+00016790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000167a0: 2020 2020 6669 6c74 6572 6e61 6d65 203d      filtername =
+000167b0: 2062 2269 6d6d 7574 6162 6c65 220a 2020   b"immutable".  
+000167c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000167d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000167e0: 2020 2020 2020 2020 6669 6c74 6572 6e61          filterna
+000167f0: 6d65 203d 2062 2276 6973 6962 6c65 220a  me = b"visible".
+00016800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016810: 7363 6d75 7469 6c2e 656e 666f 7263 6573  scmutil.enforces
+00016820: 696e 676c 6568 6561 6428 0a20 2020 2020  inglehead(.     
+00016830: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00016840: 6570 6f2c 2074 7232 2c20 6465 7363 2c20  epo, tr2, desc, 
+00016850: 6163 636f 756e 7463 6c6f 7365 642c 2066  accountclosed, f
+00016860: 696c 7465 726e 616d 650a 2020 2020 2020  iltername.      
+00016870: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00016880: 2020 2020 2020 2020 6966 2068 6f6f 6b2e          if hook.
+00016890: 6861 7368 6f6f 6b28 7265 706f 2e75 692c  hashook(repo.ui,
+000168a0: 2062 2770 7265 7478 6e63 6c6f 7365 2d62   b'pretxnclose-b
+000168b0: 6f6f 6b6d 6172 6b27 293a 0a20 2020 2020  ookmark'):.     
+000168c0: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
+000168d0: 616d 652c 2028 6f6c 642c 206e 6577 2920  ame, (old, new) 
+000168e0: 696e 2073 6f72 7465 6428 0a20 2020 2020  in sorted(.     
+000168f0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00016900: 722e 6368 616e 6765 735b 6227 626f 6f6b  r.changes[b'book
+00016910: 6d61 726b 7327 5d2e 6974 656d 7328 290a  marks'].items().
+00016920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016930: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00016940: 2020 2020 2020 2061 7267 7320 3d20 7472         args = tr
+00016950: 2e68 6f6f 6b61 7267 732e 636f 7079 2829  .hookargs.copy()
+00016960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016970: 2020 2020 2061 7267 732e 7570 6461 7465       args.update
+00016980: 2862 6f6f 6b6d 6172 6b73 2e70 7265 7061  (bookmarks.prepa
+00016990: 7265 686f 6f6b 6172 6773 286e 616d 652c  rehookargs(name,
+000169a0: 206f 6c64 2c20 6e65 7729 290a 2020 2020   old, new)).    
+000169b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169c0: 7265 706f 2e68 6f6f 6b28 0a20 2020 2020  repo.hook(.     
+000169d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169e0: 2020 2062 2770 7265 7478 6e63 6c6f 7365     b'pretxnclose
+000169f0: 2d62 6f6f 6b6d 6172 6b27 2c0a 2020 2020  -bookmark',.    
+00016a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a10: 2020 2020 7468 726f 773d 5472 7565 2c0a      throw=True,.
+00016a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a30: 2020 2020 2020 2020 2a2a 7079 636f 6d70          **pycomp
+00016a40: 6174 2e73 7472 6b77 6172 6773 2861 7267  at.strkwargs(arg
+00016a50: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00016a60: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00016a70: 2020 2020 2069 6620 686f 6f6b 2e68 6173       if hook.has
+00016a80: 686f 6f6b 2872 6570 6f2e 7569 2c20 6227  hook(repo.ui, b'
+00016a90: 7072 6574 786e 636c 6f73 652d 7068 6173  pretxnclose-phas
+00016aa0: 6527 293a 0a20 2020 2020 2020 2020 2020  e'):.           
+00016ab0: 2020 2020 2063 6c20 3d20 7265 706f 2e75       cl = repo.u
+00016ac0: 6e66 696c 7465 7265 6428 292e 6368 616e  nfiltered().chan
+00016ad0: 6765 6c6f 670a 2020 2020 2020 2020 2020  gelog.          
+00016ae0: 2020 2020 2020 666f 7220 7265 7673 2c20        for revs, 
+00016af0: 286f 6c64 2c20 6e65 7729 2069 6e20 7472  (old, new) in tr
+00016b00: 2e63 6861 6e67 6573 5b62 2770 6861 7365  .changes[b'phase
+00016b10: 7327 5d3a 0a20 2020 2020 2020 2020 2020  s']:.           
+00016b20: 2020 2020 2020 2020 2066 6f72 2072 6576           for rev
+00016b30: 2069 6e20 7265 7673 3a0a 2020 2020 2020   in revs:.      
+00016b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b50: 2020 6172 6773 203d 2074 722e 686f 6f6b    args = tr.hook
+00016b60: 6172 6773 2e63 6f70 7928 290a 2020 2020  args.copy().    
+00016b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b80: 2020 2020 6e6f 6465 203d 2068 6578 2863      node = hex(c
+00016b90: 6c2e 6e6f 6465 2872 6576 2929 0a20 2020  l.node(rev)).   
+00016ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bb0: 2020 2020 2061 7267 732e 7570 6461 7465       args.update
+00016bc0: 2870 6861 7365 732e 7072 6570 6172 6568  (phases.prepareh
+00016bd0: 6f6f 6b61 7267 7328 6e6f 6465 2c20 6f6c  ookargs(node, ol
+00016be0: 642c 206e 6577 2929 0a20 2020 2020 2020  d, new)).       
+00016bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c00: 2072 6570 6f2e 686f 6f6b 280a 2020 2020   repo.hook(.    
+00016c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c20: 2020 2020 2020 2020 6227 7072 6574 786e          b'pretxn
+00016c30: 636c 6f73 652d 7068 6173 6527 2c0a 2020  close-phase',.  
+00016c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c50: 2020 2020 2020 2020 2020 7468 726f 773d            throw=
+00016c60: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+00016c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c80: 2020 2a2a 7079 636f 6d70 6174 2e73 7472    **pycompat.str
+00016c90: 6b77 6172 6773 2861 7267 7329 0a20 2020  kwargs(args).   
+00016ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cb0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00016cc0: 2020 2020 7265 706f 2e68 6f6f 6b28 0a20      repo.hook(. 
+00016cd0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00016ce0: 2770 7265 7478 6e63 6c6f 7365 272c 2074  'pretxnclose', t
+00016cf0: 6872 6f77 3d54 7275 652c 202a 2a70 7963  hrow=True, **pyc
+00016d00: 6f6d 7061 742e 7374 726b 7761 7267 7328  ompat.strkwargs(
+00016d10: 7472 2e68 6f6f 6b61 7267 7329 0a20 2020  tr.hookargs).   
+00016d20: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00016d30: 2020 2020 6465 6620 7265 6c65 6173 6566      def releasef
+00016d40: 6e28 7472 2c20 7375 6363 6573 7329 3a0a  n(tr, success):.
+00016d50: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+00016d60: 203d 2072 6570 6f72 6566 2829 0a20 2020   = reporef().   
+00016d70: 2020 2020 2020 2020 2069 6620 7265 706f           if repo
+00016d80: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00016d90: 2020 2020 2020 2020 2020 2320 4966 2074            # If t
+00016da0: 6865 2072 6570 6f20 6861 7320 6265 656e  he repo has been
+00016db0: 2047 4327 6420 2861 6e64 2074 6869 7320   GC'd (and this 
+00016dc0: 7265 6c65 6173 6520 6675 6e63 7469 6f6e  release function
+00016dd0: 2069 7320 6265 696e 670a 2020 2020 2020   is being.      
+00016de0: 2020 2020 2020 2020 2020 2320 6361 6c6c            # call
+00016df0: 6564 2066 726f 6d20 7472 616e 7361 6374  ed from transact
+00016e00: 696f 6e2e 5f5f 6465 6c5f 5f29 2c20 7468  ion.__del__), th
+00016e10: 6572 6527 7320 6e6f 7420 6d75 6368 2077  ere's not much w
+00016e20: 6520 6361 6e20 646f 2c0a 2020 2020 2020  e can do,.      
+00016e30: 2020 2020 2020 2020 2020 2320 736f 206a            # so j
+00016e40: 7573 7420 6c65 6176 6520 7468 6520 756e  ust leave the un
+00016e50: 6669 6e69 7368 6564 2074 7261 6e73 6163  finished transac
+00016e60: 7469 6f6e 2074 6865 7265 2061 6e64 206c  tion there and l
+00016e70: 6574 2074 6865 0a20 2020 2020 2020 2020  et the.         
+00016e80: 2020 2020 2020 2023 2075 7365 7220 7275         # user ru
+00016e90: 6e20 6068 6720 7265 636f 7665 7260 2e0a  n `hg recover`..
+00016ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016eb0: 7265 7475 726e 0a20 2020 2020 2020 2020  return.         
+00016ec0: 2020 2069 6620 7375 6363 6573 733a 0a20     if success:. 
+00016ed0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00016ee0: 2074 6869 7320 7368 6f75 6c64 2062 6520   this should be 
+00016ef0: 6578 706c 6963 6974 6c79 2069 6e76 6f6b  explicitly invok
+00016f00: 6564 2068 6572 652c 2062 6563 6175 7365  ed here, because
+00016f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016f20: 2023 2069 6e2d 6d65 6d6f 7279 2063 6861   # in-memory cha
+00016f30: 6e67 6573 2061 7265 6e27 7420 7772 6974  nges aren't writ
+00016f40: 7465 6e20 6f75 7420 6174 2063 6c6f 7369  ten out at closi
+00016f50: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
+00016f60: 2020 2023 2074 7261 6e73 6163 7469 6f6e     # transaction
+00016f70: 2c20 6966 2074 722e 6164 6466 696c 6567  , if tr.addfileg
+00016f80: 656e 6572 6174 6f72 2028 7669 610a 2020  enerator (via.  
+00016f90: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00016fa0: 6469 7273 7461 7465 2e77 7269 7465 206f  dirstate.write o
+00016fb0: 7220 736f 2920 6973 6e27 7420 696e 766f  r so) isn't invo
+00016fc0: 6b65 6420 7768 696c 650a 2020 2020 2020  ked while.      
+00016fd0: 2020 2020 2020 2020 2020 2320 7472 616e            # tran
+00016fe0: 7361 6374 696f 6e20 7275 6e6e 696e 670a  saction running.
+00016ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017000: 7265 706f 2e64 6972 7374 6174 652e 7772  repo.dirstate.wr
+00017010: 6974 6528 4e6f 6e65 290a 2020 2020 2020  ite(None).      
+00017020: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00017030: 2020 2020 2020 2020 2020 2020 2320 6469              # di
+00017040: 7363 6172 6420 616c 6c20 6368 616e 6765  scard all change
+00017050: 7320 2869 6e63 6c75 6469 6e67 206f 6e65  s (including one
+00017060: 7320 616c 7265 6164 7920 7772 6974 7465  s already writte
+00017070: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00017080: 2020 2320 6f75 7429 2069 6e20 7468 6973    # out) in this
+00017090: 2074 7261 6e73 6163 7469 6f6e 0a20 2020   transaction.   
+000170a0: 2020 2020 2020 2020 2020 2020 2072 6570               rep
+000170b0: 6f2e 696e 7661 6c69 6461 7465 2863 6c65  o.invalidate(cle
+000170c0: 6172 6669 6c65 6361 6368 653d 5472 7565  arfilecache=True
+000170d0: 290a 0a20 2020 2020 2020 2074 7220 3d20  )..        tr = 
+000170e0: 7472 616e 7361 6374 696f 6e2e 7472 616e  transaction.tran
+000170f0: 7361 6374 696f 6e28 0a20 2020 2020 2020  saction(.       
+00017100: 2020 2020 2072 702c 0a20 2020 2020 2020       rp,.       
+00017110: 2020 2020 2073 656c 662e 7376 6673 2c0a       self.svfs,.
+00017120: 2020 2020 2020 2020 2020 2020 7666 736d              vfsm
+00017130: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
+00017140: 6222 6a6f 7572 6e61 6c22 2c0a 2020 2020  b"journal",.    
+00017150: 2020 2020 2020 2020 6222 756e 646f 222c          b"undo",
+00017160: 0a20 2020 2020 2020 2020 2020 206c 616d  .            lam
+00017170: 6264 613a 204e 6f6e 652c 0a20 2020 2020  bda: None,.     
+00017180: 2020 2020 2020 2073 656c 662e 7374 6f72         self.stor
+00017190: 652e 6372 6561 7465 6d6f 6465 2c0a 2020  e.createmode,.  
+000171a0: 2020 2020 2020 2020 2020 7661 6c69 6461            valida
+000171b0: 746f 723d 7661 6c69 6461 7465 2c0a 2020  tor=validate,.  
+000171c0: 2020 2020 2020 2020 2020 7265 6c65 6173            releas
+000171d0: 6566 6e3d 7265 6c65 6173 6566 6e2c 0a20  efn=releasefn,. 
+000171e0: 2020 2020 2020 2020 2020 2063 6865 636b             check
+000171f0: 616d 6269 6766 696c 6573 3d5f 6361 6368  ambigfiles=_cach
+00017200: 6564 6669 6c65 732c 0a20 2020 2020 2020  edfiles,.       
+00017210: 2020 2020 206e 616d 653d 6465 7363 2c0a       name=desc,.
+00017220: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00017230: 2020 666f 7220 7666 735f 6964 2c20 7061    for vfs_id, pa
+00017240: 7468 2069 6e20 7365 6c66 2e5f 6a6f 7572  th in self._jour
+00017250: 6e61 6c66 696c 6573 2829 3a0a 2020 2020  nalfiles():.    
+00017260: 2020 2020 2020 2020 7472 2e61 6464 5f6a          tr.add_j
+00017270: 6f75 726e 616c 2876 6673 5f69 642c 2070  ournal(vfs_id, p
+00017280: 6174 6829 0a20 2020 2020 2020 2074 722e  ath).        tr.
+00017290: 6368 616e 6765 735b 6227 6f72 6967 7265  changes[b'origre
+000172a0: 706f 6c65 6e27 5d20 3d20 6c65 6e28 7365  polen'] = len(se
+000172b0: 6c66 290a 2020 2020 2020 2020 7472 2e63  lf).        tr.c
+000172c0: 6861 6e67 6573 5b62 276f 6273 6d61 726b  hanges[b'obsmark
+000172d0: 6572 7327 5d20 3d20 7365 7428 290a 2020  ers'] = set().  
+000172e0: 2020 2020 2020 7472 2e63 6861 6e67 6573        tr.changes
+000172f0: 5b62 2770 6861 7365 7327 5d20 3d20 5b5d  [b'phases'] = []
+00017300: 0a20 2020 2020 2020 2074 722e 6368 616e  .        tr.chan
+00017310: 6765 735b 6227 626f 6f6b 6d61 726b 7327  ges[b'bookmarks'
+00017320: 5d20 3d20 7b7d 0a0a 2020 2020 2020 2020  ] = {}..        
+00017330: 7472 2e68 6f6f 6b61 7267 735b 6227 7478  tr.hookargs[b'tx
+00017340: 6e69 6427 5d20 3d20 7478 6e69 640a 2020  nid'] = txnid.  
+00017350: 2020 2020 2020 7472 2e68 6f6f 6b61 7267        tr.hookarg
+00017360: 735b 6227 7478 6e6e 616d 6527 5d20 3d20  s[b'txnname'] = 
+00017370: 6465 7363 0a20 2020 2020 2020 2074 722e  desc.        tr.
+00017380: 686f 6f6b 6172 6773 5b62 2763 6861 6e67  hookargs[b'chang
+00017390: 6573 275d 203d 2074 722e 6368 616e 6765  es'] = tr.change
+000173a0: 730a 2020 2020 2020 2020 2320 6e6f 7465  s.        # note
+000173b0: 3a20 7772 6974 696e 6720 7468 6520 666e  : writing the fn
+000173c0: 6361 6368 6520 6f6e 6c79 2064 7572 696e  cache only durin
+000173d0: 6720 6669 6e61 6c69 7a65 206d 6561 6e20  g finalize mean 
+000173e0: 7468 6174 2074 6865 2066 696c 6520 6973  that the file is
+000173f0: 0a20 2020 2020 2020 2023 206f 7574 6461  .        # outda
+00017400: 7465 6420 7768 656e 2072 756e 6e69 6e67  ted when running
+00017410: 2068 6f6f 6b73 2e20 4173 2066 6e63 6163   hooks. As fncac
+00017420: 6865 2069 7320 7573 6564 2066 6f72 2073  he is used for s
+00017430: 7472 6561 6d69 6e67 2063 6c6f 6e65 2c0a  treaming clone,.
+00017440: 2020 2020 2020 2020 2320 7468 6973 2069          # this i
+00017450: 7320 6e6f 7420 6578 7065 6374 6564 2074  s not expected t
+00017460: 6f20 6272 6561 6b20 616e 7974 6869 6e67  o break anything
+00017470: 2074 6861 7420 6861 7070 656e 2064 7572   that happen dur
+00017480: 696e 6720 7468 6520 686f 6f6b 732e 0a20  ing the hooks.. 
+00017490: 2020 2020 2020 2074 722e 6164 6466 696e         tr.addfin
+000174a0: 616c 697a 6528 6227 666c 7573 682d 666e  alize(b'flush-fn
+000174b0: 6361 6368 6527 2c20 7365 6c66 2e73 746f  cache', self.sto
+000174c0: 7265 2e77 7269 7465 290a 0a20 2020 2020  re.write)..     
+000174d0: 2020 2064 6566 2074 786e 636c 6f73 6568     def txncloseh
+000174e0: 6f6f 6b28 7472 3229 3a0a 2020 2020 2020  ook(tr2):.      
+000174f0: 2020 2020 2020 2222 2254 6f20 6265 2072        """To be r
+00017500: 756e 2069 6620 7472 616e 7361 6374 696f  un if transactio
+00017510: 6e20 6973 2073 7563 6365 7373 6675 6c2c  n is successful,
+00017520: 2077 696c 6c20 7363 6865 6475 6c65 2061   will schedule a
+00017530: 2068 6f6f 6b20 7275 6e22 2222 0a20 2020   hook run""".   
+00017540: 2020 2020 2020 2020 2023 2044 6f6e 2774           # Don't
+00017550: 2072 6566 6572 656e 6365 2074 7232 2069   reference tr2 i
+00017560: 6e20 686f 6f6b 2829 2073 6f20 7765 2064  n hook() so we d
+00017570: 6f6e 2774 2068 6f6c 6420 6120 7265 6665  on't hold a refe
+00017580: 7265 6e63 652e 0a20 2020 2020 2020 2020  rence..         
+00017590: 2020 2023 2054 6869 7320 7265 6475 6365     # This reduce
+000175a0: 7320 6d65 6d6f 7279 2063 6f6e 7375 6d70  s memory consump
+000175b0: 7469 6f6e 2077 6865 6e20 7468 6572 6520  tion when there 
+000175c0: 6172 6520 6d75 6c74 6970 6c65 0a20 2020  are multiple.   
+000175d0: 2020 2020 2020 2020 2023 2074 7261 6e73           # trans
+000175e0: 6163 7469 6f6e 7320 7065 7220 6c6f 636b  actions per lock
+000175f0: 2e20 5468 6973 2063 616e 206c 696b 656c  . This can likel
+00017600: 7920 676f 2061 7761 7920 6966 2069 7373  y go away if iss
+00017610: 7565 3530 3435 0a20 2020 2020 2020 2020  ue5045.         
+00017620: 2020 2023 2066 6978 6573 2074 6865 2066     # fixes the f
+00017630: 756e 6374 696f 6e20 6163 6375 6d75 6c61  unction accumula
+00017640: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
+00017650: 2020 686f 6f6b 6172 6773 203d 2074 7232    hookargs = tr2
+00017660: 2e68 6f6f 6b61 7267 730a 0a20 2020 2020  .hookargs..     
+00017670: 2020 2020 2020 2064 6566 2068 6f6f 6b66         def hookf
+00017680: 756e 6328 756e 7573 6564 5f73 7563 6365  unc(unused_succe
+00017690: 7373 293a 0a20 2020 2020 2020 2020 2020  ss):.           
+000176a0: 2020 2020 2072 6570 6f20 3d20 7265 706f       repo = repo
+000176b0: 7265 6628 290a 2020 2020 2020 2020 2020  ref().          
+000176c0: 2020 2020 2020 6173 7365 7274 2072 6570        assert rep
+000176d0: 6f20 6973 206e 6f74 204e 6f6e 6520 2023  o is not None  #
+000176e0: 2068 656c 7020 7079 7479 7065 0a0a 2020   help pytype..  
+000176f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00017700: 2068 6f6f 6b2e 6861 7368 6f6f 6b28 7265   hook.hashook(re
+00017710: 706f 2e75 692c 2062 2774 786e 636c 6f73  po.ui, b'txnclos
+00017720: 652d 626f 6f6b 6d61 726b 2729 3a0a 2020  e-bookmark'):.  
+00017730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017740: 2020 626d 6368 616e 6765 7320 3d20 736f    bmchanges = so
+00017750: 7274 6564 2874 722e 6368 616e 6765 735b  rted(tr.changes[
+00017760: 6227 626f 6f6b 6d61 726b 7327 5d2e 6974  b'bookmarks'].it
+00017770: 656d 7328 2929 0a20 2020 2020 2020 2020  ems()).         
+00017780: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
+00017790: 616d 652c 2028 6f6c 642c 206e 6577 2920  ame, (old, new) 
+000177a0: 696e 2062 6d63 6861 6e67 6573 3a0a 2020  in bmchanges:.  
+000177b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177c0: 2020 2020 2020 6172 6773 203d 2074 722e        args = tr.
+000177d0: 686f 6f6b 6172 6773 2e63 6f70 7928 290a  hookargs.copy().
+000177e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177f0: 2020 2020 2020 2020 6172 6773 2e75 7064          args.upd
+00017800: 6174 6528 626f 6f6b 6d61 726b 732e 7072  ate(bookmarks.pr
+00017810: 6570 6172 6568 6f6f 6b61 7267 7328 6e61  eparehookargs(na
+00017820: 6d65 2c20 6f6c 642c 206e 6577 2929 0a20  me, old, new)). 
+00017830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017840: 2020 2020 2020 2072 6570 6f2e 686f 6f6b         repo.hook
+00017850: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00017860: 2020 2020 2020 2020 2020 2020 2020 6227                b'
+00017870: 7478 6e63 6c6f 7365 2d62 6f6f 6b6d 6172  txnclose-bookmar
+00017880: 6b27 2c0a 2020 2020 2020 2020 2020 2020  k',.            
+00017890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178a0: 7468 726f 773d 4661 6c73 652c 0a20 2020  throw=False,.   
+000178b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178c0: 2020 2020 2020 2020 202a 2a70 7963 6f6d           **pycom
+000178d0: 7061 742e 7374 726b 7761 7267 7328 6172  pat.strkwargs(ar
+000178e0: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
+000178f0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00017900: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00017910: 6620 686f 6f6b 2e68 6173 686f 6f6b 2872  f hook.hashook(r
+00017920: 6570 6f2e 7569 2c20 6227 7478 6e63 6c6f  epo.ui, b'txnclo
+00017930: 7365 2d70 6861 7365 2729 3a0a 2020 2020  se-phase'):.    
+00017940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017950: 636c 203d 2072 6570 6f2e 756e 6669 6c74  cl = repo.unfilt
+00017960: 6572 6564 2829 2e63 6861 6e67 656c 6f67  ered().changelog
+00017970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017980: 2020 2020 2070 6861 7365 6d76 203d 2073       phasemv = s
+00017990: 6f72 7465 6428 0a20 2020 2020 2020 2020  orted(.         
+000179a0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000179b0: 722e 6368 616e 6765 735b 6227 7068 6173  r.changes[b'phas
+000179c0: 6573 275d 2c20 6b65 793d 6c61 6d62 6461  es'], key=lambda
+000179d0: 2072 3a20 725b 305d 5b30 5d0a 2020 2020   r: r[0][0].    
+000179e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000179f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017a00: 2020 2020 2020 666f 7220 7265 7673 2c20        for revs, 
+00017a10: 286f 6c64 2c20 6e65 7729 2069 6e20 7068  (old, new) in ph
+00017a20: 6173 656d 763a 0a20 2020 2020 2020 2020  asemv:.         
+00017a30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00017a40: 6f72 2072 6576 2069 6e20 7265 7673 3a0a  or rev in revs:.
+00017a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a60: 2020 2020 2020 2020 2020 2020 6172 6773              args
+00017a70: 203d 2074 722e 686f 6f6b 6172 6773 2e63   = tr.hookargs.c
+00017a80: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
+00017a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017aa0: 2020 6e6f 6465 203d 2068 6578 2863 6c2e    node = hex(cl.
+00017ab0: 6e6f 6465 2872 6576 2929 0a20 2020 2020  node(rev)).     
+00017ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ad0: 2020 2020 2020 2061 7267 732e 7570 6461         args.upda
+00017ae0: 7465 2870 6861 7365 732e 7072 6570 6172  te(phases.prepar
+00017af0: 6568 6f6f 6b61 7267 7328 6e6f 6465 2c20  ehookargs(node, 
+00017b00: 6f6c 642c 206e 6577 2929 0a20 2020 2020  old, new)).     
+00017b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b20: 2020 2020 2020 2072 6570 6f2e 686f 6f6b         repo.hook
+00017b30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00017b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b50: 2020 6227 7478 6e63 6c6f 7365 2d70 6861    b'txnclose-pha
+00017b60: 7365 272c 0a20 2020 2020 2020 2020 2020  se',.           
+00017b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b80: 2020 2020 2074 6872 6f77 3d46 616c 7365       throw=False
+00017b90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017bb0: 2020 2a2a 7079 636f 6d70 6174 2e73 7472    **pycompat.str
+00017bc0: 6b77 6172 6773 2861 7267 7329 0a20 2020  kwargs(args).   
+00017bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017be0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00017bf0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+00017c00: 2e68 6f6f 6b28 0a20 2020 2020 2020 2020  .hook(.         
+00017c10: 2020 2020 2020 2020 2020 2062 2774 786e             b'txn
+00017c20: 636c 6f73 6527 2c20 7468 726f 773d 4661  close', throw=Fa
+00017c30: 6c73 652c 202a 2a70 7963 6f6d 7061 742e  lse, **pycompat.
+00017c40: 7374 726b 7761 7267 7328 686f 6f6b 6172  strkwargs(hookar
+00017c50: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
+00017c60: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+00017c70: 2020 2072 6570 6f20 3d20 7265 706f 7265     repo = repore
+00017c80: 6628 290a 2020 2020 2020 2020 2020 2020  f().            
+00017c90: 6173 7365 7274 2072 6570 6f20 6973 206e  assert repo is n
+00017ca0: 6f74 204e 6f6e 6520 2023 2068 656c 7020  ot None  # help 
+00017cb0: 7079 7479 7065 0a20 2020 2020 2020 2020  pytype.         
+00017cc0: 2020 2072 6570 6f2e 5f61 6674 6572 6c6f     repo._afterlo
+00017cd0: 636b 2868 6f6f 6b66 756e 6329 0a0a 2020  ck(hookfunc)..  
+00017ce0: 2020 2020 2020 7472 2e61 6464 6669 6e61        tr.addfina
+00017cf0: 6c69 7a65 2862 2774 786e 636c 6f73 652d  lize(b'txnclose-
+00017d00: 686f 6f6b 272c 2074 786e 636c 6f73 6568  hook', txncloseh
+00017d10: 6f6f 6b29 0a20 2020 2020 2020 2023 2049  ook).        # I
+00017d20: 6e63 6c75 6465 2061 206c 6561 6469 6e67  nclude a leading
+00017d30: 2022 2d22 2074 6f20 6d61 6b65 2069 7420   "-" to make it 
+00017d40: 6861 7070 656e 2062 6566 6f72 6520 7468  happen before th
+00017d50: 6520 7472 616e 7361 6374 696f 6e20 7375  e transaction su
+00017d60: 6d6d 6172 790a 2020 2020 2020 2020 2320  mmary.        # 
+00017d70: 7265 706f 7274 7320 7265 6769 7374 6572  reports register
+00017d80: 6564 2076 6961 2073 636d 7574 696c 2e72  ed via scmutil.r
+00017d90: 6567 6973 7465 7273 756d 6d61 7279 6361  egistersummaryca
+00017da0: 6c6c 6261 636b 2829 2077 686f 7365 206e  llback() whose n
+00017db0: 616d 6573 0a20 2020 2020 2020 2023 2061  ames.        # a
+00017dc0: 7265 2030 302d 7478 6e72 6570 6f72 7420  re 00-txnreport 
+00017dd0: 6574 632e 2054 6861 7420 7761 792c 2074  etc. That way, t
+00017de0: 6865 2063 6163 6865 7320 7769 6c6c 2062  he caches will b
+00017df0: 6520 7761 726d 2077 6865 6e20 7468 650a  e warm when the.
+00017e00: 2020 2020 2020 2020 2320 6361 6c6c 6261          # callba
+00017e10: 636b 7320 7275 6e2e 0a20 2020 2020 2020  cks run..       
+00017e20: 2074 722e 6164 6470 6f73 7463 6c6f 7365   tr.addpostclose
+00017e30: 2862 272d 7761 726d 2d63 6163 6865 272c  (b'-warm-cache',
+00017e40: 2073 656c 662e 5f62 7569 6c64 6361 6368   self._buildcach
+00017e50: 6575 7064 6174 6572 2874 7229 290a 0a20  eupdater(tr)).. 
+00017e60: 2020 2020 2020 2064 6566 2074 786e 6162         def txnab
+00017e70: 6f72 7468 6f6f 6b28 7472 3229 3a0a 2020  orthook(tr2):.  
+00017e80: 2020 2020 2020 2020 2020 2222 2254 6f20            """To 
+00017e90: 6265 2072 756e 2069 6620 7472 616e 7361  be run if transa
+00017ea0: 6374 696f 6e20 6973 2061 626f 7274 6564  ction is aborted
+00017eb0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+00017ec0: 7265 706f 203d 2072 6570 6f72 6566 2829  repo = reporef()
+00017ed0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00017ee0: 6572 7420 7265 706f 2069 7320 6e6f 7420  ert repo is not 
+00017ef0: 4e6f 6e65 2020 2320 6865 6c70 2070 7974  None  # help pyt
+00017f00: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
+00017f10: 7265 706f 2e68 6f6f 6b28 0a20 2020 2020  repo.hook(.     
+00017f20: 2020 2020 2020 2020 2020 2062 2774 786e             b'txn
+00017f30: 6162 6f72 7427 2c20 7468 726f 773d 4661  abort', throw=Fa
+00017f40: 6c73 652c 202a 2a70 7963 6f6d 7061 742e  lse, **pycompat.
+00017f50: 7374 726b 7761 7267 7328 7472 322e 686f  strkwargs(tr2.ho
+00017f60: 6f6b 6172 6773 290a 2020 2020 2020 2020  okargs).        
+00017f70: 2020 2020 290a 0a20 2020 2020 2020 2074      )..        t
+00017f80: 722e 6164 6461 626f 7274 2862 2774 786e  r.addabort(b'txn
+00017f90: 6162 6f72 742d 686f 6f6b 272c 2074 786e  abort-hook', txn
+00017fa0: 6162 6f72 7468 6f6f 6b29 0a20 2020 2020  aborthook).     
+00017fb0: 2020 2023 2061 766f 6964 2065 6167 6572     # avoid eager
+00017fc0: 2063 6163 6865 2069 6e76 616c 6964 6174   cache invalidat
+00017fd0: 696f 6e2e 2069 6e2d 6d65 6d6f 7279 2064  ion. in-memory d
+00017fe0: 6174 6120 7368 6f75 6c64 2062 6520 6964  ata should be id
+00017ff0: 656e 7469 6361 6c0a 2020 2020 2020 2020  entical.        
+00018000: 2320 746f 2073 746f 7265 6420 6461 7461  # to stored data
+00018010: 2069 6620 7472 616e 7361 6374 696f 6e20   if transaction 
+00018020: 6861 7320 6e6f 2065 7272 6f72 2e0a 2020  has no error..  
+00018030: 2020 2020 2020 7472 2e61 6464 706f 7374        tr.addpost
+00018040: 636c 6f73 6528 6227 7265 6672 6573 682d  close(b'refresh-
+00018050: 6669 6c65 6361 6368 6573 7461 7473 272c  filecachestats',
+00018060: 2073 656c 662e 5f72 6566 7265 7368 6669   self._refreshfi
+00018070: 6c65 6361 6368 6573 7461 7473 290a 2020  lecachestats).  
+00018080: 2020 2020 2020 7365 6c66 2e5f 7472 616e        self._tran
+00018090: 7372 6566 203d 2077 6561 6b72 6566 2e72  sref = weakref.r
+000180a0: 6566 2874 7229 0a20 2020 2020 2020 2073  ef(tr).        s
+000180b0: 636d 7574 696c 2e72 6567 6973 7465 7273  cmutil.registers
+000180c0: 756d 6d61 7279 6361 6c6c 6261 636b 2873  ummarycallback(s
+000180d0: 656c 662c 2074 722c 2064 6573 6329 0a20  elf, tr, desc). 
+000180e0: 2020 2020 2020 2023 2054 6869 7320 6f6e         # This on
+000180f0: 6c79 2065 7869 7374 2074 6f20 6465 616c  ly exist to deal
+00018100: 2077 6974 6820 7468 6520 6e65 6564 206f   with the need o
+00018110: 6620 726f 6c6c 6261 636b 2074 6f20 6861  f rollback to ha
+00018120: 7665 2076 6961 626c 650a 2020 2020 2020  ve viable.      
+00018130: 2020 2320 7061 7265 6e74 7320 6174 2074    # parents at t
+00018140: 6865 2065 6e64 206f 6620 7468 6520 6f70  he end of the op
+00018150: 6572 6174 696f 6e2e 2053 6f20 6261 636b  eration. So back
+00018160: 7570 2076 6961 626c 6520 7061 7265 6e74  up viable parent
+00018170: 7320 6174 2074 6865 0a20 2020 2020 2020  s at the.       
+00018180: 2023 2074 696d 6520 6f66 2074 6869 7320   # time of this 
+00018190: 6f70 6572 6174 696f 6e2e 0a20 2020 2020  operation..     
+000181a0: 2020 2023 0a20 2020 2020 2020 2023 2057     #.        # W
+000181b0: 6520 6f6e 6c79 2064 6f20 6974 2077 6865  e only do it whe
+000181c0: 6e20 7468 6520 6077 6c6f 636b 6020 6973  n the `wlock` is
+000181d0: 2074 616b 656e 2c20 6f74 6865 7277 6973   taken, otherwis
+000181e0: 6520 6f74 6865 7220 6d69 6768 7420 6265  e other might be
+000181f0: 0a20 2020 2020 2020 2023 2061 6c74 6572  .        # alter
+00018200: 696e 6720 7468 6520 6469 7273 7461 7465  ing the dirstate
+00018210: 2075 6e64 6572 2075 732e 0a20 2020 2020   under us..     
+00018220: 2020 2023 0a20 2020 2020 2020 2023 2054     #.        # T
+00018230: 6869 7320 6973 2072 6561 6c6c 7920 6e6f  his is really no
+00018240: 7420 6120 6772 6561 7420 7761 7920 746f  t a great way to
+00018250: 2064 6f20 7468 6973 2028 6669 7273 742c   do this (first,
+00018260: 2062 6563 6175 7365 2077 6520 6361 6e6e   because we cann
+00018270: 6f74 0a20 2020 2020 2020 2023 2061 6c77  ot.        # alw
+00018280: 6179 7320 646f 2069 7429 2e20 5468 6572  ays do it). Ther
+00018290: 6520 6172 6520 6d6f 7265 2076 6961 626c  e are more viabl
+000182a0: 6520 616c 7465 726e 6174 6976 6520 7468  e alternative th
+000182b0: 6174 2065 7869 7374 730a 2020 2020 2020  at exists.      
+000182c0: 2020 230a 2020 2020 2020 2020 2320 2d20    #.        # - 
+000182d0: 6261 636b 696e 6720 6f6e 6c79 2074 6865  backing only the
+000182e0: 2077 6f72 6b69 6e67 2063 6f70 7920 7061   working copy pa
+000182f0: 7265 6e74 2069 6e20 6120 6465 6469 6361  rent in a dedica
+00018300: 7465 6420 6669 6c65 7320 616e 6420 646f  ted files and do
+00018310: 696e 670a 2020 2020 2020 2020 2320 2020  ing.        #   
+00018320: 6120 636c 6561 6e20 226b 6565 702d 7570  a clean "keep-up
+00018330: 6461 7465 2220 746f 2074 6865 6d20 6f6e  date" to them on
+00018340: 2060 6867 2072 6f6c 6c62 6163 6b60 2e0a   `hg rollback`..
+00018350: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
+00018360: 2020 2320 2d20 736c 6967 6874 6c79 2063    # - slightly c
+00018370: 6861 6e67 696e 6720 7468 6520 6265 6861  hanging the beha
+00018380: 7669 6f72 2061 6e20 6170 706c 7969 6e67  vior an applying
+00018390: 2061 206c 6f67 6963 2073 696d 696c 6172   a logic similar
+000183a0: 2074 6f20 2268 670a 2020 2020 2020 2020   to "hg.        
+000183b0: 2320 7374 7269 7022 2074 6f20 7069 636b  # strip" to pick
+000183c0: 2061 2077 6f72 6b69 6e67 2063 6f70 7920   a working copy 
+000183d0: 6465 7374 696e 6174 696f 6e20 6f6e 2060  destination on `
+000183e0: 6867 2072 6f6c 6c62 6163 6b60 0a20 2020  hg rollback`.   
+000183f0: 2020 2020 2069 6620 7365 6c66 2e63 7572       if self.cur
+00018400: 7265 6e74 776c 6f63 6b28 2920 6973 206e  rentwlock() is n
+00018410: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00018420: 2020 2020 2064 7320 3d20 7365 6c66 2e64       ds = self.d
+00018430: 6972 7374 6174 650a 2020 2020 2020 2020  irstate.        
+00018440: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00018450: 7666 732e 6578 6973 7473 2862 2762 7261  vfs.exists(b'bra
+00018460: 6e63 6827 293a 0a20 2020 2020 2020 2020  nch'):.         
+00018470: 2020 2020 2020 2023 2066 6f72 6365 2061         # force a
+00018480: 2066 696c 6520 746f 2062 6520 7772 6974   file to be writ
+00018490: 7465 6e20 6966 204e 6f6e 6520 6578 6973  ten if None exis
+000184a0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+000184b0: 2020 6473 2e73 6574 6272 616e 6368 2862    ds.setbranch(b
+000184c0: 2764 6566 6175 6c74 272c 204e 6f6e 6529  'default', None)
+000184d0: 0a0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+000184e0: 6620 6261 636b 7570 5f64 6972 7374 6174  f backup_dirstat
+000184f0: 6528 7472 293a 0a20 2020 2020 2020 2020  e(tr):.         
+00018500: 2020 2020 2020 2066 6f72 2066 2069 6e20         for f in 
+00018510: 6473 2e61 6c6c 5f66 696c 655f 6e61 6d65  ds.all_file_name
+00018520: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00018530: 2020 2020 2020 2020 2023 2068 6172 646c           # hardl
+00018540: 696e 6b20 6261 636b 7570 2069 7320 6f6b  ink backup is ok
+00018550: 6179 2062 6563 6175 7365 2060 6469 7273  ay because `dirs
+00018560: 7461 7465 6020 6973 2061 6c77 6179 730a  tate` is always.
+00018570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018580: 2020 2020 2320 6174 6f6d 6963 616c 6c79      # atomically
+00018590: 2077 7269 7474 656e 2061 6e64 2070 6f73   written and pos
+000185a0: 7369 626c 6520 6461 7461 2066 696c 6520  sible data file 
+000185b0: 6172 6520 6170 7065 6e64 206f 6e6c 790a  are append only.
+000185c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185d0: 2020 2020 2320 616e 6420 7265 7369 7374      # and resist
+000185e0: 616e 7420 746f 2074 7261 696c 696e 6720  ant to trailing 
+000185f0: 6461 7461 2e0a 2020 2020 2020 2020 2020  data..          
+00018600: 2020 2020 2020 2020 2020 7472 2e61 6464            tr.add
+00018610: 6261 636b 7570 2866 2c20 6861 7264 6c69  backup(f, hardli
+00018620: 6e6b 3d54 7275 652c 206c 6f63 6174 696f  nk=True, locatio
+00018630: 6e3d 6227 706c 6169 6e27 290a 0a20 2020  n=b'plain')..   
+00018640: 2020 2020 2020 2020 2074 722e 6164 6476           tr.addv
+00018650: 616c 6964 6174 6f72 2862 2764 6972 7374  alidator(b'dirst
+00018660: 6174 652d 6261 636b 7570 272c 2062 6163  ate-backup', bac
+00018670: 6b75 705f 6469 7273 7461 7465 290a 2020  kup_dirstate).  
+00018680: 2020 2020 2020 7265 7475 726e 2074 720a        return tr.
+00018690: 0a20 2020 2064 6566 205f 6a6f 7572 6e61  .    def _journa
+000186a0: 6c66 696c 6573 2873 656c 6629 3a0a 2020  lfiles(self):.  
+000186b0: 2020 2020 2020 7265 7475 726e 2028 0a20        return (. 
+000186c0: 2020 2020 2020 2020 2020 2028 7365 6c66             (self
+000186d0: 2e73 7666 732c 2062 276a 6f75 726e 616c  .svfs, b'journal
+000186e0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
+000186f0: 2873 656c 662e 7666 732c 2062 276a 6f75  (self.vfs, b'jou
+00018700: 726e 616c 2e64 6573 6327 292c 0a20 2020  rnal.desc'),.   
+00018710: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00018720: 756e 646f 6669 6c65 7328 7365 6c66 293a  undofiles(self):
+00018730: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00018740: 5b28 7666 732c 2075 6e64 6f6e 616d 6528  [(vfs, undoname(
+00018750: 7829 2920 666f 7220 7666 732c 2078 2069  x)) for vfs, x i
+00018760: 6e20 7365 6c66 2e5f 6a6f 7572 6e61 6c66  n self._journalf
+00018770: 696c 6573 2829 5d0a 0a20 2020 2040 756e  iles()]..    @un
+00018780: 6669 6c74 6572 6564 6d65 7468 6f64 0a20  filteredmethod. 
+00018790: 2020 2064 6566 205f 7772 6974 656a 6f75     def _writejou
+000187a0: 726e 616c 2873 656c 662c 2064 6573 6329  rnal(self, desc)
+000187b0: 3a0a 2020 2020 2020 2020 7365 6c66 2e76  :.        self.v
+000187c0: 6673 2e77 7269 7465 2862 226a 6f75 726e  fs.write(b"journ
+000187d0: 616c 2e64 6573 6322 2c20 6222 2564 5c6e  al.desc", b"%d\n
+000187e0: 2573 5c6e 2220 2520 286c 656e 2873 656c  %s\n" % (len(sel
+000187f0: 6629 2c20 6465 7363 2929 0a0a 2020 2020  f), desc))..    
+00018800: 6465 6620 7265 636f 7665 7228 7365 6c66  def recover(self
+00018810: 293a 0a20 2020 2020 2020 2077 6974 6820  ):.        with 
+00018820: 7365 6c66 2e6c 6f63 6b28 293a 0a20 2020  self.lock():.   
+00018830: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00018840: 2e73 7666 732e 6578 6973 7473 2862 226a  .svfs.exists(b"j
+00018850: 6f75 726e 616c 2229 3a0a 2020 2020 2020  ournal"):.      
+00018860: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
+00018870: 692e 7374 6174 7573 285f 2862 2272 6f6c  i.status(_(b"rol
+00018880: 6c69 6e67 2062 6163 6b20 696e 7465 7272  ling back interr
+00018890: 7570 7465 6420 7472 616e 7361 6374 696f  upted transactio
+000188a0: 6e5c 6e22 2929 0a20 2020 2020 2020 2020  n\n")).         
+000188b0: 2020 2020 2020 2076 6673 6d61 7020 3d20         vfsmap = 
+000188c0: 7365 6c66 2e76 6673 5f6d 6170 0a20 2020  self.vfs_map.   
+000188d0: 2020 2020 2020 2020 2020 2020 2074 7261               tra
+000188e0: 6e73 6163 7469 6f6e 2e72 6f6c 6c62 6163  nsaction.rollbac
+000188f0: 6b28 0a20 2020 2020 2020 2020 2020 2020  k(.             
+00018900: 2020 2020 2020 2073 656c 662e 7376 6673         self.svfs
+00018910: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00018920: 2020 2020 2020 7666 736d 6170 2c0a 2020        vfsmap,.  
+00018930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018940: 2020 6222 6a6f 7572 6e61 6c22 2c0a 2020    b"journal",.  
+00018950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018960: 2020 7365 6c66 2e75 692e 7761 726e 2c0a    self.ui.warn,.
+00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018980: 2020 2020 6368 6563 6b61 6d62 6967 6669      checkambigfi
+00018990: 6c65 733d 5f63 6163 6865 6466 696c 6573  les=_cachedfiles
+000189a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000189b0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+000189c0: 2020 2020 7365 6c66 2e69 6e76 616c 6964      self.invalid
+000189d0: 6174 6528 290a 2020 2020 2020 2020 2020  ate().          
+000189e0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+000189f0: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+00018a00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00018a10: 2020 2020 7365 6c66 2e75 692e 7761 726e      self.ui.warn
+00018a20: 285f 2862 226e 6f20 696e 7465 7272 7570  (_(b"no interrup
+00018a30: 7465 6420 7472 616e 7361 6374 696f 6e20  ted transaction 
+00018a40: 6176 6169 6c61 626c 655c 6e22 2929 0a20  available\n")). 
+00018a50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00018a60: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+00018a70: 2064 6566 2072 6f6c 6c62 6163 6b28 7365   def rollback(se
+00018a80: 6c66 2c20 6472 7972 756e 3d46 616c 7365  lf, dryrun=False
+00018a90: 2c20 666f 7263 653d 4661 6c73 6529 3a0a  , force=False):.
+00018aa0: 2020 2020 2020 2020 776c 6f63 6b20 3d20          wlock = 
+00018ab0: 6c6f 636b 203d 204e 6f6e 650a 2020 2020  lock = None.    
+00018ac0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00018ad0: 2020 2020 2077 6c6f 636b 203d 2073 656c       wlock = sel
+00018ae0: 662e 776c 6f63 6b28 290a 2020 2020 2020  f.wlock().      
+00018af0: 2020 2020 2020 6c6f 636b 203d 2073 656c        lock = sel
+00018b00: 662e 6c6f 636b 2829 0a20 2020 2020 2020  f.lock().       
+00018b10: 2020 2020 2069 6620 7365 6c66 2e73 7666       if self.svf
+00018b20: 732e 6578 6973 7473 2862 2275 6e64 6f22  s.exists(b"undo"
+00018b30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00018b40: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00018b50: 726f 6c6c 6261 636b 2864 7279 7275 6e2c  rollback(dryrun,
+00018b60: 2066 6f72 6365 290a 2020 2020 2020 2020   force).        
+00018b70: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00018b80: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
+00018b90: 692e 7761 726e 285f 2862 226e 6f20 726f  i.warn(_(b"no ro
+00018ba0: 6c6c 6261 636b 2069 6e66 6f72 6d61 7469  llback informati
+00018bb0: 6f6e 2061 7661 696c 6162 6c65 5c6e 2229  on available\n")
+00018bc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00018bd0: 2020 7265 7475 726e 2031 0a20 2020 2020    return 1.     
+00018be0: 2020 2066 696e 616c 6c79 3a0a 2020 2020     finally:.    
+00018bf0: 2020 2020 2020 2020 7265 6c65 6173 6528          release(
+00018c00: 6c6f 636b 2c20 776c 6f63 6b29 0a0a 2020  lock, wlock)..  
+00018c10: 2020 4075 6e66 696c 7465 7265 646d 6574    @unfilteredmet
+00018c20: 686f 6420 2023 2055 6e74 696c 2077 6520  hod  # Until we 
+00018c30: 6765 7420 736d 6172 7465 7220 6361 6368  get smarter cach
+00018c40: 6520 6d61 6e61 6765 6d65 6e74 0a20 2020  e management.   
+00018c50: 2064 6566 205f 726f 6c6c 6261 636b 2873   def _rollback(s
+00018c60: 656c 662c 2064 7279 7275 6e2c 2066 6f72  elf, dryrun, for
+00018c70: 6365 293a 0a20 2020 2020 2020 2075 6920  ce):.        ui 
+00018c80: 3d20 7365 6c66 2e75 690a 0a20 2020 2020  = self.ui..     
+00018c90: 2020 2070 6172 656e 7473 203d 2073 656c     parents = sel
+00018ca0: 662e 6469 7273 7461 7465 2e70 6172 656e  f.dirstate.paren
+00018cb0: 7473 2829 0a20 2020 2020 2020 2074 7279  ts().        try
+00018cc0: 3a0a 2020 2020 2020 2020 2020 2020 6172  :.            ar
+00018cd0: 6773 203d 2073 656c 662e 7666 732e 7265  gs = self.vfs.re
+00018ce0: 6164 2862 2775 6e64 6f2e 6465 7363 2729  ad(b'undo.desc')
+00018cf0: 2e73 706c 6974 6c69 6e65 7328 290a 2020  .splitlines().  
+00018d00: 2020 2020 2020 2020 2020 286f 6c64 6c65            (oldle
+00018d10: 6e2c 2064 6573 632c 2064 6574 6169 6c29  n, desc, detail)
+00018d20: 203d 2028 696e 7428 6172 6773 5b30 5d29   = (int(args[0])
+00018d30: 2c20 6172 6773 5b31 5d2c 204e 6f6e 6529  , args[1], None)
+00018d40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00018d50: 6c65 6e28 6172 6773 2920 3e3d 2033 3a0a  len(args) >= 3:.
+00018d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d70: 6465 7461 696c 203d 2061 7267 735b 325d  detail = args[2]
+00018d80: 0a20 2020 2020 2020 2020 2020 206f 6c64  .            old
+00018d90: 7469 7020 3d20 6f6c 646c 656e 202d 2031  tip = oldlen - 1
+00018da0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00018db0: 2064 6574 6169 6c20 616e 6420 7569 2e76   detail and ui.v
+00018dc0: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
+00018dd0: 2020 2020 2020 2020 6d73 6720 3d20 5f28          msg = _(
+00018de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018df0: 2020 2020 2062 2772 6570 6f73 6974 6f72       b'repositor
+00018e00: 7920 7469 7020 726f 6c6c 6564 2062 6163  y tip rolled bac
+00018e10: 6b20 746f 2072 6576 6973 696f 6e20 2564  k to revision %d
+00018e20: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00018e30: 2020 2020 2020 6227 2028 756e 646f 2025        b' (undo %
+00018e40: 733a 2025 7329 5c6e 270a 2020 2020 2020  s: %s)\n'.      
+00018e50: 2020 2020 2020 2020 2020 2920 2520 286f            ) % (o
+00018e60: 6c64 7469 702c 2064 6573 632c 2064 6574  ldtip, desc, det
+00018e70: 6169 6c29 0a20 2020 2020 2020 2020 2020  ail).           
+00018e80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00018e90: 2020 2020 2020 206d 7367 203d 205f 280a         msg = _(.
+00018ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018eb0: 2020 2020 6227 7265 706f 7369 746f 7279      b'repository
+00018ec0: 2074 6970 2072 6f6c 6c65 6420 6261 636b   tip rolled back
+00018ed0: 2074 6f20 7265 7669 7369 6f6e 2025 6420   to revision %d 
+00018ee0: 2875 6e64 6f20 2573 295c 6e27 0a20 2020  (undo %s)\n'.   
+00018ef0: 2020 2020 2020 2020 2020 2020 2029 2025               ) %
+00018f00: 2028 6f6c 6474 6970 2c20 6465 7363 290a   (oldtip, desc).
+00018f10: 2020 2020 2020 2020 2020 2020 7061 7265              pare
+00018f20: 6e74 676f 6e65 203d 2061 6e79 2873 656c  ntgone = any(sel
+00018f30: 665b 705d 2e72 6576 2829 203e 206f 6c64  f[p].rev() > old
+00018f40: 7469 7020 666f 7220 7020 696e 2070 6172  tip for p in par
+00018f50: 656e 7473 290a 2020 2020 2020 2020 6578  ents).        ex
+00018f60: 6365 7074 2049 4f45 7272 6f72 3a0a 2020  cept IOError:.  
+00018f70: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
+00018f80: 5f28 6227 726f 6c6c 696e 6720 6261 636b  _(b'rolling back
+00018f90: 2075 6e6b 6e6f 776e 2074 7261 6e73 6163   unknown transac
+00018fa0: 7469 6f6e 5c6e 2729 0a20 2020 2020 2020  tion\n').       
+00018fb0: 2020 2020 2064 6573 6320 3d20 4e6f 6e65       desc = None
+00018fc0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00018fd0: 656e 7467 6f6e 6520 3d20 5472 7565 0a0a  entgone = True..
+00018fe0: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
+00018ff0: 6f72 6365 2061 6e64 2073 656c 665b 6227  orce and self[b'
+00019000: 2e27 5d20 213d 2073 656c 665b 6227 7469  .'] != self[b'ti
+00019010: 7027 5d20 616e 6420 6465 7363 203d 3d20  p'] and desc == 
+00019020: 6227 636f 6d6d 6974 273a 0a20 2020 2020  b'commit':.     
+00019030: 2020 2020 2020 2072 6169 7365 2065 7272         raise err
+00019040: 6f72 2e41 626f 7274 280a 2020 2020 2020  or.Abort(.      
+00019050: 2020 2020 2020 2020 2020 5f28 0a20 2020            _(.   
+00019060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019070: 2062 2772 6f6c 6c62 6163 6b20 6f66 206c   b'rollback of l
+00019080: 6173 7420 636f 6d6d 6974 2077 6869 6c65  ast commit while
+00019090: 206e 6f74 2063 6865 636b 6564 206f 7574   not checked out
+000190a0: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+000190b0: 2020 2020 2020 2062 276d 6179 206c 6f73         b'may los
+000190c0: 6520 6461 7461 270a 2020 2020 2020 2020  e data'.        
+000190d0: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+000190e0: 2020 2020 2020 2020 2020 2068 696e 743d             hint=
+000190f0: 5f28 6227 7573 6520 2d66 2074 6f20 666f  _(b'use -f to fo
+00019100: 7263 6527 292c 0a20 2020 2020 2020 2020  rce'),.         
+00019110: 2020 2029 0a0a 2020 2020 2020 2020 7569     )..        ui
+00019120: 2e73 7461 7475 7328 6d73 6729 0a20 2020  .status(msg).   
+00019130: 2020 2020 2069 6620 6472 7972 756e 3a0a       if dryrun:.
+00019140: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00019150: 726e 2030 0a0a 2020 2020 2020 2020 7365  rn 0..        se
+00019160: 6c66 2e64 6573 7472 6f79 696e 6728 290a  lf.destroying().
+00019170: 2020 2020 2020 2020 7666 736d 6170 203d          vfsmap =
+00019180: 2073 656c 662e 7666 735f 6d61 700a 2020   self.vfs_map.  
+00019190: 2020 2020 2020 736b 6970 5f6a 6f75 726e        skip_journ
+000191a0: 616c 5f70 6174 7465 726e 203d 204e 6f6e  al_pattern = Non
+000191b0: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
+000191c0: 2070 6172 656e 7467 6f6e 653a 0a20 2020   parentgone:.   
+000191d0: 2020 2020 2020 2020 2073 6b69 705f 6a6f           skip_jo
+000191e0: 7572 6e61 6c5f 7061 7474 6572 6e20 3d20  urnal_pattern = 
+000191f0: 5245 5f53 4b49 505f 4449 5253 5441 5445  RE_SKIP_DIRSTATE
+00019200: 5f52 4f4c 4c42 4143 4b0a 2020 2020 2020  _ROLLBACK.      
+00019210: 2020 7472 616e 7361 6374 696f 6e2e 726f    transaction.ro
+00019220: 6c6c 6261 636b 280a 2020 2020 2020 2020  llback(.        
+00019230: 2020 2020 7365 6c66 2e73 7666 732c 0a20      self.svfs,. 
+00019240: 2020 2020 2020 2020 2020 2076 6673 6d61             vfsma
+00019250: 702c 0a20 2020 2020 2020 2020 2020 2062  p,.            b
+00019260: 2775 6e64 6f27 2c0a 2020 2020 2020 2020  'undo',.        
+00019270: 2020 2020 7569 2e77 6172 6e2c 0a20 2020      ui.warn,.   
+00019280: 2020 2020 2020 2020 2063 6865 636b 616d           checkam
+00019290: 6269 6766 696c 6573 3d5f 6361 6368 6564  bigfiles=_cached
+000192a0: 6669 6c65 732c 0a20 2020 2020 2020 2020  files,.         
+000192b0: 2020 2073 6b69 705f 6a6f 7572 6e61 6c5f     skip_journal_
+000192c0: 7061 7474 6572 6e3d 736b 6970 5f6a 6f75  pattern=skip_jou
+000192d0: 726e 616c 5f70 6174 7465 726e 2c0a 2020  rnal_pattern,.  
+000192e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000192f0: 7365 6c66 2e69 6e76 616c 6964 6174 6528  self.invalidate(
+00019300: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
+00019310: 6972 7374 6174 652e 696e 7661 6c69 6461  irstate.invalida
+00019320: 7465 2829 0a0a 2020 2020 2020 2020 6966  te()..        if
+00019330: 2070 6172 656e 7467 6f6e 653a 0a20 2020   parentgone:.   
+00019340: 2020 2020 2020 2020 2023 2072 6570 6c61           # repla
+00019350: 6365 2074 6869 7320 7769 7468 2073 6f6d  ce this with som
+00019360: 6520 6578 706c 6963 6974 2070 6172 656e  e explicit paren
+00019370: 7420 7570 6461 7465 2069 6e20 7468 6520  t update in the 
+00019380: 6675 7475 7265 2e0a 2020 2020 2020 2020  future..        
+00019390: 2020 2020 6861 735f 6e6f 6465 203d 2073      has_node = s
+000193a0: 656c 662e 6368 616e 6765 6c6f 672e 696e  elf.changelog.in
+000193b0: 6465 782e 6861 735f 6e6f 6465 0a20 2020  dex.has_node.   
+000193c0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000193d0: 616c 6c28 6861 735f 6e6f 6465 2870 2920  all(has_node(p) 
+000193e0: 666f 7220 7020 696e 2073 656c 662e 6469  for p in self.di
+000193f0: 7273 7461 7465 2e5f 706c 293a 0a20 2020  rstate._pl):.   
+00019400: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+00019410: 6865 7265 2077 6173 206e 6f20 6469 7273  here was no dirs
+00019420: 7461 7465 2074 6f20 6261 636b 7570 2069  tate to backup i
+00019430: 6e69 7469 616c 6c79 2c20 7765 206e 6565  nitially, we nee
+00019440: 6420 746f 2064 726f 700a 2020 2020 2020  d to drop.      
+00019450: 2020 2020 2020 2020 2020 2320 7468 6520            # the 
+00019460: 6578 6973 7469 6e67 206f 6e65 2e0a 2020  existing one..  
+00019470: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+00019480: 7468 2073 656c 662e 6469 7273 7461 7465  th self.dirstate
+00019490: 2e63 6861 6e67 696e 675f 7061 7265 6e74  .changing_parent
+000194a0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+000194b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000194c0: 662e 6469 7273 7461 7465 2e73 6574 7061  f.dirstate.setpa
+000194d0: 7265 6e74 7328 7365 6c66 2e6e 756c 6c69  rents(self.nulli
+000194e0: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
+000194f0: 2020 2020 2020 2073 656c 662e 6469 7273         self.dirs
+00019500: 7461 7465 2e63 6c65 6172 2829 0a0a 2020  tate.clear()..  
+00019510: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
+00019520: 7320 3d20 7475 706c 6528 5b70 2e72 6576  s = tuple([p.rev
+00019530: 2829 2066 6f72 2070 2069 6e20 7365 6c66  () for p in self
+00019540: 5b4e 6f6e 655d 2e70 6172 656e 7473 2829  [None].parents()
+00019550: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
+00019560: 6620 6c65 6e28 7061 7265 6e74 7329 203e  f len(parents) >
+00019570: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00019580: 2020 2020 7569 2e73 7461 7475 7328 0a20      ui.status(. 
+00019590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195a0: 2020 205f 280a 2020 2020 2020 2020 2020     _(.          
+000195b0: 2020 2020 2020 2020 2020 2020 2020 6227                b'
+000195c0: 776f 726b 696e 6720 6469 7265 6374 6f72  working director
+000195d0: 7920 6e6f 7720 6261 7365 6420 6f6e 2027  y now based on '
+000195e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000195f0: 2020 2020 2020 2020 2062 2772 6576 6973           b'revis
+00019600: 696f 6e73 2025 6420 616e 6420 2564 5c6e  ions %d and %d\n
+00019610: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00019620: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00019630: 2020 2020 2020 2020 2020 2020 2520 7061              % pa
+00019640: 7265 6e74 730a 2020 2020 2020 2020 2020  rents.          
+00019650: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00019660: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00019670: 2020 2020 2020 2020 2020 7569 2e73 7461            ui.sta
+00019680: 7475 7328 0a20 2020 2020 2020 2020 2020  tus(.           
+00019690: 2020 2020 2020 2020 205f 2862 2777 6f72           _(b'wor
+000196a0: 6b69 6e67 2064 6972 6563 746f 7279 206e  king directory n
+000196b0: 6f77 2062 6173 6564 206f 6e20 7265 7669  ow based on revi
+000196c0: 7369 6f6e 2025 645c 6e27 2920 2520 7061  sion %d\n') % pa
+000196d0: 7265 6e74 730a 2020 2020 2020 2020 2020  rents.          
+000196e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000196f0: 2020 2020 6d65 7267 6573 7461 7465 6d6f      mergestatemo
+00019700: 642e 6d65 7267 6573 7461 7465 2e63 6c65  d.mergestate.cle
+00019710: 616e 2873 656c 6629 0a0a 2020 2020 2020  an(self)..      
+00019720: 2020 2320 544f 444f 3a20 6966 2077 6520    # TODO: if we 
+00019730: 6b6e 6f77 2077 6869 6368 206e 6577 2068  know which new h
+00019740: 6561 6473 206d 6179 2072 6573 756c 7420  eads may result 
+00019750: 6672 6f6d 2074 6869 7320 726f 6c6c 6261  from this rollba
+00019760: 636b 2c20 7061 7373 0a20 2020 2020 2020  ck, pass.       
+00019770: 2023 2074 6865 6d20 746f 2064 6573 7472   # them to destr
+00019780: 6f79 2829 2c20 7768 6963 6820 7769 6c6c  oy(), which will
+00019790: 2070 7265 7665 6e74 2074 6865 2062 7261   prevent the bra
+000197a0: 6e63 6868 6561 6420 6361 6368 6520 6672  nchhead cache fr
+000197b0: 6f6d 2062 6569 6e67 0a20 2020 2020 2020  om being.       
+000197c0: 2023 2069 6e76 616c 6964 6174 6564 2e0a   # invalidated..
+000197d0: 2020 2020 2020 2020 7365 6c66 2e64 6573          self.des
+000197e0: 7472 6f79 6564 2829 0a20 2020 2020 2020  troyed().       
+000197f0: 2072 6574 7572 6e20 300a 0a20 2020 2064   return 0..    d
+00019800: 6566 205f 6275 696c 6463 6163 6865 7570  ef _buildcacheup
+00019810: 6461 7465 7228 7365 6c66 2c20 6e65 7774  dater(self, newt
+00019820: 7261 6e73 6163 7469 6f6e 293a 0a20 2020  ransaction):.   
+00019830: 2020 2020 2022 2222 6361 6c6c 6564 2064       """called d
+00019840: 7572 696e 6720 7472 616e 7361 6374 696f  uring transactio
+00019850: 6e20 746f 2062 7569 6c64 2074 6865 2063  n to build the c
+00019860: 616c 6c62 6163 6b20 7570 6461 7469 6e67  allback updating
+00019870: 2063 6163 6865 0a0a 2020 2020 2020 2020   cache..        
+00019880: 4c69 7665 7320 6f6e 2074 6865 2072 6570  Lives on the rep
+00019890: 6f73 6974 6f72 7920 746f 2068 656c 7020  ository to help 
+000198a0: 6578 7465 6e73 696f 6e20 7768 6f20 6d69  extension who mi
+000198b0: 6768 7420 7761 6e74 2074 6f20 6175 676d  ght want to augm
+000198c0: 656e 740a 2020 2020 2020 2020 7468 6973  ent.        this
+000198d0: 206c 6f67 6963 2e20 466f 7220 7468 6973   logic. For this
+000198e0: 2070 7572 706f 7365 2c20 7468 6520 6372   purpose, the cr
+000198f0: 6561 7465 6420 7472 616e 7361 6374 696f  eated transactio
+00019900: 6e20 6973 2070 6173 7365 6420 746f 2074  n is passed to t
+00019910: 6865 0a20 2020 2020 2020 206d 6574 686f  he.        metho
+00019920: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
+00019930: 2020 2020 2020 2023 2077 6520 6d75 7374         # we must
+00019940: 2061 766f 6964 2063 7963 6c69 6320 7265   avoid cyclic re
+00019950: 6665 7265 6e63 6520 6265 7477 6565 6e20  ference between 
+00019960: 7265 706f 2061 6e64 2074 7261 6e73 6163  repo and transac
+00019970: 7469 6f6e 2e0a 2020 2020 2020 2020 7265  tion..        re
+00019980: 706f 7265 6620 3d20 7765 616b 7265 662e  poref = weakref.
+00019990: 7265 6628 7365 6c66 290a 0a20 2020 2020  ref(self)..     
+000199a0: 2020 2064 6566 2075 7064 6174 6572 2874     def updater(t
+000199b0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+000199c0: 7265 706f 203d 2072 6570 6f72 6566 2829  repo = reporef()
+000199d0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+000199e0: 6572 7420 7265 706f 2069 7320 6e6f 7420  ert repo is not 
+000199f0: 4e6f 6e65 2020 2320 6865 6c70 2070 7974  None  # help pyt
+00019a00: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
+00019a10: 7265 706f 2e75 7064 6174 6563 6163 6865  repo.updatecache
+00019a20: 7328 7472 290a 0a20 2020 2020 2020 2072  s(tr)..        r
+00019a30: 6574 7572 6e20 7570 6461 7465 720a 0a20  eturn updater.. 
+00019a40: 2020 2040 756e 6669 6c74 6572 6564 6d65     @unfilteredme
+00019a50: 7468 6f64 0a20 2020 2064 6566 2075 7064  thod.    def upd
+00019a60: 6174 6563 6163 6865 7328 7365 6c66 2c20  atecaches(self, 
+00019a70: 7472 3d4e 6f6e 652c 2066 756c 6c3d 4661  tr=None, full=Fa
+00019a80: 6c73 652c 2063 6163 6865 733d 4e6f 6e65  lse, caches=None
+00019a90: 293a 0a20 2020 2020 2020 2022 2222 7761  ):.        """wa
+00019aa0: 726d 2061 7070 726f 7072 6961 7465 2063  rm appropriate c
+00019ab0: 6163 6865 730a 0a20 2020 2020 2020 2049  aches..        I
+00019ac0: 6620 7468 6973 2066 756e 6374 696f 6e20  f this function 
+00019ad0: 6973 2063 616c 6c65 6420 6166 7465 7220  is called after 
+00019ae0: 6120 7472 616e 7361 6374 696f 6e20 636c  a transaction cl
+00019af0: 6f73 6564 2e20 5468 6520 7472 616e 7361  osed. The transa
+00019b00: 6374 696f 6e0a 2020 2020 2020 2020 7769  ction.        wi
+00019b10: 6c6c 2062 6520 6176 6169 6c61 626c 6520  ll be available 
+00019b20: 696e 2074 6865 2027 7472 2720 6172 6775  in the 'tr' argu
+00019b30: 6d65 6e74 2e20 5468 6973 2063 616e 2062  ment. This can b
+00019b40: 6520 7573 6564 2074 6f20 7365 6c65 6374  e used to select
+00019b50: 6976 656c 790a 2020 2020 2020 2020 7570  ively.        up
+00019b60: 6461 7465 2063 6163 6865 7320 7265 6c65  date caches rele
+00019b70: 7661 6e74 2074 6f20 7468 6520 6368 616e  vant to the chan
+00019b80: 6765 7320 696e 2074 6861 7420 7472 616e  ges in that tran
+00019b90: 7361 6374 696f 6e2e 0a0a 2020 2020 2020  saction...      
+00019ba0: 2020 4966 2027 6675 6c6c 2720 6973 2073    If 'full' is s
+00019bb0: 6574 2c20 6d61 6b65 2073 7572 6520 616c  et, make sure al
+00019bc0: 6c20 6361 6368 6573 2074 6865 2066 756e  l caches the fun
+00019bd0: 6374 696f 6e20 6b6e 6f77 7320 6162 6f75  ction knows abou
+00019be0: 7420 6861 7665 0a20 2020 2020 2020 2075  t have.        u
+00019bf0: 702d 746f 2d64 6174 6520 6461 7461 2e20  p-to-date data. 
+00019c00: 4576 656e 2074 6865 206f 6e65 7320 7573  Even the ones us
+00019c10: 7561 6c6c 7920 6c6f 6164 6564 206d 6f72  ually loaded mor
+00019c20: 6520 6c61 7a69 6c79 2e0a 0a20 2020 2020  e lazily...     
+00019c30: 2020 2054 6865 2060 6675 6c6c 6020 6172     The `full` ar
+00019c40: 6775 6d65 6e74 2063 616e 2074 616b 6520  gument can take 
+00019c50: 6120 7370 6563 6961 6c20 2270 6f73 742d  a special "post-
+00019c60: 636c 6f6e 6522 2076 616c 7565 2e20 496e  clone" value. In
+00019c70: 2074 6869 7320 6361 7365 0a20 2020 2020   this case.     
+00019c80: 2020 2074 6865 2063 6163 6865 2077 6172     the cache war
+00019c90: 6d69 6e67 2069 7320 6d61 6465 2061 6674  ming is made aft
+00019ca0: 6572 2061 2063 6c6f 6e65 2061 6e64 206f  er a clone and o
+00019cb0: 6620 7468 6520 736c 6f77 6572 2063 6163  f the slower cac
+00019cc0: 6865 206d 6967 6874 0a20 2020 2020 2020  he might.       
+00019cd0: 2062 6520 736b 6970 7065 642c 206e 616d   be skipped, nam
+00019ce0: 656c 7920 7468 6520 602e 666e 6f64 6574  ely the `.fnodet
+00019cf0: 6167 7360 206f 6e65 2e20 5468 6973 2061  ags` one. This a
+00019d00: 7267 756d 656e 7420 6973 2035 2e38 2073  rgument is 5.8 s
+00019d10: 7065 6369 6669 630a 2020 2020 2020 2020  pecific.        
+00019d20: 6173 2077 6520 706c 616e 2066 6f72 2061  as we plan for a
+00019d30: 2063 6c65 616e 6572 2077 6179 2074 6f20   cleaner way to 
+00019d40: 6465 616c 2077 6974 6820 7468 6973 2066  deal with this f
+00019d50: 6f72 2035 2e39 2e0a 2020 2020 2020 2020  or 5.9..        
+00019d60: 2222 220a 2020 2020 2020 2020 6966 2074  """.        if t
+00019d70: 7220 6973 206e 6f74 204e 6f6e 6520 616e  r is not None an
+00019d80: 6420 7472 2e68 6f6f 6b61 7267 732e 6765  d tr.hookargs.ge
+00019d90: 7428 6227 736f 7572 6365 2729 203d 3d20  t(b'source') == 
+00019da0: 6227 7374 7269 7027 3a0a 2020 2020 2020  b'strip':.      
+00019db0: 2020 2020 2020 2320 4475 7269 6e67 2073        # During s
+00019dc0: 7472 6970 2c20 6d61 6e79 2063 6163 6865  trip, many cache
+00019dd0: 7320 6172 6520 696e 7661 6c69 6420 6275  s are invalid bu
+00019de0: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
+00019df0: 6c61 7465 7220 6361 6c6c 2074 6f20 6064  later call to `d
+00019e00: 6573 7472 6f79 6564 6020 7769 6c6c 2072  estroyed` will r
+00019e10: 6566 7265 7368 2074 6865 6d2e 0a20 2020  efresh them..   
+00019e20: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00019e30: 0a20 2020 2020 2020 2075 6e66 6920 3d20  .        unfi = 
+00019e40: 7365 6c66 2e75 6e66 696c 7465 7265 6428  self.unfiltered(
+00019e50: 290a 0a20 2020 2020 2020 2069 6620 6675  )..        if fu
+00019e60: 6c6c 3a0a 2020 2020 2020 2020 2020 2020  ll:.            
+00019e70: 6d73 6720 3d20 280a 2020 2020 2020 2020  msg = (.        
+00019e80: 2020 2020 2020 2020 2260 6675 6c6c 6020          "`full` 
+00019e90: 6172 6775 6d65 6e74 2066 6f72 2060 7265  argument for `re
+00019ea0: 706f 2e75 7064 6174 6563 6163 6865 7360  po.updatecaches`
+00019eb0: 2069 7320 6465 7072 6563 6174 6564 5c6e   is deprecated\n
+00019ec0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00019ed0: 2020 2228 7573 6520 6063 6163 6865 733d    "(use `caches=
+00019ee0: 7265 706f 7369 746f 7279 2e43 4143 4845  repository.CACHE
+00019ef0: 5f41 4c4c 6020 696e 7374 6561 6429 220a  _ALL` instead)".
+00019f00: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00019f10: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
+00019f20: 692e 6465 7072 6563 7761 726e 286d 7367  i.deprecwarn(msg
+00019f30: 2c20 6222 352e 3922 290a 2020 2020 2020  , b"5.9").      
+00019f40: 2020 2020 2020 6361 6368 6573 203d 2072        caches = r
+00019f50: 6570 6f73 6974 6f72 792e 4341 4348 4553  epository.CACHES
+00019f60: 5f41 4c4c 0a20 2020 2020 2020 2020 2020  _ALL.           
+00019f70: 2069 6620 6675 6c6c 203d 3d20 6222 706f   if full == b"po
+00019f80: 7374 2d63 6c6f 6e65 223a 0a20 2020 2020  st-clone":.     
+00019f90: 2020 2020 2020 2020 2020 2063 6163 6865             cache
+00019fa0: 7320 3d20 7265 706f 7369 746f 7279 2e43  s = repository.C
+00019fb0: 4143 4845 535f 504f 5354 5f43 4c4f 4e45  ACHES_POST_CLONE
+00019fc0: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
+00019fd0: 6865 7320 3d20 7265 706f 7369 746f 7279  hes = repository
+00019fe0: 2e43 4143 4845 535f 414c 4c0a 2020 2020  .CACHES_ALL.    
+00019ff0: 2020 2020 656c 6966 2063 6163 6865 7320      elif caches 
+0001a000: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0001a010: 2020 2020 2063 6163 6865 7320 3d20 7265       caches = re
+0001a020: 706f 7369 746f 7279 2e43 4143 4845 535f  pository.CACHES_
+0001a030: 4445 4641 554c 540a 0a20 2020 2020 2020  DEFAULT..       
+0001a040: 2069 6620 7265 706f 7369 746f 7279 2e43   if repository.C
+0001a050: 4143 4845 5f42 5241 4e43 484d 4150 5f53  ACHE_BRANCHMAP_S
+0001a060: 4552 5645 4420 696e 2063 6163 6865 733a  ERVED in caches:
+0001a070: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001a080: 7472 2069 7320 4e6f 6e65 206f 7220 7472  tr is None or tr
+0001a090: 2e63 6861 6e67 6573 5b62 276f 7269 6772  .changes[b'origr
+0001a0a0: 6570 6f6c 656e 275d 203c 206c 656e 2873  epolen'] < len(s
+0001a0b0: 656c 6629 3a0a 2020 2020 2020 2020 2020  elf):.          
+0001a0c0: 2020 2020 2020 2320 6163 6365 7373 696e        # accessin
+0001a0d0: 6720 7468 6520 2773 6572 7665 6427 2062  g the 'served' b
+0001a0e0: 7261 6e63 686d 6170 2073 686f 756c 6420  ranchmap should 
+0001a0f0: 7265 6672 6573 6820 616c 6c20 7468 6520  refresh all the 
+0001a100: 6f74 6865 7273 2c0a 2020 2020 2020 2020  others,.        
+0001a110: 2020 2020 2020 2020 7365 6c66 2e75 692e          self.ui.
+0001a120: 6465 6275 6728 6227 7570 6461 7469 6e67  debug(b'updating
+0001a130: 2074 6865 2062 7261 6e63 6820 6361 6368   the branch cach
+0001a140: 655c 6e27 290a 2020 2020 2020 2020 2020  e\n').          
+0001a150: 2020 2020 2020 7365 6c66 2e66 696c 7465        self.filte
+0001a160: 7265 6428 6227 7365 7276 6564 2729 2e62  red(b'served').b
+0001a170: 7261 6e63 686d 6170 2829 0a20 2020 2020  ranchmap().     
+0001a180: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001a190: 6669 6c74 6572 6564 2862 2773 6572 7665  filtered(b'serve
+0001a1a0: 642e 6869 6464 656e 2729 2e62 7261 6e63  d.hidden').branc
+0001a1b0: 686d 6170 2829 0a20 2020 2020 2020 2020  hmap().         
+0001a1c0: 2020 2020 2020 2023 2066 6c75 7368 2061         # flush a
+0001a1d0: 6c6c 2070 6f73 7369 626c 7920 6465 6c61  ll possibly dela
+0001a1e0: 7965 6420 7772 6974 652e 0a20 2020 2020  yed write..     
+0001a1f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001a200: 5f62 7261 6e63 6863 6163 6865 732e 7772  _branchcaches.wr
+0001a210: 6974 655f 6465 6c61 7965 6428 7365 6c66  ite_delayed(self
+0001a220: 290a 0a20 2020 2020 2020 2069 6620 7265  )..        if re
+0001a230: 706f 7369 746f 7279 2e43 4143 4845 5f43  pository.CACHE_C
+0001a240: 4841 4e47 454c 4f47 5f43 4143 4845 2069  HANGELOG_CACHE i
+0001a250: 6e20 6361 6368 6573 3a0a 2020 2020 2020  n caches:.      
+0001a260: 2020 2020 2020 7365 6c66 2e63 6861 6e67        self.chang
+0001a270: 656c 6f67 2e75 7064 6174 655f 6361 6368  elog.update_cach
+0001a280: 6573 2874 7261 6e73 6163 7469 6f6e 3d74  es(transaction=t
+0001a290: 7229 0a0a 2020 2020 2020 2020 6966 2072  r)..        if r
+0001a2a0: 6570 6f73 6974 6f72 792e 4341 4348 455f  epository.CACHE_
+0001a2b0: 4d41 4e49 4645 5354 4c4f 475f 4341 4348  MANIFESTLOG_CACH
+0001a2c0: 4520 696e 2063 6163 6865 733a 0a20 2020  E in caches:.   
+0001a2d0: 2020 2020 2020 2020 2073 656c 662e 6d61           self.ma
+0001a2e0: 6e69 6665 7374 6c6f 672e 7570 6461 7465  nifestlog.update
+0001a2f0: 5f63 6163 6865 7328 7472 616e 7361 6374  _caches(transact
+0001a300: 696f 6e3d 7472 290a 2020 2020 2020 2020  ion=tr).        
+0001a310: 2020 2020 666f 7220 656e 7472 7920 696e      for entry in
+0001a320: 2073 656c 662e 7374 6f72 652e 7761 6c6b   self.store.walk
+0001a330: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0001a340: 2020 2020 6966 206e 6f74 2065 6e74 7279      if not entry
+0001a350: 2e69 735f 7265 766c 6f67 3a0a 2020 2020  .is_revlog:.    
+0001a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a370: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0001a380: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0001a390: 656e 7472 792e 6973 5f6d 616e 6966 6573  entry.is_manifes
+0001a3a0: 746c 6f67 3a0a 2020 2020 2020 2020 2020  tlog:.          
+0001a3b0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0001a3c0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0001a3d0: 2020 206d 616e 6966 6573 7472 6576 6c6f     manifestrevlo
+0001a3e0: 6720 3d20 656e 7472 792e 6765 745f 7265  g = entry.get_re
+0001a3f0: 766c 6f67 5f69 6e73 7461 6e63 6528 7365  vlog_instance(se
+0001a400: 6c66 292e 6765 745f 7265 766c 6f67 2829  lf).get_revlog()
+0001a410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a420: 2069 6620 6d61 6e69 6665 7374 7265 766c   if manifestrevl
+0001a430: 6f67 2069 7320 6e6f 7420 4e6f 6e65 3a0a  og is not None:.
+0001a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a450: 2020 2020 6d61 6e69 6665 7374 7265 766c      manifestrevl
+0001a460: 6f67 2e75 7064 6174 655f 6361 6368 6573  og.update_caches
+0001a470: 2874 7261 6e73 6163 7469 6f6e 3d74 7229  (transaction=tr)
+0001a480: 0a0a 2020 2020 2020 2020 6966 2072 6570  ..        if rep
+0001a490: 6f73 6974 6f72 792e 4341 4348 455f 5245  ository.CACHE_RE
+0001a4a0: 565f 4252 414e 4348 2069 6e20 6361 6368  V_BRANCH in cach
+0001a4b0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0001a4c0: 7262 6320 3d20 756e 6669 2e72 6576 6272  rbc = unfi.revbr
+0001a4d0: 616e 6368 6361 6368 6528 290a 2020 2020  anchcache().    
+0001a4e0: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
+0001a4f0: 2075 6e66 692e 6368 616e 6765 6c6f 673a   unfi.changelog:
+0001a500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a510: 2072 6263 2e62 7261 6e63 6869 6e66 6f28   rbc.branchinfo(
+0001a520: 7229 0a20 2020 2020 2020 2020 2020 2072  r).            r
+0001a530: 6263 2e77 7269 7465 2829 0a0a 2020 2020  bc.write()..    
+0001a540: 2020 2020 6966 2072 6570 6f73 6974 6f72      if repositor
+0001a550: 792e 4341 4348 455f 4655 4c4c 5f4d 414e  y.CACHE_FULL_MAN
+0001a560: 4946 4553 5420 696e 2063 6163 6865 733a  IFEST in caches:
+0001a570: 0a20 2020 2020 2020 2020 2020 2023 2065  .            # e
+0001a580: 6e73 7572 6520 7468 6520 776f 726b 696e  nsure the workin
+0001a590: 6720 636f 7079 2070 6172 656e 7473 2061  g copy parents a
+0001a5a0: 7265 2069 6e20 7468 6520 6d61 6e69 6665  re in the manife
+0001a5b0: 7374 6675 6c6c 7465 7874 6361 6368 650a  stfulltextcache.
+0001a5c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001a5d0: 6374 7820 696e 2073 656c 665b 6227 2e27  ctx in self[b'.'
+0001a5e0: 5d2e 7061 7265 6e74 7328 293a 0a20 2020  ].parents():.   
+0001a5f0: 2020 2020 2020 2020 2020 2020 2063 7478               ctx
+0001a600: 2e6d 616e 6966 6573 7428 2920 2023 2061  .manifest()  # a
+0001a610: 6363 6573 7369 6e67 2074 6865 206d 616e  ccessing the man
+0001a620: 6966 6573 7420 6973 2065 6e6f 7567 680a  ifest is enough.
+0001a630: 0a20 2020 2020 2020 2069 6620 7265 706f  .        if repo
+0001a640: 7369 746f 7279 2e43 4143 4845 5f46 494c  sitory.CACHE_FIL
+0001a650: 455f 4e4f 4445 5f54 4147 5320 696e 2063  E_NODE_TAGS in c
+0001a660: 6163 6865 733a 0a20 2020 2020 2020 2020  aches:.         
+0001a670: 2020 2023 2061 6363 6573 7369 6e67 2066     # accessing f
+0001a680: 6e6f 6465 2063 6163 6865 2077 6172 6d73  node cache warms
+0001a690: 2074 6865 2063 6163 6865 0a20 2020 2020   the cache.     
+0001a6a0: 2020 2020 2020 2074 6167 736d 6f64 2e66         tagsmod.f
+0001a6b0: 6e6f 6465 7265 7673 2873 656c 662e 7569  noderevs(self.ui
+0001a6c0: 2c20 756e 6669 2c20 756e 6669 2e63 6861  , unfi, unfi.cha
+0001a6d0: 6e67 656c 6f67 2e72 6576 7328 2929 0a0a  ngelog.revs())..
+0001a6e0: 2020 2020 2020 2020 6966 2072 6570 6f73          if repos
+0001a6f0: 6974 6f72 792e 4341 4348 455f 5441 4753  itory.CACHE_TAGS
+0001a700: 5f44 4546 4155 4c54 2069 6e20 6361 6368  _DEFAULT in cach
+0001a710: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0001a720: 2320 6163 6365 7373 696e 6720 7461 6773  # accessing tags
+0001a730: 2077 6172 6d20 7468 6520 6361 6368 650a   warm the cache.
+0001a740: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001a750: 2e74 6167 7328 290a 2020 2020 2020 2020  .tags().        
+0001a760: 6966 2072 6570 6f73 6974 6f72 792e 4341  if repository.CA
+0001a770: 4348 455f 5441 4753 5f53 4552 5645 4420  CHE_TAGS_SERVED 
+0001a780: 696e 2063 6163 6865 733a 0a20 2020 2020  in caches:.     
+0001a790: 2020 2020 2020 2073 656c 662e 6669 6c74         self.filt
+0001a7a0: 6572 6564 2862 2773 6572 7665 6427 292e  ered(b'served').
+0001a7b0: 7461 6773 2829 0a0a 2020 2020 2020 2020  tags()..        
+0001a7c0: 6966 2072 6570 6f73 6974 6f72 792e 4341  if repository.CA
+0001a7d0: 4348 455f 4252 414e 4348 4d41 505f 414c  CHE_BRANCHMAP_AL
+0001a7e0: 4c20 696e 2063 6163 6865 733a 0a20 2020  L in caches:.   
+0001a7f0: 2020 2020 2020 2020 2023 2054 6865 2043           # The C
+0001a800: 4143 4845 5f42 5241 4e43 484d 4150 5f41  ACHE_BRANCHMAP_A
+0001a810: 4c4c 2075 7064 6174 6573 206c 617a 696c  LL updates lazil
+0001a820: 792d 6c6f 6164 6564 2063 6163 6865 7320  y-loaded caches 
+0001a830: 696d 6d65 6469 6174 656c 792c 0a20 2020  immediately,.   
+0001a840: 2020 2020 2020 2020 2023 2073 6f20 7765           # so we
+0001a850: 2772 6520 666f 7263 696e 6720 6120 7772  're forcing a wr
+0001a860: 6974 6520 746f 2063 6175 7365 2074 6865  ite to cause the
+0001a870: 7365 2063 6163 6865 7320 746f 2062 6520  se caches to be 
+0001a880: 7761 726d 6564 2075 700a 2020 2020 2020  warmed up.      
+0001a890: 2020 2020 2020 2320 6576 656e 2069 6620        # even if 
+0001a8a0: 7468 6579 2068 6176 656e 2774 2065 7870  they haven't exp
+0001a8b0: 6c69 6369 746c 7920 6265 656e 2072 6571  licitly been req
+0001a8c0: 7565 7374 6564 2079 6574 2028 6966 2074  uested yet (if t
+0001a8d0: 6865 7927 7665 0a20 2020 2020 2020 2020  hey've.         
+0001a8e0: 2020 2023 206e 6576 6572 2062 6565 6e20     # never been 
+0001a8f0: 7573 6564 2062 7920 6867 2c20 7468 6579  used by hg, they
+0001a900: 2077 6f6e 2774 2065 7665 7220 6861 7665   won't ever have
+0001a910: 2062 6565 6e20 7772 6974 7465 6e2c 2065   been written, e
+0001a920: 7665 6e20 6966 0a20 2020 2020 2020 2020  ven if.         
+0001a930: 2020 2023 2074 6865 7927 7265 2061 2073     # they're a s
+0001a940: 7562 7365 7420 6f66 2061 6e6f 7468 6572  ubset of another
+0001a950: 206b 696e 6420 6f66 2063 6163 6865 2074   kind of cache t
+0001a960: 6861 7420 2a68 6173 2a20 6265 656e 2075  hat *has* been u
+0001a970: 7365 6429 2e0a 2020 2020 2020 2020 2020  sed)..          
+0001a980: 2020 666f 7220 6669 6c74 2069 6e20 7265    for filt in re
+0001a990: 706f 7669 6577 2e66 696c 7465 7274 6162  poview.filtertab
+0001a9a0: 6c65 2e6b 6579 7328 293a 0a20 2020 2020  le.keys():.     
+0001a9b0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+0001a9c0: 7265 6420 3d20 7365 6c66 2e66 696c 7465  red = self.filte
+0001a9d0: 7265 6428 6669 6c74 290a 2020 2020 2020  red(filt).      
+0001a9e0: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+0001a9f0: 6564 2e62 7261 6e63 686d 6170 2829 2e77  ed.branchmap().w
+0001aa00: 7269 7465 2866 696c 7465 7265 6429 0a0a  rite(filtered)..
+0001aa10: 2020 2020 6465 6620 696e 7661 6c69 6461      def invalida
+0001aa20: 7465 6361 6368 6573 2873 656c 6629 3a0a  tecaches(self):.
+0001aa30: 2020 2020 2020 2020 6966 2027 5f74 6167          if '_tag
+0001aa40: 7363 6163 6865 2720 696e 2076 6172 7328  scache' in vars(
+0001aa50: 7365 6c66 293a 0a20 2020 2020 2020 2020  self):.         
+0001aa60: 2020 2023 2063 616e 2774 2075 7365 2064     # can't use d
+0001aa70: 656c 6174 7472 206f 6e20 7072 6f78 790a  elattr on proxy.
+0001aa80: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+0001aa90: 7365 6c66 2e5f 5f64 6963 745f 5f5b 275f  self.__dict__['_
+0001aaa0: 7461 6773 6361 6368 6527 5d0a 0a20 2020  tagscache']..   
+0001aab0: 2020 2020 2073 656c 662e 5f62 7261 6e63       self._branc
+0001aac0: 6863 6163 6865 732e 636c 6561 7228 290a  hcaches.clear().
+0001aad0: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
+0001aae0: 616c 6964 6174 6576 6f6c 6174 696c 6573  alidatevolatiles
+0001aaf0: 6574 7328 290a 2020 2020 2020 2020 7365  ets().        se
+0001ab00: 6c66 2e5f 7370 6172 7365 7369 676e 6174  lf._sparsesignat
+0001ab10: 7572 6563 6163 6865 2e63 6c65 6172 2829  urecache.clear()
+0001ab20: 0a0a 2020 2020 6465 6620 696e 7661 6c69  ..    def invali
+0001ab30: 6461 7465 766f 6c61 7469 6c65 7365 7473  datevolatilesets
+0001ab40: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001ab50: 7365 6c66 2e66 696c 7465 7265 6472 6576  self.filteredrev
+0001ab60: 6361 6368 652e 636c 6561 7228 290a 2020  cache.clear().  
+0001ab70: 2020 2020 2020 6f62 736f 6c65 7465 2e63        obsolete.c
+0001ab80: 6c65 6172 6f62 7363 6163 6865 7328 7365  learobscaches(se
+0001ab90: 6c66 290a 2020 2020 2020 2020 7365 6c66  lf).        self
+0001aba0: 2e5f 7175 6963 6b5f 6163 6365 7373 5f63  ._quick_access_c
+0001abb0: 6861 6e67 6569 645f 696e 7661 6c69 6461  hangeid_invalida
+0001abc0: 7465 2829 0a0a 2020 2020 6465 6620 696e  te()..    def in
+0001abd0: 7661 6c69 6461 7465 6469 7273 7461 7465  validatedirstate
+0001abe0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001abf0: 2222 2249 6e76 616c 6964 6174 6573 2074  """Invalidates t
+0001ac00: 6865 2064 6972 7374 6174 652c 2063 6175  he dirstate, cau
+0001ac10: 7369 6e67 2074 6865 206e 6578 7420 6361  sing the next ca
+0001ac20: 6c6c 2074 6f20 6469 7273 7461 7465 0a20  ll to dirstate. 
+0001ac30: 2020 2020 2020 2074 6f20 6368 6563 6b20         to check 
+0001ac40: 6966 2069 7420 7761 7320 6d6f 6469 6669  if it was modifi
+0001ac50: 6564 2073 696e 6365 2074 6865 206c 6173  ed since the las
+0001ac60: 7420 7469 6d65 2069 7420 7761 7320 7265  t time it was re
+0001ac70: 6164 2c0a 2020 2020 2020 2020 7265 7265  ad,.        rere
+0001ac80: 6164 696e 6720 6974 2069 6620 6974 2068  ading it if it h
+0001ac90: 6173 2e0a 0a20 2020 2020 2020 2054 6869  as...        Thi
+0001aca0: 7320 6973 2064 6966 6665 7265 6e74 2074  s is different t
+0001acb0: 6f20 6469 7273 7461 7465 2e69 6e76 616c  o dirstate.inval
+0001acc0: 6964 6174 6528 2920 7468 6174 2069 7420  idate() that it 
+0001acd0: 646f 6573 6e27 7420 616c 7761 7973 0a20  doesn't always. 
+0001ace0: 2020 2020 2020 2072 6572 6561 6473 2074         rereads t
+0001acf0: 6865 2064 6972 7374 6174 652e 2055 7365  he dirstate. Use
+0001ad00: 2064 6972 7374 6174 652e 696e 7661 6c69   dirstate.invali
+0001ad10: 6461 7465 2829 2069 6620 796f 7520 7761  date() if you wa
+0001ad20: 6e74 2074 6f0a 2020 2020 2020 2020 6578  nt to.        ex
+0001ad30: 706c 6963 6974 6c79 2072 6561 6420 7468  plicitly read th
+0001ad40: 6520 6469 7273 7461 7465 2061 6761 696e  e dirstate again
+0001ad50: 2028 692e 652e 2072 6573 746f 7269 6e67   (i.e. restoring
+0001ad60: 2069 7420 746f 2061 2070 7265 7669 6f75   it to a previou
+0001ad70: 730a 2020 2020 2020 2020 6b6e 6f77 6e20  s.        known 
+0001ad80: 676f 6f64 2073 7461 7465 292e 2222 220a  good state).""".
+0001ad90: 2020 2020 2020 2020 756e 6669 203d 2073          unfi = s
+0001ada0: 656c 662e 756e 6669 6c74 6572 6564 2829  elf.unfiltered()
+0001adb0: 0a20 2020 2020 2020 2069 6620 2764 6972  .        if 'dir
+0001adc0: 7374 6174 6527 2069 6e20 756e 6669 2e5f  state' in unfi._
+0001add0: 5f64 6963 745f 5f3a 0a20 2020 2020 2020  _dict__:.       
+0001ade0: 2020 2020 2061 7373 6572 7420 6e6f 7420       assert not 
+0001adf0: 7365 6c66 2e64 6972 7374 6174 652e 6973  self.dirstate.is
+0001ae00: 5f63 6861 6e67 696e 675f 616e 790a 2020  _changing_any.  
+0001ae10: 2020 2020 2020 2020 2020 6465 6c20 756e            del un
+0001ae20: 6669 2e5f 5f64 6963 745f 5f5b 2764 6972  fi.__dict__['dir
+0001ae30: 7374 6174 6527 5d0a 0a20 2020 2064 6566  state']..    def
+0001ae40: 2069 6e76 616c 6964 6174 6528 7365 6c66   invalidate(self
+0001ae50: 2c20 636c 6561 7266 696c 6563 6163 6865  , clearfilecache
+0001ae60: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+0001ae70: 2022 2222 496e 7661 6c69 6461 7465 7320   """Invalidates 
+0001ae80: 626f 7468 2073 746f 7265 2061 6e64 206e  both store and n
+0001ae90: 6f6e 2d73 746f 7265 2070 6172 7473 206f  on-store parts o
+0001aea0: 7468 6572 2074 6861 6e20 6469 7273 7461  ther than dirsta
+0001aeb0: 7465 0a0a 2020 2020 2020 2020 4966 2061  te..        If a
+0001aec0: 2074 7261 6e73 6163 7469 6f6e 2069 7320   transaction is 
+0001aed0: 7275 6e6e 696e 672c 2069 6e76 616c 6964  running, invalid
+0001aee0: 6174 696f 6e20 6f66 2073 746f 7265 2069  ation of store i
+0001aef0: 7320 6f6d 6974 7465 642c 0a20 2020 2020  s omitted,.     
+0001af00: 2020 2062 6563 6175 7365 2064 6973 6361     because disca
+0001af10: 7264 696e 6720 696e 2d6d 656d 6f72 7920  rding in-memory 
+0001af20: 6368 616e 6765 7320 6d69 6768 7420 6361  changes might ca
+0001af30: 7573 6520 696e 636f 6e73 6973 7465 6e63  use inconsistenc
+0001af40: 790a 2020 2020 2020 2020 2865 2e67 2e20  y.        (e.g. 
+0001af50: 696e 636f 6d70 6c65 7465 2066 6e63 6163  incomplete fncac
+0001af60: 6865 2063 6175 7365 7320 756e 696e 7465  he causes uninte
+0001af70: 6e74 696f 6e61 6c20 6661 696c 7572 652c  ntional failure,
+0001af80: 2062 7574 0a20 2020 2020 2020 2072 6564   but.        red
+0001af90: 756e 6461 6e74 206f 6e65 2064 6f65 736e  undant one doesn
+0001afa0: 2774 292e 0a20 2020 2020 2020 2022 2222  't)..        """
+0001afb0: 0a20 2020 2020 2020 2075 6e66 696c 7465  .        unfilte
+0001afc0: 7265 6420 3d20 7365 6c66 2e75 6e66 696c  red = self.unfil
+0001afd0: 7465 7265 6428 2920 2023 2061 6c6c 2066  tered()  # all f
+0001afe0: 696c 6520 6361 6368 6573 2061 7265 2073  ile caches are s
+0001aff0: 746f 7265 6420 756e 6669 6c74 6572 6564  tored unfiltered
+0001b000: 0a20 2020 2020 2020 2066 6f72 206b 2069  .        for k i
+0001b010: 6e20 6c69 7374 2873 656c 662e 5f66 696c  n list(self._fil
+0001b020: 6563 6163 6865 2e6b 6579 7328 2929 3a0a  ecache.keys()):.
+0001b030: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0001b040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b050: 206b 203d 3d20 6227 6368 616e 6765 6c6f   k == b'changelo
+0001b060: 6727 0a20 2020 2020 2020 2020 2020 2020  g'.             
+0001b070: 2020 2061 6e64 2073 656c 662e 6375 7272     and self.curr
+0001b080: 656e 7474 7261 6e73 6163 7469 6f6e 2829  enttransaction()
+0001b090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b0a0: 2061 6e64 2073 656c 662e 6368 616e 6765   and self.change
+0001b0b0: 6c6f 672e 5f64 656c 6179 6564 0a20 2020  log._delayed.   
+0001b0c0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+0001b0d0: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+0001b0e0: 6520 6368 616e 6765 6c6f 6720 6f62 6a65  e changelog obje
+0001b0f0: 6374 206d 6179 2073 746f 7265 2075 6e77  ct may store unw
+0001b100: 7269 7474 656e 2072 6576 6973 696f 6e73  ritten revisions
+0001b110: 2e20 5765 2064 6f6e 2774 0a20 2020 2020  . We don't.     
+0001b120: 2020 2020 2020 2020 2020 2023 2077 616e             # wan
+0001b130: 7420 746f 206c 6f73 6520 7468 656d 2e0a  t to lose them..
+0001b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b150: 2320 544f 444f 3a20 536f 6c76 6520 7468  # TODO: Solve th
+0001b160: 6520 7072 6f62 6c65 6d20 696e 7374 6561  e problem instea
+0001b170: 6420 6f66 2077 6f72 6b69 6e67 2061 726f  d of working aro
+0001b180: 756e 6420 6974 2e0a 2020 2020 2020 2020  und it..        
+0001b190: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+0001b1a0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0001b1b0: 2063 6c65 6172 6669 6c65 6361 6368 653a   clearfilecache:
+0001b1c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b1d0: 2064 656c 2073 656c 662e 5f66 696c 6563   del self._filec
+0001b1e0: 6163 6865 5b6b 5d0a 2020 2020 2020 2020  ache[k].        
+0001b1f0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001b200: 2020 2020 2020 2020 2064 656c 6174 7472           delattr
+0001b210: 2875 6e66 696c 7465 7265 642c 206b 290a  (unfiltered, k).
+0001b220: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0001b230: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
+0001b240: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+0001b250: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+0001b260: 7365 6c66 2e69 6e76 616c 6964 6174 6563  self.invalidatec
+0001b270: 6163 6865 7328 290a 2020 2020 2020 2020  aches().        
+0001b280: 6966 206e 6f74 2073 656c 662e 6375 7272  if not self.curr
+0001b290: 656e 7474 7261 6e73 6163 7469 6f6e 2829  enttransaction()
+0001b2a0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0001b2b0: 544f 444f 3a20 4368 616e 6769 6e67 2063  TODO: Changing c
+0001b2c0: 6f6e 7465 6e74 7320 6f66 2073 746f 7265  ontents of store
+0001b2d0: 206f 7574 7369 6465 2074 7261 6e73 6163   outside transac
+0001b2e0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+0001b2f0: 2023 2063 6175 7365 7320 696e 636f 6e73   # causes incons
+0001b300: 6973 7465 6e63 792e 2057 6520 7368 6f75  istency. We shou
+0001b310: 6c64 206d 616b 6520 696e 2d6d 656d 6f72  ld make in-memor
+0001b320: 7920 7374 6f72 650a 2020 2020 2020 2020  y store.        
+0001b330: 2020 2020 2320 6368 616e 6765 7320 6465      # changes de
+0001b340: 7465 6374 6162 6c65 2c20 616e 6420 6162  tectable, and ab
+0001b350: 6f72 7420 6966 2063 6861 6e67 6564 2e0a  ort if changed..
+0001b360: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001b370: 2e73 746f 7265 2e69 6e76 616c 6964 6174  .store.invalidat
+0001b380: 6563 6163 6865 7328 290a 0a20 2020 2064  ecaches()..    d
+0001b390: 6566 2069 6e76 616c 6964 6174 6561 6c6c  ef invalidateall
+0001b3a0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001b3b0: 2222 2246 756c 6c79 2069 6e76 616c 6964  """Fully invalid
+0001b3c0: 6174 6573 2062 6f74 6820 7374 6f72 6520  ates both store 
+0001b3d0: 616e 6420 6e6f 6e2d 7374 6f72 6520 7061  and non-store pa
+0001b3e0: 7274 732c 2063 6175 7369 6e67 2074 6865  rts, causing the
+0001b3f0: 0a20 2020 2020 2020 2073 7562 7365 7175  .        subsequ
+0001b400: 656e 7420 6f70 6572 6174 696f 6e20 746f  ent operation to
+0001b410: 2072 6572 6561 6420 616e 7920 6f75 7473   reread any outs
+0001b420: 6964 6520 6368 616e 6765 732e 2222 220a  ide changes.""".
+0001b430: 2020 2020 2020 2020 2320 6578 7465 6e73          # extens
+0001b440: 696f 6e20 7368 6f75 6c64 2068 6f6f 6b20  ion should hook 
+0001b450: 7468 6973 2074 6f20 696e 7661 6c69 6461  this to invalida
+0001b460: 7465 2069 7473 2063 6163 6865 730a 2020  te its caches.  
+0001b470: 2020 2020 2020 7365 6c66 2e69 6e76 616c        self.inval
+0001b480: 6964 6174 6528 290a 2020 2020 2020 2020  idate().        
+0001b490: 7365 6c66 2e69 6e76 616c 6964 6174 6564  self.invalidated
+0001b4a0: 6972 7374 6174 6528 290a 0a20 2020 2040  irstate()..    @
+0001b4b0: 756e 6669 6c74 6572 6564 6d65 7468 6f64  unfilteredmethod
+0001b4c0: 0a20 2020 2064 6566 205f 7265 6672 6573  .    def _refres
+0001b4d0: 6866 696c 6563 6163 6865 7374 6174 7328  hfilecachestats(
+0001b4e0: 7365 6c66 2c20 7472 293a 0a20 2020 2020  self, tr):.     
+0001b4f0: 2020 2022 2222 5265 6c6f 6164 2073 7461     """Reload sta
+0001b500: 7473 206f 6620 6361 6368 6564 2066 696c  ts of cached fil
+0001b510: 6573 2073 6f20 7468 6174 2074 6865 7920  es so that they 
+0001b520: 6172 6520 666c 6167 6765 6420 6173 2076  are flagged as v
+0001b530: 616c 6964 2222 220a 2020 2020 2020 2020  alid""".        
+0001b540: 666f 7220 6b2c 2063 6520 696e 2073 656c  for k, ce in sel
+0001b550: 662e 5f66 696c 6563 6163 6865 2e69 7465  f._filecache.ite
+0001b560: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0001b570: 2020 6b20 3d20 7079 636f 6d70 6174 2e73    k = pycompat.s
+0001b580: 7973 7374 7228 6b29 0a20 2020 2020 2020  ysstr(k).       
+0001b590: 2020 2020 2069 6620 6b20 3d3d 2027 6469       if k == 'di
+0001b5a0: 7273 7461 7465 2720 6f72 206b 206e 6f74  rstate' or k not
+0001b5b0: 2069 6e20 7365 6c66 2e5f 5f64 6963 745f   in self.__dict_
+0001b5c0: 5f3a 0a20 2020 2020 2020 2020 2020 2020  _:.             
+0001b5d0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+0001b5e0: 2020 2020 2020 2020 6365 2e72 6566 7265          ce.refre
+0001b5f0: 7368 2829 0a0a 2020 2020 6465 6620 5f6c  sh()..    def _l
+0001b600: 6f63 6b28 0a20 2020 2020 2020 2073 656c  ock(.        sel
+0001b610: 662c 0a20 2020 2020 2020 2076 6673 2c0a  f,.        vfs,.
+0001b620: 2020 2020 2020 2020 6c6f 636b 6e61 6d65          lockname
+0001b630: 2c0a 2020 2020 2020 2020 7761 6974 2c0a  ,.        wait,.
+0001b640: 2020 2020 2020 2020 7265 6c65 6173 6566          releasef
+0001b650: 6e2c 0a20 2020 2020 2020 2061 6371 7569  n,.        acqui
+0001b660: 7265 666e 2c0a 2020 2020 2020 2020 6465  refn,.        de
+0001b670: 7363 2c0a 2020 2020 293a 0a20 2020 2020  sc,.    ):.     
+0001b680: 2020 2074 696d 656f 7574 203d 2030 0a20     timeout = 0. 
+0001b690: 2020 2020 2020 2077 6172 6e74 696d 656f         warntimeo
+0001b6a0: 7574 203d 2030 0a20 2020 2020 2020 2069  ut = 0.        i
+0001b6b0: 6620 7761 6974 3a0a 2020 2020 2020 2020  f wait:.        
+0001b6c0: 2020 2020 7469 6d65 6f75 7420 3d20 7365      timeout = se
+0001b6d0: 6c66 2e75 692e 636f 6e66 6967 696e 7428  lf.ui.configint(
+0001b6e0: 6222 7569 222c 2062 2274 696d 656f 7574  b"ui", b"timeout
+0001b6f0: 2229 0a20 2020 2020 2020 2020 2020 2077  ").            w
+0001b700: 6172 6e74 696d 656f 7574 203d 2073 656c  arntimeout = sel
+0001b710: 662e 7569 2e63 6f6e 6669 6769 6e74 2862  f.ui.configint(b
+0001b720: 2275 6922 2c20 6222 7469 6d65 6f75 742e  "ui", b"timeout.
+0001b730: 7761 726e 2229 0a20 2020 2020 2020 2023  warn").        #
+0001b740: 2069 6e74 6572 6e61 6c20 636f 6e66 6967   internal config
+0001b750: 3a20 7569 2e73 6967 6e61 6c2d 7361 6665  : ui.signal-safe
+0001b760: 2d6c 6f63 6b0a 2020 2020 2020 2020 7369  -lock.        si
+0001b770: 676e 616c 7361 6665 203d 2073 656c 662e  gnalsafe = self.
+0001b780: 7569 2e63 6f6e 6669 6762 6f6f 6c28 6227  ui.configbool(b'
+0001b790: 7569 272c 2062 2773 6967 6e61 6c2d 7361  ui', b'signal-sa
+0001b7a0: 6665 2d6c 6f63 6b27 290a 0a20 2020 2020  fe-lock')..     
+0001b7b0: 2020 206c 203d 206c 6f63 6b6d 6f64 2e74     l = lockmod.t
+0001b7c0: 7279 6c6f 636b 280a 2020 2020 2020 2020  rylock(.        
+0001b7d0: 2020 2020 7365 6c66 2e75 692c 0a20 2020      self.ui,.   
+0001b7e0: 2020 2020 2020 2020 2076 6673 2c0a 2020           vfs,.  
+0001b7f0: 2020 2020 2020 2020 2020 6c6f 636b 6e61            lockna
+0001b800: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+0001b810: 7469 6d65 6f75 742c 0a20 2020 2020 2020  timeout,.       
+0001b820: 2020 2020 2077 6172 6e74 696d 656f 7574       warntimeout
+0001b830: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
+0001b840: 6c65 6173 6566 6e3d 7265 6c65 6173 6566  leasefn=releasef
+0001b850: 6e2c 0a20 2020 2020 2020 2020 2020 2061  n,.            a
+0001b860: 6371 7569 7265 666e 3d61 6371 7569 7265  cquirefn=acquire
+0001b870: 666e 2c0a 2020 2020 2020 2020 2020 2020  fn,.            
+0001b880: 6465 7363 3d64 6573 632c 0a20 2020 2020  desc=desc,.     
+0001b890: 2020 2020 2020 2073 6967 6e61 6c73 6166         signalsaf
+0001b8a0: 653d 7369 676e 616c 7361 6665 2c0a 2020  e=signalsafe,.  
+0001b8b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001b8c0: 7265 7475 726e 206c 0a0a 2020 2020 6465  return l..    de
+0001b8d0: 6620 5f61 6674 6572 6c6f 636b 2873 656c  f _afterlock(sel
+0001b8e0: 662c 2063 616c 6c62 6163 6b29 3a0a 2020  f, callback):.  
+0001b8f0: 2020 2020 2020 2222 2261 6464 2061 2063        """add a c
+0001b900: 616c 6c62 6163 6b20 746f 2062 6520 7275  allback to be ru
+0001b910: 6e20 7768 656e 2074 6865 2072 6570 6f73  n when the repos
+0001b920: 6974 6f72 7920 6973 2066 756c 6c79 2075  itory is fully u
+0001b930: 6e6c 6f63 6b65 640a 0a20 2020 2020 2020  nlocked..       
+0001b940: 2054 6865 2063 616c 6c62 6163 6b20 7769   The callback wi
+0001b950: 6c6c 2062 6520 6578 6563 7574 6564 2077  ll be executed w
+0001b960: 6865 6e20 7468 6520 6f75 7465 726d 6f73  hen the outermos
+0001b970: 7420 6c6f 636b 2069 7320 7265 6c65 6173  t lock is releas
+0001b980: 6564 0a20 2020 2020 2020 2028 7769 7468  ed.        (with
+0001b990: 2077 6c6f 636b 2062 6569 6e67 2068 6967   wlock being hig
+0001b9a0: 6865 7220 6c65 7665 6c20 7468 616e 2027  her level than '
+0001b9b0: 6c6f 636b 2729 2e22 2222 0a20 2020 2020  lock').""".     
+0001b9c0: 2020 2066 6f72 2072 6566 2069 6e20 2873     for ref in (s
+0001b9d0: 656c 662e 5f77 6c6f 636b 7265 662c 2073  elf._wlockref, s
+0001b9e0: 656c 662e 5f6c 6f63 6b72 6566 293a 0a20  elf._lockref):. 
+0001b9f0: 2020 2020 2020 2020 2020 206c 203d 2072             l = r
+0001ba00: 6566 2061 6e64 2072 6566 2829 0a20 2020  ef and ref().   
+0001ba10: 2020 2020 2020 2020 2069 6620 6c20 616e           if l an
+0001ba20: 6420 6c2e 6865 6c64 3a0a 2020 2020 2020  d l.held:.      
+0001ba30: 2020 2020 2020 2020 2020 6c2e 706f 7374            l.post
+0001ba40: 7265 6c65 6173 652e 6170 7065 6e64 2863  release.append(c
+0001ba50: 616c 6c62 6163 6b29 0a20 2020 2020 2020  allback).       
+0001ba60: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+0001ba70: 2020 2020 2020 2065 6c73 653a 2020 2320         else:  # 
+0001ba80: 6e6f 206c 6f63 6b20 6861 7665 2062 6565  no lock have bee
+0001ba90: 6e20 666f 756e 642e 0a20 2020 2020 2020  n found..       
+0001baa0: 2020 2020 2063 616c 6c62 6163 6b28 5472       callback(Tr
+0001bab0: 7565 290a 0a20 2020 2064 6566 206c 6f63  ue)..    def loc
+0001bac0: 6b28 7365 6c66 2c20 7761 6974 3d54 7275  k(self, wait=Tru
+0001bad0: 6529 3a0a 2020 2020 2020 2020 2222 224c  e):.        """L
+0001bae0: 6f63 6b20 7468 6520 7265 706f 7369 746f  ock the reposito
+0001baf0: 7279 2073 746f 7265 2028 2e68 672f 7374  ry store (.hg/st
+0001bb00: 6f72 6529 2061 6e64 2072 6574 7572 6e20  ore) and return 
+0001bb10: 6120 7765 616b 2072 6566 6572 656e 6365  a weak reference
+0001bb20: 0a20 2020 2020 2020 2074 6f20 7468 6520  .        to the 
+0001bb30: 6c6f 636b 2e20 5573 6520 7468 6973 2062  lock. Use this b
+0001bb40: 6566 6f72 6520 6d6f 6469 6679 696e 6720  efore modifying 
+0001bb50: 7468 6520 7374 6f72 6520 2865 2e67 2e20  the store (e.g. 
+0001bb60: 636f 6d6d 6974 7469 6e67 206f 720a 2020  committing or.  
+0001bb70: 2020 2020 2020 7374 7269 7070 696e 6729        stripping)
+0001bb80: 2e20 4966 2079 6f75 2061 7265 206f 7065  . If you are ope
+0001bb90: 6e69 6e67 2061 2074 7261 6e73 6163 7469  ning a transacti
+0001bba0: 6f6e 2c20 6765 7420 6120 6c6f 636b 2061  on, get a lock a
+0001bbb0: 7320 7765 6c6c 2e29 0a0a 2020 2020 2020  s well.)..      
+0001bbc0: 2020 4966 2062 6f74 6820 276c 6f63 6b27    If both 'lock'
+0001bbd0: 2061 6e64 2027 776c 6f63 6b27 206d 7573   and 'wlock' mus
+0001bbe0: 7420 6265 2061 6371 7569 7265 642c 2065  t be acquired, e
+0001bbf0: 6e73 7572 6520 796f 7520 616c 7761 7973  nsure you always
+0001bc00: 2061 6371 7569 7265 730a 2020 2020 2020   acquires.      
+0001bc10: 2020 2777 6c6f 636b 2720 6669 7273 7420    'wlock' first 
+0001bc20: 746f 2061 766f 6964 2061 2064 6561 642d  to avoid a dead-
+0001bc30: 6c6f 636b 2068 617a 6172 642e 2222 220a  lock hazard.""".
+0001bc40: 2020 2020 2020 2020 6c20 3d20 7365 6c66          l = self
+0001bc50: 2e5f 6375 7272 656e 746c 6f63 6b28 7365  ._currentlock(se
+0001bc60: 6c66 2e5f 6c6f 636b 7265 6629 0a20 2020  lf._lockref).   
+0001bc70: 2020 2020 2069 6620 6c20 6973 206e 6f74       if l is not
+0001bc80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001bc90: 2020 206c 2e6c 6f63 6b28 290a 2020 2020     l.lock().    
+0001bca0: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+0001bcb0: 0a0a 2020 2020 2020 2020 6c20 3d20 7365  ..        l = se
+0001bcc0: 6c66 2e5f 6c6f 636b 280a 2020 2020 2020  lf._lock(.      
+0001bcd0: 2020 2020 2020 7666 733d 7365 6c66 2e73        vfs=self.s
+0001bce0: 7666 732c 0a20 2020 2020 2020 2020 2020  vfs,.           
+0001bcf0: 206c 6f63 6b6e 616d 653d 6222 6c6f 636b   lockname=b"lock
+0001bd00: 222c 0a20 2020 2020 2020 2020 2020 2077  ",.            w
+0001bd10: 6169 743d 7761 6974 2c0a 2020 2020 2020  ait=wait,.      
+0001bd20: 2020 2020 2020 7265 6c65 6173 6566 6e3d        releasefn=
+0001bd30: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+0001bd40: 2020 6163 7175 6972 6566 6e3d 7365 6c66    acquirefn=self
+0001bd50: 2e69 6e76 616c 6964 6174 652c 0a20 2020  .invalidate,.   
+0001bd60: 2020 2020 2020 2020 2064 6573 633d 5f28           desc=_(
+0001bd70: 6227 7265 706f 7369 746f 7279 2025 7327  b'repository %s'
+0001bd80: 2920 2520 7365 6c66 2e6f 7269 6772 6f6f  ) % self.origroo
+0001bd90: 742c 0a20 2020 2020 2020 2029 0a20 2020  t,.        ).   
+0001bda0: 2020 2020 2073 656c 662e 5f6c 6f63 6b72       self._lockr
+0001bdb0: 6566 203d 2077 6561 6b72 6566 2e72 6566  ef = weakref.ref
+0001bdc0: 286c 290a 2020 2020 2020 2020 7265 7475  (l).        retu
+0001bdd0: 726e 206c 0a0a 2020 2020 6465 6620 776c  rn l..    def wl
+0001bde0: 6f63 6b28 7365 6c66 2c20 7761 6974 3d54  ock(self, wait=T
+0001bdf0: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
+0001be00: 224c 6f63 6b20 7468 6520 6e6f 6e2d 7374  "Lock the non-st
+0001be10: 6f72 6520 7061 7274 7320 6f66 2074 6865  ore parts of the
+0001be20: 2072 6570 6f73 6974 6f72 7920 2865 7665   repository (eve
+0001be30: 7279 7468 696e 6720 756e 6465 720a 2020  rything under.  
+0001be40: 2020 2020 2020 2e68 6720 6578 6365 7074        .hg except
+0001be50: 202e 6867 2f73 746f 7265 2920 616e 6420   .hg/store) and 
+0001be60: 7265 7475 726e 2061 2077 6561 6b20 7265  return a weak re
+0001be70: 6665 7265 6e63 6520 746f 2074 6865 206c  ference to the l
+0001be80: 6f63 6b2e 0a0a 2020 2020 2020 2020 5573  ock...        Us
+0001be90: 6520 7468 6973 2062 6566 6f72 6520 6d6f  e this before mo
+0001bea0: 6469 6679 696e 6720 6669 6c65 7320 696e  difying files in
+0001beb0: 202e 6867 2e0a 0a20 2020 2020 2020 2049   .hg...        I
+0001bec0: 6620 626f 7468 2027 6c6f 636b 2720 616e  f both 'lock' an
+0001bed0: 6420 2777 6c6f 636b 2720 6d75 7374 2062  d 'wlock' must b
+0001bee0: 6520 6163 7175 6972 6564 2c20 656e 7375  e acquired, ensu
+0001bef0: 7265 2079 6f75 2061 6c77 6179 7320 6163  re you always ac
+0001bf00: 7175 6972 6573 0a20 2020 2020 2020 2027  quires.        '
+0001bf10: 776c 6f63 6b27 2066 6972 7374 2074 6f20  wlock' first to 
+0001bf20: 6176 6f69 6420 6120 6465 6164 2d6c 6f63  avoid a dead-loc
+0001bf30: 6b20 6861 7a61 7264 2e22 2222 0a20 2020  k hazard.""".   
+0001bf40: 2020 2020 206c 203d 2073 656c 662e 5f77       l = self._w
+0001bf50: 6c6f 636b 7265 6628 2920 6966 2073 656c  lockref() if sel
+0001bf60: 662e 5f77 6c6f 636b 7265 6620 656c 7365  f._wlockref else
+0001bf70: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
+0001bf80: 206c 2069 7320 6e6f 7420 4e6f 6e65 2061   l is not None a
+0001bf90: 6e64 206c 2e68 656c 643a 0a20 2020 2020  nd l.held:.     
+0001bfa0: 2020 2020 2020 206c 2e6c 6f63 6b28 290a         l.lock().
+0001bfb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001bfc0: 726e 206c 0a0a 2020 2020 2020 2020 2320  rn l..        # 
+0001bfd0: 5765 2064 6f20 6e6f 7420 6e65 6564 2074  We do not need t
+0001bfe0: 6f20 6368 6563 6b20 666f 7220 6e6f 6e2d  o check for non-
+0001bff0: 7761 6974 696e 6720 6c6f 636b 2061 6371  waiting lock acq
+0001c000: 7569 7369 7469 6f6e 2e20 2053 7563 680a  uisition.  Such.
+0001c010: 2020 2020 2020 2020 2320 6163 7175 6973          # acquis
+0001c020: 6974 696f 6e20 776f 756c 6420 6e6f 7420  ition would not 
+0001c030: 6361 7573 6520 6465 6164 2d6c 6f63 6b20  cause dead-lock 
+0001c040: 6173 2074 6865 7920 776f 756c 6420 6a75  as they would ju
+0001c050: 7374 2066 6169 6c2e 0a20 2020 2020 2020  st fail..       
+0001c060: 2069 6620 7761 6974 2061 6e64 2028 0a20   if wait and (. 
+0001c070: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001c080: 7569 2e63 6f6e 6669 6762 6f6f 6c28 6227  ui.configbool(b'
+0001c090: 6465 7665 6c27 2c20 6227 616c 6c2d 7761  devel', b'all-wa
+0001c0a0: 726e 696e 6773 2729 0a20 2020 2020 2020  rnings').       
+0001c0b0: 2020 2020 206f 7220 7365 6c66 2e75 692e       or self.ui.
+0001c0c0: 636f 6e66 6967 626f 6f6c 2862 2764 6576  configbool(b'dev
+0001c0d0: 656c 272c 2062 2763 6865 636b 2d6c 6f63  el', b'check-loc
+0001c0e0: 6b73 2729 0a20 2020 2020 2020 2029 3a0a  ks').        ):.
+0001c0f0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0001c100: 656c 662e 5f63 7572 7265 6e74 6c6f 636b  elf._currentlock
+0001c110: 2873 656c 662e 5f6c 6f63 6b72 6566 2920  (self._lockref) 
+0001c120: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0001c130: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001c140: 662e 7569 2e64 6576 656c 7761 726e 2862  f.ui.develwarn(b
+0001c150: 2722 776c 6f63 6b22 2061 6371 7569 7265  '"wlock" acquire
+0001c160: 6420 6166 7465 7220 226c 6f63 6b22 2729  d after "lock"')
+0001c170: 0a0a 2020 2020 2020 2020 6465 6620 756e  ..        def un
+0001c180: 6c6f 636b 2829 3a0a 2020 2020 2020 2020  lock():.        
+0001c190: 2020 2020 6966 2073 656c 662e 6469 7273      if self.dirs
+0001c1a0: 7461 7465 2e69 735f 6368 616e 6769 6e67  tate.is_changing
+0001c1b0: 5f61 6e79 3a0a 2020 2020 2020 2020 2020  _any:.          
+0001c1c0: 2020 2020 2020 6d73 6720 3d20 6222 776c        msg = b"wl
+0001c1d0: 6f63 6b20 7265 6c65 6173 6520 696e 2074  ock release in t
+0001c1e0: 6865 206d 6964 646c 6520 6f66 2061 2063  he middle of a c
+0001c1f0: 6861 6e67 696e 6720 7061 7265 6e74 7322  hanging parents"
+0001c200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c210: 2073 656c 662e 7569 2e64 6576 656c 7761   self.ui.develwa
+0001c220: 726e 286d 7367 290a 2020 2020 2020 2020  rn(msg).        
+0001c230: 2020 2020 2020 2020 7365 6c66 2e64 6972          self.dir
+0001c240: 7374 6174 652e 696e 7661 6c69 6461 7465  state.invalidate
+0001c250: 2829 0a20 2020 2020 2020 2020 2020 2065  ().            e
+0001c260: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001c270: 2020 2020 2069 6620 7365 6c66 2e64 6972       if self.dir
+0001c280: 7374 6174 652e 5f64 6972 7479 3a0a 2020  state._dirty:.  
+0001c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c2a0: 2020 6d73 6720 3d20 6222 6469 7274 7920    msg = b"dirty 
+0001c2b0: 6469 7273 7461 7465 206f 6e20 776c 6f63  dirstate on wloc
+0001c2c0: 6b20 7265 6c65 6173 6522 0a20 2020 2020  k release".     
+0001c2d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001c2e0: 656c 662e 7569 2e64 6576 656c 7761 726e  elf.ui.develwarn
+0001c2f0: 286d 7367 290a 2020 2020 2020 2020 2020  (msg).          
+0001c300: 2020 2020 2020 7365 6c66 2e64 6972 7374        self.dirst
+0001c310: 6174 652e 7772 6974 6528 4e6f 6e65 290a  ate.write(None).
+0001c320: 0a20 2020 2020 2020 2020 2020 2075 6e66  .            unf
+0001c330: 6920 3d20 7365 6c66 2e75 6e66 696c 7465  i = self.unfilte
+0001c340: 7265 6428 290a 2020 2020 2020 2020 2020  red().          
+0001c350: 2020 6966 2027 6469 7273 7461 7465 2720    if 'dirstate' 
+0001c360: 696e 2075 6e66 692e 5f5f 6469 6374 5f5f  in unfi.__dict__
+0001c370: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c380: 2020 6465 6c20 756e 6669 2e5f 5f64 6963    del unfi.__dic
+0001c390: 745f 5f5b 2764 6972 7374 6174 6527 5d0a  t__['dirstate'].
+0001c3a0: 0a20 2020 2020 2020 206c 203d 2073 656c  .        l = sel
+0001c3b0: 662e 5f6c 6f63 6b28 0a20 2020 2020 2020  f._lock(.       
+0001c3c0: 2020 2020 2073 656c 662e 7666 732c 0a20       self.vfs,. 
+0001c3d0: 2020 2020 2020 2020 2020 2062 2277 6c6f             b"wlo
+0001c3e0: 636b 222c 0a20 2020 2020 2020 2020 2020  ck",.           
+0001c3f0: 2077 6169 742c 0a20 2020 2020 2020 2020   wait,.         
+0001c400: 2020 2075 6e6c 6f63 6b2c 0a20 2020 2020     unlock,.     
+0001c410: 2020 2020 2020 2073 656c 662e 696e 7661         self.inva
+0001c420: 6c69 6461 7465 6469 7273 7461 7465 2c0a  lidatedirstate,.
+0001c430: 2020 2020 2020 2020 2020 2020 5f28 6227              _(b'
+0001c440: 776f 726b 696e 6720 6469 7265 6374 6f72  working director
+0001c450: 7920 6f66 2025 7327 2920 2520 7365 6c66  y of %s') % self
+0001c460: 2e6f 7269 6772 6f6f 742c 0a20 2020 2020  .origroot,.     
+0001c470: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
+0001c480: 662e 5f77 6c6f 636b 7265 6620 3d20 7765  f._wlockref = we
+0001c490: 616b 7265 662e 7265 6628 6c29 0a20 2020  akref.ref(l).   
+0001c4a0: 2020 2020 2072 6574 7572 6e20 6c0a 0a20       return l.. 
+0001c4b0: 2020 2064 6566 205f 6375 7272 656e 746c     def _currentl
+0001c4c0: 6f63 6b28 7365 6c66 2c20 6c6f 636b 7265  ock(self, lockre
+0001c4d0: 6629 3a0a 2020 2020 2020 2020 2222 2252  f):.        """R
+0001c4e0: 6574 7572 6e73 2074 6865 206c 6f63 6b20  eturns the lock 
+0001c4f0: 6966 2069 7427 7320 6865 6c64 2c20 6f72  if it's held, or
+0001c500: 204e 6f6e 6520 6966 2069 7427 7320 6e6f   None if it's no
+0001c510: 742e 2222 220a 2020 2020 2020 2020 6966  t.""".        if
+0001c520: 206c 6f63 6b72 6566 2069 7320 4e6f 6e65   lockref is None
+0001c530: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001c540: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
+0001c550: 2020 6c20 3d20 6c6f 636b 7265 6628 290a    l = lockref().
+0001c560: 2020 2020 2020 2020 6966 206c 2069 7320          if l is 
+0001c570: 4e6f 6e65 206f 7220 6e6f 7420 6c2e 6865  None or not l.he
+0001c580: 6c64 3a0a 2020 2020 2020 2020 2020 2020  ld:.            
+0001c590: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
+0001c5a0: 2020 2020 7265 7475 726e 206c 0a0a 2020      return l..  
+0001c5b0: 2020 6465 6620 6375 7272 656e 7477 6c6f    def currentwlo
+0001c5c0: 636b 2873 656c 6629 3a0a 2020 2020 2020  ck(self):.      
+0001c5d0: 2020 2222 2252 6574 7572 6e73 2074 6865    """Returns the
+0001c5e0: 2077 6c6f 636b 2069 6620 6974 2773 2068   wlock if it's h
+0001c5f0: 656c 642c 206f 7220 4e6f 6e65 2069 6620  eld, or None if 
+0001c600: 6974 2773 206e 6f74 2e22 2222 0a20 2020  it's not.""".   
+0001c610: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001c620: 2e5f 6375 7272 656e 746c 6f63 6b28 7365  ._currentlock(se
+0001c630: 6c66 2e5f 776c 6f63 6b72 6566 290a 0a20  lf._wlockref).. 
+0001c640: 2020 2064 6566 2063 7572 7265 6e74 6c6f     def currentlo
+0001c650: 636b 2873 656c 6629 3a0a 2020 2020 2020  ck(self):.      
+0001c660: 2020 2222 2252 6574 7572 6e73 2074 6865    """Returns the
+0001c670: 206c 6f63 6b20 6966 2069 7427 7320 6865   lock if it's he
+0001c680: 6c64 2c20 6f72 204e 6f6e 6520 6966 2069  ld, or None if i
+0001c690: 7427 7320 6e6f 742e 2222 220a 2020 2020  t's not.""".    
+0001c6a0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001c6b0: 5f63 7572 7265 6e74 6c6f 636b 2873 656c  _currentlock(sel
+0001c6c0: 662e 5f6c 6f63 6b72 6566 290a 0a20 2020  f._lockref)..   
+0001c6d0: 2064 6566 2063 6865 636b 636f 6d6d 6974   def checkcommit
+0001c6e0: 7061 7474 6572 6e73 2873 656c 662c 2077  patterns(self, w
+0001c6f0: 6374 782c 206d 6174 6368 2c20 7374 6174  ctx, match, stat
+0001c700: 7573 2c20 6661 696c 293a 0a20 2020 2020  us, fail):.     
+0001c710: 2020 2022 2222 6368 6563 6b20 666f 7220     """check for 
+0001c720: 636f 6d6d 6974 2061 7267 756d 656e 7473  commit arguments
+0001c730: 2074 6861 7420 6172 656e 2774 2063 6f6d   that aren't com
+0001c740: 6d69 7474 6162 6c65 2222 220a 2020 2020  mittable""".    
+0001c750: 2020 2020 6966 206d 6174 6368 2e69 7365      if match.ise
+0001c760: 7861 6374 2829 206f 7220 6d61 7463 682e  xact() or match.
+0001c770: 7072 6566 6978 2829 3a0a 2020 2020 2020  prefix():.      
+0001c780: 2020 2020 2020 6d61 7463 6865 6420 3d20        matched = 
+0001c790: 7365 7428 7374 6174 7573 2e6d 6f64 6966  set(status.modif
+0001c7a0: 6965 6420 2b20 7374 6174 7573 2e61 6464  ied + status.add
+0001c7b0: 6564 202b 2073 7461 7475 732e 7265 6d6f  ed + status.remo
+0001c7c0: 7665 6429 0a0a 2020 2020 2020 2020 2020  ved)..          
+0001c7d0: 2020 666f 7220 6620 696e 206d 6174 6368    for f in match
+0001c7e0: 2e66 696c 6573 2829 3a0a 2020 2020 2020  .files():.      
+0001c7f0: 2020 2020 2020 2020 2020 6620 3d20 7365            f = se
+0001c800: 6c66 2e64 6972 7374 6174 652e 6e6f 726d  lf.dirstate.norm
+0001c810: 616c 697a 6528 6629 0a20 2020 2020 2020  alize(f).       
+0001c820: 2020 2020 2020 2020 2069 6620 6620 3d3d           if f ==
+0001c830: 2062 272e 2720 6f72 2066 2069 6e20 6d61   b'.' or f in ma
+0001c840: 7463 6865 6420 6f72 2066 2069 6e20 7763  tched or f in wc
+0001c850: 7478 2e73 7562 7374 6174 653a 0a20 2020  tx.substate:.   
+0001c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c870: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+0001c880: 2020 2020 2020 2020 2020 6966 2066 2069            if f i
+0001c890: 6e20 7374 6174 7573 2e64 656c 6574 6564  n status.deleted
+0001c8a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c8b0: 2020 2020 2020 6661 696c 2866 2c20 5f28        fail(f, _(
+0001c8c0: 6227 6669 6c65 206e 6f74 2066 6f75 6e64  b'file not found
+0001c8d0: 2127 2929 0a20 2020 2020 2020 2020 2020  !')).           
+0001c8e0: 2020 2020 2023 2049 7320 6974 2061 2064       # Is it a d
+0001c8f0: 6972 6563 746f 7279 2074 6861 7420 6578  irectory that ex
+0001c900: 6973 7473 206f 7220 7573 6564 2074 6f20  ists or used to 
+0001c910: 6578 6973 743f 0a20 2020 2020 2020 2020  exist?.         
+0001c920: 2020 2020 2020 2069 6620 7365 6c66 2e77         if self.w
+0001c930: 7666 732e 6973 6469 7228 6629 206f 7220  vfs.isdir(f) or 
+0001c940: 7763 7478 2e70 3128 292e 6861 7364 6972  wctx.p1().hasdir
+0001c950: 2866 293a 0a20 2020 2020 2020 2020 2020  (f):.           
+0001c960: 2020 2020 2020 2020 2064 203d 2066 202b           d = f +
+0001c970: 2062 272f 270a 2020 2020 2020 2020 2020   b'/'.          
+0001c980: 2020 2020 2020 2020 2020 666f 7220 6d66            for mf
+0001c990: 2069 6e20 6d61 7463 6865 643a 0a20 2020   in matched:.   
+0001c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9b0: 2020 2020 2069 6620 6d66 2e73 7461 7274       if mf.start
+0001c9c0: 7377 6974 6828 6429 3a0a 2020 2020 2020  swith(d):.      
+0001c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9e0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+0001c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001ca10: 2020 2020 2020 2020 2020 2020 2020 6661                fa
+0001ca20: 696c 2866 2c20 5f28 6222 6e6f 206d 6174  il(f, _(b"no mat
+0001ca30: 6368 2075 6e64 6572 2064 6972 6563 746f  ch under directo
+0001ca40: 7279 2122 2929 0a20 2020 2020 2020 2020  ry!")).         
+0001ca50: 2020 2020 2020 2065 6c69 6620 6620 6e6f         elif f no
+0001ca60: 7420 696e 2073 656c 662e 6469 7273 7461  t in self.dirsta
+0001ca70: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
+0001ca80: 2020 2020 2020 2020 6661 696c 2866 2c20          fail(f, 
+0001ca90: 5f28 6222 6669 6c65 206e 6f74 2074 7261  _(b"file not tra
+0001caa0: 636b 6564 2122 2929 0a0a 2020 2020 4075  cked!"))..    @u
+0001cab0: 6e66 696c 7465 7265 646d 6574 686f 640a  nfilteredmethod.
+0001cac0: 2020 2020 6465 6620 636f 6d6d 6974 280a      def commit(.
+0001cad0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0001cae0: 2020 2020 2020 7465 7874 3d62 2222 2c0a        text=b"",.
+0001caf0: 2020 2020 2020 2020 7573 6572 3d4e 6f6e          user=Non
+0001cb00: 652c 0a20 2020 2020 2020 2064 6174 653d  e,.        date=
+0001cb10: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d61  None,.        ma
+0001cb20: 7463 683d 4e6f 6e65 2c0a 2020 2020 2020  tch=None,.      
+0001cb30: 2020 666f 7263 653d 4661 6c73 652c 0a20    force=False,. 
+0001cb40: 2020 2020 2020 2065 6469 746f 723d 4e6f         editor=No
+0001cb50: 6e65 2c0a 2020 2020 2020 2020 6578 7472  ne,.        extr
+0001cb60: 613d 4e6f 6e65 2c0a 2020 2020 293a 0a20  a=None,.    ):. 
+0001cb70: 2020 2020 2020 2022 2222 4164 6420 6120         """Add a 
+0001cb80: 6e65 7720 7265 7669 7369 6f6e 2074 6f20  new revision to 
+0001cb90: 6375 7272 656e 7420 7265 706f 7369 746f  current reposito
+0001cba0: 7279 2e0a 0a20 2020 2020 2020 2052 6576  ry...        Rev
+0001cbb0: 6973 696f 6e20 696e 666f 726d 6174 696f  ision informatio
+0001cbc0: 6e20 6973 2067 6174 6865 7265 6420 6672  n is gathered fr
+0001cbd0: 6f6d 2074 6865 2077 6f72 6b69 6e67 2064  om the working d
+0001cbe0: 6972 6563 746f 7279 2c0a 2020 2020 2020  irectory,.      
+0001cbf0: 2020 6d61 7463 6820 6361 6e20 6265 2075    match can be u
+0001cc00: 7365 6420 746f 2066 696c 7465 7220 7468  sed to filter th
+0001cc10: 6520 636f 6d6d 6974 7465 6420 6669 6c65  e committed file
+0001cc20: 732e 2049 6620 6564 6974 6f72 2069 730a  s. If editor is.
+0001cc30: 2020 2020 2020 2020 7375 7070 6c69 6564          supplied
+0001cc40: 2c20 6974 2069 7320 6361 6c6c 6564 2074  , it is called t
+0001cc50: 6f20 6765 7420 6120 636f 6d6d 6974 206d  o get a commit m
+0001cc60: 6573 7361 6765 2e0a 2020 2020 2020 2020  essage..        
+0001cc70: 2222 220a 2020 2020 2020 2020 6966 2065  """.        if e
+0001cc80: 7874 7261 2069 7320 4e6f 6e65 3a0a 2020  xtra is None:.  
+0001cc90: 2020 2020 2020 2020 2020 6578 7472 6120            extra 
+0001cca0: 3d20 7b7d 0a0a 2020 2020 2020 2020 6465  = {}..        de
+0001ccb0: 6620 6661 696c 2866 2c20 6d73 6729 3a0a  f fail(f, msg):.
+0001ccc0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001ccd0: 6520 6572 726f 722e 496e 7075 7445 7272  e error.InputErr
+0001cce0: 6f72 2862 2725 733a 2025 7327 2025 2028  or(b'%s: %s' % (
+0001ccf0: 662c 206d 7367 2929 0a0a 2020 2020 2020  f, msg))..      
+0001cd00: 2020 6966 206e 6f74 206d 6174 6368 3a0a    if not match:.
+0001cd10: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
+0001cd20: 6820 3d20 6d61 7463 686d 6f64 2e61 6c77  h = matchmod.alw
+0001cd30: 6179 7328 290a 0a20 2020 2020 2020 2069  ays()..        i
+0001cd40: 6620 6e6f 7420 666f 7263 653a 0a20 2020  f not force:.   
+0001cd50: 2020 2020 2020 2020 206d 6174 6368 2e62           match.b
+0001cd60: 6164 203d 2066 6169 6c0a 0a20 2020 2020  ad = fail..     
+0001cd70: 2020 2023 206c 6f63 6b28 2920 666f 7220     # lock() for 
+0001cd80: 7265 6365 6e74 2063 6861 6e67 656c 6f67  recent changelog
+0001cd90: 2028 7365 6520 6973 7375 6534 3336 3829   (see issue4368)
+0001cda0: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+0001cdb0: 6c66 2e77 6c6f 636b 2829 2c20 7365 6c66  lf.wlock(), self
+0001cdc0: 2e6c 6f63 6b28 293a 0a20 2020 2020 2020  .lock():.       
+0001cdd0: 2020 2020 2077 6374 7820 3d20 7365 6c66       wctx = self
+0001cde0: 5b4e 6f6e 655d 0a20 2020 2020 2020 2020  [None].         
+0001cdf0: 2020 206d 6572 6765 203d 206c 656e 2877     merge = len(w
+0001ce00: 6374 782e 7061 7265 6e74 7328 2929 203e  ctx.parents()) >
+0001ce10: 2031 0a0a 2020 2020 2020 2020 2020 2020   1..            
+0001ce20: 6966 206e 6f74 2066 6f72 6365 2061 6e64  if not force and
+0001ce30: 206d 6572 6765 2061 6e64 206e 6f74 206d   merge and not m
+0001ce40: 6174 6368 2e61 6c77 6179 7328 293a 0a20  atch.always():. 
+0001ce50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001ce60: 6169 7365 2065 7272 6f72 2e41 626f 7274  aise error.Abort
+0001ce70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001ce80: 2020 2020 2020 5f28 0a20 2020 2020 2020        _(.       
+0001ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cea0: 2062 2763 616e 6e6f 7420 7061 7274 6961   b'cannot partia
+0001ceb0: 6c6c 7920 636f 6d6d 6974 2061 206d 6572  lly commit a mer
+0001cec0: 6765 2027 0a20 2020 2020 2020 2020 2020  ge '.           
+0001ced0: 2020 2020 2020 2020 2020 2020 2062 2728               b'(
+0001cee0: 646f 206e 6f74 2073 7065 6369 6679 2066  do not specify f
+0001cef0: 696c 6573 206f 7220 7061 7474 6572 6e73  iles or patterns
+0001cf00: 2927 0a20 2020 2020 2020 2020 2020 2020  )'.             
+0001cf10: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001cf20: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0001cf30: 2020 2020 2020 2020 7374 6174 7573 203d          status =
+0001cf40: 2073 656c 662e 7374 6174 7573 286d 6174   self.status(mat
+0001cf50: 6368 3d6d 6174 6368 2c20 636c 6561 6e3d  ch=match, clean=
+0001cf60: 666f 7263 6529 0a20 2020 2020 2020 2020  force).         
+0001cf70: 2020 2069 6620 666f 7263 653a 0a20 2020     if force:.   
+0001cf80: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+0001cf90: 7475 732e 6d6f 6469 6669 6564 2e65 7874  tus.modified.ext
+0001cfa0: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+0001cfb0: 2020 2020 2020 2020 2073 7461 7475 732e           status.
+0001cfc0: 636c 6561 6e0a 2020 2020 2020 2020 2020  clean.          
+0001cfd0: 2020 2020 2020 2920 2023 206d 7120 6d61        )  # mq ma
+0001cfe0: 7920 636f 6d6d 6974 2063 6c65 616e 2066  y commit clean f
+0001cff0: 696c 6573 0a0a 2020 2020 2020 2020 2020  iles..          
+0001d000: 2020 2320 6368 6563 6b20 7375 6272 6570    # check subrep
+0001d010: 6f73 0a20 2020 2020 2020 2020 2020 2073  os.            s
+0001d020: 7562 732c 2063 6f6d 6d69 7473 7562 732c  ubs, commitsubs,
+0001d030: 206e 6577 7374 6174 6520 3d20 7375 6272   newstate = subr
+0001d040: 6570 6f75 7469 6c2e 7072 6563 6f6d 6d69  epoutil.precommi
+0001d050: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+0001d060: 2020 2073 656c 662e 7569 2c20 7763 7478     self.ui, wctx
+0001d070: 2c20 7374 6174 7573 2c20 6d61 7463 682c  , status, match,
+0001d080: 2066 6f72 6365 3d66 6f72 6365 0a20 2020   force=force.   
+0001d090: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0001d0a0: 2020 2020 2020 2020 2320 6d61 6b65 2073          # make s
+0001d0b0: 7572 6520 616c 6c20 6578 706c 6963 6974  ure all explicit
+0001d0c0: 2070 6174 7465 726e 7320 6172 6520 6d61   patterns are ma
+0001d0d0: 7463 6865 640a 2020 2020 2020 2020 2020  tched.          
+0001d0e0: 2020 6966 206e 6f74 2066 6f72 6365 3a0a    if not force:.
+0001d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d100: 7365 6c66 2e63 6865 636b 636f 6d6d 6974  self.checkcommit
+0001d110: 7061 7474 6572 6e73 2877 6374 782c 206d  patterns(wctx, m
+0001d120: 6174 6368 2c20 7374 6174 7573 2c20 6661  atch, status, fa
+0001d130: 696c 290a 0a20 2020 2020 2020 2020 2020  il)..           
+0001d140: 2063 6374 7820 3d20 636f 6e74 6578 742e   cctx = context.
+0001d150: 776f 726b 696e 6763 6f6d 6d69 7463 7478  workingcommitctx
+0001d160: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001d170: 2020 7365 6c66 2c20 7374 6174 7573 2c20    self, status, 
+0001d180: 7465 7874 2c20 7573 6572 2c20 6461 7465  text, user, date
+0001d190: 2c20 6578 7472 610a 2020 2020 2020 2020  , extra.        
+0001d1a0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+0001d1b0: 2020 206d 7320 3d20 6d65 7267 6573 7461     ms = mergesta
+0001d1c0: 7465 6d6f 642e 6d65 7267 6573 7461 7465  temod.mergestate
+0001d1d0: 2e72 6561 6428 7365 6c66 290a 2020 2020  .read(self).    
+0001d1e0: 2020 2020 2020 2020 6d65 7267 6575 7469          mergeuti
+0001d1f0: 6c2e 6368 6563 6b75 6e72 6573 6f6c 7665  l.checkunresolve
+0001d200: 6428 6d73 290a 0a20 2020 2020 2020 2020  d(ms)..         
+0001d210: 2020 2023 2069 6e74 6572 6e61 6c20 636f     # internal co
+0001d220: 6e66 6967 3a20 7569 2e61 6c6c 6f77 656d  nfig: ui.allowem
+0001d230: 7074 7963 6f6d 6d69 740a 2020 2020 2020  ptycommit.      
+0001d240: 2020 2020 2020 6966 2063 6374 782e 6973        if cctx.is
+0001d250: 656d 7074 7928 2920 616e 6420 6e6f 7420  empty() and not 
+0001d260: 7365 6c66 2e75 692e 636f 6e66 6967 626f  self.ui.configbo
+0001d270: 6f6c 280a 2020 2020 2020 2020 2020 2020  ol(.            
+0001d280: 2020 2020 6227 7569 272c 2062 2761 6c6c      b'ui', b'all
+0001d290: 6f77 656d 7074 7963 6f6d 6d69 7427 0a20  owemptycommit'. 
+0001d2a0: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
+0001d2b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001d2c0: 6c66 2e75 692e 6465 6275 6728 6227 6e6f  lf.ui.debug(b'no
+0001d2d0: 7468 696e 6720 746f 2063 6f6d 6d69 742c  thing to commit,
+0001d2e0: 2063 6c65 6172 696e 6720 6d65 7267 6520   clearing merge 
+0001d2f0: 7374 6174 655c 6e27 290a 2020 2020 2020  state\n').      
+0001d300: 2020 2020 2020 2020 2020 6d73 2e72 6573            ms.res
+0001d310: 6574 2829 0a20 2020 2020 2020 2020 2020  et().           
+0001d320: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0001d330: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0001d340: 206d 6572 6765 2061 6e64 2063 6374 782e   merge and cctx.
+0001d350: 6465 6c65 7465 6428 293a 0a20 2020 2020  deleted():.     
+0001d360: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001d370: 2065 7272 6f72 2e41 626f 7274 285f 2862   error.Abort(_(b
+0001d380: 2263 616e 6e6f 7420 636f 6d6d 6974 206d  "cannot commit m
+0001d390: 6572 6765 2077 6974 6820 6d69 7373 696e  erge with missin
+0001d3a0: 6720 6669 6c65 7322 2929 0a0a 2020 2020  g files"))..    
+0001d3b0: 2020 2020 2020 2020 6966 2065 6469 746f          if edito
+0001d3c0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+0001d3d0: 2020 2063 6374 782e 5f74 6578 7420 3d20     cctx._text = 
+0001d3e0: 6564 6974 6f72 2873 656c 662c 2063 6374  editor(self, cct
+0001d3f0: 782c 2073 7562 7329 0a20 2020 2020 2020  x, subs).       
+0001d400: 2020 2020 2065 6469 7465 6420 3d20 7465       edited = te
+0001d410: 7874 2021 3d20 6363 7478 2e5f 7465 7874  xt != cctx._text
+0001d420: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0001d430: 5361 7665 2063 6f6d 6d69 7420 6d65 7373  Save commit mess
+0001d440: 6167 6520 696e 2063 6173 6520 7468 6973  age in case this
+0001d450: 2074 7261 6e73 6163 7469 6f6e 2067 6574   transaction get
+0001d460: 7320 726f 6c6c 6564 2062 6163 6b0a 2020  s rolled back.  
+0001d470: 2020 2020 2020 2020 2020 2320 2865 2e67            # (e.g
+0001d480: 2e20 6279 2061 2070 7265 7478 6e63 6f6d  . by a pretxncom
+0001d490: 6d69 7420 686f 6f6b 292e 2020 4c65 6176  mit hook).  Leav
+0001d4a0: 6520 7468 6520 636f 6e74 656e 7420 616c  e the content al
+0001d4b0: 6f6e 6520 6f6e 0a20 2020 2020 2020 2020  one on.         
+0001d4c0: 2020 2023 2074 6865 2061 7373 756d 7074     # the assumpt
+0001d4d0: 696f 6e20 7468 6174 2074 6865 2075 7365  ion that the use
+0001d4e0: 7220 7769 6c6c 2075 7365 2074 6865 2073  r will use the s
+0001d4f0: 616d 6520 6564 6974 6f72 2061 6761 696e  ame editor again
+0001d500: 2e0a 2020 2020 2020 2020 2020 2020 6d73  ..            ms
+0001d510: 675f 7061 7468 203d 2073 656c 662e 7361  g_path = self.sa
+0001d520: 7665 636f 6d6d 6974 6d65 7373 6167 6528  vecommitmessage(
+0001d530: 6363 7478 2e5f 7465 7874 290a 0a20 2020  cctx._text)..   
+0001d540: 2020 2020 2020 2020 2023 2063 6f6d 6d69           # commi
+0001d550: 7420 7375 6273 2061 6e64 2077 7269 7465  t subs and write
+0001d560: 206e 6577 2073 7461 7465 0a20 2020 2020   new state.     
+0001d570: 2020 2020 2020 2069 6620 7375 6273 3a0a         if subs:.
+0001d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d590: 7569 7061 7468 666e 203d 2073 636d 7574  uipathfn = scmut
+0001d5a0: 696c 2e67 6574 7569 7061 7468 666e 2873  il.getuipathfn(s
+0001d5b0: 656c 6629 0a20 2020 2020 2020 2020 2020  elf).           
+0001d5c0: 2020 2020 2066 6f72 2073 2069 6e20 736f       for s in so
+0001d5d0: 7274 6564 2863 6f6d 6d69 7473 7562 7329  rted(commitsubs)
+0001d5e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d5f0: 2020 2020 2020 7375 6220 3d20 7763 7478        sub = wctx
+0001d600: 2e73 7562 2873 290a 2020 2020 2020 2020  .sub(s).        
+0001d610: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001d620: 2e75 692e 7374 6174 7573 280a 2020 2020  .ui.status(.    
+0001d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d640: 2020 2020 5f28 6227 636f 6d6d 6974 7469      _(b'committi
+0001d650: 6e67 2073 7562 7265 706f 7369 746f 7279  ng subrepository
+0001d660: 2025 735c 6e27 290a 2020 2020 2020 2020   %s\n').        
+0001d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d680: 2520 7569 7061 7468 666e 2873 7562 7265  % uipathfn(subre
+0001d690: 706f 7574 696c 2e73 7562 7265 6c70 6174  poutil.subrelpat
+0001d6a0: 6828 7375 6229 290a 2020 2020 2020 2020  h(sub)).        
+0001d6b0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6d0: 2020 7372 203d 2073 7562 2e63 6f6d 6d69    sr = sub.commi
+0001d6e0: 7428 6363 7478 2e5f 7465 7874 2c20 7573  t(cctx._text, us
+0001d6f0: 6572 2c20 6461 7465 290a 2020 2020 2020  er, date).      
+0001d700: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0001d710: 7773 7461 7465 5b73 5d20 3d20 286e 6577  wstate[s] = (new
+0001d720: 7374 6174 655b 735d 5b30 5d2c 2073 7229  state[s][0], sr)
+0001d730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d740: 2073 7562 7265 706f 7574 696c 2e77 7269   subrepoutil.wri
+0001d750: 7465 7374 6174 6528 7365 6c66 2c20 6e65  testate(self, ne
+0001d760: 7773 7461 7465 290a 0a20 2020 2020 2020  wstate)..       
+0001d770: 2020 2020 2070 312c 2070 3220 3d20 7365       p1, p2 = se
+0001d780: 6c66 2e64 6972 7374 6174 652e 7061 7265  lf.dirstate.pare
+0001d790: 6e74 7328 290a 2020 2020 2020 2020 2020  nts().          
+0001d7a0: 2020 686f 6f6b 7031 2c20 686f 6f6b 7032    hookp1, hookp2
+0001d7b0: 203d 2068 6578 2870 3129 2c20 2870 3220   = hex(p1), (p2 
+0001d7c0: 213d 2073 656c 662e 6e75 6c6c 6964 2061  != self.nullid a
+0001d7d0: 6e64 2068 6578 2870 3229 206f 7220 6227  nd hex(p2) or b'
+0001d7e0: 2729 0a20 2020 2020 2020 2020 2020 2074  ').            t
+0001d7f0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001d800: 2020 2020 7365 6c66 2e68 6f6f 6b28 0a20      self.hook(. 
+0001d810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d820: 2020 2062 2270 7265 636f 6d6d 6974 222c     b"precommit",
+0001d830: 2074 6872 6f77 3d54 7275 652c 2070 6172   throw=True, par
+0001d840: 656e 7431 3d68 6f6f 6b70 312c 2070 6172  ent1=hookp1, par
+0001d850: 656e 7432 3d68 6f6f 6b70 320a 2020 2020  ent2=hookp2.    
+0001d860: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001d870: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+0001d880: 7468 2073 656c 662e 7472 616e 7361 6374  th self.transact
+0001d890: 696f 6e28 6227 636f 6d6d 6974 2729 3a0a  ion(b'commit'):.
+0001d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8b0: 2020 2020 7265 7420 3d20 7365 6c66 2e63      ret = self.c
+0001d8c0: 6f6d 6d69 7463 7478 2863 6374 782c 2054  ommitctx(cctx, T
+0001d8d0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0001d8e0: 2020 2020 2020 2020 2023 2075 7064 6174           # updat
+0001d8f0: 6520 626f 6f6b 6d61 726b 732c 2064 6972  e bookmarks, dir
+0001d900: 7374 6174 6520 616e 6420 6d65 7267 6573  state and merges
+0001d910: 7461 7465 0a20 2020 2020 2020 2020 2020  tate.           
+0001d920: 2020 2020 2020 2020 2062 6f6f 6b6d 6172           bookmar
+0001d930: 6b73 2e75 7064 6174 6528 7365 6c66 2c20  ks.update(self, 
+0001d940: 5b70 312c 2070 325d 2c20 7265 7429 0a20  [p1, p2], ret). 
+0001d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d960: 2020 2063 6374 782e 6d61 726b 636f 6d6d     cctx.markcomm
+0001d970: 6974 7465 6428 7265 7429 0a20 2020 2020  itted(ret).     
+0001d980: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001d990: 732e 7265 7365 7428 290a 2020 2020 2020  s.reset().      
+0001d9a0: 2020 2020 2020 6578 6365 7074 3a20 2023        except:  #
+0001d9b0: 2072 652d 7261 6973 6573 0a20 2020 2020   re-raises.     
+0001d9c0: 2020 2020 2020 2020 2020 2069 6620 6564             if ed
+0001d9d0: 6974 6564 3a0a 2020 2020 2020 2020 2020  ited:.          
+0001d9e0: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
+0001d9f0: 692e 7772 6974 6528 0a20 2020 2020 2020  i.write(.       
+0001da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da10: 205f 2862 276e 6f74 653a 2063 6f6d 6d69   _(b'note: commi
+0001da20: 7420 6d65 7373 6167 6520 7361 7665 6420  t message saved 
+0001da30: 696e 2025 735c 6e27 2920 2520 6d73 675f  in %s\n') % msg_
+0001da40: 7061 7468 0a20 2020 2020 2020 2020 2020  path.           
+0001da50: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001da60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001da70: 656c 662e 7569 2e77 7269 7465 280a 2020  elf.ui.write(.  
+0001da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da90: 2020 2020 2020 5f28 0a20 2020 2020 2020        _(.       
+0001daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dab0: 2020 2020 2062 226e 6f74 653a 2075 7365       b"note: use
+0001dac0: 2027 6867 2063 6f6d 6d69 7420 2d2d 6c6f   'hg commit --lo
+0001dad0: 6766 696c 6520 220a 2020 2020 2020 2020  gfile ".        
+0001dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001daf0: 2020 2020 6222 2573 202d 2d65 6469 7427      b"%s --edit'
+0001db00: 2074 6f20 7265 7573 6520 6974 5c6e 220a   to reuse it\n".
+0001db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db20: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db40: 2020 2520 6d73 675f 7061 7468 0a20 2020    % msg_path.   
+0001db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db60: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0001db70: 2020 2072 6169 7365 0a0a 2020 2020 2020     raise..      
+0001db80: 2020 6465 6620 636f 6d6d 6974 686f 6f6b    def commithook
+0001db90: 2875 6e75 7365 645f 7375 6363 6573 7329  (unused_success)
+0001dba0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0001dbb0: 6861 636b 2066 6f72 2063 6f6d 6d61 6e64  hack for command
+0001dbc0: 2074 6861 7420 7573 6520 6120 7465 6d70   that use a temp
+0001dbd0: 6f72 6172 7920 636f 6d6d 6974 2028 6567  orary commit (eg
+0001dbe0: 3a20 6869 7374 6564 6974 290a 2020 2020  : histedit).    
+0001dbf0: 2020 2020 2020 2020 2320 7465 6d70 6f72          # tempor
+0001dc00: 6172 7920 636f 6d6d 6974 2067 6f74 2073  ary commit got s
+0001dc10: 7472 6970 7065 6420 6265 666f 7265 2068  tripped before h
+0001dc20: 6f6f 6b20 7265 6c65 6173 650a 2020 2020  ook release.    
+0001dc30: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0001dc40: 6368 616e 6765 6c6f 672e 6861 736e 6f64  changelog.hasnod
+0001dc50: 6528 7265 7429 3a0a 2020 2020 2020 2020  e(ret):.        
+0001dc60: 2020 2020 2020 2020 7365 6c66 2e68 6f6f          self.hoo
+0001dc70: 6b28 0a20 2020 2020 2020 2020 2020 2020  k(.             
+0001dc80: 2020 2020 2020 2062 2263 6f6d 6d69 7422         b"commit"
+0001dc90: 2c20 6e6f 6465 3d68 6578 2872 6574 292c  , node=hex(ret),
+0001dca0: 2070 6172 656e 7431 3d68 6f6f 6b70 312c   parent1=hookp1,
+0001dcb0: 2070 6172 656e 7432 3d68 6f6f 6b70 320a   parent2=hookp2.
+0001dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dcd0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001dce0: 5f61 6674 6572 6c6f 636b 2863 6f6d 6d69  _afterlock(commi
+0001dcf0: 7468 6f6f 6b29 0a20 2020 2020 2020 2072  thook).        r
+0001dd00: 6574 7572 6e20 7265 740a 0a20 2020 2040  eturn ret..    @
+0001dd10: 756e 6669 6c74 6572 6564 6d65 7468 6f64  unfilteredmethod
+0001dd20: 0a20 2020 2064 6566 2063 6f6d 6d69 7463  .    def commitc
+0001dd30: 7478 2873 656c 662c 2063 7478 2c20 6572  tx(self, ctx, er
+0001dd40: 726f 723d 4661 6c73 652c 206f 7269 6763  ror=False, origc
+0001dd50: 7478 3d4e 6f6e 6529 3a0a 2020 2020 2020  tx=None):.      
+0001dd60: 2020 7265 7475 726e 2063 6f6d 6d69 742e    return commit.
+0001dd70: 636f 6d6d 6974 6374 7828 7365 6c66 2c20  commitctx(self, 
+0001dd80: 6374 782c 2065 7272 6f72 3d65 7272 6f72  ctx, error=error
+0001dd90: 2c20 6f72 6967 6374 783d 6f72 6967 6374  , origctx=origct
+0001dda0: 7829 0a0a 2020 2020 4075 6e66 696c 7465  x)..    @unfilte
+0001ddb0: 7265 646d 6574 686f 640a 2020 2020 6465  redmethod.    de
+0001ddc0: 6620 6465 7374 726f 7969 6e67 2873 656c  f destroying(sel
+0001ddd0: 6629 3a0a 2020 2020 2020 2020 2222 2249  f):.        """I
+0001dde0: 6e66 6f72 6d20 7468 6520 7265 706f 7369  nform the reposi
+0001ddf0: 746f 7279 2074 6861 7420 6e6f 6465 7320  tory that nodes 
+0001de00: 6172 6520 6162 6f75 7420 746f 2062 6520  are about to be 
+0001de10: 6465 7374 726f 7965 642e 0a20 2020 2020  destroyed..     
+0001de20: 2020 2049 6e74 656e 6465 6420 666f 7220     Intended for 
+0001de30: 7573 6520 6279 2073 7472 6970 2061 6e64  use by strip and
+0001de40: 2072 6f6c 6c62 6163 6b2c 2073 6f20 7468   rollback, so th
+0001de50: 6572 6527 7320 6120 636f 6d6d 6f6e 0a20  ere's a common. 
+0001de60: 2020 2020 2020 2070 6c61 6365 2066 6f72         place for
+0001de70: 2061 6e79 7468 696e 6720 7468 6174 2068   anything that h
+0001de80: 6173 2074 6f20 6265 2064 6f6e 6520 6265  as to be done be
+0001de90: 666f 7265 2064 6573 7472 6f79 696e 6720  fore destroying 
+0001dea0: 6869 7374 6f72 792e 0a0a 2020 2020 2020  history...      
+0001deb0: 2020 5468 6973 2069 7320 6d6f 7374 6c79    This is mostly
+0001dec0: 2075 7365 6675 6c20 666f 7220 7361 7669   useful for savi
+0001ded0: 6e67 2073 7461 7465 2074 6861 7420 6973  ng state that is
+0001dee0: 2069 6e20 6d65 6d6f 7279 2061 6e64 2077   in memory and w
+0001def0: 6169 7469 6e67 0a20 2020 2020 2020 2074  aiting.        t
+0001df00: 6f20 6265 2066 6c75 7368 6564 2077 6865  o be flushed whe
+0001df10: 6e20 7468 6520 6375 7272 656e 7420 6c6f  n the current lo
+0001df20: 636b 2069 7320 7265 6c65 6173 6564 2e20  ck is released. 
+0001df30: 4265 6361 7573 6520 6120 6361 6c6c 2074  Because a call t
+0001df40: 6f0a 2020 2020 2020 2020 6465 7374 726f  o.        destro
+0001df50: 7965 6420 6973 2069 6d6d 696e 656e 742c  yed is imminent,
+0001df60: 2074 6865 2072 6570 6f20 7769 6c6c 2062   the repo will b
+0001df70: 6520 696e 7661 6c69 6461 7465 6420 6361  e invalidated ca
+0001df80: 7573 696e 6720 7468 6f73 650a 2020 2020  using those.    
+0001df90: 2020 2020 6368 616e 6765 7320 746f 2073      changes to s
+0001dfa0: 7461 7920 696e 206d 656d 6f72 7920 2877  tay in memory (w
+0001dfb0: 6169 7469 6e67 2066 6f72 2074 6865 206e  aiting for the n
+0001dfc0: 6578 7420 756e 6c6f 636b 292c 206f 7220  ext unlock), or 
+0001dfd0: 7661 6e69 7368 0a20 2020 2020 2020 2063  vanish.        c
+0001dfe0: 6f6d 706c 6574 656c 792e 0a20 2020 2020  ompletely..     
+0001dff0: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
+0001e000: 2057 6865 6e20 7573 696e 6720 7468 6520   When using the 
+0001e010: 7361 6d65 206c 6f63 6b20 746f 2063 6f6d  same lock to com
+0001e020: 6d69 7420 616e 6420 7374 7269 702c 2074  mit and strip, t
+0001e030: 6865 2070 6861 7365 6361 6368 6520 6973  he phasecache is
+0001e040: 206c 6566 740a 2020 2020 2020 2020 2320   left.        # 
+0001e050: 6469 7274 7920 6166 7465 7220 636f 6d6d  dirty after comm
+0001e060: 6974 7469 6e67 2e20 5468 656e 2077 6865  itting. Then whe
+0001e070: 6e20 7765 2073 7472 6970 2c20 7468 6520  n we strip, the 
+0001e080: 7265 706f 2069 7320 696e 7661 6c69 6461  repo is invalida
+0001e090: 7465 642c 0a20 2020 2020 2020 2023 2063  ted,.        # c
+0001e0a0: 6175 7369 6e67 2074 686f 7365 2063 6861  ausing those cha
+0001e0b0: 6e67 6573 2074 6f20 6469 7361 7070 6561  nges to disappea
+0001e0c0: 722e 0a20 2020 2020 2020 2069 6620 275f  r..        if '_
+0001e0d0: 7068 6173 6563 6163 6865 2720 696e 2076  phasecache' in v
+0001e0e0: 6172 7328 7365 6c66 293a 0a20 2020 2020  ars(self):.     
+0001e0f0: 2020 2020 2020 2073 656c 662e 5f70 6861         self._pha
+0001e100: 7365 6361 6368 652e 7772 6974 6528 290a  secache.write().
+0001e110: 0a20 2020 2040 756e 6669 6c74 6572 6564  .    @unfiltered
+0001e120: 6d65 7468 6f64 0a20 2020 2064 6566 2064  method.    def d
+0001e130: 6573 7472 6f79 6564 2873 656c 6629 3a0a  estroyed(self):.
+0001e140: 2020 2020 2020 2020 2222 2249 6e66 6f72          """Infor
+0001e150: 6d20 7468 6520 7265 706f 7369 746f 7279  m the repository
+0001e160: 2074 6861 7420 6e6f 6465 7320 6861 7665   that nodes have
+0001e170: 2062 6565 6e20 6465 7374 726f 7965 642e   been destroyed.
+0001e180: 0a20 2020 2020 2020 2049 6e74 656e 6465  .        Intende
+0001e190: 6420 666f 7220 7573 6520 6279 2073 7472  d for use by str
+0001e1a0: 6970 2061 6e64 2072 6f6c 6c62 6163 6b2c  ip and rollback,
+0001e1b0: 2073 6f20 7468 6572 6527 7320 6120 636f   so there's a co
+0001e1c0: 6d6d 6f6e 0a20 2020 2020 2020 2070 6c61  mmon.        pla
+0001e1d0: 6365 2066 6f72 2061 6e79 7468 696e 6720  ce for anything 
+0001e1e0: 7468 6174 2068 6173 2074 6f20 6265 2064  that has to be d
+0001e1f0: 6f6e 6520 6166 7465 7220 6465 7374 726f  one after destro
+0001e200: 7969 6e67 2068 6973 746f 7279 2e0a 2020  ying history..  
+0001e210: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001e220: 2020 2320 5768 656e 206f 6e65 2074 7269    # When one tri
+0001e230: 6573 2074 6f3a 0a20 2020 2020 2020 2023  es to:.        #
+0001e240: 2031 2920 6465 7374 726f 7920 6e6f 6465   1) destroy node
+0001e250: 7320 7468 7573 2063 616c 6c69 6e67 2074  s thus calling t
+0001e260: 6869 7320 6d65 7468 6f64 2028 652e 672e  his method (e.g.
+0001e270: 2073 7472 6970 290a 2020 2020 2020 2020   strip).        
+0001e280: 2320 3229 2075 7365 2070 6861 7365 6361  # 2) use phaseca
+0001e290: 6368 6520 736f 6d65 7768 6572 6520 2865  che somewhere (e
+0001e2a0: 2e67 2e20 636f 6d6d 6974 290a 2020 2020  .g. commit).    
+0001e2b0: 2020 2020 230a 2020 2020 2020 2020 2320      #.        # 
+0001e2c0: 7468 656e 2032 2920 7769 6c6c 2066 6169  then 2) will fai
+0001e2d0: 6c20 6265 6361 7573 6520 7468 6520 7068  l because the ph
+0001e2e0: 6173 6563 6163 6865 2063 6f6e 7461 696e  asecache contain
+0001e2f0: 7320 6e6f 6465 7320 7468 6174 2077 6572  s nodes that wer
+0001e300: 650a 2020 2020 2020 2020 2320 7265 6d6f  e.        # remo
+0001e310: 7665 642e 2057 6520 6361 6e20 6569 7468  ved. We can eith
+0001e320: 6572 2072 656d 6f76 6520 7068 6173 6563  er remove phasec
+0001e330: 6163 6865 2066 726f 6d20 7468 6520 6669  ache from the fi
+0001e340: 6c65 6361 6368 652c 0a20 2020 2020 2020  lecache,.       
+0001e350: 2023 2063 6175 7369 6e67 2069 7420 746f   # causing it to
+0001e360: 2072 656c 6f61 6420 6e65 7874 2074 696d   reload next tim
+0001e370: 6520 6974 2069 7320 6163 6365 7373 6564  e it is accessed
+0001e380: 2c20 6f72 2073 696d 706c 7920 6669 6c74  , or simply filt
+0001e390: 6572 0a20 2020 2020 2020 2023 2074 6865  er.        # the
+0001e3a0: 2072 656d 6f76 6564 206e 6f64 6573 206e   removed nodes n
+0001e3b0: 6f77 2061 6e64 2077 7269 7465 2074 6865  ow and write the
+0001e3c0: 2075 7064 6174 6564 2063 6163 6865 2e0a   updated cache..
+0001e3d0: 2020 2020 2020 2020 7365 6c66 2e5f 7068          self._ph
+0001e3e0: 6173 6563 6163 6865 2e66 696c 7465 7275  asecache.filteru
+0001e3f0: 6e6b 6e6f 776e 2873 656c 6629 0a20 2020  nknown(self).   
+0001e400: 2020 2020 2073 656c 662e 5f70 6861 7365       self._phase
+0001e410: 6361 6368 652e 7772 6974 6528 290a 0a20  cache.write().. 
+0001e420: 2020 2020 2020 2023 2072 6566 7265 7368         # refresh
+0001e430: 2061 6c6c 2072 6570 6f73 6974 6f72 7920   all repository 
+0001e440: 6361 6368 6573 0a20 2020 2020 2020 2073  caches.        s
+0001e450: 656c 662e 7570 6461 7465 6361 6368 6573  elf.updatecaches
+0001e460: 2829 0a0a 2020 2020 2020 2020 2320 456e  ()..        # En
+0001e470: 7375 7265 2074 6865 2070 6572 7369 7374  sure the persist
+0001e480: 656e 7420 7461 6720 6361 6368 6520 6973  ent tag cache is
+0001e490: 2075 7064 6174 6564 2e20 2044 6f69 6e67   updated.  Doing
+0001e4a0: 2069 7420 6e6f 770a 2020 2020 2020 2020   it now.        
+0001e4b0: 2320 6d65 616e 7320 7468 6174 2074 6865  # means that the
+0001e4c0: 2074 6167 2063 6163 6865 206f 6e6c 7920   tag cache only 
+0001e4d0: 6861 7320 746f 2077 6f72 7279 2061 626f  has to worry abo
+0001e4e0: 7574 2064 6573 7472 6f79 6564 0a20 2020  ut destroyed.   
+0001e4f0: 2020 2020 2023 2068 6561 6473 2069 6d6d       # heads imm
+0001e500: 6564 6961 7465 6c79 2061 6674 6572 2061  ediately after a
+0001e510: 2073 7472 6970 2f72 6f6c 6c62 6163 6b2e   strip/rollback.
+0001e520: 2020 5468 6174 2069 6e20 7475 726e 0a20    That in turn. 
+0001e530: 2020 2020 2020 2023 2067 7561 7261 6e74         # guarant
+0001e540: 6565 7320 7468 6174 2022 6361 6368 6574  ees that "cachet
+0001e550: 6970 203d 3d20 6375 7272 656e 7474 6970  ip == currenttip
+0001e560: 2220 2863 6f6d 7061 7269 6e67 2062 6f74  " (comparing bot
+0001e570: 6820 7265 760a 2020 2020 2020 2020 2320  h rev.        # 
+0001e580: 616e 6420 6e6f 6465 2920 616c 7761 7973  and node) always
+0001e590: 206d 6561 6e73 206e 6f20 6e6f 6465 7320   means no nodes 
+0001e5a0: 6861 7665 2062 6565 6e20 6164 6465 6420  have been added 
+0001e5b0: 6f72 2064 6573 7472 6f79 6564 2e0a 0a20  or destroyed... 
+0001e5c0: 2020 2020 2020 2023 2058 5858 2074 6869         # XXX thi
+0001e5d0: 7320 6973 2073 7562 6f70 7469 6d61 6c20  s is suboptimal 
+0001e5e0: 7768 656e 2071 7265 6672 6573 6827 696e  when qrefresh'in
+0001e5f0: 673a 2077 6520 7374 7269 7020 7468 6520  g: we strip the 
+0001e600: 6375 7272 656e 740a 2020 2020 2020 2020  current.        
+0001e610: 2320 6865 6164 2c20 7265 6672 6573 6820  # head, refresh 
+0001e620: 7468 6520 7461 6720 6361 6368 652c 2074  the tag cache, t
+0001e630: 6865 6e20 696d 6d65 6469 6174 656c 7920  hen immediately 
+0001e640: 6164 6420 6120 6e65 7720 6865 6164 2e0a  add a new head..
+0001e650: 2020 2020 2020 2020 2320 4275 7420 4920          # But I 
+0001e660: 7468 696e 6b20 646f 696e 6720 6974 2074  think doing it t
+0001e670: 6869 7320 7761 7920 6973 206e 6563 6573  his way is neces
+0001e680: 7361 7279 2066 6f72 2074 6865 2022 696e  sary for the "in
+0001e690: 7374 616e 740a 2020 2020 2020 2020 2320  stant.        # 
+0001e6a0: 7461 6720 6361 6368 6520 7265 7472 6965  tag cache retrie
+0001e6b0: 7661 6c22 2063 6173 6520 746f 2077 6f72  val" case to wor
+0001e6c0: 6b2e 0a20 2020 2020 2020 2073 656c 662e  k..        self.
+0001e6d0: 696e 7661 6c69 6461 7465 2829 0a0a 2020  invalidate()..  
+0001e6e0: 2020 6465 6620 7374 6174 7573 280a 2020    def status(.  
+0001e6f0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0001e700: 2020 2020 6e6f 6465 313d 6227 2e27 2c0a      node1=b'.',.
+0001e710: 2020 2020 2020 2020 6e6f 6465 323d 4e6f          node2=No
+0001e720: 6e65 2c0a 2020 2020 2020 2020 6d61 7463  ne,.        matc
+0001e730: 683d 4e6f 6e65 2c0a 2020 2020 2020 2020  h=None,.        
+0001e740: 6967 6e6f 7265 643d 4661 6c73 652c 0a20  ignored=False,. 
+0001e750: 2020 2020 2020 2063 6c65 616e 3d46 616c         clean=Fal
+0001e760: 7365 2c0a 2020 2020 2020 2020 756e 6b6e  se,.        unkn
+0001e770: 6f77 6e3d 4661 6c73 652c 0a20 2020 2020  own=False,.     
+0001e780: 2020 206c 6973 7473 7562 7265 706f 733d     listsubrepos=
+0001e790: 4661 6c73 652c 0a20 2020 2029 3a0a 2020  False,.    ):.  
+0001e7a0: 2020 2020 2020 2727 2761 2063 6f6e 7665        '''a conve
+0001e7b0: 6e69 656e 6365 206d 6574 686f 6420 7468  nience method th
+0001e7c0: 6174 2063 616c 6c73 206e 6f64 6531 2e73  at calls node1.s
+0001e7d0: 7461 7475 7328 6e6f 6465 3229 2727 270a  tatus(node2)'''.
+0001e7e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0001e7f0: 656c 665b 6e6f 6465 315d 2e73 7461 7475  elf[node1].statu
+0001e800: 7328 0a20 2020 2020 2020 2020 2020 206e  s(.            n
+0001e810: 6f64 6532 2c20 6d61 7463 682c 2069 676e  ode2, match, ign
+0001e820: 6f72 6564 2c20 636c 6561 6e2c 2075 6e6b  ored, clean, unk
+0001e830: 6e6f 776e 2c20 6c69 7374 7375 6272 6570  nown, listsubrep
+0001e840: 6f73 0a20 2020 2020 2020 2029 0a0a 2020  os.        )..  
+0001e850: 2020 6465 6620 6164 6470 6f73 7464 7373    def addpostdss
+0001e860: 7461 7475 7328 7365 6c66 2c20 7073 293a  tatus(self, ps):
+0001e870: 0a20 2020 2020 2020 2022 2222 4164 6420  .        """Add 
+0001e880: 6120 6361 6c6c 6261 636b 2074 6f20 7275  a callback to ru
+0001e890: 6e20 7769 7468 696e 2074 6865 2077 6c6f  n within the wlo
+0001e8a0: 636b 2c20 6174 2074 6865 2070 6f69 6e74  ck, at the point
+0001e8b0: 2061 7420 7768 6963 6820 7374 6174 7573   at which status
+0001e8c0: 0a20 2020 2020 2020 2066 6978 7570 7320  .        fixups 
+0001e8d0: 6861 7070 656e 2e0a 0a20 2020 2020 2020  happen...       
+0001e8e0: 204f 6e20 7374 6174 7573 2063 6f6d 706c   On status compl
+0001e8f0: 6574 696f 6e2c 2063 616c 6c62 6163 6b28  etion, callback(
+0001e900: 7763 7478 2c20 7374 6174 7573 2920 7769  wctx, status) wi
+0001e910: 6c6c 2062 6520 6361 6c6c 6564 2077 6974  ll be called wit
+0001e920: 6820 7468 650a 2020 2020 2020 2020 776c  h the.        wl
+0001e930: 6f63 6b20 6865 6c64 2c20 756e 6c65 7373  ock held, unless
+0001e940: 2074 6865 2064 6972 7374 6174 6520 6861   the dirstate ha
+0001e950: 7320 6368 616e 6765 6420 6672 6f6d 2075  s changed from u
+0001e960: 6e64 6572 6e65 6174 6820 6f72 2074 6865  nderneath or the
+0001e970: 2077 6c6f 636b 0a20 2020 2020 2020 2063   wlock.        c
+0001e980: 6f75 6c64 6e27 7420 6265 2067 7261 6262  ouldn't be grabb
+0001e990: 6564 2e0a 0a20 2020 2020 2020 2043 616c  ed...        Cal
+0001e9a0: 6c62 6163 6b73 2073 686f 756c 6420 6e6f  lbacks should no
+0001e9b0: 7420 6361 7074 7572 6520 616e 6420 7573  t capture and us
+0001e9c0: 6520 6120 6361 6368 6564 2063 6f70 7920  e a cached copy 
+0001e9d0: 6f66 2074 6865 2064 6972 7374 6174 6520  of the dirstate 
+0001e9e0: 2d2d 0a20 2020 2020 2020 2069 7420 6d69  --.        it mi
+0001e9f0: 6768 7420 6368 616e 6765 2069 6e20 7468  ght change in th
+0001ea00: 6520 6d65 616e 7768 696c 652e 2049 6e73  e meanwhile. Ins
+0001ea10: 7465 6164 2c20 7468 6579 2073 686f 756c  tead, they shoul
+0001ea20: 6420 6163 6365 7373 2074 6865 0a20 2020  d access the.   
+0001ea30: 2020 2020 2064 6972 7374 6174 6520 7669       dirstate vi
+0001ea40: 6120 7763 7478 2e72 6570 6f28 292e 6469  a wctx.repo().di
+0001ea50: 7273 7461 7465 2e0a 0a20 2020 2020 2020  rstate...       
+0001ea60: 2054 6869 7320 6c69 7374 2069 7320 656d   This list is em
+0001ea70: 7074 6965 6420 6f75 7420 6166 7465 7220  ptied out after 
+0001ea80: 6561 6368 2073 7461 7475 7320 7275 6e20  each status run 
+0001ea90: 2d2d 2065 7874 656e 7369 6f6e 7320 7368  -- extensions sh
+0001eaa0: 6f75 6c64 0a20 2020 2020 2020 206d 616b  ould.        mak
+0001eab0: 6520 7375 7265 2069 7420 6164 6473 2074  e sure it adds t
+0001eac0: 6f20 7468 6973 206c 6973 7420 6561 6368  o this list each
+0001ead0: 2074 696d 6520 6469 7273 7461 7465 2e73   time dirstate.s
+0001eae0: 7461 7475 7320 6973 2063 616c 6c65 642e  tatus is called.
+0001eaf0: 0a20 2020 2020 2020 2045 7874 656e 7369  .        Extensi
+0001eb00: 6f6e 7320 7368 6f75 6c64 2061 6c73 6f20  ons should also 
+0001eb10: 6d61 6b65 2073 7572 6520 7468 6579 2064  make sure they d
+0001eb20: 6f6e 2774 2063 616c 6c20 7468 6973 2066  on't call this f
+0001eb30: 6f72 2073 7461 7475 7365 730a 2020 2020  or statuses.    
+0001eb40: 2020 2020 7468 6174 2064 6f6e 2774 2069      that don't i
+0001eb50: 6e76 6f6c 7665 2074 6865 2064 6972 7374  nvolve the dirst
+0001eb60: 6174 652e 0a20 2020 2020 2020 2022 2222  ate..        """
+0001eb70: 0a0a 2020 2020 2020 2020 2320 5468 6520  ..        # The 
+0001eb80: 6c69 7374 2069 7320 6c6f 6361 7465 6420  list is located 
+0001eb90: 6865 7265 2066 6f72 2075 6e69 7175 656e  here for uniquen
+0001eba0: 6573 7320 7265 6173 6f6e 7320 2d2d 2069  ess reasons -- i
+0001ebb0: 7420 6973 2061 6374 7561 6c6c 790a 2020  t is actually.  
+0001ebc0: 2020 2020 2020 2320 6d61 6e61 6765 6420        # managed 
+0001ebd0: 6279 2074 6865 2077 6f72 6b69 6e67 6374  by the workingct
+0001ebe0: 782c 2062 7574 2074 6861 7420 6973 6e27  x, but that isn'
+0001ebf0: 7420 756e 6971 7565 2070 6572 2d72 6570  t unique per-rep
+0001ec00: 6f2e 0a20 2020 2020 2020 2073 656c 662e  o..        self.
+0001ec10: 5f70 6f73 7464 7373 7461 7475 732e 6170  _postdsstatus.ap
+0001ec20: 7065 6e64 2870 7329 0a0a 2020 2020 6465  pend(ps)..    de
+0001ec30: 6620 706f 7374 6473 7374 6174 7573 2873  f postdsstatus(s
+0001ec40: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0001ec50: 2255 7365 6420 6279 2077 6f72 6b69 6e67  "Used by working
+0001ec60: 6374 7820 746f 2067 6574 2074 6865 206c  ctx to get the l
+0001ec70: 6973 7420 6f66 2070 6f73 742d 6469 7273  ist of post-dirs
+0001ec80: 7461 7465 2d73 7461 7475 7320 686f 6f6b  tate-status hook
+0001ec90: 732e 2222 220a 2020 2020 2020 2020 7265  s.""".        re
+0001eca0: 7475 726e 2073 656c 662e 5f70 6f73 7464  turn self._postd
+0001ecb0: 7373 7461 7475 730a 0a20 2020 2064 6566  sstatus..    def
+0001ecc0: 2063 6c65 6172 706f 7374 6473 7374 6174   clearpostdsstat
+0001ecd0: 7573 2873 656c 6629 3a0a 2020 2020 2020  us(self):.      
+0001ece0: 2020 2222 2255 7365 6420 6279 2077 6f72    """Used by wor
+0001ecf0: 6b69 6e67 6374 7820 746f 2063 6c65 6172  kingctx to clear
+0001ed00: 2070 6f73 742d 6469 7273 7461 7465 2d73   post-dirstate-s
+0001ed10: 7461 7475 7320 686f 6f6b 732e 2222 220a  tatus hooks.""".
+0001ed20: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
+0001ed30: 2e5f 706f 7374 6473 7374 6174 7573 5b3a  ._postdsstatus[:
+0001ed40: 5d0a 0a20 2020 2064 6566 2068 6561 6473  ]..    def heads
+0001ed50: 2873 656c 662c 2073 7461 7274 3d4e 6f6e  (self, start=Non
+0001ed60: 6529 3a0a 2020 2020 2020 2020 6966 2073  e):.        if s
+0001ed70: 7461 7274 2069 7320 4e6f 6e65 3a0a 2020  tart is None:.  
+0001ed80: 2020 2020 2020 2020 2020 636c 203d 2073            cl = s
+0001ed90: 656c 662e 6368 616e 6765 6c6f 670a 2020  elf.changelog.  
+0001eda0: 2020 2020 2020 2020 2020 6865 6164 7265            headre
+0001edb0: 7673 203d 2072 6576 6572 7365 6428 636c  vs = reversed(cl
+0001edc0: 2e68 6561 6472 6576 7328 2929 0a20 2020  .headrevs()).   
+0001edd0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001ede0: 5b63 6c2e 6e6f 6465 2872 6576 2920 666f  [cl.node(rev) fo
+0001edf0: 7220 7265 7620 696e 2068 6561 6472 6576  r rev in headrev
+0001ee00: 735d 0a0a 2020 2020 2020 2020 6865 6164  s]..        head
+0001ee10: 7320 3d20 7365 6c66 2e63 6861 6e67 656c  s = self.changel
+0001ee20: 6f67 2e68 6561 6473 2873 7461 7274 290a  og.heads(start).
+0001ee30: 2020 2020 2020 2020 2320 736f 7274 2074          # sort t
+0001ee40: 6865 206f 7574 7075 7420 696e 2072 6576  he output in rev
+0001ee50: 2064 6573 6365 6e64 696e 6720 6f72 6465   descending orde
+0001ee60: 720a 2020 2020 2020 2020 7265 7475 726e  r.        return
+0001ee70: 2073 6f72 7465 6428 6865 6164 732c 206b   sorted(heads, k
+0001ee80: 6579 3d73 656c 662e 6368 616e 6765 6c6f  ey=self.changelo
+0001ee90: 672e 7265 762c 2072 6576 6572 7365 3d54  g.rev, reverse=T
+0001eea0: 7275 6529 0a0a 2020 2020 6465 6620 6272  rue)..    def br
+0001eeb0: 616e 6368 6865 6164 7328 7365 6c66 2c20  anchheads(self, 
+0001eec0: 6272 616e 6368 3d4e 6f6e 652c 2073 7461  branch=None, sta
+0001eed0: 7274 3d4e 6f6e 652c 2063 6c6f 7365 643d  rt=None, closed=
+0001eee0: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+0001eef0: 2222 2272 6574 7572 6e20 6120 2870 6f73  """return a (pos
+0001ef00: 7369 626c 7920 6669 6c74 6572 6564 2920  sibly filtered) 
+0001ef10: 6c69 7374 206f 6620 6865 6164 7320 666f  list of heads fo
+0001ef20: 7220 7468 6520 6769 7665 6e20 6272 616e  r the given bran
+0001ef30: 6368 0a0a 2020 2020 2020 2020 4865 6164  ch..        Head
+0001ef40: 7320 6172 6520 7265 7475 726e 6564 2069  s are returned i
+0001ef50: 6e20 746f 706f 6c6f 6769 6361 6c20 6f72  n topological or
+0001ef60: 6465 722c 2066 726f 6d20 6e65 7765 7374  der, from newest
+0001ef70: 2074 6f20 6f6c 6465 7374 2e0a 2020 2020   to oldest..    
+0001ef80: 2020 2020 4966 2062 7261 6e63 6820 6973      If branch is
+0001ef90: 204e 6f6e 652c 2075 7365 2074 6865 2064   None, use the d
+0001efa0: 6972 7374 6174 6520 6272 616e 6368 2e0a  irstate branch..
+0001efb0: 2020 2020 2020 2020 4966 2073 7461 7274          If start
+0001efc0: 2069 7320 6e6f 7420 4e6f 6e65 2c20 7265   is not None, re
+0001efd0: 7475 726e 206f 6e6c 7920 6865 6164 7320  turn only heads 
+0001efe0: 7265 6163 6861 626c 6520 6672 6f6d 2073  reachable from s
+0001eff0: 7461 7274 2e0a 2020 2020 2020 2020 4966  tart..        If
+0001f000: 2063 6c6f 7365 6420 6973 2054 7275 652c   closed is True,
+0001f010: 2072 6574 7572 6e20 6865 6164 7320 7468   return heads th
+0001f020: 6174 2061 7265 206d 6172 6b65 6420 6173  at are marked as
+0001f030: 2063 6c6f 7365 6420 6173 2077 656c 6c2e   closed as well.
+0001f040: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001f050: 2020 2020 2069 6620 6272 616e 6368 2069       if branch i
+0001f060: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001f070: 2020 2020 6272 616e 6368 203d 2073 656c      branch = sel
+0001f080: 665b 4e6f 6e65 5d2e 6272 616e 6368 2829  f[None].branch()
+0001f090: 0a20 2020 2020 2020 2062 7261 6e63 6865  .        branche
+0001f0a0: 7320 3d20 7365 6c66 2e62 7261 6e63 686d  s = self.branchm
+0001f0b0: 6170 2829 0a20 2020 2020 2020 2069 6620  ap().        if 
+0001f0c0: 6e6f 7420 6272 616e 6368 6573 2e68 6173  not branches.has
+0001f0d0: 6272 616e 6368 2862 7261 6e63 6829 3a0a  branch(branch):.
+0001f0e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001f0f0: 726e 205b 5d0a 2020 2020 2020 2020 2320  rn [].        # 
+0001f100: 7468 6520 6361 6368 6520 7265 7475 726e  the cache return
+0001f110: 7320 6865 6164 7320 6f72 6465 7265 6420  s heads ordered 
+0001f120: 6c6f 7765 7374 2074 6f20 6869 6768 6573  lowest to highes
+0001f130: 740a 2020 2020 2020 2020 6268 6561 6473  t.        bheads
+0001f140: 203d 206c 6973 7428 7265 7665 7273 6564   = list(reversed
+0001f150: 2862 7261 6e63 6865 732e 6272 616e 6368  (branches.branch
+0001f160: 6865 6164 7328 6272 616e 6368 2c20 636c  heads(branch, cl
+0001f170: 6f73 6564 3d63 6c6f 7365 6429 2929 0a20  osed=closed))). 
+0001f180: 2020 2020 2020 2069 6620 7374 6172 7420         if start 
+0001f190: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0001f1a0: 2020 2020 2020 2020 2023 2066 696c 7465           # filte
+0001f1b0: 7220 6f75 7420 7468 6520 6865 6164 7320  r out the heads 
+0001f1c0: 7468 6174 2063 616e 6e6f 7420 6265 2072  that cannot be r
+0001f1d0: 6561 6368 6564 2066 726f 6d20 7374 6172  eached from star
+0001f1e0: 7472 6576 0a20 2020 2020 2020 2020 2020  trev.           
+0001f1f0: 2066 6268 6561 6473 203d 2073 6574 2873   fbheads = set(s
+0001f200: 656c 662e 6368 616e 6765 6c6f 672e 6e6f  elf.changelog.no
+0001f210: 6465 7362 6574 7765 656e 285b 7374 6172  desbetween([star
+0001f220: 745d 2c20 6268 6561 6473 295b 325d 290a  t], bheads)[2]).
+0001f230: 2020 2020 2020 2020 2020 2020 6268 6561              bhea
+0001f240: 6473 203d 205b 6820 666f 7220 6820 696e  ds = [h for h in
+0001f250: 2062 6865 6164 7320 6966 2068 2069 6e20   bheads if h in 
+0001f260: 6662 6865 6164 735d 0a20 2020 2020 2020  fbheads].       
+0001f270: 2072 6574 7572 6e20 6268 6561 6473 0a0a   return bheads..
+0001f280: 2020 2020 6465 6620 6272 616e 6368 6573      def branches
+0001f290: 2873 656c 662c 206e 6f64 6573 293a 0a20  (self, nodes):. 
+0001f2a0: 2020 2020 2020 2069 6620 6e6f 7420 6e6f         if not no
+0001f2b0: 6465 733a 0a20 2020 2020 2020 2020 2020  des:.           
+0001f2c0: 206e 6f64 6573 203d 205b 7365 6c66 2e63   nodes = [self.c
+0001f2d0: 6861 6e67 656c 6f67 2e74 6970 2829 5d0a  hangelog.tip()].
+0001f2e0: 2020 2020 2020 2020 6220 3d20 5b5d 0a20          b = []. 
+0001f2f0: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
+0001f300: 6e6f 6465 733a 0a20 2020 2020 2020 2020  nodes:.         
+0001f310: 2020 2074 203d 206e 0a20 2020 2020 2020     t = n.       
+0001f320: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
+0001f330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f340: 2070 203d 2073 656c 662e 6368 616e 6765   p = self.change
+0001f350: 6c6f 672e 7061 7265 6e74 7328 6e29 0a20  log.parents(n). 
+0001f360: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001f370: 6620 705b 315d 2021 3d20 7365 6c66 2e6e  f p[1] != self.n
+0001f380: 756c 6c69 6420 6f72 2070 5b30 5d20 3d3d  ullid or p[0] ==
+0001f390: 2073 656c 662e 6e75 6c6c 6964 3a0a 2020   self.nullid:.  
+0001f3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3b0: 2020 622e 6170 7065 6e64 2828 742c 206e    b.append((t, n
+0001f3c0: 2c20 705b 305d 2c20 705b 315d 2929 0a20  , p[0], p[1])). 
+0001f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3e0: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+0001f3f0: 2020 2020 2020 2020 206e 203d 2070 5b30           n = p[0
+0001f400: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
+0001f410: 2062 0a0a 2020 2020 6465 6620 6265 7477   b..    def betw
+0001f420: 6565 6e28 7365 6c66 2c20 7061 6972 7329  een(self, pairs)
+0001f430: 3a0a 2020 2020 2020 2020 7220 3d20 5b5d  :.        r = []
+0001f440: 0a0a 2020 2020 2020 2020 666f 7220 746f  ..        for to
+0001f450: 702c 2062 6f74 746f 6d20 696e 2070 6169  p, bottom in pai
+0001f460: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+0001f470: 6e2c 206c 2c20 6920 3d20 746f 702c 205b  n, l, i = top, [
+0001f480: 5d2c 2030 0a20 2020 2020 2020 2020 2020  ], 0.           
+0001f490: 2066 203d 2031 0a0a 2020 2020 2020 2020   f = 1..        
+0001f4a0: 2020 2020 7768 696c 6520 6e20 213d 2062      while n != b
+0001f4b0: 6f74 746f 6d20 616e 6420 6e20 213d 2073  ottom and n != s
+0001f4c0: 656c 662e 6e75 6c6c 6964 3a0a 2020 2020  elf.nullid:.    
+0001f4d0: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
+0001f4e0: 7365 6c66 2e63 6861 6e67 656c 6f67 2e70  self.changelog.p
+0001f4f0: 6172 656e 7473 286e 295b 305d 0a20 2020  arents(n)[0].   
+0001f500: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001f510: 6920 3d3d 2066 3a0a 2020 2020 2020 2020  i == f:.        
+0001f520: 2020 2020 2020 2020 2020 2020 6c2e 6170              l.ap
+0001f530: 7065 6e64 286e 290a 2020 2020 2020 2020  pend(n).        
+0001f540: 2020 2020 2020 2020 2020 2020 6620 3d20              f = 
+0001f550: 6620 2a20 320a 2020 2020 2020 2020 2020  f * 2.          
+0001f560: 2020 2020 2020 6e20 3d20 700a 2020 2020        n = p.    
+0001f570: 2020 2020 2020 2020 2020 2020 6920 2b3d              i +=
+0001f580: 2031 0a0a 2020 2020 2020 2020 2020 2020   1..            
+0001f590: 722e 6170 7065 6e64 286c 290a 0a20 2020  r.append(l)..   
+0001f5a0: 2020 2020 2072 6574 7572 6e20 720a 0a20       return r.. 
+0001f5b0: 2020 2064 6566 2063 6865 636b 7075 7368     def checkpush
+0001f5c0: 2873 656c 662c 2070 7573 686f 7029 3a0a  (self, pushop):.
+0001f5d0: 2020 2020 2020 2020 2222 2245 7874 656e          """Exten
+0001f5e0: 7369 6f6e 7320 6361 6e20 6f76 6572 7269  sions can overri
+0001f5f0: 6465 2074 6869 7320 6675 6e63 7469 6f6e  de this function
+0001f600: 2069 6620 6164 6469 7469 6f6e 616c 2063   if additional c
+0001f610: 6865 636b 7320 6861 7665 0a20 2020 2020  hecks have.     
+0001f620: 2020 2074 6f20 6265 2070 6572 666f 726d     to be perform
+0001f630: 6564 2062 6566 6f72 6520 7075 7368 696e  ed before pushin
+0001f640: 672c 206f 7220 6361 6c6c 2069 7420 6966  g, or call it if
+0001f650: 2074 6865 7920 6f76 6572 7269 6465 2070   they override p
+0001f660: 7573 680a 2020 2020 2020 2020 636f 6d6d  ush.        comm
+0001f670: 616e 642e 0a20 2020 2020 2020 2022 2222  and..        """
+0001f680: 0a0a 2020 2020 4075 6e66 696c 7465 7265  ..    @unfiltere
+0001f690: 6470 726f 7065 7274 7963 6163 6865 0a20  dpropertycache. 
+0001f6a0: 2020 2064 6566 2070 7265 7075 7368 6f75     def prepushou
+0001f6b0: 7467 6f69 6e67 686f 6f6b 7328 7365 6c66  tgoinghooks(self
+0001f6c0: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+0001f6d0: 7475 726e 2075 7469 6c2e 686f 6f6b 7320  turn util.hooks 
+0001f6e0: 636f 6e73 6973 7473 206f 6620 6120 7075  consists of a pu
+0001f6f0: 7368 6f70 2077 6974 6820 7265 706f 2c20  shop with repo, 
+0001f700: 7265 6d6f 7465 2c20 6f75 7467 6f69 6e67  remote, outgoing
+0001f710: 0a20 2020 2020 2020 206d 6574 686f 6473  .        methods
+0001f720: 2c20 7768 6963 6820 6172 6520 6361 6c6c  , which are call
+0001f730: 6564 2062 6566 6f72 6520 7075 7368 696e  ed before pushin
+0001f740: 6720 6368 616e 6765 7365 7473 2e0a 2020  g changesets..  
+0001f750: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001f760: 2020 7265 7475 726e 2075 7469 6c2e 686f    return util.ho
+0001f770: 6f6b 7328 290a 0a20 2020 2064 6566 2070  oks()..    def p
+0001f780: 7573 686b 6579 2873 656c 662c 206e 616d  ushkey(self, nam
+0001f790: 6573 7061 6365 2c20 6b65 792c 206f 6c64  espace, key, old
+0001f7a0: 2c20 6e65 7729 3a0a 2020 2020 2020 2020  , new):.        
+0001f7b0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0001f7c0: 2074 7220 3d20 7365 6c66 2e63 7572 7265   tr = self.curre
+0001f7d0: 6e74 7472 616e 7361 6374 696f 6e28 290a  nttransaction().
+0001f7e0: 2020 2020 2020 2020 2020 2020 686f 6f6b              hook
+0001f7f0: 6172 6773 203d 207b 7d0a 2020 2020 2020  args = {}.      
+0001f800: 2020 2020 2020 6966 2074 7220 6973 206e        if tr is n
+0001f810: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0001f820: 2020 2020 2020 2020 2068 6f6f 6b61 7267           hookarg
+0001f830: 732e 7570 6461 7465 2874 722e 686f 6f6b  s.update(tr.hook
+0001f840: 6172 6773 290a 2020 2020 2020 2020 2020  args).          
+0001f850: 2020 686f 6f6b 6172 6773 203d 2070 7963    hookargs = pyc
+0001f860: 6f6d 7061 742e 7374 726b 7761 7267 7328  ompat.strkwargs(
+0001f870: 686f 6f6b 6172 6773 290a 2020 2020 2020  hookargs).      
+0001f880: 2020 2020 2020 686f 6f6b 6172 6773 5b27        hookargs['
+0001f890: 6e61 6d65 7370 6163 6527 5d20 3d20 6e61  namespace'] = na
+0001f8a0: 6d65 7370 6163 650a 2020 2020 2020 2020  mespace.        
+0001f8b0: 2020 2020 686f 6f6b 6172 6773 5b27 6b65      hookargs['ke
+0001f8c0: 7927 5d20 3d20 6b65 790a 2020 2020 2020  y'] = key.      
+0001f8d0: 2020 2020 2020 686f 6f6b 6172 6773 5b27        hookargs['
+0001f8e0: 6f6c 6427 5d20 3d20 6f6c 640a 2020 2020  old'] = old.    
+0001f8f0: 2020 2020 2020 2020 686f 6f6b 6172 6773          hookargs
+0001f900: 5b27 6e65 7727 5d20 3d20 6e65 770a 2020  ['new'] = new.  
+0001f910: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
+0001f920: 6f6f 6b28 6227 7072 6570 7573 686b 6579  ook(b'prepushkey
+0001f930: 272c 2074 6872 6f77 3d54 7275 652c 202a  ', throw=True, *
+0001f940: 2a68 6f6f 6b61 7267 7329 0a20 2020 2020  *hookargs).     
+0001f950: 2020 2065 7863 6570 7420 6572 726f 722e     except error.
+0001f960: 486f 6f6b 4162 6f72 7420 6173 2065 7863  HookAbort as exc
+0001f970: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0001f980: 6c66 2e75 692e 7772 6974 655f 6572 7228  lf.ui.write_err(
+0001f990: 5f28 6222 7075 7368 6b65 792d 6162 6f72  _(b"pushkey-abor
+0001f9a0: 743a 2025 735c 6e22 2920 2520 6578 6329  t: %s\n") % exc)
+0001f9b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001f9c0: 6578 632e 6869 6e74 3a0a 2020 2020 2020  exc.hint:.      
+0001f9d0: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
+0001f9e0: 692e 7772 6974 655f 6572 7228 5f28 6222  i.write_err(_(b"
+0001f9f0: 2825 7329 5c6e 2229 2025 2065 7863 2e68  (%s)\n") % exc.h
+0001fa00: 696e 7429 0a20 2020 2020 2020 2020 2020  int).           
+0001fa10: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0001fa20: 2020 2020 2020 7365 6c66 2e75 692e 6465        self.ui.de
+0001fa30: 6275 6728 6227 7075 7368 696e 6720 6b65  bug(b'pushing ke
+0001fa40: 7920 666f 7220 2225 733a 2573 225c 6e27  y for "%s:%s"\n'
+0001fa50: 2025 2028 6e61 6d65 7370 6163 652c 206b   % (namespace, k
+0001fa60: 6579 2929 0a20 2020 2020 2020 2072 6574  ey)).        ret
+0001fa70: 203d 2070 7573 686b 6579 2e70 7573 6828   = pushkey.push(
+0001fa80: 7365 6c66 2c20 6e61 6d65 7370 6163 652c  self, namespace,
+0001fa90: 206b 6579 2c20 6f6c 642c 206e 6577 290a   key, old, new).
+0001faa0: 0a20 2020 2020 2020 2064 6566 2072 756e  .        def run
+0001fab0: 686f 6f6b 2875 6e75 7365 645f 7375 6363  hook(unused_succ
+0001fac0: 6573 7329 3a0a 2020 2020 2020 2020 2020  ess):.          
+0001fad0: 2020 7365 6c66 2e68 6f6f 6b28 0a20 2020    self.hook(.   
+0001fae0: 2020 2020 2020 2020 2020 2020 2062 2770               b'p
+0001faf0: 7573 686b 6579 272c 0a20 2020 2020 2020  ushkey',.       
+0001fb00: 2020 2020 2020 2020 206e 616d 6573 7061           namespa
+0001fb10: 6365 3d6e 616d 6573 7061 6365 2c0a 2020  ce=namespace,.  
+0001fb20: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+0001fb30: 793d 6b65 792c 0a20 2020 2020 2020 2020  y=key,.         
+0001fb40: 2020 2020 2020 206f 6c64 3d6f 6c64 2c0a         old=old,.
+0001fb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb60: 6e65 773d 6e65 772c 0a20 2020 2020 2020  new=new,.       
+0001fb70: 2020 2020 2020 2020 2072 6574 3d72 6574           ret=ret
+0001fb80: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0001fb90: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
+0001fba0: 6674 6572 6c6f 636b 2872 756e 686f 6f6b  fterlock(runhook
+0001fbb0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001fbc0: 2072 6574 0a0a 2020 2020 6465 6620 6c69   ret..    def li
+0001fbd0: 7374 6b65 7973 2873 656c 662c 206e 616d  stkeys(self, nam
+0001fbe0: 6573 7061 6365 293a 0a20 2020 2020 2020  espace):.       
+0001fbf0: 2073 656c 662e 686f 6f6b 2862 2770 7265   self.hook(b'pre
+0001fc00: 6c69 7374 6b65 7973 272c 2074 6872 6f77  listkeys', throw
+0001fc10: 3d54 7275 652c 206e 616d 6573 7061 6365  =True, namespace
+0001fc20: 3d6e 616d 6573 7061 6365 290a 2020 2020  =namespace).    
+0001fc30: 2020 2020 7365 6c66 2e75 692e 6465 6275      self.ui.debu
+0001fc40: 6728 6227 6c69 7374 696e 6720 6b65 7973  g(b'listing keys
+0001fc50: 2066 6f72 2022 2573 225c 6e27 2025 206e   for "%s"\n' % n
+0001fc60: 616d 6573 7061 6365 290a 2020 2020 2020  amespace).      
+0001fc70: 2020 7661 6c75 6573 203d 2070 7573 686b    values = pushk
+0001fc80: 6579 2e6c 6973 7428 7365 6c66 2c20 6e61  ey.list(self, na
+0001fc90: 6d65 7370 6163 6529 0a20 2020 2020 2020  mespace).       
+0001fca0: 2073 656c 662e 686f 6f6b 2862 276c 6973   self.hook(b'lis
+0001fcb0: 746b 6579 7327 2c20 6e61 6d65 7370 6163  tkeys', namespac
+0001fcc0: 653d 6e61 6d65 7370 6163 652c 2076 616c  e=namespace, val
+0001fcd0: 7565 733d 7661 6c75 6573 290a 2020 2020  ues=values).    
+0001fce0: 2020 2020 7265 7475 726e 2076 616c 7565      return value
+0001fcf0: 730a 0a20 2020 2064 6566 2064 6562 7567  s..    def debug
+0001fd00: 7769 7265 6172 6773 2873 656c 662c 206f  wireargs(self, o
+0001fd10: 6e65 2c20 7477 6f2c 2074 6872 6565 3d4e  ne, two, three=N
+0001fd20: 6f6e 652c 2066 6f75 723d 4e6f 6e65 2c20  one, four=None, 
+0001fd30: 6669 7665 3d4e 6f6e 6529 3a0a 2020 2020  five=None):.    
+0001fd40: 2020 2020 2727 2775 7365 6420 746f 2074      '''used to t
+0001fd50: 6573 7420 6172 6775 6d65 6e74 2070 6173  est argument pas
+0001fd60: 7369 6e67 206f 7665 7220 7468 6520 7769  sing over the wi
+0001fd70: 7265 2727 270a 2020 2020 2020 2020 7265  re'''.        re
+0001fd80: 7475 726e 2062 2225 7320 2573 2025 7320  turn b"%s %s %s 
+0001fd90: 2573 2025 7322 2025 2028 0a20 2020 2020  %s %s" % (.     
+0001fda0: 2020 2020 2020 206f 6e65 2c0a 2020 2020         one,.    
+0001fdb0: 2020 2020 2020 2020 7477 6f2c 0a20 2020          two,.   
+0001fdc0: 2020 2020 2020 2020 2070 7963 6f6d 7061           pycompa
+0001fdd0: 742e 6279 7465 7374 7228 7468 7265 6529  t.bytestr(three)
+0001fde0: 2c0a 2020 2020 2020 2020 2020 2020 7079  ,.            py
+0001fdf0: 636f 6d70 6174 2e62 7974 6573 7472 2866  compat.bytestr(f
+0001fe00: 6f75 7229 2c0a 2020 2020 2020 2020 2020  our),.          
+0001fe10: 2020 7079 636f 6d70 6174 2e62 7974 6573    pycompat.bytes
+0001fe20: 7472 2866 6976 6529 2c0a 2020 2020 2020  tr(five),.      
+0001fe30: 2020 290a 0a20 2020 2064 6566 2073 6176    )..    def sav
+0001fe40: 6563 6f6d 6d69 746d 6573 7361 6765 2873  ecommitmessage(s
+0001fe50: 656c 662c 2074 6578 7429 3a0a 2020 2020  elf, text):.    
+0001fe60: 2020 2020 6670 203d 2073 656c 662e 7666      fp = self.vf
+0001fe70: 7328 6227 6c61 7374 2d6d 6573 7361 6765  s(b'last-message
+0001fe80: 2e74 7874 272c 2062 2777 6227 290a 2020  .txt', b'wb').  
+0001fe90: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001fea0: 2020 2020 2020 2066 702e 7772 6974 6528         fp.write(
+0001feb0: 7465 7874 290a 2020 2020 2020 2020 6669  text).        fi
+0001fec0: 6e61 6c6c 793a 0a20 2020 2020 2020 2020  nally:.         
+0001fed0: 2020 2066 702e 636c 6f73 6528 290a 2020     fp.close().  
+0001fee0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0001fef0: 662e 7061 7468 746f 2866 702e 6e61 6d65  f.pathto(fp.name
+0001ff00: 5b6c 656e 2873 656c 662e 726f 6f74 2920  [len(self.root) 
+0001ff10: 2b20 3120 3a5d 290a 0a20 2020 2064 6566  + 1 :])..    def
+0001ff20: 2072 6567 6973 7465 725f 7761 6e74 6564   register_wanted
+0001ff30: 5f73 6964 6564 6174 6128 7365 6c66 2c20  _sidedata(self, 
+0001ff40: 6361 7465 676f 7279 293a 0a20 2020 2020  category):.     
+0001ff50: 2020 2069 6620 7265 706f 7369 746f 7279     if repository
+0001ff60: 2e52 4550 4f5f 4645 4154 5552 455f 5349  .REPO_FEATURE_SI
+0001ff70: 4445 5f44 4154 4120 6e6f 7420 696e 2073  DE_DATA not in s
+0001ff80: 656c 662e 6665 6174 7572 6573 3a0a 2020  elf.features:.  
+0001ff90: 2020 2020 2020 2020 2020 2320 4f6e 6c79            # Only
+0001ffa0: 2072 6576 6c6f 6776 3220 7265 706f 7320   revlogv2 repos 
+0001ffb0: 6361 6e20 7761 6e74 2073 6964 6564 6174  can want sidedat
+0001ffc0: 612e 0a20 2020 2020 2020 2020 2020 2072  a..            r
+0001ffd0: 6574 7572 6e0a 2020 2020 2020 2020 7365  eturn.        se
+0001ffe0: 6c66 2e5f 7761 6e74 6564 5f73 6964 6564  lf._wanted_sided
+0001fff0: 6174 612e 6164 6428 7079 636f 6d70 6174  ata.add(pycompat
+00020000: 2e62 7974 6573 7472 2863 6174 6567 6f72  .bytestr(categor
+00020010: 7929 290a 0a20 2020 2064 6566 2072 6567  y))..    def reg
+00020020: 6973 7465 725f 7369 6465 6461 7461 5f63  ister_sidedata_c
+00020030: 6f6d 7075 7465 7228 0a20 2020 2020 2020  omputer(.       
+00020040: 2073 656c 662c 206b 696e 642c 2063 6174   self, kind, cat
+00020050: 6567 6f72 792c 206b 6579 732c 2063 6f6d  egory, keys, com
+00020060: 7075 7465 722c 2066 6c61 6773 2c20 7265  puter, flags, re
+00020070: 706c 6163 653d 4661 6c73 650a 2020 2020  place=False.    
+00020080: 293a 0a20 2020 2020 2020 2069 6620 6b69  ):.        if ki
+00020090: 6e64 206e 6f74 2069 6e20 7265 766c 6f67  nd not in revlog
+000200a0: 636f 6e73 742e 414c 4c5f 4b49 4e44 533a  const.ALL_KINDS:
+000200b0: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
+000200c0: 203d 205f 2862 2275 6e65 7870 6563 7465   = _(b"unexpecte
+000200d0: 6420 7265 766c 6f67 206b 696e 6420 2725  d revlog kind '%
+000200e0: 7327 2e22 290a 2020 2020 2020 2020 2020  s'.").          
+000200f0: 2020 7261 6973 6520 6572 726f 722e 5072    raise error.Pr
+00020100: 6f67 7261 6d6d 696e 6745 7272 6f72 286d  ogrammingError(m
+00020110: 7367 2025 206b 696e 6429 0a20 2020 2020  sg % kind).     
+00020120: 2020 2063 6174 6567 6f72 7920 3d20 7079     category = py
+00020130: 636f 6d70 6174 2e62 7974 6573 7472 2863  compat.bytestr(c
+00020140: 6174 6567 6f72 7929 0a20 2020 2020 2020  ategory).       
+00020150: 2061 6c72 6561 6479 5f72 6567 6973 7465   already_registe
+00020160: 7265 6420 3d20 6361 7465 676f 7279 2069  red = category i
+00020170: 6e20 7365 6c66 2e5f 7369 6465 6461 7461  n self._sidedata
+00020180: 5f63 6f6d 7075 7465 7273 2e67 6574 286b  _computers.get(k
+00020190: 696e 642c 205b 5d29 0a20 2020 2020 2020  ind, []).       
+000201a0: 2069 6620 616c 7265 6164 795f 7265 6769   if already_regi
+000201b0: 7374 6572 6564 2061 6e64 206e 6f74 2072  stered and not r
+000201c0: 6570 6c61 6365 3a0a 2020 2020 2020 2020  eplace:.        
+000201d0: 2020 2020 6d73 6720 3d20 5f28 0a20 2020      msg = _(.   
+000201e0: 2020 2020 2020 2020 2020 2020 2062 2263               b"c
+000201f0: 616e 6e6f 7420 7265 6769 7374 6572 2061  annot register a
+00020200: 2073 6964 6564 6174 6120 636f 6d70 7574   sidedata comput
+00020210: 6572 2074 7769 6365 2066 6f72 2063 6174  er twice for cat
+00020220: 6567 6f72 7920 2725 7327 2e22 0a20 2020  egory '%s'.".   
+00020230: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00020240: 2020 2020 2020 2072 6169 7365 2065 7272         raise err
+00020250: 6f72 2e50 726f 6772 616d 6d69 6e67 4572  or.ProgrammingEr
+00020260: 726f 7228 6d73 6720 2520 6361 7465 676f  ror(msg % catego
+00020270: 7279 290a 2020 2020 2020 2020 6966 2072  ry).        if r
+00020280: 6570 6c61 6365 2061 6e64 206e 6f74 2061  eplace and not a
+00020290: 6c72 6561 6479 5f72 6567 6973 7465 7265  lready_registere
+000202a0: 643a 0a20 2020 2020 2020 2020 2020 206d  d:.            m
+000202b0: 7367 203d 205f 280a 2020 2020 2020 2020  sg = _(.        
+000202c0: 2020 2020 2020 2020 6222 6361 6e6e 6f74          b"cannot
+000202d0: 2072 6570 6c61 6365 2061 2073 6964 6564   replace a sided
+000202e0: 6174 6120 636f 6d70 7574 6572 2074 6861  ata computer tha
+000202f0: 7420 6973 6e27 7420 7265 6769 7374 6572  t isn't register
+00020300: 6564 2022 0a20 2020 2020 2020 2020 2020  ed ".           
+00020310: 2020 2020 2062 2266 6f72 2063 6174 6567       b"for categ
+00020320: 6f72 7920 2725 7327 2e22 0a20 2020 2020  ory '%s'.".     
+00020330: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00020340: 2020 2020 2072 6169 7365 2065 7272 6f72       raise error
+00020350: 2e50 726f 6772 616d 6d69 6e67 4572 726f  .ProgrammingErro
+00020360: 7228 6d73 6720 2520 6361 7465 676f 7279  r(msg % category
+00020370: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+00020380: 7369 6465 6461 7461 5f63 6f6d 7075 7465  sidedata_compute
+00020390: 7273 2e73 6574 6465 6661 756c 7428 6b69  rs.setdefault(ki
+000203a0: 6e64 2c20 7b7d 290a 2020 2020 2020 2020  nd, {}).        
+000203b0: 7365 6c66 2e5f 7369 6465 6461 7461 5f63  self._sidedata_c
+000203c0: 6f6d 7075 7465 7273 5b6b 696e 645d 5b63  omputers[kind][c
+000203d0: 6174 6567 6f72 795d 203d 2028 6b65 7973  ategory] = (keys
+000203e0: 2c20 636f 6d70 7574 6572 2c20 666c 6167  , computer, flag
+000203f0: 7329 0a0a 0a64 6566 2075 6e64 6f6e 616d  s)...def undonam
+00020400: 6528 666e 3a20 6279 7465 7329 202d 3e20  e(fn: bytes) -> 
+00020410: 6279 7465 733a 0a20 2020 2062 6173 652c  bytes:.    base,
+00020420: 206e 616d 6520 3d20 6f73 2e70 6174 682e   name = os.path.
+00020430: 7370 6c69 7428 666e 290a 2020 2020 6173  split(fn).    as
+00020440: 7365 7274 206e 616d 652e 7374 6172 7473  sert name.starts
+00020450: 7769 7468 2862 276a 6f75 726e 616c 2729  with(b'journal')
+00020460: 0a20 2020 2072 6574 7572 6e20 6f73 2e70  .    return os.p
+00020470: 6174 682e 6a6f 696e 2862 6173 652c 206e  ath.join(base, n
+00020480: 616d 652e 7265 706c 6163 6528 6227 6a6f  ame.replace(b'jo
+00020490: 7572 6e61 6c27 2c20 6227 756e 646f 272c  urnal', b'undo',
+000204a0: 2031 2929 0a0a 0a64 6566 2069 6e73 7461   1))...def insta
+000204b0: 6e63 6528 7569 2c20 7061 7468 3a20 6279  nce(ui, path: by
+000204c0: 7465 732c 2063 7265 6174 652c 2069 6e74  tes, create, int
+000204d0: 656e 7473 3d4e 6f6e 652c 2063 7265 6174  ents=None, creat
+000204e0: 656f 7074 733d 4e6f 6e65 293a 0a20 2020  eopts=None):.   
+000204f0: 2023 2070 7265 7665 6e74 2063 7963 6c69   # prevent cycli
+00020500: 6320 696d 706f 7274 206c 6f63 616c 7265  c import localre
+00020510: 706f 202d 3e20 7570 6772 6164 6520 2d3e  po -> upgrade ->
+00020520: 206c 6f63 616c 7265 706f 0a20 2020 2066   localrepo.    f
+00020530: 726f 6d20 2e20 696d 706f 7274 2075 7067  rom . import upg
+00020540: 7261 6465 0a0a 2020 2020 6c6f 6361 6c70  rade..    localp
+00020550: 6174 6820 3d20 7572 6c75 7469 6c2e 7572  ath = urlutil.ur
+00020560: 6c6c 6f63 616c 7061 7468 2870 6174 6829  llocalpath(path)
+00020570: 0a20 2020 2069 6620 6372 6561 7465 3a0a  .    if create:.
+00020580: 2020 2020 2020 2020 6372 6561 7465 7265          createre
+00020590: 706f 7369 746f 7279 2875 692c 206c 6f63  pository(ui, loc
+000205a0: 616c 7061 7468 2c20 6372 6561 7465 6f70  alpath, createop
+000205b0: 7473 3d63 7265 6174 656f 7074 7329 0a0a  ts=createopts)..
+000205c0: 2020 2020 6465 6620 7265 706f 5f6d 616b      def repo_mak
+000205d0: 6572 2829 3a0a 2020 2020 2020 2020 7265  er():.        re
+000205e0: 7475 726e 206d 616b 656c 6f63 616c 7265  turn makelocalre
+000205f0: 706f 7369 746f 7279 2875 692c 206c 6f63  pository(ui, loc
+00020600: 616c 7061 7468 2c20 696e 7465 6e74 733d  alpath, intents=
+00020610: 696e 7465 6e74 7329 0a0a 2020 2020 7265  intents)..    re
+00020620: 706f 203d 2072 6570 6f5f 6d61 6b65 7228  po = repo_maker(
+00020630: 290a 2020 2020 7265 706f 203d 2075 7067  ).    repo = upg
+00020640: 7261 6465 2e6d 6179 5f61 7574 6f5f 7570  rade.may_auto_up
+00020650: 6772 6164 6528 7265 706f 2c20 7265 706f  grade(repo, repo
+00020660: 5f6d 616b 6572 290a 2020 2020 7265 7475  _maker).    retu
+00020670: 726e 2072 6570 6f0a 0a0a 6465 6620 6973  rn repo...def is
+00020680: 6c6f 6361 6c28 7061 7468 3a20 6279 7465  local(path: byte
+00020690: 7329 202d 3e20 626f 6f6c 3a0a 2020 2020  s) -> bool:.    
+000206a0: 7265 7475 726e 2054 7275 650a 0a0a 6465  return True...de
+000206b0: 6620 6465 6661 756c 7463 7265 6174 656f  f defaultcreateo
+000206c0: 7074 7328 7569 2c20 6372 6561 7465 6f70  pts(ui, createop
+000206d0: 7473 3d4e 6f6e 6529 3a0a 2020 2020 2222  ts=None):.    ""
+000206e0: 2250 6f70 756c 6174 6520 7468 6520 6465  "Populate the de
+000206f0: 6661 756c 7420 6372 6561 7469 6f6e 206f  fault creation o
+00020700: 7074 696f 6e73 2066 6f72 2061 2072 6570  ptions for a rep
+00020710: 6f73 6974 6f72 792e 0a0a 2020 2020 4120  ository...    A 
+00020720: 6469 6374 696f 6e61 7279 206f 6620 6578  dictionary of ex
+00020730: 706c 6963 6974 6c79 2072 6571 7565 7374  plicitly request
+00020740: 6564 2063 7265 6174 696f 6e20 6f70 7469  ed creation opti
+00020750: 6f6e 7320 6361 6e20 6265 2070 6173 7365  ons can be passe
+00020760: 640a 2020 2020 696e 2e20 4d69 7373 696e  d.    in. Missin
+00020770: 6720 6b65 7973 2077 696c 6c20 6265 2070  g keys will be p
+00020780: 6f70 756c 6174 6564 2e0a 2020 2020 2222  opulated..    ""
+00020790: 220a 2020 2020 6372 6561 7465 6f70 7473  ".    createopts
+000207a0: 203d 2064 6963 7428 6372 6561 7465 6f70   = dict(createop
+000207b0: 7473 206f 7220 7b7d 290a 0a20 2020 2069  ts or {})..    i
+000207c0: 6620 6227 6261 636b 656e 6427 206e 6f74  f b'backend' not
+000207d0: 2069 6e20 6372 6561 7465 6f70 7473 3a0a   in createopts:.
+000207e0: 2020 2020 2020 2020 2320 6578 7065 7269          # experi
+000207f0: 6d65 6e74 616c 2063 6f6e 6669 673a 2073  mental config: s
+00020800: 746f 7261 6765 2e6e 6577 2d72 6570 6f2d  torage.new-repo-
+00020810: 6261 636b 656e 640a 2020 2020 2020 2020  backend.        
+00020820: 6372 6561 7465 6f70 7473 5b62 2762 6163  createopts[b'bac
+00020830: 6b65 6e64 275d 203d 2075 692e 636f 6e66  kend'] = ui.conf
+00020840: 6967 2862 2773 746f 7261 6765 272c 2062  ig(b'storage', b
+00020850: 276e 6577 2d72 6570 6f2d 6261 636b 656e  'new-repo-backen
+00020860: 6427 290a 0a20 2020 2072 6574 7572 6e20  d')..    return 
+00020870: 6372 6561 7465 6f70 7473 0a0a 0a64 6566  createopts...def
+00020880: 2063 6c6f 6e65 5f72 6571 7569 7265 6d65   clone_requireme
+00020890: 6e74 7328 7569 2c20 6372 6561 7465 6f70  nts(ui, createop
+000208a0: 7473 2c20 7372 6372 6570 6f29 3a0a 2020  ts, srcrepo):.  
+000208b0: 2020 2222 2263 6c6f 6e65 2074 6865 2072    """clone the r
+000208c0: 6571 7569 7265 6d65 6e74 7320 6f66 2061  equirements of a
+000208d0: 206c 6f63 616c 2072 6570 6f20 666f 7220   local repo for 
+000208e0: 6120 6c6f 6361 6c20 636c 6f6e 650a 0a20  a local clone.. 
+000208f0: 2020 2054 6865 2073 746f 7265 2072 6571     The store req
+00020900: 7569 7265 6d65 6e74 7320 6172 6520 756e  uirements are un
+00020910: 6368 616e 6765 6420 7768 696c 6520 7468  changed while th
+00020920: 6520 776f 726b 696e 6720 636f 7079 2072  e working copy r
+00020930: 6571 7569 7265 6d65 6e74 730a 2020 2020  equirements.    
+00020940: 6465 7065 6e64 7320 6f6e 2074 6865 2063  depends on the c
+00020950: 6f6e 6669 6775 7261 7469 6f6e 0a20 2020  onfiguration.   
+00020960: 2022 2222 0a20 2020 2074 6172 6765 745f   """.    target_
+00020970: 7265 7175 6972 656d 656e 7473 203d 2073  requirements = s
+00020980: 6574 2829 0a20 2020 2069 6620 6e6f 7420  et().    if not 
+00020990: 7372 6372 6570 6f2e 7265 7175 6972 656d  srcrepo.requirem
+000209a0: 656e 7473 3a0a 2020 2020 2020 2020 2320  ents:.        # 
+000209b0: 7468 6973 2069 7320 6120 6c65 6761 6379  this is a legacy
+000209c0: 2072 6576 6c6f 6720 2276 3022 2072 6570   revlog "v0" rep
+000209d0: 6f73 6974 6f72 792c 2077 6520 6361 6e6e  ository, we cann
+000209e0: 6f74 2064 6f20 616e 7974 6869 6e67 2066  ot do anything f
+000209f0: 616e 6379 0a20 2020 2020 2020 2023 2077  ancy.        # w
+00020a00: 6974 6820 6974 2e0a 2020 2020 2020 2020  ith it..        
+00020a10: 7265 7475 726e 2074 6172 6765 745f 7265  return target_re
+00020a20: 7175 6972 656d 656e 7473 0a20 2020 2063  quirements.    c
+00020a30: 7265 6174 656f 7074 7320 3d20 6465 6661  reateopts = defa
+00020a40: 756c 7463 7265 6174 656f 7074 7328 7569  ultcreateopts(ui
+00020a50: 2c20 6372 6561 7465 6f70 7473 3d63 7265  , createopts=cre
+00020a60: 6174 656f 7074 7329 0a20 2020 2066 6f72  ateopts).    for
+00020a70: 2072 2069 6e20 6e65 7772 6570 6f72 6571   r in newreporeq
+00020a80: 7569 7265 6d65 6e74 7328 7569 2c20 6372  uirements(ui, cr
+00020a90: 6561 7465 6f70 7473 293a 0a20 2020 2020  eateopts):.     
+00020aa0: 2020 2069 6620 7220 696e 2072 6571 7569     if r in requi
+00020ab0: 7265 6d65 6e74 736d 6f64 2e57 4f52 4b49  rementsmod.WORKI
+00020ac0: 4e47 5f44 4952 5f52 4551 5549 5245 4d45  NG_DIR_REQUIREME
+00020ad0: 4e54 533a 0a20 2020 2020 2020 2020 2020  NTS:.           
+00020ae0: 2074 6172 6765 745f 7265 7175 6972 656d   target_requirem
+00020af0: 656e 7473 2e61 6464 2872 290a 0a20 2020  ents.add(r)..   
+00020b00: 2066 6f72 2072 2069 6e20 7372 6372 6570   for r in srcrep
+00020b10: 6f2e 7265 7175 6972 656d 656e 7473 3a0a  o.requirements:.
+00020b20: 2020 2020 2020 2020 6966 2072 206e 6f74          if r not
+00020b30: 2069 6e20 7265 7175 6972 656d 656e 7473   in requirements
+00020b40: 6d6f 642e 574f 524b 494e 475f 4449 525f  mod.WORKING_DIR_
+00020b50: 5245 5155 4952 454d 454e 5453 3a0a 2020  REQUIREMENTS:.  
+00020b60: 2020 2020 2020 2020 2020 7461 7267 6574            target
+00020b70: 5f72 6571 7569 7265 6d65 6e74 732e 6164  _requirements.ad
+00020b80: 6428 7229 0a20 2020 2072 6574 7572 6e20  d(r).    return 
+00020b90: 7461 7267 6574 5f72 6571 7569 7265 6d65  target_requireme
+00020ba0: 6e74 730a 0a0a 6465 6620 6e65 7772 6570  nts...def newrep
+00020bb0: 6f72 6571 7569 7265 6d65 6e74 7328 7569  orequirements(ui
+00020bc0: 2c20 6372 6561 7465 6f70 7473 293a 0a20  , createopts):. 
+00020bd0: 2020 2022 2222 4465 7465 726d 696e 6520     """Determine 
+00020be0: 7468 6520 7365 7420 6f66 2072 6571 7569  the set of requi
+00020bf0: 7265 6d65 6e74 7320 666f 7220 6120 6e65  rements for a ne
+00020c00: 7720 6c6f 6361 6c20 7265 706f 7369 746f  w local reposito
+00020c10: 7279 2e0a 0a20 2020 2045 7874 656e 7369  ry...    Extensi
+00020c20: 6f6e 7320 6361 6e20 7772 6170 2074 6869  ons can wrap thi
+00020c30: 7320 6675 6e63 7469 6f6e 2074 6f20 7370  s function to sp
+00020c40: 6563 6966 7920 6375 7374 6f6d 2072 6571  ecify custom req
+00020c50: 7569 7265 6d65 6e74 7320 666f 720a 2020  uirements for.  
+00020c60: 2020 6e65 7720 7265 706f 7369 746f 7269    new repositori
+00020c70: 6573 2e0a 2020 2020 2222 220a 0a20 2020  es..    """..   
+00020c80: 2069 6620 6227 6261 636b 656e 6427 206e   if b'backend' n
+00020c90: 6f74 2069 6e20 6372 6561 7465 6f70 7473  ot in createopts
+00020ca0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+00020cb0: 6572 726f 722e 5072 6f67 7261 6d6d 696e  error.Programmin
+00020cc0: 6745 7272 6f72 280a 2020 2020 2020 2020  gError(.        
+00020cd0: 2020 2020 6227 6261 636b 656e 6420 6b65      b'backend ke
+00020ce0: 7920 6e6f 7420 7072 6573 656e 7420 696e  y not present in
+00020cf0: 2063 7265 6174 656f 7074 733b 2027 0a20   createopts; '. 
+00020d00: 2020 2020 2020 2020 2020 2062 2777 6173             b'was
+00020d10: 2064 6566 6175 6c74 6372 6561 7465 6f70   defaultcreateop
+00020d20: 7473 2829 2063 616c 6c65 643f 270a 2020  ts() called?'.  
+00020d30: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
+00020d40: 6372 6561 7465 6f70 7473 5b62 2762 6163  createopts[b'bac
+00020d50: 6b65 6e64 275d 2021 3d20 6227 7265 766c  kend'] != b'revl
+00020d60: 6f67 7631 273a 0a20 2020 2020 2020 2072  ogv1':.        r
+00020d70: 6169 7365 2065 7272 6f72 2e41 626f 7274  aise error.Abort
+00020d80: 280a 2020 2020 2020 2020 2020 2020 5f28  (.            _(
+00020d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020da0: 2062 2775 6e61 626c 6520 746f 2064 6574   b'unable to det
+00020db0: 6572 6d69 6e65 2072 6570 6f73 6974 6f72  ermine repositor
+00020dc0: 7920 7265 7175 6972 656d 656e 7473 2066  y requirements f
+00020dd0: 6f72 2027 0a20 2020 2020 2020 2020 2020  or '.           
+00020de0: 2020 2020 2062 2773 746f 7261 6765 2062       b'storage b
+00020df0: 6163 6b65 6e64 3a20 2573 270a 2020 2020  ackend: %s'.    
+00020e00: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00020e10: 2020 2020 2020 2520 6372 6561 7465 6f70        % createop
+00020e20: 7473 5b62 2762 6163 6b65 6e64 275d 0a20  ts[b'backend']. 
+00020e30: 2020 2020 2020 2029 0a0a 2020 2020 7265         )..    re
+00020e40: 7175 6972 656d 656e 7473 203d 207b 7265  quirements = {re
+00020e50: 7175 6972 656d 656e 7473 6d6f 642e 5245  quirementsmod.RE
+00020e60: 564c 4f47 5631 5f52 4551 5549 5245 4d45  VLOGV1_REQUIREME
+00020e70: 4e54 7d0a 2020 2020 6966 2075 692e 636f  NT}.    if ui.co
+00020e80: 6e66 6967 626f 6f6c 2862 2766 6f72 6d61  nfigbool(b'forma
+00020e90: 7427 2c20 6227 7573 6573 746f 7265 2729  t', b'usestore')
+00020ea0: 3a0a 2020 2020 2020 2020 7265 7175 6972  :.        requir
+00020eb0: 656d 656e 7473 2e61 6464 2872 6571 7569  ements.add(requi
+00020ec0: 7265 6d65 6e74 736d 6f64 2e53 544f 5245  rementsmod.STORE
+00020ed0: 5f52 4551 5549 5245 4d45 4e54 290a 2020  _REQUIREMENT).  
+00020ee0: 2020 2020 2020 6966 2075 692e 636f 6e66        if ui.conf
+00020ef0: 6967 626f 6f6c 2862 2766 6f72 6d61 7427  igbool(b'format'
+00020f00: 2c20 6227 7573 6566 6e63 6163 6865 2729  , b'usefncache')
+00020f10: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00020f20: 7175 6972 656d 656e 7473 2e61 6464 2872  quirements.add(r
+00020f30: 6571 7569 7265 6d65 6e74 736d 6f64 2e46  equirementsmod.F
+00020f40: 4e43 4143 4845 5f52 4551 5549 5245 4d45  NCACHE_REQUIREME
+00020f50: 4e54 290a 2020 2020 2020 2020 2020 2020  NT).            
+00020f60: 6966 2075 692e 636f 6e66 6967 626f 6f6c  if ui.configbool
+00020f70: 2862 2766 6f72 6d61 7427 2c20 6227 646f  (b'format', b'do
+00020f80: 7465 6e63 6f64 6527 293a 0a20 2020 2020  tencode'):.     
+00020f90: 2020 2020 2020 2020 2020 2072 6571 7569             requi
+00020fa0: 7265 6d65 6e74 732e 6164 6428 7265 7175  rements.add(requ
+00020fb0: 6972 656d 656e 7473 6d6f 642e 444f 5445  irementsmod.DOTE
+00020fc0: 4e43 4f44 455f 5245 5155 4952 454d 454e  NCODE_REQUIREMEN
+00020fd0: 5429 0a0a 2020 2020 636f 6d70 656e 6769  T)..    compengi
+00020fe0: 6e65 7320 3d20 7569 2e63 6f6e 6669 676c  nes = ui.configl
+00020ff0: 6973 7428 6227 666f 726d 6174 272c 2062  ist(b'format', b
+00021000: 2772 6576 6c6f 672d 636f 6d70 7265 7373  'revlog-compress
+00021010: 696f 6e27 290a 2020 2020 666f 7220 636f  ion').    for co
+00021020: 6d70 656e 6769 6e65 2069 6e20 636f 6d70  mpengine in comp
+00021030: 656e 6769 6e65 733a 0a20 2020 2020 2020  engines:.       
+00021040: 2069 6620 636f 6d70 656e 6769 6e65 2069   if compengine i
+00021050: 6e20 7574 696c 2e63 6f6d 7065 6e67 696e  n util.compengin
+00021060: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00021070: 656e 6769 6e65 203d 2075 7469 6c2e 636f  engine = util.co
+00021080: 6d70 656e 6769 6e65 735b 636f 6d70 656e  mpengines[compen
+00021090: 6769 6e65 5d0a 2020 2020 2020 2020 2020  gine].          
+000210a0: 2020 6966 2065 6e67 696e 652e 6176 6169    if engine.avai
+000210b0: 6c61 626c 6528 2920 616e 6420 656e 6769  lable() and engi
+000210c0: 6e65 2e72 6576 6c6f 6768 6561 6465 7228  ne.revlogheader(
+000210d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000210e0: 2020 2062 7265 616b 0a20 2020 2065 6c73     break.    els
+000210f0: 653a 0a20 2020 2020 2020 2072 6169 7365  e:.        raise
+00021100: 2065 7272 6f72 2e41 626f 7274 280a 2020   error.Abort(.  
+00021110: 2020 2020 2020 2020 2020 5f28 0a20 2020            _(.   
+00021120: 2020 2020 2020 2020 2020 2020 2062 2763               b'c
+00021130: 6f6d 7072 6573 7369 6f6e 2065 6e67 696e  ompression engin
+00021140: 6573 2025 7320 6465 6669 6e65 6420 6279  es %s defined by
+00021150: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+00021160: 2020 2062 2766 6f72 6d61 742e 7265 766c     b'format.revl
+00021170: 6f67 2d63 6f6d 7072 6573 7369 6f6e 206e  og-compression n
+00021180: 6f74 2061 7661 696c 6162 6c65 270a 2020  ot available'.  
+00021190: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000211a0: 2020 2020 2020 2020 2520 6227 2c20 272e          % b', '.
+000211b0: 6a6f 696e 2862 2722 2573 2227 2025 2065  join(b'"%s"' % e
+000211c0: 2066 6f72 2065 2069 6e20 636f 6d70 656e   for e in compen
+000211d0: 6769 6e65 7329 2c0a 2020 2020 2020 2020  gines),.        
+000211e0: 2020 2020 6869 6e74 3d5f 280a 2020 2020      hint=_(.    
+000211f0: 2020 2020 2020 2020 2020 2020 6227 7275              b'ru
+00021200: 6e20 2268 6720 6465 6275 6769 6e73 7461  n "hg debuginsta
+00021210: 6c6c 2220 746f 206c 6973 7420 6176 6169  ll" to list avai
+00021220: 6c61 626c 6520 270a 2020 2020 2020 2020  lable '.        
+00021230: 2020 2020 2020 2020 6227 636f 6d70 7265          b'compre
+00021240: 7373 696f 6e20 656e 6769 6e65 7327 0a20  ssion engines'. 
+00021250: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+00021260: 2020 2020 2020 290a 0a20 2020 2023 207a        )..    # z
+00021270: 6c69 6220 6973 2074 6865 2068 6973 746f  lib is the histo
+00021280: 7269 6361 6c20 6465 6661 756c 7420 616e  rical default an
+00021290: 6420 646f 6573 6e27 7420 6e65 6564 2061  d doesn't need a
+000212a0: 6e20 6578 706c 6963 6974 2072 6571 7569  n explicit requi
+000212b0: 7265 6d65 6e74 2e0a 2020 2020 6966 2063  rement..    if c
+000212c0: 6f6d 7065 6e67 696e 6520 3d3d 2062 277a  ompengine == b'z
+000212d0: 7374 6427 3a0a 2020 2020 2020 2020 7265  std':.        re
+000212e0: 7175 6972 656d 656e 7473 2e61 6464 2862  quirements.add(b
+000212f0: 2772 6576 6c6f 672d 636f 6d70 7265 7373  'revlog-compress
+00021300: 696f 6e2d 7a73 7464 2729 0a20 2020 2065  ion-zstd').    e
+00021310: 6c69 6620 636f 6d70 656e 6769 6e65 2021  lif compengine !
+00021320: 3d20 6227 7a6c 6962 273a 0a20 2020 2020  = b'zlib':.     
+00021330: 2020 2072 6571 7569 7265 6d65 6e74 732e     requirements.
+00021340: 6164 6428 6227 6578 702d 636f 6d70 7265  add(b'exp-compre
+00021350: 7373 696f 6e2d 2573 2720 2520 636f 6d70  ssion-%s' % comp
+00021360: 656e 6769 6e65 290a 0a20 2020 2069 6620  engine)..    if 
+00021370: 7363 6d75 7469 6c2e 6764 696e 6974 636f  scmutil.gdinitco
+00021380: 6e66 6967 2875 6929 3a0a 2020 2020 2020  nfig(ui):.      
+00021390: 2020 7265 7175 6972 656d 656e 7473 2e61    requirements.a
+000213a0: 6464 2872 6571 7569 7265 6d65 6e74 736d  dd(requirementsm
+000213b0: 6f64 2e47 454e 4552 414c 4445 4c54 415f  od.GENERALDELTA_
+000213c0: 5245 5155 4952 454d 454e 5429 0a20 2020  REQUIREMENT).   
+000213d0: 2020 2020 2069 6620 7569 2e63 6f6e 6669       if ui.confi
+000213e0: 6762 6f6f 6c28 6227 666f 726d 6174 272c  gbool(b'format',
+000213f0: 2062 2773 7061 7273 652d 7265 766c 6f67   b'sparse-revlog
+00021400: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+00021410: 7265 7175 6972 656d 656e 7473 2e61 6464  requirements.add
+00021420: 2872 6571 7569 7265 6d65 6e74 736d 6f64  (requirementsmod
+00021430: 2e53 5041 5253 4552 4556 4c4f 475f 5245  .SPARSEREVLOG_RE
+00021440: 5155 4952 454d 454e 5429 0a0a 2020 2020  QUIREMENT)..    
+00021450: 2320 6578 7065 7269 6d65 6e74 616c 2063  # experimental c
+00021460: 6f6e 6669 673a 2066 6f72 6d61 742e 7573  onfig: format.us
+00021470: 652d 6469 7273 7461 7465 2d76 320a 2020  e-dirstate-v2.  
+00021480: 2020 2320 4b65 6570 2074 6869 7320 6c6f    # Keep this lo
+00021490: 6769 6320 696e 2073 796e 6320 7769 7468  gic in sync with
+000214a0: 2060 6861 735f 6469 7273 7461 7465 5f76   `has_dirstate_v
+000214b0: 3228 2960 2069 6e20 6074 6573 7473 2f68  2()` in `tests/h
+000214c0: 6768 6176 652e 7079 600a 2020 2020 6966  ghave.py`.    if
+000214d0: 2075 692e 636f 6e66 6967 626f 6f6c 2862   ui.configbool(b
+000214e0: 2766 6f72 6d61 7427 2c20 6227 7573 652d  'format', b'use-
+000214f0: 6469 7273 7461 7465 2d76 3227 293a 0a20  dirstate-v2'):. 
+00021500: 2020 2020 2020 2072 6571 7569 7265 6d65         requireme
+00021510: 6e74 732e 6164 6428 7265 7175 6972 656d  nts.add(requirem
+00021520: 656e 7473 6d6f 642e 4449 5253 5441 5445  entsmod.DIRSTATE
+00021530: 5f56 325f 5245 5155 4952 454d 454e 5429  _V2_REQUIREMENT)
+00021540: 0a0a 2020 2020 2320 6578 7065 7269 6d65  ..    # experime
+00021550: 6e74 616c 2063 6f6e 6669 673a 2066 6f72  ntal config: for
+00021560: 6d61 742e 6578 702d 7573 652d 636f 7069  mat.exp-use-copi
+00021570: 6573 2d73 6964 652d 6461 7461 2d63 6861  es-side-data-cha
+00021580: 6e67 6573 6574 0a20 2020 2069 6620 7569  ngeset.    if ui
+00021590: 2e63 6f6e 6669 6762 6f6f 6c28 6227 666f  .configbool(b'fo
+000215a0: 726d 6174 272c 2062 2765 7870 2d75 7365  rmat', b'exp-use
+000215b0: 2d63 6f70 6965 732d 7369 6465 2d64 6174  -copies-side-dat
+000215c0: 612d 6368 616e 6765 7365 7427 293a 0a20  a-changeset'):. 
+000215d0: 2020 2020 2020 2072 6571 7569 7265 6d65         requireme
+000215e0: 6e74 732e 6164 6428 7265 7175 6972 656d  nts.add(requirem
+000215f0: 656e 7473 6d6f 642e 4348 414e 4745 4c4f  entsmod.CHANGELO
+00021600: 4756 325f 5245 5155 4952 454d 454e 5429  GV2_REQUIREMENT)
+00021610: 0a20 2020 2020 2020 2072 6571 7569 7265  .        require
+00021620: 6d65 6e74 732e 6164 6428 7265 7175 6972  ments.add(requir
+00021630: 656d 656e 7473 6d6f 642e 434f 5049 4553  ementsmod.COPIES
+00021640: 5344 435f 5245 5155 4952 454d 454e 5429  SDC_REQUIREMENT)
+00021650: 0a20 2020 2069 6620 7569 2e63 6f6e 6669  .    if ui.confi
+00021660: 6762 6f6f 6c28 6227 6578 7065 7269 6d65  gbool(b'experime
+00021670: 6e74 616c 272c 2062 2774 7265 656d 616e  ntal', b'treeman
+00021680: 6966 6573 7427 293a 0a20 2020 2020 2020  ifest'):.       
+00021690: 2072 6571 7569 7265 6d65 6e74 732e 6164   requirements.ad
+000216a0: 6428 7265 7175 6972 656d 656e 7473 6d6f  d(requirementsmo
+000216b0: 642e 5452 4545 4d41 4e49 4645 5354 5f52  d.TREEMANIFEST_R
+000216c0: 4551 5549 5245 4d45 4e54 290a 0a20 2020  EQUIREMENT)..   
+000216d0: 2063 6861 6e67 656c 6f67 7632 203d 2075   changelogv2 = u
+000216e0: 692e 636f 6e66 6967 2862 2766 6f72 6d61  i.config(b'forma
+000216f0: 7427 2c20 6227 6578 702d 7573 652d 6368  t', b'exp-use-ch
+00021700: 616e 6765 6c6f 672d 7632 2729 0a20 2020  angelog-v2').   
+00021710: 2069 6620 6368 616e 6765 6c6f 6776 3220   if changelogv2 
+00021720: 3d3d 2062 2765 6e61 626c 652d 756e 7374  == b'enable-unst
+00021730: 6162 6c65 2d66 6f72 6d61 742d 616e 642d  able-format-and-
+00021740: 636f 7272 7570 742d 6d79 2d64 6174 6127  corrupt-my-data'
+00021750: 3a0a 2020 2020 2020 2020 7265 7175 6972  :.        requir
+00021760: 656d 656e 7473 2e61 6464 2872 6571 7569  ements.add(requi
+00021770: 7265 6d65 6e74 736d 6f64 2e43 4841 4e47  rementsmod.CHANG
+00021780: 454c 4f47 5632 5f52 4551 5549 5245 4d45  ELOGV2_REQUIREME
+00021790: 4e54 290a 0a20 2020 2072 6576 6c6f 6776  NT)..    revlogv
+000217a0: 3220 3d20 7569 2e63 6f6e 6669 6728 6227  2 = ui.config(b'
+000217b0: 6578 7065 7269 6d65 6e74 616c 272c 2062  experimental', b
+000217c0: 2772 6576 6c6f 6776 3227 290a 2020 2020  'revlogv2').    
+000217d0: 6966 2072 6576 6c6f 6776 3220 3d3d 2062  if revlogv2 == b
+000217e0: 2765 6e61 626c 652d 756e 7374 6162 6c65  'enable-unstable
+000217f0: 2d66 6f72 6d61 742d 616e 642d 636f 7272  -format-and-corr
+00021800: 7570 742d 6d79 2d64 6174 6127 3a0a 2020  upt-my-data':.  
+00021810: 2020 2020 2020 7265 7175 6972 656d 656e        requiremen
+00021820: 7473 2e64 6973 6361 7264 2872 6571 7569  ts.discard(requi
+00021830: 7265 6d65 6e74 736d 6f64 2e52 4556 4c4f  rementsmod.REVLO
+00021840: 4756 315f 5245 5155 4952 454d 454e 5429  GV1_REQUIREMENT)
+00021850: 0a20 2020 2020 2020 2072 6571 7569 7265  .        require
+00021860: 6d65 6e74 732e 6164 6428 7265 7175 6972  ments.add(requir
+00021870: 656d 656e 7473 6d6f 642e 5245 564c 4f47  ementsmod.REVLOG
+00021880: 5632 5f52 4551 5549 5245 4d45 4e54 290a  V2_REQUIREMENT).
+00021890: 2020 2020 2320 6578 7065 7269 6d65 6e74      # experiment
+000218a0: 616c 2063 6f6e 6669 673a 2066 6f72 6d61  al config: forma
+000218b0: 742e 696e 7465 726e 616c 2d70 6861 7365  t.internal-phase
+000218c0: 0a20 2020 2069 6620 7569 2e63 6f6e 6669  .    if ui.confi
+000218d0: 6762 6f6f 6c28 6227 666f 726d 6174 272c  gbool(b'format',
+000218e0: 2062 2775 7365 2d69 6e74 6572 6e61 6c2d   b'use-internal-
+000218f0: 7068 6173 6527 293a 0a20 2020 2020 2020  phase'):.       
+00021900: 2072 6571 7569 7265 6d65 6e74 732e 6164   requirements.ad
+00021910: 6428 7265 7175 6972 656d 656e 7473 6d6f  d(requirementsmo
+00021920: 642e 494e 5445 524e 414c 5f50 4841 5345  d.INTERNAL_PHASE
+00021930: 5f52 4551 5549 5245 4d45 4e54 290a 0a20  _REQUIREMENT).. 
+00021940: 2020 2023 2065 7870 6572 696d 656e 7461     # experimenta
+00021950: 6c20 636f 6e66 6967 3a20 666f 726d 6174  l config: format
+00021960: 2e65 7870 2d61 7263 6869 7665 642d 7068  .exp-archived-ph
+00021970: 6173 650a 2020 2020 6966 2075 692e 636f  ase.    if ui.co
+00021980: 6e66 6967 626f 6f6c 2862 2766 6f72 6d61  nfigbool(b'forma
+00021990: 7427 2c20 6227 6578 702d 6172 6368 6976  t', b'exp-archiv
+000219a0: 6564 2d70 6861 7365 2729 3a0a 2020 2020  ed-phase'):.    
+000219b0: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
+000219c0: 2e61 6464 2872 6571 7569 7265 6d65 6e74  .add(requirement
+000219d0: 736d 6f64 2e41 5243 4849 5645 445f 5048  smod.ARCHIVED_PH
+000219e0: 4153 455f 5245 5155 4952 454d 454e 5429  ASE_REQUIREMENT)
+000219f0: 0a0a 2020 2020 6966 2063 7265 6174 656f  ..    if createo
+00021a00: 7074 732e 6765 7428 6227 6e61 7272 6f77  pts.get(b'narrow
+00021a10: 6669 6c65 7327 293a 0a20 2020 2020 2020  files'):.       
+00021a20: 2072 6571 7569 7265 6d65 6e74 732e 6164   requirements.ad
+00021a30: 6428 7265 7175 6972 656d 656e 7473 6d6f  d(requirementsmo
+00021a40: 642e 4e41 5252 4f57 5f52 4551 5549 5245  d.NARROW_REQUIRE
+00021a50: 4d45 4e54 290a 0a20 2020 2069 6620 6372  MENT)..    if cr
+00021a60: 6561 7465 6f70 7473 2e67 6574 2862 276c  eateopts.get(b'l
+00021a70: 6673 2729 3a0a 2020 2020 2020 2020 7265  fs'):.        re
+00021a80: 7175 6972 656d 656e 7473 2e61 6464 2862  quirements.add(b
+00021a90: 276c 6673 2729 0a0a 2020 2020 6966 2075  'lfs')..    if u
+00021aa0: 692e 636f 6e66 6967 626f 6f6c 2862 2766  i.configbool(b'f
+00021ab0: 6f72 6d61 7427 2c20 6227 626f 6f6b 6d61  ormat', b'bookma
+00021ac0: 726b 732d 696e 2d73 746f 7265 2729 3a0a  rks-in-store'):.
+00021ad0: 2020 2020 2020 2020 7265 7175 6972 656d          requirem
+00021ae0: 656e 7473 2e61 6464 2872 6571 7569 7265  ents.add(require
+00021af0: 6d65 6e74 736d 6f64 2e42 4f4f 4b4d 4152  mentsmod.BOOKMAR
+00021b00: 4b53 5f49 4e5f 5354 4f52 455f 5245 5155  KS_IN_STORE_REQU
+00021b10: 4952 454d 454e 5429 0a0a 2020 2020 6966  IREMENT)..    if
+00021b20: 2075 692e 636f 6e66 6967 626f 6f6c 2862   ui.configbool(b
+00021b30: 2766 6f72 6d61 7427 2c20 6227 7573 652d  'format', b'use-
+00021b40: 7065 7273 6973 7465 6e74 2d6e 6f64 656d  persistent-nodem
+00021b50: 6170 2729 3a0a 2020 2020 2020 2020 7265  ap'):.        re
+00021b60: 7175 6972 656d 656e 7473 2e61 6464 2872  quirements.add(r
+00021b70: 6571 7569 7265 6d65 6e74 736d 6f64 2e4e  equirementsmod.N
+00021b80: 4f44 454d 4150 5f52 4551 5549 5245 4d45  ODEMAP_REQUIREME
+00021b90: 4e54 290a 0a20 2020 2023 2069 6620 7368  NT)..    # if sh
+00021ba0: 6172 652d 7361 6665 2069 7320 656e 6162  are-safe is enab
+00021bb0: 6c65 642c 206c 6574 2773 2063 7265 6174  led, let's creat
+00021bc0: 6520 7468 6520 6e65 7720 7265 706f 7369  e the new reposi
+00021bd0: 746f 7279 2077 6974 6820 7468 6520 6e65  tory with the ne
+00021be0: 770a 2020 2020 2320 7265 7175 6972 656d  w.    # requirem
+00021bf0: 656e 740a 2020 2020 6966 2075 692e 636f  ent.    if ui.co
+00021c00: 6e66 6967 626f 6f6c 2862 2766 6f72 6d61  nfigbool(b'forma
+00021c10: 7427 2c20 6227 7573 652d 7368 6172 652d  t', b'use-share-
+00021c20: 7361 6665 2729 3a0a 2020 2020 2020 2020  safe'):.        
+00021c30: 7265 7175 6972 656d 656e 7473 2e61 6464  requirements.add
+00021c40: 2872 6571 7569 7265 6d65 6e74 736d 6f64  (requirementsmod
+00021c50: 2e53 4841 5245 5341 4645 5f52 4551 5549  .SHARESAFE_REQUI
+00021c60: 5245 4d45 4e54 290a 0a20 2020 2023 2069  REMENT)..    # i
+00021c70: 6620 7765 2061 7265 2063 7265 6174 696e  f we are creatin
+00021c80: 6720 6120 7368 6172 652d 7265 706f c2b9  g a share-repo..
+00021c90: 2020 7765 2068 6176 6520 746f 2068 616e    we have to han
+00021ca0: 646c 6520 7265 7175 6972 656d 656e 740a  dle requirement.
+00021cb0: 2020 2020 2320 6469 6666 6572 656e 746c      # differentl
+00021cc0: 792e 0a20 2020 2023 0a20 2020 2023 205b  y..    #.    # [
+00021cd0: 315d 2028 692e 652e 2072 6575 7369 6e67  1] (i.e. reusing
+00021ce0: 2074 6865 2073 746f 7265 2066 726f 6d20   the store from 
+00021cf0: 616e 6f74 6865 7220 7265 706f 7369 746f  another reposito
+00021d00: 7279 2c20 6a75 7374 2068 6176 696e 6720  ry, just having 
+00021d10: 610a 2020 2020 2320 776f 726b 696e 6720  a.    # working 
+00021d20: 636f 7079 290a 2020 2020 6966 2062 2773  copy).    if b's
+00021d30: 6861 7265 6472 6570 6f27 2069 6e20 6372  haredrepo' in cr
+00021d40: 6561 7465 6f70 7473 3a0a 2020 2020 2020  eateopts:.      
+00021d50: 2020 736f 7572 6365 5f72 6571 7569 7265    source_require
+00021d60: 6d65 6e74 7320 3d20 7365 7428 6372 6561  ments = set(crea
+00021d70: 7465 6f70 7473 5b62 2773 6861 7265 6472  teopts[b'sharedr
+00021d80: 6570 6f27 5d2e 7265 7175 6972 656d 656e  epo'].requiremen
+00021d90: 7473 290a 0a20 2020 2020 2020 2069 6620  ts)..        if 
+00021da0: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
+00021db0: 5348 4152 4553 4146 455f 5245 5155 4952  SHARESAFE_REQUIR
+00021dc0: 454d 454e 5420 6e6f 7420 696e 2073 6f75  EMENT not in sou
+00021dd0: 7263 655f 7265 7175 6972 656d 656e 7473  rce_requirements
+00021de0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00021df0: 7368 6172 6520 746f 2061 6e20 6f6c 6420  share to an old 
+00021e00: 7363 686f 6f6c 2072 6570 6f73 6974 6f72  school repositor
+00021e10: 792c 2077 6520 6861 7665 2074 6f20 636f  y, we have to co
+00021e20: 7079 2074 6865 0a20 2020 2020 2020 2020  py the.         
+00021e30: 2020 2023 2072 6571 7569 7265 6d65 6e74     # requirement
+00021e40: 7320 616e 6420 686f 7065 2066 6f72 2074  s and hope for t
+00021e50: 6865 2062 6573 742e 0a20 2020 2020 2020  he best..       
+00021e60: 2020 2020 2072 6571 7569 7265 6d65 6e74       requirement
+00021e70: 7320 3d20 736f 7572 6365 5f72 6571 7569  s = source_requi
+00021e80: 7265 6d65 6e74 730a 2020 2020 2020 2020  rements.        
+00021e90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00021ea0: 2020 2320 5765 2068 6176 6520 636f 6e74    # We have cont
+00021eb0: 726f 6c20 6f6e 2074 6865 2077 6f72 6b69  rol on the worki
+00021ec0: 6e67 2063 6f70 7920 6f6e 6c79 2c20 736f  ng copy only, so
+00021ed0: 2022 636f 7079 2220 7468 6520 6e6f 6e0a   "copy" the non.
+00021ee0: 2020 2020 2020 2020 2020 2020 2320 776f              # wo
+00021ef0: 726b 696e 6720 636f 7079 2070 6172 7420  rking copy part 
+00021f00: 6f76 6572 2c20 6967 6e6f 7269 6e67 2070  over, ignoring p
+00021f10: 7265 7669 6f75 7320 6c6f 6769 632e 0a20  revious logic.. 
+00021f20: 2020 2020 2020 2020 2020 2074 6f5f 6472             to_dr
+00021f30: 6f70 203d 2073 6574 2829 0a20 2020 2020  op = set().     
+00021f40: 2020 2020 2020 2066 6f72 2072 6571 2069         for req i
+00021f50: 6e20 7265 7175 6972 656d 656e 7473 3a0a  n requirements:.
 00021f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021f70: 2062 2762 6561 6375 7365 2069 7420 6973   b'beacuse it is
-00021f80: 2069 6e63 6f6d 7061 7469 626c 6520 7769   incompatible wi
-00021f90: 7468 2064 6973 6162 6c65 6420 270a 2020  th disabled '.  
-00021fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021fb0: 2020 6227 5c27 666f 726d 6174 2e75 7365    b'\'format.use
-00021fc0: 7374 6f72 655c 2720 636f 6e66 6967 5c6e  store\' config\n
-00021fd0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00021fe0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00021ff0: 290a 2020 2020 2020 2020 2020 2020 6472  ).            dr
-00022000: 6f70 7065 642e 6164 6428 7265 7175 6972  opped.add(requir
-00022010: 656d 656e 7473 6d6f 642e 424f 4f4b 4d41  ementsmod.BOOKMA
-00022020: 524b 535f 494e 5f53 544f 5245 5f52 4551  RKS_IN_STORE_REQ
-00022030: 5549 5245 4d45 4e54 290a 0a20 2020 2020  UIREMENT)..     
-00022040: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00022050: 2020 2020 7265 7175 6972 656d 656e 7473      requirements
-00022060: 6d6f 642e 5348 4152 4544 5f52 4551 5549  mod.SHARED_REQUI
-00022070: 5245 4d45 4e54 2069 6e20 7265 7175 6972  REMENT in requir
-00022080: 656d 656e 7473 0a20 2020 2020 2020 2020  ements.         
-00022090: 2020 206f 7220 7265 7175 6972 656d 656e     or requiremen
-000220a0: 7473 6d6f 642e 5245 4c41 5449 5645 5f53  tsmod.RELATIVE_S
-000220b0: 4841 5245 445f 5245 5155 4952 454d 454e  HARED_REQUIREMEN
-000220c0: 5420 696e 2072 6571 7569 7265 6d65 6e74  T in requirement
-000220d0: 730a 2020 2020 2020 2020 293a 0a20 2020  s.        ):.   
-000220e0: 2020 2020 2020 2020 2072 6169 7365 2065           raise e
-000220f0: 7272 6f72 2e41 626f 7274 280a 2020 2020  rror.Abort(.    
-00022100: 2020 2020 2020 2020 2020 2020 5f28 0a20              _(. 
-00022110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022120: 2020 2062 2263 616e 6e6f 7420 6372 6561     b"cannot crea
-00022130: 7465 2073 6861 7265 6420 7265 706f 7369  te shared reposi
-00022140: 746f 7279 2061 7320 736f 7572 6365 2077  tory as source w
-00022150: 6173 2063 7265 6174 6564 220a 2020 2020  as created".    
-00022160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022170: 6222 2077 6974 6820 2766 6f72 6d61 742e  b" with 'format.
-00022180: 7573 6573 746f 7265 2720 636f 6e66 6967  usestore' config
-00022190: 2064 6973 6162 6c65 6422 0a20 2020 2020   disabled".     
-000221a0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000221b0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-000221c0: 2020 2020 6966 2072 6571 7569 7265 6d65      if requireme
-000221d0: 6e74 736d 6f64 2e53 4841 5245 5341 4645  ntsmod.SHARESAFE
-000221e0: 5f52 4551 5549 5245 4d45 4e54 2069 6e20  _REQUIREMENT in 
-000221f0: 7265 7175 6972 656d 656e 7473 3a0a 2020  requirements:.  
-00022200: 2020 2020 2020 2020 2020 6966 2075 692e            if ui.
-00022210: 6861 7363 6f6e 6669 6728 6227 666f 726d  hasconfig(b'form
-00022220: 6174 272c 2062 2775 7365 2d73 6861 7265  at', b'use-share
-00022230: 2d73 6166 6527 293a 0a20 2020 2020 2020  -safe'):.       
-00022240: 2020 2020 2020 2020 206d 7367 203d 205f           msg = _
-00022250: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00022260: 2020 2020 2020 6222 6967 6e6f 7269 6e67        b"ignoring
-00022270: 2065 6e61 626c 6564 2027 666f 726d 6174   enabled 'format
-00022280: 2e75 7365 2d73 6861 7265 2d73 6166 6527  .use-share-safe'
-00022290: 2063 6f6e 6669 6720 6265 6361 7573 6520   config because 
-000222a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000222b0: 2020 2020 2020 6222 6974 2069 7320 696e        b"it is in
-000222c0: 636f 6d70 6174 6962 6c65 2077 6974 6820  compatible with 
-000222d0: 6469 7361 626c 6564 2027 666f 726d 6174  disabled 'format
-000222e0: 2e75 7365 7374 6f72 6527 220a 2020 2020  .usestore'".    
-000222f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022300: 6222 2063 6f6e 6669 675c 6e22 0a20 2020  b" config\n".   
-00022310: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00022320: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00022330: 692e 7761 726e 286d 7367 290a 2020 2020  i.warn(msg).    
-00022340: 2020 2020 2020 2020 6472 6f70 7065 642e          dropped.
-00022350: 6164 6428 7265 7175 6972 656d 656e 7473  add(requirements
-00022360: 6d6f 642e 5348 4152 4553 4146 455f 5245  mod.SHARESAFE_RE
-00022370: 5155 4952 454d 454e 5429 0a0a 2020 2020  QUIREMENT)..    
-00022380: 7265 7475 726e 2064 726f 7070 6564 0a0a  return dropped..
-00022390: 0a64 6566 2066 696c 7465 726b 6e6f 776e  .def filterknown
-000223a0: 6372 6561 7465 6f70 7473 2875 692c 2063  createopts(ui, c
-000223b0: 7265 6174 656f 7074 7329 3a0a 2020 2020  reateopts):.    
-000223c0: 2222 2246 696c 7465 7273 2061 2064 6963  """Filters a dic
-000223d0: 7420 6f66 2072 6570 6f20 6372 6561 7469  t of repo creati
-000223e0: 6f6e 206f 7074 696f 6e73 2061 6761 696e  on options again
-000223f0: 7374 206f 7074 696f 6e73 2074 6861 7420  st options that 
-00022400: 6172 6520 6b6e 6f77 6e2e 0a0a 2020 2020  are known...    
-00022410: 5265 6365 6976 6573 2061 2064 6963 7420  Receives a dict 
-00022420: 6f66 2072 6570 6f20 6372 6561 7469 6f6e  of repo creation
-00022430: 206f 7074 696f 6e73 2061 6e64 2072 6574   options and ret
-00022440: 7572 6e73 2061 2064 6963 7420 6f66 2074  urns a dict of t
-00022450: 686f 7365 0a20 2020 206f 7074 696f 6e73  hose.    options
-00022460: 2074 6861 7420 7765 2064 6f6e 2774 206b   that we don't k
-00022470: 6e6f 7720 686f 7720 746f 2068 616e 646c  now how to handl
-00022480: 652e 0a0a 2020 2020 5468 6973 2066 756e  e...    This fun
-00022490: 6374 696f 6e20 6973 2063 616c 6c65 6420  ction is called 
-000224a0: 6173 2070 6172 7420 6f66 2072 6570 6f73  as part of repos
-000224b0: 6974 6f72 7920 6372 6561 7469 6f6e 2e20  itory creation. 
-000224c0: 4966 2074 6865 0a20 2020 2072 6574 7572  If the.    retur
-000224d0: 6e65 6420 6469 6374 2063 6f6e 7461 696e  ned dict contain
-000224e0: 7320 616e 7920 6974 656d 732c 2072 6570  s any items, rep
-000224f0: 6f73 6974 6f72 7920 6372 6561 7469 6f6e  ository creation
-00022500: 2077 696c 6c20 6e6f 740a 2020 2020 6265   will not.    be
-00022510: 2061 6c6c 6f77 6564 2c20 6173 2069 7420   allowed, as it 
-00022520: 6d65 616e 7320 7468 6572 6520 7761 7320  means there was 
-00022530: 6120 7265 7175 6573 7420 746f 2063 7265  a request to cre
-00022540: 6174 6520 6120 7265 706f 7369 746f 7279  ate a repository
-00022550: 0a20 2020 2077 6974 6820 6f70 7469 6f6e  .    with option
-00022560: 7320 6e6f 7420 7265 636f 676e 697a 6564  s not recognized
-00022570: 2062 7920 6c6f 6164 6564 2063 6f64 652e   by loaded code.
-00022580: 0a0a 2020 2020 4578 7465 6e73 696f 6e73  ..    Extensions
-00022590: 2063 616e 2077 7261 7020 7468 6973 2066   can wrap this f
-000225a0: 756e 6374 696f 6e20 746f 2066 696c 7465  unction to filte
-000225b0: 7220 6f75 7420 6372 6561 7469 6f6e 206f  r out creation o
-000225c0: 7074 696f 6e73 0a20 2020 2074 6865 7920  ptions.    they 
-000225d0: 6b6e 6f77 2068 6f77 2074 6f20 6861 6e64  know how to hand
-000225e0: 6c65 2e0a 2020 2020 2222 220a 2020 2020  le..    """.    
-000225f0: 6b6e 6f77 6e20 3d20 7b0a 2020 2020 2020  known = {.      
-00022600: 2020 6227 6261 636b 656e 6427 2c0a 2020    b'backend',.  
-00022610: 2020 2020 2020 6227 6c66 7327 2c0a 2020        b'lfs',.  
-00022620: 2020 2020 2020 6227 6e61 7272 6f77 6669        b'narrowfi
-00022630: 6c65 7327 2c0a 2020 2020 2020 2020 6227  les',.        b'
-00022640: 7368 6172 6564 7265 706f 272c 0a20 2020  sharedrepo',.   
-00022650: 2020 2020 2062 2773 6861 7265 6472 656c       b'sharedrel
-00022660: 6174 6976 6527 2c0a 2020 2020 2020 2020  ative',.        
-00022670: 6227 7368 6172 6564 6974 656d 7327 2c0a  b'shareditems',.
-00022680: 2020 2020 2020 2020 6227 7368 616c 6c6f          b'shallo
-00022690: 7766 696c 6573 746f 7265 272c 0a20 2020  wfilestore',.   
-000226a0: 207d 0a0a 2020 2020 7265 7475 726e 207b   }..    return {
-000226b0: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
-000226c0: 2063 7265 6174 656f 7074 732e 6974 656d   createopts.item
-000226d0: 7328 2920 6966 206b 206e 6f74 2069 6e20  s() if k not in 
-000226e0: 6b6e 6f77 6e7d 0a0a 0a64 6566 2063 7265  known}...def cre
-000226f0: 6174 6572 6570 6f73 6974 6f72 7928 7569  aterepository(ui
-00022700: 2c20 7061 7468 3a20 6279 7465 732c 2063  , path: bytes, c
-00022710: 7265 6174 656f 7074 733d 4e6f 6e65 2c20  reateopts=None, 
-00022720: 7265 7175 6972 656d 656e 7473 3d4e 6f6e  requirements=Non
-00022730: 6529 3a0a 2020 2020 2222 2243 7265 6174  e):.    """Creat
-00022740: 6520 6120 6e65 7720 7265 706f 7369 746f  e a new reposito
-00022750: 7279 2069 6e20 6120 7666 732e 0a0a 2020  ry in a vfs...  
-00022760: 2020 6060 7061 7468 6060 2070 6174 6820    ``path`` path 
-00022770: 746f 2074 6865 206e 6577 2072 6570 6f27  to the new repo'
-00022780: 7320 776f 726b 696e 6720 6469 7265 6374  s working direct
-00022790: 6f72 792e 0a20 2020 2060 6063 7265 6174  ory..    ``creat
-000227a0: 656f 7074 7360 6020 6f70 7469 6f6e 7320  eopts`` options 
-000227b0: 666f 7220 7468 6520 6e65 7720 7265 706f  for the new repo
-000227c0: 7369 746f 7279 2e0a 2020 2020 6060 7265  sitory..    ``re
-000227d0: 7175 6972 656d 656e 7460 6020 7072 6564  quirement`` pred
-000227e0: 6566 696e 6564 2073 6574 206f 6620 7265  efined set of re
-000227f0: 7175 6972 656d 656e 7473 2e0a 2020 2020  quirements..    
-00022800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022810: 2869 6e63 6f6d 7061 7469 626c 6520 7769  (incompatible wi
-00022820: 7468 2060 6063 7265 6174 656f 7074 7360  th ``createopts`
-00022830: 6029 0a0a 2020 2020 5468 6520 666f 6c6c  `)..    The foll
-00022840: 6f77 696e 6720 6b65 7973 2066 6f72 2060  owing keys for `
-00022850: 6063 7265 6174 656f 7074 7360 6020 6172  `createopts`` ar
-00022860: 6520 7265 636f 676e 697a 6564 3a0a 0a20  e recognized:.. 
-00022870: 2020 2062 6163 6b65 6e64 0a20 2020 2020     backend.     
-00022880: 2020 5468 6520 7374 6f72 6167 6520 6261    The storage ba
-00022890: 636b 656e 6420 746f 2075 7365 2e0a 2020  ckend to use..  
-000228a0: 2020 6c66 730a 2020 2020 2020 2052 6570    lfs.       Rep
-000228b0: 6f73 6974 6f72 7920 7769 6c6c 2062 6520  ository will be 
-000228c0: 6372 6561 7465 6420 7769 7468 2060 606c  created with ``l
-000228d0: 6673 6060 2072 6571 7569 7265 6d65 6e74  fs`` requirement
-000228e0: 2e20 5468 6520 6c66 7320 6578 7465 6e73  . The lfs extens
-000228f0: 696f 6e0a 2020 2020 2020 2077 696c 6c20  ion.       will 
-00022900: 6175 746f 6d61 7469 6361 6c6c 7920 6265  automatically be
-00022910: 206c 6f61 6465 6420 7768 656e 2074 6865   loaded when the
-00022920: 2072 6570 6f73 6974 6f72 7920 6973 2061   repository is a
-00022930: 6363 6573 7365 642e 0a20 2020 206e 6172  ccessed..    nar
-00022940: 726f 7766 696c 6573 0a20 2020 2020 2020  rowfiles.       
-00022950: 5365 7420 7570 2072 6570 6f73 6974 6f72  Set up repositor
-00022960: 7920 746f 2073 7570 706f 7274 206e 6172  y to support nar
-00022970: 726f 7720 6669 6c65 2073 746f 7261 6765  row file storage
-00022980: 2e0a 2020 2020 7368 6172 6564 7265 706f  ..    sharedrepo
-00022990: 0a20 2020 2020 2020 5265 706f 7369 746f  .       Reposito
-000229a0: 7279 206f 626a 6563 7420 6672 6f6d 2077  ry object from w
-000229b0: 6869 6368 2073 746f 7261 6765 2073 686f  hich storage sho
-000229c0: 756c 6420 6265 2073 6861 7265 642e 0a20  uld be shared.. 
-000229d0: 2020 2073 6861 7265 6472 656c 6174 6976     sharedrelativ
-000229e0: 650a 2020 2020 2020 2042 6f6f 6c65 616e  e.       Boolean
-000229f0: 2069 6e64 6963 6174 696e 6720 6966 2074   indicating if t
-00022a00: 6865 2070 6174 6820 746f 2074 6865 2073  he path to the s
-00022a10: 6861 7265 6420 7265 706f 2073 686f 756c  hared repo shoul
-00022a20: 6420 6265 0a20 2020 2020 2020 7374 6f72  d be.       stor
-00022a30: 6564 2061 7320 7265 6c61 7469 7665 2e20  ed as relative. 
-00022a40: 4279 2064 6566 6175 6c74 2c20 7468 6520  By default, the 
-00022a50: 706f 696e 7465 7220 746f 2074 6865 2022  pointer to the "
-00022a60: 7061 7265 6e74 2220 7265 706f 0a20 2020  parent" repo.   
-00022a70: 2020 2020 6973 2073 746f 7265 6420 6173      is stored as
-00022a80: 2061 6e20 6162 736f 6c75 7465 2070 6174   an absolute pat
-00022a90: 682e 0a20 2020 2073 6861 7265 6469 7465  h..    sharedite
-00022aa0: 6d73 0a20 2020 2020 2020 5365 7420 6f66  ms.       Set of
-00022ab0: 2069 7465 6d73 2074 6f20 7368 6172 6520   items to share 
-00022ac0: 746f 2074 6865 206e 6577 2072 6570 6f73  to the new repos
-00022ad0: 6974 6f72 7920 2869 6e20 6164 6469 7469  itory (in additi
-00022ae0: 6f6e 2074 6f20 7374 6f72 6167 6529 2e0a  on to storage)..
-00022af0: 2020 2020 7368 616c 6c6f 7766 696c 6573      shallowfiles
-00022b00: 746f 7265 0a20 2020 2020 2020 496e 6469  tore.       Indi
-00022b10: 6361 7465 7320 7468 6174 2073 746f 7261  cates that stora
-00022b20: 6765 2066 6f72 2066 696c 6573 2073 686f  ge for files sho
-00022b30: 756c 6420 6265 2073 6861 6c6c 6f77 2028  uld be shallow (
-00022b40: 6e6f 7420 616c 6c20 616e 6365 7374 6f72  not all ancestor
-00022b50: 0a20 2020 2020 2020 7265 7669 7369 6f6e  .       revision
-00022b60: 7320 6172 6520 6b6e 6f77 6e29 2e0a 2020  s are known)..  
-00022b70: 2020 2222 220a 0a20 2020 2069 6620 7265    """..    if re
-00022b80: 7175 6972 656d 656e 7473 2069 7320 6e6f  quirements is no
-00022b90: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00022ba0: 6966 2063 7265 6174 656f 7074 7320 6973  if createopts is
-00022bb0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00022bc0: 2020 2020 2020 206d 7367 203d 2062 2763         msg = b'c
-00022bd0: 616e 6e6f 7420 7370 6563 6966 7920 626f  annot specify bo
-00022be0: 7468 2063 7265 6174 656f 7074 7320 616e  th createopts an
-00022bf0: 6420 7265 7175 6972 656d 656e 7473 270a  d requirements'.
-00022c00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00022c10: 6520 6572 726f 722e 5072 6f67 7261 6d6d  e error.Programm
-00022c20: 696e 6745 7272 6f72 286d 7367 290a 2020  ingError(msg).  
-00022c30: 2020 2020 2020 6372 6561 7465 6f70 7473        createopts
-00022c40: 203d 207b 7d0a 2020 2020 656c 7365 3a0a   = {}.    else:.
-00022c50: 2020 2020 2020 2020 6372 6561 7465 6f70          createop
-00022c60: 7473 203d 2064 6566 6175 6c74 6372 6561  ts = defaultcrea
-00022c70: 7465 6f70 7473 2875 692c 2063 7265 6174  teopts(ui, creat
-00022c80: 656f 7074 733d 6372 6561 7465 6f70 7473  eopts=createopts
-00022c90: 290a 0a20 2020 2020 2020 2075 6e6b 6e6f  )..        unkno
-00022ca0: 776e 6f70 7473 203d 2066 696c 7465 726b  wnopts = filterk
-00022cb0: 6e6f 776e 6372 6561 7465 6f70 7473 2875  nowncreateopts(u
-00022cc0: 692c 2063 7265 6174 656f 7074 7329 0a0a  i, createopts)..
-00022cd0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00022ce0: 7369 6e73 7461 6e63 6528 756e 6b6e 6f77  sinstance(unknow
-00022cf0: 6e6f 7074 732c 2064 6963 7429 3a0a 2020  nopts, dict):.  
-00022d00: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00022d10: 6572 726f 722e 5072 6f67 7261 6d6d 696e  error.Programmin
-00022d20: 6745 7272 6f72 280a 2020 2020 2020 2020  gError(.        
-00022d30: 2020 2020 2020 2020 6227 6669 6c74 6572          b'filter
-00022d40: 6b6e 6f77 6e63 7265 6174 656f 7074 7328  knowncreateopts(
-00022d50: 2920 6469 6420 6e6f 7420 7265 7475 726e  ) did not return
-00022d60: 2061 2064 6963 7427 0a20 2020 2020 2020   a dict'.       
-00022d70: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00022d80: 6966 2075 6e6b 6e6f 776e 6f70 7473 3a0a  if unknownopts:.
-00022d90: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00022da0: 6520 6572 726f 722e 4162 6f72 7428 0a20  e error.Abort(. 
-00022db0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-00022dc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00022dd0: 2020 2020 2020 6227 756e 6162 6c65 2074        b'unable t
-00022de0: 6f20 6372 6561 7465 2072 6570 6f73 6974  o create reposit
-00022df0: 6f72 7920 6265 6361 7573 6520 6f66 2075  ory because of u
-00022e00: 6e6b 6e6f 776e 2027 0a20 2020 2020 2020  nknown '.       
-00022e10: 2020 2020 2020 2020 2020 2020 2062 2763               b'c
-00022e20: 7265 6174 696f 6e20 6f70 7469 6f6e 3a20  reation option: 
-00022e30: 2573 270a 2020 2020 2020 2020 2020 2020  %s'.            
-00022e40: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00022e50: 2020 2020 2020 2520 6227 2c20 272e 6a6f        % b', '.jo
-00022e60: 696e 2873 6f72 7465 6428 756e 6b6e 6f77  in(sorted(unknow
-00022e70: 6e6f 7074 7329 292c 0a20 2020 2020 2020  nopts)),.       
-00022e80: 2020 2020 2020 2020 2068 696e 743d 5f28           hint=_(
-00022e90: 6227 6973 2061 2072 6571 7569 7265 6420  b'is a required 
-00022ea0: 6578 7465 6e73 696f 6e20 6e6f 7420 6c6f  extension not lo
-00022eb0: 6164 6564 3f27 292c 0a20 2020 2020 2020  aded?'),.       
-00022ec0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00022ed0: 7265 7175 6972 656d 656e 7473 203d 206e  requirements = n
-00022ee0: 6577 7265 706f 7265 7175 6972 656d 656e  ewreporequiremen
-00022ef0: 7473 2875 692c 2063 7265 6174 656f 7074  ts(ui, createopt
-00022f00: 733d 6372 6561 7465 6f70 7473 290a 2020  s=createopts).  
-00022f10: 2020 2020 2020 7265 7175 6972 656d 656e        requiremen
-00022f20: 7473 202d 3d20 6368 6563 6b72 6571 7569  ts -= checkrequi
-00022f30: 7265 6d65 6e74 7363 6f6d 7061 7428 7569  rementscompat(ui
-00022f40: 2c20 7265 7175 6972 656d 656e 7473 290a  , requirements).
-00022f50: 0a20 2020 2077 6469 7276 6673 203d 2076  .    wdirvfs = v
-00022f60: 6673 6d6f 642e 7666 7328 7061 7468 2c20  fsmod.vfs(path, 
-00022f70: 6578 7061 6e64 7061 7468 3d54 7275 652c  expandpath=True,
-00022f80: 2072 6561 6c70 6174 683d 5472 7565 290a   realpath=True).
-00022f90: 0a20 2020 2068 6776 6673 203d 2076 6673  .    hgvfs = vfs
-00022fa0: 6d6f 642e 7666 7328 7764 6972 7666 732e  mod.vfs(wdirvfs.
-00022fb0: 6a6f 696e 2862 272e 6867 2729 290a 2020  join(b'.hg')).  
-00022fc0: 2020 6966 2068 6776 6673 2e65 7869 7374    if hgvfs.exist
-00022fd0: 7328 293a 0a20 2020 2020 2020 2072 6169  s():.        rai
-00022fe0: 7365 2065 7272 6f72 2e52 6570 6f45 7272  se error.RepoErr
-00022ff0: 6f72 285f 2862 2772 6570 6f73 6974 6f72  or(_(b'repositor
-00023000: 7920 2573 2061 6c72 6561 6479 2065 7869  y %s already exi
-00023010: 7374 7327 2920 2520 7061 7468 290a 0a20  sts') % path).. 
-00023020: 2020 2069 6620 6227 7368 6172 6564 7265     if b'sharedre
-00023030: 706f 2720 696e 2063 7265 6174 656f 7074  po' in createopt
-00023040: 733a 0a20 2020 2020 2020 2073 6861 7265  s:.        share
-00023050: 6470 6174 6820 3d20 6372 6561 7465 6f70  dpath = createop
-00023060: 7473 5b62 2773 6861 7265 6472 6570 6f27  ts[b'sharedrepo'
-00023070: 5d2e 7368 6172 6564 7061 7468 0a0a 2020  ].sharedpath..  
-00023080: 2020 2020 2020 6966 2063 7265 6174 656f        if createo
-00023090: 7074 732e 6765 7428 6227 7368 6172 6564  pts.get(b'shared
-000230a0: 7265 6c61 7469 7665 2729 3a0a 2020 2020  relative'):.    
-000230b0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000230c0: 2020 2020 2020 2020 2020 2020 2073 6861               sha
-000230d0: 7265 6470 6174 6820 3d20 6f73 2e70 6174  redpath = os.pat
-000230e0: 682e 7265 6c70 6174 6828 7368 6172 6564  h.relpath(shared
-000230f0: 7061 7468 2c20 6867 7666 732e 6261 7365  path, hgvfs.base
-00023100: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00023110: 2020 7368 6172 6564 7061 7468 203d 2075    sharedpath = u
-00023120: 7469 6c2e 7063 6f6e 7665 7274 2873 6861  til.pconvert(sha
-00023130: 7265 6470 6174 6829 0a20 2020 2020 2020  redpath).       
-00023140: 2020 2020 2065 7863 6570 7420 2849 4f45       except (IOE
-00023150: 7272 6f72 2c20 5661 6c75 6545 7272 6f72  rror, ValueError
-00023160: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
-00023170: 2020 2020 2020 2020 2320 5661 6c75 6545          # ValueE
-00023180: 7272 6f72 2069 7320 7261 6973 6564 206f  rror is raised o
-00023190: 6e20 5769 6e64 6f77 7320 6966 2074 6865  n Windows if the
-000231a0: 2064 7269 7665 206c 6574 7465 7273 2064   drive letters d
-000231b0: 6966 6665 720a 2020 2020 2020 2020 2020  iffer.          
-000231c0: 2020 2020 2020 2320 6f6e 2065 6163 6820        # on each 
-000231d0: 7061 7468 2e0a 2020 2020 2020 2020 2020  path..          
-000231e0: 2020 2020 2020 7261 6973 6520 6572 726f        raise erro
-000231f0: 722e 4162 6f72 7428 0a20 2020 2020 2020  r.Abort(.       
-00023200: 2020 2020 2020 2020 2020 2020 205f 2862               _(b
-00023210: 2763 616e 6e6f 7420 6361 6c63 756c 6174  'cannot calculat
-00023220: 6520 7265 6c61 7469 7665 2070 6174 6827  e relative path'
-00023230: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00023240: 2020 2020 2020 2068 696e 743d 7374 7269         hint=stri
-00023250: 6e67 7574 696c 2e66 6f72 6365 6279 7465  ngutil.forcebyte
-00023260: 7374 7228 6529 2c0a 2020 2020 2020 2020  str(e),.        
-00023270: 2020 2020 2020 2020 290a 0a20 2020 2069          )..    i
-00023280: 6620 6e6f 7420 7764 6972 7666 732e 6578  f not wdirvfs.ex
-00023290: 6973 7473 2829 3a0a 2020 2020 2020 2020  ists():.        
-000232a0: 7764 6972 7666 732e 6d61 6b65 6469 7273  wdirvfs.makedirs
-000232b0: 2829 0a0a 2020 2020 6867 7666 732e 6d61  ()..    hgvfs.ma
-000232c0: 6b65 6469 7228 6e6f 7469 6e64 6578 6564  kedir(notindexed
-000232d0: 3d54 7275 6529 0a20 2020 2069 6620 6227  =True).    if b'
-000232e0: 7368 6172 6564 7265 706f 2720 6e6f 7420  sharedrepo' not 
-000232f0: 696e 2063 7265 6174 656f 7074 733a 0a20  in createopts:. 
-00023300: 2020 2020 2020 2068 6776 6673 2e6d 6b64         hgvfs.mkd
-00023310: 6972 2862 2763 6163 6865 2729 0a20 2020  ir(b'cache').   
-00023320: 2068 6776 6673 2e6d 6b64 6972 2862 2777   hgvfs.mkdir(b'w
-00023330: 6361 6368 6527 290a 0a20 2020 2068 6173  cache')..    has
-00023340: 5f73 746f 7265 203d 2072 6571 7569 7265  _store = require
-00023350: 6d65 6e74 736d 6f64 2e53 544f 5245 5f52  mentsmod.STORE_R
-00023360: 4551 5549 5245 4d45 4e54 2069 6e20 7265  EQUIREMENT in re
-00023370: 7175 6972 656d 656e 7473 0a20 2020 2069  quirements.    i
-00023380: 6620 6861 735f 7374 6f72 6520 616e 6420  f has_store and 
-00023390: 6227 7368 6172 6564 7265 706f 2720 6e6f  b'sharedrepo' no
-000233a0: 7420 696e 2063 7265 6174 656f 7074 733a  t in createopts:
-000233b0: 0a20 2020 2020 2020 2068 6776 6673 2e6d  .        hgvfs.m
-000233c0: 6b64 6972 2862 2773 746f 7265 2729 0a0a  kdir(b'store')..
-000233d0: 2020 2020 2020 2020 2320 5765 2063 7265          # We cre
-000233e0: 6174 6520 616e 2069 6e76 616c 6964 2063  ate an invalid c
-000233f0: 6861 6e67 656c 6f67 206f 7574 7369 6465  hangelog outside
-00023400: 2074 6865 2073 746f 7265 2073 6f20 7665   the store so ve
-00023410: 7279 206f 6c64 0a20 2020 2020 2020 2023  ry old.        #
-00023420: 204d 6572 6375 7269 616c 2076 6572 7369   Mercurial versi
-00023430: 6f6e 7320 2877 6869 6368 2064 6964 6e27  ons (which didn'
-00023440: 7420 6b6e 6f77 2061 626f 7574 2074 6865  t know about the
-00023450: 2072 6571 7569 7265 6d65 6e74 730a 2020   requirements.  
-00023460: 2020 2020 2020 2320 6669 6c65 2920 656e        # file) en
-00023470: 636f 756e 7465 7220 616e 2065 7272 6f72  counter an error
-00023480: 206f 6e20 7265 6164 696e 6720 7468 6520   on reading the 
-00023490: 6368 616e 6765 6c6f 672e 2054 6869 730a  changelog. This.
-000234a0: 2020 2020 2020 2020 2320 6566 6665 6374          # effect
-000234b0: 6976 656c 7920 6c6f 636b 7320 6f75 7420  ively locks out 
-000234c0: 6f6c 6420 636c 6965 6e74 7320 616e 6420  old clients and 
-000234d0: 7072 6576 656e 7473 2074 6865 6d20 6672  prevents them fr
-000234e0: 6f6d 0a20 2020 2020 2020 2023 206d 7563  om.        # muc
-000234f0: 6b69 6e67 2077 6974 6820 6120 7265 706f  king with a repo
-00023500: 2069 6e20 616e 2075 6e6b 6e6f 776e 2066   in an unknown f
-00023510: 6f72 6d61 742e 0a20 2020 2020 2020 2023  ormat..        #
-00023520: 0a20 2020 2020 2020 2023 2054 6865 2072  .        # The r
-00023530: 6576 6c6f 6720 6865 6164 6572 2068 6173  evlog header has
-00023540: 2076 6572 7369 6f6e 2036 3535 3335 2c20   version 65535, 
-00023550: 7768 6963 6820 776f 6e27 7420 6265 2072  which won't be r
-00023560: 6563 6f67 6e69 7a65 6420 6279 0a20 2020  ecognized by.   
-00023570: 2020 2020 2023 2073 7563 6820 6f6c 6420       # such old 
-00023580: 636c 6965 6e74 732e 0a20 2020 2020 2020  clients..       
-00023590: 2068 6776 6673 2e61 7070 656e 6428 0a20   hgvfs.append(. 
-000235a0: 2020 2020 2020 2020 2020 2062 2730 3063             b'00c
-000235b0: 6861 6e67 656c 6f67 2e69 272c 0a20 2020  hangelog.i',.   
-000235c0: 2020 2020 2020 2020 2062 275c 305c 305c           b'\0\0\
-000235d0: 7846 465c 7846 4620 6475 6d6d 7920 6368  xFF\xFF dummy ch
-000235e0: 616e 6765 6c6f 6720 746f 2070 7265 7665  angelog to preve
-000235f0: 6e74 2075 7369 6e67 2074 6865 206f 6c64  nt using the old
-00023600: 2072 6570 6f20 270a 2020 2020 2020 2020   repo '.        
-00023610: 2020 2020 6227 6c61 796f 7574 272c 0a20      b'layout',. 
-00023620: 2020 2020 2020 2029 0a0a 2020 2020 2320         )..    # 
-00023630: 4669 6c74 6572 2074 6865 2072 6571 7569  Filter the requi
-00023640: 7265 6d65 6e74 7320 696e 746f 2077 6f72  rements into wor
-00023650: 6b69 6e67 2063 6f70 7920 616e 6420 7374  king copy and st
-00023660: 6f72 6520 6f6e 6573 0a20 2020 2077 6372  ore ones.    wcr
-00023670: 6571 2c20 7374 6f72 6572 6571 203d 2073  eq, storereq = s
-00023680: 636d 7574 696c 2e66 696c 7465 7272 6571  cmutil.filterreq
-00023690: 7569 7265 6d65 6e74 7328 7265 7175 6972  uirements(requir
-000236a0: 656d 656e 7473 290a 2020 2020 2320 7772  ements).    # wr
-000236b0: 6974 6520 776f 726b 696e 6720 636f 7079  ite working copy
-000236c0: 206f 6e65 730a 2020 2020 7363 6d75 7469   ones.    scmuti
-000236d0: 6c2e 7772 6974 6572 6571 7569 7265 7328  l.writerequires(
-000236e0: 6867 7666 732c 2077 6372 6571 290a 2020  hgvfs, wcreq).  
-000236f0: 2020 2320 4966 2074 6865 7265 2061 7265    # If there are
-00023700: 2073 746f 7265 2072 6571 7569 7265 6d65   store requireme
-00023710: 6e74 7320 616e 6420 7468 6520 6375 7272  nts and the curr
-00023720: 656e 7420 7265 706f 7369 746f 7279 0a20  ent repository. 
-00023730: 2020 2023 2069 7320 6e6f 7420 6120 7368     # is not a sh
-00023740: 6172 6564 206f 6e65 2c20 7772 6974 6520  ared one, write 
-00023750: 7374 6f72 6564 2072 6571 7569 7265 6d65  stored requireme
-00023760: 6e74 730a 2020 2020 2320 466f 7220 6e65  nts.    # For ne
-00023770: 7720 7368 6172 6564 2072 6570 6f73 6974  w shared reposit
-00023780: 6f72 792c 2077 6520 646f 6e27 7420 6e65  ory, we don't ne
-00023790: 6564 2074 6f20 7772 6974 6520 7468 6520  ed to write the 
-000237a0: 7374 6f72 650a 2020 2020 2320 7265 7175  store.    # requ
-000237b0: 6972 656d 656e 7473 2061 7320 7468 6579  irements as they
-000237c0: 2061 7265 2061 6c72 6561 6479 2070 7265   are already pre
-000237d0: 7365 6e74 2069 6e20 7374 6f72 6520 7265  sent in store re
-000237e0: 7175 6972 6573 0a20 2020 2069 6620 7374  quires.    if st
-000237f0: 6f72 6572 6571 2061 6e64 2062 2773 6861  orereq and b'sha
-00023800: 7265 6472 6570 6f27 206e 6f74 2069 6e20  redrepo' not in 
-00023810: 6372 6561 7465 6f70 7473 3a0a 2020 2020  createopts:.    
-00023820: 2020 2020 7374 6f72 6576 6673 203d 2076      storevfs = v
-00023830: 6673 6d6f 642e 7666 7328 6867 7666 732e  fsmod.vfs(hgvfs.
-00023840: 6a6f 696e 2862 2773 746f 7265 2729 2c20  join(b'store'), 
-00023850: 6361 6368 6561 7564 6974 6564 3d54 7275  cacheaudited=Tru
-00023860: 6529 0a20 2020 2020 2020 2073 636d 7574  e).        scmut
-00023870: 696c 2e77 7269 7465 7265 7175 6972 6573  il.writerequires
-00023880: 2873 746f 7265 7666 732c 2073 746f 7265  (storevfs, store
-00023890: 7265 7129 0a0a 2020 2020 2320 5772 6974  req)..    # Writ
-000238a0: 6520 6f75 7420 6669 6c65 2074 656c 6c69  e out file telli
-000238b0: 6e67 2072 6561 6465 7273 2077 6865 7265  ng readers where
-000238c0: 2074 6f20 6669 6e64 2074 6865 2073 6861   to find the sha
-000238d0: 7265 6420 7374 6f72 652e 0a20 2020 2069  red store..    i
-000238e0: 6620 6227 7368 6172 6564 7265 706f 2720  f b'sharedrepo' 
-000238f0: 696e 2063 7265 6174 656f 7074 733a 0a20  in createopts:. 
-00023900: 2020 2020 2020 2068 6776 6673 2e77 7269         hgvfs.wri
-00023910: 7465 2862 2773 6861 7265 6470 6174 6827  te(b'sharedpath'
-00023920: 2c20 7368 6172 6564 7061 7468 290a 0a20  , sharedpath).. 
-00023930: 2020 2069 6620 6372 6561 7465 6f70 7473     if createopts
-00023940: 2e67 6574 2862 2773 6861 7265 6469 7465  .get(b'sharedite
-00023950: 6d73 2729 3a0a 2020 2020 2020 2020 7368  ms'):.        sh
-00023960: 6172 6564 203d 2062 275c 6e27 2e6a 6f69  ared = b'\n'.joi
-00023970: 6e28 736f 7274 6564 2863 7265 6174 656f  n(sorted(createo
-00023980: 7074 735b 6227 7368 6172 6564 6974 656d  pts[b'shareditem
-00023990: 7327 5d29 2920 2b20 6227 5c6e 270a 2020  s'])) + b'\n'.  
-000239a0: 2020 2020 2020 6867 7666 732e 7772 6974        hgvfs.writ
-000239b0: 6528 6227 7368 6172 6564 272c 2073 6861  e(b'shared', sha
-000239c0: 7265 6429 0a0a 0a64 6566 2070 6f69 736f  red)...def poiso
-000239d0: 6e72 6570 6f73 6974 6f72 7928 7265 706f  nrepository(repo
-000239e0: 293a 0a20 2020 2022 2222 506f 6973 6f6e  ):.    """Poison
-000239f0: 2061 2072 6570 6f73 6974 6f72 7920 696e   a repository in
-00023a00: 7374 616e 6365 2073 6f20 6974 2063 616e  stance so it can
-00023a10: 206e 6f20 6c6f 6e67 6572 2062 6520 7573   no longer be us
-00023a20: 6564 2e22 2222 0a20 2020 2023 2050 6572  ed.""".    # Per
-00023a30: 666f 726d 2061 6e79 2063 6c65 616e 7570  form any cleanup
-00023a40: 206f 6e20 7468 6520 696e 7374 616e 6365   on the instance
-00023a50: 2e0a 2020 2020 7265 706f 2e63 6c6f 7365  ..    repo.close
-00023a60: 2829 0a0a 2020 2020 2320 4f75 7220 7374  ()..    # Our st
-00023a70: 7261 7465 6779 2069 7320 746f 2072 6570  rategy is to rep
-00023a80: 6c61 6365 2074 6865 2074 7970 6520 6f66  lace the type of
-00023a90: 2074 6865 206f 626a 6563 7420 7769 7468   the object with
-00023aa0: 206f 6e65 2074 6861 740a 2020 2020 2320   one that.    # 
-00023ab0: 6861 7320 616c 6c20 6174 7472 6962 7574  has all attribut
-00023ac0: 6520 6c6f 6f6b 7570 7320 7265 7375 6c74  e lookups result
-00023ad0: 2069 6e20 6572 726f 722e 0a20 2020 2023   in error..    #
-00023ae0: 0a20 2020 2023 2042 7574 2077 6520 6861  .    # But we ha
-00023af0: 7665 2074 6f20 616c 6c6f 7720 7468 6520  ve to allow the 
-00023b00: 636c 6f73 6528 2920 6d65 7468 6f64 2062  close() method b
-00023b10: 6563 6175 7365 2073 6f6d 6520 636f 6e73  ecause some cons
-00023b20: 7472 7563 746f 7273 0a20 2020 2023 206f  tructors.    # o
-00023b30: 6620 7265 706f 7320 6361 6c6c 2063 6c6f  f repos call clo
-00023b40: 7365 2829 206f 6e20 7265 706f 2072 6566  se() on repo ref
-00023b50: 6572 656e 6365 732e 0a20 2020 2063 6c61  erences..    cla
-00023b60: 7373 2070 6f69 736f 6e65 6472 6570 6f73  ss poisonedrepos
-00023b70: 6974 6f72 793a 0a20 2020 2020 2020 2064  itory:.        d
-00023b80: 6566 205f 5f67 6574 6174 7472 6962 7574  ef __getattribut
-00023b90: 655f 5f28 7365 6c66 2c20 6974 656d 293a  e__(self, item):
-00023ba0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00023bb0: 6974 656d 203d 3d20 2763 6c6f 7365 273a  item == 'close':
-00023bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023bd0: 2072 6574 7572 6e20 6f62 6a65 6374 2e5f   return object._
-00023be0: 5f67 6574 6174 7472 6962 7574 655f 5f28  _getattribute__(
-00023bf0: 7365 6c66 2c20 6974 656d 290a 0a20 2020  self, item)..   
-00023c00: 2020 2020 2020 2020 2072 6169 7365 2065           raise e
-00023c10: 7272 6f72 2e50 726f 6772 616d 6d69 6e67  rror.Programming
-00023c20: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00023c30: 2020 2020 2020 2062 2772 6570 6f20 696e         b'repo in
-00023c40: 7374 616e 6365 7320 7368 6f75 6c64 206e  stances should n
-00023c50: 6f74 2062 6520 7573 6564 2061 6674 6572  ot be used after
-00023c60: 2075 6e73 6861 7265 270a 2020 2020 2020   unshare'.      
-00023c70: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00023c80: 2064 6566 2063 6c6f 7365 2873 656c 6629   def close(self)
-00023c90: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-00023ca0: 7373 0a0a 2020 2020 2320 5765 206d 6179  ss..    # We may
-00023cb0: 2068 6176 6520 6120 7265 706f 7669 6577   have a repoview
-00023cc0: 2c20 7768 6963 6820 696e 7465 7263 6570  , which intercep
-00023cd0: 7473 205f 5f73 6574 6174 7472 5f5f 2e20  ts __setattr__. 
-00023ce0: 536f 2062 6520 7375 7265 0a20 2020 2023  So be sure.    #
-00023cf0: 2077 6520 6f70 6572 6174 6520 6174 2074   we operate at t
-00023d00: 6865 206c 6f77 6573 7420 6c65 7665 6c20  he lowest level 
-00023d10: 706f 7373 6962 6c65 2e0a 2020 2020 6f62  possible..    ob
-00023d20: 6a65 6374 2e5f 5f73 6574 6174 7472 5f5f  ject.__setattr__
-00023d30: 2872 6570 6f2c 2027 5f5f 636c 6173 735f  (repo, '__class_
-00023d40: 5f27 2c20 706f 6973 6f6e 6564 7265 706f  _', poisonedrepo
-00023d50: 7369 746f 7279 290a                      sitory).
+00021f70: 6966 2072 6571 2069 6e20 7265 7175 6972  if req in requir
+00021f80: 656d 656e 7473 6d6f 642e 574f 524b 494e  ementsmod.WORKIN
+00021f90: 475f 4449 525f 5245 5155 4952 454d 454e  G_DIR_REQUIREMEN
+00021fa0: 5453 3a0a 2020 2020 2020 2020 2020 2020  TS:.            
+00021fb0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00021fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021fd0: 2069 6620 7265 7120 696e 2073 6f75 7263   if req in sourc
+00021fe0: 655f 7265 7175 6972 656d 656e 7473 3a0a  e_requirements:.
+00021ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022000: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+00022010: 2020 2020 2020 2020 2020 2020 2074 6f5f               to_
+00022020: 6472 6f70 2e61 6464 2872 6571 290a 2020  drop.add(req).  
+00022030: 2020 2020 2020 2020 2020 7265 7175 6972            requir
+00022040: 656d 656e 7473 202d 3d20 746f 5f64 726f  ements -= to_dro
+00022050: 700a 2020 2020 2020 2020 2020 2020 7265  p.            re
+00022060: 7175 6972 656d 656e 7473 207c 3d20 736f  quirements |= so
+00022070: 7572 6365 5f72 6571 7569 7265 6d65 6e74  urce_requirement
+00022080: 730a 0a20 2020 2020 2020 2069 6620 6372  s..        if cr
+00022090: 6561 7465 6f70 7473 2e67 6574 2862 2773  eateopts.get(b's
+000220a0: 6861 7265 6472 656c 6174 6976 6527 293a  haredrelative'):
+000220b0: 0a20 2020 2020 2020 2020 2020 2072 6571  .            req
+000220c0: 7569 7265 6d65 6e74 732e 6164 6428 7265  uirements.add(re
+000220d0: 7175 6972 656d 656e 7473 6d6f 642e 5245  quirementsmod.RE
+000220e0: 4c41 5449 5645 5f53 4841 5245 445f 5245  LATIVE_SHARED_RE
+000220f0: 5155 4952 454d 454e 5429 0a20 2020 2020  QUIREMENT).     
+00022100: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00022110: 2020 2020 2072 6571 7569 7265 6d65 6e74       requirement
+00022120: 732e 6164 6428 7265 7175 6972 656d 656e  s.add(requiremen
+00022130: 7473 6d6f 642e 5348 4152 4544 5f52 4551  tsmod.SHARED_REQ
+00022140: 5549 5245 4d45 4e54 290a 0a20 2020 2069  UIREMENT)..    i
+00022150: 6620 7569 2e63 6f6e 6669 6762 6f6f 6c28  f ui.configbool(
+00022160: 6227 666f 726d 6174 272c 2062 2775 7365  b'format', b'use
+00022170: 2d64 6972 7374 6174 652d 7472 6163 6b65  -dirstate-tracke
+00022180: 642d 6869 6e74 2729 3a0a 2020 2020 2020  d-hint'):.      
+00022190: 2020 7665 7273 696f 6e20 3d20 7569 2e63    version = ui.c
+000221a0: 6f6e 6669 6769 6e74 2862 2766 6f72 6d61  onfigint(b'forma
+000221b0: 7427 2c20 6227 7573 652d 6469 7273 7461  t', b'use-dirsta
+000221c0: 7465 2d74 7261 636b 6564 2d68 696e 742e  te-tracked-hint.
+000221d0: 7665 7273 696f 6e27 290a 2020 2020 2020  version').      
+000221e0: 2020 6d73 6720 3d20 5f28 6222 6967 6e6f    msg = _(b"igno
+000221f0: 7269 6e67 2075 6e6b 6e6f 776e 2074 7261  ring unknown tra
+00022200: 636b 6564 206b 6579 2076 6572 7369 6f6e  cked key version
+00022210: 3a20 2564 5c6e 2229 0a20 2020 2020 2020  : %d\n").       
+00022220: 2068 696e 7420 3d20 5f28 0a20 2020 2020   hint = _(.     
+00022230: 2020 2020 2020 2062 2273 6565 2060 6867         b"see `hg
+00022240: 2068 656c 7020 636f 6e66 6967 2e66 6f72   help config.for
+00022250: 6d61 742e 7573 652d 6469 7273 7461 7465  mat.use-dirstate
+00022260: 2d74 7261 636b 6564 2d68 696e 742d 7665  -tracked-hint-ve
+00022270: 7273 696f 6e22 0a20 2020 2020 2020 2029  rsion".        )
+00022280: 0a20 2020 2020 2020 2069 6620 7665 7273  .        if vers
+00022290: 696f 6e20 213d 2031 3a0a 2020 2020 2020  ion != 1:.      
+000222a0: 2020 2020 2020 7569 2e77 6172 6e28 6d73        ui.warn(ms
+000222b0: 6720 2520 7665 7273 696f 6e2c 2068 696e  g % version, hin
+000222c0: 743d 6869 6e74 290a 2020 2020 2020 2020  t=hint).        
+000222d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000222e0: 2020 7265 7175 6972 656d 656e 7473 2e61    requirements.a
+000222f0: 6464 2872 6571 7569 7265 6d65 6e74 736d  dd(requirementsm
+00022300: 6f64 2e44 4952 5354 4154 455f 5452 4143  od.DIRSTATE_TRAC
+00022310: 4b45 445f 4849 4e54 5f56 3129 0a0a 2020  KED_HINT_V1)..  
+00022320: 2020 7265 7475 726e 2072 6571 7569 7265    return require
+00022330: 6d65 6e74 730a 0a0a 6465 6620 6368 6563  ments...def chec
+00022340: 6b72 6571 7569 7265 6d65 6e74 7363 6f6d  krequirementscom
+00022350: 7061 7428 7569 2c20 7265 7175 6972 656d  pat(ui, requirem
+00022360: 656e 7473 293a 0a20 2020 2022 2222 4368  ents):.    """Ch
+00022370: 6563 6b73 2063 6f6d 7061 7469 6269 6c69  ecks compatibili
+00022380: 7479 206f 6620 7265 706f 7369 746f 7279  ty of repository
+00022390: 2072 6571 7569 7265 6d65 6e74 7320 656e   requirements en
+000223a0: 6162 6c65 6420 616e 6420 6469 7361 626c  abled and disabl
+000223b0: 6564 2e0a 0a20 2020 2052 6574 7572 6e73  ed...    Returns
+000223c0: 2061 2073 6574 206f 6620 7265 7175 6972   a set of requir
+000223d0: 656d 656e 7473 2077 6869 6368 206e 6565  ements which nee
+000223e0: 6473 2074 6f20 6265 2064 726f 7070 6564  ds to be dropped
+000223f0: 2062 6563 6175 7365 2064 6570 656e 6465   because depende
+00022400: 6e64 0a20 2020 2072 6571 7569 7265 6d65  nd.    requireme
+00022410: 6e74 7320 6172 6520 6e6f 7420 656e 6162  nts are not enab
+00022420: 6c65 642e 2041 6c73 6f20 7761 726e 7320  led. Also warns 
+00022430: 7573 6572 7320 6162 6f75 7420 6974 2222  users about it""
+00022440: 220a 0a20 2020 2064 726f 7070 6564 203d  "..    dropped =
+00022450: 2073 6574 2829 0a0a 2020 2020 6966 2072   set()..    if r
+00022460: 6571 7569 7265 6d65 6e74 736d 6f64 2e53  equirementsmod.S
+00022470: 544f 5245 5f52 4551 5549 5245 4d45 4e54  TORE_REQUIREMENT
+00022480: 206e 6f74 2069 6e20 7265 7175 6972 656d   not in requirem
+00022490: 656e 7473 3a0a 2020 2020 2020 2020 6966  ents:.        if
+000224a0: 2072 6571 7569 7265 6d65 6e74 736d 6f64   requirementsmod
+000224b0: 2e42 4f4f 4b4d 4152 4b53 5f49 4e5f 5354  .BOOKMARKS_IN_ST
+000224c0: 4f52 455f 5245 5155 4952 454d 454e 5420  ORE_REQUIREMENT 
+000224d0: 696e 2072 6571 7569 7265 6d65 6e74 733a  in requirements:
+000224e0: 0a20 2020 2020 2020 2020 2020 2075 692e  .            ui.
+000224f0: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
+00022500: 2020 2020 2020 5f28 0a20 2020 2020 2020        _(.       
+00022510: 2020 2020 2020 2020 2020 2020 2062 2769               b'i
+00022520: 676e 6f72 696e 6720 656e 6162 6c65 6420  gnoring enabled 
+00022530: 5c27 666f 726d 6174 2e62 6f6f 6b6d 6172  \'format.bookmar
+00022540: 6b73 2d69 6e2d 7374 6f72 655c 2720 636f  ks-in-store\' co
+00022550: 6e66 6967 2027 0a20 2020 2020 2020 2020  nfig '.         
+00022560: 2020 2020 2020 2020 2020 2062 2762 6561             b'bea
+00022570: 6375 7365 2069 7420 6973 2069 6e63 6f6d  cuse it is incom
+00022580: 7061 7469 626c 6520 7769 7468 2064 6973  patible with dis
+00022590: 6162 6c65 6420 270a 2020 2020 2020 2020  abled '.        
+000225a0: 2020 2020 2020 2020 2020 2020 6227 5c27              b'\'
+000225b0: 666f 726d 6174 2e75 7365 7374 6f72 655c  format.usestore\
+000225c0: 2720 636f 6e66 6967 5c6e 270a 2020 2020  ' config\n'.    
+000225d0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000225e0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000225f0: 2020 2020 2020 2020 6472 6f70 7065 642e          dropped.
+00022600: 6164 6428 7265 7175 6972 656d 656e 7473  add(requirements
+00022610: 6d6f 642e 424f 4f4b 4d41 524b 535f 494e  mod.BOOKMARKS_IN
+00022620: 5f53 544f 5245 5f52 4551 5549 5245 4d45  _STORE_REQUIREME
+00022630: 4e54 290a 0a20 2020 2020 2020 2069 6620  NT)..        if 
+00022640: 280a 2020 2020 2020 2020 2020 2020 7265  (.            re
+00022650: 7175 6972 656d 656e 7473 6d6f 642e 5348  quirementsmod.SH
+00022660: 4152 4544 5f52 4551 5549 5245 4d45 4e54  ARED_REQUIREMENT
+00022670: 2069 6e20 7265 7175 6972 656d 656e 7473   in requirements
+00022680: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+00022690: 7265 7175 6972 656d 656e 7473 6d6f 642e  requirementsmod.
+000226a0: 5245 4c41 5449 5645 5f53 4841 5245 445f  RELATIVE_SHARED_
+000226b0: 5245 5155 4952 454d 454e 5420 696e 2072  REQUIREMENT in r
+000226c0: 6571 7569 7265 6d65 6e74 730a 2020 2020  equirements.    
+000226d0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+000226e0: 2020 2072 6169 7365 2065 7272 6f72 2e41     raise error.A
+000226f0: 626f 7274 280a 2020 2020 2020 2020 2020  bort(.          
+00022700: 2020 2020 2020 5f28 0a20 2020 2020 2020        _(.       
+00022710: 2020 2020 2020 2020 2020 2020 2062 2263               b"c
+00022720: 616e 6e6f 7420 6372 6561 7465 2073 6861  annot create sha
+00022730: 7265 6420 7265 706f 7369 746f 7279 2061  red repository a
+00022740: 7320 736f 7572 6365 2077 6173 2063 7265  s source was cre
+00022750: 6174 6564 220a 2020 2020 2020 2020 2020  ated".          
+00022760: 2020 2020 2020 2020 2020 6222 2077 6974            b" wit
+00022770: 6820 2766 6f72 6d61 742e 7573 6573 746f  h 'format.usesto
+00022780: 7265 2720 636f 6e66 6967 2064 6973 6162  re' config disab
+00022790: 6c65 6422 0a20 2020 2020 2020 2020 2020  led".           
+000227a0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000227b0: 2020 2029 0a0a 2020 2020 2020 2020 6966     )..        if
+000227c0: 2072 6571 7569 7265 6d65 6e74 736d 6f64   requirementsmod
+000227d0: 2e53 4841 5245 5341 4645 5f52 4551 5549  .SHARESAFE_REQUI
+000227e0: 5245 4d45 4e54 2069 6e20 7265 7175 6972  REMENT in requir
+000227f0: 656d 656e 7473 3a0a 2020 2020 2020 2020  ements:.        
+00022800: 2020 2020 6966 2075 692e 6861 7363 6f6e      if ui.hascon
+00022810: 6669 6728 6227 666f 726d 6174 272c 2062  fig(b'format', b
+00022820: 2775 7365 2d73 6861 7265 2d73 6166 6527  'use-share-safe'
+00022830: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00022840: 2020 206d 7367 203d 205f 280a 2020 2020     msg = _(.    
+00022850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022860: 6222 6967 6e6f 7269 6e67 2065 6e61 626c  b"ignoring enabl
+00022870: 6564 2027 666f 726d 6174 2e75 7365 2d73  ed 'format.use-s
+00022880: 6861 7265 2d73 6166 6527 2063 6f6e 6669  hare-safe' confi
+00022890: 6720 6265 6361 7573 6520 220a 2020 2020  g because ".    
+000228a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000228b0: 6222 6974 2069 7320 696e 636f 6d70 6174  b"it is incompat
+000228c0: 6962 6c65 2077 6974 6820 6469 7361 626c  ible with disabl
+000228d0: 6564 2027 666f 726d 6174 2e75 7365 7374  ed 'format.usest
+000228e0: 6f72 6527 220a 2020 2020 2020 2020 2020  ore'".          
+000228f0: 2020 2020 2020 2020 2020 6222 2063 6f6e            b" con
+00022900: 6669 675c 6e22 0a20 2020 2020 2020 2020  fig\n".         
+00022910: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00022920: 2020 2020 2020 2020 2075 692e 7761 726e           ui.warn
+00022930: 286d 7367 290a 2020 2020 2020 2020 2020  (msg).          
+00022940: 2020 6472 6f70 7065 642e 6164 6428 7265    dropped.add(re
+00022950: 7175 6972 656d 656e 7473 6d6f 642e 5348  quirementsmod.SH
+00022960: 4152 4553 4146 455f 5245 5155 4952 454d  ARESAFE_REQUIREM
+00022970: 454e 5429 0a0a 2020 2020 7265 7475 726e  ENT)..    return
+00022980: 2064 726f 7070 6564 0a0a 0a64 6566 2066   dropped...def f
+00022990: 696c 7465 726b 6e6f 776e 6372 6561 7465  ilterknowncreate
+000229a0: 6f70 7473 2875 692c 2063 7265 6174 656f  opts(ui, createo
+000229b0: 7074 7329 3a0a 2020 2020 2222 2246 696c  pts):.    """Fil
+000229c0: 7465 7273 2061 2064 6963 7420 6f66 2072  ters a dict of r
+000229d0: 6570 6f20 6372 6561 7469 6f6e 206f 7074  epo creation opt
+000229e0: 696f 6e73 2061 6761 696e 7374 206f 7074  ions against opt
+000229f0: 696f 6e73 2074 6861 7420 6172 6520 6b6e  ions that are kn
+00022a00: 6f77 6e2e 0a0a 2020 2020 5265 6365 6976  own...    Receiv
+00022a10: 6573 2061 2064 6963 7420 6f66 2072 6570  es a dict of rep
+00022a20: 6f20 6372 6561 7469 6f6e 206f 7074 696f  o creation optio
+00022a30: 6e73 2061 6e64 2072 6574 7572 6e73 2061  ns and returns a
+00022a40: 2064 6963 7420 6f66 2074 686f 7365 0a20   dict of those. 
+00022a50: 2020 206f 7074 696f 6e73 2074 6861 7420     options that 
+00022a60: 7765 2064 6f6e 2774 206b 6e6f 7720 686f  we don't know ho
+00022a70: 7720 746f 2068 616e 646c 652e 0a0a 2020  w to handle...  
+00022a80: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
+00022a90: 6973 2063 616c 6c65 6420 6173 2070 6172  is called as par
+00022aa0: 7420 6f66 2072 6570 6f73 6974 6f72 7920  t of repository 
+00022ab0: 6372 6561 7469 6f6e 2e20 4966 2074 6865  creation. If the
+00022ac0: 0a20 2020 2072 6574 7572 6e65 6420 6469  .    returned di
+00022ad0: 6374 2063 6f6e 7461 696e 7320 616e 7920  ct contains any 
+00022ae0: 6974 656d 732c 2072 6570 6f73 6974 6f72  items, repositor
+00022af0: 7920 6372 6561 7469 6f6e 2077 696c 6c20  y creation will 
+00022b00: 6e6f 740a 2020 2020 6265 2061 6c6c 6f77  not.    be allow
+00022b10: 6564 2c20 6173 2069 7420 6d65 616e 7320  ed, as it means 
+00022b20: 7468 6572 6520 7761 7320 6120 7265 7175  there was a requ
+00022b30: 6573 7420 746f 2063 7265 6174 6520 6120  est to create a 
+00022b40: 7265 706f 7369 746f 7279 0a20 2020 2077  repository.    w
+00022b50: 6974 6820 6f70 7469 6f6e 7320 6e6f 7420  ith options not 
+00022b60: 7265 636f 676e 697a 6564 2062 7920 6c6f  recognized by lo
+00022b70: 6164 6564 2063 6f64 652e 0a0a 2020 2020  aded code...    
+00022b80: 4578 7465 6e73 696f 6e73 2063 616e 2077  Extensions can w
+00022b90: 7261 7020 7468 6973 2066 756e 6374 696f  rap this functio
+00022ba0: 6e20 746f 2066 696c 7465 7220 6f75 7420  n to filter out 
+00022bb0: 6372 6561 7469 6f6e 206f 7074 696f 6e73  creation options
+00022bc0: 0a20 2020 2074 6865 7920 6b6e 6f77 2068  .    they know h
+00022bd0: 6f77 2074 6f20 6861 6e64 6c65 2e0a 2020  ow to handle..  
+00022be0: 2020 2222 220a 2020 2020 6b6e 6f77 6e20    """.    known 
+00022bf0: 3d20 7b0a 2020 2020 2020 2020 6227 6261  = {.        b'ba
+00022c00: 636b 656e 6427 2c0a 2020 2020 2020 2020  ckend',.        
+00022c10: 6227 6c66 7327 2c0a 2020 2020 2020 2020  b'lfs',.        
+00022c20: 6227 6e61 7272 6f77 6669 6c65 7327 2c0a  b'narrowfiles',.
+00022c30: 2020 2020 2020 2020 6227 7368 6172 6564          b'shared
+00022c40: 7265 706f 272c 0a20 2020 2020 2020 2062  repo',.        b
+00022c50: 2773 6861 7265 6472 656c 6174 6976 6527  'sharedrelative'
+00022c60: 2c0a 2020 2020 2020 2020 6227 7368 6172  ,.        b'shar
+00022c70: 6564 6974 656d 7327 2c0a 2020 2020 2020  editems',.      
+00022c80: 2020 6227 7368 616c 6c6f 7766 696c 6573    b'shallowfiles
+00022c90: 746f 7265 272c 0a20 2020 207d 0a0a 2020  tore',.    }..  
+00022ca0: 2020 7265 7475 726e 207b 6b3a 2076 2066    return {k: v f
+00022cb0: 6f72 206b 2c20 7620 696e 2063 7265 6174  or k, v in creat
+00022cc0: 656f 7074 732e 6974 656d 7328 2920 6966  eopts.items() if
+00022cd0: 206b 206e 6f74 2069 6e20 6b6e 6f77 6e7d   k not in known}
+00022ce0: 0a0a 0a64 6566 2063 7265 6174 6572 6570  ...def createrep
+00022cf0: 6f73 6974 6f72 7928 7569 2c20 7061 7468  ository(ui, path
+00022d00: 3a20 6279 7465 732c 2063 7265 6174 656f  : bytes, createo
+00022d10: 7074 733d 4e6f 6e65 2c20 7265 7175 6972  pts=None, requir
+00022d20: 656d 656e 7473 3d4e 6f6e 6529 3a0a 2020  ements=None):.  
+00022d30: 2020 2222 2243 7265 6174 6520 6120 6e65    """Create a ne
+00022d40: 7720 7265 706f 7369 746f 7279 2069 6e20  w repository in 
+00022d50: 6120 7666 732e 0a0a 2020 2020 6060 7061  a vfs...    ``pa
+00022d60: 7468 6060 2070 6174 6820 746f 2074 6865  th`` path to the
+00022d70: 206e 6577 2072 6570 6f27 7320 776f 726b   new repo's work
+00022d80: 696e 6720 6469 7265 6374 6f72 792e 0a20  ing directory.. 
+00022d90: 2020 2060 6063 7265 6174 656f 7074 7360     ``createopts`
+00022da0: 6020 6f70 7469 6f6e 7320 666f 7220 7468  ` options for th
+00022db0: 6520 6e65 7720 7265 706f 7369 746f 7279  e new repository
+00022dc0: 2e0a 2020 2020 6060 7265 7175 6972 656d  ..    ``requirem
+00022dd0: 656e 7460 6020 7072 6564 6566 696e 6564  ent`` predefined
+00022de0: 2073 6574 206f 6620 7265 7175 6972 656d   set of requirem
+00022df0: 656e 7473 2e0a 2020 2020 2020 2020 2020  ents..          
+00022e00: 2020 2020 2020 2020 2020 2869 6e63 6f6d            (incom
+00022e10: 7061 7469 626c 6520 7769 7468 2060 6063  patible with ``c
+00022e20: 7265 6174 656f 7074 7360 6029 0a0a 2020  reateopts``)..  
+00022e30: 2020 5468 6520 666f 6c6c 6f77 696e 6720    The following 
+00022e40: 6b65 7973 2066 6f72 2060 6063 7265 6174  keys for ``creat
+00022e50: 656f 7074 7360 6020 6172 6520 7265 636f  eopts`` are reco
+00022e60: 676e 697a 6564 3a0a 0a20 2020 2062 6163  gnized:..    bac
+00022e70: 6b65 6e64 0a20 2020 2020 2020 5468 6520  kend.       The 
+00022e80: 7374 6f72 6167 6520 6261 636b 656e 6420  storage backend 
+00022e90: 746f 2075 7365 2e0a 2020 2020 6c66 730a  to use..    lfs.
+00022ea0: 2020 2020 2020 2052 6570 6f73 6974 6f72         Repositor
+00022eb0: 7920 7769 6c6c 2062 6520 6372 6561 7465  y will be create
+00022ec0: 6420 7769 7468 2060 606c 6673 6060 2072  d with ``lfs`` r
+00022ed0: 6571 7569 7265 6d65 6e74 2e20 5468 6520  equirement. The 
+00022ee0: 6c66 7320 6578 7465 6e73 696f 6e0a 2020  lfs extension.  
+00022ef0: 2020 2020 2077 696c 6c20 6175 746f 6d61       will automa
+00022f00: 7469 6361 6c6c 7920 6265 206c 6f61 6465  tically be loade
+00022f10: 6420 7768 656e 2074 6865 2072 6570 6f73  d when the repos
+00022f20: 6974 6f72 7920 6973 2061 6363 6573 7365  itory is accesse
+00022f30: 642e 0a20 2020 206e 6172 726f 7766 696c  d..    narrowfil
+00022f40: 6573 0a20 2020 2020 2020 5365 7420 7570  es.       Set up
+00022f50: 2072 6570 6f73 6974 6f72 7920 746f 2073   repository to s
+00022f60: 7570 706f 7274 206e 6172 726f 7720 6669  upport narrow fi
+00022f70: 6c65 2073 746f 7261 6765 2e0a 2020 2020  le storage..    
+00022f80: 7368 6172 6564 7265 706f 0a20 2020 2020  sharedrepo.     
+00022f90: 2020 5265 706f 7369 746f 7279 206f 626a    Repository obj
+00022fa0: 6563 7420 6672 6f6d 2077 6869 6368 2073  ect from which s
+00022fb0: 746f 7261 6765 2073 686f 756c 6420 6265  torage should be
+00022fc0: 2073 6861 7265 642e 0a20 2020 2073 6861   shared..    sha
+00022fd0: 7265 6472 656c 6174 6976 650a 2020 2020  redrelative.    
+00022fe0: 2020 2042 6f6f 6c65 616e 2069 6e64 6963     Boolean indic
+00022ff0: 6174 696e 6720 6966 2074 6865 2070 6174  ating if the pat
+00023000: 6820 746f 2074 6865 2073 6861 7265 6420  h to the shared 
+00023010: 7265 706f 2073 686f 756c 6420 6265 0a20  repo should be. 
+00023020: 2020 2020 2020 7374 6f72 6564 2061 7320        stored as 
+00023030: 7265 6c61 7469 7665 2e20 4279 2064 6566  relative. By def
+00023040: 6175 6c74 2c20 7468 6520 706f 696e 7465  ault, the pointe
+00023050: 7220 746f 2074 6865 2022 7061 7265 6e74  r to the "parent
+00023060: 2220 7265 706f 0a20 2020 2020 2020 6973  " repo.       is
+00023070: 2073 746f 7265 6420 6173 2061 6e20 6162   stored as an ab
+00023080: 736f 6c75 7465 2070 6174 682e 0a20 2020  solute path..   
+00023090: 2073 6861 7265 6469 7465 6d73 0a20 2020   shareditems.   
+000230a0: 2020 2020 5365 7420 6f66 2069 7465 6d73      Set of items
+000230b0: 2074 6f20 7368 6172 6520 746f 2074 6865   to share to the
+000230c0: 206e 6577 2072 6570 6f73 6974 6f72 7920   new repository 
+000230d0: 2869 6e20 6164 6469 7469 6f6e 2074 6f20  (in addition to 
+000230e0: 7374 6f72 6167 6529 2e0a 2020 2020 7368  storage)..    sh
+000230f0: 616c 6c6f 7766 696c 6573 746f 7265 0a20  allowfilestore. 
+00023100: 2020 2020 2020 496e 6469 6361 7465 7320        Indicates 
+00023110: 7468 6174 2073 746f 7261 6765 2066 6f72  that storage for
+00023120: 2066 696c 6573 2073 686f 756c 6420 6265   files should be
+00023130: 2073 6861 6c6c 6f77 2028 6e6f 7420 616c   shallow (not al
+00023140: 6c20 616e 6365 7374 6f72 0a20 2020 2020  l ancestor.     
+00023150: 2020 7265 7669 7369 6f6e 7320 6172 6520    revisions are 
+00023160: 6b6e 6f77 6e29 2e0a 2020 2020 2222 220a  known)..    """.
+00023170: 0a20 2020 2069 6620 7265 7175 6972 656d  .    if requirem
+00023180: 656e 7473 2069 7320 6e6f 7420 4e6f 6e65  ents is not None
+00023190: 3a0a 2020 2020 2020 2020 6966 2063 7265  :.        if cre
+000231a0: 6174 656f 7074 7320 6973 206e 6f74 204e  ateopts is not N
+000231b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000231c0: 206d 7367 203d 2062 2763 616e 6e6f 7420   msg = b'cannot 
+000231d0: 7370 6563 6966 7920 626f 7468 2063 7265  specify both cre
+000231e0: 6174 656f 7074 7320 616e 6420 7265 7175  ateopts and requ
+000231f0: 6972 656d 656e 7473 270a 2020 2020 2020  irements'.      
+00023200: 2020 2020 2020 7261 6973 6520 6572 726f        raise erro
+00023210: 722e 5072 6f67 7261 6d6d 696e 6745 7272  r.ProgrammingErr
+00023220: 6f72 286d 7367 290a 2020 2020 2020 2020  or(msg).        
+00023230: 6372 6561 7465 6f70 7473 203d 207b 7d0a  createopts = {}.
+00023240: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00023250: 2020 6372 6561 7465 6f70 7473 203d 2064    createopts = d
+00023260: 6566 6175 6c74 6372 6561 7465 6f70 7473  efaultcreateopts
+00023270: 2875 692c 2063 7265 6174 656f 7074 733d  (ui, createopts=
+00023280: 6372 6561 7465 6f70 7473 290a 0a20 2020  createopts)..   
+00023290: 2020 2020 2075 6e6b 6e6f 776e 6f70 7473       unknownopts
+000232a0: 203d 2066 696c 7465 726b 6e6f 776e 6372   = filterknowncr
+000232b0: 6561 7465 6f70 7473 2875 692c 2063 7265  eateopts(ui, cre
+000232c0: 6174 656f 7074 7329 0a0a 2020 2020 2020  ateopts)..      
+000232d0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+000232e0: 6e63 6528 756e 6b6e 6f77 6e6f 7074 732c  nce(unknownopts,
+000232f0: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+00023300: 2020 2020 7261 6973 6520 6572 726f 722e      raise error.
+00023310: 5072 6f67 7261 6d6d 696e 6745 7272 6f72  ProgrammingError
+00023320: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00023330: 2020 6227 6669 6c74 6572 6b6e 6f77 6e63    b'filterknownc
+00023340: 7265 6174 656f 7074 7328 2920 6469 6420  reateopts() did 
+00023350: 6e6f 7420 7265 7475 726e 2061 2064 6963  not return a dic
+00023360: 7427 0a20 2020 2020 2020 2020 2020 2029  t'.            )
+00023370: 0a0a 2020 2020 2020 2020 6966 2075 6e6b  ..        if unk
+00023380: 6e6f 776e 6f70 7473 3a0a 2020 2020 2020  nownopts:.      
+00023390: 2020 2020 2020 7261 6973 6520 6572 726f        raise erro
+000233a0: 722e 4162 6f72 7428 0a20 2020 2020 2020  r.Abort(.       
+000233b0: 2020 2020 2020 2020 205f 280a 2020 2020           _(.    
+000233c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000233d0: 6227 756e 6162 6c65 2074 6f20 6372 6561  b'unable to crea
+000233e0: 7465 2072 6570 6f73 6974 6f72 7920 6265  te repository be
+000233f0: 6361 7573 6520 6f66 2075 6e6b 6e6f 776e  cause of unknown
+00023400: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+00023410: 2020 2020 2020 2062 2763 7265 6174 696f         b'creatio
+00023420: 6e20 6f70 7469 6f6e 3a20 2573 270a 2020  n option: %s'.  
+00023430: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00023440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023450: 2520 6227 2c20 272e 6a6f 696e 2873 6f72  % b', '.join(sor
+00023460: 7465 6428 756e 6b6e 6f77 6e6f 7074 7329  ted(unknownopts)
+00023470: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00023480: 2020 2068 696e 743d 5f28 6227 6973 2061     hint=_(b'is a
+00023490: 2072 6571 7569 7265 6420 6578 7465 6e73   required extens
+000234a0: 696f 6e20 6e6f 7420 6c6f 6164 6564 3f27  ion not loaded?'
+000234b0: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
+000234c0: 0a0a 2020 2020 2020 2020 7265 7175 6972  ..        requir
+000234d0: 656d 656e 7473 203d 206e 6577 7265 706f  ements = newrepo
+000234e0: 7265 7175 6972 656d 656e 7473 2875 692c  requirements(ui,
+000234f0: 2063 7265 6174 656f 7074 733d 6372 6561   createopts=crea
+00023500: 7465 6f70 7473 290a 2020 2020 2020 2020  teopts).        
+00023510: 7265 7175 6972 656d 656e 7473 202d 3d20  requirements -= 
+00023520: 6368 6563 6b72 6571 7569 7265 6d65 6e74  checkrequirement
+00023530: 7363 6f6d 7061 7428 7569 2c20 7265 7175  scompat(ui, requ
+00023540: 6972 656d 656e 7473 290a 0a20 2020 2077  irements)..    w
+00023550: 6469 7276 6673 203d 2076 6673 6d6f 642e  dirvfs = vfsmod.
+00023560: 7666 7328 7061 7468 2c20 6578 7061 6e64  vfs(path, expand
+00023570: 7061 7468 3d54 7275 652c 2072 6561 6c70  path=True, realp
+00023580: 6174 683d 5472 7565 290a 0a20 2020 2068  ath=True)..    h
+00023590: 6776 6673 203d 2076 6673 6d6f 642e 7666  gvfs = vfsmod.vf
+000235a0: 7328 7764 6972 7666 732e 6a6f 696e 2862  s(wdirvfs.join(b
+000235b0: 272e 6867 2729 290a 2020 2020 6966 2068  '.hg')).    if h
+000235c0: 6776 6673 2e65 7869 7374 7328 293a 0a20  gvfs.exists():. 
+000235d0: 2020 2020 2020 2072 6169 7365 2065 7272         raise err
+000235e0: 6f72 2e52 6570 6f45 7272 6f72 285f 2862  or.RepoError(_(b
+000235f0: 2772 6570 6f73 6974 6f72 7920 2573 2061  'repository %s a
+00023600: 6c72 6561 6479 2065 7869 7374 7327 2920  lready exists') 
+00023610: 2520 7061 7468 290a 0a20 2020 2069 6620  % path)..    if 
+00023620: 6227 7368 6172 6564 7265 706f 2720 696e  b'sharedrepo' in
+00023630: 2063 7265 6174 656f 7074 733a 0a20 2020   createopts:.   
+00023640: 2020 2020 2073 6861 7265 6470 6174 6820       sharedpath 
+00023650: 3d20 6372 6561 7465 6f70 7473 5b62 2773  = createopts[b's
+00023660: 6861 7265 6472 6570 6f27 5d2e 7368 6172  haredrepo'].shar
+00023670: 6564 7061 7468 0a0a 2020 2020 2020 2020  edpath..        
+00023680: 6966 2063 7265 6174 656f 7074 732e 6765  if createopts.ge
+00023690: 7428 6227 7368 6172 6564 7265 6c61 7469  t(b'sharedrelati
+000236a0: 7665 2729 3a0a 2020 2020 2020 2020 2020  ve'):.          
+000236b0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+000236c0: 2020 2020 2020 2073 6861 7265 6470 6174         sharedpat
+000236d0: 6820 3d20 6f73 2e70 6174 682e 7265 6c70  h = os.path.relp
+000236e0: 6174 6828 7368 6172 6564 7061 7468 2c20  ath(sharedpath, 
+000236f0: 6867 7666 732e 6261 7365 290a 2020 2020  hgvfs.base).    
+00023700: 2020 2020 2020 2020 2020 2020 7368 6172              shar
+00023710: 6564 7061 7468 203d 2075 7469 6c2e 7063  edpath = util.pc
+00023720: 6f6e 7665 7274 2873 6861 7265 6470 6174  onvert(sharedpat
+00023730: 6829 0a20 2020 2020 2020 2020 2020 2065  h).            e
+00023740: 7863 6570 7420 2849 4f45 7272 6f72 2c20  xcept (IOError, 
+00023750: 5661 6c75 6545 7272 6f72 2920 6173 2065  ValueError) as e
+00023760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00023770: 2020 2320 5661 6c75 6545 7272 6f72 2069    # ValueError i
+00023780: 7320 7261 6973 6564 206f 6e20 5769 6e64  s raised on Wind
+00023790: 6f77 7320 6966 2074 6865 2064 7269 7665  ows if the drive
+000237a0: 206c 6574 7465 7273 2064 6966 6665 720a   letters differ.
+000237b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000237c0: 2320 6f6e 2065 6163 6820 7061 7468 2e0a  # on each path..
+000237d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000237e0: 7261 6973 6520 6572 726f 722e 4162 6f72  raise error.Abor
+000237f0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00023800: 2020 2020 2020 205f 2862 2763 616e 6e6f         _(b'canno
+00023810: 7420 6361 6c63 756c 6174 6520 7265 6c61  t calculate rela
+00023820: 7469 7665 2070 6174 6827 292c 0a20 2020  tive path'),.   
+00023830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023840: 2068 696e 743d 7374 7269 6e67 7574 696c   hint=stringutil
+00023850: 2e66 6f72 6365 6279 7465 7374 7228 6529  .forcebytestr(e)
+00023860: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00023870: 2020 290a 0a20 2020 2069 6620 6e6f 7420    )..    if not 
+00023880: 7764 6972 7666 732e 6578 6973 7473 2829  wdirvfs.exists()
+00023890: 3a0a 2020 2020 2020 2020 7764 6972 7666  :.        wdirvf
+000238a0: 732e 6d61 6b65 6469 7273 2829 0a0a 2020  s.makedirs()..  
+000238b0: 2020 6867 7666 732e 6d61 6b65 6469 7228    hgvfs.makedir(
+000238c0: 6e6f 7469 6e64 6578 6564 3d54 7275 6529  notindexed=True)
+000238d0: 0a20 2020 2069 6620 6227 7368 6172 6564  .    if b'shared
+000238e0: 7265 706f 2720 6e6f 7420 696e 2063 7265  repo' not in cre
+000238f0: 6174 656f 7074 733a 0a20 2020 2020 2020  ateopts:.       
+00023900: 2068 6776 6673 2e6d 6b64 6972 2862 2763   hgvfs.mkdir(b'c
+00023910: 6163 6865 2729 0a20 2020 2068 6776 6673  ache').    hgvfs
+00023920: 2e6d 6b64 6972 2862 2777 6361 6368 6527  .mkdir(b'wcache'
+00023930: 290a 0a20 2020 2068 6173 5f73 746f 7265  )..    has_store
+00023940: 203d 2072 6571 7569 7265 6d65 6e74 736d   = requirementsm
+00023950: 6f64 2e53 544f 5245 5f52 4551 5549 5245  od.STORE_REQUIRE
+00023960: 4d45 4e54 2069 6e20 7265 7175 6972 656d  MENT in requirem
+00023970: 656e 7473 0a20 2020 2069 6620 6861 735f  ents.    if has_
+00023980: 7374 6f72 6520 616e 6420 6227 7368 6172  store and b'shar
+00023990: 6564 7265 706f 2720 6e6f 7420 696e 2063  edrepo' not in c
+000239a0: 7265 6174 656f 7074 733a 0a20 2020 2020  reateopts:.     
+000239b0: 2020 2068 6776 6673 2e6d 6b64 6972 2862     hgvfs.mkdir(b
+000239c0: 2773 746f 7265 2729 0a0a 2020 2020 2020  'store')..      
+000239d0: 2020 2320 5765 2063 7265 6174 6520 616e    # We create an
+000239e0: 2069 6e76 616c 6964 2063 6861 6e67 656c   invalid changel
+000239f0: 6f67 206f 7574 7369 6465 2074 6865 2073  og outside the s
+00023a00: 746f 7265 2073 6f20 7665 7279 206f 6c64  tore so very old
+00023a10: 0a20 2020 2020 2020 2023 204d 6572 6375  .        # Mercu
+00023a20: 7269 616c 2076 6572 7369 6f6e 7320 2877  rial versions (w
+00023a30: 6869 6368 2064 6964 6e27 7420 6b6e 6f77  hich didn't know
+00023a40: 2061 626f 7574 2074 6865 2072 6571 7569   about the requi
+00023a50: 7265 6d65 6e74 730a 2020 2020 2020 2020  rements.        
+00023a60: 2320 6669 6c65 2920 656e 636f 756e 7465  # file) encounte
+00023a70: 7220 616e 2065 7272 6f72 206f 6e20 7265  r an error on re
+00023a80: 6164 696e 6720 7468 6520 6368 616e 6765  ading the change
+00023a90: 6c6f 672e 2054 6869 730a 2020 2020 2020  log. This.      
+00023aa0: 2020 2320 6566 6665 6374 6976 656c 7920    # effectively 
+00023ab0: 6c6f 636b 7320 6f75 7420 6f6c 6420 636c  locks out old cl
+00023ac0: 6965 6e74 7320 616e 6420 7072 6576 656e  ients and preven
+00023ad0: 7473 2074 6865 6d20 6672 6f6d 0a20 2020  ts them from.   
+00023ae0: 2020 2020 2023 206d 7563 6b69 6e67 2077       # mucking w
+00023af0: 6974 6820 6120 7265 706f 2069 6e20 616e  ith a repo in an
+00023b00: 2075 6e6b 6e6f 776e 2066 6f72 6d61 742e   unknown format.
+00023b10: 0a20 2020 2020 2020 2023 0a20 2020 2020  .        #.     
+00023b20: 2020 2023 2054 6865 2072 6576 6c6f 6720     # The revlog 
+00023b30: 6865 6164 6572 2068 6173 2076 6572 7369  header has versi
+00023b40: 6f6e 2036 3535 3335 2c20 7768 6963 6820  on 65535, which 
+00023b50: 776f 6e27 7420 6265 2072 6563 6f67 6e69  won't be recogni
+00023b60: 7a65 6420 6279 0a20 2020 2020 2020 2023  zed by.        #
+00023b70: 2073 7563 6820 6f6c 6420 636c 6965 6e74   such old client
+00023b80: 732e 0a20 2020 2020 2020 2068 6776 6673  s..        hgvfs
+00023b90: 2e61 7070 656e 6428 0a20 2020 2020 2020  .append(.       
+00023ba0: 2020 2020 2062 2730 3063 6861 6e67 656c       b'00changel
+00023bb0: 6f67 2e69 272c 0a20 2020 2020 2020 2020  og.i',.         
+00023bc0: 2020 2062 275c 305c 305c 7846 465c 7846     b'\0\0\xFF\xF
+00023bd0: 4620 6475 6d6d 7920 6368 616e 6765 6c6f  F dummy changelo
+00023be0: 6720 746f 2070 7265 7665 6e74 2075 7369  g to prevent usi
+00023bf0: 6e67 2074 6865 206f 6c64 2072 6570 6f20  ng the old repo 
+00023c00: 270a 2020 2020 2020 2020 2020 2020 6227  '.            b'
+00023c10: 6c61 796f 7574 272c 0a20 2020 2020 2020  layout',.       
+00023c20: 2029 0a0a 2020 2020 2320 4669 6c74 6572   )..    # Filter
+00023c30: 2074 6865 2072 6571 7569 7265 6d65 6e74   the requirement
+00023c40: 7320 696e 746f 2077 6f72 6b69 6e67 2063  s into working c
+00023c50: 6f70 7920 616e 6420 7374 6f72 6520 6f6e  opy and store on
+00023c60: 6573 0a20 2020 2077 6372 6571 2c20 7374  es.    wcreq, st
+00023c70: 6f72 6572 6571 203d 2073 636d 7574 696c  orereq = scmutil
+00023c80: 2e66 696c 7465 7272 6571 7569 7265 6d65  .filterrequireme
+00023c90: 6e74 7328 7265 7175 6972 656d 656e 7473  nts(requirements
+00023ca0: 290a 2020 2020 2320 7772 6974 6520 776f  ).    # write wo
+00023cb0: 726b 696e 6720 636f 7079 206f 6e65 730a  rking copy ones.
+00023cc0: 2020 2020 7363 6d75 7469 6c2e 7772 6974      scmutil.writ
+00023cd0: 6572 6571 7569 7265 7328 6867 7666 732c  erequires(hgvfs,
+00023ce0: 2077 6372 6571 290a 2020 2020 2320 4966   wcreq).    # If
+00023cf0: 2074 6865 7265 2061 7265 2073 746f 7265   there are store
+00023d00: 2072 6571 7569 7265 6d65 6e74 7320 616e   requirements an
+00023d10: 6420 7468 6520 6375 7272 656e 7420 7265  d the current re
+00023d20: 706f 7369 746f 7279 0a20 2020 2023 2069  pository.    # i
+00023d30: 7320 6e6f 7420 6120 7368 6172 6564 206f  s not a shared o
+00023d40: 6e65 2c20 7772 6974 6520 7374 6f72 6564  ne, write stored
+00023d50: 2072 6571 7569 7265 6d65 6e74 730a 2020   requirements.  
+00023d60: 2020 2320 466f 7220 6e65 7720 7368 6172    # For new shar
+00023d70: 6564 2072 6570 6f73 6974 6f72 792c 2077  ed repository, w
+00023d80: 6520 646f 6e27 7420 6e65 6564 2074 6f20  e don't need to 
+00023d90: 7772 6974 6520 7468 6520 7374 6f72 650a  write the store.
+00023da0: 2020 2020 2320 7265 7175 6972 656d 656e      # requiremen
+00023db0: 7473 2061 7320 7468 6579 2061 7265 2061  ts as they are a
+00023dc0: 6c72 6561 6479 2070 7265 7365 6e74 2069  lready present i
+00023dd0: 6e20 7374 6f72 6520 7265 7175 6972 6573  n store requires
+00023de0: 0a20 2020 2069 6620 7374 6f72 6572 6571  .    if storereq
+00023df0: 2061 6e64 2062 2773 6861 7265 6472 6570   and b'sharedrep
+00023e00: 6f27 206e 6f74 2069 6e20 6372 6561 7465  o' not in create
+00023e10: 6f70 7473 3a0a 2020 2020 2020 2020 7374  opts:.        st
+00023e20: 6f72 6576 6673 203d 2076 6673 6d6f 642e  orevfs = vfsmod.
+00023e30: 7666 7328 6867 7666 732e 6a6f 696e 2862  vfs(hgvfs.join(b
+00023e40: 2773 746f 7265 2729 2c20 6361 6368 6561  'store'), cachea
+00023e50: 7564 6974 6564 3d54 7275 6529 0a20 2020  udited=True).   
+00023e60: 2020 2020 2073 636d 7574 696c 2e77 7269       scmutil.wri
+00023e70: 7465 7265 7175 6972 6573 2873 746f 7265  terequires(store
+00023e80: 7666 732c 2073 746f 7265 7265 7129 0a0a  vfs, storereq)..
+00023e90: 2020 2020 2320 5772 6974 6520 6f75 7420      # Write out 
+00023ea0: 6669 6c65 2074 656c 6c69 6e67 2072 6561  file telling rea
+00023eb0: 6465 7273 2077 6865 7265 2074 6f20 6669  ders where to fi
+00023ec0: 6e64 2074 6865 2073 6861 7265 6420 7374  nd the shared st
+00023ed0: 6f72 652e 0a20 2020 2069 6620 6227 7368  ore..    if b'sh
+00023ee0: 6172 6564 7265 706f 2720 696e 2063 7265  aredrepo' in cre
+00023ef0: 6174 656f 7074 733a 0a20 2020 2020 2020  ateopts:.       
+00023f00: 2068 6776 6673 2e77 7269 7465 2862 2773   hgvfs.write(b's
+00023f10: 6861 7265 6470 6174 6827 2c20 7368 6172  haredpath', shar
+00023f20: 6564 7061 7468 290a 0a20 2020 2069 6620  edpath)..    if 
+00023f30: 6372 6561 7465 6f70 7473 2e67 6574 2862  createopts.get(b
+00023f40: 2773 6861 7265 6469 7465 6d73 2729 3a0a  'shareditems'):.
+00023f50: 2020 2020 2020 2020 7368 6172 6564 203d          shared =
+00023f60: 2062 275c 6e27 2e6a 6f69 6e28 736f 7274   b'\n'.join(sort
+00023f70: 6564 2863 7265 6174 656f 7074 735b 6227  ed(createopts[b'
+00023f80: 7368 6172 6564 6974 656d 7327 5d29 2920  shareditems'])) 
+00023f90: 2b20 6227 5c6e 270a 2020 2020 2020 2020  + b'\n'.        
+00023fa0: 6867 7666 732e 7772 6974 6528 6227 7368  hgvfs.write(b'sh
+00023fb0: 6172 6564 272c 2073 6861 7265 6429 0a0a  ared', shared)..
+00023fc0: 0a64 6566 2070 6f69 736f 6e72 6570 6f73  .def poisonrepos
+00023fd0: 6974 6f72 7928 7265 706f 293a 0a20 2020  itory(repo):.   
+00023fe0: 2022 2222 506f 6973 6f6e 2061 2072 6570   """Poison a rep
+00023ff0: 6f73 6974 6f72 7920 696e 7374 616e 6365  ository instance
+00024000: 2073 6f20 6974 2063 616e 206e 6f20 6c6f   so it can no lo
+00024010: 6e67 6572 2062 6520 7573 6564 2e22 2222  nger be used."""
+00024020: 0a20 2020 2023 2050 6572 666f 726d 2061  .    # Perform a
+00024030: 6e79 2063 6c65 616e 7570 206f 6e20 7468  ny cleanup on th
+00024040: 6520 696e 7374 616e 6365 2e0a 2020 2020  e instance..    
+00024050: 7265 706f 2e63 6c6f 7365 2829 0a0a 2020  repo.close()..  
+00024060: 2020 2320 4f75 7220 7374 7261 7465 6779    # Our strategy
+00024070: 2069 7320 746f 2072 6570 6c61 6365 2074   is to replace t
+00024080: 6865 2074 7970 6520 6f66 2074 6865 206f  he type of the o
+00024090: 626a 6563 7420 7769 7468 206f 6e65 2074  bject with one t
+000240a0: 6861 740a 2020 2020 2320 6861 7320 616c  hat.    # has al
+000240b0: 6c20 6174 7472 6962 7574 6520 6c6f 6f6b  l attribute look
+000240c0: 7570 7320 7265 7375 6c74 2069 6e20 6572  ups result in er
+000240d0: 726f 722e 0a20 2020 2023 0a20 2020 2023  ror..    #.    #
+000240e0: 2042 7574 2077 6520 6861 7665 2074 6f20   But we have to 
+000240f0: 616c 6c6f 7720 7468 6520 636c 6f73 6528  allow the close(
+00024100: 2920 6d65 7468 6f64 2062 6563 6175 7365  ) method because
+00024110: 2073 6f6d 6520 636f 6e73 7472 7563 746f   some constructo
+00024120: 7273 0a20 2020 2023 206f 6620 7265 706f  rs.    # of repo
+00024130: 7320 6361 6c6c 2063 6c6f 7365 2829 206f  s call close() o
+00024140: 6e20 7265 706f 2072 6566 6572 656e 6365  n repo reference
+00024150: 732e 0a20 2020 2063 6c61 7373 2070 6f69  s..    class poi
+00024160: 736f 6e65 6472 6570 6f73 6974 6f72 793a  sonedrepository:
+00024170: 0a20 2020 2020 2020 2064 6566 205f 5f67  .        def __g
+00024180: 6574 6174 7472 6962 7574 655f 5f28 7365  etattribute__(se
+00024190: 6c66 2c20 6974 656d 293a 0a20 2020 2020  lf, item):.     
+000241a0: 2020 2020 2020 2069 6620 6974 656d 203d         if item =
+000241b0: 3d20 2763 6c6f 7365 273a 0a20 2020 2020  = 'close':.     
+000241c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000241d0: 6e20 6f62 6a65 6374 2e5f 5f67 6574 6174  n object.__getat
+000241e0: 7472 6962 7574 655f 5f28 7365 6c66 2c20  tribute__(self, 
+000241f0: 6974 656d 290a 0a20 2020 2020 2020 2020  item)..         
+00024200: 2020 2072 6169 7365 2065 7272 6f72 2e50     raise error.P
+00024210: 726f 6772 616d 6d69 6e67 4572 726f 7228  rogrammingError(
+00024220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024230: 2062 2772 6570 6f20 696e 7374 616e 6365   b'repo instance
+00024240: 7320 7368 6f75 6c64 206e 6f74 2062 6520  s should not be 
+00024250: 7573 6564 2061 6674 6572 2075 6e73 6861  used after unsha
+00024260: 7265 270a 2020 2020 2020 2020 2020 2020  re'.            
+00024270: 290a 0a20 2020 2020 2020 2064 6566 2063  )..        def c
+00024280: 6c6f 7365 2873 656c 6629 3a0a 2020 2020  lose(self):.    
+00024290: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
+000242a0: 2020 2320 5765 206d 6179 2068 6176 6520    # We may have 
+000242b0: 6120 7265 706f 7669 6577 2c20 7768 6963  a repoview, whic
+000242c0: 6820 696e 7465 7263 6570 7473 205f 5f73  h intercepts __s
+000242d0: 6574 6174 7472 5f5f 2e20 536f 2062 6520  etattr__. So be 
+000242e0: 7375 7265 0a20 2020 2023 2077 6520 6f70  sure.    # we op
+000242f0: 6572 6174 6520 6174 2074 6865 206c 6f77  erate at the low
+00024300: 6573 7420 6c65 7665 6c20 706f 7373 6962  est level possib
+00024310: 6c65 2e0a 2020 2020 6f62 6a65 6374 2e5f  le..    object._
+00024320: 5f73 6574 6174 7472 5f5f 2872 6570 6f2c  _setattr__(repo,
+00024330: 2027 5f5f 636c 6173 735f 5f27 2c20 706f   '__class__', po
+00024340: 6973 6f6e 6564 7265 706f 7369 746f 7279  isonedrepository
+00024350: 290a                                     ).
```

### Comparing `mercurial-6.4rc0/mercurial/lock.py` & `mercurial-6.5rc0/mercurial/lock.py`

 * *Files 0% similar despite different names*

```diff
@@ -72,19 +72,19 @@
         else:
             raiseinterrupt(num)
 
     try:
         # save handlers first so they can be restored even if a setup is
         # interrupted between signal.signal() and orighandlers[] =.
         for name in [
-            b'CTRL_C_EVENT',
-            b'SIGINT',
-            b'SIGBREAK',
-            b'SIGHUP',
-            b'SIGTERM',
+            'CTRL_C_EVENT',
+            'SIGINT',
+            'SIGBREAK',
+            'SIGHUP',
+            'SIGTERM',
         ]:
             num = getattr(signal, name, None)
             if num and num not in orighandlers:
                 orighandlers[num] = signal.getsignal(num)
         try:
             for num in orighandlers:
                 signal.signal(num, catchterm)
```

### Comparing `mercurial-6.4rc0/mercurial/logcmdutil.py` & `mercurial-6.5rc0/mercurial/logcmdutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/logexchange.py` & `mercurial-6.5rc0/mercurial/logexchange.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/loggingutil.py` & `mercurial-6.5rc0/mercurial/loggingutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/lsprof.py` & `mercurial-6.5rc0/mercurial/lsprof.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/lsprofcalltree.py` & `mercurial-6.5rc0/mercurial/lsprofcalltree.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/mail.py` & `mercurial-6.5rc0/mercurial/mail.py`

 * *Files 1% similar despite different names*

```diff
@@ -50,17 +50,17 @@
     """
 
     def __init__(self, ui, host=None, **kwargs):
         smtplib.SMTP.__init__(self, **kwargs)
         self._ui = ui
         self._host = host
 
-    def starttls(self, keyfile=None, certfile=None):
+    def starttls(self, keyfile=None, certfile=None, context=None):
         if not self.has_extn("starttls"):
-            msg = b"STARTTLS extension not supported by server"
+            msg = "STARTTLS extension not supported by server"
             raise smtplib.SMTPException(msg)
         (resp, reply) = self.docmd("STARTTLS")
         if resp == 220:
             self.sock = sslutil.wrapsocket(
                 self.sock,
                 keyfile,
                 certfile,
```

### Comparing `mercurial-6.4rc0/mercurial/manifest.py` & `mercurial-6.5rc0/mercurial/manifest.py`

 * *Files 1% similar despite different names*

```diff
@@ -1613,17 +1613,26 @@
             upperboundcomp=MAXCOMPRESSION,
             persistentnodemap=opener.options.get(b'persistent-nodemap', False),
         )
 
         self.index = self._revlog.index
         self._generaldelta = self._revlog._generaldelta
 
+    def get_revlog(self):
+        """return an actual revlog instance if any
+
+        This exist because a lot of code leverage the fact the underlying
+        storage is a revlog for optimization, so giving simple way to access
+        the revlog instance helps such code.
+        """
+        return self._revlog
+
     def _setupmanifestcachehooks(self, repo):
         """Persist the manifestfulltextcache on lock release"""
-        if not util.safehasattr(repo, b'_wlockref'):
+        if not util.safehasattr(repo, '_wlockref'):
             return
 
         self._fulltextcache._opener = repo.wcachevfs
         if repo._currentlock(repo._wlockref) is None:
             return
 
         reporef = weakref.ref(repo)
```

### Comparing `mercurial-6.4rc0/mercurial/match.py` & `mercurial-6.5rc0/mercurial/match.py`

 * *Files 2% similar despite different names*

```diff
@@ -26,14 +26,15 @@
 
 rustmod = policy.importrust('dirstate')
 
 allpatternkinds = (
     b're',
     b'glob',
     b'path',
+    b'filepath',
     b'relglob',
     b'relpath',
     b'relre',
     b'rootglob',
     b'listfile',
     b'listfile0',
     b'set',
@@ -177,14 +178,16 @@
         normalizes the given patterns to the case in the filesystem
 
     a pattern is one of:
     'glob:<glob>' - a glob relative to cwd
     're:<regexp>' - a regular expression
     'path:<path>' - a path relative to repository root, which is matched
                     recursively
+    'filepath:<path>' - an exact path to a single file, relative to the
+                        repository root
     'rootfilesin:<path>' - a path relative to repository root, which is
                     matched non-recursively (will not match subdirectories)
     'relglob:<glob>' - an unrooted glob (*.c matches C files in all dirs)
     'relpath:<path>' - a path relative to cwd
     'relre:<regexp>' - a regexp that needn't match the start of a name
     'set:<fileset>' - a fileset expression
     'include:<path>' - a file of patterns to read and include
@@ -192,42 +195,42 @@
                           the same directory
     '<something>' - a pattern of the specified default type
 
     >>> def _match(root, *args, **kwargs):
     ...     return match(util.localpath(root), *args, **kwargs)
 
     Usually a patternmatcher is returned:
-    >>> _match(b'/foo', b'.', [b're:.*\.c$', b'path:foo/a', b'*.py'])
-    <patternmatcher patterns='.*\\.c$|foo/a(?:/|$)|[^/]*\\.py$'>
+    >>> _match(b'/foo', b'.', [br're:.*\.c$', b'path:foo/a', b'*.py'])
+    <patternmatcher patterns='[^/]*\\.py$|foo/a(?:/|$)|.*\\.c$'>
 
     Combining 'patterns' with 'include' (resp. 'exclude') gives an
     intersectionmatcher (resp. a differencematcher):
-    >>> type(_match(b'/foo', b'.', [b're:.*\.c$'], include=[b'path:lib']))
+    >>> type(_match(b'/foo', b'.', [br're:.*\.c$'], include=[b'path:lib']))
     <class 'mercurial.match.intersectionmatcher'>
-    >>> type(_match(b'/foo', b'.', [b're:.*\.c$'], exclude=[b'path:build']))
+    >>> type(_match(b'/foo', b'.', [br're:.*\.c$'], exclude=[b'path:build']))
     <class 'mercurial.match.differencematcher'>
 
     Notice that, if 'patterns' is empty, an alwaysmatcher is returned:
     >>> _match(b'/foo', b'.', [])
     <alwaysmatcher>
 
     The 'default' argument determines which kind of pattern is assumed if a
     pattern has no prefix:
-    >>> _match(b'/foo', b'.', [b'.*\.c$'], default=b're')
+    >>> _match(b'/foo', b'.', [br'.*\.c$'], default=b're')
     <patternmatcher patterns='.*\\.c$'>
     >>> _match(b'/foo', b'.', [b'main.py'], default=b'relpath')
     <patternmatcher patterns='main\\.py(?:/|$)'>
     >>> _match(b'/foo', b'.', [b'main.py'], default=b're')
     <patternmatcher patterns='main.py'>
 
     The primary use of matchers is to check whether a value (usually a file
     name) matches againset one of the patterns given at initialization. There
     are two ways of doing this check.
 
-    >>> m = _match(b'/foo', b'', [b're:.*\.c$', b'relpath:a'])
+    >>> m = _match(b'/foo', b'', [br're:.*\.c$', b'relpath:a'])
 
     1. Calling the matcher with a file name returns True if any pattern
     matches that file name:
     >>> m(b'a')
     True
     >>> m(b'main.c')
     True
@@ -330,18 +333,26 @@
     return m
 
 
 def _donormalize(patterns, default, root, cwd, auditor=None, warn=None):
     """Convert 'kind:pat' from the patterns list to tuples with kind and
     normalized and rooted patterns and with listfiles expanded."""
     kindpats = []
+    kinds_to_normalize = (
+        b'relglob',
+        b'path',
+        b'filepath',
+        b'rootfilesin',
+        b'rootglob',
+    )
+
     for kind, pat in [_patsplit(p, default) for p in patterns]:
         if kind in cwdrelativepatternkinds:
             pat = pathutil.canonpath(root, cwd, pat, auditor=auditor)
-        elif kind in (b'relglob', b'path', b'rootfilesin', b'rootglob'):
+        elif kind in kinds_to_normalize:
             pat = util.normpath(pat)
         elif kind in (b'listfile', b'listfile0'):
             try:
                 files = util.readfile(pat)
                 if kind == b'listfile0':
                     files = files.split(b'\0')
                 else:
@@ -610,29 +621,35 @@
     False
     >>> m(b'b')  # matches relpath:b, since 'root' is 'foo'
     True
     >>> m(b'lib.h')  # matches glob:*.h
     True
 
     >>> m.files()
-    ['', 'foo/a', 'b', '']
+    [b'', b'foo/a', b'', b'b']
     >>> m.exact(b'foo/a')
     True
     >>> m.exact(b'b')
     True
     >>> m.exact(b'lib.h')  # exact matches are for (rel)path kinds
     False
     """
 
     def __init__(self, root, kindpats, badfn=None):
         super(patternmatcher, self).__init__(badfn)
+        kindpats.sort()
 
         self._files = _explicitfiles(kindpats)
         self._prefix = _prefix(kindpats)
-        self._pats, self.matchfn = _buildmatch(kindpats, b'$', root)
+        self._pats, self._matchfn = _buildmatch(kindpats, b'$', root)
+
+    def matchfn(self, fn):
+        if fn in self._fileset:
+            return True
+        return self._matchfn(fn)
 
     @propertycache
     def _dirs(self):
         return set(pathutil.dirs(self._fileset))
 
     def visitdir(self, dir):
         if self._prefix and dir in self._fileset:
@@ -1330,14 +1347,18 @@
     """Convert a (normalized) pattern of any kind into a
     regular expression.
     globsuffix is appended to the regexp of globs."""
     if not pat and kind in (b'glob', b'relpath'):
         return b''
     if kind == b're':
         return pat
+    if kind == b'filepath':
+        raise error.ProgrammingError(
+            "'filepath:' patterns should not be converted to a regex"
+        )
     if kind in (b'path', b'relpath'):
         if pat == b'.':
             return b''
         return util.stringutil.reescape(pat) + b'(?:/|$)'
     if kind == b'rootfilesin':
         if pat == b'.':
             escaped = b''
@@ -1434,15 +1455,22 @@
     ... ], b'$')
     Traceback (most recent call last):
     ...
     Abort: matcher pattern is too long (20009 bytes)
     """
     try:
         allgroups = []
-        regexps = [_regex(k, p, globsuffix) for (k, p, s) in kindpats]
+        regexps = []
+        exact = set()
+        for (kind, pattern, _source) in kindpats:
+            if kind == b'filepath':
+                exact.add(pattern)
+                continue
+            regexps.append(_regex(kind, pattern, globsuffix))
+
         fullregexp = _joinregexes(regexps)
 
         startidx = 0
         groupsize = 0
         for idx, r in enumerate(regexps):
             piecesize = len(r)
             if piecesize > MAX_RE_SIZE:
@@ -1459,17 +1487,28 @@
             matcher = _rematcher(fullregexp)
             func = lambda s: bool(matcher(s))
         else:
             group = regexps[startidx:]
             allgroups.append(_joinregexes(group))
             allmatchers = [_rematcher(g) for g in allgroups]
             func = lambda s: any(m(s) for m in allmatchers)
-        return fullregexp, func
+
+        actualfunc = func
+        if exact:
+            # An empty regex will always match, so only call the regex if
+            # there were any actual patterns to match.
+            if not regexps:
+                actualfunc = lambda s: s in exact
+            else:
+                actualfunc = lambda s: s in exact or func(s)
+        return fullregexp, actualfunc
     except re.error:
         for k, p, s in kindpats:
+            if k == b'filepath':
+                continue
             try:
                 _rematcher(_regex(k, p, globsuffix))
             except re.error:
                 if s:
                     raise error.Abort(
                         _(b"%s: invalid pattern (%s): %s") % (s, k, p)
                     )
@@ -1492,15 +1531,15 @@
         if kind in (b'glob', b'rootglob'):  # find the non-glob prefix
             root = []
             for p in pat.split(b'/'):
                 if b'[' in p or b'{' in p or b'*' in p or b'?' in p:
                     break
                 root.append(p)
             r.append(b'/'.join(root))
-        elif kind in (b'relpath', b'path'):
+        elif kind in (b'relpath', b'path', b'filepath'):
             if pat == b'.':
                 pat = b''
             r.append(pat)
         elif kind in (b'rootfilesin',):
             if pat == b'.':
                 pat = b''
             d.append(pat)
```

### Comparing `mercurial-6.4rc0/mercurial/mdiff.py` & `mercurial-6.5rc0/mercurial/mdiff.py`

 * *Files 0% similar despite different names*

```diff
@@ -209,15 +209,15 @@
     return filteredblocks, (lba, uba)
 
 
 def chooseblocksfunc(opts=None):
     if (
         opts is None
         or not opts.xdiff
-        or not util.safehasattr(bdiff, b'xdiffblocks')
+        or not util.safehasattr(bdiff, 'xdiffblocks')
     ):
         return bdiff.blocks
     else:
         return bdiff.xdiffblocks
 
 
 def allblocks(text1, text2, opts=None, lines1=None, lines2=None):
```

### Comparing `mercurial-6.4rc0/mercurial/merge.py` & `mercurial-6.5rc0/mercurial/merge.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/mergestate.py` & `mercurial-6.5rc0/mercurial/mergestate.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/metadata.py` & `mercurial-6.5rc0/mercurial/metadata.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/minifileset.py` & `mercurial-6.5rc0/mercurial/minifileset.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/minirst.py` & `mercurial-6.5rc0/mercurial/minirst.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/mpatch.c` & `mercurial-6.5rc0/mercurial/mpatch.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/mpatch.h` & `mercurial-6.5rc0/mercurial/mpatch.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/namespaces.py` & `mercurial-6.5rc0/mercurial/namespaces.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/narrowspec.py` & `mercurial-6.5rc0/mercurial/narrowspec.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/node.py` & `mercurial-6.5rc0/mercurial/node.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/obsolete.py` & `mercurial-6.5rc0/mercurial/obsolete.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/obsutil.py` & `mercurial-6.5rc0/mercurial/obsutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/parser.py` & `mercurial-6.5rc0/mercurial/parser.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/patch.py` & `mercurial-6.5rc0/mercurial/patch.py`

 * *Files 0% similar despite different names*

```diff
@@ -164,15 +164,15 @@
         __next__ = next
 
     inheader = False
     cur = []
 
     mimeheaders = [b'content-type']
 
-    if not util.safehasattr(stream, b'next'):
+    if not util.safehasattr(stream, 'next'):
         # http responses, for example, have readline but not next
         stream = fiter(stream)
 
     for line in stream:
         cur.append(line)
         if line.startswith(b'# HG changeset patch'):
             return hgsplit(stream, cur)
@@ -1699,15 +1699,15 @@
      d
     -lastline
 
     '''
 
     newhunks = []
     for c in hunks:
-        if util.safehasattr(c, b'reversehunk'):
+        if util.safehasattr(c, 'reversehunk'):
             c = c.reversehunk()
         newhunks.append(c)
     return newhunks
 
 
 def parsepatch(originalchunks, maxcontext=None):
     """patch -> [] of headers -> [] of hunks
```

### Comparing `mercurial-6.4rc0/mercurial/pathutil.py` & `mercurial-6.5rc0/mercurial/pathutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/phases.py` & `mercurial-6.5rc0/mercurial/phases.py`

 * *Files 1% similar despite different names*

```diff
@@ -150,14 +150,15 @@
 
 # record phase index
 public, draft, secret = range(3)  # type: int
 archived = 32  # non-continuous for compatibility
 internal = 96  # non-continuous for compatibility
 allphases = (public, draft, secret, archived, internal)
 trackedphases = (draft, secret, archived, internal)
+not_public_phases = trackedphases
 # record phase names
 cmdphasenames = [b'public', b'draft', b'secret']  # known to `hg phase` command
 phasenames = dict(enumerate(cmdphasenames))
 phasenames[archived] = b'archived'
 phasenames[internal] = b'internal'
 # map phase name to phase number
 phasenumber = {name: phase for phase, name in phasenames.items()}
@@ -167,14 +168,18 @@
 phasenumber2.update({phase: phase for phase in phasenames})
 phasenumber2.update({b'%i' % phase: phase for phase in phasenames})
 # record phase property
 mutablephases = (draft, secret, archived, internal)
 remotehiddenphases = (secret, archived, internal)
 localhiddenphases = (internal, archived)
 
+all_internal_phases = tuple(p for p in allphases if p & internal)
+# We do not want any internal content to exit the repository, ever.
+no_bundle_phases = all_internal_phases
+
 
 def supportinternal(repo):
     # type: (localrepo.localrepository) -> bool
     """True if the internal phase can be used on a repository"""
     return requirements.INTERNAL_PHASE_REQUIREMENT in repo.requirements
 
 
@@ -454,19 +459,19 @@
         ph._loadedrevslen = self._loadedrevslen
         ph._phasesets = self._phasesets
         return ph
 
     def replace(self, phcache):
         """replace all values in 'self' with content of phcache"""
         for a in (
-            b'phaseroots',
-            b'dirty',
-            b'opener',
-            b'_loadedrevslen',
-            b'_phasesets',
+            'phaseroots',
+            'dirty',
+            'opener',
+            '_loadedrevslen',
+            '_phasesets',
         ):
             setattr(self, a, getattr(phcache, a))
 
     def _getphaserevsnative(self, repo):
         repo = repo.unfiltered()
         return repo.changelog.computephases(self.phaseroots)
 
@@ -822,18 +827,16 @@
 
     Returns a list indexed by phase number where each item is a list of phase
     head nodes.
     """
     cl = repo.changelog
 
     headsbyphase = {i: [] for i in allphases}
-    # No need to keep track of secret phase; any heads in the subset that
-    # are not mentioned are implicitly secret.
-    for phase in allphases[:secret]:
-        revset = b"heads(%%ln & %s())" % phasenames[phase]
+    for phase in allphases:
+        revset = b"heads(%%ln & _phase(%d))" % phase
         headsbyphase[phase] = [cl.node(r) for r in repo.revs(revset, subset)]
     return headsbyphase
 
 
 def updatephases(repo, trgetter, headsbyphase):
     """Updates the repo with the given phase heads"""
     # Now advance phase boundaries of all phases
```

### Comparing `mercurial-6.4rc0/mercurial/policy.py` & `mercurial-6.5rc0/mercurial/policy.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/posix.py` & `mercurial-6.5rc0/mercurial/posix.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/profiling.py` & `mercurial-6.5rc0/mercurial/profiling.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/progress.py` & `mercurial-6.5rc0/mercurial/progress.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/pure/base85.py` & `mercurial-6.5rc0/mercurial/pure/base85.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/pure/bdiff.py` & `mercurial-6.5rc0/mercurial/pure/bdiff.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/pure/charencode.py` & `mercurial-6.5rc0/mercurial/pure/charencode.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/pure/mpatch.py` & `mercurial-6.5rc0/mercurial/pure/mpatch.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/pure/osutil.py` & `mercurial-6.5rc0/mercurial/pure/osutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/pure/parsers.py` & `mercurial-6.5rc0/mercurial/pure/parsers.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/pushkey.py` & `mercurial-6.5rc0/mercurial/pushkey.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/pvec.py` & `mercurial-6.5rc0/mercurial/pvec.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/pycompat.py` & `mercurial-6.5rc0/mercurial/pycompat.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/pythoncapi_compat.h` & `mercurial-6.5rc0/mercurial/pythoncapi_compat.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/rcutil.py` & `mercurial-6.5rc0/mercurial/rcutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/registrar.py` & `mercurial-6.5rc0/mercurial/registrar.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/repair.py` & `mercurial-6.5rc0/mercurial/repair.py`

 * *Files 5% similar despite different names*

```diff
@@ -3,16 +3,14 @@
 # Copyright 2005, 2006 Chris Mason <mason@suse.com>
 # Copyright 2007 Olivia Mackall
 #
 # This software may be used and distributed according to the terms of the
 # GNU General Public License version 2 or any later version.
 
 
-import errno
-
 from .i18n import _
 from .node import (
     hex,
     short,
 )
 from . import (
     bundle2,
@@ -22,25 +20,32 @@
     exchange,
     obsolete,
     obsutil,
     pathutil,
     phases,
     requirements,
     scmutil,
+    transaction,
     util,
 )
 from .utils import (
     hashutil,
-    stringutil,
     urlutil,
 )
 
 
 def backupbundle(
-    repo, bases, heads, node, suffix, compress=True, obsolescence=True
+    repo,
+    bases,
+    heads,
+    node,
+    suffix,
+    compress=True,
+    obsolescence=True,
+    tmp_backup=False,
 ):
     """create a bundle with the specified revisions as a backup"""
 
     backupdir = b"strip-backup"
     vfs = repo.vfs
     if not vfs.isdir(backupdir):
         vfs.mkdir(backupdir)
@@ -79,14 +84,15 @@
         b'strip',
         name,
         bundletype,
         outgoing,
         contentopts,
         vfs,
         compression=comp,
+        allow_internal=tmp_backup,
     )
 
 
 def _collectfiles(repo, striprev):
     """find out the filelogs affected by the strip"""
     files = set()
 
@@ -195,14 +201,15 @@
             repo,
             savebases,
             saveheads,
             node,
             b'temp',
             compress=False,
             obsolescence=False,
+            tmp_backup=True,
         )
 
     with ui.uninterruptible():
         try:
             with repo.transaction(b"strip") as tr:
                 # TODO this code violates the interface abstraction of the
                 # transaction and makes assumptions that file storage is
@@ -257,27 +264,15 @@
                         )
                 f.close()
 
             with repo.transaction(b'repair') as tr:
                 bmchanges = [(m, repo[newbmtarget].node()) for m in updatebm]
                 repo._bookmarks.applychanges(repo, tr, bmchanges)
 
-            # remove undo files
-            for undovfs, undofile in repo.undofiles():
-                try:
-                    undovfs.unlink(undofile)
-                except OSError as e:
-                    if e.errno != errno.ENOENT:
-                        ui.warn(
-                            _(b'error removing %s: %s\n')
-                            % (
-                                undovfs.join(undofile),
-                                stringutil.forcebytestr(e),
-                            )
-                        )
+            transaction.cleanup_undo_files(repo.ui.warn, repo.vfs_map)
 
         except:  # re-raises
             if backupfile:
                 ui.warn(
                     _(b"strip failed, backup bundle stored in '%s'\n")
                     % vfs.join(backupfile)
                 )
@@ -345,16 +340,34 @@
             newbmtarget = b'.'
     return newbmtarget, updatebm
 
 
 def _createstripbackup(repo, stripbases, node, topic):
     # backup the changeset we are about to strip
     vfs = repo.vfs
-    cl = repo.changelog
-    backupfile = backupbundle(repo, stripbases, cl.heads(), node, topic)
+    unfi = repo.unfiltered()
+    to_node = unfi.changelog.node
+    # internal changeset are internal implementation details that should not
+    # leave the repository and not be exposed to the users. In addition feature
+    # using them requires to be resistant to strip. See test case for more
+    # details.
+    all_backup = unfi.revs(
+        b"(%ln)::(%ld) and not _internal()",
+        stripbases,
+        unfi.changelog.headrevs(),
+    )
+    if not all_backup:
+        return None
+
+    def to_nodes(revs):
+        return [to_node(r) for r in revs]
+
+    bases = to_nodes(unfi.revs("roots(%ld)", all_backup))
+    heads = to_nodes(unfi.revs("heads(%ld)", all_backup))
+    backupfile = backupbundle(repo, bases, heads, node, topic)
     repo.ui.status(_(b"saved backup bundle to %s\n") % vfs.join(backupfile))
     repo.ui.log(
         b"backupbundle", b"saved backup bundle to %s\n", vfs.join(backupfile)
     )
     return backupfile
 
 
@@ -427,20 +440,17 @@
 
 
 def manifestrevlogs(repo):
     yield repo.manifestlog.getstorage(b'')
     if scmutil.istreemanifest(repo):
         # This logic is safe if treemanifest isn't enabled, but also
         # pointless, so we skip it if treemanifest isn't enabled.
-        for t, unencoded, size in repo.store.datafiles():
-            if unencoded.startswith(b'meta/') and unencoded.endswith(
-                b'00manifest.i'
-            ):
-                dir = unencoded[5:-12]
-                yield repo.manifestlog.getstorage(dir)
+        for entry in repo.store.data_entries():
+            if entry.is_revlog and entry.is_manifestlog:
+                yield repo.manifestlog.getstorage(entry.target_id)
 
 
 def rebuildfncache(ui, repo, only_data=False):
     """Rebuilds the fncache file from repo history.
 
     Missing entries will be added. Extra entries will be removed.
     """
```

### Comparing `mercurial-6.4rc0/mercurial/repocache.py` & `mercurial-6.5rc0/mercurial/repocache.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/repoview.py` & `mercurial-6.5rc0/mercurial/repoview.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/requirements.py` & `mercurial-6.5rc0/mercurial/requirements.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/revlog.py` & `mercurial-6.5rc0/mercurial/revlog.py`

 * *Files 1% similar despite different names*

```diff
@@ -15,14 +15,15 @@
 
 import binascii
 import collections
 import contextlib
 import io
 import os
 import struct
+import weakref
 import zlib
 
 # import stuff from node for others to import from revlog
 from .node import (
     bin,
     hex,
     nullrev,
@@ -285,27 +286,38 @@
 
     See mercurial/revlogutils/contants.py for details about the content of an
     index entry.
     """
 
     _flagserrorclass = error.RevlogError
 
+    @staticmethod
+    def is_inline_index(header_bytes):
+        header = INDEX_HEADER.unpack(header_bytes)[0]
+
+        _format_flags = header & ~0xFFFF
+        _format_version = header & 0xFFFF
+
+        features = FEATURES_BY_VERSION[_format_version]
+        return features[b'inline'](_format_flags)
+
     def __init__(
         self,
         opener,
         target,
         radix,
         postfix=None,  # only exist for `tmpcensored` now
         checkambig=False,
         mmaplargeindex=False,
         censorable=False,
         upperboundcomp=None,
         persistentnodemap=False,
         concurrencychecker=None,
         trypending=False,
+        try_split=False,
         canonical_parent_order=True,
     ):
         """
         create a revlog object
 
         opener is a function that abstracts the file opening operation
         and can be used to implement COW semantics or the like.
@@ -324,14 +336,15 @@
         self._docket_file = None
         self._indexfile = None
         self._datafile = None
         self._sidedatafile = None
         self._nodemap_file = None
         self.postfix = postfix
         self._trypending = trypending
+        self._try_split = try_split
         self.opener = opener
         if persistentnodemap:
             self._nodemap_file = nodemaputil.get_nodemap_file(self)
 
         assert target[0] in ALL_KINDS
         assert len(target) == 2
         self.target = target
@@ -499,22 +512,115 @@
                 if size is None:
                     return fp.read()
                 else:
                     return fp.read(size)
         except FileNotFoundError:
             return b''
 
+    def get_streams(self, max_linkrev, force_inline=False):
+        n = len(self)
+        index = self.index
+        while n > 0:
+            linkrev = index[n - 1][4]
+            if linkrev < max_linkrev:
+                break
+            # note: this loop will rarely go through multiple iterations, since
+            # it only traverses commits created during the current streaming
+            # pull operation.
+            #
+            # If this become a problem, using a binary search should cap the
+            # runtime of this.
+            n = n - 1
+        if n == 0:
+            # no data to send
+            return []
+        index_size = n * index.entry_size
+        data_size = self.end(n - 1)
+
+        # XXX we might have been split (or stripped) since the object
+        # initialization, We need to close this race too, but having a way to
+        # pre-open the file we feed to the revlog and never closing them before
+        # we are done streaming.
+
+        if self._inline:
+
+            def get_stream():
+                with self._indexfp() as fp:
+                    yield None
+                    size = index_size + data_size
+                    if size <= 65536:
+                        yield fp.read(size)
+                    else:
+                        yield from util.filechunkiter(fp, limit=size)
+
+            inline_stream = get_stream()
+            next(inline_stream)
+            return [
+                (self._indexfile, inline_stream, index_size + data_size),
+            ]
+        elif force_inline:
+
+            def get_stream():
+                with self._datafp() as fp_d:
+                    yield None
+
+                    for rev in range(n):
+                        idx = self.index.entry_binary(rev)
+                        if rev == 0 and self._docket is None:
+                            # re-inject the inline flag
+                            header = self._format_flags
+                            header |= self._format_version
+                            header |= FLAG_INLINE_DATA
+                            header = self.index.pack_header(header)
+                            idx = header + idx
+                        yield idx
+                        yield self._getsegmentforrevs(rev, rev, df=fp_d)[1]
+
+            inline_stream = get_stream()
+            next(inline_stream)
+            return [
+                (self._indexfile, inline_stream, index_size + data_size),
+            ]
+        else:
+
+            def get_index_stream():
+                with self._indexfp() as fp:
+                    yield None
+                    if index_size <= 65536:
+                        yield fp.read(index_size)
+                    else:
+                        yield from util.filechunkiter(fp, limit=index_size)
+
+            def get_data_stream():
+                with self._datafp() as fp:
+                    yield None
+                    if data_size <= 65536:
+                        yield fp.read(data_size)
+                    else:
+                        yield from util.filechunkiter(fp, limit=data_size)
+
+            index_stream = get_index_stream()
+            next(index_stream)
+            data_stream = get_data_stream()
+            next(data_stream)
+            return [
+                (self._datafile, data_stream, data_size),
+                (self._indexfile, index_stream, index_size),
+            ]
+
     def _loadindex(self, docket=None):
 
         new_header, mmapindexthreshold, force_nodemap = self._init_opts()
 
         if self.postfix is not None:
             entry_point = b'%s.i.%s' % (self.radix, self.postfix)
         elif self._trypending and self.opener.exists(b'%s.i.a' % self.radix):
             entry_point = b'%s.i.a' % self.radix
+        elif self._try_split and self.opener.exists(self._split_index_file):
+            entry_point = self._split_index_file
         else:
             entry_point = b'%s.i' % self.radix
 
         if docket is not None:
             self._docket = docket
             self._docket_file = entry_point
         else:
@@ -654,14 +760,18 @@
             self._chunkcachesize,
         )
         # revnum -> (chain-length, sum-delta-length)
         self._chaininfocache = util.lrucachedict(500)
         # revlog header -> revlog compressor
         self._decompressors = {}
 
+    def get_revlog(self):
+        """simple function to mirror API of other not-really-revlog API"""
+        return self
+
     @util.propertycache
     def revlog_kind(self):
         return self.target[0]
 
     @util.propertycache
     def display_id(self):
         """The public facing "ID" of the revlog that we use in message"""
@@ -1773,15 +1883,15 @@
         else:
             return rev - 1
 
     def issnapshot(self, rev):
         """tells whether rev is a snapshot"""
         if not self._sparserevlog:
             return self.deltaparent(rev) == nullrev
-        elif util.safehasattr(self.index, b'issnapshot'):
+        elif util.safehasattr(self.index, 'issnapshot'):
             # directly assign the method to cache the testing and access
             self.issnapshot = self.index.issnapshot
             return self.issnapshot(rev)
         if rev == nullrev:
             return True
         entry = self.index[rev]
         base = entry[3]
@@ -2011,15 +2121,31 @@
                     % (self.display_id, pycompat.bytestr(revornode))
                 )
         except error.RevlogError:
             if self._censorable and storageutil.iscensoredtext(text):
                 raise error.CensoredNodeError(self.display_id, node, text)
             raise
 
-    def _enforceinlinesize(self, tr):
+    @property
+    def _split_index_file(self):
+        """the path where to expect the index of an ongoing splitting operation
+
+        The file will only exist if a splitting operation is in progress, but
+        it is always expected at the same location."""
+        parts = os.path.split(self.radix)
+        if len(parts) > 1:
+            # adds a '-s' prefix to the ``data/` or `meta/` base
+            head = parts[0] + b'-s'
+            return os.path.join(head, *parts[1:])
+        else:
+            # the revlog is stored at the root of the store (changelog or
+            # manifest), no risk of collision.
+            return self.radix + b'.i.s'
+
+    def _enforceinlinesize(self, tr, side_write=True):
         """Check if the revlog is too big for inline and convert if so.
 
         This should be called after revisions are added to the revlog. If the
         revlog has grown too large to be an inline revlog, it will convert it
         to use multiple index and data files.
         """
         tiprev = len(self) - 1
@@ -2028,15 +2154,16 @@
             return
 
         troffset = tr.findoffset(self._indexfile)
         if troffset is None:
             raise error.RevlogError(
                 _(b"%s not found in the transaction") % self._indexfile
             )
-        trindex = None
+        if troffset:
+            tr.addbackup(self._indexfile, for_offset=True)
         tr.add(self._datafile, 0)
 
         existing_handles = False
         if self._writinghandles is not None:
             existing_handles = True
             fp = self._writinghandles[0]
             fp.flush()
@@ -2044,55 +2171,70 @@
             # We can't use the cached file handle after close(). So prevent
             # its usage.
             self._writinghandles = None
             self._segmentfile.writing_handle = None
             # No need to deal with sidedata writing handle as it is only
             # relevant with revlog-v2 which is never inline, not reaching
             # this code
+        if side_write:
+            old_index_file_path = self._indexfile
+            new_index_file_path = self._split_index_file
+            opener = self.opener
+            weak_self = weakref.ref(self)
+
+            # the "split" index replace the real index when the transaction is finalized
+            def finalize_callback(tr):
+                opener.rename(
+                    new_index_file_path,
+                    old_index_file_path,
+                    checkambig=True,
+                )
+                maybe_self = weak_self()
+                if maybe_self is not None:
+                    maybe_self._indexfile = old_index_file_path
+
+            def abort_callback(tr):
+                maybe_self = weak_self()
+                if maybe_self is not None:
+                    maybe_self._indexfile = old_index_file_path
+
+            tr.registertmp(new_index_file_path)
+            if self.target[1] is not None:
+                callback_id = b'000-revlog-split-%d-%s' % self.target
+            else:
+                callback_id = b'000-revlog-split-%d' % self.target[0]
+            tr.addfinalize(callback_id, finalize_callback)
+            tr.addabort(callback_id, abort_callback)
 
         new_dfh = self._datafp(b'w+')
         new_dfh.truncate(0)  # drop any potentially existing data
         try:
             with self._indexfp() as read_ifh:
                 for r in self:
                     new_dfh.write(self._getsegmentforrevs(r, r, df=read_ifh)[1])
-                    if (
-                        trindex is None
-                        and troffset
-                        <= self.start(r) + r * self.index.entry_size
-                    ):
-                        trindex = r
                 new_dfh.flush()
 
-            if trindex is None:
-                trindex = 0
-
+            if side_write:
+                self._indexfile = new_index_file_path
             with self.__index_new_fp() as fp:
                 self._format_flags &= ~FLAG_INLINE_DATA
                 self._inline = False
                 for i in self:
                     e = self.index.entry_binary(i)
                     if i == 0 and self._docket is None:
                         header = self._format_flags | self._format_version
                         header = self.index.pack_header(header)
                         e = header + e
                     fp.write(e)
                 if self._docket is not None:
                     self._docket.index_end = fp.tell()
 
-                # There is a small transactional race here. If the rename of
-                # the index fails, we should remove the datafile. It is more
-                # important to ensure that the data file is not truncated
-                # when the index is replaced as otherwise data is lost.
-                tr.replace(self._datafile, self.start(trindex))
-
-                # the temp file replace the real index when we exit the context
-                # manager
+                # If we don't use side-write, the temp file replace the real
+                # index when we exit the context manager
 
-            tr.replace(self._indexfile, trindex * self.index.entry_size)
             nodemaputil.setup_persistent_nodemap(tr, self)
             self._segmentfile = randomaccessfile.randomaccessfile(
                 self.opener,
                 self._datafile,
                 self._chunkcachesize,
             )
```

### Comparing `mercurial-6.4rc0/mercurial/revlogutils/__init__.py` & `mercurial-6.5rc0/mercurial/revlogutils/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/revlogutils/concurrency_checker.py` & `mercurial-6.5rc0/mercurial/revlogutils/concurrency_checker.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/revlogutils/constants.py` & `mercurial-6.5rc0/mercurial/revlogutils/constants.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/revlogutils/debug.py` & `mercurial-6.5rc0/mercurial/revlogutils/debug.py`

 * *Files 2% similar despite different names*

```diff
@@ -659,45 +659,34 @@
         flags,
     )
 
     fh = revlog._datafp()
     deltacomputer.finddeltainfo(revinfo, fh, target_rev=rev)
 
 
-def _get_revlogs(repo, changelog: bool, manifest: bool, filelogs: bool):
-    """yield revlogs from this repository"""
-    if changelog:
-        yield repo.changelog
-
-    if manifest:
-        # XXX: Handle tree manifest
-        root_mf = repo.manifestlog.getstorage(b'')
-        assert not root_mf._treeondisk
-        yield root_mf._revlog
-
-    if filelogs:
-        files = set()
-        for rev in repo:
-            ctx = repo[rev]
-            files |= set(ctx.files())
-
-        for f in sorted(files):
-            yield repo.file(f)._revlog
-
-
 def debug_revlog_stats(
     repo, fm, changelog: bool, manifest: bool, filelogs: bool
 ):
     """Format revlog statistics for debugging purposes
 
     fm: the output formatter.
     """
     fm.plain(b'rev-count   data-size inl type      target \n')
 
-    for rlog in _get_revlogs(repo, changelog, manifest, filelogs):
+    revlog_entries = [e for e in repo.store.walk() if e.is_revlog]
+    revlog_entries.sort(key=lambda e: (e.revlog_type, e.target_id))
+
+    for entry in revlog_entries:
+        if not changelog and entry.is_changelog:
+            continue
+        elif not manifest and entry.is_manifestlog:
+            continue
+        elif not filelogs and entry.is_filelog:
+            continue
+        rlog = entry.get_revlog_instance(repo).get_revlog()
         fm.startitem()
         nb_rev = len(rlog)
         inline = rlog._inline
         data_size = rlog._get_data_offset(nb_rev - 1)
 
         target = rlog.target
         revlog_type = b'unknown'
```

### Comparing `mercurial-6.4rc0/mercurial/revlogutils/deltas.py` & `mercurial-6.5rc0/mercurial/revlogutils/deltas.py`

 * *Files 2% similar despite different names*

```diff
@@ -581,20 +581,22 @@
 def is_good_delta_info(revlog, deltainfo, revinfo):
     """Returns True if the given delta is good. Good means that it is within
     the disk span, disk size, and chain length bounds that we know to be
     performant."""
     if deltainfo is None:
         return False
 
-    if (
-        revinfo.cachedelta is not None
-        and deltainfo.base == revinfo.cachedelta[0]
-        and revinfo.cachedelta[2] == DELTA_BASE_REUSE_FORCE
-    ):
-        return True
+    # the DELTA_BASE_REUSE_FORCE case should have been taken care of sooner so
+    # we should never end up asking such question. Adding the assert as a
+    # safe-guard to detect anything that would be fishy in this regard.
+    assert (
+        revinfo.cachedelta is None
+        or revinfo.cachedelta[2] != DELTA_BASE_REUSE_FORCE
+        or not revlog._generaldelta
+    )
 
     # - 'deltainfo.distance' is the distance from the base revision --
     #   bounding it limits the amount of I/O we need to do.
     # - 'deltainfo.compresseddeltalen' is the sum of the total size of
     #   deltas we need to apply -- bounding it limits the amount of CPU
     #   we consume.
 
@@ -680,23 +682,32 @@
     content. See _raw_candidate_groups for details about the group order.
     """
     # should we try to build a delta?
     if not (len(revlog) and revlog._storedeltachains):
         yield None
         return
 
-    if (
-        cachedelta is not None
-        and nullrev == cachedelta[0]
-        and cachedelta[2] == DELTA_BASE_REUSE_FORCE
-    ):
-        # instruction are to forcibly do a full snapshot
+    if target_rev is None:
+        target_rev = len(revlog)
+
+    if not revlog._generaldelta:
+        # before general delta, there is only one possible delta base
+        yield (target_rev - 1,)
         yield None
         return
 
+    # the DELTA_BASE_REUSE_FORCE case should have been taken care of sooner so
+    # we should never end up asking such question. Adding the assert as a
+    # safe-guard to detect anything that would be fishy in this regard.
+    assert (
+        cachedelta is None
+        or cachedelta[2] != DELTA_BASE_REUSE_FORCE
+        or not revlog._generaldelta
+    )
+
     deltalength = revlog.length
     deltaparent = revlog.deltaparent
     sparse = revlog._sparserevlog
     good = None
 
     deltas_limit = textlen * LIMIT_DELTA2TEXT
     group_chunk_size = revlog._candidate_group_chunk_size
@@ -712,36 +723,25 @@
     while True:
         temptative = candidates.send(good)
         if temptative is None:
             break
         group = []
         for rev in temptative:
             # skip over empty delta (no need to include them in a chain)
-            while revlog._generaldelta and not (
-                rev == nullrev or rev in tested or deltalength(rev)
-            ):
+            while not (rev == nullrev or rev in tested or deltalength(rev)):
                 tested.add(rev)
                 rev = deltaparent(rev)
             # no need to try a delta against nullrev, this will be done as a
             # last resort.
             if rev == nullrev:
                 continue
             # filter out revision we tested already
             if rev in tested:
                 continue
 
-            if (
-                cachedelta is not None
-                and rev == cachedelta[0]
-                and cachedelta[2] == DELTA_BASE_REUSE_FORCE
-            ):
-                # instructions are to forcibly consider/use this delta base
-                group.append(rev)
-                continue
-
             # an higher authority deamed the base unworthy (e.g. censored)
             if excluded_bases is not None and rev in excluded_bases:
                 tested.add(rev)
                 continue
             # We are in some recomputation cases and that rev is too high in
             # the revlog
             if target_rev is not None and rev >= target_rev:
@@ -897,35 +897,35 @@
     """Provides group of revision to be tested as delta base
 
     This lower level function focus on emitting delta theorically interresting
     without looking it any practical details.
 
     The group order aims at providing fast or small candidates first.
     """
-    gdelta = revlog._generaldelta
-    # gate sparse behind general-delta because of issue6056
-    sparse = gdelta and revlog._sparserevlog
+    # Why search for delta base if we cannot use a delta base ?
+    assert revlog._generaldelta
+    # also see issue6056
+    sparse = revlog._sparserevlog
     curr = len(revlog)
     prev = curr - 1
     deltachain = lambda rev: revlog._deltachain(rev)[0]
 
-    if gdelta:
-        # exclude already lazy tested base if any
-        parents = [p for p in (p1, p2) if p != nullrev]
-
-        if not revlog._deltabothparents and len(parents) == 2:
-            parents.sort()
-            # To minimize the chance of having to build a fulltext,
-            # pick first whichever parent is closest to us (max rev)
-            yield (parents[1],)
-            # then the other one (min rev) if the first did not fit
-            yield (parents[0],)
-        elif len(parents) > 0:
-            # Test all parents (1 or 2), and keep the best candidate
-            yield parents
+    # exclude already lazy tested base if any
+    parents = [p for p in (p1, p2) if p != nullrev]
+
+    if not revlog._deltabothparents and len(parents) == 2:
+        parents.sort()
+        # To minimize the chance of having to build a fulltext,
+        # pick first whichever parent is closest to us (max rev)
+        yield (parents[1],)
+        # then the other one (min rev) if the first did not fit
+        yield (parents[0],)
+    elif len(parents) > 0:
+        # Test all parents (1 or 2), and keep the best candidate
+        yield parents
 
     if sparse and parents:
         if snapshot_cache is None:
             # map: base-rev: [snapshot-revs]
             snapshot_cache = SnapshotCache()
         # See if we can use an existing snapshot in the parent chains to use as
         # a base for a new intermediate-snapshot
@@ -1056,15 +1056,15 @@
         assert self._start_rev is None or (
             start_rev < self._start_rev or start_rev > self._end_rev
         ), (self._start_rev, self._end_rev, start_rev, end_rev)
         assert self._start_rev is None or (
             end_rev < self._start_rev or end_rev > self._end_rev
         ), (self._start_rev, self._end_rev, start_rev, end_rev)
         cache = self.snapshots
-        if util.safehasattr(revlog.index, b'findsnapshots'):
+        if util.safehasattr(revlog.index, 'findsnapshots'):
             revlog.index.findsnapshots(cache, start_rev, end_rev)
         else:
             deltaparent = revlog.deltaparent
             issnapshot = revlog.issnapshot
             for rev in revlog.revs(start_rev, end_rev):
                 if issnapshot(rev):
                     cache[deltaparent(rev)].add(rev)
@@ -1076,18 +1076,25 @@
         revlog,
         write_debug=None,
         debug_search=False,
         debug_info=None,
     ):
         self.revlog = revlog
         self._write_debug = write_debug
-        self._debug_search = debug_search
+        if write_debug is None:
+            self._debug_search = False
+        else:
+            self._debug_search = debug_search
         self._debug_info = debug_info
         self._snapshot_cache = SnapshotCache()
 
+    @property
+    def _gather_debug(self):
+        return self._write_debug is not None or self._debug_info is not None
+
     def buildtext(self, revinfo, fh):
         """Builds a fulltext version of a revision
 
         revinfo: revisioninfo instance that contains all needed info
         fh:      file handle to either the .i or the .d revlog file,
                  depending on whether it is inlined or not
         """
@@ -1122,22 +1129,28 @@
             delta = header + t
         else:
             ptext = revlog.rawdata(base, _df=fh)
             delta = mdiff.textdiff(ptext, t)
 
         return delta
 
-    def _builddeltainfo(self, revinfo, base, fh):
+    def _builddeltainfo(self, revinfo, base, fh, target_rev=None):
         # can we use the cached delta?
         revlog = self.revlog
-        debug_search = self._write_debug is not None and self._debug_search
         chainbase = revlog.chainbase(base)
         if revlog._generaldelta:
             deltabase = base
         else:
+            if target_rev is not None and base != target_rev - 1:
+                msg = (
+                    b'general delta cannot use delta for something else '
+                    b'than `prev`: %d<-%d'
+                )
+                msg %= (base, target_rev)
+                raise error.ProgrammingError(msg)
             deltabase = chainbase
         snapshotdepth = None
         if revlog._sparserevlog and deltabase == nullrev:
             snapshotdepth = 0
         elif revlog._sparserevlog and revlog.issnapshot(deltabase):
             # A delta chain should always be one full snapshot,
             # zero or more semi-snapshots, and zero or more deltas
@@ -1155,33 +1168,33 @@
                 and self.revlog.length(currentbase) == 0
             ):
                 currentbase = self.revlog.deltaparent(currentbase)
             if self.revlog._lazydelta and currentbase == base:
                 delta = revinfo.cachedelta[1]
         if delta is None:
             delta = self._builddeltadiff(base, revinfo, fh)
-        if debug_search:
+        if self._debug_search:
             msg = b"DBG-DELTAS-SEARCH:     uncompressed-delta-size=%d\n"
             msg %= len(delta)
             self._write_debug(msg)
         # snapshotdept need to be neither None nor 0 level snapshot
         if revlog.upperboundcomp is not None and snapshotdepth:
             lowestrealisticdeltalen = len(delta) // revlog.upperboundcomp
             snapshotlimit = revinfo.textlen >> snapshotdepth
-            if debug_search:
+            if self._debug_search:
                 msg = b"DBG-DELTAS-SEARCH:     projected-lower-size=%d\n"
                 msg %= lowestrealisticdeltalen
                 self._write_debug(msg)
             if snapshotlimit < lowestrealisticdeltalen:
-                if debug_search:
+                if self._debug_search:
                     msg = b"DBG-DELTAS-SEARCH:     DISCARDED (snapshot limit)\n"
                     self._write_debug(msg)
                 return None
             if revlog.length(base) < lowestrealisticdeltalen:
-                if debug_search:
+                if self._debug_search:
                     msg = b"DBG-DELTAS-SEARCH:     DISCARDED (prev size)\n"
                     self._write_debug(msg)
                 return None
         header, data = revlog.compress(delta)
         deltalen = len(header) + len(data)
         offset = revlog.end(len(revlog) - 1)
         dist = deltalen + offset - revlog.start(chainbase)
@@ -1235,58 +1248,153 @@
         `excluded_bases` is an optional set of revision that cannot be used as
         a delta base. Use this to recompute delta suitable in censor or strip
         context.
         """
         if target_rev is None:
             target_rev = len(self.revlog)
 
-        if not revinfo.textlen:
-            return self._fullsnapshotinfo(fh, revinfo, target_rev)
+        gather_debug = self._gather_debug
+        cachedelta = revinfo.cachedelta
+        revlog = self.revlog
+        p1r = p2r = None
 
         if excluded_bases is None:
             excluded_bases = set()
 
-        # no delta for flag processor revision (see "candelta" for why)
+        if gather_debug:
+            start = util.timer()
+            dbg = self._one_dbg_data()
+            dbg['revision'] = target_rev
+            target_revlog = b"UNKNOWN"
+            target_type = self.revlog.target[0]
+            target_key = self.revlog.target[1]
+            if target_type == KIND_CHANGELOG:
+                target_revlog = b'CHANGELOG:'
+            elif target_type == KIND_MANIFESTLOG:
+                target_revlog = b'MANIFESTLOG:'
+                if target_key:
+                    target_revlog += b'%s:' % target_key
+            elif target_type == KIND_FILELOG:
+                target_revlog = b'FILELOG:'
+                if target_key:
+                    target_revlog += b'%s:' % target_key
+            dbg['target-revlog'] = target_revlog
+            p1r = revlog.rev(revinfo.p1)
+            p2r = revlog.rev(revinfo.p2)
+            if p1r != nullrev:
+                p1_chain_len = revlog._chaininfo(p1r)[0]
+            else:
+                p1_chain_len = -1
+            if p2r != nullrev:
+                p2_chain_len = revlog._chaininfo(p2r)[0]
+            else:
+                p2_chain_len = -1
+            dbg['p1-chain-len'] = p1_chain_len
+            dbg['p2-chain-len'] = p2_chain_len
+
+        # 1) if the revision is empty, no amount of delta can beat it
+        #
+        # 2) no delta for flag processor revision (see "candelta" for why)
         # not calling candelta since only one revision needs test, also to
         # avoid overhead fetching flags again.
-        if revinfo.flags & REVIDX_RAWTEXT_CHANGING_FLAGS:
-            return self._fullsnapshotinfo(fh, revinfo, target_rev)
+        if not revinfo.textlen or revinfo.flags & REVIDX_RAWTEXT_CHANGING_FLAGS:
+            deltainfo = self._fullsnapshotinfo(fh, revinfo, target_rev)
+            if gather_debug:
+                end = util.timer()
+                dbg['duration'] = end - start
+                dbg[
+                    'delta-base'
+                ] = deltainfo.base  # pytype: disable=attribute-error
+                dbg['search_round_count'] = 0
+                dbg['using-cached-base'] = False
+                dbg['delta_try_count'] = 0
+                dbg['type'] = b"full"
+                dbg['snapshot-depth'] = 0
+                self._dbg_process_data(dbg)
+            return deltainfo
 
-        gather_debug = (
-            self._write_debug is not None or self._debug_info is not None
-        )
-        debug_search = self._write_debug is not None and self._debug_search
+        deltainfo = None
 
-        if gather_debug:
-            start = util.timer()
+        # If this source delta are to be forcibly reuse, let us comply early.
+        if (
+            revlog._generaldelta
+            and revinfo.cachedelta is not None
+            and revinfo.cachedelta[2] == DELTA_BASE_REUSE_FORCE
+        ):
+            base = revinfo.cachedelta[0]
+            if base == nullrev:
+                dbg_type = b"full"
+                deltainfo = self._fullsnapshotinfo(fh, revinfo, target_rev)
+                if gather_debug:
+                    snapshotdepth = 0
+            elif base not in excluded_bases:
+                delta = revinfo.cachedelta[1]
+                header, data = revlog.compress(delta)
+                deltalen = len(header) + len(data)
+                if gather_debug:
+                    offset = revlog.end(len(revlog) - 1)
+                    chainbase = revlog.chainbase(base)
+                    distance = deltalen + offset - revlog.start(chainbase)
+                    chainlen, compresseddeltalen = revlog._chaininfo(base)
+                    chainlen += 1
+                    compresseddeltalen += deltalen
+                    if base == p1r or base == p2r:
+                        dbg_type = b"delta"
+                        snapshotdepth = None
+                    elif not revlog.issnapshot(base):
+                        snapshotdepth = None
+                    else:
+                        dbg_type = b"snapshot"
+                        snapshotdepth = revlog.snapshotdepth(base) + 1
+                else:
+                    distance = None
+                    chainbase = None
+                    chainlen = None
+                    compresseddeltalen = None
+                    snapshotdepth = None
+                deltainfo = _deltainfo(
+                    distance=distance,
+                    deltalen=deltalen,
+                    data=(header, data),
+                    base=base,
+                    chainbase=chainbase,
+                    chainlen=chainlen,
+                    compresseddeltalen=compresseddeltalen,
+                    snapshotdepth=snapshotdepth,
+                )
+
+            if deltainfo is not None:
+                if gather_debug:
+                    end = util.timer()
+                    dbg['duration'] = end - start
+                    dbg[
+                        'delta-base'
+                    ] = deltainfo.base  # pytype: disable=attribute-error
+                    dbg['search_round_count'] = 0
+                    dbg['using-cached-base'] = True
+                    dbg['delta_try_count'] = 0
+                    dbg['type'] = b"full"
+                    if snapshotdepth is None:
+                        dbg['snapshot-depth'] = 0
+                    else:
+                        dbg['snapshot-depth'] = snapshotdepth
+                    self._dbg_process_data(dbg)
+                return deltainfo
 
         # count the number of different delta we tried (for debug purpose)
         dbg_try_count = 0
         # count the number of "search round" we did. (for debug purpose)
         dbg_try_rounds = 0
         dbg_type = b'unknown'
 
-        cachedelta = revinfo.cachedelta
-        p1 = revinfo.p1
-        p2 = revinfo.p2
-        revlog = self.revlog
-
-        deltainfo = None
-        p1r, p2r = revlog.rev(p1), revlog.rev(p2)
+        if p1r is None:
+            p1r = revlog.rev(revinfo.p1)
+            p2r = revlog.rev(revinfo.p2)
 
-        if gather_debug:
-            if p1r != nullrev:
-                p1_chain_len = revlog._chaininfo(p1r)[0]
-            else:
-                p1_chain_len = -1
-            if p2r != nullrev:
-                p2_chain_len = revlog._chaininfo(p2r)[0]
-            else:
-                p2_chain_len = -1
-        if debug_search:
+        if self._debug_search:
             msg = b"DBG-DELTAS-SEARCH: SEARCH rev=%d\n"
             msg %= target_rev
             self._write_debug(msg)
 
         groups = _candidategroups(
             self.revlog,
             revinfo.textlen,
@@ -1296,56 +1404,56 @@
             excluded_bases,
             target_rev,
             snapshot_cache=self._snapshot_cache,
         )
         candidaterevs = next(groups)
         while candidaterevs is not None:
             dbg_try_rounds += 1
-            if debug_search:
+            if self._debug_search:
                 prev = None
                 if deltainfo is not None:
                     prev = deltainfo.base
 
                 if (
                     cachedelta is not None
                     and len(candidaterevs) == 1
                     and cachedelta[0] in candidaterevs
                 ):
                     round_type = b"cached-delta"
-                elif p1 in candidaterevs or p2 in candidaterevs:
+                elif p1r in candidaterevs or p2r in candidaterevs:
                     round_type = b"parents"
                 elif prev is not None and all(c < prev for c in candidaterevs):
                     round_type = b"refine-down"
                 elif prev is not None and all(c > prev for c in candidaterevs):
                     round_type = b"refine-up"
                 else:
                     round_type = b"search-down"
                 msg = b"DBG-DELTAS-SEARCH: ROUND #%d - %d candidates - %s\n"
                 msg %= (dbg_try_rounds, len(candidaterevs), round_type)
                 self._write_debug(msg)
             nominateddeltas = []
             if deltainfo is not None:
-                if debug_search:
+                if self._debug_search:
                     msg = (
                         b"DBG-DELTAS-SEARCH:   CONTENDER: rev=%d - length=%d\n"
                     )
                     msg %= (deltainfo.base, deltainfo.deltalen)
                     self._write_debug(msg)
                 # if we already found a good delta,
                 # challenge it against refined candidates
                 nominateddeltas.append(deltainfo)
             for candidaterev in candidaterevs:
-                if debug_search:
+                if self._debug_search:
                     msg = b"DBG-DELTAS-SEARCH:   CANDIDATE: rev=%d\n"
                     msg %= candidaterev
                     self._write_debug(msg)
                     candidate_type = None
-                    if candidaterev == p1:
+                    if candidaterev == p1r:
                         candidate_type = b"p1"
-                    elif candidaterev == p2:
+                    elif candidaterev == p2r:
                         candidate_type = b"p2"
                     elif self.revlog.issnapshot(candidaterev):
                         candidate_type = b"snapshot-%d"
                         candidate_type %= self.revlog.snapshotdepth(
                             candidaterev
                         )
 
@@ -1358,34 +1466,39 @@
                     self._write_debug(msg)
                     msg = b"DBG-DELTAS-SEARCH:     base=%d\n"
                     msg %= self.revlog.deltaparent(candidaterev)
                     self._write_debug(msg)
 
                 dbg_try_count += 1
 
-                if debug_search:
+                if self._debug_search:
                     delta_start = util.timer()
-                candidatedelta = self._builddeltainfo(revinfo, candidaterev, fh)
-                if debug_search:
+                candidatedelta = self._builddeltainfo(
+                    revinfo,
+                    candidaterev,
+                    fh,
+                    target_rev=target_rev,
+                )
+                if self._debug_search:
                     delta_end = util.timer()
                     msg = b"DBG-DELTAS-SEARCH:     delta-search-time=%f\n"
                     msg %= delta_end - delta_start
                     self._write_debug(msg)
                 if candidatedelta is not None:
                     if is_good_delta_info(self.revlog, candidatedelta, revinfo):
-                        if debug_search:
+                        if self._debug_search:
                             msg = b"DBG-DELTAS-SEARCH:     DELTA: length=%d (GOOD)\n"
                             msg %= candidatedelta.deltalen
                             self._write_debug(msg)
                         nominateddeltas.append(candidatedelta)
-                    elif debug_search:
+                    elif self._debug_search:
                         msg = b"DBG-DELTAS-SEARCH:     DELTA: length=%d (BAD)\n"
                         msg %= candidatedelta.deltalen
                         self._write_debug(msg)
-                elif debug_search:
+                elif self._debug_search:
                     msg = b"DBG-DELTAS-SEARCH:     NO-DELTA\n"
                     self._write_debug(msg)
             if nominateddeltas:
                 deltainfo = min(nominateddeltas, key=lambda x: x.deltalen)
             if deltainfo is not None:
                 candidaterevs = groups.send(deltainfo.base)
             else:
@@ -1411,84 +1524,84 @@
             else:
                 used_cached = (
                     cachedelta is not None
                     and dbg_try_rounds == 1
                     and dbg_try_count == 1
                     and deltainfo.base == cachedelta[0]
                 )
-            dbg = {
-                'duration': end - start,
-                'revision': target_rev,
-                'delta-base': deltainfo.base,  # pytype: disable=attribute-error
-                'search_round_count': dbg_try_rounds,
-                'using-cached-base': used_cached,
-                'delta_try_count': dbg_try_count,
-                'type': dbg_type,
-                'p1-chain-len': p1_chain_len,
-                'p2-chain-len': p2_chain_len,
-            }
+            dbg['duration'] = end - start
+            dbg[
+                'delta-base'
+            ] = deltainfo.base  # pytype: disable=attribute-error
+            dbg['search_round_count'] = dbg_try_rounds
+            dbg['using-cached-base'] = used_cached
+            dbg['delta_try_count'] = dbg_try_count
+            dbg['type'] = dbg_type
             if (
                 deltainfo.snapshotdepth  # pytype: disable=attribute-error
                 is not None
             ):
                 dbg[
                     'snapshot-depth'
                 ] = deltainfo.snapshotdepth  # pytype: disable=attribute-error
             else:
                 dbg['snapshot-depth'] = 0
-            target_revlog = b"UNKNOWN"
-            target_type = self.revlog.target[0]
-            target_key = self.revlog.target[1]
-            if target_type == KIND_CHANGELOG:
-                target_revlog = b'CHANGELOG:'
-            elif target_type == KIND_MANIFESTLOG:
-                target_revlog = b'MANIFESTLOG:'
-                if target_key:
-                    target_revlog += b'%s:' % target_key
-            elif target_type == KIND_FILELOG:
-                target_revlog = b'FILELOG:'
-                if target_key:
-                    target_revlog += b'%s:' % target_key
-            dbg['target-revlog'] = target_revlog
-
-            if self._debug_info is not None:
-                self._debug_info.append(dbg)
-
-            if self._write_debug is not None:
-                msg = (
-                    b"DBG-DELTAS:"
-                    b" %-12s"
-                    b" rev=%d:"
-                    b" delta-base=%d"
-                    b" is-cached=%d"
-                    b" - search-rounds=%d"
-                    b" try-count=%d"
-                    b" - delta-type=%-6s"
-                    b" snap-depth=%d"
-                    b" - p1-chain-length=%d"
-                    b" p2-chain-length=%d"
-                    b" - duration=%f"
-                    b"\n"
-                )
-                msg %= (
-                    dbg["target-revlog"],
-                    dbg["revision"],
-                    dbg["delta-base"],
-                    dbg["using-cached-base"],
-                    dbg["search_round_count"],
-                    dbg["delta_try_count"],
-                    dbg["type"],
-                    dbg["snapshot-depth"],
-                    dbg["p1-chain-len"],
-                    dbg["p2-chain-len"],
-                    dbg["duration"],
-                )
-                self._write_debug(msg)
+            self._dbg_process_data(dbg)
         return deltainfo
 
+    def _one_dbg_data(self):
+        return {
+            'duration': None,
+            'revision': None,
+            'delta-base': None,
+            'search_round_count': None,
+            'using-cached-base': None,
+            'delta_try_count': None,
+            'type': None,
+            'p1-chain-len': None,
+            'p2-chain-len': None,
+            'snapshot-depth': None,
+            'target-revlog': None,
+        }
+
+    def _dbg_process_data(self, dbg):
+        if self._debug_info is not None:
+            self._debug_info.append(dbg)
+
+        if self._write_debug is not None:
+            msg = (
+                b"DBG-DELTAS:"
+                b" %-12s"
+                b" rev=%d:"
+                b" delta-base=%d"
+                b" is-cached=%d"
+                b" - search-rounds=%d"
+                b" try-count=%d"
+                b" - delta-type=%-6s"
+                b" snap-depth=%d"
+                b" - p1-chain-length=%d"
+                b" p2-chain-length=%d"
+                b" - duration=%f"
+                b"\n"
+            )
+            msg %= (
+                dbg["target-revlog"],
+                dbg["revision"],
+                dbg["delta-base"],
+                dbg["using-cached-base"],
+                dbg["search_round_count"],
+                dbg["delta_try_count"],
+                dbg["type"],
+                dbg["snapshot-depth"],
+                dbg["p1-chain-len"],
+                dbg["p2-chain-len"],
+                dbg["duration"],
+            )
+            self._write_debug(msg)
+
 
 def delta_compression(default_compression_header, deltainfo):
     """return (COMPRESSION_MODE, deltainfo)
 
     used by revlog v2+ format to dispatch between PLAIN and DEFAULT
     compression.
     """
```

### Comparing `mercurial-6.4rc0/mercurial/revlogutils/docket.py` & `mercurial-6.5rc0/mercurial/revlogutils/docket.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/revlogutils/flagutil.py` & `mercurial-6.5rc0/mercurial/revlogutils/flagutil.py`

 * *Files 1% similar despite different names*

```diff
@@ -172,16 +172,20 @@
     for flag in orderedflags:
         # If a flagprocessor has been registered for a known flag, apply the
         # related operation transform and update result tuple.
         if flag & flags:
             vhash = True
 
             if flag not in revlog._flagprocessors:
+                hint = None
+                if flag == REVIDX_EXTSTORED:
+                    hint = _(b"the lfs extension must be enabled")
+
                 message = _(b"missing processor for flag '%#x'") % flag
-                raise revlog._flagserrorclass(message)
+                raise revlog._flagserrorclass(message, hint=hint)
 
             processor = revlog._flagprocessors[flag]
             if processor is not None:
                 readtransform, writetransform, rawtransform = processor
 
                 if operation == b'raw':
                     vhash = rawtransform(revlog, text)
```

### Comparing `mercurial-6.4rc0/mercurial/revlogutils/nodemap.py` & `mercurial-6.5rc0/mercurial/revlogutils/nodemap.py`

 * *Files 0% similar despite different names*

```diff
@@ -607,18 +607,18 @@
 
 # debug utility
 
 
 def check_data(ui, index, data):
     """verify that the provided nodemap data are valid for the given idex"""
     ret = 0
-    ui.status((b"revision in index:   %d\n") % len(index))
+    ui.status((b"revisions in index:   %d\n") % len(index))
     root, __ = parse_data(data)
     all_revs = set(_all_revisions(root))
-    ui.status((b"revision in nodemap: %d\n") % len(all_revs))
+    ui.status((b"revisions in nodemap: %d\n") % len(all_revs))
     for r in range(len(index)):
         if r not in all_revs:
             msg = b"  revision missing from nodemap: %d\n" % r
             ui.write_err(msg)
             ret = 1
         else:
             all_revs.remove(r)
@@ -633,15 +633,15 @@
                 b"%d != %d\n" % (r, nm_rev)
             )
             ui.write_err(msg)
             ret = 1
 
     if all_revs:
         for r in sorted(all_revs):
-            msg = b"  extra revision in  nodemap: %d\n" % r
+            msg = b"  extra revisions in  nodemap: %d\n" % r
             ui.write_err(msg)
         ret = 1
     return ret
 
 
 def _all_revisions(root):
     """return all revisions stored in a Trie"""
```

### Comparing `mercurial-6.4rc0/mercurial/revlogutils/randomaccessfile.py` & `mercurial-6.5rc0/mercurial/revlogutils/randomaccessfile.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/revlogutils/revlogv0.py` & `mercurial-6.5rc0/mercurial/revlogutils/revlogv0.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/revlogutils/rewrite.py` & `mercurial-6.5rc0/mercurial/revlogutils/rewrite.py`

 * *Files 1% similar despite different names*

```diff
@@ -804,16 +804,14 @@
             )
         yield d
 
 
 def repair_issue6528(
     ui, repo, dry_run=False, to_report=None, from_report=None, paranoid=False
 ):
-    from .. import store  # avoid cycle
-
     @contextlib.contextmanager
     def context():
         if dry_run or to_report:  # No need for locking
             yield
         else:
             with repo.wlock(), repo.lock():
                 yield
@@ -821,35 +819,30 @@
     if from_report:
         return _from_report(ui, repo, context, from_report, dry_run)
 
     report_entries = []
 
     with context():
         files = list(
-            (file_type, path)
-            for (file_type, path, _s) in repo.store.datafiles()
-            if path.endswith(b'.i') and file_type & store.FILEFLAGS_FILELOG
+            entry
+            for entry in repo.store.data_entries()
+            if entry.is_revlog and entry.is_filelog
         )
 
         progress = ui.makeprogress(
             _(b"looking for affected revisions"),
             unit=_(b"filelogs"),
             total=len(files),
         )
         found_nothing = True
 
-        for file_type, path in files:
-            if (
-                not path.endswith(b'.i')
-                or not file_type & store.FILEFLAGS_FILELOG
-            ):
-                continue
+        for entry in files:
             progress.increment()
-            filename = _get_filename_from_filelog_index(path)
-            fl = _filelog_from_filename(repo, filename)
+            filename = entry.target_id
+            fl = _filelog_from_filename(repo, entry.target_id)
 
             # Set of filerevs (or hex filenodes if `to_report`) that need fixing
             to_fix = set()
             metadata_cache = {}
             for filerev in fl.revs():
                 affected = _is_revision_affected_fast(
                     repo, fl, filerev, metadata_cache
@@ -857,16 +850,16 @@
                 if paranoid:
                     slow = _is_revision_affected(fl, filerev)
                     if slow != affected:
                         msg = _(b"paranoid check failed for '%s' at node %s")
                         node = binascii.hexlify(fl.node(filerev))
                         raise error.Abort(msg % (filename, node))
                 if affected:
-                    msg = b"found affected revision %d for filelog '%s'\n"
-                    ui.warn(msg % (filerev, path))
+                    msg = b"found affected revision %d for file '%s'\n"
+                    ui.warn(msg % (filerev, filename))
                     found_nothing = False
                     if not dry_run:
                         if to_report:
                             to_fix.add(binascii.hexlify(fl.node(filerev)))
                         else:
                             to_fix.add(filerev)
```

### Comparing `mercurial-6.4rc0/mercurial/revlogutils/sidedata.py` & `mercurial-6.5rc0/mercurial/revlogutils/sidedata.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/revset.py` & `mercurial-6.5rc0/mercurial/revset.py`

 * *Files 0% similar despite different names*

```diff
@@ -1963,14 +1963,20 @@
 
 
 def _phase(repo, subset, *targets):
     """helper to select all rev in <targets> phases"""
     return repo._phasecache.getrevset(repo, targets, subset)
 
 
+@predicate(b'_internal()', safe=True)
+def _internal(repo, subset, x):
+    getargs(x, 0, 0, _(b"_internal takes no arguments"))
+    return _phase(repo, subset, *phases.all_internal_phases)
+
+
 @predicate(b'_phase(idx)', safe=True)
 def phase(repo, subset, x):
     l = getargs(x, 1, 1, b"_phase requires one argument")
     target = getinteger(l[0], b"_phase expects a number")
     return _phase(repo, subset, target)
 
 
@@ -2057,15 +2063,15 @@
         return baseset()
 
 
 # for internal use
 @predicate(b'_notpublic', safe=True)
 def _notpublic(repo, subset, x):
     getargs(x, 0, 0, b"_notpublic takes no arguments")
-    return _phase(repo, subset, phases.draft, phases.secret)
+    return _phase(repo, subset, *phases.not_public_phases)
 
 
 # for internal use
 @predicate(b'_phaseandancestors(phasename, set)', safe=True)
 def _phaseandancestors(repo, subset, x):
     # equivalent to (phasename() & ancestors(set)) but more efficient
     # phasename could be one of 'draft', 'secret', or '_notpublic'
```

### Comparing `mercurial-6.4rc0/mercurial/revsetlang.py` & `mercurial-6.5rc0/mercurial/revsetlang.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/rewriteutil.py` & `mercurial-6.5rc0/mercurial/rewriteutil.py`

 * *Files 4% similar despite different names*

```diff
@@ -23,14 +23,29 @@
     scmutil,
     util,
 )
 
 
 NODE_RE = re.compile(br'\b[0-9a-f]{6,64}\b')
 
+# set of extra entry that should survive a rebase-like operation, extensible by extensions
+retained_extras_on_rebase = {
+    b'source',
+    b'intermediate-source',
+}
+
+
+def preserve_extras_on_rebase(old_ctx, new_extra):
+    """preserve the relevant `extra` entry from old_ctx on rebase-like operation"""
+    new_extra.update(
+        (key, value)
+        for key, value in old_ctx.extra().items()
+        if key in retained_extras_on_rebase
+    )
+
 
 def _formatrevs(repo, revs, maxrevs=4):
     """returns a string summarizing revisions in a decent size
 
     If there are few enough revisions, we list them all. Otherwise we display a
     summary of the form:
```

### Comparing `mercurial-6.4rc0/mercurial/scmposix.py` & `mercurial-6.5rc0/mercurial/scmposix.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/scmutil.py` & `mercurial-6.5rc0/mercurial/scmutil.py`

 * *Files 1% similar despite different names*

```diff
@@ -230,15 +230,15 @@
             reason = inst.reason
         if isinstance(reason, str):
             # SSLError of Python 2.7.9 contains a unicode
             reason = encoding.unitolocal(reason)
         ui.error(_(b"abort: error: %s\n") % stringutil.forcebytestr(reason))
     except (IOError, OSError) as inst:
         if (
-            util.safehasattr(inst, b"args")
+            util.safehasattr(inst, "args")
             and inst.args
             and inst.args[0] == errno.EPIPE
         ):
             pass
         elif getattr(inst, "strerror", None):  # common IOError or OSError
             if getattr(inst, "filename", None) is not None:
                 ui.error(
@@ -1062,15 +1062,15 @@
     obsolescence is enabled.
     """
     assert fixphase or targetphase is None
     if not replacements and not moves:
         return
 
     # translate mapping's other forms
-    if not util.safehasattr(replacements, b'items'):
+    if not util.safehasattr(replacements, 'items'):
         replacements = {(n,): () for n in replacements}
     else:
         # upgrading non tuple "source" to tuple ones for BC
         repls = {}
         for key, value in replacements.items():
             if not isinstance(key, tuple):
                 key = (key,)
@@ -2309,7 +2309,17 @@
         b"ancestors(bookmark(%s)) - "
         b"ancestors(head() and not bookmark(%s)) - "
         b"ancestors(bookmark() and not bookmark(%s))",
         mark,
         mark,
         mark,
     )
+
+
+def ismember(ui, username, userlist):
+    """Check if username is a member of userlist.
+
+    If userlist has a single '*' member, all users are considered members.
+    Can be overridden by extensions to provide more complex authorization
+    schemes.
+    """
+    return userlist == [b'*'] or username in userlist
```

### Comparing `mercurial-6.4rc0/mercurial/scmwindows.py` & `mercurial-6.5rc0/mercurial/scmwindows.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/server.py` & `mercurial-6.5rc0/mercurial/server.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/setdiscovery.py` & `mercurial-6.5rc0/mercurial/setdiscovery.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/shelve.py` & `mercurial-6.5rc0/mercurial/shelve.py`

 * *Files 0% similar despite different names*

```diff
@@ -512,15 +512,15 @@
                 seen.add(rev)
                 if parent.mutable():
                     visit.append(parent)
 
 
 def getcommitfunc(extra, interactive, editor=False):
     def commitfunc(ui, repo, message, match, opts):
-        hasmq = util.safehasattr(repo, b'mq')
+        hasmq = util.safehasattr(repo, 'mq')
         if hasmq:
             saved, repo.mq.checkapplied = repo.mq.checkapplied, False
 
         targetphase = _target_phase(repo)
         overrides = {(b'phases', b'new-commit'): targetphase}
         try:
             editor_ = False
```

### Comparing `mercurial-6.4rc0/mercurial/similar.py` & `mercurial-6.5rc0/mercurial/similar.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/simplemerge.py` & `mercurial-6.5rc0/mercurial/simplemerge.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/smartset.py` & `mercurial-6.5rc0/mercurial/smartset.py`

 * *Files 0% similar despite different names*

```diff
@@ -133,15 +133,15 @@
 
         `condition` is a callable which takes a revision number and returns a
         boolean. Optional `condrepr` provides a printable representation of
         the given `condition`.
 
         This is part of the mandatory API for smartset."""
         # builtin cannot be cached. but do not needs to
-        if cache and util.safehasattr(condition, b'__code__'):
+        if cache and util.safehasattr(condition, '__code__'):
             condition = util.cachefunc(condition)
         return filteredset(self, condition, condrepr)
 
     def slice(self, start, stop):
         """Return new smartset that contains selected elements from this set"""
         if start < 0 or stop < 0:
             raise error.ProgrammingError(b'negative index not allowed')
@@ -664,17 +664,17 @@
                     if not inr1(r):
                         yield r
 
             return arbitraryordergen()
         # try to use our own fast iterator if it exists
         self._trysetasclist()
         if self._ascending:
-            attr = b'fastasc'
+            attr = 'fastasc'
         else:
-            attr = b'fastdesc'
+            attr = 'fastdesc'
         it = getattr(self, attr)
         if it is not None:
             return it()
         # maybe half of the component supports fast
         # get iterator for _r1
         iter1 = getattr(self._r1, attr)
         if iter1 is None:
@@ -1123,15 +1123,15 @@
     def __and__(self, other):
         """As self contains the whole repo, all of the other set should also be
         in self. Therefore `self & other = other`.
 
         This boldly assumes the other contains valid revs only.
         """
         # other not a smartset, make is so
-        if not util.safehasattr(other, b'isascending'):
+        if not util.safehasattr(other, 'isascending'):
             # filter out hidden revision
             # (this boldly assumes all smartset are pure)
             #
             # `other` was used with "&", let's assume this is a set like
             # object.
             other = baseset(other - self._hiddenrevs)
```

### Comparing `mercurial-6.4rc0/mercurial/sparse.py` & `mercurial-6.5rc0/mercurial/sparse.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/sshpeer.py` & `mercurial-6.5rc0/mercurial/sshpeer.py`

 * *Files 6% similar despite different names*

```diff
@@ -173,26 +173,32 @@
         # not very predictable when exceptions are thrown, which has led
         # to deadlocks due to a peer get gc'ed in a fork
         # We add our own stack trace, because the stacktrace when called
         # from __del__ is useless.
         ui.develwarn(b'missing close on SSH connection created at:\n%s' % warn)
 
 
-def _makeconnection(ui, sshcmd, args, remotecmd, path, sshenv=None):
+def _makeconnection(
+    ui, sshcmd, args, remotecmd, path, sshenv=None, remotehidden=False
+):
     """Create an SSH connection to a server.
 
     Returns a tuple of (process, stdin, stdout, stderr) for the
     spawned process.
     """
     cmd = b'%s %s %s' % (
         sshcmd,
         args,
         procutil.shellquote(
-            b'%s -R %s serve --stdio'
-            % (_serverquote(remotecmd), _serverquote(path))
+            b'%s -R %s serve --stdio%s'
+            % (
+                _serverquote(remotecmd),
+                _serverquote(path),
+                b' --hidden' if remotehidden else b'',
+            )
         ),
     )
 
     ui.debug(b'running %s\n' % cmd)
 
     # no buffer allow the use of 'select'
     # feel free to remove buffering and select usage when we ultimately
@@ -368,26 +374,35 @@
     _forwardoutput(ui, stderr, warn=True)
 
     return protoname, caps
 
 
 class sshv1peer(wireprotov1peer.wirepeer):
     def __init__(
-        self, ui, path, proc, stdin, stdout, stderr, caps, autoreadstderr=True
+        self,
+        ui,
+        path,
+        proc,
+        stdin,
+        stdout,
+        stderr,
+        caps,
+        autoreadstderr=True,
+        remotehidden=False,
     ):
         """Create a peer from an existing SSH connection.
 
         ``proc`` is a handle on the underlying SSH process.
         ``stdin``, ``stdout``, and ``stderr`` are handles on the stdio
         pipes for that process.
         ``caps`` is a set of capabilities supported by the remote.
         ``autoreadstderr`` denotes whether to automatically read from
         stderr and to forward its output.
         """
-        super().__init__(ui, path=path)
+        super().__init__(ui, path=path, remotehidden=remotehidden)
         # self._subprocess is unused. Keeping a handle on the process
         # holds a reference and prevents it from being garbage collected.
         self._subprocess = proc
 
         # And we hook up our "doublepipe" wrapper to allow querying
         # stderr any time we perform I/O.
         if autoreadstderr:
@@ -396,14 +411,15 @@
 
         self._pipeo = stdin
         self._pipei = stdout
         self._pipee = stderr
         self._caps = caps
         self._autoreadstderr = autoreadstderr
         self._initstack = b''.join(util.getstackframes(1))
+        self._remotehidden = remotehidden
 
     # Commands that have a "framed" response where the first line of the
     # response contains the length of that response.
     _FRAMED_COMMANDS = {
         b'batch',
     }
 
@@ -564,15 +580,24 @@
             self._pipeo.write(data)
         if flush:
             self._pipeo.flush()
         if self._autoreadstderr:
             self._readerr()
 
 
-def makepeer(ui, path, proc, stdin, stdout, stderr, autoreadstderr=True):
+def _make_peer(
+    ui,
+    path,
+    proc,
+    stdin,
+    stdout,
+    stderr,
+    autoreadstderr=True,
+    remotehidden=False,
+):
     """Make a peer instance from existing pipes.
 
     ``path`` and ``proc`` are stored on the eventual peer instance and may
     not be used for anything meaningful.
 
     ``stdin``, ``stdout``, and ``stderr`` are the pipes connected to the
     SSH server's stdio handles.
@@ -594,23 +619,26 @@
             path,
             proc,
             stdin,
             stdout,
             stderr,
             caps,
             autoreadstderr=autoreadstderr,
+            remotehidden=remotehidden,
         )
     else:
         _cleanuppipes(ui, stdout, stdin, stderr, warn=None)
         raise error.RepoError(
             _(b'unknown version of SSH protocol: %s') % protoname
         )
 
 
-def make_peer(ui, path, create, intents=None, createopts=None):
+def make_peer(
+    ui, path, create, intents=None, createopts=None, remotehidden=False
+):
     """Create an SSH peer.
 
     The returned object conforms to the ``wireprotov1peer.wirepeer`` interface.
     """
     u = urlutil.url(path.loc, parsequery=False, parsefragment=False)
     if u.scheme != b'ssh' or not u.host or u.path is None:
         raise error.RepoError(_(b"couldn't parse location %s") % path)
@@ -651,18 +679,26 @@
         )
         ui.debug(b'running %s\n' % cmd)
         res = ui.system(cmd, blockedtag=b'sshpeer', environ=sshenv)
         if res != 0:
             raise error.RepoError(_(b'could not create remote repo'))
 
     proc, stdin, stdout, stderr = _makeconnection(
-        ui, sshcmd, args, remotecmd, remotepath, sshenv
+        ui,
+        sshcmd,
+        args,
+        remotecmd,
+        remotepath,
+        sshenv,
+        remotehidden=remotehidden,
     )
 
-    peer = makepeer(ui, path, proc, stdin, stdout, stderr)
+    peer = _make_peer(
+        ui, path, proc, stdin, stdout, stderr, remotehidden=remotehidden
+    )
 
     # Finally, if supported by the server, notify it about our own
     # capabilities.
     if b'protocaps' in peer.capabilities():
         try:
             peer._call(
                 b"protocaps", caps=b' '.join(sorted(_clientcapabilities()))
```

### Comparing `mercurial-6.4rc0/mercurial/sslutil.py` & `mercurial-6.5rc0/mercurial/sslutil.py`

 * *Files 1% similar despite different names*

```diff
@@ -118,15 +118,15 @@
 
     # If --insecure is used, we allow the use of TLS 1.0 despite config options.
     # We always print a "connection security to %s is disabled..." message when
     # --insecure is used. So no need to print anything more here.
     if ui.insecureconnections:
         minimumprotocol = b'tls1.0'
         if not ciphers:
-            ciphers = b'DEFAULT'
+            ciphers = b'DEFAULT:@SECLEVEL=0'
 
     s[b'minimumprotocol'] = minimumprotocol
     s[b'ciphers'] = ciphers
 
     # Look for fingerprints in [hostsecurity] section. Value is a list
     # of <alg>:<fingerprint> strings.
     fingerprints = ui.configlist(
@@ -415,15 +415,15 @@
                         b'error)\n'
                     )
                 )
         except ssl.SSLError:
             pass
 
         # Try to print more helpful error messages for known failures.
-        if util.safehasattr(e, b'reason'):
+        if util.safehasattr(e, 'reason'):
             # This error occurs when the client and server don't share a
             # common/supported SSL/TLS protocol. We've disabled SSLv2 and SSLv3
             # outright. Hopefully the reason for this error is that we require
             # TLS 1.1+ and the server only supports TLS 1.0. Whatever the
             # reason, try to emit an actionable warning.
             if e.reason in (
                 'UNSUPPORTED_PROTOCOL',
@@ -549,15 +549,15 @@
     if util.safehasattr(ssl, 'TLSVersion'):
         # python 3.7+
         sslcontext = ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER)
         sslcontext.options |= getattr(ssl, 'OP_NO_COMPRESSION', 0)
 
         # This config option is intended for use in tests only. It is a giant
         # footgun to kill security. Don't define it.
-        exactprotocol = ui.config(b'devel', b'serverexactprotocol')
+        exactprotocol = ui.config(b'devel', b'server-insecure-exact-protocol')
         if exactprotocol == b'tls1.0':
             if b'tls1.0' not in supportedprotocols:
                 raise error.Abort(_(b'TLS 1.0 not supported by this Python'))
             with warnings.catch_warnings():
                 warnings.filterwarnings(
                     'ignore',
                     'ssl.TLSVersion.TLSv1 is deprecated',
@@ -579,41 +579,43 @@
         elif exactprotocol == b'tls1.2':
             if b'tls1.2' not in supportedprotocols:
                 raise error.Abort(_(b'TLS 1.2 not supported by this Python'))
             sslcontext.minimum_version = ssl.TLSVersion.TLSv1_2
             sslcontext.maximum_version = ssl.TLSVersion.TLSv1_2
         elif exactprotocol:
             raise error.Abort(
-                _(b'invalid value for serverexactprotocol: %s') % exactprotocol
+                _(b'invalid value for server-insecure-exact-protocol: %s')
+                % exactprotocol
             )
     else:
         # Despite its name, PROTOCOL_SSLv23 selects the highest protocol that both
         # ends support, including TLS protocols. commonssloptions() restricts the
         # set of allowed protocols.
         protocol = ssl.PROTOCOL_SSLv23
         options = commonssloptions(b'tls1.0')
 
         # This config option is intended for use in tests only. It is a giant
         # footgun to kill security. Don't define it.
-        exactprotocol = ui.config(b'devel', b'serverexactprotocol')
+        exactprotocol = ui.config(b'devel', b'server-insecure-exact-protocol')
         if exactprotocol == b'tls1.0':
             if b'tls1.0' not in supportedprotocols:
                 raise error.Abort(_(b'TLS 1.0 not supported by this Python'))
             protocol = ssl.PROTOCOL_TLSv1
         elif exactprotocol == b'tls1.1':
             if b'tls1.1' not in supportedprotocols:
                 raise error.Abort(_(b'TLS 1.1 not supported by this Python'))
             protocol = ssl.PROTOCOL_TLSv1_1
         elif exactprotocol == b'tls1.2':
             if b'tls1.2' not in supportedprotocols:
                 raise error.Abort(_(b'TLS 1.2 not supported by this Python'))
             protocol = ssl.PROTOCOL_TLSv1_2
         elif exactprotocol:
             raise error.Abort(
-                _(b'invalid value for serverexactprotocol: %s') % exactprotocol
+                _(b'invalid value for server-insecure-exact-protocol: %s')
+                % exactprotocol
             )
 
         # We /could/ use create_default_context() here since it doesn't load
         # CAs when configured for client auth. However, it is hard-coded to
         # use ssl.PROTOCOL_SSLv23 which may not be appropriate here.
         sslcontext = ssl.SSLContext(protocol)
         sslcontext.options |= options
@@ -621,16 +623,16 @@
     # Improve forward secrecy.
     sslcontext.options |= getattr(ssl, 'OP_SINGLE_DH_USE', 0)
     sslcontext.options |= getattr(ssl, 'OP_SINGLE_ECDH_USE', 0)
 
     # In tests, allow insecure ciphers
     # Otherwise, use the list of more secure ciphers if found in the ssl module.
     if exactprotocol:
-        sslcontext.set_ciphers('DEFAULT')
-    elif util.safehasattr(ssl, b'_RESTRICTED_SERVER_CIPHERS'):
+        sslcontext.set_ciphers('DEFAULT:@SECLEVEL=0')
+    elif util.safehasattr(ssl, '_RESTRICTED_SERVER_CIPHERS'):
         sslcontext.options |= getattr(ssl, 'OP_CIPHER_SERVER_PREFERENCE', 0)
         # pytype: disable=module-attr
         sslcontext.set_ciphers(ssl._RESTRICTED_SERVER_CIPHERS)
         # pytype: enable=module-attr
 
     if requireclientcert:
         sslcontext.verify_mode = ssl.CERT_REQUIRED
```

### Comparing `mercurial-6.4rc0/mercurial/stack.py` & `mercurial-6.5rc0/mercurial/stack.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/state.py` & `mercurial-6.5rc0/mercurial/state.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/statichttprepo.py` & `mercurial-6.5rc0/mercurial/statichttprepo.py`

 * *Files 7% similar despite different names*

```diff
@@ -115,36 +115,36 @@
         r = urlreq.addinfourl(fp, hdrs, req.get_full_url())
         r.code = code
         r.msg = msg
         return r
 
     def http_error_416(self, req, fp, code, msg, hdrs):
         # HTTP's Range Not Satisfiable error
-        raise _RangeError(b'Requested Range Not Satisfiable')
+        raise _RangeError('Requested Range Not Satisfiable')
 
 
 def build_opener(ui, authinfo):
     # urllib cannot handle URLs with embedded user or passwd
     urlopener = url.opener(ui, authinfo)
     urlopener.add_handler(_HTTPRangeHandler())
 
     class statichttpvfs(vfsmod.abstractvfs):
         def __init__(self, base):
             self.base = base
             self.options = {}
 
         def __call__(self, path, mode=b'r', *args, **kw):
             if mode not in (b'r', b'rb'):
-                raise IOError(b'Permission denied')
+                raise IOError('Permission denied')
             f = b"/".join((self.base, urlreq.quote(path)))
             return httprangereader(f, urlopener)
 
-        def join(self, path):
+        def join(self, path, *insidef):
             if path:
-                return pathutil.join(self.base, path)
+                return pathutil.join(self.base, path, *insidef)
             else:
                 return self.base
 
     return statichttpvfs
 
 
 class statichttppeer(localrepo.localpeer):
@@ -233,16 +233,16 @@
 
     def url(self):
         return self._url
 
     def local(self):
         return False
 
-    def peer(self, path=None):
-        return statichttppeer(self, path=path)
+    def peer(self, path=None, remotehidden=False):
+        return statichttppeer(self, path=path, remotehidden=remotehidden)
 
     def wlock(self, wait=True):
         raise error.LockUnavailable(
             0,
             _(b'lock not available'),
             b'lock',
             _(b'cannot lock static-http repository'),
@@ -256,12 +256,16 @@
             _(b'cannot lock static-http repository'),
         )
 
     def _writecaches(self):
         pass  # statichttprepository are read only
 
 
-def make_peer(ui, path, create, intents=None, createopts=None):
+def make_peer(
+    ui, path, create, intents=None, createopts=None, remotehidden=False
+):
     if create:
         raise error.Abort(_(b'cannot create new static-http repository'))
     url = path.loc[7:]
-    return statichttprepository(ui, url).peer(path=path)
+    return statichttprepository(ui, url).peer(
+        path=path, remotehidden=remotehidden
+    )
```

### Comparing `mercurial-6.4rc0/mercurial/statprof.py` & `mercurial-6.5rc0/mercurial/statprof.py`

 * *Files 1% similar despite different names*

```diff
@@ -536,15 +536,19 @@
     fp.write(
         b'%5.5s  %9.9s  %8.8s  %-8.8s\n'
         % (b"time", b"seconds", b"seconds", b"name")
     )
 
     for stat in stats:
         site = stat.site
-        sitelabel = b'%s:%d:%s' % (site.filename(), site.lineno, site.function)
+        sitelabel = b'%s:%d:%s' % (
+            site.filename(),
+            site.lineno or -1,
+            site.function,
+        )
         fp.write(
             b'%6.2f %9.2f %9.2f  %s\n'
             % (
                 stat.selfpercent(),
                 stat.totalseconds(),
                 stat.selfseconds(),
                 sitelabel,
@@ -609,15 +613,15 @@
                 source = stat.site.getsource(25)
                 if not isinstance(source, bytes):
                     source = pycompat.bytestr(source)
 
                 stattuple = (
                     stat.selfpercent(),
                     stat.selfseconds(),
-                    stat.site.lineno,
+                    stat.site.lineno or -1,
                     source,
                 )
 
                 fp.write(b'%33.0f%% %6.2f   line %d: %s\n' % stattuple)
 
 
 def display_about_method(data, fp, function=None, **kwargs):
```

### Comparing `mercurial-6.4rc0/mercurial/store.py` & `mercurial-6.5rc0/mercurial/store.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,55 +1,63 @@
-# store.py - repository store handling for Mercurial
+# store.py - repository store handling for Mercurial)
 #
 # Copyright 2008 Olivia Mackall <olivia@selenic.com>
 #
 # This software may be used and distributed according to the terms of the
 # GNU General Public License version 2 or any later version.
 
-
+import collections
 import functools
 import os
 import re
 import stat
+from typing import Generator, List
 
 from .i18n import _
 from .pycompat import getattr
+from .thirdparty import attr
 from .node import hex
+from .revlogutils.constants import (
+    INDEX_HEADER,
+    KIND_CHANGELOG,
+    KIND_FILELOG,
+    KIND_MANIFESTLOG,
+)
 from . import (
     changelog,
     error,
+    filelog,
     manifest,
     policy,
     pycompat,
+    revlog as revlogmod,
     util,
     vfs as vfsmod,
 )
 from .utils import hashutil
 
 parsers = policy.importmod('parsers')
 # how much bytes should be read from fncache in one read
 # It is done to prevent loading large fncache files into memory
 fncache_chunksize = 10 ** 6
 
 
-def _matchtrackedpath(path, matcher):
+def _match_tracked_entry(entry, matcher):
     """parses a fncache entry and returns whether the entry is tracking a path
     matched by matcher or not.
 
     If matcher is None, returns True"""
 
     if matcher is None:
         return True
-    path = decodedir(path)
-    if path.startswith(b'data/'):
-        return matcher(path[len(b'data/') : -len(b'.i')])
-    elif path.startswith(b'meta/'):
-        return matcher.visitdir(path[len(b'meta/') : -len(b'/00manifest.i')])
-
-    raise error.ProgrammingError(b"cannot decode path %s" % path)
+    if entry.is_filelog:
+        return matcher(entry.target_id)
+    elif entry.is_manifestlog:
+        return matcher.visitdir(entry.target_id.rstrip(b'/'))
+    raise error.ProgrammingError(b"cannot process entry %r" % entry)
 
 
 # This avoids a collision between a file named foo and a dir named
 # foo.i or foo.d
 def _encodedir(path):
     """
     >>> _encodedir(b'data/foo.i')
@@ -380,80 +388,363 @@
     b'00changelog.d',
     b'00changelog.i',
     b'phaseroots',
     b'obsstore',
     b'requires',
 ]
 
-REVLOG_FILES_MAIN_EXT = (b'.i', b'i.tmpcensored')
-REVLOG_FILES_OTHER_EXT = (
+REVLOG_FILES_EXT = (
+    b'.i',
     b'.idx',
     b'.d',
     b'.dat',
     b'.n',
     b'.nd',
     b'.sda',
-    b'd.tmpcensored',
+)
+# file extension that also use a `-SOMELONGIDHASH.ext` form
+REVLOG_FILES_LONG_EXT = (
+    b'.nd',
+    b'.idx',
+    b'.dat',
+    b'.sda',
 )
 # files that are "volatile" and might change between listing and streaming
 #
 # note: the ".nd" file are nodemap data and won't "change" but they might be
 # deleted.
 REVLOG_FILES_VOLATILE_EXT = (b'.n', b'.nd')
 
 # some exception to the above matching
 #
 # XXX This is currently not in use because of issue6542
-EXCLUDED = re.compile(b'.*undo\.[^/]+\.(nd?|i)$')
+EXCLUDED = re.compile(br'.*undo\.[^/]+\.(nd?|i)$')
 
 
 def is_revlog(f, kind, st):
     if kind != stat.S_IFREG:
-        return None
-    return revlog_type(f)
+        return False
+    if f.endswith(REVLOG_FILES_EXT):
+        return True
+    return False
+
 
+def is_revlog_file(f):
+    if f.endswith(REVLOG_FILES_EXT):
+        return True
+    return False
 
-def revlog_type(f):
-    # XXX we need to filter `undo.` created by the transaction here, however
-    # being naive about it also filter revlog for `undo.*` files, leading to
-    # issue6542. So we no longer use EXCLUDED.
-    if f.endswith(REVLOG_FILES_MAIN_EXT):
-        return FILEFLAGS_REVLOG_MAIN
-    elif f.endswith(REVLOG_FILES_OTHER_EXT):
-        t = FILETYPE_FILELOG_OTHER
-        if f.endswith(REVLOG_FILES_VOLATILE_EXT):
-            t |= FILEFLAGS_VOLATILE
-        return t
-    return None
-
-
-# the file is part of changelog data
-FILEFLAGS_CHANGELOG = 1 << 13
-# the file is part of manifest data
-FILEFLAGS_MANIFESTLOG = 1 << 12
-# the file is part of filelog data
-FILEFLAGS_FILELOG = 1 << 11
-# file that are not directly part of a revlog
-FILEFLAGS_OTHER = 1 << 10
-
-# the main entry point for a revlog
-FILEFLAGS_REVLOG_MAIN = 1 << 1
-# a secondary file for a revlog
-FILEFLAGS_REVLOG_OTHER = 1 << 0
 
-# files that are "volatile" and might change between listing and streaming
-FILEFLAGS_VOLATILE = 1 << 20
+@attr.s(slots=True)
+class StoreFile:
+    """a file matching a store entry"""
+
+    unencoded_path = attr.ib()
+    _file_size = attr.ib(default=None)
+    is_volatile = attr.ib(default=False)
+
+    def file_size(self, vfs):
+        if self._file_size is None:
+            if vfs is None:
+                msg = b"calling vfs-less file_size without prior call: %s"
+                msg %= self.unencoded_path
+                raise error.ProgrammingError(msg)
+            try:
+                self._file_size = vfs.stat(self.unencoded_path).st_size
+            except FileNotFoundError:
+                self._file_size = 0
+        return self._file_size
+
+    def get_stream(self, vfs, copies):
+        """return data "stream" information for this file
+
+        (unencoded_file_path, content_iterator, content_size)
+        """
+        size = self.file_size(None)
+
+        def get_stream():
+            actual_path = copies[vfs.join(self.unencoded_path)]
+            with open(actual_path, 'rb') as fp:
+                yield None  # ready to stream
+                if size <= 65536:
+                    yield fp.read(size)
+                else:
+                    yield from util.filechunkiter(fp, limit=size)
+
+        s = get_stream()
+        next(s)
+        return (self.unencoded_path, s, size)
+
+
+@attr.s(slots=True, init=False)
+class BaseStoreEntry:
+    """An entry in the store
+
+    This is returned by `store.walk` and represent some data in the store."""
+
+    def files(self) -> List[StoreFile]:
+        raise NotImplementedError
 
-FILETYPE_CHANGELOG_MAIN = FILEFLAGS_CHANGELOG | FILEFLAGS_REVLOG_MAIN
-FILETYPE_CHANGELOG_OTHER = FILEFLAGS_CHANGELOG | FILEFLAGS_REVLOG_OTHER
-FILETYPE_MANIFESTLOG_MAIN = FILEFLAGS_MANIFESTLOG | FILEFLAGS_REVLOG_MAIN
-FILETYPE_MANIFESTLOG_OTHER = FILEFLAGS_MANIFESTLOG | FILEFLAGS_REVLOG_OTHER
-FILETYPE_FILELOG_MAIN = FILEFLAGS_FILELOG | FILEFLAGS_REVLOG_MAIN
-FILETYPE_FILELOG_OTHER = FILEFLAGS_FILELOG | FILEFLAGS_REVLOG_OTHER
-FILETYPE_OTHER = FILEFLAGS_OTHER
+    def get_streams(
+        self,
+        repo=None,
+        vfs=None,
+        copies=None,
+        max_changeset=None,
+        preserve_file_count=False,
+    ):
+        """return a list of data stream associated to files for this entry
+
+        return [(unencoded_file_path, content_iterator, content_size), …]
+        """
+        assert vfs is not None
+        return [f.get_stream(vfs, copies) for f in self.files()]
+
+
+@attr.s(slots=True, init=False)
+class SimpleStoreEntry(BaseStoreEntry):
+    """A generic entry in the store"""
+
+    is_revlog = False
+
+    _entry_path = attr.ib()
+    _is_volatile = attr.ib(default=False)
+    _file_size = attr.ib(default=None)
+    _files = attr.ib(default=None)
+
+    def __init__(
+        self,
+        entry_path,
+        is_volatile=False,
+        file_size=None,
+    ):
+        super().__init__()
+        self._entry_path = entry_path
+        self._is_volatile = is_volatile
+        self._file_size = file_size
+        self._files = None
+
+    def files(self) -> List[StoreFile]:
+        if self._files is None:
+            self._files = [
+                StoreFile(
+                    unencoded_path=self._entry_path,
+                    file_size=self._file_size,
+                    is_volatile=self._is_volatile,
+                )
+            ]
+        return self._files
+
+
+@attr.s(slots=True, init=False)
+class RevlogStoreEntry(BaseStoreEntry):
+    """A revlog entry in the store"""
+
+    is_revlog = True
+
+    revlog_type = attr.ib(default=None)
+    target_id = attr.ib(default=None)
+    _path_prefix = attr.ib(default=None)
+    _details = attr.ib(default=None)
+    _files = attr.ib(default=None)
+
+    def __init__(
+        self,
+        revlog_type,
+        path_prefix,
+        target_id,
+        details,
+    ):
+        super().__init__()
+        self.revlog_type = revlog_type
+        self.target_id = target_id
+        self._path_prefix = path_prefix
+        assert b'.i' in details, (path_prefix, details)
+        self._details = details
+        self._files = None
+
+    @property
+    def is_changelog(self):
+        return self.revlog_type == KIND_CHANGELOG
+
+    @property
+    def is_manifestlog(self):
+        return self.revlog_type == KIND_MANIFESTLOG
+
+    @property
+    def is_filelog(self):
+        return self.revlog_type == KIND_FILELOG
+
+    def main_file_path(self):
+        """unencoded path of the main revlog file"""
+        return self._path_prefix + b'.i'
+
+    def files(self) -> List[StoreFile]:
+        if self._files is None:
+            self._files = []
+            for ext in sorted(self._details, key=_ext_key):
+                path = self._path_prefix + ext
+                file_size = self._details[ext]
+                # files that are "volatile" and might change between
+                # listing and streaming
+                #
+                # note: the ".nd" file are nodemap data and won't "change"
+                # but they might be deleted.
+                volatile = ext.endswith(REVLOG_FILES_VOLATILE_EXT)
+                f = StoreFile(path, file_size, volatile)
+                self._files.append(f)
+        return self._files
+
+    def get_streams(
+        self,
+        repo=None,
+        vfs=None,
+        copies=None,
+        max_changeset=None,
+        preserve_file_count=False,
+    ):
+        if (
+            repo is None
+            or max_changeset is None
+            # This use revlog-v2, ignore for now
+            or any(k.endswith(b'.idx') for k in self._details.keys())
+            # This is not inline, no race expected
+            or b'.d' in self._details
+        ):
+            return super().get_streams(
+                repo=repo,
+                vfs=vfs,
+                copies=copies,
+                max_changeset=max_changeset,
+                preserve_file_count=preserve_file_count,
+            )
+        elif not preserve_file_count:
+            stream = [
+                f.get_stream(vfs, copies)
+                for f in self.files()
+                if not f.unencoded_path.endswith((b'.i', b'.d'))
+            ]
+            rl = self.get_revlog_instance(repo).get_revlog()
+            rl_stream = rl.get_streams(max_changeset)
+            stream.extend(rl_stream)
+            return stream
+
+        name_to_size = {}
+        for f in self.files():
+            name_to_size[f.unencoded_path] = f.file_size(None)
+
+        stream = [
+            f.get_stream(vfs, copies)
+            for f in self.files()
+            if not f.unencoded_path.endswith(b'.i')
+        ]
+
+        index_path = self._path_prefix + b'.i'
+
+        index_file = None
+        try:
+            index_file = vfs(index_path)
+            header = index_file.read(INDEX_HEADER.size)
+            if revlogmod.revlog.is_inline_index(header):
+                size = name_to_size[index_path]
+
+                # no split underneath, just return the stream
+                def get_stream():
+                    fp = index_file
+                    try:
+                        fp.seek(0)
+                        yield None
+                        if size <= 65536:
+                            yield fp.read(size)
+                        else:
+                            yield from util.filechunkiter(fp, limit=size)
+                    finally:
+                        fp.close()
+
+                s = get_stream()
+                next(s)
+                index_file = None
+                stream.append((index_path, s, size))
+            else:
+                rl = self.get_revlog_instance(repo).get_revlog()
+                rl_stream = rl.get_streams(max_changeset, force_inline=True)
+                for name, s, size in rl_stream:
+                    if name_to_size.get(name, 0) != size:
+                        msg = _(b"expected %d bytes but %d provided for %s")
+                        msg %= name_to_size.get(name, 0), size, name
+                        raise error.Abort(msg)
+                stream.extend(rl_stream)
+        finally:
+            if index_file is not None:
+                index_file.close()
+
+        files = self.files()
+        assert len(stream) == len(files), (
+            stream,
+            files,
+            self._path_prefix,
+            self.target_id,
+        )
+        return stream
+
+    def get_revlog_instance(self, repo):
+        """Obtain a revlog instance from this store entry
+
+        An instance of the appropriate class is returned.
+        """
+        if self.is_changelog:
+            return changelog.changelog(repo.svfs)
+        elif self.is_manifestlog:
+            mandir = self.target_id
+            return manifest.manifestrevlog(
+                repo.nodeconstants, repo.svfs, tree=mandir
+            )
+        else:
+            return filelog.filelog(repo.svfs, self.target_id)
+
+
+def _gather_revlog(files_data):
+    """group files per revlog prefix
+
+    The returns a two level nested dict. The top level key is the revlog prefix
+    without extension, the second level is all the file "suffix" that were
+    seen for this revlog and arbitrary file data as value.
+    """
+    revlogs = collections.defaultdict(dict)
+    for u, value in files_data:
+        name, ext = _split_revlog_ext(u)
+        revlogs[name][ext] = value
+    return sorted(revlogs.items())
+
+
+def _split_revlog_ext(filename):
+    """split the revlog file prefix from the variable extension"""
+    if filename.endswith(REVLOG_FILES_LONG_EXT):
+        char = b'-'
+    else:
+        char = b'.'
+    idx = filename.rfind(char)
+    return filename[:idx], filename[idx:]
+
+
+def _ext_key(ext):
+    """a key to order revlog suffix
+
+    important to issue .i after other entry."""
+    # the only important part of this order is to keep the `.i` last.
+    if ext.endswith(b'.n'):
+        return (0, ext)
+    elif ext.endswith(b'.nd'):
+        return (10, ext)
+    elif ext.endswith(b'.d'):
+        return (20, ext)
+    elif ext.endswith(b'.i'):
+        return (50, ext)
+    else:
+        return (40, ext)
 
 
 class basicstore:
     '''base class for local repository stores'''
 
     def __init__(self, path, vfstype):
         vfs = vfstype(path)
@@ -463,82 +754,139 @@
         self.rawvfs = vfs
         self.vfs = vfsmod.filtervfs(vfs, encodedir)
         self.opener = self.vfs
 
     def join(self, f):
         return self.path + b'/' + encodedir(f)
 
-    def _walk(self, relpath, recurse):
+    def _walk(self, relpath, recurse, undecodable=None):
         '''yields (revlog_type, unencoded, size)'''
         path = self.path
         if relpath:
             path += b'/' + relpath
         striplen = len(self.path) + 1
         l = []
         if self.rawvfs.isdir(path):
             visit = [path]
             readdir = self.rawvfs.readdir
             while visit:
                 p = visit.pop()
                 for f, kind, st in readdir(p, stat=True):
                     fp = p + b'/' + f
-                    rl_type = is_revlog(f, kind, st)
-                    if rl_type is not None:
+                    if is_revlog(f, kind, st):
                         n = util.pconvert(fp[striplen:])
-                        l.append((rl_type, decodedir(n), st.st_size))
+                        l.append((decodedir(n), st.st_size))
                     elif kind == stat.S_IFDIR and recurse:
                         visit.append(fp)
+
         l.sort()
         return l
 
     def changelog(self, trypending, concurrencychecker=None):
         return changelog.changelog(
             self.vfs,
             trypending=trypending,
             concurrencychecker=concurrencychecker,
         )
 
     def manifestlog(self, repo, storenarrowmatch):
         rootstore = manifest.manifestrevlog(repo.nodeconstants, self.vfs)
         return manifest.manifestlog(self.vfs, repo, rootstore, storenarrowmatch)
 
-    def datafiles(self, matcher=None, undecodable=None):
+    def data_entries(
+        self, matcher=None, undecodable=None
+    ) -> Generator[BaseStoreEntry, None, None]:
         """Like walk, but excluding the changelog and root manifest.
 
         When [undecodable] is None, revlogs names that can't be
         decoded cause an exception. When it is provided, it should
         be a list and the filenames that can't be decoded are added
         to it instead. This is very rarely needed."""
-        files = self._walk(b'data', True) + self._walk(b'meta', True)
-        for (t, u, s) in files:
-            yield (FILEFLAGS_FILELOG | t, u, s)
+        dirs = [
+            (b'data', KIND_FILELOG, False),
+            (b'meta', KIND_MANIFESTLOG, True),
+        ]
+        for base_dir, rl_type, strip_filename in dirs:
+            files = self._walk(base_dir, True, undecodable=undecodable)
+            for revlog, details in _gather_revlog(files):
+                revlog_target_id = revlog.split(b'/', 1)[1]
+                if strip_filename and b'/' in revlog:
+                    revlog_target_id = revlog_target_id.rsplit(b'/', 1)[0]
+                    revlog_target_id += b'/'
+                yield RevlogStoreEntry(
+                    path_prefix=revlog,
+                    revlog_type=rl_type,
+                    target_id=revlog_target_id,
+                    details=details,
+                )
+
+    def top_entries(
+        self, phase=False, obsolescence=False
+    ) -> Generator[BaseStoreEntry, None, None]:
+        if phase and self.vfs.exists(b'phaseroots'):
+            yield SimpleStoreEntry(
+                entry_path=b'phaseroots',
+                is_volatile=True,
+            )
+
+        if obsolescence and self.vfs.exists(b'obsstore'):
+            # XXX if we had the file size it could be non-volatile
+            yield SimpleStoreEntry(
+                entry_path=b'obsstore',
+                is_volatile=True,
+            )
 
-    def topfiles(self):
-        # yield manifest before changelog
         files = reversed(self._walk(b'', False))
-        for (t, u, s) in files:
+
+        changelogs = collections.defaultdict(dict)
+        manifestlogs = collections.defaultdict(dict)
+
+        for u, s in files:
             if u.startswith(b'00changelog'):
-                yield (FILEFLAGS_CHANGELOG | t, u, s)
+                name, ext = _split_revlog_ext(u)
+                changelogs[name][ext] = s
             elif u.startswith(b'00manifest'):
-                yield (FILEFLAGS_MANIFESTLOG | t, u, s)
+                name, ext = _split_revlog_ext(u)
+                manifestlogs[name][ext] = s
             else:
-                yield (FILETYPE_OTHER | t, u, s)
+                yield SimpleStoreEntry(
+                    entry_path=u,
+                    is_volatile=False,
+                    file_size=s,
+                )
+        # yield manifest before changelog
+        top_rl = [
+            (manifestlogs, KIND_MANIFESTLOG),
+            (changelogs, KIND_CHANGELOG),
+        ]
+        assert len(manifestlogs) <= 1
+        assert len(changelogs) <= 1
+        for data, revlog_type in top_rl:
+            for revlog, details in sorted(data.items()):
+                yield RevlogStoreEntry(
+                    path_prefix=revlog,
+                    revlog_type=revlog_type,
+                    target_id=b'',
+                    details=details,
+                )
 
-    def walk(self, matcher=None):
-        """return file related to data storage (ie: revlogs)
+    def walk(
+        self, matcher=None, phase=False, obsolescence=False
+    ) -> Generator[BaseStoreEntry, None, None]:
+        """return files related to data storage (ie: revlogs)
 
-        yields (file_type, unencoded, size)
+        yields instance from BaseStoreEntry subclasses
 
         if a matcher is passed, storage files of only those tracked paths
         are passed with matches the matcher
         """
         # yield data files first
-        for x in self.datafiles(matcher):
+        for x in self.data_entries(matcher):
             yield x
-        for x in self.topfiles():
+        for x in self.top_entries(phase=phase, obsolescence=obsolescence):
             yield x
 
     def copylist(self):
         return _data
 
     def write(self, tr):
         pass
@@ -567,46 +915,53 @@
         self.path = vfs.base
         self.createmode = _calcmode(vfs)
         vfs.createmode = self.createmode
         self.rawvfs = vfs
         self.vfs = vfsmod.filtervfs(vfs, encodefilename)
         self.opener = self.vfs
 
-    # note: topfiles would also need a decode phase. It is just that in
-    # practice we do not have any file outside of `data/` that needs encoding.
-    # However that might change so we should probably add a test and encoding
-    # decoding for it too. see issue6548
-
-    def datafiles(self, matcher=None, undecodable=None):
-        for t, f1, size in super(encodedstore, self).datafiles():
+    def _walk(self, relpath, recurse, undecodable=None):
+        old = super()._walk(relpath, recurse)
+        new = []
+        for f1, value in old:
             try:
                 f2 = decodefilename(f1)
             except KeyError:
                 if undecodable is None:
                     msg = _(b'undecodable revlog name %s') % f1
                     raise error.StorageError(msg)
                 else:
                     undecodable.append(f1)
                     continue
-            if not _matchtrackedpath(f2, matcher):
-                continue
-            yield t, f2, size
+            new.append((f2, value))
+        return new
+
+    def data_entries(
+        self, matcher=None, undecodable=None
+    ) -> Generator[BaseStoreEntry, None, None]:
+        entries = super(encodedstore, self).data_entries(
+            undecodable=undecodable
+        )
+        for entry in entries:
+            if _match_tracked_entry(entry, matcher):
+                yield entry
 
     def join(self, f):
         return self.path + b'/' + encodefilename(f)
 
     def copylist(self):
         return [b'requires', b'00changelog.i'] + [b'store/' + f for f in _data]
 
 
 class fncache:
     # the filename used to be partially encoded
     # hence the encodedir/decodedir dance
     def __init__(self, vfs):
         self.vfs = vfs
+        self._ignores = set()
         self.entries = None
         self._dirty = False
         # set of new additions to fncache
         self.addls = set()
 
     def ensureloaded(self, warn=None):
         """read the fncache file if not already read.
@@ -683,15 +1038,20 @@
             fp = self.vfs(b'fncache', mode=b'ab', atomictemp=True)
             if self.addls:
                 fp.write(encodedir(b'\n'.join(self.addls) + b'\n'))
             fp.close()
             self.entries = None
             self.addls = set()
 
+    def addignore(self, fn):
+        self._ignores.add(fn)
+
     def add(self, fn):
+        if fn in self._ignores:
+            return
         if self.entries is None:
             self._load()
         if fn not in self.entries:
             self.addls.add(fn)
 
     def remove(self, fn):
         if self.entries is None:
@@ -722,16 +1082,18 @@
     def __init__(self, vfs, fnc, encode):
         vfsmod.proxyvfs.__init__(self, vfs)
         self.fncache = fnc
         self.encode = encode
 
     def __call__(self, path, mode=b'r', *args, **kw):
         encoded = self.encode(path)
-        if mode not in (b'r', b'rb') and (
-            path.startswith(b'data/') or path.startswith(b'meta/')
+        if (
+            mode not in (b'r', b'rb')
+            and (path.startswith(b'data/') or path.startswith(b'meta/'))
+            and is_revlog_file(path)
         ):
             # do not trigger a fncache load when adding a file that already is
             # known to exist.
             notload = self.fncache.entries is None and self.vfs.exists(encoded)
             if notload and b'r+' in mode and not self.vfs.stat(encoded).st_size:
                 # when appending to an existing file, if the file has size zero,
                 # it should be considered as missing. Such zero-size files are
@@ -773,26 +1135,42 @@
 
     def join(self, f):
         return self.pathsep + self.encode(f)
 
     def getsize(self, path):
         return self.rawvfs.stat(path).st_size
 
-    def datafiles(self, matcher=None, undecodable=None):
-        for f in sorted(self.fncache):
-            if not _matchtrackedpath(f, matcher):
-                continue
-            ef = self.encode(f)
-            try:
-                t = revlog_type(f)
-                assert t is not None, f
-                t |= FILEFLAGS_FILELOG
-                yield t, f, self.getsize(ef)
-            except FileNotFoundError:
-                pass
+    def data_entries(
+        self, matcher=None, undecodable=None
+    ) -> Generator[BaseStoreEntry, None, None]:
+        # Note: all files in fncache should be revlog related, However the
+        # fncache might contains such file added by previous version of
+        # Mercurial.
+        files = ((f, None) for f in self.fncache if is_revlog_file(f))
+        by_revlog = _gather_revlog(files)
+        for revlog, details in by_revlog:
+            if revlog.startswith(b'data/'):
+                rl_type = KIND_FILELOG
+                revlog_target_id = revlog.split(b'/', 1)[1]
+            elif revlog.startswith(b'meta/'):
+                rl_type = KIND_MANIFESTLOG
+                # drop the initial directory and the `00manifest` file part
+                tmp = revlog.split(b'/', 1)[1]
+                revlog_target_id = tmp.rsplit(b'/', 1)[0] + b'/'
+            else:
+                # unreachable
+                assert False, revlog
+            entry = RevlogStoreEntry(
+                path_prefix=revlog,
+                revlog_type=rl_type,
+                target_id=revlog_target_id,
+                details=details,
+            )
+            if _match_tracked_entry(entry, matcher):
+                yield entry
 
     def copylist(self):
         d = (
             b'bookmarks',
             b'narrowspec',
             b'data',
             b'meta',
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `mercurial-6.4rc0/mercurial/streamclone.py` & `mercurial-6.5rc0/mercurial/streamclone.py`

 * *Files 12% similar despite different names*

```diff
@@ -3,39 +3,36 @@
 # Copyright 2015 Gregory Szorc <gregory.szorc@gmail.com>
 #
 # This software may be used and distributed according to the terms of the
 # GNU General Public License version 2 or any later version.
 
 
 import contextlib
-import errno
 import os
 import struct
 
 from .i18n import _
-from .pycompat import open
 from .interfaces import repository
 from . import (
     bookmarks,
+    bundle2 as bundle2mod,
     cacheutil,
     error,
     narrowspec,
     phases,
     pycompat,
     requirements as requirementsmod,
     scmutil,
     store,
+    transaction,
     util,
 )
 from .revlogutils import (
     nodemap,
 )
-from .utils import (
-    stringutil,
-)
 
 
 def new_stream_clone_requirements(default_requirements, streamed_requirements):
     """determine the final set of requirement for a new stream clone
 
     this method combine the "default" requirements that a new repository would
     use with the constaint we get from the stream clone content. We keep local
@@ -68,48 +65,49 @@
     streaming clone is supported and False otherwise. ``requirements`` is
     a set of repo requirements from the remote, or ``None`` if stream clone
     isn't supported.
     """
     repo = pullop.repo
     remote = pullop.remote
 
+    # should we consider streaming clone at all ?
+    streamrequested = pullop.streamclonerequested
+    # If we don't have a preference, let the server decide for us. This
+    # likely only comes into play in LANs.
+    if streamrequested is None:
+        # The server can advertise whether to prefer streaming clone.
+        streamrequested = remote.capable(b'stream-preferred')
+    if not streamrequested:
+        return False, None
+
+    # Streaming clone only works on an empty destination repository
+    if len(repo):
+        return False, None
+
+    # Streaming clone only works if all data is being requested.
+    if pullop.heads:
+        return False, None
+
     bundle2supported = False
     if pullop.canusebundle2:
-        if b'v2' in pullop.remotebundle2caps.get(b'stream', []):
-            bundle2supported = True
+        local_caps = bundle2mod.getrepocaps(repo, role=b'client')
+        local_supported = set(local_caps.get(b'stream', []))
+        remote_supported = set(pullop.remotebundle2caps.get(b'stream', []))
+        bundle2supported = bool(local_supported & remote_supported)
         # else
         # Server doesn't support bundle2 stream clone or doesn't support
         # the versions we support. Fall back and possibly allow legacy.
 
     # Ensures legacy code path uses available bundle2.
     if bundle2supported and not bundle2:
         return False, None
     # Ensures bundle2 doesn't try to do a stream clone if it isn't supported.
     elif bundle2 and not bundle2supported:
         return False, None
 
-    # Streaming clone only works on empty repositories.
-    if len(repo):
-        return False, None
-
-    # Streaming clone only works if all data is being requested.
-    if pullop.heads:
-        return False, None
-
-    streamrequested = pullop.streamclonerequested
-
-    # If we don't have a preference, let the server decide for us. This
-    # likely only comes into play in LANs.
-    if streamrequested is None:
-        # The server can advertise whether to prefer streaming clone.
-        streamrequested = remote.capable(b'stream-preferred')
-
-    if not streamrequested:
-        return False, None
-
     # In order for stream clone to work, the client has to support all the
     # requirements advertised by the server.
     #
     # The server advertises its requirements via the "stream" and "streamreqs"
     # capability. "stream" (a value-less capability) is advertised if and only
     # if the only requirement is "revlogv1." Else, the "streamreqs" capability
     # is advertised and contains a comma-delimited list of requirements.
@@ -240,16 +238,16 @@
     if secret:
         return repo.ui.configbool(b'server', b'uncompressedallowsecret')
 
     return True
 
 
 # This is it's own function so extensions can override it.
-def _walkstreamfiles(repo, matcher=None):
-    return repo.store.walk(matcher)
+def _walkstreamfiles(repo, matcher=None, phase=False, obsolescence=False):
+    return repo.store.walk(matcher, phase=phase, obsolescence=obsolescence)
 
 
 def generatev1(repo):
     """Emit content for version 1 of a streaming clone.
 
     This returns a 3-tuple of (file count, byte size, data iterator).
 
@@ -268,18 +266,20 @@
     the store is captured. It therefore may raise LockError.
     """
     entries = []
     total_bytes = 0
     # Get consistent snapshot of repo, lock during scan.
     with repo.lock():
         repo.ui.debug(b'scanning\n')
-        for file_type, name, size in _walkstreamfiles(repo):
-            if size:
-                entries.append((name, size))
-                total_bytes += size
+        for entry in _walkstreamfiles(repo):
+            for f in entry.files():
+                file_size = f.file_size(repo.store.vfs)
+                if file_size:
+                    entries.append((f.unencoded_path, file_size))
+                    total_bytes += file_size
         _test_sync_point_walk_1(repo)
     _test_sync_point_walk_2(repo)
 
     repo.ui.debug(
         b'%d files, %d bytes to transfer\n' % (len(entries), total_bytes)
     )
 
@@ -424,15 +424,24 @@
         # nesting occurs also in ordinary case (e.g. enabling
         # clonebundles).
 
         with repo.transaction(b'clone'):
             with repo.svfs.backgroundclosing(repo.ui, expectedcount=filecount):
                 for i in range(filecount):
                     # XXX doesn't support '\n' or '\r' in filenames
-                    l = fp.readline()
+                    if util.safehasattr(fp, 'readline'):
+                        l = fp.readline()
+                    else:
+                        # inline clonebundles use a chunkbuffer, so no readline
+                        # --> this should be small anyway, the first line
+                        # only contains the size of the bundle
+                        l_buf = []
+                        while not (l_buf and l_buf[-1] == b'\n'):
+                            l_buf.append(fp.read(1))
+                        l = b''.join(l_buf)
                     try:
                         name, size = l.split(b'\0', 1)
                         size = int(size)
                     except (ValueError, TypeError):
                         raise error.ResponseError(
                             _(b'unexpected response from remote server:'), l
                         )
@@ -551,36 +560,63 @@
     """actually copy the snapshot files"""
     src, name, ftype, data = entry
     if ftype != _filefull:
         return entry
     return (src, name, ftype, copy(vfsmap[src].join(name)))
 
 
-@contextlib.contextmanager
-def maketempcopies():
-    """return a function to temporary copy file"""
+class TempCopyManager:
+    """Manage temporary backup of volatile file during stream clone
 
-    files = []
-    dst_dir = pycompat.mkdtemp(prefix=b'hg-clone-')
-    try:
+    This should be used as a Python context, the copies will be discarded when
+    exiting the context.
+
+    A copy can be done by calling the object on the real path (encoded full
+    path)
+
+    The backup path can be retrieved using the __getitem__ protocol, obj[path].
+    On file without backup, it will return the unmodified path. (equivalent to
+    `dict.get(x, x)`)
+    """
 
-        def copy(src):
-            fd, dst = pycompat.mkstemp(
-                prefix=os.path.basename(src), dir=dst_dir
-            )
-            os.close(fd)
-            files.append(dst)
-            util.copyfiles(src, dst, hardlink=True)
-            return dst
-
-        yield copy
-    finally:
-        for tmp in files:
+    def __init__(self):
+        self._copies = None
+        self._dst_dir = None
+
+    def __enter__(self):
+        if self._copies is not None:
+            msg = "Copies context already open"
+            raise error.ProgrammingError(msg)
+        self._copies = {}
+        self._dst_dir = pycompat.mkdtemp(prefix=b'hg-clone-')
+        return self
+
+    def __call__(self, src):
+        """create a backup of the file at src"""
+        prefix = os.path.basename(src)
+        fd, dst = pycompat.mkstemp(prefix=prefix, dir=self._dst_dir)
+        os.close(fd)
+        self._copies[src] = dst
+        util.copyfiles(src, dst, hardlink=True)
+        return dst
+
+    def __getitem__(self, src):
+        """return the path to a valid version of `src`
+
+        If the file has no backup, the path of the file is returned
+        unmodified."""
+        return self._copies.get(src, src)
+
+    def __exit__(self, *args, **kwars):
+        """discard all backups"""
+        for tmp in self._copies.values():
             util.tryunlink(tmp)
-        util.tryrmdir(dst_dir)
+        util.tryrmdir(self._dst_dir)
+        self._copies = None
+        self._dst_dir = None
 
 
 def _makemap(repo):
     """make a (src -> vfs) map for the repo"""
     vfsmap = {
         _srcstore: repo.svfs,
         _srccache: repo.cachevfs,
@@ -588,121 +624,173 @@
     # we keep repo.vfs out of the on purpose, ther are too many danger there
     # (eg: .hg/hgrc)
     assert repo.vfs not in vfsmap.values()
 
     return vfsmap
 
 
-def _emit2(repo, entries, totalfilesize):
+def _emit2(repo, entries):
     """actually emit the stream bundle"""
     vfsmap = _makemap(repo)
     # we keep repo.vfs out of the on purpose, ther are too many danger there
     # (eg: .hg/hgrc),
     #
     # this assert is duplicated (from _makemap) as author might think this is
     # fine, while this is really not fine.
     if repo.vfs in vfsmap.values():
         raise error.ProgrammingError(
             b'repo.vfs must not be added to vfsmap for security reasons'
         )
 
+    # translate the vfs one
+    entries = [(vfs_key, vfsmap[vfs_key], e) for (vfs_key, e) in entries]
+
+    max_linkrev = len(repo)
+    file_count = totalfilesize = 0
+    # record the expected size of every file
+    for k, vfs, e in entries:
+        for f in e.files():
+            file_count += 1
+            totalfilesize += f.file_size(vfs)
+
     progress = repo.ui.makeprogress(
         _(b'bundle'), total=totalfilesize, unit=_(b'bytes')
     )
     progress.update(0)
-    with maketempcopies() as copy, progress:
-        # copy is delayed until we are in the try
-        entries = [_filterfull(e, copy, vfsmap) for e in entries]
-        yield None  # this release the lock on the repository
+    with TempCopyManager() as copy, progress:
+        # create a copy of volatile files
+        for k, vfs, e in entries:
+            for f in e.files():
+                if f.is_volatile:
+                    copy(vfs.join(f.unencoded_path))
+        # the first yield release the lock on the repository
+        yield file_count, totalfilesize
         totalbytecount = 0
 
-        for src, name, ftype, data in entries:
-            vfs = vfsmap[src]
-            yield src
-            yield util.uvarintencode(len(name))
-            if ftype == _fileappend:
-                fp = vfs(name)
-                size = data
-            elif ftype == _filefull:
-                fp = open(data, b'rb')
-                size = util.fstat(fp).st_size
-            bytecount = 0
-            try:
+        for src, vfs, e in entries:
+            entry_streams = e.get_streams(
+                repo=repo,
+                vfs=vfs,
+                copies=copy,
+                max_changeset=max_linkrev,
+                preserve_file_count=True,
+            )
+            for name, stream, size in entry_streams:
+                yield src
+                yield util.uvarintencode(len(name))
                 yield util.uvarintencode(size)
                 yield name
-                if size <= 65536:
-                    chunks = (fp.read(size),)
-                else:
-                    chunks = util.filechunkiter(fp, limit=size)
-                for chunk in chunks:
+                bytecount = 0
+                for chunk in stream:
                     bytecount += len(chunk)
                     totalbytecount += len(chunk)
                     progress.update(totalbytecount)
                     yield chunk
                 if bytecount != size:
-                    # Would most likely be caused by a race due to `hg strip` or
-                    # a revlog split
-                    raise error.Abort(
-                        _(
-                            b'clone could only read %d bytes from %s, but '
-                            b'expected %d bytes'
-                        )
-                        % (bytecount, name, size)
+                    # Would most likely be caused by a race due to `hg
+                    # strip` or a revlog split
+                    msg = _(
+                        b'clone could only read %d bytes from %s, but '
+                        b'expected %d bytes'
                     )
-            finally:
-                fp.close()
+                    raise error.Abort(msg % (bytecount, name, size))
+
+
+def _emit3(repo, entries):
+    """actually emit the stream bundle (v3)"""
+    vfsmap = _makemap(repo)
+    # we keep repo.vfs out of the map on purpose, ther are too many dangers
+    # there (eg: .hg/hgrc),
+    #
+    # this assert is duplicated (from _makemap) as authors might think this is
+    # fine, while this is really not fine.
+    if repo.vfs in vfsmap.values():
+        raise error.ProgrammingError(
+            b'repo.vfs must not be added to vfsmap for security reasons'
+        )
+
+    # translate the vfs once
+    entries = [(vfs_key, vfsmap[vfs_key], e) for (vfs_key, e) in entries]
+    total_entry_count = len(entries)
+
+    max_linkrev = len(repo)
+    progress = repo.ui.makeprogress(
+        _(b'bundle'),
+        total=total_entry_count,
+        unit=_(b'entry'),
+    )
+    progress.update(0)
+    with TempCopyManager() as copy, progress:
+        # create a copy of volatile files
+        for k, vfs, e in entries:
+            for f in e.files():
+                f.file_size(vfs)  # record the expected size under lock
+                if f.is_volatile:
+                    copy(vfs.join(f.unencoded_path))
+        # the first yield release the lock on the repository
+        yield None
+
+        yield util.uvarintencode(total_entry_count)
+
+        for src, vfs, e in entries:
+            entry_streams = e.get_streams(
+                repo=repo,
+                vfs=vfs,
+                copies=copy,
+                max_changeset=max_linkrev,
+            )
+            yield util.uvarintencode(len(entry_streams))
+            for name, stream, size in entry_streams:
+                yield src
+                yield util.uvarintencode(len(name))
+                yield util.uvarintencode(size)
+                yield name
+                yield from stream
+            progress.increment()
 
 
 def _test_sync_point_walk_1(repo):
     """a function for synchronisation during tests"""
 
 
 def _test_sync_point_walk_2(repo):
     """a function for synchronisation during tests"""
 
 
-def _v2_walk(repo, includes, excludes, includeobsmarkers):
+def _entries_walk(repo, includes, excludes, includeobsmarkers):
     """emit a seris of files information useful to clone a repo
 
-    return (entries, totalfilesize)
-
-    entries is a list of tuple (vfs-key, file-path, file-type, size)
+    return (vfs-key, entry) iterator
 
-    - `vfs-key`: is a key to the right vfs to write the file (see _makemap)
-    - `name`: file path of the file to copy (to be feed to the vfss)
-    - `file-type`: do this file need to be copied with the source lock ?
-    - `size`: the size of the file (or None)
+    Where `entry` is StoreEntry. (used even for cache entries)
     """
     assert repo._currentlock(repo._lockref) is not None
-    entries = []
-    totalfilesize = 0
 
     matcher = None
     if includes or excludes:
         matcher = narrowspec.match(repo.root, includes, excludes)
 
-    for rl_type, name, size in _walkstreamfiles(repo, matcher):
-        if size:
-            ft = _fileappend
-            if rl_type & store.FILEFLAGS_VOLATILE:
-                ft = _filefull
-            entries.append((_srcstore, name, ft, size))
-            totalfilesize += size
-    for name in _walkstreamfullstorefiles(repo):
-        if repo.svfs.exists(name):
-            totalfilesize += repo.svfs.lstat(name).st_size
-            entries.append((_srcstore, name, _filefull, None))
-    if includeobsmarkers and repo.svfs.exists(b'obsstore'):
-        totalfilesize += repo.svfs.lstat(b'obsstore').st_size
-        entries.append((_srcstore, b'obsstore', _filefull, None))
+    phase = not repo.publishing()
+    entries = _walkstreamfiles(
+        repo,
+        matcher,
+        phase=phase,
+        obsolescence=includeobsmarkers,
+    )
+    for entry in entries:
+        yield (_srcstore, entry)
+
     for name in cacheutil.cachetocopy(repo):
         if repo.cachevfs.exists(name):
-            totalfilesize += repo.cachevfs.lstat(name).st_size
-            entries.append((_srccache, name, _filefull, None))
-    return entries, totalfilesize
+            # not really a StoreEntry, but close enough
+            entry = store.SimpleStoreEntry(
+                entry_path=name,
+                is_volatile=True,
+            )
+            yield (_srccache, entry)
 
 
 def generatev2(repo, includes, excludes, includeobsmarkers):
     """Emit content for version 2 of a streaming clone.
 
     the data stream consists the following entries:
     1) A char representing the file destination (eg: store or cache)
@@ -714,28 +802,72 @@
     Returns a 3-tuple of (file count, file size, data iterator).
     """
 
     with repo.lock():
 
         repo.ui.debug(b'scanning\n')
 
-        entries, totalfilesize = _v2_walk(
+        entries = _entries_walk(
             repo,
             includes=includes,
             excludes=excludes,
             includeobsmarkers=includeobsmarkers,
         )
 
-        chunks = _emit2(repo, entries, totalfilesize)
+        chunks = _emit2(repo, entries)
+        first = next(chunks)
+        file_count, total_file_size = first
+        _test_sync_point_walk_1(repo)
+    _test_sync_point_walk_2(repo)
+
+    return file_count, total_file_size, chunks
+
+
+def generatev3(repo, includes, excludes, includeobsmarkers):
+    """Emit content for version 3 of a streaming clone.
+
+    the data stream consists the following:
+    1) A varint E containing the number of entries (can be 0), then E entries follow
+    2) For each entry:
+    2.1) The number of files in this entry (can be 0, but typically 1 or 2)
+    2.2) For each file:
+    2.2.1) A char representing the file destination (eg: store or cache)
+    2.2.2) A varint N containing the length of the filename
+    2.2.3) A varint M containing the length of file data
+    2.2.4) N bytes containing the filename (the internal, store-agnostic form)
+    2.2.5) M bytes containing the file data
+
+    Returns the data iterator.
+
+    XXX This format is experimental and subject to change. Here is a
+    XXX non-exhaustive list of things this format could do or change:
+
+    - making it easier to write files in parallel
+    - holding the lock for a shorter time
+    - improving progress information
+    - ways to adjust the number of expected entries/files ?
+    """
+
+    with repo.lock():
+
+        repo.ui.debug(b'scanning\n')
+
+        entries = _entries_walk(
+            repo,
+            includes=includes,
+            excludes=excludes,
+            includeobsmarkers=includeobsmarkers,
+        )
+        chunks = _emit3(repo, list(entries))
         first = next(chunks)
         assert first is None
         _test_sync_point_walk_1(repo)
     _test_sync_point_walk_2(repo)
 
-    return len(entries), totalfilesize, chunks
+    return chunks
 
 
 @contextlib.contextmanager
 def nested(*ctxs):
     this = ctxs[0]
     rest = ctxs[1:]
     with this:
@@ -811,14 +943,88 @@
                 elapsed,
                 util.bytecount(progress.pos / elapsed),
             )
         )
         progress.complete()
 
 
+def consumev3(repo, fp):
+    """Apply the contents from a version 3 streaming clone.
+
+    Data is read from an object that only needs to provide a ``read(size)``
+    method.
+    """
+    with repo.lock():
+        start = util.timer()
+
+        entrycount = util.uvarintdecodestream(fp)
+        repo.ui.status(_(b'%d entries to transfer\n') % (entrycount))
+
+        progress = repo.ui.makeprogress(
+            _(b'clone'),
+            total=entrycount,
+            unit=_(b'entries'),
+        )
+        progress.update(0)
+        bytes_transferred = 0
+
+        vfsmap = _makemap(repo)
+        # we keep repo.vfs out of the on purpose, there are too many dangers
+        # there (eg: .hg/hgrc),
+        #
+        # this assert is duplicated (from _makemap) as authors might think this
+        # is fine, while this is really not fine.
+        if repo.vfs in vfsmap.values():
+            raise error.ProgrammingError(
+                b'repo.vfs must not be added to vfsmap for security reasons'
+            )
+
+        with repo.transaction(b'clone'):
+            ctxs = (vfs.backgroundclosing(repo.ui) for vfs in vfsmap.values())
+            with nested(*ctxs):
+
+                for i in range(entrycount):
+                    filecount = util.uvarintdecodestream(fp)
+                    if filecount == 0:
+                        if repo.ui.debugflag:
+                            repo.ui.debug(b'entry with no files [%d]\n' % (i))
+                    for i in range(filecount):
+                        src = util.readexactly(fp, 1)
+                        vfs = vfsmap[src]
+                        namelen = util.uvarintdecodestream(fp)
+                        datalen = util.uvarintdecodestream(fp)
+
+                        name = util.readexactly(fp, namelen)
+
+                        if repo.ui.debugflag:
+                            msg = b'adding [%s] %s (%s)\n'
+                            msg %= (src, name, util.bytecount(datalen))
+                            repo.ui.debug(msg)
+                        bytes_transferred += datalen
+
+                        with vfs(name, b'w') as ofp:
+                            for chunk in util.filechunkiter(fp, limit=datalen):
+                                ofp.write(chunk)
+                    progress.increment(step=1)
+
+            # force @filecache properties to be reloaded from
+            # streamclone-ed file at next access
+            repo.invalidate(clearfilecache=True)
+
+        elapsed = util.timer() - start
+        if elapsed <= 0:
+            elapsed = 0.001
+        msg = _(b'transferred %s in %.1f seconds (%s/sec)\n')
+        byte_count = util.bytecount(bytes_transferred)
+        bytes_sec = util.bytecount(bytes_transferred / elapsed)
+        msg %= (byte_count, elapsed, bytes_sec)
+        repo.ui.status(msg)
+        progress.complete()
+
+
 def applybundlev2(repo, fp, filecount, filesize, requirements):
     from . import localrepo
 
     missingreqs = [r for r in requirements if r not in repo.supported]
     if missingreqs:
         raise error.Abort(
             _(b'unable to apply stream clone: unsupported format: %s')
@@ -834,22 +1040,44 @@
     repo.svfs.options = localrepo.resolvestorevfsoptions(
         repo.ui, repo.requirements, repo.features
     )
     scmutil.writereporequirements(repo)
     nodemap.post_stream_cleanup(repo)
 
 
+def applybundlev3(repo, fp, requirements):
+    from . import localrepo
+
+    missingreqs = [r for r in requirements if r not in repo.supported]
+    if missingreqs:
+        msg = _(b'unable to apply stream clone: unsupported format: %s')
+        msg %= b', '.join(sorted(missingreqs))
+        raise error.Abort(msg)
+
+    consumev3(repo, fp)
+
+    repo.requirements = new_stream_clone_requirements(
+        repo.requirements,
+        requirements,
+    )
+    repo.svfs.options = localrepo.resolvestorevfsoptions(
+        repo.ui, repo.requirements, repo.features
+    )
+    scmutil.writereporequirements(repo)
+    nodemap.post_stream_cleanup(repo)
+
+
 def _copy_files(src_vfs_map, dst_vfs_map, entries, progress):
     hardlink = [True]
 
     def copy_used():
         hardlink[0] = False
         progress.topic = _(b'copying')
 
-    for k, path, size in entries:
+    for k, path in entries:
         src_vfs = src_vfs_map[k]
         dst_vfs = dst_vfs_map[k]
         src_path = src_vfs.join(path)
         dst_path = dst_vfs.join(path)
         # We cannot use dirname and makedirs of dst_vfs here because the store
         # encoding confuses them. See issue 6581 for details.
         dirname = os.path.dirname(dst_path)
@@ -892,58 +1120,53 @@
             # through `repo.vfs` to expose it to streaming clone.
             src_book_vfs = bookmarks.bookmarksvfs(src_repo)
             srcbookmarks = src_book_vfs.join(b'bookmarks')
             bm_count = 0
             if os.path.exists(srcbookmarks):
                 bm_count = 1
 
-            entries, totalfilesize = _v2_walk(
+            entries = _entries_walk(
                 src_repo,
                 includes=None,
                 excludes=None,
                 includeobsmarkers=True,
             )
+            entries = list(entries)
             src_vfs_map = _makemap(src_repo)
             dest_vfs_map = _makemap(dest_repo)
+            total_files = sum(len(e[1].files()) for e in entries) + bm_count
             progress = src_repo.ui.makeprogress(
                 topic=_(b'linking'),
-                total=len(entries) + bm_count,
+                total=total_files,
                 unit=_(b'files'),
             )
             # copy  files
             #
             # We could copy the full file while the source repository is locked
             # and the other one without the lock. However, in the linking case,
             # this would also requires checks that nobody is appending any data
             # to the files while we do the clone, so this is not done yet. We
             # could do this blindly when copying files.
-            files = ((k, path, size) for k, path, ftype, size in entries)
+            files = [
+                (vfs_key, f.unencoded_path)
+                for vfs_key, e in entries
+                for f in e.files()
+            ]
             hardlink = _copy_files(src_vfs_map, dest_vfs_map, files, progress)
 
             # copy bookmarks over
             if bm_count:
                 dst_book_vfs = bookmarks.bookmarksvfs(dest_repo)
                 dstbookmarks = dst_book_vfs.join(b'bookmarks')
                 util.copyfile(srcbookmarks, dstbookmarks)
         progress.complete()
         if hardlink:
             msg = b'linked %d files\n'
         else:
             msg = b'copied %d files\n'
-        src_repo.ui.debug(msg % (len(entries) + bm_count))
+        src_repo.ui.debug(msg % total_files)
 
         with dest_repo.transaction(b"localclone") as tr:
             dest_repo.store.write(tr)
 
         # clean up transaction file as they do not make sense
-        undo_files = [(dest_repo.svfs, b'undo.backupfiles')]
-        undo_files.extend(dest_repo.undofiles())
-        for undovfs, undofile in undo_files:
-            try:
-                undovfs.unlink(undofile)
-            except OSError as e:
-                if e.errno != errno.ENOENT:
-                    msg = _(b'error removing %s: %s\n')
-                    path = undovfs.join(undofile)
-                    e_msg = stringutil.forcebytestr(e)
-                    msg %= (path, e_msg)
-                    dest_repo.ui.warn(msg)
+        transaction.cleanup_undo_files(dest_repo.ui.warn, dest_repo.vfs_map)
```

### Comparing `mercurial-6.4rc0/mercurial/strip.py` & `mercurial-6.5rc0/mercurial/strip.py`

 * *Files 0% similar despite different names*

```diff
@@ -32,15 +32,15 @@
 
 
 def _findupdatetarget(repo, nodes):
     unode, p2 = repo.changelog.parents(nodes[0])
     currentbranch = repo[None].branch()
 
     if (
-        util.safehasattr(repo, b'mq')
+        util.safehasattr(repo, 'mq')
         and p2 != repo.nullid
         and p2 in [x.node for x in repo.mq.applied]
     ):
         unode = p2
     elif currentbranch != repo[unode].branch():
         pwdir = b'parents(wdir())'
         revset = b'max(((parents(%ln::%r) + %r) - %ln::%r) and branch(%s))'
```

### Comparing `mercurial-6.4rc0/mercurial/subrepo.py` & `mercurial-6.5rc0/mercurial/subrepo.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/subrepoutil.py` & `mercurial-6.5rc0/mercurial/subrepoutil.py`

 * *Files 1% similar despite different names*

```diff
@@ -380,15 +380,15 @@
 
 def repo_rel_or_abs_source(repo):
     """return the source of this repo
 
     Either absolute or relative the outermost repo"""
     parent = repo
     chunks = []
-    while util.safehasattr(parent, b'_subparent'):
+    while util.safehasattr(parent, '_subparent'):
         source = urlutil.url(parent._subsource)
         chunks.append(bytes(source))
         if source.isabs():
             break
         parent = parent._subparent
 
     chunks.reverse()
@@ -396,43 +396,43 @@
     return posixpath.normpath(path)
 
 
 def reporelpath(repo):
     # type: (localrepo.localrepository) -> bytes
     """return path to this (sub)repo as seen from outermost repo"""
     parent = repo
-    while util.safehasattr(parent, b'_subparent'):
+    while util.safehasattr(parent, '_subparent'):
         parent = parent._subparent
     return repo.root[len(pathutil.normasprefix(parent.root)) :]
 
 
 def subrelpath(sub):
     # type: (subrepo.abstractsubrepo) -> bytes
     """return path to this subrepo as seen from outermost repo"""
     return sub._relpath
 
 
 def _abssource(repo, push=False, abort=True):
     # type: (localrepo.localrepository, bool, bool) -> Optional[bytes]
     """return pull/push path of repo - either based on parent repo .hgsub info
     or on the top repo config. Abort or return None if no source found."""
-    if util.safehasattr(repo, b'_subparent'):
+    if util.safehasattr(repo, '_subparent'):
         source = urlutil.url(repo._subsource)
         if source.isabs():
             return bytes(source)
         source.path = posixpath.normpath(source.path)
         parent = _abssource(repo._subparent, push, abort=False)
         if parent:
             parent = urlutil.url(util.pconvert(parent))
             parent.path = posixpath.join(parent.path or b'', source.path)
             parent.path = posixpath.normpath(parent.path)
             return bytes(parent)
     else:  # recursion reached top repo
         path = None
-        if util.safehasattr(repo, b'_subtoppath'):
+        if util.safehasattr(repo, '_subtoppath'):
             path = repo._subtoppath
         elif push and repo.ui.config(b'paths', b'default-push'):
             path = repo.ui.config(b'paths', b'default-push')
         elif repo.ui.config(b'paths', b'default'):
             path = repo.ui.config(b'paths', b'default')
         elif repo.shared():
             # chop off the .hg component to get the default path form.  This has
```

### Comparing `mercurial-6.4rc0/mercurial/tagmerge.py` & `mercurial-6.5rc0/mercurial/tagmerge.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/tags.py` & `mercurial-6.5rc0/mercurial/tags.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templatefilters.py` & `mercurial-6.5rc0/mercurial/templatefilters.py`

 * *Files 0% similar despite different names*

```diff
@@ -335,22 +335,22 @@
         return pycompat.bytestr(obj)
     elif isinstance(obj, bytes):
         return b'"%s"' % encoding.jsonescape(obj, paranoid=paranoid)
     elif isinstance(obj, type(u'')):
         raise error.ProgrammingError(
             b'Mercurial only does output with bytes: %r' % obj
         )
-    elif util.safehasattr(obj, b'keys'):
+    elif util.safehasattr(obj, 'keys'):
         out = [
             b'"%s": %s'
             % (encoding.jsonescape(k, paranoid=paranoid), json(v, paranoid))
             for k, v in sorted(obj.items())
         ]
         return b'{' + b', '.join(out) + b'}'
-    elif util.safehasattr(obj, b'__iter__'):
+    elif util.safehasattr(obj, '__iter__'):
         out = [json(i, paranoid) for i in obj]
         return b'[' + b', '.join(out) + b']'
     raise error.ProgrammingError(b'cannot encode %r' % obj)
 
 
 @templatefilter(b'lower', intype=bytes)
 def lower(text):
```

### Comparing `mercurial-6.4rc0/mercurial/templatefuncs.py` & `mercurial-6.5rc0/mercurial/templatefuncs.py`

 * *Files 1% similar despite different names*

```diff
@@ -46,16 +46,16 @@
 # dict of template built-in functions
 funcs = {}
 templatefunc = registrar.templatefunc(funcs)
 
 
 @templatefunc(b'date(date[, fmt])')
 def date(context, mapping, args):
-    """Format a date. See :hg:`help dates` for formatting
-    strings. The default is a Unix date format, including the timezone:
+    """Format a date. The format string uses the Python strftime format.
+    The default is a Unix date format, including the timezone:
     "Mon Sep 04 15:13:13 2006 0700"."""
     if not (1 <= len(args) <= 2):
         # i18n: "date" is a keyword
         raise error.ParseError(_(b"date expects one or two arguments"))
 
     date = evaldate(
         context,
```

### Comparing `mercurial-6.4rc0/mercurial/templatekw.py` & `mercurial-6.5rc0/mercurial/templatekw.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templater.py` & `mercurial-6.5rc0/mercurial/templater.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/atom/changelogentry.tmpl` & `mercurial-6.5rc0/mercurial/templates/atom/changelogentry.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/atom/map` & `mercurial-6.5rc0/mercurial/templates/atom/map`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/coal/header.tmpl` & `mercurial-6.5rc0/mercurial/templates/coal/header.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/bookmarks.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/bookmarks.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/branches.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/branches.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/changelog.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/changelog.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/changeset.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/changeset.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/error.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/error.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/fileannotate.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/fileannotate.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/filecomparison.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/filecomparison.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/filediff.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/filediff.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/filelog.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/filelog.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/filerevision.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/filerevision.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/graph.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/graph.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/header.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/header.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/help.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/help.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/helptopics.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/helptopics.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/index.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/index.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/manifest.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/manifest.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/map` & `mercurial-6.5rc0/mercurial/templates/gitweb/map`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/search.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/search.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/shortlog.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/shortlog.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/summary.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/summary.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/gitweb/tags.tmpl` & `mercurial-6.5rc0/mercurial/templates/gitweb/tags.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/json/map` & `mercurial-6.5rc0/mercurial/templates/json/map`

 * *Files 1% similar despite different names*

```diff
@@ -61,14 +61,15 @@
   "date": {date|json},
   "desc": {desc|utf8|json},
   "branch": {if(branch, branch%changesetbranch, "default"|json)},
   "bookmarks": [{join(changesetbookmark, ", ")}],
   "tags": [{join(changesettag, ", ")}],
   "user": {author|utf8|json},
   "parents": [{join(parent%changesetparent, ", ")}],
+  "children": [{join(child%changesetparent, ", ")}],
   "files": [{join(files, ", ")}],
   "diff": [{join(diff, ", ")}],
   "phase": {phase|json}
   }'
 changesetbranch = '{name|utf8|json}'
 changesetbookmark = '{bookmark|utf8|json}'
 changesettag = '{tag|utf8|json}'
```

### Comparing `mercurial-6.4rc0/mercurial/templates/map-cmdline.bisect` & `mercurial-6.5rc0/mercurial/templates/map-cmdline.bisect`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/map-cmdline.changelog` & `mercurial-6.5rc0/mercurial/templates/map-cmdline.changelog`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/map-cmdline.compact` & `mercurial-6.5rc0/mercurial/templates/map-cmdline.compact`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/map-cmdline.default` & `mercurial-6.5rc0/mercurial/templates/map-cmdline.default`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/map-cmdline.show` & `mercurial-6.5rc0/mercurial/templates/map-cmdline.show`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/map-cmdline.status` & `mercurial-6.5rc0/mercurial/templates/map-cmdline.status`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/map-cmdline.xml` & `mercurial-6.5rc0/mercurial/templates/map-cmdline.xml`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/bookmarks.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/bookmarks.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/branches.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/branches.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/changelog.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/changelog.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/changeset.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/changeset.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/error.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/error.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/fileannotate.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/fileannotate.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/filecomparison.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/filecomparison.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/filediff.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/filediff.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/filelog.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/filelog.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/filerevision.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/filerevision.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/graph.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/graph.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/help.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/help.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/helptopics.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/helptopics.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/index.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/index.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/manifest.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/manifest.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/map` & `mercurial-6.5rc0/mercurial/templates/monoblue/map`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/notfound.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/notfound.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/search.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/search.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/shortlog.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/shortlog.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/summary.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/summary.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/monoblue/tags.tmpl` & `mercurial-6.5rc0/mercurial/templates/monoblue/tags.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/bookmarks.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/bookmarks.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/branches.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/branches.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/changeset.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/changeset.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/error.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/error.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/fileannotate.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/fileannotate.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/filecomparison.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/filecomparison.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/filediff.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/filediff.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/filelog.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/filelog.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/filerevision.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/filerevision.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/graph.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/graph.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/help.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/help.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/helptopics.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/helptopics.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/index.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/index.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/manifest.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/manifest.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/map` & `mercurial-6.5rc0/mercurial/templates/paper/map`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/search.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/search.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/shortlog.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/shortlog.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/paper/tags.tmpl` & `mercurial-6.5rc0/mercurial/templates/paper/tags.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/raw/map` & `mercurial-6.5rc0/mercurial/templates/raw/map`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/rss/changelogentry.tmpl` & `mercurial-6.5rc0/mercurial/templates/rss/changelogentry.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/rss/map` & `mercurial-6.5rc0/mercurial/templates/rss/map`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/branches.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/branches.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/changelog.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/changelog.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/changelogentry.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/changelogentry.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/changeset.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/changeset.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/fileannotate.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/fileannotate.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/filediff.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/filediff.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/filelog.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/filelog.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/filelogentry.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/filelogentry.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/filerevision.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/filerevision.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/graph.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/graph.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/manifest.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/manifest.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/map` & `mercurial-6.5rc0/mercurial/templates/spartan/map`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/search.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/search.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/shortlog.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/shortlog.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/spartan/tags.tmpl` & `mercurial-6.5rc0/mercurial/templates/spartan/tags.tmpl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/static/background.png` & `mercurial-6.5rc0/mercurial/templates/static/background.png`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/static/feed-icon-14x14.png` & `mercurial-6.5rc0/mercurial/templates/static/feed-icon-14x14.png`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/static/followlines.js` & `mercurial-6.5rc0/mercurial/templates/static/followlines.js`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/static/hgicon.png` & `mercurial-6.5rc0/mercurial/templates/static/hgicon.png`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/static/hglogo.png` & `mercurial-6.5rc0/mercurial/templates/static/hglogo.png`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/static/mercurial.js` & `mercurial-6.5rc0/mercurial/templates/static/mercurial.js`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/static/style-extra-coal.css` & `mercurial-6.5rc0/mercurial/templates/static/style-extra-coal.css`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/static/style-gitweb.css` & `mercurial-6.5rc0/mercurial/templates/static/style-gitweb.css`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/static/style-monoblue.css` & `mercurial-6.5rc0/mercurial/templates/static/style-monoblue.css`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/static/style-paper.css` & `mercurial-6.5rc0/mercurial/templates/static/style-paper.css`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templates/static/style.css` & `mercurial-6.5rc0/mercurial/templates/static/style.css`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/templateutil.py` & `mercurial-6.5rc0/mercurial/templateutil.py`

 * *Files 0% similar despite different names*

```diff
@@ -277,15 +277,15 @@
 
     def contains(self, context, mapping, item):
         item = unwrapastype(context, mapping, item, self._keytype)
         return item in self._values
 
     def getmember(self, context, mapping, key):
         # TODO: maybe split hybrid list/dict types?
-        if not util.safehasattr(self._values, b'get'):
+        if not util.safehasattr(self._values, 'get'):
             raise error.ParseError(_(b'not a dictionary'))
         key = unwrapastype(context, mapping, key, self._keytype)
         return self._wrapvalue(key, self._values.get(key))
 
     def getmin(self, context, mapping):
         return self._getby(context, mapping, min)
 
@@ -297,21 +297,21 @@
             raise error.ParseError(_(b'empty sequence'))
         val = func(self._values)
         return self._wrapvalue(val, val)
 
     def _wrapvalue(self, key, val):
         if val is None:
             return
-        if util.safehasattr(val, b'_makemap'):
+        if util.safehasattr(val, '_makemap'):
             # a nested hybrid list/dict, which has its own way of map operation
             return val
         return hybriditem(None, key, val, self._makemap)
 
     def filter(self, context, mapping, select):
-        if util.safehasattr(self._values, b'get'):
+        if util.safehasattr(self._values, 'get'):
             values = {
                 k: v
                 for k, v in self._values.items()
                 if select(self._wrapvalue(k, v))
             }
         else:
             values = [v for v in self._values if select(self._wrapvalue(v, v))]
@@ -337,15 +337,15 @@
 
     def tobool(self, context, mapping):
         return bool(self._values)
 
     def tovalue(self, context, mapping):
         # TODO: make it non-recursive for trivial lists/dicts
         xs = self._values
-        if util.safehasattr(xs, b'get'):
+        if util.safehasattr(xs, 'get'):
             return {k: unwrapvalue(context, mapping, v) for k, v in xs.items()}
         return [unwrapvalue(context, mapping, x) for x in xs]
 
 
 class hybriditem(mappable, wrapped):
     """Wrapper for non-list/dict object to support map operation
 
@@ -854,25 +854,25 @@
         # against infinite recursion.
         raise error.ProgrammingError(
             b'Mercurial IO including templates is done'
             b' with bytes, not strings, got %r' % thing
         )
     elif thing is None:
         pass
-    elif not util.safehasattr(thing, b'__iter__'):
+    elif not util.safehasattr(thing, '__iter__'):
         yield pycompat.bytestr(thing)
     else:
         for i in thing:
             if isinstance(i, wrapped):
                 i = i.show(context, mapping)
             if isinstance(i, bytes):
                 yield i
             elif i is None:
                 pass
-            elif not util.safehasattr(i, b'__iter__'):
+            elif not util.safehasattr(i, '__iter__'):
                 yield pycompat.bytestr(i)
             else:
                 for j in flatten(context, mapping, i):
                     yield j
 
 
 def stringify(context, mapping, thing):
```

### Comparing `mercurial-6.4rc0/mercurial/testing/__init__.py` & `mercurial-6.5rc0/mercurial/testing/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/testing/revlog.py` & `mercurial-6.5rc0/mercurial/testing/revlog.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/testing/storage.py` & `mercurial-6.5rc0/mercurial/testing/storage.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/LICENSE` & `mercurial-6.5rc0/mercurial/thirdparty/attr/LICENSE`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/__init__.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/__init__.pyi` & `mercurial-6.5rc0/mercurial/thirdparty/attr/__init__.pyi`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/_cmp.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/_cmp.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/_compat.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/_compat.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/_config.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/_config.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/_funcs.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/_funcs.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/_make.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/_make.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/_next_gen.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/_next_gen.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/_version_info.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/_version_info.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/converters.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/converters.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/exceptions.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/exceptions.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/exceptions.pyi` & `mercurial-6.5rc0/mercurial/thirdparty/attr/exceptions.pyi`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/filters.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/filters.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/setters.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/setters.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/setters.pyi` & `mercurial-6.5rc0/mercurial/thirdparty/attr/setters.pyi`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/validators.py` & `mercurial-6.5rc0/mercurial/thirdparty/attr/validators.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/attr/validators.pyi` & `mercurial-6.5rc0/mercurial/thirdparty/attr/validators.pyi`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/cbor/.travis.yml` & `mercurial-6.5rc0/mercurial/thirdparty/cbor/.travis.yml`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/cbor/LICENSE.txt` & `mercurial-6.5rc0/mercurial/thirdparty/cbor/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/cbor/README.rst` & `mercurial-6.5rc0/mercurial/thirdparty/cbor/README.rst`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/cbor/cbor2/compat.py` & `mercurial-6.5rc0/mercurial/thirdparty/cbor/cbor2/compat.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/cbor/cbor2/decoder.py` & `mercurial-6.5rc0/mercurial/thirdparty/cbor/cbor2/decoder.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/cbor/cbor2/encoder.py` & `mercurial-6.5rc0/mercurial/thirdparty/cbor/cbor2/encoder.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/cbor/cbor2/types.py` & `mercurial-6.5rc0/mercurial/thirdparty/cbor/cbor2/types.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/sha1dc/LICENSE.txt` & `mercurial-6.5rc0/mercurial/thirdparty/sha1dc/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/sha1dc/README.md` & `mercurial-6.5rc0/mercurial/thirdparty/sha1dc/README.md`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/sha1dc/cext.c` & `mercurial-6.5rc0/mercurial/thirdparty/sha1dc/cext.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/sha1dc/lib/sha1.c` & `mercurial-6.5rc0/mercurial/thirdparty/sha1dc/lib/sha1.c`

 * *Files 0% similar despite different names*

```diff
@@ -98,14 +98,18 @@
 /*
  * Defines Big Endian on a whitelist of OSs that are known to be Big
  * Endian-only. See
  * https://public-inbox.org/git/93056823-2740-d072-1ebd-46b440b33d7e@felt.demon.nl/
  */
 #define SHA1DC_BIGENDIAN
 
+#elif (defined(__APPLE__) && defined(__BIG_ENDIAN__) && !defined(SHA1DC_BIGENDIAN))
+/* older gcc compilers which are the default on Apple PPC do not define __BYTE_ORDER__ */
+#define SHA1DC_BIGENDIAN
+
 /* Not under GCC-alike or glibc or *BSD or newlib or <processor whitelist> or <os whitelist> */
 #elif defined(SHA1DC_ON_INTEL_LIKE_PROCESSOR)
 /*
  * As a last resort before we do anything else we're not 100% sure
  * about below, we blacklist specific processors here. We could add
  * more, see e.g. https://wiki.debian.org/ArchitectureSpecificsMemo
  */
```

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/sha1dc/lib/sha1.h` & `mercurial-6.5rc0/mercurial/thirdparty/sha1dc/lib/sha1.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/sha1dc/lib/ubc_check.c` & `mercurial-6.5rc0/mercurial/thirdparty/sha1dc/lib/ubc_check.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/sha1dc/lib/ubc_check.h` & `mercurial-6.5rc0/mercurial/thirdparty/sha1dc/lib/ubc_check.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/xdiff/xdiff.h` & `mercurial-6.5rc0/mercurial/thirdparty/xdiff/xdiff.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/xdiff/xdiffi.c` & `mercurial-6.5rc0/mercurial/thirdparty/xdiff/xdiffi.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/xdiff/xdiffi.h` & `mercurial-6.5rc0/mercurial/thirdparty/xdiff/xdiffi.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/xdiff/xinclude.h` & `mercurial-6.5rc0/mercurial/thirdparty/xdiff/xinclude.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/xdiff/xmacros.h` & `mercurial-6.5rc0/mercurial/thirdparty/xdiff/xmacros.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/xdiff/xprepare.c` & `mercurial-6.5rc0/mercurial/thirdparty/xdiff/xprepare.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/xdiff/xprepare.h` & `mercurial-6.5rc0/mercurial/thirdparty/xdiff/xprepare.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/xdiff/xtypes.h` & `mercurial-6.5rc0/mercurial/thirdparty/xdiff/xtypes.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/xdiff/xutils.c` & `mercurial-6.5rc0/mercurial/thirdparty/xdiff/xutils.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/xdiff/xutils.h` & `mercurial-6.5rc0/mercurial/thirdparty/xdiff/xutils.h`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/LICENSE.txt` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/__init__.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/__init__.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/_compat.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/_compat.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/_flatten.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/_flatten.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/_zope_interface_coptimizations.c` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/_zope_interface_coptimizations.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/adapter.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/adapter.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/advice.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/advice.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/common/idatetime.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/common/idatetime.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/common/interfaces.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/common/interfaces.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/common/mapping.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/common/mapping.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/common/sequence.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/common/sequence.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/declarations.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/declarations.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/document.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/document.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/exceptions.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/exceptions.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/interface.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/interface.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/interfaces.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/interfaces.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/registry.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/registry.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/ro.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/ro.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/thirdparty/zope/interface/verify.py` & `mercurial-6.5rc0/mercurial/thirdparty/zope/interface/verify.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/transaction.py` & `mercurial-6.5rc0/mercurial/transaction.py`

 * *Files 26% similar despite different names*

```diff
@@ -7,14 +7,16 @@
 # anything that isn't referenced in the changelog.
 #
 # Copyright 2005, 2006 Olivia Mackall <olivia@selenic.com>
 #
 # This software may be used and distributed according to the terms of the
 # GNU General Public License version 2 or any later version.
 
+import errno
+import os
 
 from .i18n import _
 from . import (
     error,
     pycompat,
     util,
 )
@@ -34,25 +36,121 @@
                 b'cannot use transaction when it is already committed/aborted'
             )
         return func(self, *args, **kwds)
 
     return _active
 
 
+UNDO_BACKUP = b'%s.backupfiles'
+
+UNDO_FILES_MAY_NEED_CLEANUP = [
+    # legacy entries that might exists on disk from previous version:
+    (b'store', b'%s.narrowspec'),
+    (b'plain', b'%s.narrowspec.dirstate'),
+    (b'plain', b'%s.branch'),
+    (b'plain', b'%s.bookmarks'),
+    (b'store', b'%s.phaseroots'),
+    (b'plain', b'%s.dirstate'),
+    # files actually in uses today:
+    (b'plain', b'%s.desc'),
+    # Always delete undo last to make sure we detect that a clean up is needed if
+    # the process is interrupted.
+    (b'store', b'%s'),
+]
+
+
+def cleanup_undo_files(report, vfsmap, undo_prefix=b'undo'):
+    """remove "undo" files used by the rollback logic
+
+    This is useful to prevent rollback running in situation were it does not
+    make sense. For example after a strip.
+    """
+    backup_listing = UNDO_BACKUP % undo_prefix
+
+    backup_entries = []
+    undo_files = []
+    svfs = vfsmap[b'store']
+    try:
+        with svfs(backup_listing) as f:
+            backup_entries = read_backup_files(report, f)
+    except OSError as e:
+        if e.errno != errno.ENOENT:
+            msg = _(b'could not read %s: %s\n')
+            msg %= (svfs.join(backup_listing), stringutil.forcebytestr(e))
+            report(msg)
+
+    for location, f, backup_path, c in backup_entries:
+        if location in vfsmap and backup_path:
+            undo_files.append((vfsmap[location], backup_path))
+
+    undo_files.append((svfs, backup_listing))
+    for location, undo_path in UNDO_FILES_MAY_NEED_CLEANUP:
+        undo_files.append((vfsmap[location], undo_path % undo_prefix))
+    for undovfs, undofile in undo_files:
+        try:
+            undovfs.unlink(undofile)
+        except OSError as e:
+            if e.errno != errno.ENOENT:
+                msg = _(b'error removing %s: %s\n')
+                msg %= (undovfs.join(undofile), stringutil.forcebytestr(e))
+                report(msg)
+
+
 def _playback(
     journal,
     report,
     opener,
     vfsmap,
     entries,
     backupentries,
     unlink=True,
     checkambigfiles=None,
 ):
+    """rollback a transaction :
+    - truncate files that have been appended to
+    - restore file backups
+    - delete temporary files
+    """
+    backupfiles = []
+
+    def restore_one_backup(vfs, f, b, checkambig):
+        filepath = vfs.join(f)
+        backuppath = vfs.join(b)
+        try:
+            util.copyfile(backuppath, filepath, checkambig=checkambig)
+            backupfiles.append((vfs, b))
+        except IOError as exc:
+            e_msg = stringutil.forcebytestr(exc)
+            report(_(b"failed to recover %s (%s)\n") % (f, e_msg))
+            raise
+
+    # gather all backup files that impact the store
+    # (we need this to detect files that are both backed up and truncated)
+    store_backup = {}
+    for entry in backupentries:
+        location, file_path, backup_path, cache = entry
+        vfs = vfsmap[location]
+        is_store = vfs.join(b'') == opener.join(b'')
+        if is_store and file_path and backup_path:
+            store_backup[file_path] = entry
+    copy_done = set()
+
+    # truncate all file `f` to offset `o`
     for f, o in sorted(dict(entries).items()):
+        # if we have a backup for `f`, we should restore it first and truncate
+        # the restored file
+        bck_entry = store_backup.get(f)
+        if bck_entry is not None:
+            location, file_path, backup_path, cache = bck_entry
+            checkambig = False
+            if checkambigfiles:
+                checkambig = (file_path, location) in checkambigfiles
+            restore_one_backup(opener, file_path, backup_path, checkambig)
+            copy_done.add(bck_entry)
+        # truncate the file to its pre-transaction size
         if o or not unlink:
             checkambig = checkambigfiles and (f, b'') in checkambigfiles
             try:
                 fp = opener(f, b'a', checkambig=checkambig)
                 if fp.tell() < o:
                     raise error.Abort(
                         _(
@@ -63,53 +161,60 @@
                     )
                 fp.truncate(o)
                 fp.close()
             except IOError:
                 report(_(b"failed to truncate %s\n") % f)
                 raise
         else:
+            # delete empty file
             try:
                 opener.unlink(f)
             except FileNotFoundError:
                 pass
-
-    backupfiles = []
-    for l, f, b, c in backupentries:
+    # restore backed up files and clean up temporary files
+    for entry in backupentries:
+        if entry in copy_done:
+            continue
+        l, f, b, c = entry
         if l not in vfsmap and c:
             report(b"couldn't handle %s: unknown cache location %s\n" % (b, l))
         vfs = vfsmap[l]
         try:
+            checkambig = checkambigfiles and (f, l) in checkambigfiles
             if f and b:
-                filepath = vfs.join(f)
-                backuppath = vfs.join(b)
-                checkambig = checkambigfiles and (f, l) in checkambigfiles
-                try:
-                    util.copyfile(backuppath, filepath, checkambig=checkambig)
-                    backupfiles.append(b)
-                except IOError as exc:
-                    e_msg = stringutil.forcebytestr(exc)
-                    report(_(b"failed to recover %s (%s)\n") % (f, e_msg))
+                restore_one_backup(vfs, f, b, checkambig)
             else:
                 target = f or b
                 try:
                     vfs.unlink(target)
                 except FileNotFoundError:
+                    # This is fine because
+                    #
+                    # either we are trying to delete the main file, and it is
+                    # already deleted.
+                    #
+                    # or we are trying to delete a temporary file and it is
+                    # already deleted.
+                    #
+                    # in both case, our target result (delete the file) is
+                    # already achieved.
                     pass
         except (IOError, OSError, error.Abort):
             if not c:
                 raise
 
+    # cleanup transaction state file and the backups file
     backuppath = b"%s.backupfiles" % journal
     if opener.exists(backuppath):
         opener.unlink(backuppath)
     opener.unlink(journal)
     try:
-        for f in backupfiles:
-            if opener.exists(f):
-                opener.unlink(f)
+        for vfs, f in backupfiles:
+            if vfs.exists(f):
+                vfs.unlink(f)
     except (IOError, OSError, error.Abort):
         # only pure backup file remains, it is sage to ignore any error
         pass
 
 
 class transaction(util.transactional):
     def __init__(
@@ -148,14 +253,15 @@
         vfsmap = vfsmap.copy()
         vfsmap[b''] = opener  # set default value
         self._vfsmap = vfsmap
         self._after = after
         self._offsetmap = {}
         self._newfiles = set()
         self._journal = journalname
+        self._journal_files = []
         self._undoname = undoname
         self._queue = []
         # A callback to do something just after releasing transaction.
         if releasefn is None:
             releasefn = lambda tr, success: None
         self._releasefn = releasefn
 
@@ -180,14 +286,16 @@
         #   use 'location' value as a key in a vfsmap to find the right 'vfs'
         # (cache is currently unused)
         self._backupentries = []
         self._backupmap = {}
         self._backupjournal = b"%s.backupfiles" % self._journal
         self._backupsfile = opener.open(self._backupjournal, b'w')
         self._backupsfile.write(b'%d\n' % version)
+        # the set of temporary files
+        self._tmp_files = set()
 
         if createmode is not None:
             opener.chmod(self._journal, createmode & 0o666)
             opener.chmod(self._backupjournal, createmode & 0o666)
 
         # hold file generations to be performed on commit
         self._filegenerators = {}
@@ -204,15 +312,15 @@
             self._validatecallback[b'001-userhooks'] = validator
         # hold callback for post transaction close
         self._postclosecallback = {}
         # holds callbacks to call during abort
         self._abortcallback = {}
 
     def __repr__(self):
-        name = '/'.join(self._names)
+        name = b'/'.join(self._names)
         return '<transaction name=%s, count=%d, usages=%d>' % (
             name,
             self._count,
             self._usages,
         )
 
     def __del__(self):
@@ -244,66 +352,81 @@
     @active
     def add(self, file, offset):
         """record the state of an append-only file before update"""
         if (
             file in self._newfiles
             or file in self._offsetmap
             or file in self._backupmap
+            or file in self._tmp_files
         ):
             return
         if self._queue:
             self._queue[-1].append((file, offset))
             return
 
         self._addentry(file, offset)
 
     def _addentry(self, file, offset):
         """add a append-only entry to memory and on-disk state"""
         if (
             file in self._newfiles
             or file in self._offsetmap
             or file in self._backupmap
+            or file in self._tmp_files
         ):
             return
         if offset:
             self._offsetmap[file] = offset
         else:
             self._newfiles.add(file)
         # add enough data to the journal to do the truncate
         self._file.write(b"%s\0%d\n" % (file, offset))
         self._file.flush()
 
     @active
-    def addbackup(self, file, hardlink=True, location=b''):
+    def addbackup(self, file, hardlink=True, location=b'', for_offset=False):
         """Adds a backup of the file to the transaction
 
         Calling addbackup() creates a hardlink backup of the specified file
         that is used to recover the file in the event of the transaction
         aborting.
 
         * `file`: the file path, relative to .hg/store
         * `hardlink`: use a hardlink to quickly create the backup
+
+        If `for_offset` is set, we expect a offset for this file to have been previously recorded
         """
         if self._queue:
             msg = b'cannot use transaction.addbackup inside "group"'
             raise error.ProgrammingError(msg)
 
-        if (
-            file in self._newfiles
-            or file in self._offsetmap
-            or file in self._backupmap
-        ):
+        if file in self._newfiles or file in self._backupmap:
             return
+        elif file in self._offsetmap and not for_offset:
+            return
+        elif for_offset and file not in self._offsetmap:
+            msg = (
+                'calling `addbackup` with `for_offmap=True`, '
+                'but no offset recorded: [%r] %r'
+            )
+            msg %= (location, file)
+            raise error.ProgrammingError(msg)
+
         vfs = self._vfsmap[location]
         dirname, filename = vfs.split(file)
-        backupfilename = b"%s.backup.%s" % (self._journal, filename)
+        backupfilename = b"%s.backup.%s.bck" % (self._journal, filename)
         backupfile = vfs.reljoin(dirname, backupfilename)
         if vfs.exists(file):
             filepath = vfs.join(file)
             backuppath = vfs.join(backupfile)
+            # store encoding may result in different directory here.
+            # so we have to ensure the destination directory exist
+            final_dir_name = os.path.dirname(backuppath)
+            util.makedirs(final_dir_name, mode=vfs.createmode, notindexed=True)
+            # then we can copy the backup
             util.copyfile(filepath, backuppath, hardlink=hardlink)
         else:
             backupfile = b''
 
         self._addbackupentry((location, file, backupfile, False))
 
     def _addbackupentry(self, entry):
@@ -316,14 +439,15 @@
     @active
     def registertmp(self, tmpfile, location=b''):
         """register a temporary transaction file
 
         Such files will be deleted when the transaction exits (on both
         failure and success).
         """
+        self._tmp_files.add(tmpfile)
         self._addbackupentry((location, b'', tmpfile, False))
 
     @active
     def addfilegenerator(
         self,
         genid,
         filenames,
@@ -628,18 +752,33 @@
     @active
     def abort(self):
         """abort the transaction (generally called on error, or when the
         transaction is not explicitly committed before going out of
         scope)"""
         self._abort()
 
+    @active
+    def add_journal(self, vfs_id, path):
+        self._journal_files.append((vfs_id, path))
+
     def _writeundo(self):
         """write transaction data for possible future undo call"""
         if self._undoname is None:
             return
+        cleanup_undo_files(
+            self._report,
+            self._vfsmap,
+            undo_prefix=self._undoname,
+        )
+
+        def undoname(fn: bytes) -> bytes:
+            base, name = os.path.split(fn)
+            assert name.startswith(self._journal)
+            new_name = name.replace(self._journal, self._undoname, 1)
+            return os.path.join(base, new_name)
 
         undo_backup_path = b"%s.backupfiles" % self._undoname
         undobackupfile = self._opener.open(undo_backup_path, b'w')
         undobackupfile.write(b'%d\n' % version)
         for l, f, b, c in self._backupentries:
             if not f:  # temporary file
                 continue
@@ -649,21 +788,28 @@
                 if l not in self._vfsmap and c:
                     self._report(
                         b"couldn't remove %s: unknown cache location"
                         b"%s\n" % (b, l)
                     )
                     continue
                 vfs = self._vfsmap[l]
-                base, name = vfs.split(b)
-                assert name.startswith(self._journal), name
-                uname = name.replace(self._journal, self._undoname, 1)
-                u = vfs.reljoin(base, uname)
+                u = undoname(b)
                 util.copyfile(vfs.join(b), vfs.join(u), hardlink=True)
             undobackupfile.write(b"%s\0%s\0%s\0%d\n" % (l, f, u, c))
         undobackupfile.close()
+        for vfs, src in self._journal_files:
+            dest = undoname(src)
+            # if src and dest refer to a same file, vfs.rename is a no-op,
+            # leaving both src and dest on disk. delete dest to make sure
+            # the rename couldn't be such a no-op.
+            vfs.tryunlink(dest)
+            try:
+                vfs.rename(src, dest)
+            except FileNotFoundError:  # journal file does not yet exist
+                pass
 
     def _abort(self):
         entries = self.readjournal()
         self._count = 0
         self._usages = 0
         self._file.close()
         self._backupsfile.close()
@@ -733,14 +879,40 @@
 
 
 BAD_VERSION_MSG = _(
     b"journal was created by a different version of Mercurial\n"
 )
 
 
+def read_backup_files(report, fp):
+    """parse an (already open) backup file an return contained backup entries
+
+    entries are in the form: (location, file, backupfile, xxx)
+
+    :location:   the vfs identifier (vfsmap's key)
+    :file:       original file path (in the vfs)
+    :backupfile: path of the backup (in the vfs)
+    :cache:      a boolean currently always set to False
+    """
+    lines = fp.readlines()
+    backupentries = []
+    if lines:
+        ver = lines[0][:-1]
+        if ver != (b'%d' % version):
+            report(BAD_VERSION_MSG)
+        else:
+            for line in lines[1:]:
+                if line:
+                    # Shave off the trailing newline
+                    line = line[:-1]
+                    l, f, b, c = line.split(b'\0')
+                    backupentries.append((l, f, b, bool(c)))
+    return backupentries
+
+
 def rollback(
     opener,
     vfsmap,
     file,
     report,
     checkambigfiles=None,
     skip_journal_pattern=None,
@@ -772,27 +944,16 @@
         except ValueError:
             report(
                 _(b"couldn't read journal entry %r!\n") % pycompat.bytestr(l)
             )
 
     backupjournal = b"%s.backupfiles" % file
     if opener.exists(backupjournal):
-        fp = opener.open(backupjournal)
-        lines = fp.readlines()
-        if lines:
-            ver = lines[0][:-1]
-            if ver != (b'%d' % version):
-                report(BAD_VERSION_MSG)
-            else:
-                for line in lines[1:]:
-                    if line:
-                        # Shave off the trailing newline
-                        line = line[:-1]
-                        l, f, b, c = line.split(b'\0')
-                        backupentries.append((l, f, b, bool(c)))
+        with opener.open(backupjournal) as fp:
+            backupentries = read_backup_files(report, fp)
     if skip_journal_pattern is not None:
         keep = lambda x: not skip_journal_pattern.match(x[1])
         backupentries = [x for x in backupentries if keep(x)]
 
     _playback(
         file,
         report,
```

### Comparing `mercurial-6.4rc0/mercurial/treediscovery.py` & `mercurial-6.5rc0/mercurial/treediscovery.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/txnutil.py` & `mercurial-6.5rc0/mercurial/txnutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/typelib.py` & `mercurial-6.5rc0/mercurial/typelib.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/ui.py` & `mercurial-6.5rc0/mercurial/ui.py`

 * *Files 1% similar despite different names*

```diff
@@ -1103,18 +1103,24 @@
     def paths(self):
         return urlutil.paths(self)
 
     @property
     def fout(self):
         return self._fout
 
+    @util.propertycache
+    def _fout_is_a_tty(self):
+        self._isatty(self._fout)
+
     @fout.setter
     def fout(self, f):
         self._fout = f
         self._fmsgout, self._fmsgerr = _selectmsgdests(self)
+        if '_fout_is_a_tty' in vars(self):
+            del self._fout_is_a_tty
 
     @property
     def ferr(self):
         return self._ferr
 
     @ferr.setter
     def ferr(self, f):
@@ -1230,15 +1236,15 @@
             if label and self._bufferapplylabels:
                 self._buffers[-1].extend(self.label(a, label) for a in args)
             else:
                 self._buffers[-1].extend(args)
             return
 
         # inlined _writenobuf() for speed
-        if not opts.get('keepprogressbar', False):
+        if not opts.get('keepprogressbar', self._fout_is_a_tty):
             self._progclear()
         msg = b''.join(args)
 
         # opencode timeblockedsection because this is a critical path
         starttime = util.timer()
         try:
             if self._colormode == b'win32':
@@ -1269,15 +1275,15 @@
             else:
                 self._buffers[-1].extend(args)
         else:
             self._writenobuf(dest, *args, **opts)
 
     def _writenobuf(self, dest, *args: bytes, **opts: _MsgOpts) -> None:
         # update write() as well if you touch this code
-        if not opts.get('keepprogressbar', False):
+        if not opts.get('keepprogressbar', self._fout_is_a_tty):
             self._progclear()
         msg = b''.join(args)
 
         # opencode timeblockedsection because this is a critical path
         starttime = util.timer()
         try:
             if dest is self._ferr and not getattr(self._fout, 'closed', False):
```

### Comparing `mercurial-6.4rc0/mercurial/unionrepo.py` & `mercurial-6.5rc0/mercurial/unionrepo.py`

 * *Files 2% similar despite different names*

```diff
@@ -266,16 +266,16 @@
 
     def close(self):
         self.repo2.close()
 
     def cancopy(self):
         return False
 
-    def peer(self, path=None):
-        return unionpeer(self, path=None)
+    def peer(self, path=None, remotehidden=False):
+        return unionpeer(self, path=None, remotehidden=remotehidden)
 
     def getcwd(self):
         return encoding.getcwd()  # always outside the repo
 
 
 def instance(ui, path, create, intents=None, createopts=None):
     if create:
```

### Comparing `mercurial-6.4rc0/mercurial/upgrade.py` & `mercurial-6.5rc0/mercurial/upgrade.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/upgrade_utils/actions.py` & `mercurial-6.5rc0/mercurial/upgrade_utils/actions.py`

 * *Files 0% similar despite different names*

```diff
@@ -946,17 +946,14 @@
 def blocksourcerequirements(repo):
     """Obtain requirements that will prevent an upgrade from occurring.
 
     An upgrade cannot be performed if the source repository contains a
     requirements in the returned set.
     """
     return {
-        # The upgrade code does not yet support these experimental features.
-        # This is an artificial limitation.
-        requirements.TREEMANIFEST_REQUIREMENT,
         # This was a precursor to generaldelta and was never enabled by default.
         # It should (hopefully) not exist in the wild.
         b'parentdelta',
     }
 
 
 def check_revlog_version(reqs):
@@ -1048,14 +1045,15 @@
         requirements.NODEMAP_REQUIREMENT,
         requirements.REVLOGV1_REQUIREMENT,  # allowed in case of downgrade
         requirements.REVLOGV2_REQUIREMENT,
         requirements.SHARED_REQUIREMENT,
         requirements.SHARESAFE_REQUIREMENT,
         requirements.SPARSEREVLOG_REQUIREMENT,
         requirements.STORE_REQUIREMENT,
+        requirements.TREEMANIFEST_REQUIREMENT,
         requirements.NARROW_REQUIREMENT,
     }
     for name in compression.compengines:
         engine = compression.compengines[name]
         if engine.available() and engine.revlogheader():
             supported.add(b'exp-compression-%s' % name)
             if engine.name() == b'zstd':
```

### Comparing `mercurial-6.4rc0/mercurial/upgrade_utils/auto_upgrade.py` & `mercurial-6.5rc0/mercurial/upgrade_utils/auto_upgrade.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/upgrade_utils/engine.py` & `mercurial-6.5rc0/mercurial/upgrade_utils/engine.py`

 * *Files 8% similar despite different names*

```diff
@@ -7,18 +7,15 @@
 
 
 import stat
 
 from ..i18n import _
 from ..pycompat import getattr
 from .. import (
-    changelog,
     error,
-    filelog,
-    manifest,
     metadata,
     pycompat,
     requirements,
     scmutil,
     store,
     util,
     vfs as vfsmod,
@@ -43,48 +40,23 @@
             metadata._get_worker_sidedata_adder(srcrepo, dstrepo),
             flagutil.REVIDX_HASCOPIESINFO,
             replace=True,
         )
     return sidedatamod.get_sidedata_helpers(srcrepo, dstrepo._wanted_sidedata)
 
 
-def _revlogfrompath(repo, rl_type, path):
-    """Obtain a revlog from a repo path.
-
-    An instance of the appropriate class is returned.
-    """
-    if rl_type & store.FILEFLAGS_CHANGELOG:
-        return changelog.changelog(repo.svfs)
-    elif rl_type & store.FILEFLAGS_MANIFESTLOG:
-        mandir = b''
-        if b'/' in path:
-            mandir = path.rsplit(b'/', 1)[0]
-        return manifest.manifestrevlog(
-            repo.nodeconstants, repo.svfs, tree=mandir
-        )
-    else:
-        # drop the extension and the `data/` prefix
-        path_part = path.rsplit(b'.', 1)[0].split(b'/', 1)
-        if len(path_part) < 2:
-            msg = _(b'cannot recognize revlog from filename: %s')
-            msg %= path
-            raise error.Abort(msg)
-        path = path_part[1]
-        return filelog.filelog(repo.svfs, path)
-
-
-def _copyrevlog(tr, destrepo, oldrl, rl_type, unencodedname):
+def _copyrevlog(tr, destrepo, oldrl, entry):
     """copy all relevant files for `oldrl` into `destrepo` store
 
     Files are copied "as is" without any transformation. The copy is performed
     without extra checks. Callers are responsible for making sure the copied
     content is compatible with format of the destination repository.
     """
     oldrl = getattr(oldrl, '_revlog', oldrl)
-    newrl = _revlogfrompath(destrepo, rl_type, unencodedname)
+    newrl = entry.get_revlog_instance(destrepo)
     newrl = getattr(newrl, '_revlog', newrl)
 
     oldvfs = oldrl.opener
     newvfs = newrl.opener
     oldindex = oldvfs.join(oldrl._indexfile)
     newindex = newvfs.join(newrl._indexfile)
     olddata = oldvfs.join(oldrl._datafile)
@@ -94,76 +66,78 @@
         pass  # create all the directories
 
     util.copyfile(oldindex, newindex)
     copydata = oldrl.opener.exists(oldrl._datafile)
     if copydata:
         util.copyfile(olddata, newdata)
 
-    if rl_type & store.FILEFLAGS_FILELOG:
+    if entry.is_filelog:
+        unencodedname = entry.main_file_path()
         destrepo.svfs.fncache.add(unencodedname)
         if copydata:
             destrepo.svfs.fncache.add(unencodedname[:-2] + b'.d')
 
 
 UPGRADE_CHANGELOG = b"changelog"
 UPGRADE_MANIFEST = b"manifest"
 UPGRADE_FILELOGS = b"all-filelogs"
 
 UPGRADE_ALL_REVLOGS = frozenset(
     [UPGRADE_CHANGELOG, UPGRADE_MANIFEST, UPGRADE_FILELOGS]
 )
 
 
-def matchrevlog(revlogfilter, rl_type):
+def matchrevlog(revlogfilter, entry):
     """check if a revlog is selected for cloning.
 
     In other words, are there any updates which need to be done on revlog
     or it can be blindly copied.
 
     The store entry is checked against the passed filter"""
-    if rl_type & store.FILEFLAGS_CHANGELOG:
+    if entry.is_changelog:
         return UPGRADE_CHANGELOG in revlogfilter
-    elif rl_type & store.FILEFLAGS_MANIFESTLOG:
+    elif entry.is_manifestlog:
         return UPGRADE_MANIFEST in revlogfilter
-    assert rl_type & store.FILEFLAGS_FILELOG
+    assert entry.is_filelog
     return UPGRADE_FILELOGS in revlogfilter
 
 
 def _perform_clone(
     ui,
     dstrepo,
     tr,
     old_revlog,
-    rl_type,
-    unencoded,
+    entry,
     upgrade_op,
     sidedata_helpers,
     oncopiedrevision,
 ):
     """returns the new revlog object created"""
     newrl = None
-    if matchrevlog(upgrade_op.revlogs_to_process, rl_type):
+    revlog_path = entry.main_file_path()
+    if matchrevlog(upgrade_op.revlogs_to_process, entry):
         ui.note(
-            _(b'cloning %d revisions from %s\n') % (len(old_revlog), unencoded)
+            _(b'cloning %d revisions from %s\n')
+            % (len(old_revlog), revlog_path)
         )
-        newrl = _revlogfrompath(dstrepo, rl_type, unencoded)
+        newrl = entry.get_revlog_instance(dstrepo)
         old_revlog.clone(
             tr,
             newrl,
             addrevisioncb=oncopiedrevision,
             deltareuse=upgrade_op.delta_reuse_mode,
             forcedeltabothparents=upgrade_op.force_re_delta_both_parents,
             sidedata_helpers=sidedata_helpers,
         )
     else:
         msg = _(b'blindly copying %s containing %i revisions\n')
-        ui.note(msg % (unencoded, len(old_revlog)))
-        _copyrevlog(tr, dstrepo, old_revlog, rl_type, unencoded)
+        ui.note(msg % (revlog_path, len(old_revlog)))
+        _copyrevlog(tr, dstrepo, old_revlog, entry)
 
-        newrl = _revlogfrompath(dstrepo, rl_type, unencoded)
+        newrl = entry.get_revlog_instance(dstrepo)
     return newrl
 
 
 def _clonerevlogs(
     ui,
     srcrepo,
     dstrepo,
@@ -196,30 +170,19 @@
     # value is revlog_object_from_srcrepo
     manifests = {}
     changelogs = {}
     filelogs = {}
 
     # Perform a pass to collect metadata. This validates we can open all
     # source files and allows a unified progress bar to be displayed.
-    for rl_type, unencoded, size in alldatafiles:
-        if not rl_type & store.FILEFLAGS_REVLOG_MAIN:
+    for entry in alldatafiles:
+        if not entry.is_revlog:
             continue
 
-        # the store.walk function will wrongly pickup transaction backup and
-        # get confused. As a quick fix for 5.9 release, we ignore those.
-        # (this is not a module constants because it seems better to keep the
-        # hack together)
-        skip_undo = (
-            b'undo.backup.00changelog.i',
-            b'undo.backup.00manifest.i',
-        )
-        if unencoded in skip_undo:
-            continue
-
-        rl = _revlogfrompath(srcrepo, rl_type, unencoded)
+        rl = entry.get_revlog_instance(srcrepo)
 
         info = rl.storageinfo(
             exclusivefiles=True,
             revisionscount=True,
             trackedsize=True,
             storedsize=True,
         )
@@ -228,27 +191,27 @@
         datasize = info[b'storedsize'] or 0
         rawsize = info[b'trackedsize'] or 0
 
         srcsize += datasize
         srcrawsize += rawsize
 
         # This is for the separate progress bars.
-        if rl_type & store.FILEFLAGS_CHANGELOG:
-            changelogs[unencoded] = rl_type
+        if entry.is_changelog:
+            changelogs[entry.target_id] = entry
             crevcount += len(rl)
             csrcsize += datasize
             crawsize += rawsize
-        elif rl_type & store.FILEFLAGS_MANIFESTLOG:
-            manifests[unencoded] = rl_type
+        elif entry.is_manifestlog:
+            manifests[entry.target_id] = entry
             mcount += 1
             mrevcount += len(rl)
             msrcsize += datasize
             mrawsize += rawsize
-        elif rl_type & store.FILEFLAGS_FILELOG:
-            filelogs[unencoded] = rl_type
+        elif entry.is_filelog:
+            filelogs[entry.target_id] = entry
             fcount += 1
             frevcount += len(rl)
             fsrcsize += datasize
             frawsize += rawsize
         else:
             error.ProgrammingError(b'unknown revlog type')
 
@@ -285,24 +248,23 @@
             fcount,
             frevcount,
             util.bytecount(fsrcsize),
             util.bytecount(frawsize),
         )
     )
     progress = srcrepo.ui.makeprogress(_(b'file revisions'), total=frevcount)
-    for unencoded, rl_type in sorted(filelogs.items()):
-        oldrl = _revlogfrompath(srcrepo, rl_type, unencoded)
+    for target_id, entry in sorted(filelogs.items()):
+        oldrl = entry.get_revlog_instance(srcrepo)
 
         newrl = _perform_clone(
             ui,
             dstrepo,
             tr,
             oldrl,
-            rl_type,
-            unencoded,
+            entry,
             upgrade_op,
             sidedata_helpers,
             oncopiedrevision,
         )
         info = newrl.storageinfo(storedsize=True)
         fdstsize += info[b'storedsize'] or 0
     ui.status(
@@ -327,23 +289,22 @@
         )
     )
     if progress:
         progress.complete()
     progress = srcrepo.ui.makeprogress(
         _(b'manifest revisions'), total=mrevcount
     )
-    for unencoded, rl_type in sorted(manifests.items()):
-        oldrl = _revlogfrompath(srcrepo, rl_type, unencoded)
+    for target_id, entry in sorted(manifests.items()):
+        oldrl = entry.get_revlog_instance(srcrepo)
         newrl = _perform_clone(
             ui,
             dstrepo,
             tr,
             oldrl,
-            rl_type,
-            unencoded,
+            entry,
             upgrade_op,
             sidedata_helpers,
             oncopiedrevision,
         )
         info = newrl.storageinfo(storedsize=True)
         mdstsize += info[b'storedsize'] or 0
     ui.status(
@@ -367,23 +328,22 @@
         )
     )
     if progress:
         progress.complete()
     progress = srcrepo.ui.makeprogress(
         _(b'changelog revisions'), total=crevcount
     )
-    for unencoded, rl_type in sorted(changelogs.items()):
-        oldrl = _revlogfrompath(srcrepo, rl_type, unencoded)
+    for target_id, entry in sorted(changelogs.items()):
+        oldrl = entry.get_revlog_instance(srcrepo)
         newrl = _perform_clone(
             ui,
             dstrepo,
             tr,
             oldrl,
-            rl_type,
-            unencoded,
+            entry,
             upgrade_op,
             sidedata_helpers,
             oncopiedrevision,
         )
         info = newrl.storageinfo(storedsize=True)
         cdstsize += info[b'storedsize'] or 0
     progress.complete()
@@ -406,15 +366,15 @@
 
 
 def _files_to_copy_post_revlog_clone(srcrepo):
     """yields files which should be copied to destination after revlogs
     are cloned"""
     for path, kind, st in sorted(srcrepo.store.vfs.readdir(b'', stat=True)):
         # don't copy revlogs as they are already cloned
-        if store.revlog_type(path) is not None:
+        if store.is_revlog_file(path):
             continue
         # Skip transaction related files.
         if path.startswith(b'undo'):
             continue
         # Only copy regular files.
         if kind != stat.S_IFREG:
             continue
@@ -651,28 +611,34 @@
             )
         except FileNotFoundError:
             # The dirstate does not exist on an empty repo or a repo with no
             # revision checked out
             pass
 
     assert srcrepo.dirstate._use_dirstate_v2 == (old == b'v2')
+    use_v2 = new == b'v2'
+    if use_v2:
+        # Write the requirements *before* upgrading
+        scmutil.writereporequirements(srcrepo, upgrade_op.new_requirements)
+
     srcrepo.dirstate._map.preload()
-    srcrepo.dirstate._use_dirstate_v2 = new == b'v2'
-    srcrepo.dirstate._map._use_dirstate_v2 = srcrepo.dirstate._use_dirstate_v2
+    srcrepo.dirstate._use_dirstate_v2 = use_v2
+    srcrepo.dirstate._map._use_dirstate_v2 = use_v2
     srcrepo.dirstate._dirty = True
     try:
         srcrepo.vfs.unlink(b'dirstate')
     except FileNotFoundError:
         # The dirstate does not exist on an empty repo or a repo with no
         # revision checked out
         pass
 
     srcrepo.dirstate.write(None)
-
-    scmutil.writereporequirements(srcrepo, upgrade_op.new_requirements)
+    if not use_v2:
+        # Remove the v2 requirement *after* downgrading
+        scmutil.writereporequirements(srcrepo, upgrade_op.new_requirements)
 
 
 def upgrade_tracked_hint(ui, srcrepo, upgrade_op, add):
     if add:
         srcrepo.dirstate._use_tracked_hint = True
         srcrepo.dirstate._dirty = True
         srcrepo.dirstate._dirty_tracked_set = True
```

### Comparing `mercurial-6.4rc0/mercurial/url.py` & `mercurial-6.5rc0/mercurial/url.py`

 * *Files 2% similar despite different names*

```diff
@@ -186,15 +186,15 @@
                 orgsend(self, chunk)
         else:
             orgsend(self, data)
 
     return _sendfile
 
 
-has_https = util.safehasattr(urlreq, b'httpshandler')
+has_https = util.safehasattr(urlreq, 'httpshandler')
 
 
 class httpconnection(keepalive.HTTPConnection):
     # must be able to send big bundle as stream.
     send = _gen_sendfile(keepalive.HTTPConnection.send)
 
 
@@ -323,15 +323,17 @@
             **kwargs
         ):
             keepalive.HTTPConnection.__init__(self, host, port, *args, **kwargs)
             self.key_file = key_file
             self.cert_file = cert_file
 
         def connect(self):
-            self.sock = socket.create_connection((self.host, self.port))
+            self.sock = socket.create_connection(
+                (self.host, self.port), self.timeout
+            )
 
             host = self.host
             realhostport = self.realhostport  # pytype: disable=attribute-error
             if realhostport:  # use CONNECT proxy
                 _generic_proxytunnel(self)
                 host = realhostport.rsplit(b':', 1)[0]
             self.sock = sslutil.wrapsocket(
```

### Comparing `mercurial-6.4rc0/mercurial/urllibcompat.py` & `mercurial-6.5rc0/mercurial/urllibcompat.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/util.py` & `mercurial-6.5rc0/mercurial/util.py`

 * *Files 1% similar despite different names*

```diff
@@ -2206,18 +2206,29 @@
     import re2  # pytype: disable=import-error
 
     _re2 = None
 except ImportError:
     _re2 = False
 
 
+def has_re2():
+    """return True is re2 is available, False otherwise"""
+    if _re2 is None:
+        _re._checkre2()
+    return _re2
+
+
 class _re:
-    def _checkre2(self):
+    @staticmethod
+    def _checkre2():
         global _re2
         global _re2_input
+        if _re2 is not None:
+            # we already have the answer
+            return
 
         check_pattern = br'\[([^\[]+)\]'
         check_input = b'[ui]'
         try:
             # check if match works, see issue3964
             _re2 = bool(re2.match(check_pattern, check_input))
         except ImportError:
```

### Comparing `mercurial-6.4rc0/mercurial/utils/cborutil.py` & `mercurial-6.5rc0/mercurial/utils/cborutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/utils/compression.py` & `mercurial-6.5rc0/mercurial/utils/compression.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/utils/dateutil.py` & `mercurial-6.5rc0/mercurial/utils/dateutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/utils/memorytop.py` & `mercurial-6.5rc0/mercurial/utils/memorytop.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/utils/procutil.py` & `mercurial-6.5rc0/mercurial/utils/procutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/utils/repoviewutil.py` & `mercurial-6.5rc0/mercurial/utils/repoviewutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/utils/resourceutil.py` & `mercurial-6.5rc0/mercurial/utils/resourceutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/utils/storageutil.py` & `mercurial-6.5rc0/mercurial/utils/storageutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/utils/stringutil.py` & `mercurial-6.5rc0/mercurial/utils/stringutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/utils/urlutil.py` & `mercurial-6.5rc0/mercurial/utils/urlutil.py`

 * *Files 3% similar despite different names*

```diff
@@ -229,15 +229,15 @@
                 raise error.Abort(
                     _(b'file:// URLs can only refer to localhost')
                 )
 
         self.path = path
 
         # leave the query string escaped
-        for a in (b'user', b'passwd', b'host', b'port', b'path', b'fragment'):
+        for a in ('user', 'passwd', 'host', 'port', 'path', 'fragment'):
             v = getattr(self, a)
             if v is not None:
                 setattr(self, a, urlreq.unquote(v))
 
     def copy(self):
         u = url(b'temporary useless value')
         u.path = self.path
@@ -654,38 +654,49 @@
             new_paths = []
             for p in old_paths:
                 new_paths.extend(_chain_path(p, ui, self))
             self[name] = new_paths
 
 
 _pathsuboptions = {}
+# a dictionnary of methods that can be used to format a sub-option value
+path_suboptions_display = {}
 
 
-def pathsuboption(option, attr):
+def pathsuboption(option, attr, display=pycompat.bytestr):
     """Decorator used to declare a path sub-option.
 
     Arguments are the sub-option name and the attribute it should set on
     ``path`` instances.
 
     The decorated function will receive as arguments a ``ui`` instance,
     ``path`` instance, and the string value of this option from the config.
     The function should return the value that will be set on the ``path``
     instance.
 
+    The optional `display` argument is a function that can be used to format
+    the value when displayed to the user (like in `hg paths` for example).
+
     This decorator can be used to perform additional verification of
     sub-options and to change the type of sub-options.
     """
 
     def register(func):
         _pathsuboptions[option] = (attr, func)
+        path_suboptions_display[option] = display
         return func
 
     return register
 
 
+def display_bool(value):
+    """display a boolean suboption back to the user"""
+    return b'yes' if value else b'no'
+
+
 @pathsuboption(b'pushurl', b'_pushloc')
 def pushurlpathoption(ui, path, value):
     u = url(value)
     # Actually require a URL.
     if not u.scheme:
         msg = _(b'(paths.%s:pushurl not a URL; ignoring: "%s")\n')
         msg %= (path.name, value)
@@ -736,32 +747,37 @@
 
 DELTA_REUSE_POLICIES = {
     b'default': None,
     b'try-base': revlog_constants.DELTA_BASE_REUSE_TRY,
     b'no-reuse': revlog_constants.DELTA_BASE_REUSE_NO,
     b'forced': revlog_constants.DELTA_BASE_REUSE_FORCE,
 }
+DELTA_REUSE_POLICIES_NAME = dict(i[::-1] for i in DELTA_REUSE_POLICIES.items())
 
 
-@pathsuboption(b'pulled-delta-reuse-policy', b'delta_reuse_policy')
+@pathsuboption(
+    b'pulled-delta-reuse-policy',
+    b'delta_reuse_policy',
+    display=DELTA_REUSE_POLICIES_NAME.get,
+)
 def delta_reuse_policy(ui, path, value):
     if value not in DELTA_REUSE_POLICIES:
         path_name = path.name
         if path_name is None:
             # this is an "anonymous" path, config comes from the global one
             path_name = b'*'
         msg = _(
             b'(paths.%s:pulled-delta-reuse-policy has unknown value: "%s")\n'
         )
         msg %= (path_name, value)
         ui.warn(msg)
     return DELTA_REUSE_POLICIES.get(value)
 
 
-@pathsuboption(b'multi-urls', b'multi_urls')
+@pathsuboption(b'multi-urls', b'multi_urls', display=display_bool)
 def multiurls_pathoption(ui, path, value):
     res = stringutil.parsebool(value)
     if res is None:
         ui.warn(
             _(b'(paths.%s:multi-urls not a boolean; ignoring)\n') % path.name
         )
         res = False
```

### Comparing `mercurial-6.4rc0/mercurial/verify.py` & `mercurial-6.5rc0/mercurial/verify.py`

 * *Files 2% similar despite different names*

```diff
@@ -403,18 +403,21 @@
 
         if not dir and subdirnodes:
             self.ui.status(_(b"checking directory manifests\n"))
             storefiles = set()
             subdirs = set()
             revlogv1 = self.revlogv1
             undecodable = []
-            for t, f, size in repo.store.datafiles(undecodable=undecodable):
-                if (size > 0 or not revlogv1) and f.startswith(b'meta/'):
-                    storefiles.add(_normpath(f))
-                    subdirs.add(os.path.dirname(f))
+            for entry in repo.store.data_entries(undecodable=undecodable):
+                for file_ in entry.files():
+                    f = file_.unencoded_path
+                    size = file_.file_size(repo.store.vfs)
+                    if (size > 0 or not revlogv1) and f.startswith(b'meta/'):
+                        storefiles.add(_normpath(f))
+                        subdirs.add(os.path.dirname(f))
             for f in undecodable:
                 self._err(None, _(b"cannot decode filename '%s'") % f)
             subdirprogress = ui.makeprogress(
                 _(b'checking'), unit=_(b'manifests'), total=len(subdirs)
             )
 
         for subdir, linkrevs in subdirnodes.items():
@@ -468,17 +471,20 @@
         lrugetctx = self.lrugetctx
         revlogv1 = self.revlogv1
         havemf = self.havemf
         ui.status(_(b"checking files\n"))
 
         storefiles = set()
         undecodable = []
-        for t, f, size in repo.store.datafiles(undecodable=undecodable):
-            if (size > 0 or not revlogv1) and f.startswith(b'data/'):
-                storefiles.add(_normpath(f))
+        for entry in repo.store.data_entries(undecodable=undecodable):
+            for file_ in entry.files():
+                size = file_.file_size(repo.store.vfs)
+                f = file_.unencoded_path
+                if (size > 0 or not revlogv1) and f.startswith(b'data/'):
+                    storefiles.add(_normpath(f))
         for f in undecodable:
             self._err(None, _(b"cannot decode filename '%s'") % f)
 
         state = {
             # TODO this assumes revlog storage for changelog.
             b'expectedversion': self.repo.changelog._format_version,
             b'skipflags': self.skipflags,
```

### Comparing `mercurial-6.4rc0/mercurial/vfs.py` & `mercurial-6.5rc0/mercurial/vfs.py`

 * *Files 0% similar despite different names*

```diff
@@ -595,14 +595,18 @@
 opener = vfs
 
 
 class proxyvfs(abstractvfs):
     def __init__(self, vfs: "vfs"):
         self.vfs = vfs
 
+    @property
+    def createmode(self):
+        return self.vfs.createmode
+
     def _auditpath(self, path, mode):
         return self.vfs._auditpath(path, mode)
 
     @property
     def options(self):
         return self.vfs.options
```

### Comparing `mercurial-6.4rc0/mercurial/win32.py` & `mercurial-6.5rc0/mercurial/win32.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/windows.py` & `mercurial-6.5rc0/mercurial/windows.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/wireprotoframing.py` & `mercurial-6.5rc0/mercurial/wireprotoframing.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/wireprotoserver.py` & `mercurial-6.5rc0/mercurial/wireprotoserver.py`

 * *Files 2% similar despite different names*

```diff
@@ -313,15 +313,16 @@
                 b'HTTP'
             ),
         )
         return
 
     proto.checkperm(wireprotov1server.commands[cmd].permission)
 
-    rsp = wireprotov1server.dispatch(repo, proto, cmd)
+    accesshidden = hgwebcommon.hashiddenaccess(repo, req)
+    rsp = wireprotov1server.dispatch(repo, proto, cmd, accesshidden)
 
     if isinstance(rsp, bytes):
         setresponse(HTTP_OK, HGTYPE, bodybytes=rsp)
     elif isinstance(rsp, wireprototypes.bytesresponse):
         setresponse(HTTP_OK, HGTYPE, bodybytes=rsp.data)
     elif isinstance(rsp, wireprototypes.streamreslegacy):
         setresponse(HTTP_OK, HGTYPE, bodygen=rsp.gen)
@@ -441,15 +442,15 @@
         caps.append(b'batch')
         return caps
 
     def checkperm(self, perm):
         pass
 
 
-def _runsshserver(ui, repo, fin, fout, ev):
+def _runsshserver(ui, repo, fin, fout, ev, accesshidden=False):
     # This function operates like a state machine of sorts. The following
     # states are defined:
     #
     # protov1-serving
     #    Server is in protocol version 1 serving mode. Commands arrive on
     #    new lines. These commands are processed in this state, one command
     #    after the other.
@@ -482,15 +483,17 @@
 
             # This command isn't available. Send an empty response and go
             # back to waiting for a new command.
             if not available:
                 _sshv1respondbytes(fout, b'')
                 continue
 
-            rsp = wireprotov1server.dispatch(repo, proto, request)
+            rsp = wireprotov1server.dispatch(
+                repo, proto, request, accesshidden=accesshidden
+            )
             repo.ui.fout.flush()
             repo.ui.ferr.flush()
 
             if isinstance(rsp, bytes):
                 _sshv1respondbytes(fout, rsp)
             elif isinstance(rsp, wireprototypes.bytesresponse):
                 _sshv1respondbytes(fout, rsp.data)
@@ -517,18 +520,19 @@
         else:
             raise error.ProgrammingError(
                 b'unhandled ssh server state: %s' % state
             )
 
 
 class sshserver:
-    def __init__(self, ui, repo, logfh=None):
+    def __init__(self, ui, repo, logfh=None, accesshidden=False):
         self._ui = ui
         self._repo = repo
         self._fin, self._fout = ui.protectfinout()
+        self._accesshidden = accesshidden
 
         # Log write I/O to stdout and stderr if configured.
         if logfh:
             self._fout = util.makeloggingfileobject(
                 logfh, self._fout, b'o', logdata=True
             )
             ui.ferr = util.makeloggingfileobject(
@@ -537,8 +541,10 @@
 
     def serve_forever(self):
         self.serveuntil(threading.Event())
         self._ui.restorefinout(self._fin, self._fout)
 
     def serveuntil(self, ev):
         """Serve until a threading.Event is set."""
-        _runsshserver(self._ui, self._repo, self._fin, self._fout, ev)
+        _runsshserver(
+            self._ui, self._repo, self._fin, self._fout, ev, self._accesshidden
+        )
```

### Comparing `mercurial-6.4rc0/mercurial/wireprototypes.py` & `mercurial-6.5rc0/mercurial/wireprototypes.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial/wireprotov1peer.py` & `mercurial-6.5rc0/mercurial/wireprotov1peer.py`

 * *Files 2% similar despite different names*

```diff
@@ -334,16 +334,32 @@
 
     def commandexecutor(self):
         return peerexecutor(self)
 
     # Begin of ipeercommands interface.
 
     def clonebundles(self):
-        self.requirecap(b'clonebundles', _(b'clone bundles'))
-        return self._call(b'clonebundles')
+        if self.capable(b'clonebundles_manifest'):
+            return self._call(b'clonebundles_manifest')
+        else:
+            self.requirecap(b'clonebundles', _(b'clone bundles'))
+            return self._call(b'clonebundles')
+
+    def _finish_inline_clone_bundle(self, stream):
+        pass  # allow override for httppeer
+
+    def get_cached_bundle_inline(self, path):
+        stream = self._callstream(b"get_cached_bundle_inline", path=path)
+        length = util.uvarintdecodestream(stream)
+
+        # SSH streams will block if reading more than length
+        for chunk in util.filechunkiter(stream, limit=length):
+            yield chunk
+
+        self._finish_inline_clone_bundle(stream)
 
     @batchable
     def lookup(self, key):
         self.requirecap(b'lookup', _(b'look up remote revision'))
 
         def decode(d):
             success, data = d[:-1].split(b" ", 1)
@@ -479,15 +495,15 @@
         if heads != [b'force'] and self.capable(b'unbundlehash'):
             heads = wireprototypes.encodelist(
                 [b'hashed', hashutil.sha1(b''.join(sorted(heads))).digest()]
             )
         else:
             heads = wireprototypes.encodelist(heads)
 
-        if util.safehasattr(bundle, b'deltaheader'):
+        if util.safehasattr(bundle, 'deltaheader'):
             # this a bundle10, do the old style call sequence
             ret, output = self._callpush(b"unbundle", bundle, heads=heads)
             if ret == b"":
                 raise error.ResponseError(_(b'push failed:'), output)
             try:
                 ret = int(ret)
             except ValueError:
```

### Comparing `mercurial-6.4rc0/mercurial/wireprotov1server.py` & `mercurial-6.5rc0/mercurial/wireprotov1server.py`

 * *Files 4% similar despite different names*

```diff
@@ -17,16 +17,18 @@
     bundle2,
     bundlecaches,
     changegroup as changegroupmod,
     discovery,
     encoding,
     error,
     exchange,
+    hook,
     pushkey as pushkeymod,
     pycompat,
+    repoview,
     requirements as requirementsmod,
     streamclone,
     util,
     wireprototypes,
 )
 
 from .utils import (
@@ -56,27 +58,37 @@
             return cap[5:].split(b',')
     return [b'zlib', b'none']
 
 
 # wire protocol command can either return a string or one of these classes.
 
 
-def getdispatchrepo(repo, proto, command):
+def getdispatchrepo(repo, proto, command, accesshidden=False):
     """Obtain the repo used for processing wire protocol commands.
 
     The intent of this function is to serve as a monkeypatch point for
     extensions that need commands to operate on different repo views under
     specialized circumstances.
     """
     viewconfig = repo.ui.config(b'server', b'view')
+
+    # Only works if the filter actually supports being upgraded to show hidden
+    # changesets.
+    if (
+        accesshidden
+        and viewconfig is not None
+        and viewconfig + b'.hidden' in repoview.filtertable
+    ):
+        viewconfig += b'.hidden'
+
     return repo.filtered(viewconfig)
 
 
-def dispatch(repo, proto, command):
-    repo = getdispatchrepo(repo, proto, command)
+def dispatch(repo, proto, command, accesshidden=False):
+    repo = getdispatchrepo(repo, proto, command, accesshidden=accesshidden)
 
     func, spec = commands[command]
     args = proto.getargs(spec)
 
     return func(repo, proto, *args)
 
 
@@ -249,27 +261,81 @@
     r = []
     for b in repo.branches(nodes):
         r.append(wireprototypes.encodelist(b) + b"\n")
 
     return wireprototypes.bytesresponse(b''.join(r))
 
 
+@wireprotocommand(b'get_cached_bundle_inline', b'path', permission=b'pull')
+def get_cached_bundle_inline(repo, proto, path):
+    """
+    Server command to send a clonebundle to the client
+    """
+    if hook.hashook(repo.ui, b'pretransmit-inline-clone-bundle'):
+        hook.hook(
+            repo.ui,
+            repo,
+            b'pretransmit-inline-clone-bundle',
+            throw=True,
+            clonebundlepath=path,
+        )
+
+    bundle_dir = repo.vfs.join(bundlecaches.BUNDLE_CACHE_DIR)
+    clonebundlepath = repo.vfs.join(bundle_dir, path)
+    if not repo.vfs.exists(clonebundlepath):
+        raise error.Abort(b'clonebundle %s does not exist' % path)
+
+    clonebundles_dir = os.path.realpath(bundle_dir)
+    if not os.path.realpath(clonebundlepath).startswith(clonebundles_dir):
+        raise error.Abort(b'clonebundle %s is using an illegal path' % path)
+
+    def generator(vfs, bundle_path):
+        with vfs(bundle_path) as f:
+            length = os.fstat(f.fileno())[6]
+            yield util.uvarintencode(length)
+            for chunk in util.filechunkiter(f):
+                yield chunk
+
+    stream = generator(repo.vfs, clonebundlepath)
+    return wireprototypes.streamres(gen=stream, prefer_uncompressed=True)
+
+
 @wireprotocommand(b'clonebundles', b'', permission=b'pull')
 def clonebundles(repo, proto):
+    """A legacy version of clonebundles_manifest
+
+    This version filtered out new url scheme (like peer-bundle-cache://) to
+    avoid confusion in older clients.
+    """
+    manifest_contents = bundlecaches.get_manifest(repo)
+    # Filter out peer-bundle-cache:// entries
+    modified_manifest = []
+    for line in manifest_contents.splitlines():
+        if line.startswith(bundlecaches.CLONEBUNDLESCHEME):
+            continue
+        modified_manifest.append(line)
+    return wireprototypes.bytesresponse(b'\n'.join(modified_manifest))
+
+
+@wireprotocommand(b'clonebundles_manifest', b'*', permission=b'pull')
+def clonebundles_2(repo, proto, args):
     """Server command for returning info for available bundles to seed clones.
 
     Clients will parse this response and determine what bundle to fetch.
 
     Extensions may wrap this command to filter or dynamically emit data
     depending on the request. e.g. you could advertise URLs for the closest
     data center given the client's IP address.
+
+    The only filter on the server side is filtering out inline clonebundles
+    in case a client does not support them.
+    Otherwise, older clients would retrieve and error out on those.
     """
-    return wireprototypes.bytesresponse(
-        repo.vfs.tryread(bundlecaches.CB_MANIFEST_FILE)
-    )
+    manifest_contents = bundlecaches.get_manifest(repo)
+    return wireprototypes.bytesresponse(manifest_contents)
 
 
 wireprotocaps = [
     b'lookup',
     b'branchmap',
     b'pushkey',
     b'known',
@@ -376,15 +442,15 @@
     def decodehexstring(s):
         return {binascii.unhexlify(h) for h in s.split(b';')}
 
     manifest = repo.vfs.tryread(b'pullbundles.manifest')
     if not manifest:
         return None
     res = bundlecaches.parseclonebundlesmanifest(repo, manifest)
-    res = bundlecaches.filterclonebundleentries(repo, res)
+    res = bundlecaches.filterclonebundleentries(repo, res, pullbundles=True)
     if not res:
         return None
     cl = repo.unfiltered().changelog
     heads_anc = cl.ancestors([cl.rev(rev) for rev in heads], inclusive=True)
     common_anc = cl.ancestors([cl.rev(rev) for rev in common], inclusive=True)
     compformats = clientcompressionsupport(proto)
     for entry in res:
@@ -651,15 +717,15 @@
                     raise error.Abort(
                         bundle2requiredmain, hint=bundle2requiredhint
                     )
 
                 r = exchange.unbundle(
                     repo, gen, their_heads, b'serve', proto.client()
                 )
-                if util.safehasattr(r, b'addpart'):
+                if util.safehasattr(r, 'addpart'):
                     # The return looks streamable, we are in the bundle2 case
                     # and should return a stream.
                     return wireprototypes.streamreslegacy(gen=r.getchunks())
                 return wireprototypes.pushres(
                     r, output.getvalue() if output else b''
                 )
```

### Comparing `mercurial-6.4rc0/mercurial/worker.py` & `mercurial-6.5rc0/mercurial/worker.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/mercurial.egg-info/PKG-INFO` & `mercurial-6.5rc0/mercurial.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mercurial
-Version: 6.4rc0
+Version: 6.5rc0
 Summary: Fast scalable distributed SCM (revision control, version control) system
 Home-page: https://mercurial-scm.org/
 Download-URL: https://mercurial-scm.org/release/
 Author: Olivia Mackall and many others
 Author-email: mercurial@mercurial-scm.org
 License: GNU GPLv2 or any later version
 Classifier: Development Status :: 6 - Mature
```

### Comparing `mercurial-6.4rc0/mercurial.egg-info/SOURCES.txt` & `mercurial-6.5rc0/mercurial.egg-info/SOURCES.txt`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,11 @@
 .arcconfig
 .clang-format
 .editorconfig
+.gitattributes
 .hgignore
 .hgsigs
 .hgtags
 .jshintrc
 CONTRIBUTING
 CONTRIBUTORS
 COPYING
@@ -134,14 +135,16 @@
 contrib/fuzz/xdiff.cc
 contrib/hgsh/Makefile
 contrib/hgsh/hgsh.c
 contrib/merge-lists/Cargo.lock
 contrib/merge-lists/Cargo.toml
 contrib/merge-lists/src/main.rs
 contrib/merge-lists/tests/test-merge-lists.rs
+contrib/nix/flake.lock
+contrib/nix/flake.nix
 contrib/packaging/Makefile
 contrib/packaging/build-linux-wheels.sh
 contrib/packaging/builddeb
 contrib/packaging/buildrpm
 contrib/packaging/dockerdeb
 contrib/packaging/dockerrpm
 contrib/packaging/hg-docker
@@ -513,14 +516,15 @@
 i18n/pt_BR.po
 i18n/ro.po
 i18n/ru.po
 i18n/sv.po
 i18n/zh_CN.po
 i18n/zh_TW.po
 mercurial/__init__.py
+mercurial/__main__.py
 mercurial/__version__.py
 mercurial/ancestor.py
 mercurial/archival.py
 mercurial/bdiff.c
 mercurial/bdiff.h
 mercurial/bitmanipulation.h
 mercurial/bookmarks.py
@@ -784,14 +788,16 @@
 mercurial/revlogutils/docket.py
 mercurial/revlogutils/flagutil.py
 mercurial/revlogutils/nodemap.py
 mercurial/revlogutils/randomaccessfile.py
 mercurial/revlogutils/revlogv0.py
 mercurial/revlogutils/rewrite.py
 mercurial/revlogutils/sidedata.py
+mercurial/stabletailgraph/__init__.py
+mercurial/stabletailgraph/stabletailsort.py
 mercurial/templates/__init__.py
 mercurial/templates/map-cmdline.bisect
 mercurial/templates/map-cmdline.changelog
 mercurial/templates/map-cmdline.compact
 mercurial/templates/map-cmdline.default
 mercurial/templates/map-cmdline.phases
 mercurial/templates/map-cmdline.show
@@ -1060,18 +1066,21 @@
 relnotes/5.7
 relnotes/5.8
 relnotes/5.9
 relnotes/6.0
 relnotes/6.1
 relnotes/6.2
 relnotes/6.3
+relnotes/6.4
+relnotes/6.5
 relnotes/next
 rust/Cargo.lock
 rust/Cargo.toml
 rust/README.rst
+rust/clippy.toml
 rust/.cargo/config
 rust/chg/Cargo.lock
 rust/chg/Cargo.toml
 rust/chg/build.rs
 rust/chg/src/attachio.rs
 rust/chg/src/clientext.rs
 rust/chg/src/lib.rs
@@ -1211,15 +1220,14 @@
 tests/fakepatchtime.py
 tests/filterpyflakes.py
 tests/filtertraceback.py
 tests/flagprocessorext.py
 tests/fsmonitor-run-tests.py
 tests/generate-working-copy-states.py
 tests/get-with-headers.py
-tests/helper-killhook.py
 tests/helper-runtests.sh
 tests/helpers-testrepo.sh
 tests/heredoctest.py
 tests/hghave
 tests/hghave.py
 tests/hgterm.ti
 tests/hgweberror.py
@@ -1305,14 +1313,15 @@
 tests/test-bookmarks-strip.t
 tests/test-bookmarks.t
 tests/test-branch-change.t
 tests/test-branch-option.t
 tests/test-branch-tag-confict.t
 tests/test-branches.t
 tests/test-bugzilla.t
+tests/test-bundle-phase-internal.t
 tests/test-bundle-phases.t
 tests/test-bundle-r.t
 tests/test-bundle-type.t
 tests/test-bundle-vs-outgoing.t
 tests/test-bundle.t
 tests/test-bundle2-exchange.t
 tests/test-bundle2-format.t
@@ -1351,17 +1360,19 @@
 tests/test-chg.t
 tests/test-children.t
 tests/test-churn.t
 tests/test-clone-cgi.t
 tests/test-clone-pull-corruption.t
 tests/test-clone-r.t
 tests/test-clone-stream-format.t
+tests/test-clone-stream-revlog-split.t
 tests/test-clone-stream.t
 tests/test-clone-update-order.t
 tests/test-clone.t
+tests/test-clonebundles-autogen.t
 tests/test-clonebundles.t
 tests/test-close-head.t
 tests/test-commandserver.t
 tests/test-commit-amend.t
 tests/test-commit-interactive-curses.t
 tests/test-commit-interactive.t
 tests/test-commit-multiple.t
@@ -1464,14 +1475,15 @@
 tests/test-directaccess.t
 tests/test-dirs.py
 tests/test-dirstate-backup.t
 tests/test-dirstate-race.t
 tests/test-dirstate-race2.t
 tests/test-dirstate-read-race.t
 tests/test-dirstate-status-write-race.t
+tests/test-dirstate-version-fallback.t
 tests/test-dirstate.t
 tests/test-dispatch.py
 tests/test-dispatch.py.out
 tests/test-dispatch.t
 tests/test-docker-packaging.t
 tests/test-doctest.py
 tests/test-double-merge.t
@@ -1861,14 +1873,15 @@
 tests/test-pathconflicts-basic.t
 tests/test-pathconflicts-merge.t
 tests/test-pathconflicts-update.t
 tests/test-pathencode.py
 tests/test-paths.t
 tests/test-pending.t
 tests/test-permissions.t
+tests/test-persistent-nodemap-stream-clone.t
 tests/test-persistent-nodemap.t
 tests/test-phabricator.t
 tests/test-phase-archived.t
 tests/test-phases-exchange.t
 tests/test-phases.t
 tests/test-profile.t
 tests/test-progress.t
@@ -1878,14 +1891,15 @@
 tests/test-pull-bundle.t
 tests/test-pull-http.t
 tests/test-pull-network.t
 tests/test-pull-permission.t
 tests/test-pull-pull-corruption.t
 tests/test-pull-r.t
 tests/test-pull-update.t
+tests/test-pullling-to-general-delta.t
 tests/test-purge-ignored-directory.t
 tests/test-purge.t
 tests/test-push-cgi.t
 tests/test-push-checkheads-multibranches-E1.t
 tests/test-push-checkheads-multibranches-E2.t
 tests/test-push-checkheads-multibranches-E3.t
 tests/test-push-checkheads-partial-C1.t
@@ -1930,14 +1944,15 @@
 tests/test-rebase-brute-force.t
 tests/test-rebase-cache.t
 tests/test-rebase-check-restore.t
 tests/test-rebase-collapse.t
 tests/test-rebase-conflicts.t
 tests/test-rebase-dest.t
 tests/test-rebase-detach.t
+tests/test-rebase-dry-run.t
 tests/test-rebase-empty-successor.t
 tests/test-rebase-emptycommit.t
 tests/test-rebase-inmemory.t
 tests/test-rebase-interruptions.t
 tests/test-rebase-issue-noparam-single-rev.t
 tests/test-rebase-legacy.t
 tests/test-rebase-mq-skip.t
@@ -2077,18 +2092,21 @@
 tests/test-ssh-bundle1.t
 tests/test-ssh-clone-r.t
 tests/test-ssh-proto-unbundle.t
 tests/test-ssh-proto.t
 tests/test-ssh-repoerror.t
 tests/test-ssh.t
 tests/test-sshserver.py
+tests/test-stabletailgraph.t
 tests/test-stack.t
 tests/test-state-extension.t
 tests/test-static-http.t
 tests/test-status-color.t
+tests/test-status-committed-and-ignored.t
+tests/test-status-eacces.t
 tests/test-status-inprocess.py
 tests/test-status-inprocess.py.out
 tests/test-status-rev.t
 tests/test-status-terse.t
 tests/test-status-tracked-key.t
 tests/test-status.t
 tests/test-stdio.py
@@ -2173,14 +2191,15 @@
 tests/wireprotohelpers.sh
 tests/artifacts/PURPOSE
 tests/artifacts/cache/big-file-churn.hg.md5
 tests/artifacts/scripts/generate-churning-bundle.py
 tests/blacklists/README
 tests/blacklists/fsmonitor
 tests/blacklists/linux-vfat
+tests/blacklists/nix
 tests/bundles/darcs1.hg
 tests/bundles/hgweb+obs.hg
 tests/bundles/issue4041.hg
 tests/bundles/issue4438-r1.hg
 tests/bundles/issue4438-r2.hg
 tests/bundles/issue6528.hg-v1
 tests/bundles/issue6528.hg-v2
```

### Comparing `mercurial-6.4rc0/relnotes/5.1` & `mercurial-6.5rc0/relnotes/5.1`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/relnotes/5.2` & `mercurial-6.5rc0/relnotes/5.2`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/relnotes/5.3` & `mercurial-6.5rc0/relnotes/5.3`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/relnotes/5.4` & `mercurial-6.5rc0/relnotes/5.4`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/relnotes/5.5` & `mercurial-6.5rc0/relnotes/5.5`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/relnotes/5.6` & `mercurial-6.5rc0/relnotes/5.6`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/relnotes/5.7` & `mercurial-6.5rc0/relnotes/5.7`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/relnotes/5.8` & `mercurial-6.5rc0/relnotes/5.8`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/relnotes/5.9` & `mercurial-6.5rc0/relnotes/5.9`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/relnotes/6.0` & `mercurial-6.5rc0/relnotes/6.0`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/relnotes/6.1` & `mercurial-6.5rc0/relnotes/6.1`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/relnotes/6.2` & `mercurial-6.5rc0/relnotes/6.2`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/relnotes/6.3` & `mercurial-6.5rc0/relnotes/6.3`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/Cargo.lock` & `mercurial-6.5rc0/rust/Cargo.lock`

 * *Files 1% similar despite different names*

```diff
@@ -1,18 +1,12 @@
 # This file is automatically @generated by Cargo.
 # It is not intended for manual editing.
 version = 3
 
 [[package]]
-name = "Inflector"
-version = "0.11.4"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "fe438c63458706e03479442743baae6c88256498e6431708f6dfc520a26515d3"
-
-[[package]]
 name = "adler"
 version = "1.0.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "f26201604c87b1e01bd3d98f8d5d9a8fcbb815e8cedb41ffccbeb4bf593a35fe"
 
 [[package]]
 name = "ahash"
@@ -31,20 +25,14 @@
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "b4f55bd91a0978cbfd91c457a164bab8b4001c833b7f323132c0a4e1922dd44e"
 dependencies = [
  "memchr",
 ]
 
 [[package]]
-name = "aliasable"
-version = "0.1.3"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "250f629c0161ad8107cf89319e990051fae62832fd343083bea452d93e2205fd"
-
-[[package]]
 name = "android_system_properties"
 version = "0.1.5"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "819e7219dbd41043ac279b19830f2efc897156490d7fd6ea916720117ee66311"
 dependencies = [
  "libc",
 ]
@@ -535,22 +523,22 @@
  "itertools",
  "lazy_static",
  "libc",
  "log",
  "logging_timer",
  "memmap2",
  "once_cell",
- "ouroboros",
  "pretty_assertions",
  "rand 0.8.5",
  "rand_distr",
  "rand_pcg",
  "rayon",
  "regex",
  "same-file",
+ "self_cell",
  "sha-1 0.10.0",
  "tempfile",
  "thread_local",
  "twox-hash",
  "zstd",
 ]
 
@@ -805,37 +793,14 @@
 [[package]]
 name = "os_str_bytes"
 version = "6.4.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "7b5bf27447411e9ee3ff51186bf7a08e16c341efdde93f4d823e8844429bed7e"
 
 [[package]]
-name = "ouroboros"
-version = "0.15.5"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "dfbb50b356159620db6ac971c6d5c9ab788c9cc38a6f49619fca2a27acb062ca"
-dependencies = [
- "aliasable",
- "ouroboros_macro",
-]
-
-[[package]]
-name = "ouroboros_macro"
-version = "0.15.5"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "4a0d9d1a6191c4f391f87219d1ea42b23f09ee84d64763cd05ee6ea88d9f384d"
-dependencies = [
- "Inflector",
- "proc-macro-error",
- "proc-macro2",
- "quote",
- "syn",
-]
-
-[[package]]
 name = "output_vt100"
 version = "0.1.3"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "628223faebab4e3e40667ee0b2336d34a5b960ff60ea743ddfdbcf7770bcfb66"
 dependencies = [
  "winapi",
 ]
@@ -1019,27 +984,27 @@
 checksum = "6f97cdb2a36ed4183de61b2f824cc45c9f1037f28afe0a322e9fff4c108b5aaa"
 dependencies = [
  "rand_core 0.6.4",
 ]
 
 [[package]]
 name = "rayon"
-version = "1.6.1"
+version = "1.7.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "6db3a213adf02b3bcfd2d3846bb41cb22857d131789e01df434fb7e7bc0759b7"
+checksum = "1d2df5196e37bcc87abebc0053e20787d73847bb33134a69841207dd0a47f03b"
 dependencies = [
  "either",
  "rayon-core",
 ]
 
 [[package]]
 name = "rayon-core"
-version = "1.10.2"
+version = "1.11.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "356a0625f1954f730c0201cdab48611198dc6ce21f4acff55089b5a78e6e835b"
+checksum = "4b8f95bd6966f5c87776639160a66bd8ab9895d9d4ab01ddba9fc60661aebe8d"
 dependencies = [
  "crossbeam-channel",
  "crossbeam-deque",
  "crossbeam-utils",
  "num_cpus",
 ]
 
@@ -1091,16 +1056,16 @@
  "hg-core",
  "home",
  "lazy_static",
  "log",
  "logging_timer",
  "rayon",
  "regex",
- "users",
  "which",
+ "whoami",
 ]
 
 [[package]]
 name = "rustc_version"
 version = "0.4.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "bfa0f585226d2e68097d4f95d113b15b83a82e819ab25717ec0590d9584ef366"
@@ -1126,14 +1091,20 @@
 [[package]]
 name = "scratch"
 version = "1.0.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "9c8132065adcfd6e02db789d9285a0deb2f3fcb04002865ab67d5fb103533898"
 
 [[package]]
+name = "self_cell"
+version = "1.0.0"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "4a3926e239738d36060909ffe6f511502f92149a45a1fade7fe031cb2d33e88b"
+
+[[package]]
 name = "semver"
 version = "1.0.14"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "e25dfac463d778e353db5be2449d1cce89bd6fd23c9f1ea21310ce6e5a1b29c4"
 
 [[package]]
 name = "sha-1"
@@ -1267,24 +1238,14 @@
 [[package]]
 name = "unicode-width"
 version = "0.1.10"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "c0edd1e5b14653f783770bce4a4dabb4a5108a5370a5f5d8cfe8710c361f6c8b"
 
 [[package]]
-name = "users"
-version = "0.11.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "24cc0f6d6f267b73e5a2cadf007ba8f9bc39c6a6f9666f8cf25ea809a153b032"
-dependencies = [
- "libc",
- "log",
-]
-
-[[package]]
 name = "vcpkg"
 version = "0.2.15"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "accd4ea62f7bb7a82fe23066fb0957d48ef677f6eeb8215f372f52e48bb32426"
 
 [[package]]
 name = "vcsgraph"
@@ -1372,25 +1333,45 @@
 [[package]]
 name = "wasm-bindgen-shared"
 version = "0.2.83"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "1c38c045535d93ec4f0b4defec448e4291638ee608530863b1e2ba115d4fff7f"
 
 [[package]]
+name = "web-sys"
+version = "0.3.60"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "bcda906d8be16e728fd5adc5b729afad4e444e106ab28cd1c7256e54fa61510f"
+dependencies = [
+ "js-sys",
+ "wasm-bindgen",
+]
+
+[[package]]
 name = "which"
 version = "4.3.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "1c831fbbee9e129a8cf93e7747a82da9d95ba8e16621cae60ec2cdc849bacb7b"
 dependencies = [
  "either",
  "libc",
  "once_cell",
 ]
 
 [[package]]
+name = "whoami"
+version = "1.4.0"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "2c70234412ca409cc04e864e89523cb0fc37f5e1344ebed5a3ebf4192b6b9f68"
+dependencies = [
+ "wasm-bindgen",
+ "web-sys",
+]
+
+[[package]]
 name = "winapi"
 version = "0.3.9"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "5c839a674fcd7a98952e593242ea400abe93992746761e38641405d28b00f419"
 dependencies = [
  "winapi-i686-pc-windows-gnu",
  "winapi-x86_64-pc-windows-gnu",
@@ -1421,33 +1402,34 @@
 name = "yansi"
 version = "0.5.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "09041cd90cf85f7f8b2df60c646f853b7f535ce68f85244eb6731cf89fa498ec"
 
 [[package]]
 name = "zstd"
-version = "0.11.2+zstd.1.5.2"
+version = "0.12.3+zstd.1.5.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "20cc960326ece64f010d2d2107537f26dc589a6573a316bd5b1dba685fa5fde4"
+checksum = "76eea132fb024e0e13fd9c2f5d5d595d8a967aa72382ac2f9d39fcc95afd0806"
 dependencies = [
  "zstd-safe",
 ]
 
 [[package]]
 name = "zstd-safe"
-version = "5.0.2+zstd.1.5.2"
+version = "6.0.4+zstd.1.5.4"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "1d2a5585e04f9eea4b2a3d1eca508c4dee9592a89ef6f450c11719da0726f4db"
+checksum = "7afb4b54b8910cf5447638cb54bf4e8a65cbedd783af98b98c62ffe91f185543"
 dependencies = [
  "libc",
  "zstd-sys",
 ]
 
 [[package]]
 name = "zstd-sys"
-version = "2.0.1+zstd.1.5.2"
+version = "2.0.7+zstd.1.5.4"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "9fd07cbbc53846d9145dbffdf6dd09a7a0aa52be46741825f5c97bdd4f73f12b"
+checksum = "94509c3ba2fe55294d752b79842c530ccfab760192521df74a081a78d2b3c7f5"
 dependencies = [
  "cc",
  "libc",
+ "pkg-config",
 ]
```

### Comparing `mercurial-6.4rc0/rust/README.rst` & `mercurial-6.5rc0/rust/README.rst`

 * *Files 24% similar despite different names*

```diff
@@ -3,25 +3,27 @@
 ===================
 
 This directory contains various Rust code for the Mercurial project.
 Rust is not required to use (or build) Mercurial, but using it
 improves performance in some areas.
 
 There are currently four independent Rust projects:
+
 - chg. An implementation of chg, in Rust instead of C.
 - hgcli. A project that provides a (mostly) self-contained "hg" binary,
   for ease of deployment and a bit of speed, using PyOxidizer. See
-  hgcli/README.md.
+  ``hgcli/README.md``.
 - hg-core (and hg-cpython): implementation of some
   functionality of mercurial in Rust, e.g. ancestry computations in
   revision graphs, status or pull discovery. The top-level ``Cargo.toml`` file
   defines a workspace containing these crates.
 - rhg: a pure Rust implementation of Mercurial, with a fallback mechanism for
-  unsupported invocations. It reuses the logic `hg-core` but completely forgoes
-  interaction with Python. See `rust/rhg/README.md` for more details.
+  unsupported invocations. It reuses the logic ``hg-core`` but
+  completely forgoes interaction with Python. See
+  ``rust/rhg/README.md`` for more details.
 
 Using Rust code
 ===============
 
 Local use (you need to clean previous build artifacts if you have
 built without rust previously)::
 
@@ -37,53 +39,69 @@
 One day we may use this environment variable to switch to new experimental
 binding crates like a hypothetical ``HGWITHRUSTEXT=hpy``.
 
 Special features
 ================
 
 In the future, compile-time opt-ins may be added
-to the `features` section in ``hg-cpython/Cargo.toml``.
+to the ``features`` section in ``hg-cpython/Cargo.toml``.
 
-To use features from the Makefile, use the `HG_RUST_FEATURES` environment
-variable: for instance `HG_RUST_FEATURES="some-feature other-feature"`
+To use features from the Makefile, use the ``HG_RUST_FEATURES`` environment
+variable: for instance ``HG_RUST_FEATURES="some-feature other-feature"``.
 
 Profiling
 =========
 
 Setting the environment variable ``RUST_LOG=trace`` will make hg print
 a few high level rust-related performance numbers. It can also
 indicate why the rust code cannot be used (say, using lookarounds in
 hgignore).
 
 Creating a ``.cargo/config`` file with the following content enables
 debug information in optimized builds. This make profiles more informative
 with source file name and line number for Rust stack frames and
-(in some cases) stack frames for Rust functions that have been inlined.
+(in some cases) stack frames for Rust functions that have been inlined::
 
   [profile.release]
   debug = true
 
 ``py-spy`` (https://github.com/benfred/py-spy) can be used to
 construct a single profile with rust functions and python functions
 (as opposed to ``hg --profile``, which attributes time spent in rust
 to some unlucky python code running shortly after the rust code, and
 as opposed to tools for native code like ``perf``, which attribute
 time to the python interpreter instead of python functions).
 
-Example usage:
+Example usage::
 
   $ make PURE=--rust local # Don't forget to recompile after a code change
   $ py-spy record --native --output /tmp/profile.svg -- ./hg ...
 
 Developing Rust
 ===============
 
-The current version of Rust in use is ``1.61.0``, because it's what Debian
-testing has. You can use ``rustup override set 1.61.0`` at the root of the repo
-to make it easier on you.
+Minimum Supported Rust Version
+------------------------------
+
+The minimum supported rust version (MSRV) is specified in the `Clippy`_
+configuration file at ``rust/clippy.toml``. It is set to be ``1.61.0`` as of
+this writing, but keep in mind that the authoritative value is the one
+from the configuration file.
+
+We bump it from time to time, with the general rule being that our
+MSRV should not be greater that the version of the Rust toolchain
+shipping with Debian testing, so that the Rust enhanced Mercurial can
+be eventually packaged in Debian.
+
+To ensure that you are not depending on features introduced in later
+versions, you can issue ``rustup override set x.y.z`` at the root of
+the repository.
+
+Build and development
+---------------------
 
 Go to the ``hg-cpython`` folder::
 
   $ cd rust/hg-cpython
 
 Or, only the ``hg-core`` folder. Be careful not to break compatibility::
 
@@ -113,12 +131,32 @@
 Formatting the code
 -------------------
 
 We use ``rustfmt`` to keep the code formatted at all times. For now, we are
 using the nightly version because it has been stable enough and provides
 comment folding.
 
-To format the entire Rust workspace::
+Our CI enforces that the code does not need reformatting. Before
+submitting your changes, please format the entire Rust workspace by running::
+
 
   $ cargo +nightly fmt
 
 This requires you to have the nightly toolchain installed.
+
+Linting: code sanity
+--------------------
+
+We're using `Clippy`_, the standard code diagnosis tool of the Rust
+community.
+
+Our CI enforces that the code is free of Clippy warnings, so you might
+want to run it on your side before submitting your changes. Simply do::
+
+  % cargo clippy
+
+from the top of the Rust workspace. Clippy is part of the default
+``rustup`` install, so it should work right away. In case it would
+not, you can install it with ``rustup component add``.
+
+
+.. _Clippy: https://doc.rust-lang.org/stable/clippy/
```

### Comparing `mercurial-6.4rc0/rust/chg/Cargo.lock` & `mercurial-6.5rc0/rust/chg/Cargo.lock`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/chg/src/attachio.rs` & `mercurial-6.5rc0/rust/chg/src/attachio.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/chg/src/clientext.rs` & `mercurial-6.5rc0/rust/chg/src/clientext.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/chg/src/locator.rs` & `mercurial-6.5rc0/rust/chg/src/locator.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/chg/src/main.rs` & `mercurial-6.5rc0/rust/chg/src/main.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/chg/src/message.rs` & `mercurial-6.5rc0/rust/chg/src/message.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/chg/src/procutil.rs` & `mercurial-6.5rc0/rust/chg/src/procutil.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/chg/src/runcommand.rs` & `mercurial-6.5rc0/rust/chg/src/runcommand.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/chg/src/sendfds.c` & `mercurial-6.5rc0/rust/chg/src/sendfds.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/chg/src/sighandlers.c` & `mercurial-6.5rc0/rust/chg/src/sighandlers.c`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/chg/src/uihandler.rs` & `mercurial-6.5rc0/rust/chg/src/uihandler.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/Cargo.toml` & `mercurial-6.5rc0/rust/hg-core/Cargo.toml`

 * *Files 14% similar despite different names*

```diff
@@ -16,32 +16,30 @@
 hashbrown = { version = "0.13.1", features = ["rayon"] }
 home = "0.5.4"
 im-rc = "15.1.0"
 itertools = "0.10.5"
 lazy_static = "1.4.0"
 libc = "0.2.137"
 logging_timer = "1.1.0"
-ouroboros = "0.15.5"
 rand = "0.8.5"
 rand_pcg = "0.3.1"
 rand_distr = "0.4.3"
-rayon = "1.6.1"
+rayon = "1.7.0"
 regex = "1.7.0"
+self_cell = "1.0"
 sha-1 = "0.10.0"
 twox-hash = "1.6.3"
 same-file = "1.0.6"
 tempfile = "3.3.0"
 thread_local = "1.1.4"
 crossbeam-channel = "0.5.6"
 log = "0.4.17"
 memmap2 = { version = "0.5.8", features = ["stable_deref_trait"] }
-zstd = "0.11.2"
+zstd = "0.12"
 format-bytes = "0.3.0"
-# once_cell 1.15 uses edition 2021, while the heptapod CI
-# uses an old version of Cargo that doesn't support it.
 once_cell = "1.16.0"
 
 # We don't use the `miniz-oxide` backend to not change rhg benchmarks and until
 # we have a clearer view of which backend is the fastest.
 [dependencies.flate2]
 version = "1.0.24"
 features = ["zlib"]
```

### Comparing `mercurial-6.4rc0/rust/hg-core/examples/nodemap/index.rs` & `mercurial-6.5rc0/rust/hg-core/examples/nodemap/index.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/examples/nodemap/main.rs` & `mercurial-6.5rc0/rust/hg-core/examples/nodemap/main.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/ancestors.rs` & `mercurial-6.5rc0/rust/hg-core/src/ancestors.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/checkexec.rs` & `mercurial-6.5rc0/rust/hg-core/src/checkexec.rs`

 * *Files 2% similar despite different names*

```diff
@@ -108,12 +108,14 @@
             return Ok(true);
         }
     }
 
     Ok(false)
 }
 
-/// This function is a rust rewrite of [checkexec] function from [posix.py]
-/// Returns true if the filesystem supports execute permissions.
+/// This function is a Rust rewrite of the `checkexec` function from
+/// `posix.py`.
+///
+/// Returns `true` if the filesystem supports execute permissions.
 pub fn check_exec(path: impl AsRef<Path>) -> bool {
     check_exec_impl(path).unwrap_or(false)
 }
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/config/layer.rs` & `mercurial-6.5rc0/rust/hg-core/src/config/layer.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/config/mod.rs` & `mercurial-6.5rc0/rust/hg-core/src/config/mod.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/config/plain_info.rs` & `mercurial-6.5rc0/rust/hg-core/src/config/plain_info.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/config/values.rs` & `mercurial-6.5rc0/rust/hg-core/src/config/values.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/copy_tracing/tests.rs` & `mercurial-6.5rc0/rust/hg-core/src/copy_tracing/tests.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/copy_tracing/tests_support.rs` & `mercurial-6.5rc0/rust/hg-core/src/copy_tracing/tests_support.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/copy_tracing.rs` & `mercurial-6.5rc0/rust/hg-core/src/copy_tracing.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/dagops.rs` & `mercurial-6.5rc0/rust/hg-core/src/dagops.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/dirstate/dirs_multiset.rs` & `mercurial-6.5rc0/rust/hg-core/src/dirstate/dirs_multiset.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/dirstate/entry.rs` & `mercurial-6.5rc0/rust/hg-core/src/dirstate/entry.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/dirstate/parsers.rs` & `mercurial-6.5rc0/rust/hg-core/src/dirstate/parsers.rs`

 * *Files 26% similar despite different names*

```diff
@@ -57,40 +57,55 @@
     mut contents: &'a [u8],
     mut each_entry: impl FnMut(
         &'a HgPath,
         &DirstateEntry,
         Option<&'a HgPath>,
     ) -> Result<(), HgError>,
 ) -> Result<&'a DirstateParents, HgError> {
-    let (parents, rest) = DirstateParents::from_bytes(contents)
-        .map_err(|_| HgError::corrupted("Too little data for dirstate."))?;
+    let mut entry_idx = 0;
+    let original_len = contents.len();
+    let (parents, rest) =
+        DirstateParents::from_bytes(contents).map_err(|_| {
+            HgError::corrupted(format!(
+                "Too little data for dirstate: {} bytes.",
+                original_len
+            ))
+        })?;
     contents = rest;
     while !contents.is_empty() {
         let (raw_entry, rest) = RawEntry::from_bytes(contents)
-            .map_err(|_| HgError::corrupted("Overflow in dirstate."))?;
+            .map_err(|_| HgError::corrupted(format!(
+            "dirstate corrupted: ran out of bytes at entry header {}, offset {}.",
+            entry_idx, original_len-contents.len())))?;
 
         let entry = DirstateEntry::from_v1_data(
             EntryState::try_from(raw_entry.state)?,
             raw_entry.mode.get(),
             raw_entry.size.get(),
             raw_entry.mtime.get(),
         );
+        let filename_len = raw_entry.length.get() as usize;
         let (paths, rest) =
-            u8::slice_from_bytes(rest, raw_entry.length.get() as usize)
-                .map_err(|_| HgError::corrupted("Overflow in dirstate."))?;
+            u8::slice_from_bytes(rest, filename_len)
+                .map_err(|_|
+                HgError::corrupted(format!(
+         "dirstate corrupted: ran out of bytes at entry {}, offset {} (expected {} bytes).",
+              entry_idx, original_len-contents.len(), filename_len))
+                )?;
 
         // `paths` is either a single path, or two paths separated by a NULL
         // byte
         let mut iter = paths.splitn(2, |&byte| byte == b'\0');
         let path = HgPath::new(
             iter.next().expect("splitn always yields at least one item"),
         );
         let copy_source = iter.next().map(HgPath::new);
         each_entry(path, &entry, copy_source)?;
 
+        entry_idx += 1;
         contents = rest;
     }
     Ok(parents)
 }
 
 fn packed_filename_and_copy_source_size(
     filename: &HgPath,
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/dirstate/status.rs` & `mercurial-6.5rc0/rust/hg-core/src/dirstate/status.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/dirstate.rs` & `mercurial-6.5rc0/rust/hg-core/src/dirstate.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/dirstate_tree/dirstate_map.rs` & `mercurial-6.5rc0/rust/hg-core/src/dirstate_tree/dirstate_map.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/dirstate_tree/on_disk.rs` & `mercurial-6.5rc0/rust/hg-core/src/dirstate_tree/on_disk.rs`

 * *Files 1% similar despite different names*

```diff
@@ -411,17 +411,17 @@
         } else {
             Ok(None)
         }
     }
 
     fn synthesize_unix_mode(&self) -> u32 {
         let file_type = if self.flags().contains(Flags::MODE_IS_SYMLINK) {
-            libc::S_IFLNK
+            libc::S_IFLNK as u32
         } else {
-            libc::S_IFREG
+            libc::S_IFREG as u32
         };
         let permissions = if self.flags().contains(Flags::MODE_EXEC_PERM) {
             0o755
         } else {
             0o644
         };
         file_type | permissions
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/dirstate_tree/owning.rs` & `mercurial-6.5rc0/rust/hg-core/src/dirstate_tree/owning.rs`

 * *Files 11% similar despite different names*

```diff
@@ -1,59 +1,50 @@
 use crate::{DirstateError, DirstateParents};
 
 use super::dirstate_map::DirstateMap;
+use self_cell::self_cell;
 use std::ops::Deref;
 
-use ouroboros::self_referencing;
-
-/// Keep a `DirstateMap<'on_disk>` next to the `on_disk` buffer that it
-/// borrows.
-#[self_referencing]
-pub struct OwningDirstateMap {
-    on_disk: Box<dyn Deref<Target = [u8]> + Send>,
-    #[borrows(on_disk)]
-    #[covariant]
-    map: DirstateMap<'this>,
-}
+self_cell!(
+    /// Keep a `DirstateMap<'owner>` next to the `owner` buffer that it
+    /// borrows.
+    pub struct OwningDirstateMap {
+        owner: Box<dyn Deref<Target = [u8]> + Send>,
+        #[covariant]
+        dependent: DirstateMap,
+    }
+);
 
 impl OwningDirstateMap {
     pub fn new_empty<OnDisk>(on_disk: OnDisk) -> Self
     where
         OnDisk: Deref<Target = [u8]> + Send + 'static,
     {
         let on_disk = Box::new(on_disk);
 
-        OwningDirstateMapBuilder {
-            on_disk,
-            map_builder: |bytes| DirstateMap::empty(bytes),
-        }
-        .build()
+        OwningDirstateMap::new(on_disk, |bytes| DirstateMap::empty(bytes))
     }
 
     pub fn new_v1<OnDisk>(
         on_disk: OnDisk,
         identity: Option<u64>,
     ) -> Result<(Self, DirstateParents), DirstateError>
     where
         OnDisk: Deref<Target = [u8]> + Send + 'static,
     {
         let on_disk = Box::new(on_disk);
         let mut parents = DirstateParents::NULL;
 
         Ok((
-            OwningDirstateMapTryBuilder {
-                on_disk,
-                map_builder: |bytes| {
-                    DirstateMap::new_v1(bytes, identity).map(|(dmap, p)| {
-                        parents = p.unwrap_or(DirstateParents::NULL);
-                        dmap
-                    })
-                },
-            }
-            .try_build()?,
+            OwningDirstateMap::try_new(on_disk, |bytes| {
+                DirstateMap::new_v1(bytes, identity).map(|(dmap, p)| {
+                    parents = p.unwrap_or(DirstateParents::NULL);
+                    dmap
+                })
+            })?,
             parents,
         ))
     }
 
     pub fn new_v2<OnDisk>(
         on_disk: OnDisk,
         data_size: usize,
@@ -62,36 +53,32 @@
         identity: Option<u64>,
     ) -> Result<Self, DirstateError>
     where
         OnDisk: Deref<Target = [u8]> + Send + 'static,
     {
         let on_disk = Box::new(on_disk);
 
-        OwningDirstateMapTryBuilder {
-            on_disk,
-            map_builder: |bytes| {
-                DirstateMap::new_v2(bytes, data_size, metadata, uuid, identity)
-            },
-        }
-        .try_build()
+        OwningDirstateMap::try_new(on_disk, |bytes| {
+            DirstateMap::new_v2(bytes, data_size, metadata, uuid, identity)
+        })
     }
 
     pub fn with_dmap_mut<R>(
         &mut self,
         f: impl FnOnce(&mut DirstateMap) -> R,
     ) -> R {
-        self.with_map_mut(f)
+        self.with_dependent_mut(|_owner, dmap| f(dmap))
     }
 
     pub fn get_map(&self) -> &DirstateMap {
-        self.borrow_map()
+        self.borrow_dependent()
     }
 
     pub fn on_disk(&self) -> &[u8] {
-        self.borrow_on_disk()
+        self.borrow_owner()
     }
 
     pub fn old_uuid(&self) -> Option<&[u8]> {
         self.get_map().old_uuid.as_deref()
     }
 
     pub fn old_identity(&self) -> Option<u64> {
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/dirstate_tree/path_with_basename.rs` & `mercurial-6.5rc0/rust/hg-core/src/dirstate_tree/path_with_basename.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/dirstate_tree/status.rs` & `mercurial-6.5rc0/rust/hg-core/src/dirstate_tree/status.rs`

 * *Files 2% similar despite different names*

```diff
@@ -43,24 +43,18 @@
     dmap: &'dirstate mut DirstateMap,
     matcher: &(dyn Matcher + Sync),
     root_dir: PathBuf,
     ignore_files: Vec<PathBuf>,
     options: StatusOptions,
 ) -> Result<(DirstateStatus<'dirstate>, Vec<PatternFileWarning>), StatusError>
 {
-    // Force the global rayon threadpool to not exceed 16 concurrent threads.
-    // This is a stop-gap measure until we figure out why using more than 16
-    // threads makes `status` slower for each additional thread.
-    // We use `ok()` in case the global threadpool has already been
-    // instantiated in `rhg` or some other caller.
-    // TODO find the underlying cause and fix it, then remove this.
-    rayon::ThreadPoolBuilder::new()
-        .num_threads(16.min(rayon::current_num_threads()))
-        .build_global()
-        .ok();
+    // Also cap for a Python caller of this function, but don't complain if
+    // the global threadpool has already been set since this code path is also
+    // being used by `rhg`, which calls this early.
+    let _ = crate::utils::cap_default_rayon_threads();
 
     let (ignore_fn, warnings, patterns_changed): (IgnoreFnType, _, _) =
         if options.list_ignored || options.list_unknown {
             let (ignore_fn, warnings, changed) = match dmap.dirstate_version {
                 DirstateVersion::V1 => {
                     let (ignore_fn, warnings) = get_ignore_function(
                         ignore_files,
@@ -240,15 +234,15 @@
         }
     }
 
     fn force<'b>(&self, ignore_fn: &IgnoreFnType<'b>) -> bool {
         match self.parent {
             None => false,
             Some(parent) => {
-                *(parent.cache.get_or_init(|| {
+                *(self.cache.get_or_init(|| {
                     parent.force(ignore_fn) || ignore_fn(self.path)
                 }))
             }
         }
     }
 }
 
@@ -429,24 +423,29 @@
 
             // We don’t know, so conservatively say this isn’t the case
             let children_all_have_dirstate_node_or_are_ignored = false;
 
             return Ok(children_all_have_dirstate_node_or_are_ignored);
         }
 
+        let readdir_succeeded;
         let mut fs_entries = if let Ok(entries) = self.read_dir(
             directory_hg_path,
             &directory_entry.fs_path,
             is_at_repo_root,
         ) {
+            readdir_succeeded = true;
             entries
         } else {
             // Treat an unreadable directory (typically because of insufficient
             // permissions) like an empty directory. `self.read_dir` has
             // already called `self.io_error` so a warning will be emitted.
+            // We still need to remember that there was an error so that we
+            // know not to cache this result.
+            readdir_succeeded = false;
             Vec::new()
         };
 
         // `merge_join_by` requires both its input iterators to be sorted:
 
         let dirstate_nodes = dirstate_nodes.sorted();
         // `sort_unstable_by_key` doesn’t allow keys borrowing from the value:
@@ -491,14 +490,15 @@
                     directory_hg_path,
                     fs_entry,
                 ),
             };
             Ok(has_dirstate_node_or_is_ignored)
         })
         .try_reduce(|| true, |a, b| Ok(a && b))
+        .map(|res| res && readdir_succeeded)
     }
 
     fn traverse_fs_and_dirstate<'ancestor>(
         &self,
         fs_entry: &DirEntry,
         dirstate_node: NodeRef<'tree, 'on_disk>,
         has_ignored_ancestor: &'ancestor HasIgnoredAncestor<'ancestor>,
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/discovery.rs` & `mercurial-6.5rc0/rust/hg-core/src/discovery.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/errors.rs` & `mercurial-6.5rc0/rust/hg-core/src/errors.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/exit_codes.rs` & `mercurial-6.5rc0/rust/hg-core/src/exit_codes.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/filepatterns.rs` & `mercurial-6.5rc0/rust/hg-core/src/filepatterns.rs`

 * *Files 1% similar despite different names*

```diff
@@ -46,14 +46,16 @@
     /// Glob that matches at the front of the path
     RootGlob,
     /// Glob that matches at any suffix of the path (still anchored at
     /// slashes)
     Glob,
     /// a path relative to repository root, which is matched recursively
     Path,
+    /// a single exact path relative to repository root
+    FilePath,
     /// A path relative to cwd
     RelPath,
     /// an unrooted glob (*.rs matches Rust files in all dirs)
     RelGlob,
     /// A regexp that needn't match the start of a name
     RelRegexp,
     /// A path relative to repository root, which is matched non-recursively
@@ -153,14 +155,15 @@
 
 pub fn parse_pattern_syntax(
     kind: &[u8],
 ) -> Result<PatternSyntax, PatternError> {
     match kind {
         b"re:" => Ok(PatternSyntax::Regexp),
         b"path:" => Ok(PatternSyntax::Path),
+        b"filepath:" => Ok(PatternSyntax::FilePath),
         b"relpath:" => Ok(PatternSyntax::RelPath),
         b"rootfilesin:" => Ok(PatternSyntax::RootFiles),
         b"relglob:" => Ok(PatternSyntax::RelGlob),
         b"relre:" => Ok(PatternSyntax::RelRegexp),
         b"glob:" => Ok(PatternSyntax::Glob),
         b"rootglob:" => Ok(PatternSyntax::RootGlob),
         b"include:" => Ok(PatternSyntax::Include),
@@ -248,15 +251,16 @@
             }
         }
         PatternSyntax::Glob | PatternSyntax::RootGlob => {
             [glob_to_re(pattern).as_slice(), GLOB_SUFFIX].concat()
         }
         PatternSyntax::Include
         | PatternSyntax::SubInclude
-        | PatternSyntax::ExpandedSubInclude(_) => unreachable!(),
+        | PatternSyntax::ExpandedSubInclude(_)
+        | PatternSyntax::FilePath => unreachable!(),
     }
 }
 
 const GLOB_SPECIAL_CHARACTERS: [u8; 7] =
     [b'*', b'?', b'[', b']', b'{', b'}', b'\\'];
 
 /// TODO support other platforms
@@ -315,17 +319,17 @@
         | PatternSyntax::RelGlob
         | PatternSyntax::RootFiles => normalize_path_bytes(pattern),
         PatternSyntax::Include | PatternSyntax::SubInclude => {
             return Err(PatternError::NonRegexPattern(entry.clone()))
         }
         _ => pattern.to_owned(),
     };
-    if *syntax == PatternSyntax::RootGlob
-        && !pattern.iter().any(|b| GLOB_SPECIAL_CHARACTERS.contains(b))
-    {
+    let is_simple_rootglob = *syntax == PatternSyntax::RootGlob
+        && !pattern.iter().any(|b| GLOB_SPECIAL_CHARACTERS.contains(b));
+    if is_simple_rootglob || syntax == &PatternSyntax::FilePath {
         Ok(None)
     } else {
         let mut entry = entry.clone();
         entry.pattern = pattern;
         Ok(Some(_build_single_regex(&entry)))
     }
 }
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/lib.rs` & `mercurial-6.5rc0/rust/hg-core/src/lib.rs`

 * *Files 6% similar despite different names*

```diff
@@ -59,27 +59,23 @@
 // dirstate_tree? How does XxHash compare with AHash, hashbrown’s default?
 pub type FastHashbrownMap<K, V> =
     hashbrown::HashMap<K, V, RandomXxHashBuilder64>;
 
 #[derive(Debug, PartialEq)]
 pub enum DirstateMapError {
     PathNotFound(HgPathBuf),
-    EmptyPath,
     InvalidPath(HgPathError),
 }
 
 impl fmt::Display for DirstateMapError {
     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
         match self {
             DirstateMapError::PathNotFound(_) => {
                 f.write_str("expected a value, found none")
             }
-            DirstateMapError::EmptyPath => {
-                f.write_str("Overflow in dirstate.")
-            }
             DirstateMapError::InvalidPath(path_error) => path_error.fmt(f),
         }
     }
 }
 
 #[derive(Debug, derive_more::From)]
 pub enum DirstateError {
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/lock.rs` & `mercurial-6.5rc0/rust/hg-core/src/lock.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/logging.rs` & `mercurial-6.5rc0/rust/hg-core/src/logging.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/matchers.rs` & `mercurial-6.5rc0/rust/hg-core/src/matchers.rs`

 * *Files 1% similar despite different names*

```diff
@@ -704,15 +704,17 @@
                     {
                         break;
                     }
                     root.push(HgPathBuf::from_bytes(p).as_ref());
                 }
                 roots.push(root);
             }
-            PatternSyntax::Path | PatternSyntax::RelPath => {
+            PatternSyntax::Path
+            | PatternSyntax::RelPath
+            | PatternSyntax::FilePath => {
                 let pat = HgPath::new(if pattern == b"." {
                     &[] as &[u8]
                 } else {
                     pattern
                 });
                 roots.push(pat.to_owned());
             }
@@ -1219,14 +1221,48 @@
             VisitChildrenSet::This
         );
         assert_eq!(
             matcher.visit_children_set(HgPath::new(b"dir/subdir/x")),
             VisitChildrenSet::This
         );
 
+        // VisitchildrensetFilePath
+        let matcher = IncludeMatcher::new(vec![IgnorePattern::new(
+            PatternSyntax::FilePath,
+            b"dir/z",
+            Path::new(""),
+        )])
+        .unwrap();
+
+        let mut set = HashSet::new();
+        set.insert(HgPathBuf::from_bytes(b"dir"));
+        assert_eq!(
+            matcher.visit_children_set(HgPath::new(b"")),
+            VisitChildrenSet::Set(set)
+        );
+        assert_eq!(
+            matcher.visit_children_set(HgPath::new(b"folder")),
+            VisitChildrenSet::Empty
+        );
+        let mut set = HashSet::new();
+        set.insert(HgPathBuf::from_bytes(b"z"));
+        assert_eq!(
+            matcher.visit_children_set(HgPath::new(b"dir")),
+            VisitChildrenSet::Set(set)
+        );
+        // OPT: these should probably be set().
+        assert_eq!(
+            matcher.visit_children_set(HgPath::new(b"dir/subdir")),
+            VisitChildrenSet::Empty
+        );
+        assert_eq!(
+            matcher.visit_children_set(HgPath::new(b"dir/subdir/x")),
+            VisitChildrenSet::Empty
+        );
+
         // Test multiple patterns
         let matcher = IncludeMatcher::new(vec![
             IgnorePattern::new(PatternSyntax::RelPath, b"foo", Path::new("")),
             IgnorePattern::new(PatternSyntax::Glob, b"g*", Path::new("")),
         ])
         .unwrap();
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/narrow.rs` & `mercurial-6.5rc0/rust/hg-core/src/narrow.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/operations/cat.rs` & `mercurial-6.5rc0/rust/hg-core/src/operations/cat.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/operations/debugdata.rs` & `mercurial-6.5rc0/rust/hg-core/src/operations/debugdata.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/operations/list_tracked_files.rs` & `mercurial-6.5rc0/rust/hg-core/src/operations/list_tracked_files.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/repo.rs` & `mercurial-6.5rc0/rust/hg-core/src/repo.rs`

 * *Files 3% similar despite different names*

```diff
@@ -228,15 +228,25 @@
     pub fn try_with_wlock_no_wait<R>(
         &self,
         f: impl FnOnce() -> R,
     ) -> Result<R, LockError> {
         try_with_lock_no_wait(self.hg_vfs(), "wlock", f)
     }
 
-    pub fn has_dirstate_v2(&self) -> bool {
+    /// Whether this repo should use dirstate-v2.
+    /// The presence of `dirstate-v2` in the requirements does not mean that
+    /// the on-disk dirstate is necessarily in version 2. In most cases,
+    /// a dirstate-v2 file will indeed be found, but in rare cases (like the
+    /// upgrade mechanism being cut short), the on-disk version will be a
+    /// v1 file.
+    /// Semantically, having a requirement only means that a client cannot
+    /// properly understand or properly update the repo if it lacks the support
+    /// for the required feature, but not that that feature is actually used
+    /// in all occasions.
+    pub fn use_dirstate_v2(&self) -> bool {
         self.requirements
             .contains(requirements::DIRSTATE_V2_REQUIREMENT)
     }
 
     pub fn has_sparse(&self) -> bool {
         self.requirements.contains(requirements::SPARSE_REQUIREMENT)
     }
@@ -273,18 +283,29 @@
             .get_or_init(|| self.read_dirstate_parents())?)
     }
 
     fn read_dirstate_parents(&self) -> Result<DirstateParents, HgError> {
         let dirstate = self.dirstate_file_contents()?;
         let parents = if dirstate.is_empty() {
             DirstateParents::NULL
-        } else if self.has_dirstate_v2() {
-            let docket =
-                crate::dirstate_tree::on_disk::read_docket(&dirstate)?;
-            docket.parents()
+        } else if self.use_dirstate_v2() {
+            let docket_res =
+                crate::dirstate_tree::on_disk::read_docket(&dirstate);
+            match docket_res {
+                Ok(docket) => docket.parents(),
+                Err(_) => {
+                    log::info!(
+                        "Parsing dirstate docket failed, \
+                        falling back to dirstate-v1"
+                    );
+                    *crate::dirstate::parsers::parse_dirstate_parents(
+                        &dirstate,
+                    )?
+                }
+            }
         } else {
             *crate::dirstate::parsers::parse_dirstate_parents(&dirstate)?
         };
         self.dirstate_parents.set(parents);
         Ok(parents)
     }
 
@@ -292,35 +313,55 @@
     /// check if the data file has been updated/deleted by another process
     /// since we last read the dirstate.
     /// Namely, the inode, data file uuid and the data size.
     fn get_dirstate_data_file_integrity(
         &self,
     ) -> Result<DirstateMapIdentity, HgError> {
         assert!(
-            self.has_dirstate_v2(),
+            self.use_dirstate_v2(),
             "accessing dirstate data file ID without dirstate-v2"
         );
         // Get the identity before the contents since we could have a race
         // between the two. Having an identity that is too old is fine, but
         // one that is younger than the content change is bad.
         let identity = self.dirstate_identity()?;
         let dirstate = self.dirstate_file_contents()?;
         if dirstate.is_empty() {
             self.dirstate_parents.set(DirstateParents::NULL);
             Ok((identity, None, 0))
         } else {
-            let docket =
-                crate::dirstate_tree::on_disk::read_docket(&dirstate)?;
-            self.dirstate_parents.set(docket.parents());
-            Ok((identity, Some(docket.uuid.to_owned()), docket.data_size()))
+            let docket_res =
+                crate::dirstate_tree::on_disk::read_docket(&dirstate);
+            match docket_res {
+                Ok(docket) => {
+                    self.dirstate_parents.set(docket.parents());
+                    Ok((
+                        identity,
+                        Some(docket.uuid.to_owned()),
+                        docket.data_size(),
+                    ))
+                }
+                Err(_) => {
+                    log::info!(
+                        "Parsing dirstate docket failed, \
+                        falling back to dirstate-v1"
+                    );
+                    let parents =
+                        *crate::dirstate::parsers::parse_dirstate_parents(
+                            &dirstate,
+                        )?;
+                    self.dirstate_parents.set(parents);
+                    Ok((identity, None, 0))
+                }
+            }
         }
     }
 
     fn new_dirstate_map(&self) -> Result<OwningDirstateMap, DirstateError> {
-        if self.has_dirstate_v2() {
+        if self.use_dirstate_v2() {
             // The v2 dirstate is split into a docket and a data file.
             // Since we don't always take the `wlock` to read it
             // (like in `hg status`), it is susceptible to races.
             // A simple retry method should be enough since full rewrites
             // only happen when too much garbage data is present and
             // this race is unlikely.
             let mut tries = 0;
@@ -339,42 +380,47 @@
                                 "dirstate read race detected {} (retry {}/{})",
                                 context,
                                 tries,
                                 V2_MAX_READ_ATTEMPTS,
                             );
                             continue;
                         }
-                        _ => return Err(e),
+                        _ => {
+                            log::info!(
+                                "Reading dirstate v2 failed, \
+                                falling back to v1"
+                            );
+                            return self.new_dirstate_map_v1();
+                        }
                     },
                 }
             }
             let error = HgError::abort(
                 format!("dirstate read race happened {tries} times in a row"),
                 255,
                 None,
             );
             Err(DirstateError::Common(error))
         } else {
-            debug_wait_for_file_or_print(
-                self.config(),
-                "dirstate.pre-read-file",
-            );
-            let identity = self.dirstate_identity()?;
-            let dirstate_file_contents = self.dirstate_file_contents()?;
-            if dirstate_file_contents.is_empty() {
-                self.dirstate_parents.set(DirstateParents::NULL);
-                Ok(OwningDirstateMap::new_empty(Vec::new()))
-            } else {
-                let (map, parents) = OwningDirstateMap::new_v1(
-                    dirstate_file_contents,
-                    identity,
-                )?;
-                self.dirstate_parents.set(parents);
-                Ok(map)
-            }
+            self.new_dirstate_map_v1()
+        }
+    }
+
+    fn new_dirstate_map_v1(&self) -> Result<OwningDirstateMap, DirstateError> {
+        debug_wait_for_file_or_print(self.config(), "dirstate.pre-read-file");
+        let identity = self.dirstate_identity()?;
+        let dirstate_file_contents = self.dirstate_file_contents()?;
+        if dirstate_file_contents.is_empty() {
+            self.dirstate_parents.set(DirstateParents::NULL);
+            Ok(OwningDirstateMap::new_empty(Vec::new()))
+        } else {
+            let (map, parents) =
+                OwningDirstateMap::new_v1(dirstate_file_contents, identity)?;
+            self.dirstate_parents.set(parents);
+            Ok(map)
         }
     }
 
     fn read_docket_and_data_file(
         &self,
     ) -> Result<OwningDirstateMap, DirstateError> {
         debug_wait_for_file_or_print(self.config(), "dirstate.pre-read-file");
@@ -546,15 +592,15 @@
     /// TODO: have a `WritableRepo` type only accessible while holding the
     /// lock?
     pub fn write_dirstate(&self) -> Result<(), DirstateError> {
         let map = self.dirstate_map()?;
         // TODO: Maintain a `DirstateMap::dirty` flag, and return early here if
         // it’s unset
         let parents = self.dirstate_parents()?;
-        let (packed_dirstate, old_uuid_to_remove) = if self.has_dirstate_v2() {
+        let (packed_dirstate, old_uuid_to_remove) = if self.use_dirstate_v2() {
             let (identity, uuid, data_size) =
                 self.get_dirstate_data_file_integrity()?;
             let identity_changed = identity != map.old_identity();
             let uuid_changed = uuid.as_deref() != map.old_uuid();
             let data_length_changed = data_size != map.old_data_size();
 
             if identity_changed || uuid_changed || data_length_changed {
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/requirements.rs` & `mercurial-6.5rc0/rust/hg-core/src/requirements.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/revlog/changelog.rs` & `mercurial-6.5rc0/rust/hg-core/src/revlog/changelog.rs`

 * *Files 19% similar despite different names*

```diff
@@ -1,79 +1,131 @@
 use crate::errors::HgError;
-use crate::revlog::Revision;
 use crate::revlog::{Node, NodePrefix};
+use crate::revlog::{Revision, NULL_REVISION};
 use crate::revlog::{Revlog, RevlogEntry, RevlogError};
 use crate::utils::hg_path::HgPath;
 use crate::vfs::Vfs;
 use itertools::Itertools;
 use std::ascii::escape_default;
 use std::borrow::Cow;
 use std::fmt::{Debug, Formatter};
 
-/// A specialized `Revlog` to work with `changelog` data format.
+/// A specialized `Revlog` to work with changelog data format.
 pub struct Changelog {
     /// The generic `revlog` format.
     pub(crate) revlog: Revlog,
 }
 
 impl Changelog {
     /// Open the `changelog` of a repository given by its root.
     pub fn open(store_vfs: &Vfs, use_nodemap: bool) -> Result<Self, HgError> {
         let revlog =
             Revlog::open(store_vfs, "00changelog.i", None, use_nodemap)?;
         Ok(Self { revlog })
     }
 
-    /// Return the `ChangelogEntry` for the given node ID.
+    /// Return the `ChangelogRevisionData` for the given node ID.
     pub fn data_for_node(
         &self,
         node: NodePrefix,
     ) -> Result<ChangelogRevisionData, RevlogError> {
         let rev = self.revlog.rev_from_node(node)?;
         self.data_for_rev(rev)
     }
 
-    /// Return the `RevlogEntry` of the given revision number.
+    /// Return the [`ChangelogEntry`] for the given revision number.
     pub fn entry_for_rev(
         &self,
         rev: Revision,
-    ) -> Result<RevlogEntry, RevlogError> {
-        self.revlog.get_entry(rev)
+    ) -> Result<ChangelogEntry, RevlogError> {
+        let revlog_entry = self.revlog.get_entry(rev)?;
+        Ok(ChangelogEntry { revlog_entry })
     }
 
-    /// Return the `ChangelogEntry` of the given revision number.
+    /// Return the [`ChangelogRevisionData`] for the given revision number.
+    ///
+    /// This is a useful shortcut in case the caller does not need the
+    /// generic revlog information (parents, hashes etc). Otherwise
+    /// consider taking a [`ChangelogEntry`] with
+    /// [entry_for_rev](`Self::entry_for_rev`) and doing everything from there.
     pub fn data_for_rev(
         &self,
         rev: Revision,
     ) -> Result<ChangelogRevisionData, RevlogError> {
-        let bytes = self.revlog.get_rev_data(rev)?;
-        if bytes.is_empty() {
-            Ok(ChangelogRevisionData::null())
-        } else {
-            Ok(ChangelogRevisionData::new(bytes).map_err(|err| {
-                RevlogError::Other(HgError::CorruptedRepository(format!(
-                    "Invalid changelog data for revision {}: {:?}",
-                    rev, err
-                )))
-            })?)
+        if rev == NULL_REVISION {
+            return Ok(ChangelogRevisionData::null());
         }
+        self.entry_for_rev(rev)?.data()
     }
 
     pub fn node_from_rev(&self, rev: Revision) -> Option<&Node> {
         self.revlog.node_from_rev(rev)
     }
 
     pub fn rev_from_node(
         &self,
         node: NodePrefix,
     ) -> Result<Revision, RevlogError> {
         self.revlog.rev_from_node(node)
     }
 }
 
+/// A specialized `RevlogEntry` for `changelog` data format
+///
+/// This is a `RevlogEntry` with the added semantics that the associated
+/// data should meet the requirements for `changelog`, materialized by
+/// the fact that `data()` constructs a `ChangelogRevisionData`.
+/// In case that promise would be broken, the `data` method returns an error.
+#[derive(Clone)]
+pub struct ChangelogEntry<'changelog> {
+    /// Same data, as a generic `RevlogEntry`.
+    pub(crate) revlog_entry: RevlogEntry<'changelog>,
+}
+
+impl<'changelog> ChangelogEntry<'changelog> {
+    pub fn data<'a>(
+        &'a self,
+    ) -> Result<ChangelogRevisionData<'changelog>, RevlogError> {
+        let bytes = self.revlog_entry.data()?;
+        if bytes.is_empty() {
+            Ok(ChangelogRevisionData::null())
+        } else {
+            Ok(ChangelogRevisionData::new(bytes).map_err(|err| {
+                RevlogError::Other(HgError::CorruptedRepository(format!(
+                    "Invalid changelog data for revision {}: {:?}",
+                    self.revlog_entry.revision(),
+                    err
+                )))
+            })?)
+        }
+    }
+
+    /// Obtain a reference to the underlying `RevlogEntry`.
+    ///
+    /// This allows the caller to access the information that is common
+    /// to all revlog entries: revision number, node id, parent revisions etc.
+    pub fn as_revlog_entry(&self) -> &RevlogEntry {
+        &self.revlog_entry
+    }
+
+    pub fn p1_entry(&self) -> Result<Option<ChangelogEntry>, RevlogError> {
+        Ok(self
+            .revlog_entry
+            .p1_entry()?
+            .map(|revlog_entry| Self { revlog_entry }))
+    }
+
+    pub fn p2_entry(&self) -> Result<Option<ChangelogEntry>, RevlogError> {
+        Ok(self
+            .revlog_entry
+            .p2_entry()?
+            .map(|revlog_entry| Self { revlog_entry }))
+    }
+}
+
 /// `Changelog` entry which knows how to interpret the `changelog` data bytes.
 #[derive(PartialEq)]
 pub struct ChangelogRevisionData<'changelog> {
     /// The data bytes of the `changelog` entry.
     bytes: Cow<'changelog, [u8]>,
     /// The end offset for the hex manifest (not including the newline)
     manifest_end: usize,
@@ -211,14 +263,16 @@
     )
     .to_string()
 }
 
 #[cfg(test)]
 mod tests {
     use super::*;
+    use crate::vfs::Vfs;
+    use crate::NULL_REVISION;
     use pretty_assertions::assert_eq;
 
     #[test]
     fn test_create_changelogrevisiondata_invalid() {
         // Completely empty
         assert!(ChangelogRevisionData::new(Cow::Borrowed(b"abcd")).is_err());
         // No newline after manifest
@@ -264,8 +318,24 @@
         assert_eq!(data.timestamp_line(), b"0 0");
         assert_eq!(
             data.files().collect_vec(),
             vec![HgPath::new("file1"), HgPath::new("file2")]
         );
         assert_eq!(data.description(), b"some\ncommit\nmessage");
     }
+
+    #[test]
+    fn test_data_from_rev_null() -> Result<(), RevlogError> {
+        // an empty revlog will be enough for this case
+        let temp = tempfile::tempdir().unwrap();
+        let vfs = Vfs { base: temp.path() };
+        std::fs::write(temp.path().join("foo.i"), b"").unwrap();
+        let revlog = Revlog::open(&vfs, "foo.i", None, false).unwrap();
+
+        let changelog = Changelog { revlog };
+        assert_eq!(
+            changelog.data_for_rev(NULL_REVISION)?,
+            ChangelogRevisionData::null()
+        );
+        Ok(())
+    }
 }
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/revlog/filelog.rs` & `mercurial-6.5rc0/rust/hg-core/src/revlog/filelog.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/revlog/index.rs` & `mercurial-6.5rc0/rust/hg-core/src/revlog/index.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/revlog/manifest.rs` & `mercurial-6.5rc0/rust/hg-core/src/revlog/manifest.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/revlog/mod.rs` & `mercurial-6.5rc0/rust/hg-core/src/revlog/mod.rs`

 * *Files 3% similar despite different names*

```diff
@@ -19,14 +19,15 @@
 use std::borrow::Cow;
 use std::io::Read;
 use std::ops::Deref;
 use std::path::Path;
 
 use flate2::read::ZlibDecoder;
 use sha1::{Digest, Sha1};
+use std::cell::RefCell;
 use zstd;
 
 use self::node::{NODE_BYTES_LENGTH, NULL_NODE};
 use self::nodemap_docket::NodeMapDocket;
 use super::index::Index;
 use super::nodemap::{NodeMap, NodeMapError};
 use crate::errors::HgError;
@@ -396,28 +397,43 @@
             .map_err(|_| corrupted(format!("revision {} out of range", rev)))
     }
 }
 
 /// The revlog entry's bytes and the necessary informations to extract
 /// the entry's data.
 #[derive(Clone)]
-pub struct RevlogEntry<'a> {
-    revlog: &'a Revlog,
+pub struct RevlogEntry<'revlog> {
+    revlog: &'revlog Revlog,
     rev: Revision,
-    bytes: &'a [u8],
+    bytes: &'revlog [u8],
     compressed_len: u32,
     uncompressed_len: i32,
     base_rev_or_base_of_delta_chain: Option<Revision>,
     p1: Revision,
     p2: Revision,
     flags: u16,
     hash: Node,
 }
 
-impl<'a> RevlogEntry<'a> {
+thread_local! {
+  // seems fine to [unwrap] here: this can only fail due to memory allocation
+  // failing, and it's normal for that to cause panic.
+  static ZSTD_DECODER : RefCell<zstd::bulk::Decompressor<'static>> =
+      RefCell::new(zstd::bulk::Decompressor::new().ok().unwrap());
+}
+
+fn zstd_decompress_to_buffer(
+    bytes: &[u8],
+    buf: &mut Vec<u8>,
+) -> Result<usize, std::io::Error> {
+    ZSTD_DECODER
+        .with(|decoder| decoder.borrow_mut().decompress_to_buffer(bytes, buf))
+}
+
+impl<'revlog> RevlogEntry<'revlog> {
     pub fn revision(&self) -> Revision {
         self.rev
     }
 
     pub fn node(&self) -> &Node {
         &self.hash
     }
@@ -426,23 +442,27 @@
         u32::try_from(self.uncompressed_len).ok()
     }
 
     pub fn has_p1(&self) -> bool {
         self.p1 != NULL_REVISION
     }
 
-    pub fn p1_entry(&self) -> Result<Option<RevlogEntry>, RevlogError> {
+    pub fn p1_entry(
+        &self,
+    ) -> Result<Option<RevlogEntry<'revlog>>, RevlogError> {
         if self.p1 == NULL_REVISION {
             Ok(None)
         } else {
             Ok(Some(self.revlog.get_entry(self.p1)?))
         }
     }
 
-    pub fn p2_entry(&self) -> Result<Option<RevlogEntry>, RevlogError> {
+    pub fn p2_entry(
+        &self,
+    ) -> Result<Option<RevlogEntry<'revlog>>, RevlogError> {
         if self.p2 == NULL_REVISION {
             Ok(None)
         } else {
             Ok(Some(self.revlog.get_entry(self.p2)?))
         }
     }
 
@@ -469,15 +489,15 @@
     pub fn has_length_affecting_flag_processor(&self) -> bool {
         // Relevant Python code: revlog.size()
         // note: ELLIPSIS is known to not change the content
         (self.flags & (REVIDX_KNOWN_FLAGS ^ REVISION_FLAG_ELLIPSIS)) != 0
     }
 
     /// The data for this entry, after resolving deltas if any.
-    pub fn rawdata(&self) -> Result<Cow<'a, [u8]>, HgError> {
+    pub fn rawdata(&self) -> Result<Cow<'revlog, [u8]>, HgError> {
         let mut entry = self.clone();
         let mut delta_chain = vec![];
 
         // The meaning of `base_rev_or_base_of_delta_chain` depends on
         // generaldelta. See the doc on `ENTRY_DELTA_BASE` in
         // `mercurial/revlogutils/constants.py` and the code in
         // [_chaininfo] and in [index_deltachain].
@@ -499,16 +519,16 @@
         };
 
         Ok(data)
     }
 
     fn check_data(
         &self,
-        data: Cow<'a, [u8]>,
-    ) -> Result<Cow<'a, [u8]>, HgError> {
+        data: Cow<'revlog, [u8]>,
+    ) -> Result<Cow<'revlog, [u8]>, HgError> {
         if self.revlog.check_hash(
             self.p1,
             self.p2,
             self.hash.as_bytes(),
             &data,
         ) {
             Ok(data)
@@ -521,25 +541,25 @@
             Err(corrupted(format!(
                 "hash check failed for revision {}",
                 self.rev
             )))
         }
     }
 
-    pub fn data(&self) -> Result<Cow<'a, [u8]>, HgError> {
+    pub fn data(&self) -> Result<Cow<'revlog, [u8]>, HgError> {
         let data = self.rawdata()?;
         if self.is_censored() {
             return Err(HgError::CensoredNodeError);
         }
         self.check_data(data)
     }
 
     /// Extract the data contained in the entry.
     /// This may be a delta. (See `is_delta`.)
-    fn data_chunk(&self) -> Result<Cow<'a, [u8]>, HgError> {
+    fn data_chunk(&self) -> Result<Cow<'revlog, [u8]>, HgError> {
         if self.bytes.is_empty() {
             return Ok(Cow::Borrowed(&[]));
         }
         match self.bytes[0] {
             // Revision data is the entirety of the entry, including this
             // header.
             b'\0' => Ok(Cow::Borrowed(self.bytes)),
@@ -572,23 +592,36 @@
                 .read_exact(&mut buf)
                 .map_err(|e| corrupted(e.to_string()))?;
             Ok(buf)
         }
     }
 
     fn uncompressed_zstd_data(&self) -> Result<Vec<u8>, HgError> {
+        let cap = self.uncompressed_len.max(0) as usize;
         if self.is_delta() {
-            let mut buf = Vec::with_capacity(self.compressed_len as usize);
-            zstd::stream::copy_decode(self.bytes, &mut buf)
-                .map_err(|e| corrupted(e.to_string()))?;
+            // [cap] is usually an over-estimate of the space needed because
+            // it's the length of delta-decoded data, but we're interested
+            // in the size of the delta.
+            // This means we have to [shrink_to_fit] to avoid holding on
+            // to a large chunk of memory, but it also means we must have a
+            // fallback branch, for the case when the delta is longer than
+            // the original data (surprisingly, this does happen in practice)
+            let mut buf = Vec::with_capacity(cap);
+            match zstd_decompress_to_buffer(self.bytes, &mut buf) {
+                Ok(_) => buf.shrink_to_fit(),
+                Err(_) => {
+                    buf.clear();
+                    zstd::stream::copy_decode(self.bytes, &mut buf)
+                        .map_err(|e| corrupted(e.to_string()))?;
+                }
+            };
             Ok(buf)
         } else {
-            let cap = self.uncompressed_len.max(0) as usize;
-            let mut buf = vec![0; cap];
-            let len = zstd::bulk::decompress_to_buffer(self.bytes, &mut buf)
+            let mut buf = Vec::with_capacity(cap);
+            let len = zstd_decompress_to_buffer(self.bytes, &mut buf)
                 .map_err(|e| corrupted(e.to_string()))?;
             if len != self.uncompressed_len as usize {
                 Err(corrupted("uncompressed length does not match"))
             } else {
                 Ok(buf)
             }
         }
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/revlog/node.rs` & `mercurial-6.5rc0/rust/hg-core/src/revlog/node.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/revlog/nodemap.rs` & `mercurial-6.5rc0/rust/hg-core/src/revlog/nodemap.rs`

 * *Files 1% similar despite different names*

```diff
@@ -21,42 +21,41 @@
 use std::fmt;
 use std::mem::{self, align_of, size_of};
 use std::ops::Deref;
 use std::ops::Index;
 
 #[derive(Debug, PartialEq)]
 pub enum NodeMapError {
+    /// A `NodePrefix` matches several [`Revision`]s.
+    ///
+    /// This can be returned by methods meant for (at most) one match.
     MultipleResults,
     /// A `Revision` stored in the nodemap could not be found in the index
     RevisionNotInIndex(Revision),
 }
 
 /// Mapping system from Mercurial nodes to revision numbers.
 ///
 /// ## `RevlogIndex` and `NodeMap`
 ///
 /// One way to think about their relationship is that
-/// the `NodeMap` is a prefix-oriented reverse index of the `Node` information
-/// carried by a [`RevlogIndex`].
+/// the `NodeMap` is a prefix-oriented reverse index of the [`Node`]
+/// information carried by a [`RevlogIndex`].
 ///
 /// Many of the methods in this trait take a `RevlogIndex` argument
 /// which is used for validation of their results. This index must naturally
 /// be the one the `NodeMap` is about, and it must be consistent.
 ///
 /// Notably, the `NodeMap` must not store
 /// information about more `Revision` values than there are in the index.
 /// In these methods, an encountered `Revision` is not in the index, a
-/// [`RevisionNotInIndex`] error is returned.
+/// [RevisionNotInIndex](NodeMapError) error is returned.
 ///
 /// In insert operations, the rule is thus that the `NodeMap` must always
-/// be updated after the `RevlogIndex`
-/// be updated first, and the `NodeMap` second.
-///
-/// [`RevisionNotInIndex`]: enum.NodeMapError.html#variant.RevisionNotInIndex
-/// [`RevlogIndex`]: ../trait.RevlogIndex.html
+/// be updated after the `RevlogIndex` it is about.
 pub trait NodeMap {
     /// Find the unique `Revision` having the given `Node`
     ///
     /// If no Revision matches the given `Node`, `Ok(None)` is returned.
     fn find_node(
         &self,
         index: &impl RevlogIndex,
@@ -65,40 +64,41 @@
         self.find_bin(index, node.into())
     }
 
     /// Find the unique Revision whose `Node` starts with a given binary prefix
     ///
     /// If no Revision matches the given prefix, `Ok(None)` is returned.
     ///
-    /// If several Revisions match the given prefix, a [`MultipleResults`]
-    /// error is returned.
+    /// If several Revisions match the given prefix, a
+    /// [MultipleResults](NodeMapError)  error is returned.
     fn find_bin(
         &self,
         idx: &impl RevlogIndex,
         prefix: NodePrefix,
     ) -> Result<Option<Revision>, NodeMapError>;
 
     /// Give the size of the shortest node prefix that determines
     /// the revision uniquely.
     ///
     /// From a binary node prefix, if it is matched in the node map, this
     /// returns the number of hexadecimal digits that would had sufficed
     /// to find the revision uniquely.
     ///
-    /// Returns `None` if no `Revision` could be found for the prefix.
+    /// Returns `None` if no [`Revision`] could be found for the prefix.
     ///
-    /// If several Revisions match the given prefix, a [`MultipleResults`]
-    /// error is returned.
+    /// If several Revisions match the given prefix, a
+    /// [MultipleResults](NodeMapError)  error is returned.
     fn unique_prefix_len_bin(
         &self,
         idx: &impl RevlogIndex,
         node_prefix: NodePrefix,
     ) -> Result<Option<usize>, NodeMapError>;
 
-    /// Same as `unique_prefix_len_bin`, with a full `Node` as input
+    /// Same as [unique_prefix_len_bin](Self::unique_prefix_len_bin), with
+    /// a full [`Node`] as input
     fn unique_prefix_len_node(
         &self,
         idx: &impl RevlogIndex,
         node: &Node,
     ) -> Result<Option<usize>, NodeMapError> {
         self.unique_prefix_len_bin(idx, node.into())
     }
@@ -109,15 +109,15 @@
         &mut self,
         index: &I,
         node: &Node,
         rev: Revision,
     ) -> Result<(), NodeMapError>;
 }
 
-/// Low level NodeTree [`Blocks`] elements
+/// Low level NodeTree [`Block`] elements
 ///
 /// These are exactly as for instance on persistent storage.
 type RawElement = unaligned::I32Be;
 
 /// High level representation of values in NodeTree
 /// [`Blocks`](struct.Block.html)
 ///
@@ -152,40 +152,39 @@
             Element::None => 0,
             Element::Block(i) => i as i32,
             Element::Rev(rev) => -rev - 2,
         })
     }
 }
 
-/// A logical block of the `NodeTree`, packed with a fixed size.
+const ELEMENTS_PER_BLOCK: usize = 16; // number of different values in a nybble
+
+/// A logical block of the [`NodeTree`], packed with a fixed size.
 ///
 /// These are always used in container types implementing `Index<Block>`,
 /// such as `&Block`
 ///
 /// As an array of integers, its ith element encodes that the
 /// ith potential edge from the block, representing the ith hexadecimal digit
 /// (nybble) `i` is either:
 ///
 /// - absent (value -1)
 /// - another `Block` in the same indexable container (value ≥ 0)
-///  - a `Revision` leaf (value ≤ -2)
+///  - a [`Revision`] leaf (value ≤ -2)
 ///
 /// Endianness has to be fixed for consistency on shared storage across
 /// different architectures.
 ///
 /// A key difference with the C `nodetree` is that we need to be
 /// able to represent the [`Block`] at index 0, hence -1 is the empty marker
-/// rather than 0 and the `Revision` range upper limit of -2 instead of -1.
+/// rather than 0 and the [`Revision`] range upper limit of -2 instead of -1.
 ///
 /// Another related difference is that `NULL_REVISION` (-1) is not
 /// represented at all, because we want an immutable empty nodetree
 /// to be valid.
-
-const ELEMENTS_PER_BLOCK: usize = 16; // number of different values in a nybble
-
 #[derive(Copy, Clone, BytesCast, PartialEq)]
 #[repr(transparent)]
 pub struct Block([RawElement; ELEMENTS_PER_BLOCK]);
 
 impl Block {
     fn new() -> Self {
         let absent_node = RawElement::from(-1);
@@ -214,15 +213,15 @@
 }
 
 /// A mutable 16-radix tree with the root block logically at the end
 ///
 /// Because of the append only nature of our node trees, we need to
 /// keep the original untouched and store new blocks separately.
 ///
-/// The mutable root `Block` is kept apart so that we don't have to rebump
+/// The mutable root [`Block`] is kept apart so that we don't have to rebump
 /// it on each insertion.
 pub struct NodeTree {
     readonly: Box<dyn Deref<Target = [Block]> + Send>,
     growable: Vec<Block>,
     root: Block,
     masked_inner_blocks: usize,
 }
@@ -238,15 +237,15 @@
             &self.root
         } else {
             &self.growable[i - ro_len]
         }
     }
 }
 
-/// Return `None` unless the `Node` for `rev` has given prefix in `index`.
+/// Return `None` unless the [`Node`] for `rev` has given prefix in `idx`.
 fn has_prefix_or_none(
     idx: &impl RevlogIndex,
     prefix: NodePrefix,
     rev: Revision,
 ) -> Result<Option<Revision>, NodeMapError> {
     idx.node(rev)
         .ok_or(NodeMapError::RevisionNotInIndex(rev))
@@ -256,15 +255,15 @@
             } else {
                 None
             }
         })
 }
 
 /// validate that the candidate's node starts indeed with given prefix,
-/// and treat ambiguities related to `NULL_REVISION`.
+/// and treat ambiguities related to [`NULL_REVISION`].
 ///
 /// From the data in the NodeTree, one can only conclude that some
 /// revision is the only one for a *subprefix* of the one being looked up.
 fn validate_candidate(
     idx: &impl RevlogIndex,
     prefix: NodePrefix,
     candidate: (Option<Revision>, usize),
@@ -300,46 +299,44 @@
             root,
             masked_inner_blocks: 0,
         }
     }
 
     /// Create from an opaque bunch of bytes
     ///
-    /// The created `NodeTreeBytes` from `buffer`,
+    /// The created [`NodeTreeBytes`] from `bytes`,
     /// of which exactly `amount` bytes are used.
     ///
     /// - `buffer` could be derived from `PyBuffer` and `Mmap` objects.
-    /// - `offset` allows for the final file format to include fixed data
-    ///   (generation number, behavioural flags)
     /// - `amount` is expressed in bytes, and is not automatically derived from
     ///   `bytes`, so that a caller that manages them atomically can perform
     ///   temporary disk serializations and still rollback easily if needed.
     ///   First use-case for this would be to support Mercurial shell hooks.
     ///
     /// panics if `buffer` is smaller than `amount`
     pub fn load_bytes(
         bytes: Box<dyn Deref<Target = [u8]> + Send>,
         amount: usize,
     ) -> Self {
         NodeTree::new(Box::new(NodeTreeBytes::new(bytes, amount)))
     }
 
-    /// Retrieve added `Block` and the original immutable data
+    /// Retrieve added [`Block`]s and the original immutable data
     pub fn into_readonly_and_added(
         self,
     ) -> (Box<dyn Deref<Target = [Block]> + Send>, Vec<Block>) {
         let mut vec = self.growable;
         let readonly = self.readonly;
         if readonly.last() != Some(&self.root) {
             vec.push(self.root);
         }
         (readonly, vec)
     }
 
-    /// Retrieve added `Blocks` as bytes, ready to be written to persistent
+    /// Retrieve added [`Block]s as bytes, ready to be written to persistent
     /// storage
     pub fn into_readonly_and_added_bytes(
         self,
     ) -> (Box<dyn Deref<Target = [Block]> + Send>, Vec<u8>) {
         let (readonly, vec) = self.into_readonly_and_added();
         // Prevent running `v`'s destructor so we are in complete control
         // of the allocation.
@@ -377,24 +374,25 @@
         false
     }
 
     /// Main working method for `NodeTree` searches
     ///
     /// The first returned value is the result of analysing `NodeTree` data
     /// *alone*: whereas `None` guarantees that the given prefix is absent
-    /// from the `NodeTree` data (but still could match `NULL_NODE`), with
-    /// `Some(rev)`, it is to be understood that `rev` is the unique `Revision`
-    /// that could match the prefix. Actually, all that can be inferred from
+    /// from the [`NodeTree`] data (but still could match [`NULL_NODE`]), with
+    /// `Some(rev)`, it is to be understood that `rev` is the unique
+    /// [`Revision`] that could match the prefix. Actually, all that can
+    /// be inferred from
     /// the `NodeTree` data is that `rev` is the revision with the longest
     /// common node prefix with the given prefix.
     ///
     /// The second returned value is the size of the smallest subprefix
     /// of `prefix` that would give the same result, i.e. not the
-    /// `MultipleResults` error variant (again, using only the data of the
-    /// `NodeTree`).
+    /// [MultipleResults](NodeMapError) error variant (again, using only the
+    /// data of the [`NodeTree`]).
     fn lookup(
         &self,
         prefix: NodePrefix,
     ) -> Result<(Option<Revision>, usize), NodeMapError> {
         for (i, visit_item) in self.visit(prefix).enumerate() {
             if let Some(opt) = visit_item.final_revision() {
                 return Ok((opt, i + 1));
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/revlog/nodemap_docket.rs` & `mercurial-6.5rc0/rust/hg-core/src/revlog/nodemap_docket.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/revlog/patch.rs` & `mercurial-6.5rc0/rust/hg-core/src/revlog/patch.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/revlog/path_encode.rs` & `mercurial-6.5rc0/rust/hg-core/src/revlog/path_encode.rs`

 * *Files 2% similar despite different names*

```diff
@@ -541,17 +541,23 @@
     dest.write_bytes(b"dh/");
 
     if let Some(last_slash) = last_slash {
         for slice in src[..last_slash].split(|b| *b == b'/') {
             let slice = &slice[..std::cmp::min(slice.len(), dirprefixlen)];
             if dest.len() + slice.len() > maxshortdirslen + 3 {
                 break;
-            } else {
-                dest.write_bytes(slice);
             }
+            if let Some(last_char) = slice.last() {
+                if *last_char == b'.' || *last_char == b' ' {
+                    dest.write_bytes(&slice[0..slice.len() - 1]);
+                    dest.write_byte(b'_');
+                } else {
+                    dest.write_bytes(slice);
+                }
+            };
             dest.write_byte(b'/');
         }
     }
 
     let used = dest.len() + 40 + ext.len();
 
     if MAXSTOREPATHLEN > used {
@@ -606,14 +612,25 @@
 
 #[cfg(test)]
 mod tests {
     use super::*;
     use crate::utils::hg_path::HgPathBuf;
 
     #[test]
+    fn test_dirname_ends_with_underscore() {
+        let input = b"data/dir1234.foo/ABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJ.i";
+        let expected = b"dh/dir1234_/abcdefghijabcdefghijabcdefghijabcdefghijabcdefghijabcdefghij.if2e9ce59e095eff5f8f334dc809e65606a0aa50b.i";
+        let res = path_encode(input);
+        assert_eq!(
+            HgPathBuf::from_bytes(&res),
+            HgPathBuf::from_bytes(expected)
+        );
+    }
+
+    #[test]
     fn test_long_filename_at_root() {
         let input = b"data/ABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJ.i";
         let expected = b"dh/abcdefghijabcdefghijabcdefghijabcdefghijabcdefghijabcdefghij.i708243a2237a7afae259ea3545a72a2ef11c247b.i";
         let res = path_encode(input);
         assert_eq!(
             HgPathBuf::from_bytes(&res),
             HgPathBuf::from_bytes(expected)
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/revset.rs` & `mercurial-6.5rc0/rust/hg-core/src/revset.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/sparse.rs` & `mercurial-6.5rc0/rust/hg-core/src/sparse.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/testing.rs` & `mercurial-6.5rc0/rust/hg-core/src/testing.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/utils/debug.rs` & `mercurial-6.5rc0/rust/hg-core/src/utils/debug.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/utils/files.rs` & `mercurial-6.5rc0/rust/hg-core/src/utils/files.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/utils/hg_path.rs` & `mercurial-6.5rc0/rust/hg-core/src/utils/hg_path.rs`

 * *Files 2% similar despite different names*

```diff
@@ -475,18 +475,19 @@
 
 impl Extend<u8> for HgPathBuf {
     fn extend<T: IntoIterator<Item = u8>>(&mut self, iter: T) {
         self.inner.extend(iter);
     }
 }
 
-/// TODO: Once https://www.mercurial-scm.org/wiki/WindowsUTF8Plan is
+/// Create a new [`OsString`] from types referenceable as [`HgPath`].
+///
+/// TODO: Once <https://www.mercurial-scm.org/wiki/WindowsUTF8Plan> is
 /// implemented, these conversion utils will have to work differently depending
 /// on the repository encoding: either `UTF-8` or `MBCS`.
-
 pub fn hg_path_to_os_string<P: AsRef<HgPath>>(
     hg_path: P,
 ) -> Result<OsString, HgPathError> {
     hg_path.as_ref().check_state()?;
     let os_str;
     #[cfg(unix)]
     {
@@ -494,20 +495,22 @@
         os_str = std::ffi::OsStr::from_bytes(hg_path.as_ref().as_bytes());
     }
     // TODO Handle other platforms
     // TODO: convert from WTF8 to Windows MBCS (ANSI encoding).
     Ok(os_str.to_os_string())
 }
 
+/// Create a new [`PathBuf`] from types referenceable as [`HgPath`].
 pub fn hg_path_to_path_buf<P: AsRef<HgPath>>(
     hg_path: P,
 ) -> Result<PathBuf, HgPathError> {
     Ok(Path::new(&hg_path_to_os_string(hg_path)?).to_path_buf())
 }
 
+/// Create a new [`HgPathBuf`] from types referenceable as [`OsStr`].
 pub fn os_string_to_hg_path_buf<S: AsRef<OsStr>>(
     os_string: S,
 ) -> Result<HgPathBuf, HgPathError> {
     let buf;
     #[cfg(unix)]
     {
         use std::os::unix::ffi::OsStrExt;
@@ -516,14 +519,15 @@
     // TODO Handle other platforms
     // TODO: convert from WTF8 to Windows MBCS (ANSI encoding).
 
     buf.check_state()?;
     Ok(buf)
 }
 
+/// Create a new [`HgPathBuf`] from types referenceable as [`Path`].
 pub fn path_to_hg_path_buf<P: AsRef<Path>>(
     path: P,
 ) -> Result<HgPathBuf, HgPathError> {
     let buf;
     let os_str = path.as_ref().as_os_str();
     #[cfg(unix)]
     {
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/utils/path_auditor.rs` & `mercurial-6.5rc0/rust/hg-core/src/utils/path_auditor.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-core/src/utils.rs` & `mercurial-6.5rc0/rust/hg-core/src/utils.rs`

 * *Files 7% similar despite different names*

```diff
@@ -297,15 +297,15 @@
     New(V),
 }
 
 /// Return the union of the two given maps,
 /// calling `merge(key, left_value, right_value)` to resolve keys that exist in
 /// both.
 ///
-/// CC https://github.com/bodil/im-rs/issues/166
+/// CC <https://github.com/bodil/im-rs/issues/166>
 pub(crate) fn ordmap_union_with_merge<K, V>(
     left: OrdMap<K, V>,
     right: OrdMap<K, V>,
     mut merge: impl FnMut(&K, &V, &V) -> MergeResult<V>,
 ) -> OrdMap<K, V>
 where
     K: Clone + Ord,
@@ -494,7 +494,39 @@
     F: Fn(A) -> Result<Option<B>, E> + 'a,
 {
     iter.filter_map(move |result| match result {
         Ok(node) => f(node).transpose(),
         Err(e) => Some(Err(e)),
     })
 }
+
+/// Force the global rayon threadpool to not exceed 16 concurrent threads
+/// unless the user has specified a value.
+/// This is a stop-gap measure until we figure out why using more than 16
+/// threads makes `status` slower for each additional thread.
+///
+/// TODO find the underlying cause and fix it, then remove this.
+///
+/// # Errors
+///
+/// Returns an error if the global threadpool has already been initialized if
+/// we try to initialize it.
+pub fn cap_default_rayon_threads() -> Result<(), rayon::ThreadPoolBuildError> {
+    const THREAD_CAP: usize = 16;
+
+    if std::env::var("RAYON_NUM_THREADS").is_err() {
+        let available_parallelism = std::thread::available_parallelism()
+            .map(usize::from)
+            .unwrap_or(1);
+        let new_thread_count = THREAD_CAP.min(available_parallelism);
+        let res = rayon::ThreadPoolBuilder::new()
+            .num_threads(new_thread_count)
+            .build_global();
+        if res.is_ok() {
+            log::trace!(
+                "Capped the rayon threadpool to {new_thread_count} threads",
+            );
+        }
+        return res;
+    }
+    Ok(())
+}
```

### Comparing `mercurial-6.4rc0/rust/hg-core/src/vfs.rs` & `mercurial-6.5rc0/rust/hg-core/src/vfs.rs`

 * *Files 3% similar despite different names*

```diff
@@ -189,7 +189,17 @@
     unsafe {
         let mut buf: libc::statfs = mem::zeroed();
         let r = libc::statfs(path.as_ptr(), &mut buf);
 
         r == 0 && buf.f_type as u32 == libc::NFS_SUPER_MAGIC as u32
     }
 }
+
+/// Similar to what Cargo does; although detecting NFS (or non-local
+/// file systems) _should_ be possible on other operating systems,
+/// we'll just assume that mmap() works there, for now; after all,
+/// _some_ functionality is better than a compile error, i.e. none at
+/// all
+#[cfg(not(target_os = "linux"))]
+pub(crate) fn is_on_nfs_mount(_path: impl AsRef<Path>) -> bool {
+    false
+}
```

### Comparing `mercurial-6.4rc0/rust/hg-core/tests/test_missing_ancestors.rs` & `mercurial-6.5rc0/rust/hg-core/tests/test_missing_ancestors.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/ancestors.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/ancestors.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/cindex.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/cindex.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/conversion.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/conversion.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/copy_tracing.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/copy_tracing.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/dagops.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/dagops.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/debug.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/debug.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/dirstate/copymap.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/dirstate/copymap.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/dirstate/dirs_multiset.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/dirstate/dirs_multiset.rs`

 * *Files 13% similar despite different names*

```diff
@@ -13,15 +13,15 @@
 use cpython::{
     exc, ObjectProtocol, PyBytes, PyClone, PyDict, PyErr, PyObject, PyResult,
     Python, UnsafePyLeaked,
 };
 
 use hg::{
     utils::hg_path::{HgPath, HgPathBuf},
-    DirsMultiset, DirsMultisetIter, DirstateMapError,
+    DirsMultiset, DirsMultisetIter,
 };
 
 py_class!(pub class Dirs |py| {
     @shared data inner: DirsMultiset;
 
     // `map` is either a `dict` or a flat iterator (usually a `set`, sometimes
     // a `list`)
@@ -50,47 +50,32 @@
 
         Self::create_instance(py, inner)
     }
 
     def addpath(&self, path: PyObject) -> PyResult<PyObject> {
         self.inner(py).borrow_mut().add_path(
             HgPath::new(path.extract::<PyBytes>(py)?.data(py)),
-        ).and(Ok(py.None())).or_else(|e| {
-            match e {
-                DirstateMapError::EmptyPath => {
-                    Ok(py.None())
-                },
-                e => {
-                    Err(PyErr::new::<exc::ValueError, _>(
+        ).and(Ok(py.None())).map_err(|e| PyErr::new::<exc::ValueError, _>(
                         py,
                         e.to_string(),
-                    ))
-                }
-            }
-        })
+                    )
+        )
     }
 
     def delpath(&self, path: PyObject) -> PyResult<PyObject> {
         self.inner(py).borrow_mut().delete_path(
             HgPath::new(path.extract::<PyBytes>(py)?.data(py)),
         )
             .and(Ok(py.None()))
-            .or_else(|e| {
-                match e {
-                    DirstateMapError::EmptyPath => {
-                        Ok(py.None())
-                    },
-                    e => {
-                        Err(PyErr::new::<exc::ValueError, _>(
+            .map_err(|e|
+                        PyErr::new::<exc::ValueError, _>(
                             py,
                             e.to_string(),
-                        ))
-                    }
-                }
-            })
+                        )
+            )
     }
     def __iter__(&self) -> PyResult<DirsMultisetKeysIterator> {
         let leaked_ref = self.inner(py).leak_immutable();
         DirsMultisetKeysIterator::from_inner(
             py,
             unsafe { leaked_ref.map(py, |o| o.iter()) },
         )
```

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/dirstate/dirstate_map.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/dirstate/dirstate_map.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/dirstate/item.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/dirstate/item.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/dirstate/status.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/dirstate/status.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/dirstate.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/dirstate.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/discovery.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/discovery.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/exceptions.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/exceptions.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/lib.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/lib.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/pybytes_deref.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/pybytes_deref.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/ref_sharing.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/ref_sharing.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/revlog.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/revlog.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hg-cpython/src/utils.rs` & `mercurial-6.5rc0/rust/hg-cpython/src/utils.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hgcli/.cargo/config` & `mercurial-6.5rc0/rust/hgcli/.cargo/config`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hgcli/Cargo.lock` & `mercurial-6.5rc0/rust/hgcli/Cargo.lock`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hgcli/Cargo.toml` & `mercurial-6.5rc0/rust/hgcli/Cargo.toml`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hgcli/README.md` & `mercurial-6.5rc0/rust/hgcli/README.md`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hgcli/build.rs` & `mercurial-6.5rc0/rust/hgcli/build.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hgcli/pyoxidizer.bzl` & `mercurial-6.5rc0/rust/hgcli/pyoxidizer.bzl`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/hgcli/src/main.rs` & `mercurial-6.5rc0/rust/hgcli/src/main.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/rhg/Cargo.toml` & `mercurial-6.5rc0/rust/rhg/Cargo.toml`

 * *Files 5% similar despite different names*

```diff
@@ -16,10 +16,10 @@
 home = "0.5.4"
 lazy_static = "1.4.0"
 log = "0.4.17"
 logging_timer = "1.1.0"
 regex = "1.7.0"
 env_logger = "0.9.3"
 format-bytes = "0.3.0"
-users = "0.11.0"
+whoami = "1.4"
 which = "4.3.0"
-rayon = "1.6.1"
+rayon = "1.7.0"
```

### Comparing `mercurial-6.4rc0/rust/rhg/README.md` & `mercurial-6.5rc0/rust/rhg/README.md`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/rhg/src/blackbox.rs` & `mercurial-6.5rc0/rust/rhg/src/blackbox.rs`

 * *Files 4% similar despite different names*

```diff
@@ -116,16 +116,15 @@
         }
     }
 }
 
 impl ConfiguredBlackbox<'_> {
     fn log(&self, date_time: &DateTime, message: &[u8]) {
         let date = format_bytes::Utf8(date_time.format(self.date_format));
-        let user = users::get_current_username().map(get_bytes_from_os_str);
-        let user = user.as_deref().unwrap_or(b"???");
+        let user = get_bytes_from_os_str(whoami::username_os());
         let rev = format_bytes::Utf8(match self.repo.dirstate_parents() {
             Ok(parents) if parents.p2 == hg::revlog::node::NULL_NODE => {
                 format!("{:x}", parents.p1)
             }
             Ok(parents) => format!("{:x}+{:x}", parents.p1, parents.p2),
             Err(_dirstate_corruption_error) => {
                 // TODO: log a non-fatal warning to stderr
```

### Comparing `mercurial-6.4rc0/rust/rhg/src/color.rs` & `mercurial-6.5rc0/rust/rhg/src/color.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/rhg/src/commands/cat.rs` & `mercurial-6.5rc0/rust/rhg/src/commands/cat.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/rhg/src/commands/config.rs` & `mercurial-6.5rc0/rust/rhg/src/commands/config.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/rhg/src/commands/debugdata.rs` & `mercurial-6.5rc0/rust/rhg/src/commands/debugdata.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/rhg/src/commands/debugignorerhg.rs` & `mercurial-6.5rc0/rust/rhg/src/commands/debugignorerhg.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/rhg/src/commands/debugrequirements.rs` & `mercurial-6.5rc0/rust/rhg/src/commands/debugrequirements.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/rhg/src/commands/debugrhgsparse.rs` & `mercurial-6.5rc0/rust/rhg/src/commands/debugrhgsparse.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/rhg/src/commands/files.rs` & `mercurial-6.5rc0/rust/rhg/src/commands/files.rs`

 * *Files 8% similar despite different names*

```diff
@@ -1,9 +1,11 @@
 use crate::error::CommandError;
-use crate::ui::{print_narrow_sparse_warnings, Ui};
+use crate::ui::{
+    print_narrow_sparse_warnings, relative_paths, RelativePaths, Ui,
+};
 use crate::utils::path_utils::RelativizePaths;
 use clap::Arg;
 use hg::narrow;
 use hg::operations::list_rev_tracked_files;
 use hg::repo::Repo;
 use hg::utils::filter_map_results;
 use hg::utils::hg_path::HgPath;
@@ -24,20 +26,18 @@
                 .long("revision")
                 .value_name("REV"),
         )
         .about(HELP_TEXT)
 }
 
 pub fn run(invocation: &crate::CliInvocation) -> Result<(), CommandError> {
-    let relative = invocation.config.get(b"ui", b"relative-paths");
-    if relative.is_some() {
-        return Err(CommandError::unsupported(
-            "non-default ui.relative-paths",
-        ));
-    }
+    let relative_paths = match relative_paths(invocation.config)? {
+        RelativePaths::Legacy => true,
+        RelativePaths::Bool(v) => v,
+    };
 
     let rev = invocation.subcommand_args.get_one::<String>("rev");
 
     let repo = invocation.repo?;
 
     // It seems better if this check is removed: this would correspond to
     // automatically enabling the extension if the repo requires it.
@@ -53,15 +53,15 @@
 
     let (narrow_matcher, narrow_warnings) = narrow::matcher(repo)?;
     print_narrow_sparse_warnings(&narrow_warnings, &[], invocation.ui, repo)?;
 
     if let Some(rev) = rev {
         let files = list_rev_tracked_files(repo, rev, narrow_matcher)
             .map_err(|e| (e, rev.as_ref()))?;
-        display_files(invocation.ui, repo, files.iter())
+        display_files(invocation.ui, repo, relative_paths, files.iter())
     } else {
         // The dirstate always reflects the sparse narrowspec.
         let dirstate = repo.dirstate_map()?;
         let files_res: Result<Vec<_>, _> =
             filter_map_results(dirstate.iter(), |(path, entry)| {
                 Ok(if entry.tracked() && narrow_matcher.matches(path) {
                     Some(path)
@@ -73,34 +73,40 @@
 
         let mut files = files_res?;
         files.par_sort_unstable();
 
         display_files(
             invocation.ui,
             repo,
+            relative_paths,
             files.into_iter().map::<Result<_, CommandError>, _>(Ok),
         )
     }
 }
 
 fn display_files<'a, E>(
     ui: &Ui,
     repo: &Repo,
+    relative_paths: bool,
     files: impl IntoIterator<Item = Result<&'a HgPath, E>>,
 ) -> Result<(), CommandError>
 where
     CommandError: From<E>,
 {
     let mut stdout = ui.stdout_buffer();
     let mut any = false;
 
     let relativize = RelativizePaths::new(repo)?;
     for result in files {
         let path = result?;
-        stdout.write_all(&relativize.relativize(path))?;
+        if relative_paths {
+            stdout.write_all(&relativize.relativize(path))?;
+        } else {
+            stdout.write_all(path.as_bytes())?;
+        }
         stdout.write_all(b"\n")?;
         any = true;
     }
 
     stdout.flush()?;
     if any {
         Ok(())
```

### Comparing `mercurial-6.4rc0/rust/rhg/src/commands/root.rs` & `mercurial-6.5rc0/rust/rhg/src/commands/root.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/rhg/src/commands/status.rs` & `mercurial-6.5rc0/rust/rhg/src/commands/status.rs`

 * *Files 1% similar despite different names*

```diff
@@ -107,14 +107,21 @@
             Arg::new("copies")
                 .help("show source of copied files (DEFAULT: ui.statuscopies)")
                 .short('C')
                 .action(clap::ArgAction::SetTrue)
                 .long("copies"),
         )
         .arg(
+            Arg::new("print0")
+                .help("end filenames with NUL, for use with xargs")
+                .short('0')
+                .action(clap::ArgAction::SetTrue)
+                .long("print0"),
+        )
+        .arg(
             Arg::new("no-status")
                 .help("hide status prefix")
                 .short('n')
                 .action(clap::ArgAction::SetTrue)
                 .long("no-status"),
         )
         .arg(
@@ -209,18 +216,19 @@
         ));
     }
 
     let ui = invocation.ui;
     let config = invocation.config;
     let args = invocation.subcommand_args;
 
-    // TODO add `!args.get_flag("print0") &&` when we support `print0`
+    let print0 = args.get_flag("print0");
     let verbose = args.get_flag("verbose")
         || config.get_bool(b"ui", b"verbose")?
         || config.get_bool(b"commands", b"status.verbose")?;
+    let verbose = verbose && !print0;
 
     let all = args.get_flag("all");
     let display_states = if all {
         // TODO when implementing `--quiet`: it excludes clean files
         // from `--all`
         ALL_DISPLAY_STATES
     } else {
@@ -359,14 +367,15 @@
             ui,
             no_status,
             relativize: if relative_paths {
                 Some(RelativizePaths::new(repo)?)
             } else {
                 None
             },
+            print0,
         };
         if display_states.modified {
             output.display(b"M ", "status.modified", ds_status.modified)?;
         }
         if display_states.added {
             output.display(b"A ", "status.added", ds_status.added)?;
         }
@@ -523,14 +532,15 @@
     ignore_files
 }
 
 struct DisplayStatusPaths<'a> {
     ui: &'a Ui,
     no_status: bool,
     relativize: Option<RelativizePaths>,
+    print0: bool,
 }
 
 impl DisplayStatusPaths<'_> {
     // Probably more elegant to use a Deref or Borrow trait rather than
     // harcode HgPathBuf, but probably not really useful at this point
     fn display(
         &self,
@@ -538,33 +548,41 @@
         label: &'static str,
         mut paths: Vec<StatusPath<'_>>,
     ) -> Result<(), CommandError> {
         paths.sort_unstable();
         // TODO: get the stdout lock once for the whole loop
         // instead of in each write
         for StatusPath { path, copy_source } in paths {
-            let relative;
-            let path = if let Some(relativize) = &self.relativize {
-                relative = relativize.relativize(&path);
-                &*relative
+            let relative_path;
+            let relative_source;
+            let (path, copy_source) = if let Some(relativize) =
+                &self.relativize
+            {
+                relative_path = relativize.relativize(&path);
+                relative_source =
+                    copy_source.as_ref().map(|s| relativize.relativize(s));
+                (&*relative_path, relative_source.as_deref())
             } else {
-                path.as_bytes()
+                (path.as_bytes(), copy_source.as_ref().map(|s| s.as_bytes()))
             };
             // TODO: Add a way to use `write_bytes!` instead of `format_bytes!`
             // in order to stream to stdout instead of allocating an
             // itermediate `Vec<u8>`.
             if !self.no_status {
                 self.ui.write_stdout_labelled(status_prefix, label)?
             }
-            self.ui
-                .write_stdout_labelled(&format_bytes!(b"{}\n", path), label)?;
-            if let Some(source) = copy_source {
+            let linebreak = if self.print0 { b"\x00" } else { b"\n" };
+            self.ui.write_stdout_labelled(
+                &format_bytes!(b"{}{}", path, linebreak),
+                label,
+            )?;
+            if let Some(source) = copy_source.filter(|_| !self.no_status) {
                 let label = "status.copied";
                 self.ui.write_stdout_labelled(
-                    &format_bytes!(b"  {}\n", source.as_bytes()),
+                    &format_bytes!(b"  {}{}", source, linebreak),
                     label,
                 )?
             }
         }
         Ok(())
     }
 }
```

### Comparing `mercurial-6.4rc0/rust/rhg/src/error.rs` & `mercurial-6.5rc0/rust/rhg/src/error.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/rust/rhg/src/main.rs` & `mercurial-6.5rc0/rust/rhg/src/main.rs`

 * *Files 1% similar despite different names*

```diff
@@ -136,14 +136,21 @@
     // Run this first, before we find out if the blackbox extension is even
     // enabled, in order to include everything in-between in the duration
     // measurements. Reading config files can be slow if they’re on NFS.
     let process_start_time = blackbox::ProcessStartTime::now();
 
     env_logger::init();
 
+    // Make sure nothing in a future version of `rhg` sets the global
+    // threadpool before we can cap default threads. (This is also called
+    // in core because Python uses the same code path, we're adding a
+    // redundant check.)
+    hg::utils::cap_default_rayon_threads()
+        .expect("Rayon threadpool already initialized");
+
     let early_args = EarlyArgs::parse(&argv);
 
     let initial_current_dir = early_args.cwd.map(|cwd| {
         let cwd = get_path_from_bytes(&cwd);
         std::env::current_dir()
             .and_then(|initial| {
                 std::env::set_current_dir(cwd)?;
```

### Comparing `mercurial-6.4rc0/rust/rhg/src/ui.rs` & `mercurial-6.5rc0/rust/rhg/src/ui.rs`

 * *Files 3% similar despite different names*

```diff
@@ -217,14 +217,26 @@
     if let Some(formatted) = config.get_option(b"ui", b"formatted")? {
         Ok(formatted)
     } else {
         isatty(config)
     }
 }
 
+pub enum RelativePaths {
+    Legacy,
+    Bool(bool),
+}
+
+pub fn relative_paths(config: &Config) -> Result<RelativePaths, HgError> {
+    Ok(match config.get(b"ui", b"relative-paths") {
+        None | Some(b"legacy") => RelativePaths::Legacy,
+        _ => RelativePaths::Bool(config.get_bool(b"ui", b"relative-paths")?),
+    })
+}
+
 fn isatty(config: &Config) -> Result<bool, HgError> {
     Ok(if config.get_bool(b"ui", b"nontty")? {
         false
     } else {
         atty::is(atty::Stream::Stdout)
     })
 }
```

### Comparing `mercurial-6.4rc0/rust/rhg/src/utils/path_utils.rs` & `mercurial-6.5rc0/rust/rhg/src/utils/path_utils.rs`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/setup.py` & `mercurial-6.5rc0/setup.py`

 * *Files 0% similar despite different names*

```diff
@@ -1295,14 +1295,15 @@
     'mercurial.defaultrc',
     'mercurial.dirstateutils',
     'mercurial.helptext',
     'mercurial.helptext.internals',
     'mercurial.hgweb',
     'mercurial.interfaces',
     'mercurial.pure',
+    'mercurial.stabletailgraph',
     'mercurial.templates',
     'mercurial.thirdparty',
     'mercurial.thirdparty.attr',
     'mercurial.thirdparty.zope',
     'mercurial.thirdparty.zope.interface',
     'mercurial.upgrade_utils',
     'mercurial.utils',
```

### Comparing `mercurial-6.4rc0/tests/.balto.toml` & `mercurial-6.5rc0/tests/.balto.toml`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/artifacts/scripts/generate-churning-bundle.py` & `mercurial-6.5rc0/tests/artifacts/scripts/generate-churning-bundle.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/autodiff.py` & `mercurial-6.5rc0/tests/autodiff.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/basic_test_result.py` & `mercurial-6.5rc0/tests/basic_test_result.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/binfile.bin` & `mercurial-6.5rc0/tests/binfile.bin`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/blackbox-readonly-dispatch.py` & `mercurial-6.5rc0/tests/blackbox-readonly-dispatch.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/blacklists/README` & `mercurial-6.5rc0/tests/blacklists/README`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/blacklists/fsmonitor` & `mercurial-6.5rc0/tests/blacklists/fsmonitor`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bruterebase.py` & `mercurial-6.5rc0/tests/bruterebase.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/darcs1.hg` & `mercurial-6.5rc0/tests/bundles/darcs1.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/hgweb+obs.hg` & `mercurial-6.5rc0/tests/bundles/hgweb+obs.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/issue4041.hg` & `mercurial-6.5rc0/tests/bundles/issue4041.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/issue4438-r1.hg` & `mercurial-6.5rc0/tests/bundles/issue4438-r1.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/issue4438-r2.hg` & `mercurial-6.5rc0/tests/bundles/issue4438-r2.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/issue6528.hg-v1` & `mercurial-6.5rc0/tests/bundles/issue6528.hg-v1`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/issue6528.hg-v2` & `mercurial-6.5rc0/tests/bundles/issue6528.hg-v2`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/issue6528.tar` & `mercurial-6.5rc0/tests/bundles/issue6528.tar`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/legacy-encoding.hg` & `mercurial-6.5rc0/tests/bundles/legacy-encoding.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/rebase-revset.hg` & `mercurial-6.5rc0/tests/bundles/rebase-revset.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/rebase.hg` & `mercurial-6.5rc0/tests/bundles/rebase.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/remote.hg` & `mercurial-6.5rc0/tests/bundles/remote.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/remote.sh` & `mercurial-6.5rc0/tests/bundles/remote.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/renames.hg` & `mercurial-6.5rc0/tests/bundles/renames.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/tampered.hg` & `mercurial-6.5rc0/tests/bundles/tampered.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/test-invalid-branch-name.hg` & `mercurial-6.5rc0/tests/bundles/test-invalid-branch-name.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/test-manifest.hg` & `mercurial-6.5rc0/tests/bundles/test-manifest.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/test-merge-symlinks.hg` & `mercurial-6.5rc0/tests/bundles/test-merge-symlinks.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/test-no-symlinks.hg` & `mercurial-6.5rc0/tests/bundles/test-no-symlinks.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/test-revlog-diff-relative-to-nullrev.sh` & `mercurial-6.5rc0/tests/bundles/test-revlog-diff-relative-to-nullrev.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/bundles/test-revlog-diff-relative-to-nullrev.tar` & `mercurial-6.5rc0/tests/bundles/test-revlog-diff-relative-to-nullrev.tar`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/cgienv` & `mercurial-6.5rc0/tests/cgienv`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/check-perf-code.py` & `mercurial-6.5rc0/tests/check-perf-code.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/common-pattern.py` & `mercurial-6.5rc0/tests/common-pattern.py`

 * *Files 3% similar despite different names*

```diff
@@ -6,15 +6,15 @@
     # list of possible compressions
     (br'(zstd,)?zlib,none,bzip2', br'$USUAL_COMPRESSIONS$'),
     (br'=(zstd,)?zlib', br'=$BUNDLE2_COMPRESSIONS$'),
     # capabilities sent through http
     (
         br'bundlecaps=HG20%2Cbundle2%3DHG20%250A'
         br'bookmarks%250A'
-        br'changegroup%253D01%252C02%250A'
+        br'changegroup%253D01%252C02%252C03%250A'
         br'checkheads%253Drelated%250A'
         br'digests%253Dmd5%252Csha1%252Csha512%250A'
         br'error%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250A'
         br'hgtagsfnodes%250A'
         br'listkeys%250A'
         br'phases%253Dheads%250A'
         br'pushkey%250A'
@@ -22,15 +22,15 @@
         br'stream%253Dv2',
         # (the replacement patterns)
         br'$USUAL_BUNDLE_CAPS$',
     ),
     (
         br'bundlecaps=HG20%2Cbundle2%3DHG20%250A'
         br'bookmarks%250A'
-        br'changegroup%253D01%252C02%250A'
+        br'changegroup%253D01%252C02%252C03%250A'
         br'checkheads%3Drelated%0A'
         br'digests%253Dmd5%252Csha1%252Csha512%250A'
         br'error%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250A'
         br'hgtagsfnodes%250A'
         br'listkeys%250A'
         br'phases%253Dheads%250A'
         br'pushkey%250A'
@@ -38,15 +38,15 @@
         # (the replacement patterns)
         br'$USUAL_BUNDLE_CAPS_SERVER$',
     ),
     # bundle2 capabilities sent through ssh
     (
         br'bundle2=HG20%0A'
         br'bookmarks%0A'
-        br'changegroup%3D01%2C02%0A'
+        br'changegroup%3D01%2C02%2C03%0A'
         br'checkheads%3Drelated%0A'
         br'digests%3Dmd5%2Csha1%2Csha512%0A'
         br'error%3Dabort%2Cunsupportedcontent%2Cpushraced%2Cpushkey%0A'
         br'hgtagsfnodes%0A'
         br'listkeys%0A'
         br'phases%3Dheads%0A'
         br'pushkey%0A'
@@ -55,30 +55,30 @@
         # (replacement patterns)
         br'$USUAL_BUNDLE2_CAPS$',
     ),
     # bundle2 capabilities advertised by the server
     (
         br'bundle2=HG20%0A'
         br'bookmarks%0A'
-        br'changegroup%3D01%2C02%0A'
+        br'changegroup%3D01%2C02%2C03%0A'
         br'checkheads%3Drelated%0A'
         br'digests%3Dmd5%2Csha1%2Csha512%0A'
         br'error%3Dabort%2Cunsupportedcontent%2Cpushraced%2Cpushkey%0A'
         br'hgtagsfnodes%0A'
         br'listkeys%0A'
         br'phases%3Dheads%0A'
         br'pushkey%0A'
         br'remote-changegroup%3Dhttp%2Chttps',
         # (replacement patterns)
         br'$USUAL_BUNDLE2_CAPS_SERVER$',
     ),
     (
         br'bundle2=HG20%0A'
         br'bookmarks%0A'
-        br'changegroup%3D01%2C02%0A'
+        br'changegroup%3D01%2C02%2C03%0A'
         br'digests%3Dmd5%2Csha1%2Csha512%0A'
         br'error%3Dabort%2Cunsupportedcontent%2Cpushraced%2Cpushkey%0A'
         br'hgtagsfnodes%0A'
         br'listkeys%0A'
         br'pushkey%0A'
         br'remote-changegroup%3Dhttp%2Chttps%0A'
         br'stream%3Dv2',
@@ -118,28 +118,38 @@
     (
         br'transferred (\S+?) KB in \S+? seconds \(.+?/sec\)(?: \(glob\))?(.*)',
         lambda m: (
             br'transferred %s KB in * seconds (* */sec) (glob)%s'
             % (m.group(1), m.group(2))
         ),
     ),
+    # `discovery debug output
+    (
+        br'\b(\d+) total queries in \d.\d\d\d\ds\b',
+        lambda m: (br'%s total queries in *.????s (glob)' % m.group(1)),
+    ),
 ]
 
 # Various platform error strings, keyed on a common replacement string
 _errors = {
     br'$ENOENT$': (
         # IOError in Python does not have the same error message
         # than in Rust, and automatic conversion is not possible
         # because of module member privacy.
         br'No such file or directory \(os error 2\)',
         # strerror()
         br'No such file or directory',
         # FormatMessage(ERROR_FILE_NOT_FOUND)
         br'The system cannot find the file specified',
     ),
+    br'$EACCES$': (
+        br'Permission denied \(os error 13\)',
+        # strerror
+        br'Permission denied',
+    ),
     br'$ENOTDIR$': (
         # strerror()
         br'Not a directory',
         # FormatMessage(ERROR_PATH_NOT_FOUND)
         br'The system cannot find the path specified',
     ),
     br'$ECONNRESET$': (
```

### Comparing `mercurial-6.4rc0/tests/drawdag.py` & `mercurial-6.5rc0/tests/drawdag.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/dumbhttp.py` & `mercurial-6.5rc0/tests/dumbhttp.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/dummysmtpd.py` & `mercurial-6.5rc0/tests/dummysmtpd.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/dummyssh` & `mercurial-6.5rc0/tests/dummyssh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/f` & `mercurial-6.5rc0/tests/f`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/fakedirstatewritetime.py` & `mercurial-6.5rc0/tests/fakedirstatewritetime.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/fakemergerecord.py` & `mercurial-6.5rc0/tests/fakemergerecord.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/fakepatchtime.py` & `mercurial-6.5rc0/tests/fakepatchtime.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/filterpyflakes.py` & `mercurial-6.5rc0/tests/filterpyflakes.py`

 * *Files 9% similar despite different names*

```diff
@@ -20,17 +20,16 @@
     keep = True
     for pat in pats:
         if re.search(pat, line):
             keep = False
             break  # pattern matches
     if keep:
         fn = line.split(':', 1)[0]
-        f = open(fn)
-        data = f.read()
-        f.close()
-        if 'no-' 'check-code' in data:
+        with open(fn, 'rb') as f:
+            data = f.read()
+        if b'no-' b'check-code' in data:
             continue
         lines.append(line)
 
 for line in lines:
     sys.stdout.write(line)
 print()
```

### Comparing `mercurial-6.4rc0/tests/filtertraceback.py` & `mercurial-6.5rc0/tests/filtertraceback.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/flagprocessorext.py` & `mercurial-6.5rc0/tests/flagprocessorext.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/fsmonitor-run-tests.py` & `mercurial-6.5rc0/tests/fsmonitor-run-tests.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/generate-working-copy-states.py` & `mercurial-6.5rc0/tests/generate-working-copy-states.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/get-with-headers.py` & `mercurial-6.5rc0/tests/get-with-headers.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/gpg/pubring.gpg` & `mercurial-6.5rc0/tests/gpg/pubring.gpg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/gpg/secring.gpg` & `mercurial-6.5rc0/tests/gpg/secring.gpg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/gpg/trustdb.gpg` & `mercurial-6.5rc0/tests/gpg/trustdb.gpg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/helpers-testrepo.sh` & `mercurial-6.5rc0/tests/helpers-testrepo.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/heredoctest.py` & `mercurial-6.5rc0/tests/heredoctest.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/hghave` & `mercurial-6.5rc0/tests/hghave`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/hghave.py` & `mercurial-6.5rc0/tests/hghave.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/hgterm.ti` & `mercurial-6.5rc0/tests/hgterm.ti`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/hgweberror.py` & `mercurial-6.5rc0/tests/hgweberror.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/httpserverauth.py` & `mercurial-6.5rc0/tests/httpserverauth.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/hypothesishelpers.py` & `mercurial-6.5rc0/tests/hypothesishelpers.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/killdaemons.py` & `mercurial-6.5rc0/tests/killdaemons.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/library-infinitepush.sh` & `mercurial-6.5rc0/tests/library-infinitepush.sh`

 * *Files 10% similar despite different names*

```diff
@@ -12,14 +12,17 @@
 
 setupcommon() {
   cat >> $HGRCPATH << EOF
 [extensions]
 infinitepush=
 [infinitepush]
 branchpattern=re:scratch/.*
+deprecation-abort=no
+deprecation-message=yes
+
 EOF
 }
 
 setupserver() {
 cat >> .hg/hgrc << EOF
 [infinitepush]
 server=yes
```

### Comparing `mercurial-6.4rc0/tests/list-tree.py` & `mercurial-6.5rc0/tests/list-tree.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/lockdelay.py` & `mercurial-6.5rc0/tests/lockdelay.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/logexceptions.py` & `mercurial-6.5rc0/tests/logexceptions.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/ls-l.py` & `mercurial-6.5rc0/tests/ls-l.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/md5sum.py` & `mercurial-6.5rc0/tests/md5sum.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/missing-comment.hg` & `mercurial-6.5rc0/tests/missing-comment.hg`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/notcapable` & `mercurial-6.5rc0/tests/notcapable`

 * *Files 20% similar despite different names*

```diff
@@ -11,15 +11,15 @@
 def extsetup(ui):
     extensions.wrapfunction(repository.peer, 'capable', wrapcapable)
     extensions.wrapfunction(localrepo.localrepository, 'peer', wrappeer)
 def wrapcapable(orig, self, name, *args, **kwargs):
     if name in b'$CAP'.split(b' '):
         return False
     return orig(self, name, *args, **kwargs)
-def wrappeer(orig, self, path=None):
+def wrappeer(orig, self, *args, **kwargs):
     # Since we're disabling some newer features, we need to make sure local
     # repos add in the legacy features again.
-    return localrepo.locallegacypeer(self, path=path)
+    return localrepo.locallegacypeer(self, *args, **kwargs)
 EOF
 
 echo '[extensions]' >> $HGRCPATH
 echo "notcapable-$CAP = `pwd`/notcapable-$CAP.py" >> $HGRCPATH
```

### Comparing `mercurial-6.4rc0/tests/pdiff` & `mercurial-6.5rc0/tests/pdiff`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/accept-4564.json` & `mercurial-6.5rc0/tests/phabricator/accept-4564.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/accept-7913.json` & `mercurial-6.5rc0/tests/phabricator/accept-7913.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phab-conduit.json` & `mercurial-6.5rc0/tests/phabricator/phab-conduit.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabimport-multi-drev.json` & `mercurial-6.5rc0/tests/phabricator/phabimport-multi-drev.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabimport-stack.json` & `mercurial-6.5rc0/tests/phabricator/phabimport-stack.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabread-4480.json` & `mercurial-6.5rc0/tests/phabricator/phabread-4480.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabread-conduit-error.json` & `mercurial-6.5rc0/tests/phabricator/phabread-conduit-error.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabread-empty-drev.json` & `mercurial-6.5rc0/tests/phabricator/phabread-empty-drev.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabread-multi-drev.json` & `mercurial-6.5rc0/tests/phabricator/phabread-multi-drev.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabread-str-time.json` & `mercurial-6.5rc0/tests/phabricator/phabread-str-time.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-add-parent-setup.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-add-parent-setup.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-add-parent.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-add-parent.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-binary-renames.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-binary-renames.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-binary.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-binary.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-comment-created.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-comment-created.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-comment-updated.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-comment-updated.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-create-alpha.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-create-alpha.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-create-public.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-create-public.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-fold-extend-end.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-fold-extend-end.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-fold-extend-front.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-fold-extend-front.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-fold-fold-end.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-fold-fold-end.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-fold-immutable.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-fold-immutable.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-fold-initial.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-fold-initial.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-fold-no-changes.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-fold-no-changes.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-fold-split-end.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-fold-split-end.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-fold-updated.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-fold-updated.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-hash-fixes.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-hash-fixes.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-no-restack-orphan.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-no-restack-orphan.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-skipped.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-skipped.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabsend-update-alpha-create-beta.json` & `mercurial-6.5rc0/tests/phabricator/phabsend-update-alpha-create-beta.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabupdate-change-6876.json` & `mercurial-6.5rc0/tests/phabricator/phabupdate-change-6876.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/phabricator/phabupdate-revs.json` & `mercurial-6.5rc0/tests/phabricator/phabupdate-revs.json`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/printenv.py` & `mercurial-6.5rc0/tests/printenv.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/printrevset.py` & `mercurial-6.5rc0/tests/printrevset.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/pullext.py` & `mercurial-6.5rc0/tests/pullext.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/remotefilelog-getflogheads.py` & `mercurial-6.5rc0/tests/remotefilelog-getflogheads.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/remotefilelog-library.sh` & `mercurial-6.5rc0/tests/remotefilelog-library.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/revlog-formatv0.py` & `mercurial-6.5rc0/tests/revlog-formatv0.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/revnamesext.py` & `mercurial-6.5rc0/tests/revnamesext.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/run-tests.py` & `mercurial-6.5rc0/tests/run-tests.py`

 * *Files 0% similar despite different names*

```diff
@@ -68,20 +68,14 @@
 import tempfile
 import threading
 import time
 import unittest
 import uuid
 import xml.dom.minidom as minidom
 
-try:
-    # PEP 632 recommend the use of `packaging.version` to replace the
-    # deprecated `distutil.version`. So lets do it.
-    import packaging.version as version
-except ImportError:
-    import distutils.version as version
 
 if sys.version_info < (3, 5, 0):
     print(
         '%s is only supported on Python 3.5+, not %s'
         % (sys.argv[0], '.'.join(str(v) for v in sys.version_info[:3]))
     )
     sys.exit(70)  # EX_SOFTWARE from `man 3 sysexit`
@@ -795,17 +789,15 @@
         )
 
     options.anycoverage = options.cover or options.annotate or options.htmlcov
     if options.anycoverage:
         try:
             import coverage
 
-            covver = version.StrictVersion(coverage.__version__).version
-            if covver < (3, 3):
-                parser.error('coverage options require coverage 3.3 or later')
+            coverage.__version__  # silence unused import warning
         except ImportError:
             parser.error('coverage options now require the coverage package')
 
     if options.anycoverage and options.local:
         # this needs some path mangling somewhere, I guess
         parser.error(
             "sorry, coverage options do not work when --local " "is specified"
```

### Comparing `mercurial-6.4rc0/tests/seq.py` & `mercurial-6.5rc0/tests/seq.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/silenttestrunner.py` & `mercurial-6.5rc0/tests/silenttestrunner.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/simplestorerepo.py` & `mercurial-6.5rc0/tests/simplestorerepo.py`

 * *Files 0% similar despite different names*

```diff
@@ -660,16 +660,16 @@
         return False
 
     # Otherwise assume it belongs to the simple store.
     return True
 
 
 class simplestore(store.encodedstore):
-    def datafiles(self, undecodable=None):
-        for x in super(simplestore, self).datafiles():
+    def data_entries(self, undecodable=None):
+        for x in super(simplestore, self).data_entries():
             yield x
 
         # Supplement with non-revlog files.
         extrafiles = self._walk('data', True, filefilter=issimplestorefile)
 
         for f1, size in extrafiles:
             try:
```

### Comparing `mercurial-6.4rc0/tests/sshprotoext.py` & `mercurial-6.5rc0/tests/sshprotoext.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/sslcerts/README` & `mercurial-6.5rc0/tests/sslcerts/README`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/sslcerts/client-cert.pem` & `mercurial-6.5rc0/tests/sslcerts/client-cert.pem`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/sslcerts/client-key-decrypted.pem` & `mercurial-6.5rc0/tests/sslcerts/client-key-decrypted.pem`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/sslcerts/client-key.pem` & `mercurial-6.5rc0/tests/sslcerts/client-key.pem`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/sslcerts/priv.pem` & `mercurial-6.5rc0/tests/sslcerts/priv.pem`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/sslcerts/pub-expired.pem` & `mercurial-6.5rc0/tests/sslcerts/pub-expired.pem`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/sslcerts/pub-not-yet.pem` & `mercurial-6.5rc0/tests/sslcerts/pub-not-yet.pem`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/sslcerts/pub-other.pem` & `mercurial-6.5rc0/tests/sslcerts/pub-other.pem`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/sslcerts/pub.pem` & `mercurial-6.5rc0/tests/sslcerts/pub.pem`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/branches.svndump` & `mercurial-6.5rc0/tests/svn/branches.svndump`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/empty.svndump` & `mercurial-6.5rc0/tests/svn/empty.svndump`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/encoding.svndump` & `mercurial-6.5rc0/tests/svn/encoding.svndump`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/move.svndump` & `mercurial-6.5rc0/tests/svn/move.svndump`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/replace.svndump` & `mercurial-6.5rc0/tests/svn/replace.svndump`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/startrev.svndump` & `mercurial-6.5rc0/tests/svn/startrev.svndump`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/svndump-branches.sh` & `mercurial-6.5rc0/tests/svn/svndump-branches.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/svndump-empty.sh` & `mercurial-6.5rc0/tests/svn/svndump-empty.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/svndump-encoding.sh` & `mercurial-6.5rc0/tests/svn/svndump-encoding.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/svndump-move.sh` & `mercurial-6.5rc0/tests/svn/svndump-move.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/svndump-replace.sh` & `mercurial-6.5rc0/tests/svn/svndump-replace.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/svndump-startrev.sh` & `mercurial-6.5rc0/tests/svn/svndump-startrev.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/svndump-tags.sh` & `mercurial-6.5rc0/tests/svn/svndump-tags.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn/tags.svndump` & `mercurial-6.5rc0/tests/svn/tags.svndump`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svn-safe-append.py` & `mercurial-6.5rc0/tests/svn-safe-append.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/svnxml.py` & `mercurial-6.5rc0/tests/svnxml.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-abort-checkin.t` & `mercurial-6.5rc0/tests/test-abort-checkin.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-absorb-edit-lines.t` & `mercurial-6.5rc0/tests/test-absorb-edit-lines.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-absorb-filefixupstate.py` & `mercurial-6.5rc0/tests/test-absorb-filefixupstate.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-absorb-rename.t` & `mercurial-6.5rc0/tests/test-absorb-rename.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-absorb-strip.t` & `mercurial-6.5rc0/tests/test-absorb-strip.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-absorb-unfinished.t` & `mercurial-6.5rc0/tests/test-absorb-unfinished.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-absorb.t` & `mercurial-6.5rc0/tests/test-absorb.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-acl.t` & `mercurial-6.5rc0/tests/test-acl.t`

 * *Files 0% similar despite different names*

```diff
@@ -105,15 +105,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -171,15 +171,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -241,15 +241,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -321,15 +321,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -392,15 +392,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -467,15 +467,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -539,15 +539,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -616,15 +616,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -690,15 +690,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -763,15 +763,15 @@
   listing keys for "bookmarks"
   invalid branch cache (served): tip differs
   listing keys for "bookmarks"
   1 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   bundle2-output-bundle: "HG20", 7 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:bookmarks" 37 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-output-part: "bookmarks" 37 bytes payload
   bundle2-input-bundle: with-transaction
@@ -852,15 +852,15 @@
   listing keys for "bookmarks"
   invalid branch cache (served): tip differs
   listing keys for "bookmarks"
   1 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   bundle2-output-bundle: "HG20", 7 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:bookmarks" 37 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-output-part: "bookmarks" 37 bytes payload
   bundle2-input-bundle: with-transaction
@@ -943,15 +943,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -1029,15 +1029,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -1113,15 +1113,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -1191,15 +1191,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -1280,15 +1280,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -1370,15 +1370,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -1457,15 +1457,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -1540,15 +1540,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -1627,15 +1627,15 @@
   listing keys for "bookmarks"
   3 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -1750,15 +1750,15 @@
   4 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   e8fc755d4d8217ee5b0c2bb41558c40d43b92c01
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 48 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 48 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -1837,15 +1837,15 @@
   4 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   e8fc755d4d8217ee5b0c2bb41558c40d43b92c01
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 48 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 48 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -1915,15 +1915,15 @@
   4 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   e8fc755d4d8217ee5b0c2bb41558c40d43b92c01
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 48 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 48 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -1989,15 +1989,15 @@
   4 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   e8fc755d4d8217ee5b0c2bb41558c40d43b92c01
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 48 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 48 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -2057,15 +2057,15 @@
   4 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   e8fc755d4d8217ee5b0c2bb41558c40d43b92c01
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 48 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 48 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -2149,15 +2149,15 @@
   4 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   e8fc755d4d8217ee5b0c2bb41558c40d43b92c01
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 48 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 48 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -2240,15 +2240,15 @@
   4 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   e8fc755d4d8217ee5b0c2bb41558c40d43b92c01
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 48 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 48 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -2313,15 +2313,15 @@
   4 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   e8fc755d4d8217ee5b0c2bb41558c40d43b92c01
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 48 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 48 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
@@ -2398,15 +2398,15 @@
   4 changesets found
   list of changesets:
   ef1ea85a6374b77d6da9dcda9541f498f2d17df7
   f9cafe1212c8c6fa1120d14a556e18cc44ff8bdd
   911600dab2ae7a9baff75958b84fe606851ce955
   e8fc755d4d8217ee5b0c2bb41558c40d43b92c01
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 48 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 48 bytes payload
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "replycaps" supported
   bundle2-input-part: total payload size * (glob)
```

### Comparing `mercurial-6.4rc0/tests/test-add.t` & `mercurial-6.5rc0/tests/test-add.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-addremove-similar.t` & `mercurial-6.5rc0/tests/test-addremove-similar.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-addremove.t` & `mercurial-6.5rc0/tests/test-addremove.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-alias.t` & `mercurial-6.5rc0/tests/test-alias.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-amend-subrepo.t` & `mercurial-6.5rc0/tests/test-amend-subrepo.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-amend.t` & `mercurial-6.5rc0/tests/test-amend.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-ancestor.py` & `mercurial-6.5rc0/tests/test-ancestor.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-ancestor.py.out` & `mercurial-6.5rc0/tests/test-ancestor.py.out`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-annotate.py` & `mercurial-6.5rc0/tests/test-annotate.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-annotate.t` & `mercurial-6.5rc0/tests/test-annotate.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-arbitraryfilectx.t` & `mercurial-6.5rc0/tests/test-arbitraryfilectx.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-archive-symlinks.t` & `mercurial-6.5rc0/tests/test-archive-symlinks.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-archive.t` & `mercurial-6.5rc0/tests/test-archive.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-atomictempfile.py` & `mercurial-6.5rc0/tests/test-atomictempfile.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-audit-path.t` & `mercurial-6.5rc0/tests/test-audit-path.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-audit-subrepo.t` & `mercurial-6.5rc0/tests/test-audit-subrepo.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-automv.t` & `mercurial-6.5rc0/tests/test-automv.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-backout.t` & `mercurial-6.5rc0/tests/test-backout.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bad-extension.t` & `mercurial-6.5rc0/tests/test-bad-extension.t`

 * *Files 18% similar despite different names*

```diff
@@ -59,22 +59,19 @@
 
   $ hg -q help help --traceback 2>&1 | egrep ' extension|^Exception|Traceback|ImportError|ModuleNotFound'
   *** failed to import extension "badext" from $TESTTMP/badext.py: bit bucket overflow
   Traceback (most recent call last):
   Exception: bit bucket overflow
   *** failed to import extension "badext2": No module named 'badext2'
   Traceback (most recent call last):
-  ImportError: No module named 'hgext.badext2' (no-py36 !)
-  ModuleNotFoundError: No module named 'hgext.badext2' (py36 !)
+  ModuleNotFoundError: No module named 'hgext.badext2'
   Traceback (most recent call last):
-  ImportError: No module named 'hgext3rd.badext2' (no-py36 !)
-  ModuleNotFoundError: No module named 'hgext3rd.badext2' (py36 !)
+  ModuleNotFoundError: No module named 'hgext3rd.badext2'
   Traceback (most recent call last):
-  ImportError: No module named 'badext2' (no-py36 !)
-  ModuleNotFoundError: No module named 'badext2' (py36 !)
+  ModuleNotFoundError: No module named 'badext2'
 
 names of extensions failed to load can be accessed via extensions.notloaded()
 
   $ cat <<EOF > showbadexts.py
   > from mercurial import commands, extensions, registrar
   > cmdtable = {}
   > command = registrar.command(cmdtable)
@@ -107,33 +104,27 @@
   YYYY/MM/DD HH:MM:SS (PID)>   > baddocext extension loaded in * (glob)
   YYYY/MM/DD HH:MM:SS (PID)>     - validating extension tables: baddocext
   YYYY/MM/DD HH:MM:SS (PID)>     - invoking registered callbacks: baddocext
   YYYY/MM/DD HH:MM:SS (PID)>     > callbacks completed in * (glob)
   YYYY/MM/DD HH:MM:SS (PID)>   - loading extension: badext2
   YYYY/MM/DD HH:MM:SS (PID)>     - could not import hgext.badext2 (No module named *badext2*): trying hgext3rd.badext2 (glob)
   Traceback (most recent call last):
-  ImportError: No module named 'hgext.badext2' (no-py36 !)
-  ModuleNotFoundError: No module named 'hgext.badext2' (py36 !)
+  ModuleNotFoundError: No module named 'hgext.badext2'
   YYYY/MM/DD HH:MM:SS (PID)>     - could not import hgext3rd.badext2 (No module named *badext2*): trying badext2 (glob)
   Traceback (most recent call last):
-  ImportError: No module named 'hgext.badext2' (no-py36 !)
-  ModuleNotFoundError: No module named 'hgext.badext2' (py36 !)
+  ModuleNotFoundError: No module named 'hgext.badext2'
   Traceback (most recent call last):
-  ImportError: No module named 'hgext3rd.badext2' (no-py36 !)
-  ModuleNotFoundError: No module named 'hgext3rd.badext2' (py36 !)
+  ModuleNotFoundError: No module named 'hgext3rd.badext2'
   *** failed to import extension "badext2": No module named 'badext2'
   Traceback (most recent call last):
-  ImportError: No module named 'hgext.badext2' (no-py36 !)
-  ModuleNotFoundError: No module named 'hgext.badext2' (py36 !)
+  ModuleNotFoundError: No module named 'hgext.badext2'
   Traceback (most recent call last):
-  ImportError: No module named 'hgext3rd.badext2' (no-py36 !)
-  ModuleNotFoundError: No module named 'hgext3rd.badext2' (py36 !)
+  ModuleNotFoundError: No module named 'hgext3rd.badext2'
   Traceback (most recent call last):
-  ModuleNotFoundError: No module named 'badext2' (py36 !)
-  ImportError: No module named 'badext2' (no-py36 !)
+  ModuleNotFoundError: No module named 'badext2'
   YYYY/MM/DD HH:MM:SS (PID)> > loaded 2 extensions, total time * (glob)
   YYYY/MM/DD HH:MM:SS (PID)> - loading configtable attributes
   YYYY/MM/DD HH:MM:SS (PID)> - executing uisetup hooks
   YYYY/MM/DD HH:MM:SS (PID)>   - running uisetup for gpg
   YYYY/MM/DD HH:MM:SS (PID)>   > uisetup for gpg took * (glob)
   YYYY/MM/DD HH:MM:SS (PID)>   - running uisetup for baddocext
   YYYY/MM/DD HH:MM:SS (PID)>   > uisetup for baddocext took * (glob)
```

### Comparing `mercurial-6.4rc0/tests/test-basic.t` & `mercurial-6.5rc0/tests/test-basic.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-batching.py` & `mercurial-6.5rc0/tests/test-batching.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bdiff.py` & `mercurial-6.5rc0/tests/test-bdiff.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bheads.t` & `mercurial-6.5rc0/tests/test-bheads.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bisect.t` & `mercurial-6.5rc0/tests/test-bisect.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bisect2.t` & `mercurial-6.5rc0/tests/test-bisect2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bisect3.t` & `mercurial-6.5rc0/tests/test-bisect3.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-blackbox.t` & `mercurial-6.5rc0/tests/test-blackbox.t`

 * *Files 1% similar despite different names*

```diff
@@ -318,16 +318,16 @@
   1970-01-01 00:00:00.000 bob @45589e459b2edfbf3dbde7e01f611d2c1e7453d7 (5000)> blackbox
 
 Skip rotation if the .hg is read-only
 
 #if unix-permissions
   $ chmod -w .hg
   $ hg log -r. -T '{rev}\n' --config blackbox.maxsize=1 --debug
-  warning: cannot rename '$TESTTMP/blackboxtest3/.hg/blackbox.log.1' to '$TESTTMP/blackboxtest3/.hg/blackbox.log': Permission denied
-  warning: cannot write to blackbox.log: Permission denied
+  warning: cannot rename '$TESTTMP/blackboxtest3/.hg/blackbox.log.1' to '$TESTTMP/blackboxtest3/.hg/blackbox.log': $EACCES$
+  warning: cannot write to blackbox.log: $EACCES$
   1
   $ chmod +w .hg
 #endif
 
 Test log recursion from dirty status check
 
   $ cat > ../r.py <<EOF
@@ -466,24 +466,25 @@
   > cmdtable = {}
   > command = registrar.command(cmdtable)
   > @command(b'raise')
   > def raisecmd(*args):
   >     raise RuntimeError('raise')
   > EOF
 
-  $ cat >> $HGRCPATH << EOF
+
+  $ hg init $TESTTMP/blackbox-exception-only --config blackbox.track=commandexception
+  $ cat >> $TESTTMP/blackbox-exception-only/.hg/hgrc << EOF
   > [blackbox]
   > track = commandexception
   > [extensions]
   > raise=$TESTTMP/raise.py
   > EOF
-
-  $ hg init $TESTTMP/blackbox-exception-only
   $ cd $TESTTMP/blackbox-exception-only
 
+
 #if chg
  (chg exits 255 because it fails to receive an exit code)
   $ hg raise 2>/dev/null
   [255]
 #else
  (hg exits 1 because Python default exit code for uncaught exception is 1)
   $ hg raise 2>/dev/null
@@ -491,7 +492,29 @@
 #endif
 
   $ head -1 .hg/blackbox.log
   1970-01-01 00:00:00.000 bob @0000000000000000000000000000000000000000 (5000)> ** Unknown exception encountered with possibly-broken third-party extension "mock" (version N/A)
   $ tail -2 .hg/blackbox.log
   RuntimeError: raise
   
+  $ cd ..
+
+Check we did not broke `hg mv`
+------------------------------
+(we did in 6.4rc)
+
+basic setup
+
+  $ hg init blackbox-file-move
+  $ cd blackbox-file-move
+  $ echo foo > foo
+  $ hg add foo
+  $ hg commit -m 'foo'
+
+copy a file
+
+  $ hg copy foo bar
+
+move a file
+
+  $ hg mv foo goo
+
```

### Comparing `mercurial-6.4rc0/tests/test-bookflow.t` & `mercurial-6.5rc0/tests/test-bookflow.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bookmarks-corner-case.t` & `mercurial-6.5rc0/tests/test-bookmarks-corner-case.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bookmarks-current.t` & `mercurial-6.5rc0/tests/test-bookmarks-current.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bookmarks-merge.t` & `mercurial-6.5rc0/tests/test-bookmarks-merge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bookmarks-pushpull.t` & `mercurial-6.5rc0/tests/test-bookmarks-pushpull.t`

 * *Files 0% similar despite different names*

```diff
@@ -125,18 +125,18 @@
   listing keys for "bookmarks"
   no changes found
   bundle2-output-bundle: "HG20", 4 parts total
   bundle2-output: start emission of HG20 stream
   bundle2-output: bundle parameter: 
   bundle2-output: start of parts
   bundle2-output: bundle part: "replycaps"
-  bundle2-output-part: "replycaps" 224 bytes payload
+  bundle2-output-part: "replycaps" 227 bytes payload
   bundle2-output: part 0: "REPLYCAPS"
   bundle2-output: header chunk size: 16
-  bundle2-output: payload chunk size: 224
+  bundle2-output: payload chunk size: 227
   bundle2-output: closing payload chunk
   bundle2-output: bundle part: "check:bookmarks"
   bundle2-output-part: "check:bookmarks" 23 bytes payload
   bundle2-output: part 1: "CHECK:BOOKMARKS"
   bundle2-output: header chunk size: 22
   bundle2-output: payload chunk size: 23
   bundle2-output: closing payload chunk
@@ -158,17 +158,17 @@
   bundle2-input: start extraction of bundle2 parts
   bundle2-input: part header size: 16
   bundle2-input: part type: "REPLYCAPS"
   bundle2-input: part id: "0"
   bundle2-input: part parameters: 0
   bundle2-input: found a handler for part replycaps
   bundle2-input-part: "replycaps" supported
-  bundle2-input: payload chunk size: 224
+  bundle2-input: payload chunk size: 227
   bundle2-input: payload chunk size: 0
-  bundle2-input-part: total payload size 224
+  bundle2-input-part: total payload size 227
   bundle2-input: part header size: 22
   bundle2-input: part type: "CHECK:BOOKMARKS"
   bundle2-input: part id: "1"
   bundle2-input: part parameters: 0
   bundle2-input: found a handler for part check:bookmarks
   bundle2-input-part: "check:bookmarks" supported
   bundle2-input: payload chunk size: 23
@@ -237,18 +237,18 @@
   listing keys for "bookmarks"
   no changes found
   bundle2-output-bundle: "HG20", 4 parts total
   bundle2-output: start emission of HG20 stream
   bundle2-output: bundle parameter: 
   bundle2-output: start of parts
   bundle2-output: bundle part: "replycaps"
-  bundle2-output-part: "replycaps" 224 bytes payload
+  bundle2-output-part: "replycaps" 227 bytes payload
   bundle2-output: part 0: "REPLYCAPS"
   bundle2-output: header chunk size: 16
-  bundle2-output: payload chunk size: 224
+  bundle2-output: payload chunk size: 227
   bundle2-output: closing payload chunk
   bundle2-output: bundle part: "check:bookmarks"
   bundle2-output-part: "check:bookmarks" 23 bytes payload
   bundle2-output: part 1: "CHECK:BOOKMARKS"
   bundle2-output: header chunk size: 22
   bundle2-output: payload chunk size: 23
   bundle2-output: closing payload chunk
@@ -271,17 +271,17 @@
   bundle2-input: start extraction of bundle2 parts
   bundle2-input: part header size: 16
   bundle2-input: part type: "REPLYCAPS"
   bundle2-input: part id: "0"
   bundle2-input: part parameters: 0
   bundle2-input: found a handler for part replycaps
   bundle2-input-part: "replycaps" supported
-  bundle2-input: payload chunk size: 224
+  bundle2-input: payload chunk size: 227
   bundle2-input: payload chunk size: 0
-  bundle2-input-part: total payload size 224
+  bundle2-input-part: total payload size 227
   bundle2-input: part header size: 22
   bundle2-input: part type: "CHECK:BOOKMARKS"
   bundle2-input: part id: "1"
   bundle2-input: part parameters: 0
   bundle2-input: found a handler for part check:bookmarks
   bundle2-input-part: "check:bookmarks" supported
   bundle2-input: payload chunk size: 23
```

### Comparing `mercurial-6.4rc0/tests/test-bookmarks-rebase.t` & `mercurial-6.5rc0/tests/test-bookmarks-rebase.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bookmarks-strip.t` & `mercurial-6.5rc0/tests/test-bookmarks-strip.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bookmarks.t` & `mercurial-6.5rc0/tests/test-bookmarks.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-branch-change.t` & `mercurial-6.5rc0/tests/test-branch-change.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-branch-option.t` & `mercurial-6.5rc0/tests/test-branch-option.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-branch-tag-confict.t` & `mercurial-6.5rc0/tests/test-branch-tag-confict.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-branches.t` & `mercurial-6.5rc0/tests/test-branches.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bugzilla.t` & `mercurial-6.5rc0/tests/test-bugzilla.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bundle-phases.t` & `mercurial-6.5rc0/tests/test-bundle-phases.t`

 * *Files 4% similar despite different names*

```diff
@@ -40,14 +40,15 @@
   changegroup -- {nbchanges: 3, targetphase: 2, version: 02} (mandatory: True)
       26805aba1e600a82e93661149f2313866a221a7b
       f585351a92f85104bff7c284233c338b10eb1df7
       9bc730a19041f9ec7cb33c626e811aa233efb18c
   cache:rev-branch-cache -- {} (mandatory: False)
   phase-heads -- {} (mandatory: True)
       26805aba1e600a82e93661149f2313866a221a7b draft
+      9bc730a19041f9ec7cb33c626e811aa233efb18c secret
   $ hg strip --no-backup C
 
 Phases show on incoming, and are also restored when pulling.  Secret commits
 aren't incoming or pulled, following usual incoming/pull semantics.
 
   $ hg log -R bundle -r 'bundle()^+bundle()' -G -T '{desc} {phase}\n'
   o  E secret
@@ -370,14 +371,15 @@
       dc0947a82db884575bb76ea10ac97b08536bfa03
       4e4f9194f9f181c57f62e823e8bdfa46ab9e4ff4
       03ca77807e919db8807c3749086dc36fb478cac0
   cache:rev-branch-cache -- {} (mandatory: False)
   phase-heads -- {} (mandatory: True)
       dc0947a82db884575bb76ea10ac97b08536bfa03 public
       03ca77807e919db8807c3749086dc36fb478cac0 draft
+      4e4f9194f9f181c57f62e823e8bdfa46ab9e4ff4 secret
   $ hg strip --no-backup A
   $ hg unbundle -q bundle
   $ rm bundle
   $ hg log -G -T '{node|short} {desc} {phase}\n'
   o  03ca77807e91 E draft
   |
   | o  4e4f9194f9f1 D secret
@@ -394,33 +396,36 @@
   $ hg debugbundle bundle
   Stream params: {Compression: BZ}
   changegroup -- {nbchanges: 2, targetphase: 2, version: 02} (mandatory: True)
       112478962961147124edd43549aedd1a335e44bf
       4e4f9194f9f181c57f62e823e8bdfa46ab9e4ff4
   cache:rev-branch-cache -- {} (mandatory: False)
   phase-heads -- {} (mandatory: True)
+      4e4f9194f9f181c57f62e823e8bdfa46ab9e4ff4 secret
   $ rm bundle
 
   $ hg bundle --base A -r D bundle
   3 changesets found
   $ hg debugbundle bundle
   Stream params: {Compression: BZ}
   changegroup -- {nbchanges: 3, targetphase: 2, version: 02} (mandatory: True)
       112478962961147124edd43549aedd1a335e44bf
       dc0947a82db884575bb76ea10ac97b08536bfa03
       4e4f9194f9f181c57f62e823e8bdfa46ab9e4ff4
   cache:rev-branch-cache -- {} (mandatory: False)
   phase-heads -- {} (mandatory: True)
       dc0947a82db884575bb76ea10ac97b08536bfa03 public
+      4e4f9194f9f181c57f62e823e8bdfa46ab9e4ff4 secret
   $ rm bundle
 
   $ hg bundle --base 'B + C' -r 'D + E' bundle
   2 changesets found
   $ hg debugbundle bundle
   Stream params: {Compression: BZ}
   changegroup -- {nbchanges: 2, targetphase: 2, version: 02} (mandatory: True)
       4e4f9194f9f181c57f62e823e8bdfa46ab9e4ff4
       03ca77807e919db8807c3749086dc36fb478cac0
   cache:rev-branch-cache -- {} (mandatory: False)
   phase-heads -- {} (mandatory: True)
       03ca77807e919db8807c3749086dc36fb478cac0 draft
+      4e4f9194f9f181c57f62e823e8bdfa46ab9e4ff4 secret
   $ rm bundle
```

### Comparing `mercurial-6.4rc0/tests/test-bundle-r.t` & `mercurial-6.5rc0/tests/test-bundle-r.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bundle-vs-outgoing.t` & `mercurial-6.5rc0/tests/test-bundle-vs-outgoing.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bundle.t` & `mercurial-6.5rc0/tests/test-bundle.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bundle2-exchange.t` & `mercurial-6.5rc0/tests/test-bundle2-exchange.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bundle2-format.t` & `mercurial-6.5rc0/tests/test-bundle2-format.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bundle2-multiple-changegroups.t` & `mercurial-6.5rc0/tests/test-bundle2-multiple-changegroups.t`

 * *Files 17% similar despite different names*

```diff
@@ -451,7 +451,107 @@
   | |
   | @  2:f838bfaca5c7 public test  C
   |/
   o  1:27547f69f254 public test  B
   |
   o  0:4a2df7238c3b public test  A
   
+
+Test that "split" from inline content works fine (cf issue6811)
+===============================================================
+
+setup
+-----
+
+(create a compression free version where the split is easier to trigger)
+
+  $ cat >> $HGRCPATH << EOF
+  > [format]
+  > revlog-compression=none
+  > use-persistent-nodemap=no
+  > EOF
+
+  $ cd ..
+  $ hg clone --pull repo repo-test-split --quiet
+  pullop.cgresult is 2
+  $ cat > repo-test-split/.hg/hgrc << EOF
+  > [extensions]
+  > bundle2=$TESTTMP/bundle2.py
+  > EOF
+  $ hg clone --pull repo-test-split clone-test-split --quiet
+  pullop.cgresult is 2
+  $ cd repo-test-split
+  $ cat > .hg/hgrc << EOF
+  > [extensions]
+  > bundle2=$TESTTMP/bundle2.py
+  > EOF
+
+
+IMPORTANT: must be a non-split revlog with only a .i
+  $ ls -1 .hg/store/00manifest.*
+  .hg/store/00manifest.i
+  $ ls -1 .hg/store/data/_a.*
+  .hg/store/data/_a.i
+
+  $ $TESTDIR/seq.py 100000 > A
+  $ mkdir foo
+  $ cd foo
+  $ touch `$TESTDIR/seq.py 10000`
+  $ cd ..
+  $ hg add -q foo
+  $ hg commit -m 'split the manifest and one filelog'
+
+
+IMPORTANT: now the revlogs must be split
+  $ ls -1 .hg/store/00manifest.*
+  .hg/store/00manifest.d
+  .hg/store/00manifest.i
+  $ ls -1 .hg/store/data/_a.*
+  .hg/store/data/_a.d
+  .hg/store/data/_a.i
+
+Add an extra commit on top of that
+
+  $ echo foo >> A
+  $ hg commit -m 'one extra commit'
+
+
+Actual testing
+--------------
+
+  $ cd ../clone-test-split
+
+We now pull this in the clone the split should be in one changegroup, the update in another one
+
+  $ hg  pull
+  pulling from $TESTTMP/repo-test-split
+  searching for changes
+  remote: changegroup1
+  adding changesets
+  adding manifests
+  adding file changes
+  remote: changegroup2
+  adding changesets
+  adding manifests
+  adding file changes
+  added 2 changesets with 10002 changes to 10002 files
+  new changesets 5e5bf9c91085:900b170f70d0
+  pullop.cgresult is 1
+  (run 'hg update' to get a working copy)
+
+IMPORTANT: now the revlogs must be split
+  $ ls -1 .hg/store/00manifest.*
+  .hg/store/00manifest.d
+  .hg/store/00manifest.i
+  $ ls -1 .hg/store/data/_a.*
+  .hg/store/data/_a.d
+  .hg/store/data/_a.i
+
+manifest should work
+
+  $ hg  files -r tip | wc -l
+  \s*10007 (re)
+
+file content should work
+
+  $ hg  cat -r tip A | wc -l
+  \s*100001 (re)
```

### Comparing `mercurial-6.4rc0/tests/test-bundle2-pushback.t` & `mercurial-6.5rc0/tests/test-bundle2-pushback.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-bundle2-remote-changegroup.t` & `mercurial-6.5rc0/tests/test-bundle2-remote-changegroup.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-byteify-strings.t` & `mercurial-6.5rc0/tests/test-byteify-strings.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-cache-abuse.t` & `mercurial-6.5rc0/tests/test-cache-abuse.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-cappedreader.py` & `mercurial-6.5rc0/tests/test-cappedreader.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-casecollision-merge.t` & `mercurial-6.5rc0/tests/test-casecollision-merge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-casecollision.t` & `mercurial-6.5rc0/tests/test-casecollision.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-casefolding.t` & `mercurial-6.5rc0/tests/test-casefolding.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-cat.t` & `mercurial-6.5rc0/tests/test-cat.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-cbor.py` & `mercurial-6.5rc0/tests/test-cbor.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-censor.t` & `mercurial-6.5rc0/tests/test-censor.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-censor2.t` & `mercurial-6.5rc0/tests/test-censor2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-changelog-exec.t` & `mercurial-6.5rc0/tests/test-changelog-exec.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-check-code.t` & `mercurial-6.5rc0/tests/test-check-code.t`

 * *Files 1% similar despite different names*

```diff
@@ -53,14 +53,15 @@
 
 Prevent adding new files in the root directory accidentally.
 
   $ testrepohg files 'glob:*'
   .arcconfig
   .clang-format
   .editorconfig
+  .gitattributes
   .hgignore
   .hgsigs
   .hgtags
   .jshintrc
   CONTRIBUTING
   CONTRIBUTORS
   COPYING
```

### Comparing `mercurial-6.4rc0/tests/test-check-commit.t` & `mercurial-6.5rc0/tests/test-check-commit.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-check-config.t` & `mercurial-6.5rc0/tests/test-check-config.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-check-encoding.t` & `mercurial-6.5rc0/tests/test-check-encoding.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-check-execute.t` & `mercurial-6.5rc0/tests/test-check-execute.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-check-help.t` & `mercurial-6.5rc0/tests/test-check-help.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-check-interfaces.py` & `mercurial-6.5rc0/tests/test-check-interfaces.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-check-module-imports.t` & `mercurial-6.5rc0/tests/test-check-module-imports.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-check-py3-compat.t` & `mercurial-6.5rc0/tests/test-check-py3-compat.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-check-pyflakes.t` & `mercurial-6.5rc0/tests/test-check-pyflakes.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-check-pylint.t` & `mercurial-6.5rc0/tests/test-check-pylint.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-check-shbang.t` & `mercurial-6.5rc0/tests/test-check-shbang.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-chg.t` & `mercurial-6.5rc0/tests/test-chg.t`

 * *Files 2% similar despite different names*

```diff
@@ -549,7 +549,24 @@
 (Disabling with --no-profile on the commandline still works, but isn't permanent)
   $ newchg log -r . --no-profile
   $ filteredchg log -r .
   Sample count: * (glob)
   $ filteredchg log -r . --no-profile
   $ filteredchg log -r .
   Sample count: * (glob)
+
+chg setting CHGHG itself
+------------------------
+
+If CHGHG is not set, chg will set it before spawning the command server.
+  $ hg --kill-chg-daemon
+  $ HG=$CHGHG CHGHG= CHGDEBUG= hg debugshell -c \
+  >   'ui.write(b"CHGHG=%s\n" % ui.environ.get(b"CHGHG"))' 2>&1 \
+  >   | egrep 'CHGHG|start'
+  chg: debug: * start cmdserver at * (glob)
+  CHGHG=/*/install/bin/hg (glob)
+
+Running the same command a second time shouldn't spawn a new command server.
+  $ HG=$CHGHG CHGHG= CHGDEBUG= hg debugshell -c \
+  >   'ui.write(b"CHGHG=%s\n" % ui.environ.get(b"CHGHG"))' 2>&1 \
+  >   | egrep 'CHGHG|start'
+  CHGHG=/*/install/bin/hg (glob)
```

### Comparing `mercurial-6.4rc0/tests/test-children.t` & `mercurial-6.5rc0/tests/test-children.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-churn.t` & `mercurial-6.5rc0/tests/test-churn.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-clone-cgi.t` & `mercurial-6.5rc0/tests/test-clone-cgi.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-clone-pull-corruption.t` & `mercurial-6.5rc0/tests/test-clone-pull-corruption.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-clone-r.t` & `mercurial-6.5rc0/tests/test-clone-r.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-clone-stream-format.t` & `mercurial-6.5rc0/tests/test-clone-stream-format.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-clone-stream.t` & `mercurial-6.5rc0/tests/test-clone-stream.t`

 * *Files 14% similar despite different names*

```diff
@@ -1,17 +1,23 @@
 #require serve no-reposimplestore no-chg
 
-#testcases stream-legacy stream-bundle2
+#testcases stream-legacy stream-bundle2-v2 stream-bundle2-v3
 
 #if stream-legacy
   $ cat << EOF >> $HGRCPATH
   > [server]
   > bundle2.stream = no
   > EOF
 #endif
+#if stream-bundle2-v3
+  $ cat << EOF >> $HGRCPATH
+  > [experimental]
+  > stream-v3 = yes
+  > EOF
+#endif
 
 Initialize repository
 
   $ hg init server
   $ cd server
   $ sh $TESTDIR/testlib/stream_clone_setup.sh
   adding 00changelog-ab349180a0405010.nd
@@ -124,14 +130,15 @@
     unbundlehash
   Bundle2 capabilities:
     HG20
     bookmarks
     changegroup
       01
       02
+      03
     checkheads
       related
     digests
       md5
       sha1
       sha512
     error
@@ -153,31 +160,31 @@
   requesting all changes
   adding changesets
   adding manifests
   adding file changes
   added 3 changesets with 1088 changes to 1088 files
   new changesets 96ee1d7354c4:5223b5e3265f
 
-  $ get-with-headers.py $LOCALIP:$HGPORT '?cmd=getbundle' content-type --bodyfile body --hgproto 0.2 --requestheader "x-hgarg-1=bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Aphases%253Dheads%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps&cg=0&common=0000000000000000000000000000000000000000&heads=c17445101a72edac06facd130d14808dfbd5c7c2&stream=1"
+  $ get-with-headers.py $LOCALIP:$HGPORT '?cmd=getbundle' content-type --bodyfile body --hgproto 0.2 --requestheader "x-hgarg-1=bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Aphases%253Dheads%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps&cg=0&common=0000000000000000000000000000000000000000&heads=c17445101a72edac06facd130d14808dfbd5c7c2&stream=1"
   200 Script output follows
   content-type: application/mercurial-0.2
   
 
   $ f --size body --hexdump --bytes 100
-  body: size=232
+  body: size=140
   0000: 04 6e 6f 6e 65 48 47 32 30 00 00 00 00 00 00 00 |.noneHG20.......|
-  0010: cf 0b 45 52 52 4f 52 3a 41 42 4f 52 54 00 00 00 |..ERROR:ABORT...|
-  0020: 00 01 01 07 3c 04 72 6d 65 73 73 61 67 65 73 74 |....<.rmessagest|
+  0010: 73 0b 45 52 52 4f 52 3a 41 42 4f 52 54 00 00 00 |s.ERROR:ABORT...|
+  0020: 00 01 01 07 3c 04 16 6d 65 73 73 61 67 65 73 74 |....<..messagest|
   0030: 72 65 61 6d 20 64 61 74 61 20 72 65 71 75 65 73 |ream data reques|
   0040: 74 65 64 20 62 75 74 20 73 65 72 76 65 72 20 64 |ted but server d|
   0050: 6f 65 73 20 6e 6f 74 20 61 6c 6c 6f 77 20 74 68 |oes not allow th|
   0060: 69 73 20 66                                     |is f|
 
 #endif
-#if stream-bundle2
+#if stream-bundle2-v2
   $ hg debugcapabilities http://localhost:$HGPORT
   Main capabilities:
     batch
     branchmap
     $USUAL_BUNDLE2_CAPS_SERVER$
     changegroupsubset
     compression=$BUNDLE2_COMPRESSIONS$
@@ -191,14 +198,15 @@
     unbundlehash
   Bundle2 capabilities:
     HG20
     bookmarks
     changegroup
       01
       02
+      03
     checkheads
       related
     digests
       md5
       sha1
       sha512
     error
@@ -220,24 +228,92 @@
   requesting all changes
   adding changesets
   adding manifests
   adding file changes
   added 3 changesets with 1088 changes to 1088 files
   new changesets 96ee1d7354c4:5223b5e3265f
 
-  $ get-with-headers.py $LOCALIP:$HGPORT '?cmd=getbundle' content-type --bodyfile body --hgproto 0.2 --requestheader "x-hgarg-1=bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Aphases%253Dheads%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps&cg=0&common=0000000000000000000000000000000000000000&heads=c17445101a72edac06facd130d14808dfbd5c7c2&stream=1"
+  $ get-with-headers.py $LOCALIP:$HGPORT '?cmd=getbundle' content-type --bodyfile body --hgproto 0.2 --requestheader "x-hgarg-1=bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Aphases%253Dheads%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps&cg=0&common=0000000000000000000000000000000000000000&heads=c17445101a72edac06facd130d14808dfbd5c7c2&stream=1"
   200 Script output follows
   content-type: application/mercurial-0.2
   
 
   $ f --size body --hexdump --bytes 100
-  body: size=232
+  body: size=140
   0000: 04 6e 6f 6e 65 48 47 32 30 00 00 00 00 00 00 00 |.noneHG20.......|
-  0010: cf 0b 45 52 52 4f 52 3a 41 42 4f 52 54 00 00 00 |..ERROR:ABORT...|
-  0020: 00 01 01 07 3c 04 72 6d 65 73 73 61 67 65 73 74 |....<.rmessagest|
+  0010: 73 0b 45 52 52 4f 52 3a 41 42 4f 52 54 00 00 00 |s.ERROR:ABORT...|
+  0020: 00 01 01 07 3c 04 16 6d 65 73 73 61 67 65 73 74 |....<..messagest|
+  0030: 72 65 61 6d 20 64 61 74 61 20 72 65 71 75 65 73 |ream data reques|
+  0040: 74 65 64 20 62 75 74 20 73 65 72 76 65 72 20 64 |ted but server d|
+  0050: 6f 65 73 20 6e 6f 74 20 61 6c 6c 6f 77 20 74 68 |oes not allow th|
+  0060: 69 73 20 66                                     |is f|
+
+#endif
+#if stream-bundle2-v3
+  $ hg debugcapabilities http://localhost:$HGPORT
+  Main capabilities:
+    batch
+    branchmap
+    $USUAL_BUNDLE2_CAPS_SERVER$
+    changegroupsubset
+    compression=$BUNDLE2_COMPRESSIONS$
+    getbundle
+    httpheader=1024
+    httpmediatype=0.1rx,0.1tx,0.2tx
+    known
+    lookup
+    pushkey
+    unbundle=HG10GZ,HG10BZ,HG10UN
+    unbundlehash
+  Bundle2 capabilities:
+    HG20
+    bookmarks
+    changegroup
+      01
+      02
+      03
+    checkheads
+      related
+    digests
+      md5
+      sha1
+      sha512
+    error
+      abort
+      unsupportedcontent
+      pushraced
+      pushkey
+    hgtagsfnodes
+    listkeys
+    phases
+      heads
+    pushkey
+    remote-changegroup
+      http
+      https
+
+  $ hg clone --stream -U http://localhost:$HGPORT server-disabled
+  warning: stream clone requested but server has them disabled
+  requesting all changes
+  adding changesets
+  adding manifests
+  adding file changes
+  added 3 changesets with 1088 changes to 1088 files
+  new changesets 96ee1d7354c4:5223b5e3265f
+
+  $ get-with-headers.py $LOCALIP:$HGPORT '?cmd=getbundle' content-type --bodyfile body --hgproto 0.2 --requestheader "x-hgarg-1=bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Aphases%253Dheads%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps&cg=0&common=0000000000000000000000000000000000000000&heads=c17445101a72edac06facd130d14808dfbd5c7c2&stream=1"
+  200 Script output follows
+  content-type: application/mercurial-0.2
+  
+
+  $ f --size body --hexdump --bytes 100
+  body: size=140
+  0000: 04 6e 6f 6e 65 48 47 32 30 00 00 00 00 00 00 00 |.noneHG20.......|
+  0010: 73 0b 45 52 52 4f 52 3a 41 42 4f 52 54 00 00 00 |s.ERROR:ABORT...|
+  0020: 00 01 01 07 3c 04 16 6d 65 73 73 61 67 65 73 74 |....<..messagest|
   0030: 72 65 61 6d 20 64 61 74 61 20 72 65 71 75 65 73 |ream data reques|
   0040: 74 65 64 20 62 75 74 20 73 65 72 76 65 72 20 64 |ted but server d|
   0050: 6f 65 73 20 6e 6f 74 20 61 6c 6c 6f 77 20 74 68 |oes not allow th|
   0060: 69 73 20 66                                     |is f|
 
 #endif
 
@@ -256,15 +332,15 @@
   transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
   1090 files to transfer, 98.8 KB of data (zstd !)
   transferred 98.8 KB in * seconds (* */sec) (glob) (zstd !)
   searching for changes
   no changes found
   $ cat server/errors.txt
 #endif
-#if stream-bundle2
+#if stream-bundle2-v2
   $ hg clone --stream -U http://localhost:$HGPORT clone1
   streaming all changes
   1093 files to transfer, 102 KB of data (no-zstd !)
   transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
   1093 files to transfer, 98.9 KB of data (zstd !)
   transferred 98.9 KB in * seconds (* */sec) (glob) (zstd !)
 
@@ -277,18 +353,38 @@
   branch2-visible-hidden
   rbc-names-v1
   rbc-revs-v1
   tags2
   tags2-served
   $ cat server/errors.txt
 #endif
+#if stream-bundle2-v3
+  $ hg clone --stream -U http://localhost:$HGPORT clone1
+  streaming all changes
+  1093 entries to transfer
+  transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
+  transferred 98.9 KB in * seconds (* */sec) (glob) (zstd !)
+
+  $ ls -1 clone1/.hg/cache
+  branch2-base
+  branch2-immutable
+  branch2-served
+  branch2-served.hidden
+  branch2-visible
+  branch2-visible-hidden
+  rbc-names-v1
+  rbc-revs-v1
+  tags2
+  tags2-served
+  $ cat server/errors.txt
+#endif
 
 getbundle requests with stream=1 are uncompressed
 
-  $ get-with-headers.py $LOCALIP:$HGPORT '?cmd=getbundle' content-type --bodyfile body --hgproto '0.1 0.2 comp=zlib,none' --requestheader "x-hgarg-1=bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Aphases%253Dheads%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps&cg=0&common=0000000000000000000000000000000000000000&heads=c17445101a72edac06facd130d14808dfbd5c7c2&stream=1"
+  $ get-with-headers.py $LOCALIP:$HGPORT '?cmd=getbundle' content-type --bodyfile body --hgproto '0.1 0.2 comp=zlib,none' --requestheader "x-hgarg-1=bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Aphases%253Dheads%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps%250Astream%253Dv2&cg=0&common=0000000000000000000000000000000000000000&heads=c17445101a72edac06facd130d14808dfbd5c7c2&stream=1"
   200 Script output follows
   content-type: application/mercurial-0.2
   
 
 #if no-zstd no-rust
   $ f --size --hex --bytes 256 body
   body: size=119123
@@ -380,22 +476,29 @@
   1090 files to transfer, 102 KB of data (no-zstd !)
   transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
   1090 files to transfer, 98.8 KB of data (zstd !)
   transferred 98.8 KB in * seconds (* */sec) (glob) (zstd !)
   searching for changes
   no changes found
 #endif
-#if stream-bundle2
+#if stream-bundle2-v2
   $ hg clone --uncompressed -U http://localhost:$HGPORT clone1-uncompressed
   streaming all changes
   1093 files to transfer, 102 KB of data (no-zstd !)
   transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
   1093 files to transfer, 98.9 KB of data (zstd !)
   transferred 98.9 KB in * seconds (* */sec) (glob) (zstd !)
 #endif
+#if stream-bundle2-v3
+  $ hg clone --uncompressed -U http://localhost:$HGPORT clone1-uncompressed
+  streaming all changes
+  1093 entries to transfer
+  transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
+  transferred 98.9 KB in * seconds (* */sec) (glob) (zstd !)
+#endif
 
 Clone with background file closing enabled
 
 #if stream-legacy
   $ hg --debug --config worker.backgroundclose=true --config worker.backgroundcloseminfilecount=1 clone --stream -U http://localhost:$HGPORT clone-background | grep -v adding
   using http://localhost:$HGPORT/
   sending capabilities command
@@ -419,15 +522,15 @@
   bundle2-input-part: "phase-heads" supported
   bundle2-input-part: total payload size 24
   bundle2-input-bundle: 2 parts total
   checking for updated bookmarks
   updating the branch cache
   (sent 5 HTTP requests and * bytes; received * bytes in responses) (glob)
 #endif
-#if stream-bundle2
+#if stream-bundle2-v2
   $ hg --debug --config worker.backgroundclose=true --config worker.backgroundcloseminfilecount=1 clone --stream -U http://localhost:$HGPORT clone-background | grep -v adding
   using http://localhost:$HGPORT/
   sending capabilities command
   query 1; heads
   sending batch command
   streaming all changes
   sending getbundle command
@@ -446,14 +549,40 @@
   bundle2-input-part: total payload size 116140 (zstd bigendian !)
   bundle2-input-part: "listkeys" (params: 1 mandatory) supported
   bundle2-input-bundle: 2 parts total
   checking for updated bookmarks
   updating the branch cache
   (sent 3 HTTP requests and * bytes; received * bytes in responses) (glob)
 #endif
+#if stream-bundle2-v3
+  $ hg --debug --config worker.backgroundclose=true --config worker.backgroundcloseminfilecount=1 clone --stream -U http://localhost:$HGPORT clone-background | grep -v adding
+  using http://localhost:$HGPORT/
+  sending capabilities command
+  query 1; heads
+  sending batch command
+  streaming all changes
+  sending getbundle command
+  bundle2-input-bundle: with-transaction
+  bundle2-input-part: "stream3-exp" (params: 1 mandatory) supported
+  applying stream bundle
+  1093 entries to transfer
+  starting 4 threads for background file closing
+  starting 4 threads for background file closing
+  updating the branch cache
+  transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
+  bundle2-input-part: total payload size 120079 (no-zstd !)
+  transferred 98.9 KB in * seconds (* */sec) (glob) (zstd !)
+  bundle2-input-part: total payload size 117240 (zstd no-bigendian !)
+  bundle2-input-part: total payload size 116138 (zstd bigendian !)
+  bundle2-input-part: "listkeys" (params: 1 mandatory) supported
+  bundle2-input-bundle: 2 parts total
+  checking for updated bookmarks
+  updating the branch cache
+  (sent 3 HTTP requests and * bytes; received * bytes in responses) (glob)
+#endif
 
 Cannot stream clone when there are secret changesets
 
   $ hg -R server phase --force --secret -r tip
   $ hg clone --stream -U http://localhost:$HGPORT secret-denied
   warning: stream clone requested but server has them disabled
   requesting all changes
@@ -478,22 +607,29 @@
   1090 files to transfer, 102 KB of data (no-zstd !)
   transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
   1090 files to transfer, 98.8 KB of data (zstd !)
   transferred 98.8 KB in * seconds (* */sec) (glob) (zstd !)
   searching for changes
   no changes found
 #endif
-#if stream-bundle2
+#if stream-bundle2-v2
   $ hg clone --stream -U http://localhost:$HGPORT secret-allowed
   streaming all changes
   1093 files to transfer, 102 KB of data (no-zstd !)
   transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
   1093 files to transfer, 98.9 KB of data (zstd !)
   transferred 98.9 KB in * seconds (* */sec) (glob) (zstd !)
 #endif
+#if stream-bundle2-v3
+  $ hg clone --stream -U http://localhost:$HGPORT secret-allowed
+  streaming all changes
+  1093 entries to transfer
+  transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
+  transferred 98.9 KB in * seconds (* */sec) (glob) (zstd !)
+#endif
 
   $ killdaemons.py
 
 Verify interaction between preferuncompressed and secret presence
 
   $ cd server
   $ hg serve --config server.preferuncompressed=true -p $HGPORT -d --pid-file=hg.pid
@@ -539,48 +675,14 @@
   new changesets 96ee1d7354c4:c17445101a72
 
 Stream clone while repo is changing:
 
   $ mkdir changing
   $ cd changing
 
-extension for delaying the server process so we reliably can modify the repo
-while cloning
-
-  $ cat > stream_steps.py <<EOF
-  > import os
-  > import sys
-  > from mercurial import (
-  >     encoding,
-  >     extensions,
-  >     streamclone,
-  >     testing,
-  > )
-  > WALKED_FILE_1 = encoding.environ[b'HG_TEST_STREAM_WALKED_FILE_1']
-  > WALKED_FILE_2 = encoding.environ[b'HG_TEST_STREAM_WALKED_FILE_2']
-  > 
-  > def _test_sync_point_walk_1(orig, repo):
-  >     testing.write_file(WALKED_FILE_1)
-  > 
-  > def _test_sync_point_walk_2(orig, repo):
-  >     assert repo._currentlock(repo._lockref) is None
-  >     testing.wait_file(WALKED_FILE_2)
-  > 
-  > extensions.wrapfunction(
-  >     streamclone,
-  >     '_test_sync_point_walk_1',
-  >     _test_sync_point_walk_1
-  > )
-  > extensions.wrapfunction(
-  >     streamclone,
-  >     '_test_sync_point_walk_2',
-  >     _test_sync_point_walk_2
-  > )
-  > EOF
-
 prepare repo with small and big file to cover both code paths in emitrevlogdata
 
   $ hg init repo
   $ touch repo/f1
   $ $TESTDIR/seq.py 50000 > repo/f2
   $ hg -R repo ci -Aqm "0"
   $ HG_TEST_STREAM_WALKED_FILE_1="$TESTTMP/sync_file_walked_1"
@@ -632,24 +734,33 @@
   1090 files to transfer, 98.8 KB of data (zstd !)
   transferred 98.8 KB in * seconds (* */sec) (glob) (zstd !)
   searching for changes
   no changes found
   updating to branch default
   1088 files updated, 0 files merged, 0 files removed, 0 files unresolved
 #endif
-#if stream-bundle2
+#if stream-bundle2-v2
   $ hg clone --stream http://localhost:$HGPORT with-bookmarks
   streaming all changes
   1096 files to transfer, 102 KB of data (no-zstd !)
   transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
   1096 files to transfer, 99.1 KB of data (zstd !)
   transferred 99.1 KB in * seconds (* */sec) (glob) (zstd !)
   updating to branch default
   1088 files updated, 0 files merged, 0 files removed, 0 files unresolved
 #endif
+#if stream-bundle2-v3
+  $ hg clone --stream http://localhost:$HGPORT with-bookmarks
+  streaming all changes
+  1096 entries to transfer
+  transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
+  transferred 99.1 KB in * seconds (* */sec) (glob) (zstd !)
+  updating to branch default
+  1088 files updated, 0 files merged, 0 files removed, 0 files unresolved
+#endif
   $ hg verify -R with-bookmarks -q
   $ hg -R with-bookmarks bookmarks
      some-bookmark             2:5223b5e3265f
 
 Stream repository with phases
 -----------------------------
 
@@ -668,24 +779,33 @@
   1090 files to transfer, 98.8 KB of data (zstd !)
   transferred 98.8 KB in * seconds (* */sec) (glob) (zstd !)
   searching for changes
   no changes found
   updating to branch default
   1088 files updated, 0 files merged, 0 files removed, 0 files unresolved
 #endif
-#if stream-bundle2
+#if stream-bundle2-v2
   $ hg clone --stream http://localhost:$HGPORT phase-publish
   streaming all changes
   1096 files to transfer, 102 KB of data (no-zstd !)
   transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
   1096 files to transfer, 99.1 KB of data (zstd !)
   transferred 99.1 KB in * seconds (* */sec) (glob) (zstd !)
   updating to branch default
   1088 files updated, 0 files merged, 0 files removed, 0 files unresolved
 #endif
+#if stream-bundle2-v3
+  $ hg clone --stream http://localhost:$HGPORT phase-publish
+  streaming all changes
+  1096 entries to transfer
+  transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
+  transferred 99.1 KB in * seconds (* */sec) (glob) (zstd !)
+  updating to branch default
+  1088 files updated, 0 files merged, 0 files removed, 0 files unresolved
+#endif
   $ hg verify -R phase-publish -q
   $ hg -R phase-publish phase -r 'all()'
   0: public
   1: public
   2: public
 
 Clone as non publishing
@@ -714,39 +834,52 @@
   updating to branch default
   1088 files updated, 0 files merged, 0 files removed, 0 files unresolved
   $ hg -R phase-no-publish phase -r 'all()'
   0: public
   1: public
   2: public
 #endif
-#if stream-bundle2
+#if stream-bundle2-v2
   $ hg clone --stream http://localhost:$HGPORT phase-no-publish
   streaming all changes
   1097 files to transfer, 102 KB of data (no-zstd !)
   transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
   1097 files to transfer, 99.1 KB of data (zstd !)
   transferred 99.1 KB in * seconds (* */sec) (glob) (zstd !)
   updating to branch default
   1088 files updated, 0 files merged, 0 files removed, 0 files unresolved
   $ hg -R phase-no-publish phase -r 'all()'
   0: draft
   1: draft
   2: draft
 #endif
+#if stream-bundle2-v3
+  $ hg clone --stream http://localhost:$HGPORT phase-no-publish
+  streaming all changes
+  1097 entries to transfer
+  transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
+  transferred 99.1 KB in * seconds (* */sec) (glob) (zstd !)
+  updating to branch default
+  1088 files updated, 0 files merged, 0 files removed, 0 files unresolved
+  $ hg -R phase-no-publish phase -r 'all()'
+  0: draft
+  1: draft
+  2: draft
+#endif
   $ hg verify -R phase-no-publish -q
 
   $ killdaemons.py
 
 #if stream-legacy
 
 With v1 of the stream protocol, changeset are always cloned as public. There's
 no obsolescence markers exchange in stream v1.
 
 #endif
-#if stream-bundle2
+#if stream-bundle2-v2
 
 Stream repository with obsolescence
 -----------------------------------
 
 Clone non-publishing with obsolescence
 
   $ cat >> $HGRCPATH << EOF
@@ -777,14 +910,63 @@
   transferred 99.5 KB in * seconds (* */sec) (glob) (zstd !)
   $ hg -R with-obsolescence log -T '{rev}: {phase}\n'
   2: draft
   1: draft
   0: draft
   $ hg debugobsolete -R with-obsolescence
   8c206a663911c1f97f2f9d7382e417ae55872cfa 0 {5223b5e3265f0df40bb743da62249413d74ac70f} (Thu Jan 01 00:00:00 1970 +0000) {'user': 'test'}
+  $ hg verify -R with-obsolescence -q
+
+  $ hg clone -U --stream --config experimental.evolution=0 http://localhost:$HGPORT with-obsolescence-no-evolution
+  streaming all changes
+  remote: abort: server has obsolescence markers, but client cannot receive them via stream clone
+  abort: pull failed on remote
+  [100]
+
+  $ killdaemons.py
+
+#endif
+#if stream-bundle2-v3
+
+Stream repository with obsolescence
+-----------------------------------
+
+Clone non-publishing with obsolescence
+
+  $ cat >> $HGRCPATH << EOF
+  > [experimental]
+  > evolution=all
+  > EOF
+
+  $ cd server
+  $ echo foo > foo
+  $ hg -q commit -m 'about to be pruned'
+  $ hg debugobsolete `hg log -r . -T '{node}'` -d '0 0' -u test --record-parents
+  1 new obsolescence markers
+  obsoleted 1 changesets
+  $ hg up null -q
+  $ hg log -T '{rev}: {phase}\n'
+  2: draft
+  1: draft
+  0: draft
+  $ hg serve -p $HGPORT -d --pid-file=hg.pid
+  $ cat hg.pid > $DAEMON_PIDS
+  $ cd ..
+
+  $ hg clone -U --stream http://localhost:$HGPORT with-obsolescence
+  streaming all changes
+  1098 entries to transfer
+  transferred 102 KB in * seconds (* */sec) (glob) (no-zstd !)
+  transferred 99.5 KB in * seconds (* */sec) (glob) (zstd !)
+  $ hg -R with-obsolescence log -T '{rev}: {phase}\n'
+  2: draft
+  1: draft
+  0: draft
+  $ hg debugobsolete -R with-obsolescence
+  8c206a663911c1f97f2f9d7382e417ae55872cfa 0 {5223b5e3265f0df40bb743da62249413d74ac70f} (Thu Jan 01 00:00:00 1970 +0000) {'user': 'test'}
   $ hg verify -R with-obsolescence -q
 
   $ hg clone -U --stream --config experimental.evolution=0 http://localhost:$HGPORT with-obsolescence-no-evolution
   streaming all changes
   remote: abort: server has obsolescence markers, but client cannot receive them via stream clone
   abort: pull failed on remote
   [100]
```

### Comparing `mercurial-6.4rc0/tests/test-clone-update-order.t` & `mercurial-6.5rc0/tests/test-clone-update-order.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-clone.t` & `mercurial-6.5rc0/tests/test-clone.t`

 * *Files 0% similar despite different names*

```diff
@@ -629,23 +629,23 @@
 #if unix-permissions no-root
 
 Inaccessible source
 
   $ mkdir a
   $ chmod 000 a
   $ hg clone a b
-  abort: Permission denied: *$TESTTMP/fail/a/.hg* (glob)
+  abort: $EACCES$: *$TESTTMP/fail/a/.hg* (glob)
   [255]
 
 Inaccessible destination
 
   $ hg init b
   $ cd b
   $ hg clone . ../a
-  abort: Permission denied: *../a* (glob)
+  abort: $EACCES$: *../a* (glob)
   [255]
   $ cd ..
   $ chmod 700 a
   $ rm -r a b
 
 #endif
```

### Comparing `mercurial-6.4rc0/tests/test-clonebundles.t` & `mercurial-6.5rc0/tests/test-clonebundles.t`

 * *Files 14% similar despite different names*

```diff
@@ -55,14 +55,28 @@
   applying clone bundle from http://does.not.exist/bundle.hg
   error fetching bundle: (.* not known|(\[Errno -?\d+] )?([Nn]o address associated with (host)?name|Temporary failure in name resolution|Name does not resolve)) (re) (no-windows !)
   error fetching bundle: [Errno 1100*] getaddrinfo failed (glob) (windows !)
   abort: error applying bundle
   (if this error persists, consider contacting the server operator or disable clone bundles via "--config ui.clonebundles=false")
   [255]
 
+Manifest file with URL with unknown scheme skips the URL
+  $ echo 'weirdscheme://does.not.exist/bundle.hg' > server/.hg/clonebundles.manifest
+  $ hg clone http://localhost:$HGPORT unknown-scheme
+  no compatible clone bundles available on server; falling back to regular clone
+  (you may want to report this to the server operator)
+  requesting all changes
+  adding changesets
+  adding manifests
+  adding file changes
+  added 2 changesets with 2 changes to 2 files
+  new changesets 53245c60e682:aaff8d2ffbbf
+  updating to branch default
+  2 files updated, 0 files merged, 0 files removed, 0 files unresolved
+
 Server is not running aborts
 
   $ echo "http://localhost:$HGPORT1/bundle.hg" > server/.hg/clonebundles.manifest
   $ hg clone http://localhost:$HGPORT server-not-runner
   applying clone bundle from http://localhost:$HGPORT1/bundle.hg
   error fetching bundle: (.* refused.*|Protocol not supported|(.* )?\$EADDRNOTAVAIL\$|.* No route to host) (re)
   abort: error applying bundle
@@ -215,14 +229,101 @@
   adding file changes
   added 2 changesets with 2 changes to 2 files
   finished applying clone bundle
   searching for changes
   no changes found
   2 local changesets published
 
+Inline bundle
+=============
+
+Checking bundle retrieved over the wireprotocol
+
+Feature works over SSH with inline bundle
+-----------------------------------------
+
+  $ mkdir server/.hg/bundle-cache/
+  $ cp full.hg server/.hg/bundle-cache/
+  $ echo "peer-bundle-cache://full.hg" > server/.hg/clonebundles.manifest
+  $ hg clone -U ssh://user@dummy/server ssh-inline-clone
+  applying clone bundle from peer-bundle-cache://full.hg
+  adding changesets
+  adding manifests
+  adding file changes
+  added 2 changesets with 2 changes to 2 files
+  finished applying clone bundle
+  searching for changes
+  no changes found
+  2 local changesets published
+
+HTTP Supports
+-------------
+
+  $ hg clone -U http://localhost:$HGPORT http-inline-clone
+  applying clone bundle from peer-bundle-cache://full.hg
+  adding changesets
+  adding manifests
+  adding file changes
+  added 2 changesets with 2 changes to 2 files
+  finished applying clone bundle
+  searching for changes
+  no changes found
+  2 local changesets published
+
+
+Check local behavior
+--------------------
+
+We don't use the clone bundle, but we do not crash either.
+
+  $ hg clone -U ./server local-inline-clone-default
+  $ hg clone -U ./server local-inline-clone-pull --pull
+  requesting all changes
+  adding changesets
+  adding manifests
+  adding file changes
+  added 2 changesets with 2 changes to 2 files
+  new changesets 53245c60e682:aaff8d2ffbbf
+
+Pre-transmit Hook
+-----------------
+
+Hooks work with inline bundle
+
+  $ cp server/.hg/hgrc server/.hg/hgrc-beforeinlinehooks
+  $ echo "[hooks]" >> server/.hg/hgrc
+  $ echo "pretransmit-inline-clone-bundle=echo foo" >> server/.hg/hgrc
+  $ hg clone -U ssh://user@dummy/server ssh-inline-clone-hook
+  applying clone bundle from peer-bundle-cache://full.hg
+  remote: foo
+  adding changesets
+  adding manifests
+  adding file changes
+  added 2 changesets with 2 changes to 2 files
+  finished applying clone bundle
+  searching for changes
+  no changes found
+  2 local changesets published
+
+Hooks can make an inline bundle fail
+
+  $ cp server/.hg/hgrc-beforeinlinehooks server/.hg/hgrc
+  $ echo "[hooks]" >> server/.hg/hgrc
+  $ echo "pretransmit-inline-clone-bundle=echo bar && false" >> server/.hg/hgrc
+  $ hg clone -U ssh://user@dummy/server ssh-inline-clone-hook-fail
+  applying clone bundle from peer-bundle-cache://full.hg
+  remote: bar
+  remote: abort: pretransmit-inline-clone-bundle hook exited with status 1
+  abort: stream ended unexpectedly (got 0 bytes, expected 1)
+  [255]
+  $ cp server/.hg/hgrc-beforeinlinehooks server/.hg/hgrc
+
+Other tests
+===========
+
 Entry with unknown BUNDLESPEC is filtered and not used
 
   $ cat > server/.hg/clonebundles.manifest << EOF
   > http://bad.entry1 BUNDLESPEC=UNKNOWN
   > http://bad.entry2 BUNDLESPEC=xz-v1
   > http://bad.entry3 BUNDLESPEC=none-v100
   > http://localhost:$HGPORT1/full.hg BUNDLESPEC=gzip-v2
@@ -566,15 +667,15 @@
   $ cat > server/.hg/clonebundles.manifest << EOF
   > http://localhost:$HGPORT1/gz-a.hg BUNDLESPEC=gzip-v2 REQUIREDRAM=12MB
   > EOF
 
   $ hg clone -U --debug --config ui.available-memory=16MB http://localhost:$HGPORT gzip-too-large
   using http://localhost:$HGPORT/
   sending capabilities command
-  sending clonebundles command
+  sending clonebundles_manifest command
   filtering http://localhost:$HGPORT1/gz-a.hg as it needs more than 2/3 of system memory
   no compatible clone bundles available on server; falling back to regular clone
   (you may want to report this to the server operator)
   query 1; heads
   sending batch command
   requesting all changes
   sending getbundle command
@@ -583,15 +684,15 @@
   adding changesets
   add changeset 53245c60e682
   add changeset aaff8d2ffbbf
   adding manifests
   adding file changes
   adding bar revisions
   adding foo revisions
-  bundle2-input-part: total payload size 920
+  bundle2-input-part: total payload size 936
   bundle2-input-part: "listkeys" (params: 1 mandatory) supported
   bundle2-input-part: "phase-heads" supported
   bundle2-input-part: total payload size 24
   bundle2-input-bundle: 3 parts total
   checking for updated bookmarks
   updating the branch cache
   added 2 changesets with 2 changes to 2 files
@@ -599,15 +700,15 @@
   calling hook changegroup.lfiles: hgext.largefiles.reposetup.checkrequireslfiles
   updating the branch cache
   (sent 4 HTTP requests and * bytes; received * bytes in responses) (glob)
 
   $ hg clone -U --debug --config ui.available-memory=32MB http://localhost:$HGPORT gzip-too-large2
   using http://localhost:$HGPORT/
   sending capabilities command
-  sending clonebundles command
+  sending clonebundles_manifest command
   applying clone bundle from http://localhost:$HGPORT1/gz-a.hg
   bundle2-input-bundle: 1 params with-transaction
   bundle2-input-part: "changegroup" (params: 1 mandatory 1 advisory) supported
   adding changesets
   add changeset 53245c60e682
   add changeset aaff8d2ffbbf
   adding manifests
@@ -634,7 +735,118 @@
   bundle2-input-bundle: 2 parts total
   checking for updated bookmarks
   2 local changesets published
   calling hook changegroup.lfiles: hgext.largefiles.reposetup.checkrequireslfiles
   updating the branch cache
   (sent 4 HTTP requests and * bytes; received * bytes in responses) (glob)
   $ killdaemons.py
+
+Testing a clone bundles that involves revlog splitting (issue6811)
+==================================================================
+
+  $ cat >> $HGRCPATH << EOF
+  > [format]
+  > revlog-compression=none
+  > use-persistent-nodemap=no
+  > EOF
+
+  $ hg init server-revlog-split/
+  $ cd server-revlog-split
+  $ cat >> .hg/hgrc << EOF
+  > [extensions]
+  > clonebundles =
+  > EOF
+  $ echo foo > A
+  $ hg add A
+  $ hg commit -m 'initial commit'
+IMPORTANT: the revlogs must not be split
+  $ ls -1 .hg/store/00manifest.*
+  .hg/store/00manifest.i
+  $ ls -1 .hg/store/data/_a.*
+  .hg/store/data/_a.i
+
+do big enough update to split the revlogs
+
+  $ $TESTDIR/seq.py 100000 > A
+  $ mkdir foo
+  $ cd foo
+  $ touch `$TESTDIR/seq.py 10000`
+  $ cd ..
+  $ hg add -q foo
+  $ hg commit -m 'split the manifest and one filelog'
+
+IMPORTANT: now the revlogs must be split
+  $ ls -1 .hg/store/00manifest.*
+  .hg/store/00manifest.d
+  .hg/store/00manifest.i
+  $ ls -1 .hg/store/data/_a.*
+  .hg/store/data/_a.d
+  .hg/store/data/_a.i
+
+Add an extra commit on top of that
+
+  $ echo foo >> A
+  $ hg commit -m 'one extra commit'
+
+  $ cd ..
+
+Do a bundle that contains the split, but not the update
+
+  $ hg bundle --exact --rev '::(default~1)' -R server-revlog-split/ --type gzip-v2 split-test.hg
+  2 changesets found
+
+  $ cat > server-revlog-split/.hg/clonebundles.manifest << EOF
+  > http://localhost:$HGPORT1/split-test.hg BUNDLESPEC=gzip-v2
+  > EOF
+
+start the necessary server
+
+  $ "$PYTHON" $TESTDIR/dumbhttp.py -p $HGPORT1 --pid http.pid
+  $ cat http.pid >> $DAEMON_PIDS
+  $ hg -R server-revlog-split serve -d -p $HGPORT --pid-file hg.pid --accesslog access.log
+  $ cat hg.pid >> $DAEMON_PIDS
+
+Check that clone works fine
+===========================
+
+Here, the initial clone will trigger a revlog split (which is a bit clowny it
+itself, but whatever). The split revlogs will see additionnal data added to
+them in the subsequent pull. This should not be a problem
+
+  $ hg clone http://localhost:$HGPORT revlog-split-in-the-bundle
+  applying clone bundle from http://localhost:$HGPORT1/split-test.hg
+  adding changesets
+  adding manifests
+  adding file changes
+  added 2 changesets with 10002 changes to 10001 files
+  finished applying clone bundle
+  searching for changes
+  adding changesets
+  adding manifests
+  adding file changes
+  added 1 changesets with 1 changes to 1 files
+  new changesets e3879eaa1db7
+  2 local changesets published
+  updating to branch default
+  10001 files updated, 0 files merged, 0 files removed, 0 files unresolved
+
+check the results
+
+  $ cd revlog-split-in-the-bundle
+  $ f --size .hg/store/00manifest.*
+  .hg/store/00manifest.d: size=499037
+  .hg/store/00manifest.i: size=192
+  $ f --size .hg/store/data/_a.*
+  .hg/store/data/_a.d: size=588917
+  .hg/store/data/_a.i: size=192
+
+manifest should work
+
+  $ hg  files -r tip | wc -l
+  \s*10001 (re)
+
+file content should work
+
+  $ hg  cat -r tip A | wc -l
+  \s*100001 (re)
+
+
```

### Comparing `mercurial-6.4rc0/tests/test-close-head.t` & `mercurial-6.5rc0/tests/test-close-head.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-commandserver.t` & `mercurial-6.5rc0/tests/test-commandserver.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-commit-amend.t` & `mercurial-6.5rc0/tests/test-commit-amend.t`

 * *Files 1% similar despite different names*

```diff
@@ -117,23 +117,23 @@
   copying changeset 47343646fa3d to ad120869acf0
   committing files:
   a
   committing manifest
   committing changelog
   1 changesets found
   uncompressed size of bundle content:
-       254 (changelog)
-       163 (manifests)
-       133  a
+       256 (changelog)
+       165 (manifests)
+       135  a
   saved backup bundle to $TESTTMP/repo/.hg/strip-backup/47343646fa3d-c2758885-amend.hg
   1 changesets found
   uncompressed size of bundle content:
-       250 (changelog)
-       163 (manifests)
-       133  a
+       252 (changelog)
+       165 (manifests)
+       135  a
   adding branch
   adding changesets
   adding manifests
   adding file changes
   added 1 changesets with 1 changes to 1 files
   committed changeset 1:401431e913a1
   $ hg diff -c .
@@ -261,23 +261,23 @@
   HG: changed a
   committing files:
   a
   committing manifest
   committing changelog
   1 changesets found
   uncompressed size of bundle content:
-       249 (changelog)
-       163 (manifests)
-       135  a
+       251 (changelog)
+       165 (manifests)
+       137  a
   saved backup bundle to $TESTTMP/repo/.hg/strip-backup/a9a13940fc03-7c2e8674-amend.hg
   1 changesets found
   uncompressed size of bundle content:
-       257 (changelog)
-       163 (manifests)
-       135  a
+       259 (changelog)
+       165 (manifests)
+       137  a
   adding branch
   adding changesets
   adding manifests
   adding file changes
   added 1 changesets with 1 changes to 1 files
   committed changeset 1:64a124ba1b44
 
@@ -297,23 +297,23 @@
   HG: changed a
   committing files:
   a
   committing manifest
   committing changelog
   1 changesets found
   uncompressed size of bundle content:
-       257 (changelog)
-       163 (manifests)
-       135  a
+       259 (changelog)
+       165 (manifests)
+       137  a
   saved backup bundle to $TESTTMP/repo/.hg/strip-backup/64a124ba1b44-10374b8f-amend.hg
   1 changesets found
   uncompressed size of bundle content:
-       257 (changelog)
-       163 (manifests)
-       137  a
+       259 (changelog)
+       165 (manifests)
+       139  a
   adding branch
   adding changesets
   adding manifests
   adding file changes
   added 1 changesets with 1 changes to 1 files
   committed changeset 1:7892795b8e38
```

### Comparing `mercurial-6.4rc0/tests/test-commit-interactive-curses.t` & `mercurial-6.5rc0/tests/test-commit-interactive-curses.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-commit-interactive.t` & `mercurial-6.5rc0/tests/test-commit-interactive.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-commit-multiple.t` & `mercurial-6.5rc0/tests/test-commit-multiple.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-commit-unresolved.t` & `mercurial-6.5rc0/tests/test-commit-unresolved.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-commit.t` & `mercurial-6.5rc0/tests/test-commit.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-committer.t` & `mercurial-6.5rc0/tests/test-committer.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-completion.t` & `mercurial-6.5rc0/tests/test-completion.t`

 * *Files 2% similar despite different names*

```diff
@@ -74,14 +74,16 @@
 
 Show debug commands if there are no other candidates
   $ hg debugcomplete debug
   debug-delta-find
   debug-repair-issue6528
   debug-revlog-index
   debug-revlog-stats
+  debug::stable-tail-sort
+  debug::stable-tail-sort-leaps
   debugancestor
   debugantivirusrunning
   debugapplystreamclonebundle
   debugbackupbundle
   debugbuilddag
   debugbundle
   debugcapabilities
@@ -269,14 +271,16 @@
   config: untrusted, exp-all-known, edit, local, source, shared, non-shared, global, template
   continue: dry-run
   copy: forget, after, at-rev, force, include, exclude, dry-run
   debug-delta-find: changelog, manifest, dir, template, source
   debug-repair-issue6528: to-report, from-report, paranoid, dry-run
   debug-revlog-index: changelog, manifest, dir, template
   debug-revlog-stats: changelog, manifest, filelogs, template
+  debug::stable-tail-sort: template
+  debug::stable-tail-sort-leaps: template, specific
   debugancestor: 
   debugantivirusrunning: 
   debugapplystreamclonebundle: 
   debugbackupbundle: recover, patch, git, limit, no-merges, stat, graph, style, template
   debugbuilddag: mergeable-file, overwritten-file, new-file, from-existing
   debugbundle: all, part-type, spec
   debugcapabilities: 
@@ -305,15 +309,15 @@
   debuginstall: template
   debugknown: 
   debuglabelcomplete: 
   debuglocks: force-free-lock, force-free-wlock, set-lock, set-wlock
   debugmanifestfulltextcache: clear, add
   debugmergestate: style, template
   debugnamecomplete: 
-  debugnodemap: dump-new, dump-disk, check, metadata
+  debugnodemap: changelog, manifest, dir, dump-new, dump-disk, check, metadata
   debugobsolete: flags, record-parents, rev, exclusive, index, delete, date, user, template
   debugp1copies: rev
   debugp2copies: rev
   debugpathcomplete: full, normal, added, removed
   debugpathcopies: include, exclude
   debugpeer: 
   debugpickmergetool: rev, changedelete, include, exclude, tool
@@ -360,15 +364,15 @@
   log: follow, follow-first, date, copies, keyword, rev, line-range, removed, only-merges, user, only-branch, branch, bookmark, prune, patch, git, limit, no-merges, stat, graph, style, template, include, exclude
   manifest: rev, all, template
   merge: force, rev, preview, abort, tool
   outgoing: force, rev, newest-first, bookmarks, branch, patch, git, limit, no-merges, stat, graph, style, template, ssh, remotecmd, insecure, subrepos
   parents: rev, style, template
   paths: template
   phase: public, draft, secret, force, rev
-  pull: update, force, confirm, rev, bookmark, branch, ssh, remotecmd, insecure
+  pull: update, force, confirm, rev, bookmark, branch, remote-hidden, ssh, remotecmd, insecure
   purge: abort-on-err, all, ignored, dirs, files, print, print0, confirm, include, exclude
   push: force, rev, bookmark, all-bookmarks, branch, new-branch, pushvars, publish, ssh, remotecmd, insecure
   recover: verify
   remove: after, force, subrepos, include, exclude, dry-run
   rename: forget, after, at-rev, force, include, exclude, dry-run
   resolve: all, list, mark, unmark, no-status, re-merge, tool, include, exclude, template
   revert: all, date, rev, no-backup, interactive, include, exclude, dry-run
```

### Comparing `mercurial-6.4rc0/tests/test-config-env.py` & `mercurial-6.5rc0/tests/test-config-env.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-config-parselist.py` & `mercurial-6.5rc0/tests/test-config-parselist.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-config.t` & `mercurial-6.5rc0/tests/test-config.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-conflict.t` & `mercurial-6.5rc0/tests/test-conflict.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-confused-revert.t` & `mercurial-6.5rc0/tests/test-confused-revert.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-context-metadata.t` & `mercurial-6.5rc0/tests/test-context-metadata.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-context.py` & `mercurial-6.5rc0/tests/test-context.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-context.py.out` & `mercurial-6.5rc0/tests/test-context.py.out`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-contrib-check-code.t` & `mercurial-6.5rc0/tests/test-contrib-check-code.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-contrib-check-commit.t` & `mercurial-6.5rc0/tests/test-contrib-check-commit.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-contrib-dumprevlog.t` & `mercurial-6.5rc0/tests/test-contrib-dumprevlog.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-contrib-perf.t` & `mercurial-6.5rc0/tests/test-contrib-perf.t`

 * *Files 2% similar despite different names*

```diff
@@ -184,14 +184,20 @@
                  Benchmark writing a series of revisions to a revlog.
    perf::revrange
                  (no help text available)
    perf::revset  benchmark the execution time of a revset
    perf::startup
                  (no help text available)
    perf::status  benchmark the performance of a single status call
+   perf::stream-consume
+                 benchmark the full application of a stream clone
+   perf::stream-generate
+                 benchmark the full generation of a stream clone
+   perf::stream-locked-section
+                 benchmark the initial, repo-locked, section of a stream-clone
    perf::tags    (no help text available)
    perf::templating
                  test the rendering time of a given template
    perf::unbundle
                  benchmark application of a bundle in a repository.
    perf::unidiff
                  benchmark a unified diff between revisions
@@ -294,28 +300,28 @@
 Simple single entry
 
   $ hg perfparents --config perf.stub=no --config perf.run-limits='0.000000001-15'
   ! wall * comb * user * sys * (best of 15) (glob)
 
 Multiple entries
 
-  $ hg perfparents --config perf.stub=no --config perf.run-limits='500000-1, 0.000000001-5'
-  ! wall * comb * user * sys * (best of 5) (glob)
+  $ hg perfparents --config perf.stub=no --config perf.run-limits='500000-1, 0.000000001-50'
+  ! wall * comb * user * sys * (best of 50) (glob)
 
 error case are ignored
 
-  $ hg perfparents --config perf.stub=no --config perf.run-limits='500, 0.000000001-5'
+  $ hg perfparents --config perf.stub=no --config perf.run-limits='500, 0.000000001-50'
   malformatted run limit entry, missing "-": 500
-  ! wall * comb * user * sys * (best of 5) (glob)
-  $ hg perfparents --config perf.stub=no --config perf.run-limits='aaa-12, 0.000000001-5'
-  malformatted run limit entry, could not convert string to float: 'aaa': aaa-12
-  ! wall * comb * user * sys * (best of 5) (glob)
-  $ hg perfparents --config perf.stub=no --config perf.run-limits='12-aaaaaa, 0.000000001-5'
-  malformatted run limit entry, invalid literal for int() with base 10: 'aaaaaa': 12-aaaaaa
-  ! wall * comb * user * sys * (best of 5) (glob)
+  ! wall * comb * user * sys * (best of 50) (glob)
+  $ hg perfparents --config perf.stub=no --config perf.run-limits='aaa-120, 0.000000001-50'
+  malformatted run limit entry, could not convert string to float: 'aaa': aaa-120
+  ! wall * comb * user * sys * (best of 50) (glob)
+  $ hg perfparents --config perf.stub=no --config perf.run-limits='120-aaaaaa, 0.000000001-50'
+  malformatted run limit entry, invalid literal for int() with base 10: 'aaaaaa': 120-aaaaaa
+  ! wall * comb * user * sys * (best of 50) (glob)
 
 test actual output
 ------------------
 
 normal output:
 
   $ hg perfheads --config perf.stub=no
```

### Comparing `mercurial-6.4rc0/tests/test-contrib-pull-logger.t` & `mercurial-6.5rc0/tests/test-contrib-pull-logger.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-contrib-relnotes.t` & `mercurial-6.5rc0/tests/test-contrib-relnotes.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-contrib-testparseutil.t` & `mercurial-6.5rc0/tests/test-contrib-testparseutil.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-contrib.t` & `mercurial-6.5rc0/tests/test-contrib.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-authormap.t` & `mercurial-6.5rc0/tests/test-convert-authormap.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-baz.t` & `mercurial-6.5rc0/tests/test-convert-baz.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-bzr-114.t` & `mercurial-6.5rc0/tests/test-convert-bzr-114.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-bzr-directories.t` & `mercurial-6.5rc0/tests/test-convert-bzr-directories.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-bzr-ghosts.t` & `mercurial-6.5rc0/tests/test-convert-bzr-ghosts.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-bzr-merges.t` & `mercurial-6.5rc0/tests/test-convert-bzr-merges.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-bzr-treeroot.t` & `mercurial-6.5rc0/tests/test-convert-bzr-treeroot.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-bzr.t` & `mercurial-6.5rc0/tests/test-convert-bzr.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-clonebranches.t` & `mercurial-6.5rc0/tests/test-convert-clonebranches.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-cvs-branch.t` & `mercurial-6.5rc0/tests/test-convert-cvs-branch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-cvs-detectmerge.t` & `mercurial-6.5rc0/tests/test-convert-cvs-detectmerge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-cvs-synthetic.t` & `mercurial-6.5rc0/tests/test-convert-cvs-synthetic.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-cvs.t` & `mercurial-6.5rc0/tests/test-convert-cvs.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-cvsnt-mergepoints.rlog` & `mercurial-6.5rc0/tests/test-convert-cvsnt-mergepoints.rlog`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-cvsnt-mergepoints.t` & `mercurial-6.5rc0/tests/test-convert-cvsnt-mergepoints.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-darcs.t` & `mercurial-6.5rc0/tests/test-convert-darcs.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-datesort.t` & `mercurial-6.5rc0/tests/test-convert-datesort.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-filemap.t` & `mercurial-6.5rc0/tests/test-convert-filemap.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-git.t` & `mercurial-6.5rc0/tests/test-convert-git.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-hg-sink.t` & `mercurial-6.5rc0/tests/test-convert-hg-sink.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-hg-source.t` & `mercurial-6.5rc0/tests/test-convert-hg-source.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-hg-startrev.t` & `mercurial-6.5rc0/tests/test-convert-hg-startrev.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-hg-svn.t` & `mercurial-6.5rc0/tests/test-convert-hg-svn.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-identity.t` & `mercurial-6.5rc0/tests/test-convert-identity.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-mtn.t` & `mercurial-6.5rc0/tests/test-convert-mtn.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-p4-filetypes.t` & `mercurial-6.5rc0/tests/test-convert-p4-filetypes.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-p4.t` & `mercurial-6.5rc0/tests/test-convert-p4.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-splicemap.t` & `mercurial-6.5rc0/tests/test-convert-splicemap.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-svn-branches.t` & `mercurial-6.5rc0/tests/test-convert-svn-branches.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-svn-encoding.t` & `mercurial-6.5rc0/tests/test-convert-svn-encoding.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-svn-move.t` & `mercurial-6.5rc0/tests/test-convert-svn-move.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-svn-sink.t` & `mercurial-6.5rc0/tests/test-convert-svn-sink.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-svn-source.t` & `mercurial-6.5rc0/tests/test-convert-svn-source.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-svn-startrev.t` & `mercurial-6.5rc0/tests/test-convert-svn-startrev.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-svn-tags.t` & `mercurial-6.5rc0/tests/test-convert-svn-tags.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-tagsbranch-topology.t` & `mercurial-6.5rc0/tests/test-convert-tagsbranch-topology.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert-tla.t` & `mercurial-6.5rc0/tests/test-convert-tla.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-convert.t` & `mercurial-6.5rc0/tests/test-convert.t`

 * *Files 0% similar despite different names*

```diff
@@ -464,15 +464,15 @@
 
 conversion to dir without permissions should fail
 
   $ mkdir bogusdir
   $ chmod 000 bogusdir
 
   $ hg convert a bogusdir
-  abort: Permission denied: *bogusdir* (glob)
+  abort: $EACCES$: *bogusdir* (glob)
   [255]
 
 user permissions should succeed
 
   $ chmod 700 bogusdir
   $ hg convert a bogusdir
   initializing destination bogusdir repository
```

### Comparing `mercurial-6.4rc0/tests/test-copies-chain-merge.t` & `mercurial-6.5rc0/tests/test-copies-chain-merge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-copies-in-changeset.t` & `mercurial-6.5rc0/tests/test-copies-in-changeset.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-copies-unrelated.t` & `mercurial-6.5rc0/tests/test-copies-unrelated.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-copies.t` & `mercurial-6.5rc0/tests/test-copies.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-copy-move-merge.t` & `mercurial-6.5rc0/tests/test-copy-move-merge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-copy.t` & `mercurial-6.5rc0/tests/test-copy.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-copytrace-heuristics.t` & `mercurial-6.5rc0/tests/test-copytrace-heuristics.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-custom-filters.t` & `mercurial-6.5rc0/tests/test-custom-filters.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-debian-packages.t` & `mercurial-6.5rc0/tests/test-debian-packages.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-debug-revlog-stats.t` & `mercurial-6.5rc0/tests/test-debug-revlog-stats.t`

 * *Files 2% similar despite different names*

```diff
@@ -14,16 +14,14 @@
   $ hg init repo
   $ cd repo
 
 Try on an empty repository
 
   $ hg debug-revlog-stats
   rev-count   data-size inl type      target 
-          0           0 yes changelog 
-          0           0 yes manifest  
 
   $ mkdir folder
   $ touch a b folder/c folder/d
   $ hg commit -Aqm 0
   $ echo "text" > a
   $ hg rm b
   $ echo "longer string" > folder/d
```

### Comparing `mercurial-6.4rc0/tests/test-debugbackupbundle.t` & `mercurial-6.5rc0/tests/test-debugbackupbundle.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-debugbuilddag.t` & `mercurial-6.5rc0/tests/test-debugbuilddag.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-debugbundle.t` & `mercurial-6.5rc0/tests/test-debugbundle.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-debugcommands.t` & `mercurial-6.5rc0/tests/test-debugcommands.t`

 * *Files 1% similar despite different names*

```diff
@@ -632,14 +632,15 @@
     unbundle
   Bundle2 capabilities:
     HG20
     bookmarks
     changegroup
       01
       02
+      03
     checkheads
       related
     digests
       md5
       sha1
       sha512
     error
@@ -669,15 +670,15 @@
 
   $ hg --debug debugpeer ssh://user@dummy/debugrevlog
   running .* ".*[/\\]dummyssh" ['"]user@dummy['"] ['"]hg -R debugrevlog serve --stdio['"] (re)
   devel-peer-request: hello+between
   devel-peer-request:   pairs: 81 bytes
   sending hello command
   sending between command
-  remote: 468
+  remote: 473
   remote: capabilities: batch branchmap $USUAL_BUNDLE2_CAPS$ changegroupsubset getbundle known lookup protocaps pushkey streamreqs=generaldelta,revlog-compression-zstd,revlogv1,sparserevlog unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash
   remote: 1
   devel-peer-request: protocaps
   devel-peer-request:   caps: * bytes (glob)
   sending protocaps command
   url: ssh://user@dummy/debugrevlog
   local: no
@@ -689,15 +690,15 @@
 
   $ hg --debug debugpeer ssh://user@dummy/debugrevlog
   running .* ".*[/\\]dummyssh" ['"]user@dummy['"] ['"]hg -R debugrevlog serve --stdio['"] (re)
   devel-peer-request: hello+between
   devel-peer-request:   pairs: 81 bytes
   sending hello command
   sending between command
-  remote: 468
+  remote: 473
   remote: capabilities: batch branchmap $USUAL_BUNDLE2_CAPS$ changegroupsubset getbundle known lookup protocaps pushkey streamreqs=generaldelta,revlog-compression-zstd,revlogv1,sparserevlog unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash
   remote: 1
   devel-peer-request: protocaps
   devel-peer-request:   caps: * bytes (glob)
   sending protocaps command
   url: ssh://user@dummy/debugrevlog
   local: no
@@ -709,15 +710,15 @@
 
   $ hg --debug debugpeer ssh://user@dummy/debugrevlog
   running .* ".*[/\\]dummyssh" ['"]user@dummy['"] ['"]hg -R debugrevlog serve --stdio['"] (re)
   devel-peer-request: hello+between
   devel-peer-request:   pairs: 81 bytes
   sending hello command
   sending between command
-  remote: 444
+  remote: 449
   remote: capabilities: batch branchmap $USUAL_BUNDLE2_CAPS$ changegroupsubset getbundle known lookup protocaps pushkey streamreqs=generaldelta,revlogv1,sparserevlog unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash
   remote: 1
   devel-peer-request: protocaps
   devel-peer-request:   caps: * bytes (glob)
   sending protocaps command
   url: ssh://user@dummy/debugrevlog
   local: no
```

### Comparing `mercurial-6.4rc0/tests/test-debugextensions.t` & `mercurial-6.5rc0/tests/test-debugextensions.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-debugindexdot.t` & `mercurial-6.5rc0/tests/test-debugindexdot.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-default-push.t` & `mercurial-6.5rc0/tests/test-default-push.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-demandimport.py` & `mercurial-6.5rc0/tests/test-demandimport.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-devel-warnings.t` & `mercurial-6.5rc0/tests/test-devel-warnings.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diff-antipatience.t` & `mercurial-6.5rc0/tests/test-diff-antipatience.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diff-binary-file.t` & `mercurial-6.5rc0/tests/test-diff-binary-file.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diff-change.t` & `mercurial-6.5rc0/tests/test-diff-change.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diff-color.t` & `mercurial-6.5rc0/tests/test-diff-color.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diff-copy-depth.t` & `mercurial-6.5rc0/tests/test-diff-copy-depth.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diff-hashes.t` & `mercurial-6.5rc0/tests/test-diff-hashes.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diff-ignore-whitespace.t` & `mercurial-6.5rc0/tests/test-diff-ignore-whitespace.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diff-indent-heuristic.t` & `mercurial-6.5rc0/tests/test-diff-indent-heuristic.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diff-reverse.t` & `mercurial-6.5rc0/tests/test-diff-reverse.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diff-subdir.t` & `mercurial-6.5rc0/tests/test-diff-subdir.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diff-unified.t` & `mercurial-6.5rc0/tests/test-diff-unified.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diff-upgrade.t` & `mercurial-6.5rc0/tests/test-diff-upgrade.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diffdir.t` & `mercurial-6.5rc0/tests/test-diffdir.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-diffstat.t` & `mercurial-6.5rc0/tests/test-diffstat.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-directaccess.t` & `mercurial-6.5rc0/tests/test-directaccess.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-dirs.py` & `mercurial-6.5rc0/tests/test-dirs.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-dirstate-race.t` & `mercurial-6.5rc0/tests/test-dirstate-race.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-dirstate-race2.t` & `mercurial-6.5rc0/tests/test-dirstate-race2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-dirstate-read-race.t` & `mercurial-6.5rc0/tests/test-dirstate-read-race.t`

 * *Files 1% similar despite different names*

```diff
@@ -245,39 +245,37 @@
   $ hg status
   ? dir/n
   ? p
   ? q
 
 The status process should return a consistent result and not crash.
 
-#if rust no-rhg dirstate-v2-append
+#if no-rhg
   $ cat $TESTTMP/status-race-lock.out
   A dir/o
   R dir/nested/m
   ? dir/n
   ? p
   ? q
   $ cat $TESTTMP/status-race-lock.log
 #else
-#if rhg pre-some-read dirstate-v2-append
+#if pre-some-read dirstate-v2-append
   $ cat $TESTTMP/status-race-lock.out
   A dir/o
   R dir/nested/m
   ? dir/n
   ? p
   ? q
   $ cat $TESTTMP/status-race-lock.log
 #else
   $ cat $TESTTMP/status-race-lock.out
-  M dir/o (no-rhg known-bad-output !)
   ? dir/n
   ? p
   ? q
   $ cat $TESTTMP/status-race-lock.log
-  warning: ignoring unknown working parent 02a67a77ee9b! (no-rhg !)
 #endif
 #endif
 
 final cleanup
 
   $ rm $TESTTMP/status-race-lock $TESTTMP/status-race-lock.waiting
   $ cd ..
```

### Comparing `mercurial-6.4rc0/tests/test-dirstate-status-write-race.t` & `mercurial-6.5rc0/tests/test-dirstate-status-write-race.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-dirstate.t` & `mercurial-6.5rc0/tests/test-dirstate.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-dispatch.py` & `mercurial-6.5rc0/tests/test-dispatch.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-dispatch.t` & `mercurial-6.5rc0/tests/test-dispatch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-docker-packaging.t` & `mercurial-6.5rc0/tests/test-docker-packaging.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-doctest.py` & `mercurial-6.5rc0/tests/test-doctest.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-double-merge.t` & `mercurial-6.5rc0/tests/test-double-merge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-drawdag.t` & `mercurial-6.5rc0/tests/test-drawdag.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-duplicateoptions.py` & `mercurial-6.5rc0/tests/test-duplicateoptions.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-editor-filename.t` & `mercurial-6.5rc0/tests/test-editor-filename.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-empty-file.t` & `mercurial-6.5rc0/tests/test-empty-file.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-empty-group.t` & `mercurial-6.5rc0/tests/test-empty-group.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-empty-manifest-index.t` & `mercurial-6.5rc0/tests/test-empty-manifest-index.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-empty.t` & `mercurial-6.5rc0/tests/test-empty.t`

 * *Files 8% similar despite different names*

```diff
@@ -36,15 +36,14 @@
   $ ls .hg
   00changelog.i
   branch
   cache
   hgrc
   requires
   store
-  undo.backup.branch
   wcache
 
 Should be empty (except for the "basic" requires):
 
   $ ls .hg/store
   requires
```

### Comparing `mercurial-6.4rc0/tests/test-encode.t` & `mercurial-6.5rc0/tests/test-encode.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-encoding-align.t` & `mercurial-6.5rc0/tests/test-encoding-align.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-encoding-func.py` & `mercurial-6.5rc0/tests/test-encoding-func.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-encoding-textwrap.t` & `mercurial-6.5rc0/tests/test-encoding-textwrap.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-encoding.t` & `mercurial-6.5rc0/tests/test-encoding.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-eol-add.t` & `mercurial-6.5rc0/tests/test-eol-add.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-eol-clone.t` & `mercurial-6.5rc0/tests/test-eol-clone.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-eol-hook.t` & `mercurial-6.5rc0/tests/test-eol-hook.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-eol-patch.t` & `mercurial-6.5rc0/tests/test-eol-patch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-eol-tag.t` & `mercurial-6.5rc0/tests/test-eol-tag.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-eol-update.t` & `mercurial-6.5rc0/tests/test-eol-update.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-eol.t` & `mercurial-6.5rc0/tests/test-eol.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-eolfilename.t` & `mercurial-6.5rc0/tests/test-eolfilename.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-excessive-merge.t` & `mercurial-6.5rc0/tests/test-excessive-merge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-multi-source.t` & `mercurial-6.5rc0/tests/test-exchange-multi-source.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A1.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A1.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A2.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A3.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A3.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A4.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A4.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A5.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A5.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A6.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A6.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-A7.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-A7.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B1.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B1.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B2.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B3.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B3.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B4.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B4.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B5.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B5.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B6.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B6.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-B7.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-B7.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-C1.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-C1.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-C2.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-C2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-C3.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-C3.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-C4.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-C4.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-D1.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-D1.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-D2.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-D2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-D3.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-D3.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-exchange-obsmarkers-case-D4.t` & `mercurial-6.5rc0/tests/test-exchange-obsmarkers-case-D4.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-execute-bit.t` & `mercurial-6.5rc0/tests/test-execute-bit.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-export.t` & `mercurial-6.5rc0/tests/test-export.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-extdata.t` & `mercurial-6.5rc0/tests/test-extdata.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-extdiff.t` & `mercurial-6.5rc0/tests/test-extdiff.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-extension-timing.t` & `mercurial-6.5rc0/tests/test-extension-timing.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-extension.t` & `mercurial-6.5rc0/tests/test-extension.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-extensions-afterloaded.t` & `mercurial-6.5rc0/tests/test-extensions-afterloaded.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-extensions-wrapfunction.py` & `mercurial-6.5rc0/tests/test-extensions-wrapfunction.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-extensions-wrapfunction.py.out` & `mercurial-6.5rc0/tests/test-extensions-wrapfunction.py.out`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fastannotate-corrupt.t` & `mercurial-6.5rc0/tests/test-fastannotate-corrupt.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fastannotate-hg.t` & `mercurial-6.5rc0/tests/test-fastannotate-hg.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fastannotate-perfhack.t` & `mercurial-6.5rc0/tests/test-fastannotate-perfhack.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fastannotate-protocol.t` & `mercurial-6.5rc0/tests/test-fastannotate-protocol.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fastannotate-renames.t` & `mercurial-6.5rc0/tests/test-fastannotate-renames.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fastannotate-revmap.py` & `mercurial-6.5rc0/tests/test-fastannotate-revmap.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fastannotate.t` & `mercurial-6.5rc0/tests/test-fastannotate.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fastexport.t` & `mercurial-6.5rc0/tests/test-fastexport.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fetch.t` & `mercurial-6.5rc0/tests/test-fetch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-filebranch.t` & `mercurial-6.5rc0/tests/test-filebranch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-filecache.py` & `mercurial-6.5rc0/tests/test-filecache.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-filecache.py.out` & `mercurial-6.5rc0/tests/test-filecache.py.out`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-filelog.py` & `mercurial-6.5rc0/tests/test-filelog.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fileset-generated.t` & `mercurial-6.5rc0/tests/test-fileset-generated.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fileset.t` & `mercurial-6.5rc0/tests/test-fileset.t`

 * *Files 0% similar despite different names*

```diff
@@ -49,15 +49,15 @@
     (kindpat
       (symbol 'path')
       (symbol 'a1'))
     (kindpat
       (symbol 'glob')
       (symbol 'b?')))
   * matcher:
-  <patternmatcher patterns='a1(?:/|$)|b.$'>
+  <patternmatcher patterns='b.$|a1(?:/|$)'>
   a1
   b1
   b2
   $ fileset -v --no-show-matcher 'a1 or a2'
   (or
     (symbol 'a1')
     (symbol 'a2'))
```

### Comparing `mercurial-6.4rc0/tests/test-fix-clang-format.t` & `mercurial-6.5rc0/tests/test-fix-clang-format.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fix-metadata.t` & `mercurial-6.5rc0/tests/test-fix-metadata.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fix-pickle.t` & `mercurial-6.5rc0/tests/test-fix-pickle.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fix-topology.t` & `mercurial-6.5rc0/tests/test-fix-topology.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fix.t` & `mercurial-6.5rc0/tests/test-fix.t`

 * *Files 0% similar despite different names*

```diff
@@ -80,18 +80,19 @@
 Help text for fix.
 
   $ hg help fix
   hg fix [OPTION]... [FILE]...
   
   rewrite file content in changesets or working directory
   
-      Runs any configured tools to fix the content of files. Only affects files
-      with changes, unless file arguments are provided. Only affects changed
-      lines of files, unless the --whole flag is used. Some tools may always
-      affect the whole file regardless of --whole.
+      Runs any configured tools to fix the content of files. (See 'hg help -e
+      fix' for details about configuring tools.) Only affects files with
+      changes, unless file arguments are provided. Only affects changed lines of
+      files, unless the --whole flag is used. Some tools may always affect the
+      whole file regardless of --whole.
   
       If --working-dir is used, files with uncommitted changes in the working
       copy will be fixed. Note that no backup are made.
   
       If revisions are specified with --source, those revisions and their
       descendants will be checked, and they may be replaced with new revisions
       that have fixed file content. By automatically including the descendants,
@@ -121,14 +122,21 @@
   $ hg help -e fix
   fix extension - rewrite file content in changesets or working copy
   (EXPERIMENTAL)
   
   Provides a command that runs configured tools on the contents of modified
   files, writing back any fixes to the working copy or replacing changesets.
   
+  Fixer tools are run in the repository's root directory. This allows them to
+  read configuration files from the working copy, or even write to the working
+  copy. The working copy is not updated to match the revision being fixed. In
+  fact, several revisions may be fixed in parallel. Writes to the working copy
+  are not amended into the revision being fixed; fixer tools MUST always read
+  content to be fixed from stdin, and write fixed file content back to stdout.
+  
   Here is an example configuration that causes 'hg fix' to apply automatic
   formatting fixes to modified lines in C++ code:
   
     [fix]
     clang-format:command=clang-format --assume-filename={rootpath}
     clang-format:linerange=--lines={first}:{last}
     clang-format:pattern=set:**.cpp or **.hpp
@@ -227,21 +235,14 @@
       "$HG_REPLACEMENTS" with information about what revisions were created and
       made obsolete. Provides a boolean "$HG_WDIRWRITTEN" to indicate whether any
       files in the working copy were updated. Provides a list "$HG_METADATA"
       mapping fixer tool names to lists of metadata values returned from
       executions that modified a file. This aggregates the same metadata
       previously passed to the "postfixfile" hook.
   
-  Fixer tools are run in the repository's root directory. This allows them to
-  read configuration files from the working copy, or even write to the working
-  copy. The working copy is not updated to match the revision being fixed. In
-  fact, several revisions may be fixed in parallel. Writes to the working copy
-  are not amended into the revision being fixed; fixer tools should always write
-  fixed file content back to stdout as documented above.
-  
   list of commands:
   
    fix           rewrite file content in changesets or working directory
   
   (use 'hg help -v -e fix' to show built-in aliases and global options)
 
 There is no default behavior in the absence of --rev and --working-dir.
```

### Comparing `mercurial-6.4rc0/tests/test-flagprocessor.t` & `mercurial-6.5rc0/tests/test-flagprocessor.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-flags.t` & `mercurial-6.5rc0/tests/test-flags.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-fncache.t` & `mercurial-6.5rc0/tests/test-fncache.t`

 * *Files 2% similar despite different names*

```diff
@@ -100,15 +100,15 @@
   .hg/data/tst.d.hg/foo.i
   .hg/dirstate
   .hg/fsmonitor.state (fsmonitor !)
   .hg/last-message.txt
   .hg/phaseroots
   .hg/requires
   .hg/undo
-  .hg/undo.backup.branch
+  .hg/undo.backup.branch.bck
   .hg/undo.backupfiles
   .hg/undo.desc
   .hg/wcache
   .hg/wcache/checkisexec (execbit !)
   .hg/wcache/checklink (symlink !)
   .hg/wcache/checklink-target (symlink !)
   .hg/wcache/manifestfulltextcache (reporevlogstore !)
@@ -140,15 +140,15 @@
   .hg/store/data
   .hg/store/data/tst.d.hg
   .hg/store/data/tst.d.hg/_foo.i
   .hg/store/phaseroots
   .hg/store/requires
   .hg/store/undo
   .hg/store/undo.backupfiles
-  .hg/undo.backup.branch
+  .hg/undo.backup.branch.bck
   .hg/undo.desc
   .hg/wcache
   .hg/wcache/checkisexec (execbit !)
   .hg/wcache/checklink (symlink !)
   .hg/wcache/checklink-target (symlink !)
   .hg/wcache/manifestfulltextcache (reporevlogstore !)
   $ cd ..
@@ -510,14 +510,15 @@
 
 Unbundling should follow the same rules; existing files should not cause a load:
 
 (loading during the clone is expected)
   $ hg clone -q . tobundle
   fncache load triggered!
   fncache load triggered!
+  fncache load triggered!
 
   $ echo 'new line' > tobundle/bar
   $ hg -R tobundle ci -qm bar
   $ hg -R tobundle bundle -q barupdated.hg
   $ hg unbundle -q barupdated.hg
 
 but adding new files should:
```

### Comparing `mercurial-6.4rc0/tests/test-fuzz-targets.t` & `mercurial-6.5rc0/tests/test-fuzz-targets.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-gendoc-ja.t` & `mercurial-6.5rc0/tests/test-gendoc-ja.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-gendoc.t` & `mercurial-6.5rc0/tests/test-gendoc.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-generaldelta.t` & `mercurial-6.5rc0/tests/test-generaldelta.t`

 * *Files 0% similar despite different names*

```diff
@@ -159,15 +159,15 @@
 
 Test that strip bundle use bundle2
   $ hg --config extensions.strip= strip .
   0 files updated, 0 files merged, 5 files removed, 0 files unresolved
   saved backup bundle to $TESTTMP/aggressive/.hg/strip-backup/1c5d4dc9a8b8-6c68e60c-backup.hg
   $ hg debugbundle .hg/strip-backup/*
   Stream params: {Compression: BZ}
-  changegroup -- {nbchanges: 1, version: 02} (mandatory: True)
+  changegroup -- {nbchanges: 1, version: 03} (mandatory: True)
       1c5d4dc9a8b8d6e1750966d343e94db665e7a1e9
   cache:rev-branch-cache -- {} (mandatory: False)
   phase-heads -- {} (mandatory: True)
       1c5d4dc9a8b8d6e1750966d343e94db665e7a1e9 draft
 
   $ cd ..
```

### Comparing `mercurial-6.4rc0/tests/test-getbundle.t` & `mercurial-6.5rc0/tests/test-getbundle.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-git-export.t` & `mercurial-6.5rc0/tests/test-git-export.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-git-interop.t` & `mercurial-6.5rc0/tests/test-git-interop.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-githelp.t` & `mercurial-6.5rc0/tests/test-githelp.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-globalopts.t` & `mercurial-6.5rc0/tests/test-globalopts.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-glog-beautifygraph.t` & `mercurial-6.5rc0/tests/test-glog-beautifygraph.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-glog-topological.t` & `mercurial-6.5rc0/tests/test-glog-topological.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-glog.t` & `mercurial-6.5rc0/tests/test-glog.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-gpg.t` & `mercurial-6.5rc0/tests/test-gpg.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-graft-interrupted.t` & `mercurial-6.5rc0/tests/test-graft-interrupted.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-graft-rename.t` & `mercurial-6.5rc0/tests/test-graft-rename.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-graft.t` & `mercurial-6.5rc0/tests/test-graft.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-grep.t` & `mercurial-6.5rc0/tests/test-grep.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hardlinks.t` & `mercurial-6.5rc0/tests/test-hardlinks.t`

 * *Files 8% similar despite different names*

```diff
@@ -48,15 +48,15 @@
   1 r1/.hg/store/00manifest.i
   1 r1/.hg/store/data/d1/f2.i
   1 r1/.hg/store/data/f1.i
   1 r1/.hg/store/fncache (repofncache !)
   1 r1/.hg/store/phaseroots
   1 r1/.hg/store/requires
   1 r1/.hg/store/undo
-  1 r1/.hg/store/undo.backup.fncache (repofncache !)
+  1 r1/.hg/store/undo.backup.fncache.bck (repofncache !)
   1 r1/.hg/store/undo.backupfiles
 
 
 Create hardlinked clone r2:
 
   $ hg clone -U --debug r1 r2 --config progress.debug=true
   linking: 1/7 files (14.29%)
@@ -89,15 +89,15 @@
   2 r1/.hg/store/00manifest.i
   2 r1/.hg/store/data/d1/f2.i
   2 r1/.hg/store/data/f1.i
   1 r1/.hg/store/fncache (repofncache !)
   1 r1/.hg/store/phaseroots
   1 r1/.hg/store/requires
   1 r1/.hg/store/undo
-  1 r1/.hg/store/undo.backup.fncache (repofncache !)
+  1 r1/.hg/store/undo.backup.fncache.bck (repofncache !)
   1 r1/.hg/store/undo.backupfiles
 
   $ nlinksdir r2/.hg/store
   2 r2/.hg/store/00changelog.i
   2 r2/.hg/store/00manifest.i
   2 r2/.hg/store/data/d1/f2.i
   2 r2/.hg/store/data/f1.i
@@ -137,16 +137,14 @@
   1 r3/.hg/store/data/d1/f2.d
   1 r3/.hg/store/data/d1/f2.i
   1 r3/.hg/store/data/f1.i
   1 r3/.hg/store/fncache (repofncache !)
   1 r3/.hg/store/phaseroots
   1 r3/.hg/store/requires
   1 r3/.hg/store/undo
-  1 r3/.hg/store/undo.backup.fncache (repofncache !)
-  1 r3/.hg/store/undo.backup.phaseroots
   1 r3/.hg/store/undo.backupfiles
 
 Push to repo r1 should break up most hardlinks in r2:
 
   $ hg -R r2 verify -q
 
   $ cd r3
@@ -249,34 +247,32 @@
   2 r4/.hg/store/data/d1/f2.i
   2 r4/.hg/store/data/f1.i
   2 r4/.hg/store/data/f3.i
   2 r4/.hg/store/fncache (repofncache !)
   2 r4/.hg/store/phaseroots
   2 r4/.hg/store/requires
   2 r4/.hg/store/undo
-  2 r4/.hg/store/undo.backup.fncache (repofncache !)
-  2 r4/.hg/store/undo.backup.phaseroots
   2 r4/.hg/store/undo.backupfiles
-  [24] r4/.hg/undo.backup.branch (re)
-  2 r4/\.hg/undo\.backup\.dirstate (re)
+  [24] r4/.hg/undo.backup.branch.bck (re)
+  2 r4/\.hg/undo\.backup\.dirstate.bck (re)
   2 r4/.hg/undo.desc
   2 r4/.hg/wcache/checkisexec (execbit !)
   2 r4/.hg/wcache/checklink-target (symlink !)
   2 r4/.hg/wcache/checknoexec (execbit !)
   2 r4/.hg/wcache/manifestfulltextcache (reporevlogstore !)
   2 r4/d1/data1
   2 r4/d1/f2
   2 r4/f1
   2 r4/f3
 
 Update back to revision 12 in r4 should break hardlink of file f1 and f3:
 #if hardlink-whitelisted
-  $ nlinksdir r4/.hg/undo.backup.dirstate r4/.hg/dirstate
+  $ nlinksdir r4/.hg/undo.backup.dirstate.bck r4/.hg/dirstate
   2 r4/.hg/dirstate
-  2 r4/.hg/undo.backup.dirstate
+  2 r4/.hg/undo.backup.dirstate.bck
 #endif
 
 
   $ hg -R r4 up 12
   2 files updated, 0 files merged, 0 files removed, 0 files unresolved (execbit !)
   1 files updated, 0 files merged, 0 files removed, 0 files unresolved (no-execbit !)
 
@@ -304,34 +300,32 @@
   2 r4/.hg/store/data/d1/f2.i
   2 r4/.hg/store/data/f1.i
   2 r4/.hg/store/data/f3.i
   2 r4/.hg/store/fncache
   2 r4/.hg/store/phaseroots
   2 r4/.hg/store/requires
   2 r4/.hg/store/undo
-  2 r4/.hg/store/undo.backup.fncache (repofncache !)
-  2 r4/.hg/store/undo.backup.phaseroots
   2 r4/.hg/store/undo.backupfiles
-  [23] r4/.hg/undo.backup.branch (re)
-  2 r4/\.hg/undo\.backup\.dirstate (re)
+  [23] r4/.hg/undo.backup.branch.bck (re)
+  2 r4/\.hg/undo\.backup\.dirstate.bck (re)
   2 r4/.hg/undo.desc
   2 r4/.hg/wcache/checkisexec (execbit !)
   2 r4/.hg/wcache/checklink-target (symlink !)
   2 r4/.hg/wcache/checknoexec (execbit !)
   1 r4/.hg/wcache/manifestfulltextcache (reporevlogstore !)
   2 r4/d1/data1
   2 r4/d1/f2
   1 r4/f1
   1 r4/f3 (execbit !)
   2 r4/f3 (no-execbit !)
 
 #if hardlink-whitelisted
-  $ nlinksdir r4/.hg/undo.backup.dirstate r4/.hg/dirstate
+  $ nlinksdir r4/.hg/undo.backup.dirstate.bck r4/.hg/dirstate
   1 r4/.hg/dirstate
-  2 r4/.hg/undo.backup.dirstate
+  2 r4/.hg/undo.backup.dirstate.bck
 #endif
 
 Test hardlinking outside hg:
 
   $ mkdir x
   $ echo foo > x/a
```

### Comparing `mercurial-6.4rc0/tests/test-hashutil.py` & `mercurial-6.5rc0/tests/test-hashutil.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-help-hide.t` & `mercurial-6.5rc0/tests/test-help-hide.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-help.t` & `mercurial-6.5rc0/tests/test-help.t`

 * *Files 0% similar despite different names*

```diff
@@ -983,14 +983,19 @@
    debug-repair-issue6528
                  find affected revisions and repair them. See issue6528 for more
                  details.
    debug-revlog-index
                  dump index data for a revlog
    debug-revlog-stats
                  display statistics about revlogs in the store
+   debug::stable-tail-sort
+                 display the stable-tail sort of the ancestors of a given node
+   debug::stable-tail-sort-leaps
+                 display the leaps in the stable-tail sort of a node, one per
+                 line
    debugancestor
                  find the ancestor revision of two revisions in a given index
    debugantivirusrunning
                  attempt to trigger an antivirus scanner to see if one is active
    debugapplystreamclonebundle
                  apply a stream clone bundle file
    debugbackupbundle
@@ -1776,15 +1781,18 @@
    narrow       create clones which fetch history data for subset of files
                 (EXPERIMENTAL)
    prefixedname matched against word "clone"
    relink       recreates hardlinks between repository clones
   
   Extension Commands:
   
-   qclone clone main and patch repository at same time
+   admin::clone-bundles-clear   remove existing clone bundle caches
+   admin::clone-bundles-refresh generate clone bundles according to the
+                                configuration
+   qclone                       clone main and patch repository at same time
 
 Test unfound topic
 
   $ hg help nonexistingtopicthatwillneverexisteverever
   abort: no such help topic: nonexistingtopicthatwillneverexisteverever
   (try 'hg help --keyword nonexistingtopicthatwillneverexisteverever')
   [10]
@@ -1984,15 +1992,15 @@
 replacement makes message meaningless.
 
 This tests that section lookup by translated string isn't broken by
 such str.lower().
 
   $ "$PYTHON" <<EOF
   > def escape(s):
-  >     return b''.join(b'\\u%x' % ord(uc) for uc in s.decode('cp932'))
+  >     return b''.join(br'\\u%x' % ord(uc) for uc in s.decode('cp932'))
   > # translation of "record" in ja_JP.cp932
   > upper = b"\x8bL\x98^"
   > # str.lower()-ed section name should be treated as different one
   > lower = b"\x8bl\x98^"
   > with open('ambiguous.py', 'wb') as fp:
   >     fp.write(b"""# ambiguous section names in ja_JP.cp932
   > u'''summary of extension
```

### Comparing `mercurial-6.4rc0/tests/test-hg-parseurl.py` & `mercurial-6.5rc0/tests/test-hg-parseurl.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hghave.t` & `mercurial-6.5rc0/tests/test-hghave.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgignore.t` & `mercurial-6.5rc0/tests/test-hgignore.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgk.t` & `mercurial-6.5rc0/tests/test-hgk.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgrc.t` & `mercurial-6.5rc0/tests/test-hgrc.t`

 * *Files 1% similar despite different names*

```diff
@@ -55,15 +55,15 @@
   $ echo 'option = value' >> $TESTTMP/included
   $ echo '%include $TESTTMP/included' >> $HGRC
   $ hg showconfig section
   section.option=value
 #if unix-permissions no-root
   $ chmod u-r $TESTTMP/included
   $ hg showconfig section
-  config error at $TESTTMP/hgrc:2: cannot include $TESTTMP/included (Permission denied*) (glob)
+  config error at $TESTTMP/hgrc:2: cannot include $TESTTMP/included ($EACCES$*) (glob)
   [255]
 #endif
 
 issue1829: wrong indentation
 
   $ echo '[foo]' > $HGRC
   $ echo '  x = y' >> $HGRC
```

### Comparing `mercurial-6.4rc0/tests/test-hgweb-annotate-whitespace.t` & `mercurial-6.5rc0/tests/test-hgweb-annotate-whitespace.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-auth.py` & `mercurial-6.5rc0/tests/test-hgweb-auth.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-auth.py.out` & `mercurial-6.5rc0/tests/test-hgweb-auth.py.out`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-bundle.t` & `mercurial-6.5rc0/tests/test-hgweb-bundle.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-commands.t` & `mercurial-6.5rc0/tests/test-hgweb-commands.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-csp.t` & `mercurial-6.5rc0/tests/test-hgweb-csp.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-descend-empties.t` & `mercurial-6.5rc0/tests/test-hgweb-descend-empties.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-diffs.t` & `mercurial-6.5rc0/tests/test-hgweb-diffs.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-empty.t` & `mercurial-6.5rc0/tests/test-hgweb-empty.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-filelog.t` & `mercurial-6.5rc0/tests/test-hgweb-filelog.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-head.t` & `mercurial-6.5rc0/tests/test-hgweb-head.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-json.t` & `mercurial-6.5rc0/tests/test-hgweb-json.t`

 * *Files 1% similar despite different names*

```diff
@@ -773,14 +773,15 @@
 
   $ request json-rev
   200 Script output follows
   
   {
     "bookmarks": [],
     "branch": "default",
+    "children": [],
     "date": [
       0.0,
       0
     ],
     "desc": "merge test-branch into default",
     "diff": [],
     "files": [
@@ -805,14 +806,17 @@
 
   $ request json-rev/78896eb0e102
   200 Script output follows
   
   {
     "bookmarks": [],
     "branch": "default",
+    "children": [
+      "93a8ce14f89156426b7fa981af8042da53f03aa0"
+    ],
     "date": [
       0.0,
       0
     ],
     "desc": "move foo",
     "diff": [
       {
@@ -893,14 +897,17 @@
   200 Script output follows
   
   {
     "bookmarks": [
       "bookmark1"
     ],
     "branch": "default",
+    "children": [
+      "78896eb0e102174ce9278438a95e12543e4367a7"
+    ],
     "date": [
       0.0,
       0
     ],
     "desc": "modify da/foo",
     "diff": [
       {
@@ -953,14 +960,17 @@
 
   $ request json-rev/6ab967a8ab34
   200 Script output follows
   
   {
     "bookmarks": [],
     "branch": "test-branch",
+    "children": [
+      "ed66c30e87eb65337c05a4229efaa5f1d5285a90"
+    ],
     "date": [
       0.0,
       0
     ],
     "desc": "create test branch",
     "diff": [
       {
```

### Comparing `mercurial-6.4rc0/tests/test-hgweb-no-path-info.t` & `mercurial-6.5rc0/tests/test-hgweb-no-path-info.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-no-request-uri.t` & `mercurial-6.5rc0/tests/test-hgweb-no-request-uri.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-non-interactive.t` & `mercurial-6.5rc0/tests/test-hgweb-non-interactive.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-raw.t` & `mercurial-6.5rc0/tests/test-hgweb-raw.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-removed.t` & `mercurial-6.5rc0/tests/test-hgweb-removed.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb-symrev.t` & `mercurial-6.5rc0/tests/test-hgweb-symrev.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgweb.t` & `mercurial-6.5rc0/tests/test-hgweb.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgwebdir-gc.py` & `mercurial-6.5rc0/tests/test-hgwebdir-gc.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgwebdir-paths.py` & `mercurial-6.5rc0/tests/test-hgwebdir-paths.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgwebdir.t` & `mercurial-6.5rc0/tests/test-hgwebdir.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hgwebdirsym.t` & `mercurial-6.5rc0/tests/test-hgwebdirsym.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-highlight.t` & `mercurial-6.5rc0/tests/test-highlight.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-arguments.t` & `mercurial-6.5rc0/tests/test-histedit-arguments.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-base.t` & `mercurial-6.5rc0/tests/test-histedit-base.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-bookmark-motion.t` & `mercurial-6.5rc0/tests/test-histedit-bookmark-motion.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-commute.t` & `mercurial-6.5rc0/tests/test-histedit-commute.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-drop.t` & `mercurial-6.5rc0/tests/test-histedit-drop.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-edit.t` & `mercurial-6.5rc0/tests/test-histedit-edit.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-fold-non-commute.t` & `mercurial-6.5rc0/tests/test-histedit-fold-non-commute.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-fold.t` & `mercurial-6.5rc0/tests/test-histedit-fold.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-merge-tools.t` & `mercurial-6.5rc0/tests/test-histedit-merge-tools.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-no-backup.t` & `mercurial-6.5rc0/tests/test-histedit-no-backup.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-no-change.t` & `mercurial-6.5rc0/tests/test-histedit-no-change.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-non-commute-abort.t` & `mercurial-6.5rc0/tests/test-histedit-non-commute-abort.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-non-commute.t` & `mercurial-6.5rc0/tests/test-histedit-non-commute.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-obsolete.t` & `mercurial-6.5rc0/tests/test-histedit-obsolete.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-outgoing.t` & `mercurial-6.5rc0/tests/test-histedit-outgoing.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-histedit-templates.t` & `mercurial-6.5rc0/tests/test-histedit-templates.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hook.t` & `mercurial-6.5rc0/tests/test-hook.t`

 * *Files 2% similar despite different names*

```diff
@@ -798,1686 +798,1706 @@
 000031d0: 2f73 746f 7265 2f0a 2020 3030 6368 616e  /store/.  00chan
 000031e0: 6765 6c6f 672e 690a 2020 3030 6d61 6e69  gelog.i.  00mani
 000031f0: 6665 7374 2e69 0a20 2064 6174 610a 2020  fest.i.  data.  
 00003200: 666e 6361 6368 6520 2872 6570 6f66 6e63  fncache (repofnc
 00003210: 6163 6865 2021 290a 2020 7068 6173 6572  ache !).  phaser
 00003220: 6f6f 7473 0a20 2072 6571 7569 7265 730a  oots.  requires.
 00003230: 2020 756e 646f 0a20 2075 6e64 6f2e 6261    undo.  undo.ba
-00003240: 636b 7570 2e66 6e63 6163 6865 2028 7265  ckup.fncache (re
-00003250: 706f 666e 6361 6368 6520 2129 0a20 2075  pofncache !).  u
-00003260: 6e64 6f2e 6261 636b 7570 6669 6c65 730a  ndo.backupfiles.
-00003270: 0a0a 7072 6563 6f6d 6d69 7420 686f 6f6b  ..precommit hook
-00003280: 2063 616e 2070 7265 7665 6e74 2063 6f6d   can prevent com
-00003290: 6d69 740a 0a20 2024 2063 6174 203e 3e20  mit..  $ cat >> 
-000032a0: 2e68 672f 6867 7263 203c 3c45 4f46 0a20  .hg/hgrc <<EOF. 
-000032b0: 203e 2070 7265 636f 6d6d 6974 2e66 6f72   > precommit.for
-000032c0: 6269 6420 3d20 7368 202d 6320 2270 7269  bid = sh -c "pri
-000032d0: 6e74 656e 762e 7079 202d 2d6c 696e 6520  ntenv.py --line 
-000032e0: 7072 6563 6f6d 6d69 742e 666f 7262 6964  precommit.forbid
-000032f0: 2031 220a 2020 3e20 454f 460a 2020 2420   1".  > EOF.  $ 
-00003300: 6867 2063 6f6d 6d69 7420 2d6d 2027 6661  hg commit -m 'fa
-00003310: 696c 2720 2d64 2027 3420 3027 0a20 2070  il' -d '4 0'.  p
-00003320: 7265 636f 6d6d 6974 2068 6f6f 6b3a 2048  recommit hook: H
-00003330: 475f 484f 4f4b 4e41 4d45 3d70 7265 636f  G_HOOKNAME=preco
-00003340: 6d6d 6974 0a20 2048 475f 484f 4f4b 5459  mmit.  HG_HOOKTY
-00003350: 5045 3d70 7265 636f 6d6d 6974 0a20 2048  PE=precommit.  H
-00003360: 475f 5041 5245 4e54 313d 3533 3965 3462  G_PARENT1=539e4b
-00003370: 3331 6236 6463 3939 6233 6366 6261 6136  31b6dc99b3cfbaa6
-00003380: 6235 3363 6263 3163 3166 3961 3165 3361  b53cbc1c1f9a1e3a
-00003390: 3130 0a20 200a 2020 7072 6563 6f6d 6d69  10.  .  precommi
-000033a0: 742e 666f 7262 6964 2068 6f6f 6b3a 2048  t.forbid hook: H
-000033b0: 475f 484f 4f4b 4e41 4d45 3d70 7265 636f  G_HOOKNAME=preco
-000033c0: 6d6d 6974 2e66 6f72 6269 640a 2020 4847  mmit.forbid.  HG
-000033d0: 5f48 4f4f 4b54 5950 453d 7072 6563 6f6d  _HOOKTYPE=precom
-000033e0: 6d69 740a 2020 4847 5f50 4152 454e 5431  mit.  HG_PARENT1
-000033f0: 3d35 3339 6534 6233 3162 3664 6339 3962  =539e4b31b6dc99b
-00003400: 3363 6662 6161 3662 3533 6362 6331 6331  3cfbaa6b53cbc1c1
-00003410: 6639 6131 6533 6131 300a 2020 0a20 2061  f9a1e3a10.  .  a
-00003420: 626f 7274 3a20 7072 6563 6f6d 6d69 742e  bort: precommit.
-00003430: 666f 7262 6964 2068 6f6f 6b20 6578 6974  forbid hook exit
-00003440: 6564 2077 6974 6820 7374 6174 7573 2031  ed with status 1
-00003450: 0a20 205b 3430 5d0a 2020 2420 6867 202d  .  [40].  $ hg -
-00003460: 7120 7469 700a 2020 343a 3533 3965 3462  q tip.  4:539e4b
-00003470: 3331 6236 6463 0a0a 7072 6575 7064 6174  31b6dc..preupdat
-00003480: 6520 686f 6f6b 2063 616e 2070 7265 7665  e hook can preve
-00003490: 6e74 2075 7064 6174 650a 0a20 2024 2063  nt update..  $ c
-000034a0: 6174 203e 3e20 2e68 672f 6867 7263 203c  at >> .hg/hgrc <
-000034b0: 3c45 4f46 0a20 203e 2070 7265 7570 6461  <EOF.  > preupda
-000034c0: 7465 203d 2073 6820 2d63 2022 7072 696e  te = sh -c "prin
-000034d0: 7465 6e76 2e70 7920 2d2d 6c69 6e65 2070  tenv.py --line p
-000034e0: 7265 7570 6461 7465 220a 2020 3e20 454f  reupdate".  > EO
-000034f0: 460a 2020 2420 6867 2075 7064 6174 6520  F.  $ hg update 
-00003500: 310a 2020 7072 6575 7064 6174 6520 686f  1.  preupdate ho
-00003510: 6f6b 3a20 4847 5f48 4f4f 4b4e 414d 453d  ok: HG_HOOKNAME=
-00003520: 7072 6575 7064 6174 650a 2020 4847 5f48  preupdate.  HG_H
-00003530: 4f4f 4b54 5950 453d 7072 6575 7064 6174  OOKTYPE=preupdat
-00003540: 650a 2020 4847 5f50 4152 454e 5431 3d61  e.  HG_PARENT1=a
-00003550: 6232 3238 3938 3063 3134 640a 2020 0a20  b228980c14d.  . 
-00003560: 2030 2066 696c 6573 2075 7064 6174 6564   0 files updated
-00003570: 2c20 3020 6669 6c65 7320 6d65 7267 6564  , 0 files merged
-00003580: 2c20 3220 6669 6c65 7320 7265 6d6f 7665  , 2 files remove
-00003590: 642c 2030 2066 696c 6573 2075 6e72 6573  d, 0 files unres
-000035a0: 6f6c 7665 640a 0a75 7064 6174 6520 686f  olved..update ho
-000035b0: 6f6b 0a0a 2020 2420 6361 7420 3e3e 202e  ok..  $ cat >> .
-000035c0: 6867 2f68 6772 6320 3c3c 454f 460a 2020  hg/hgrc <<EOF.  
-000035d0: 3e20 7570 6461 7465 203d 2073 6820 2d63  > update = sh -c
-000035e0: 2022 7072 696e 7465 6e76 2e70 7920 2d2d   "printenv.py --
-000035f0: 6c69 6e65 2075 7064 6174 6522 0a20 203e  line update".  >
-00003600: 2045 4f46 0a20 2024 2068 6720 7570 6461   EOF.  $ hg upda
-00003610: 7465 0a20 2070 7265 7570 6461 7465 2068  te.  preupdate h
-00003620: 6f6f 6b3a 2048 475f 484f 4f4b 4e41 4d45  ook: HG_HOOKNAME
-00003630: 3d70 7265 7570 6461 7465 0a20 2048 475f  =preupdate.  HG_
-00003640: 484f 4f4b 5459 5045 3d70 7265 7570 6461  HOOKTYPE=preupda
-00003650: 7465 0a20 2048 475f 5041 5245 4e54 313d  te.  HG_PARENT1=
-00003660: 3533 3965 3462 3331 6236 6463 0a20 200a  539e4b31b6dc.  .
-00003670: 2020 7570 6461 7465 2068 6f6f 6b3a 2048    update hook: H
-00003680: 475f 4552 524f 523d 300a 2020 4847 5f48  G_ERROR=0.  HG_H
-00003690: 4f4f 4b4e 414d 453d 7570 6461 7465 0a20  OOKNAME=update. 
-000036a0: 2048 475f 484f 4f4b 5459 5045 3d75 7064   HG_HOOKTYPE=upd
-000036b0: 6174 650a 2020 4847 5f50 4152 454e 5431  ate.  HG_PARENT1
-000036c0: 3d35 3339 6534 6233 3162 3664 630a 2020  =539e4b31b6dc.  
-000036d0: 0a20 2032 2066 696c 6573 2075 7064 6174  .  2 files updat
-000036e0: 6564 2c20 3020 6669 6c65 7320 6d65 7267  ed, 0 files merg
-000036f0: 6564 2c20 3020 6669 6c65 7320 7265 6d6f  ed, 0 files remo
-00003700: 7665 642c 2030 2066 696c 6573 2075 6e72  ved, 0 files unr
-00003710: 6573 6f6c 7665 640a 0a70 7573 686b 6579  esolved..pushkey
-00003720: 2068 6f6f 6b0a 0a20 2024 2063 6174 203e   hook..  $ cat >
-00003730: 3e20 2e68 672f 6867 7263 203c 3c45 4f46  > .hg/hgrc <<EOF
-00003740: 0a20 203e 2070 7573 686b 6579 203d 2073  .  > pushkey = s
-00003750: 6820 2d63 2022 7072 696e 7465 6e76 2e70  h -c "printenv.p
-00003760: 7920 2d2d 6c69 6e65 2070 7573 686b 6579  y --line pushkey
-00003770: 220a 2020 3e20 454f 460a 2020 2420 6364  ".  > EOF.  $ cd
-00003780: 202e 2e2f 620a 2020 2420 6867 2062 6f6f   ../b.  $ hg boo
-00003790: 6b6d 6172 6b20 2d72 206e 756c 6c20 666f  kmark -r null fo
-000037a0: 6f0a 2020 2420 6867 2070 7573 6820 2d42  o.  $ hg push -B
-000037b0: 2066 6f6f 202e 2e2f 610a 2020 7075 7368   foo ../a.  push
-000037c0: 696e 6720 746f 202e 2e2f 610a 2020 7365  ing to ../a.  se
-000037d0: 6172 6368 696e 6720 666f 7220 6368 616e  arching for chan
-000037e0: 6765 730a 2020 6e6f 2063 6861 6e67 6573  ges.  no changes
-000037f0: 2066 6f75 6e64 0a20 2070 7265 7478 6e6f   found.  pretxno
-00003800: 7065 6e20 686f 6f6b 3a20 4847 5f48 4f4f  pen hook: HG_HOO
-00003810: 4b4e 414d 453d 7072 6574 786e 6f70 656e  KNAME=pretxnopen
-00003820: 0a20 2048 475f 484f 4f4b 5459 5045 3d70  .  HG_HOOKTYPE=p
-00003830: 7265 7478 6e6f 7065 6e0a 2020 4847 5f54  retxnopen.  HG_T
-00003840: 584e 4944 3d54 584e 3a24 4944 240a 2020  XNID=TXN:$ID$.  
-00003850: 4847 5f54 584e 4e41 4d45 3d70 7573 680a  HG_TXNNAME=push.
-00003860: 2020 0a20 2070 7265 7478 6e63 6c6f 7365    .  pretxnclose
-00003870: 2068 6f6f 6b3a 2048 475f 424f 4f4b 4d41   hook: HG_BOOKMA
-00003880: 524b 5f4d 4f56 4544 3d31 0a20 2048 475f  RK_MOVED=1.  HG_
-00003890: 4255 4e44 4c45 323d 310a 2020 4847 5f48  BUNDLE2=1.  HG_H
-000038a0: 4f4f 4b4e 414d 453d 7072 6574 786e 636c  OOKNAME=pretxncl
-000038b0: 6f73 650a 2020 4847 5f48 4f4f 4b54 5950  ose.  HG_HOOKTYP
-000038c0: 453d 7072 6574 786e 636c 6f73 650a 2020  E=pretxnclose.  
-000038d0: 4847 5f50 454e 4449 4e47 3d24 5445 5354  HG_PENDING=$TEST
-000038e0: 544d 502f 610a 2020 4847 5f53 4f55 5243  TMP/a.  HG_SOURC
-000038f0: 453d 7075 7368 0a20 2048 475f 5458 4e49  E=push.  HG_TXNI
-00003900: 443d 5458 4e3a 2449 4424 0a20 2048 475f  D=TXN:$ID$.  HG_
-00003910: 5458 4e4e 414d 453d 7075 7368 0a20 2048  TXNNAME=push.  H
-00003920: 475f 5552 4c3d 6669 6c65 3a24 5445 5354  G_URL=file:$TEST
-00003930: 544d 502f 610a 2020 0a20 2070 7573 686b  TMP/a.  .  pushk
-00003940: 6579 2068 6f6f 6b3a 2048 475f 4255 4e44  ey hook: HG_BUND
-00003950: 4c45 323d 310a 2020 4847 5f48 4f4f 4b4e  LE2=1.  HG_HOOKN
-00003960: 414d 453d 7075 7368 6b65 790a 2020 4847  AME=pushkey.  HG
-00003970: 5f48 4f4f 4b54 5950 453d 7075 7368 6b65  _HOOKTYPE=pushke
-00003980: 790a 2020 4847 5f4b 4559 3d66 6f6f 0a20  y.  HG_KEY=foo. 
-00003990: 2048 475f 4e41 4d45 5350 4143 453d 626f   HG_NAMESPACE=bo
-000039a0: 6f6b 6d61 726b 730a 2020 4847 5f4e 4557  okmarks.  HG_NEW
-000039b0: 3d30 3030 3030 3030 3030 3030 3030 3030  =000000000000000
+00003240: 636b 7570 2e66 6e63 6163 6865 2e62 636b  ckup.fncache.bck
+00003250: 2028 7265 706f 666e 6361 6368 6520 2129   (repofncache !)
+00003260: 0a20 2075 6e64 6f2e 6261 636b 7570 6669  .  undo.backupfi
+00003270: 6c65 730a 0a0a 7072 6563 6f6d 6d69 7420  les...precommit 
+00003280: 686f 6f6b 2063 616e 2070 7265 7665 6e74  hook can prevent
+00003290: 2063 6f6d 6d69 740a 0a20 2024 2063 6174   commit..  $ cat
+000032a0: 203e 3e20 2e68 672f 6867 7263 203c 3c45   >> .hg/hgrc <<E
+000032b0: 4f46 0a20 203e 2070 7265 636f 6d6d 6974  OF.  > precommit
+000032c0: 2e66 6f72 6269 6420 3d20 7368 202d 6320  .forbid = sh -c 
+000032d0: 2270 7269 6e74 656e 762e 7079 202d 2d6c  "printenv.py --l
+000032e0: 696e 6520 7072 6563 6f6d 6d69 742e 666f  ine precommit.fo
+000032f0: 7262 6964 2031 220a 2020 3e20 454f 460a  rbid 1".  > EOF.
+00003300: 2020 2420 6867 2063 6f6d 6d69 7420 2d6d    $ hg commit -m
+00003310: 2027 6661 696c 2720 2d64 2027 3420 3027   'fail' -d '4 0'
+00003320: 0a20 2070 7265 636f 6d6d 6974 2068 6f6f  .  precommit hoo
+00003330: 6b3a 2048 475f 484f 4f4b 4e41 4d45 3d70  k: HG_HOOKNAME=p
+00003340: 7265 636f 6d6d 6974 0a20 2048 475f 484f  recommit.  HG_HO
+00003350: 4f4b 5459 5045 3d70 7265 636f 6d6d 6974  OKTYPE=precommit
+00003360: 0a20 2048 475f 5041 5245 4e54 313d 3533  .  HG_PARENT1=53
+00003370: 3965 3462 3331 6236 6463 3939 6233 6366  9e4b31b6dc99b3cf
+00003380: 6261 6136 6235 3363 6263 3163 3166 3961  baa6b53cbc1c1f9a
+00003390: 3165 3361 3130 0a20 200a 2020 7072 6563  1e3a10.  .  prec
+000033a0: 6f6d 6d69 742e 666f 7262 6964 2068 6f6f  ommit.forbid hoo
+000033b0: 6b3a 2048 475f 484f 4f4b 4e41 4d45 3d70  k: HG_HOOKNAME=p
+000033c0: 7265 636f 6d6d 6974 2e66 6f72 6269 640a  recommit.forbid.
+000033d0: 2020 4847 5f48 4f4f 4b54 5950 453d 7072    HG_HOOKTYPE=pr
+000033e0: 6563 6f6d 6d69 740a 2020 4847 5f50 4152  ecommit.  HG_PAR
+000033f0: 454e 5431 3d35 3339 6534 6233 3162 3664  ENT1=539e4b31b6d
+00003400: 6339 3962 3363 6662 6161 3662 3533 6362  c99b3cfbaa6b53cb
+00003410: 6331 6331 6639 6131 6533 6131 300a 2020  c1c1f9a1e3a10.  
+00003420: 0a20 2061 626f 7274 3a20 7072 6563 6f6d  .  abort: precom
+00003430: 6d69 742e 666f 7262 6964 2068 6f6f 6b20  mit.forbid hook 
+00003440: 6578 6974 6564 2077 6974 6820 7374 6174  exited with stat
+00003450: 7573 2031 0a20 205b 3430 5d0a 2020 2420  us 1.  [40].  $ 
+00003460: 6867 202d 7120 7469 700a 2020 343a 3533  hg -q tip.  4:53
+00003470: 3965 3462 3331 6236 6463 0a0a 7072 6575  9e4b31b6dc..preu
+00003480: 7064 6174 6520 686f 6f6b 2063 616e 2070  pdate hook can p
+00003490: 7265 7665 6e74 2075 7064 6174 650a 0a20  revent update.. 
+000034a0: 2024 2063 6174 203e 3e20 2e68 672f 6867   $ cat >> .hg/hg
+000034b0: 7263 203c 3c45 4f46 0a20 203e 2070 7265  rc <<EOF.  > pre
+000034c0: 7570 6461 7465 203d 2073 6820 2d63 2022  update = sh -c "
+000034d0: 7072 696e 7465 6e76 2e70 7920 2d2d 6c69  printenv.py --li
+000034e0: 6e65 2070 7265 7570 6461 7465 220a 2020  ne preupdate".  
+000034f0: 3e20 454f 460a 2020 2420 6867 2075 7064  > EOF.  $ hg upd
+00003500: 6174 6520 310a 2020 7072 6575 7064 6174  ate 1.  preupdat
+00003510: 6520 686f 6f6b 3a20 4847 5f48 4f4f 4b4e  e hook: HG_HOOKN
+00003520: 414d 453d 7072 6575 7064 6174 650a 2020  AME=preupdate.  
+00003530: 4847 5f48 4f4f 4b54 5950 453d 7072 6575  HG_HOOKTYPE=preu
+00003540: 7064 6174 650a 2020 4847 5f50 4152 454e  pdate.  HG_PAREN
+00003550: 5431 3d61 6232 3238 3938 3063 3134 640a  T1=ab228980c14d.
+00003560: 2020 0a20 2030 2066 696c 6573 2075 7064    .  0 files upd
+00003570: 6174 6564 2c20 3020 6669 6c65 7320 6d65  ated, 0 files me
+00003580: 7267 6564 2c20 3220 6669 6c65 7320 7265  rged, 2 files re
+00003590: 6d6f 7665 642c 2030 2066 696c 6573 2075  moved, 0 files u
+000035a0: 6e72 6573 6f6c 7665 640a 0a75 7064 6174  nresolved..updat
+000035b0: 6520 686f 6f6b 0a0a 2020 2420 6361 7420  e hook..  $ cat 
+000035c0: 3e3e 202e 6867 2f68 6772 6320 3c3c 454f  >> .hg/hgrc <<EO
+000035d0: 460a 2020 3e20 7570 6461 7465 203d 2073  F.  > update = s
+000035e0: 6820 2d63 2022 7072 696e 7465 6e76 2e70  h -c "printenv.p
+000035f0: 7920 2d2d 6c69 6e65 2075 7064 6174 6522  y --line update"
+00003600: 0a20 203e 2045 4f46 0a20 2024 2068 6720  .  > EOF.  $ hg 
+00003610: 7570 6461 7465 0a20 2070 7265 7570 6461  update.  preupda
+00003620: 7465 2068 6f6f 6b3a 2048 475f 484f 4f4b  te hook: HG_HOOK
+00003630: 4e41 4d45 3d70 7265 7570 6461 7465 0a20  NAME=preupdate. 
+00003640: 2048 475f 484f 4f4b 5459 5045 3d70 7265   HG_HOOKTYPE=pre
+00003650: 7570 6461 7465 0a20 2048 475f 5041 5245  update.  HG_PARE
+00003660: 4e54 313d 3533 3965 3462 3331 6236 6463  NT1=539e4b31b6dc
+00003670: 0a20 200a 2020 7570 6461 7465 2068 6f6f  .  .  update hoo
+00003680: 6b3a 2048 475f 4552 524f 523d 300a 2020  k: HG_ERROR=0.  
+00003690: 4847 5f48 4f4f 4b4e 414d 453d 7570 6461  HG_HOOKNAME=upda
+000036a0: 7465 0a20 2048 475f 484f 4f4b 5459 5045  te.  HG_HOOKTYPE
+000036b0: 3d75 7064 6174 650a 2020 4847 5f50 4152  =update.  HG_PAR
+000036c0: 454e 5431 3d35 3339 6534 6233 3162 3664  ENT1=539e4b31b6d
+000036d0: 630a 2020 0a20 2032 2066 696c 6573 2075  c.  .  2 files u
+000036e0: 7064 6174 6564 2c20 3020 6669 6c65 7320  pdated, 0 files 
+000036f0: 6d65 7267 6564 2c20 3020 6669 6c65 7320  merged, 0 files 
+00003700: 7265 6d6f 7665 642c 2030 2066 696c 6573  removed, 0 files
+00003710: 2075 6e72 6573 6f6c 7665 640a 0a70 7573   unresolved..pus
+00003720: 686b 6579 2068 6f6f 6b0a 0a20 2024 2063  hkey hook..  $ c
+00003730: 6174 203e 3e20 2e68 672f 6867 7263 203c  at >> .hg/hgrc <
+00003740: 3c45 4f46 0a20 203e 2070 7573 686b 6579  <EOF.  > pushkey
+00003750: 203d 2073 6820 2d63 2022 7072 696e 7465   = sh -c "printe
+00003760: 6e76 2e70 7920 2d2d 6c69 6e65 2070 7573  nv.py --line pus
+00003770: 686b 6579 220a 2020 3e20 454f 460a 2020  hkey".  > EOF.  
+00003780: 2420 6364 202e 2e2f 620a 2020 2420 6867  $ cd ../b.  $ hg
+00003790: 2062 6f6f 6b6d 6172 6b20 2d72 206e 756c   bookmark -r nul
+000037a0: 6c20 666f 6f0a 2020 2420 6867 2070 7573  l foo.  $ hg pus
+000037b0: 6820 2d42 2066 6f6f 202e 2e2f 610a 2020  h -B foo ../a.  
+000037c0: 7075 7368 696e 6720 746f 202e 2e2f 610a  pushing to ../a.
+000037d0: 2020 7365 6172 6368 696e 6720 666f 7220    searching for 
+000037e0: 6368 616e 6765 730a 2020 6e6f 2063 6861  changes.  no cha
+000037f0: 6e67 6573 2066 6f75 6e64 0a20 2070 7265  nges found.  pre
+00003800: 7478 6e6f 7065 6e20 686f 6f6b 3a20 4847  txnopen hook: HG
+00003810: 5f48 4f4f 4b4e 414d 453d 7072 6574 786e  _HOOKNAME=pretxn
+00003820: 6f70 656e 0a20 2048 475f 484f 4f4b 5459  open.  HG_HOOKTY
+00003830: 5045 3d70 7265 7478 6e6f 7065 6e0a 2020  PE=pretxnopen.  
+00003840: 4847 5f54 584e 4944 3d54 584e 3a24 4944  HG_TXNID=TXN:$ID
+00003850: 240a 2020 4847 5f54 584e 4e41 4d45 3d70  $.  HG_TXNNAME=p
+00003860: 7573 680a 2020 0a20 2070 7265 7478 6e63  ush.  .  pretxnc
+00003870: 6c6f 7365 2068 6f6f 6b3a 2048 475f 424f  lose hook: HG_BO
+00003880: 4f4b 4d41 524b 5f4d 4f56 4544 3d31 0a20  OKMARK_MOVED=1. 
+00003890: 2048 475f 4255 4e44 4c45 323d 310a 2020   HG_BUNDLE2=1.  
+000038a0: 4847 5f48 4f4f 4b4e 414d 453d 7072 6574  HG_HOOKNAME=pret
+000038b0: 786e 636c 6f73 650a 2020 4847 5f48 4f4f  xnclose.  HG_HOO
+000038c0: 4b54 5950 453d 7072 6574 786e 636c 6f73  KTYPE=pretxnclos
+000038d0: 650a 2020 4847 5f50 454e 4449 4e47 3d24  e.  HG_PENDING=$
+000038e0: 5445 5354 544d 502f 610a 2020 4847 5f53  TESTTMP/a.  HG_S
+000038f0: 4f55 5243 453d 7075 7368 0a20 2048 475f  OURCE=push.  HG_
+00003900: 5458 4e49 443d 5458 4e3a 2449 4424 0a20  TXNID=TXN:$ID$. 
+00003910: 2048 475f 5458 4e4e 414d 453d 7075 7368   HG_TXNNAME=push
+00003920: 0a20 2048 475f 5552 4c3d 6669 6c65 3a24  .  HG_URL=file:$
+00003930: 5445 5354 544d 502f 610a 2020 0a20 2070  TESTTMP/a.  .  p
+00003940: 7573 686b 6579 2068 6f6f 6b3a 2048 475f  ushkey hook: HG_
+00003950: 4255 4e44 4c45 323d 310a 2020 4847 5f48  BUNDLE2=1.  HG_H
+00003960: 4f4f 4b4e 414d 453d 7075 7368 6b65 790a  OOKNAME=pushkey.
+00003970: 2020 4847 5f48 4f4f 4b54 5950 453d 7075    HG_HOOKTYPE=pu
+00003980: 7368 6b65 790a 2020 4847 5f4b 4559 3d66  shkey.  HG_KEY=f
+00003990: 6f6f 0a20 2048 475f 4e41 4d45 5350 4143  oo.  HG_NAMESPAC
+000039a0: 453d 626f 6f6b 6d61 726b 730a 2020 4847  E=bookmarks.  HG
+000039b0: 5f4e 4557 3d30 3030 3030 3030 3030 3030  _NEW=00000000000
 000039c0: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
-000039d0: 3030 3030 3030 3030 300a 2020 4847 5f50  000000000.  HG_P
-000039e0: 5553 484b 4559 434f 4d50 4154 3d31 0a20  USHKEYCOMPAT=1. 
-000039f0: 2048 475f 534f 5552 4345 3d70 7573 680a   HG_SOURCE=push.
-00003a00: 2020 4847 5f54 584e 4944 3d54 584e 3a24    HG_TXNID=TXN:$
-00003a10: 4944 240a 2020 4847 5f54 584e 4e41 4d45  ID$.  HG_TXNNAME
-00003a20: 3d70 7573 680a 2020 4847 5f55 524c 3d66  =push.  HG_URL=f
-00003a30: 696c 653a 2454 4553 5454 4d50 2f61 0a20  ile:$TESTTMP/a. 
-00003a40: 200a 2020 7478 6e63 6c6f 7365 2068 6f6f   .  txnclose hoo
-00003a50: 6b3a 2048 475f 424f 4f4b 4d41 524b 5f4d  k: HG_BOOKMARK_M
-00003a60: 4f56 4544 3d31 0a20 2048 475f 4255 4e44  OVED=1.  HG_BUND
-00003a70: 4c45 323d 310a 2020 4847 5f48 4f4f 4b4e  LE2=1.  HG_HOOKN
-00003a80: 414d 453d 7478 6e63 6c6f 7365 0a20 2048  AME=txnclose.  H
-00003a90: 475f 484f 4f4b 5459 5045 3d74 786e 636c  G_HOOKTYPE=txncl
-00003aa0: 6f73 650a 2020 4847 5f53 4f55 5243 453d  ose.  HG_SOURCE=
-00003ab0: 7075 7368 0a20 2048 475f 5458 4e49 443d  push.  HG_TXNID=
-00003ac0: 5458 4e3a 2449 4424 0a20 2048 475f 5458  TXN:$ID$.  HG_TX
-00003ad0: 4e4e 414d 453d 7075 7368 0a20 2048 475f  NNAME=push.  HG_
-00003ae0: 5552 4c3d 6669 6c65 3a24 5445 5354 544d  URL=file:$TESTTM
-00003af0: 502f 610a 2020 0a20 2065 7870 6f72 7469  P/a.  .  exporti
-00003b00: 6e67 2062 6f6f 6b6d 6172 6b20 666f 6f0a  ng bookmark foo.
-00003b10: 2020 5b31 5d0a 2020 2420 6364 202e 2e2f    [1].  $ cd ../
-00003b20: 610a 0a6c 6973 746b 6579 7320 686f 6f6b  a..listkeys hook
-00003b30: 0a0a 2020 2420 6361 7420 3e3e 202e 6867  ..  $ cat >> .hg
-00003b40: 2f68 6772 6320 3c3c 454f 460a 2020 3e20  /hgrc <<EOF.  > 
-00003b50: 6c69 7374 6b65 7973 203d 2073 6820 2d63  listkeys = sh -c
-00003b60: 2022 7072 696e 7465 6e76 2e70 7920 2d2d   "printenv.py --
-00003b70: 6c69 6e65 206c 6973 746b 6579 7322 0a20  line listkeys". 
-00003b80: 203e 2045 4f46 0a20 2024 2068 6720 626f   > EOF.  $ hg bo
-00003b90: 6f6b 6d61 726b 202d 7220 6e75 6c6c 2062  okmark -r null b
-00003ba0: 6172 0a20 2070 7265 7478 6e6f 7065 6e20  ar.  pretxnopen 
-00003bb0: 686f 6f6b 3a20 4847 5f48 4f4f 4b4e 414d  hook: HG_HOOKNAM
-00003bc0: 453d 7072 6574 786e 6f70 656e 0a20 2048  E=pretxnopen.  H
-00003bd0: 475f 484f 4f4b 5459 5045 3d70 7265 7478  G_HOOKTYPE=pretx
-00003be0: 6e6f 7065 6e0a 2020 4847 5f54 584e 4944  nopen.  HG_TXNID
-00003bf0: 3d54 584e 3a24 4944 240a 2020 4847 5f54  =TXN:$ID$.  HG_T
-00003c00: 584e 4e41 4d45 3d62 6f6f 6b6d 6172 6b0a  XNNAME=bookmark.
-00003c10: 2020 0a20 2070 7265 7478 6e63 6c6f 7365    .  pretxnclose
-00003c20: 2068 6f6f 6b3a 2048 475f 424f 4f4b 4d41   hook: HG_BOOKMA
-00003c30: 524b 5f4d 4f56 4544 3d31 0a20 2048 475f  RK_MOVED=1.  HG_
-00003c40: 484f 4f4b 4e41 4d45 3d70 7265 7478 6e63  HOOKNAME=pretxnc
-00003c50: 6c6f 7365 0a20 2048 475f 484f 4f4b 5459  lose.  HG_HOOKTY
-00003c60: 5045 3d70 7265 7478 6e63 6c6f 7365 0a20  PE=pretxnclose. 
-00003c70: 2048 475f 5045 4e44 494e 473d 2454 4553   HG_PENDING=$TES
-00003c80: 5454 4d50 2f61 0a20 2048 475f 5458 4e49  TTMP/a.  HG_TXNI
-00003c90: 443d 5458 4e3a 2449 4424 0a20 2048 475f  D=TXN:$ID$.  HG_
-00003ca0: 5458 4e4e 414d 453d 626f 6f6b 6d61 726b  TXNNAME=bookmark
-00003cb0: 0a20 200a 2020 7478 6e63 6c6f 7365 2068  .  .  txnclose h
-00003cc0: 6f6f 6b3a 2048 475f 424f 4f4b 4d41 524b  ook: HG_BOOKMARK
-00003cd0: 5f4d 4f56 4544 3d31 0a20 2048 475f 484f  _MOVED=1.  HG_HO
-00003ce0: 4f4b 4e41 4d45 3d74 786e 636c 6f73 650a  OKNAME=txnclose.
-00003cf0: 2020 4847 5f48 4f4f 4b54 5950 453d 7478    HG_HOOKTYPE=tx
-00003d00: 6e63 6c6f 7365 0a20 2048 475f 5458 4e49  nclose.  HG_TXNI
-00003d10: 443d 5458 4e3a 2449 4424 0a20 2048 475f  D=TXN:$ID$.  HG_
-00003d20: 5458 4e4e 414d 453d 626f 6f6b 6d61 726b  TXNNAME=bookmark
-00003d30: 0a20 200a 2020 2420 6364 202e 2e2f 620a  .  .  $ cd ../b.
-00003d40: 2020 2420 6867 2070 756c 6c20 2d42 2062    $ hg pull -B b
-00003d50: 6172 202e 2e2f 610a 2020 7075 6c6c 696e  ar ../a.  pullin
-00003d60: 6720 6672 6f6d 202e 2e2f 610a 2020 6c69  g from ../a.  li
-00003d70: 7374 6b65 7973 2068 6f6f 6b3a 2048 475f  stkeys hook: HG_
-00003d80: 484f 4f4b 4e41 4d45 3d6c 6973 746b 6579  HOOKNAME=listkey
-00003d90: 730a 2020 4847 5f48 4f4f 4b54 5950 453d  s.  HG_HOOKTYPE=
-00003da0: 6c69 7374 6b65 7973 0a20 2048 475f 4e41  listkeys.  HG_NA
-00003db0: 4d45 5350 4143 453d 626f 6f6b 6d61 726b  MESPACE=bookmark
-00003dc0: 730a 2020 4847 5f56 414c 5545 533d 7b27  s.  HG_VALUES={'
-00003dd0: 6261 7227 3a20 2730 3030 3030 3030 3030  bar': '000000000
+000039d0: 3030 3030 3030 3030 3030 3030 300a 2020  0000000000000.  
+000039e0: 4847 5f50 5553 484b 4559 434f 4d50 4154  HG_PUSHKEYCOMPAT
+000039f0: 3d31 0a20 2048 475f 534f 5552 4345 3d70  =1.  HG_SOURCE=p
+00003a00: 7573 680a 2020 4847 5f54 584e 4944 3d54  ush.  HG_TXNID=T
+00003a10: 584e 3a24 4944 240a 2020 4847 5f54 584e  XN:$ID$.  HG_TXN
+00003a20: 4e41 4d45 3d70 7573 680a 2020 4847 5f55  NAME=push.  HG_U
+00003a30: 524c 3d66 696c 653a 2454 4553 5454 4d50  RL=file:$TESTTMP
+00003a40: 2f61 0a20 200a 2020 7478 6e63 6c6f 7365  /a.  .  txnclose
+00003a50: 2068 6f6f 6b3a 2048 475f 424f 4f4b 4d41   hook: HG_BOOKMA
+00003a60: 524b 5f4d 4f56 4544 3d31 0a20 2048 475f  RK_MOVED=1.  HG_
+00003a70: 4255 4e44 4c45 323d 310a 2020 4847 5f48  BUNDLE2=1.  HG_H
+00003a80: 4f4f 4b4e 414d 453d 7478 6e63 6c6f 7365  OOKNAME=txnclose
+00003a90: 0a20 2048 475f 484f 4f4b 5459 5045 3d74  .  HG_HOOKTYPE=t
+00003aa0: 786e 636c 6f73 650a 2020 4847 5f53 4f55  xnclose.  HG_SOU
+00003ab0: 5243 453d 7075 7368 0a20 2048 475f 5458  RCE=push.  HG_TX
+00003ac0: 4e49 443d 5458 4e3a 2449 4424 0a20 2048  NID=TXN:$ID$.  H
+00003ad0: 475f 5458 4e4e 414d 453d 7075 7368 0a20  G_TXNNAME=push. 
+00003ae0: 2048 475f 5552 4c3d 6669 6c65 3a24 5445   HG_URL=file:$TE
+00003af0: 5354 544d 502f 610a 2020 0a20 2065 7870  STTMP/a.  .  exp
+00003b00: 6f72 7469 6e67 2062 6f6f 6b6d 6172 6b20  orting bookmark 
+00003b10: 666f 6f0a 2020 5b31 5d0a 2020 2420 6364  foo.  [1].  $ cd
+00003b20: 202e 2e2f 610a 0a6c 6973 746b 6579 7320   ../a..listkeys 
+00003b30: 686f 6f6b 0a0a 2020 2420 6361 7420 3e3e  hook..  $ cat >>
+00003b40: 202e 6867 2f68 6772 6320 3c3c 454f 460a   .hg/hgrc <<EOF.
+00003b50: 2020 3e20 6c69 7374 6b65 7973 203d 2073    > listkeys = s
+00003b60: 6820 2d63 2022 7072 696e 7465 6e76 2e70  h -c "printenv.p
+00003b70: 7920 2d2d 6c69 6e65 206c 6973 746b 6579  y --line listkey
+00003b80: 7322 0a20 203e 2045 4f46 0a20 2024 2068  s".  > EOF.  $ h
+00003b90: 6720 626f 6f6b 6d61 726b 202d 7220 6e75  g bookmark -r nu
+00003ba0: 6c6c 2062 6172 0a20 2070 7265 7478 6e6f  ll bar.  pretxno
+00003bb0: 7065 6e20 686f 6f6b 3a20 4847 5f48 4f4f  pen hook: HG_HOO
+00003bc0: 4b4e 414d 453d 7072 6574 786e 6f70 656e  KNAME=pretxnopen
+00003bd0: 0a20 2048 475f 484f 4f4b 5459 5045 3d70  .  HG_HOOKTYPE=p
+00003be0: 7265 7478 6e6f 7065 6e0a 2020 4847 5f54  retxnopen.  HG_T
+00003bf0: 584e 4944 3d54 584e 3a24 4944 240a 2020  XNID=TXN:$ID$.  
+00003c00: 4847 5f54 584e 4e41 4d45 3d62 6f6f 6b6d  HG_TXNNAME=bookm
+00003c10: 6172 6b0a 2020 0a20 2070 7265 7478 6e63  ark.  .  pretxnc
+00003c20: 6c6f 7365 2068 6f6f 6b3a 2048 475f 424f  lose hook: HG_BO
+00003c30: 4f4b 4d41 524b 5f4d 4f56 4544 3d31 0a20  OKMARK_MOVED=1. 
+00003c40: 2048 475f 484f 4f4b 4e41 4d45 3d70 7265   HG_HOOKNAME=pre
+00003c50: 7478 6e63 6c6f 7365 0a20 2048 475f 484f  txnclose.  HG_HO
+00003c60: 4f4b 5459 5045 3d70 7265 7478 6e63 6c6f  OKTYPE=pretxnclo
+00003c70: 7365 0a20 2048 475f 5045 4e44 494e 473d  se.  HG_PENDING=
+00003c80: 2454 4553 5454 4d50 2f61 0a20 2048 475f  $TESTTMP/a.  HG_
+00003c90: 5458 4e49 443d 5458 4e3a 2449 4424 0a20  TXNID=TXN:$ID$. 
+00003ca0: 2048 475f 5458 4e4e 414d 453d 626f 6f6b   HG_TXNNAME=book
+00003cb0: 6d61 726b 0a20 200a 2020 7478 6e63 6c6f  mark.  .  txnclo
+00003cc0: 7365 2068 6f6f 6b3a 2048 475f 424f 4f4b  se hook: HG_BOOK
+00003cd0: 4d41 524b 5f4d 4f56 4544 3d31 0a20 2048  MARK_MOVED=1.  H
+00003ce0: 475f 484f 4f4b 4e41 4d45 3d74 786e 636c  G_HOOKNAME=txncl
+00003cf0: 6f73 650a 2020 4847 5f48 4f4f 4b54 5950  ose.  HG_HOOKTYP
+00003d00: 453d 7478 6e63 6c6f 7365 0a20 2048 475f  E=txnclose.  HG_
+00003d10: 5458 4e49 443d 5458 4e3a 2449 4424 0a20  TXNID=TXN:$ID$. 
+00003d20: 2048 475f 5458 4e4e 414d 453d 626f 6f6b   HG_TXNNAME=book
+00003d30: 6d61 726b 0a20 200a 2020 2420 6364 202e  mark.  .  $ cd .
+00003d40: 2e2f 620a 2020 2420 6867 2070 756c 6c20  ./b.  $ hg pull 
+00003d50: 2d42 2062 6172 202e 2e2f 610a 2020 7075  -B bar ../a.  pu
+00003d60: 6c6c 696e 6720 6672 6f6d 202e 2e2f 610a  lling from ../a.
+00003d70: 2020 6c69 7374 6b65 7973 2068 6f6f 6b3a    listkeys hook:
+00003d80: 2048 475f 484f 4f4b 4e41 4d45 3d6c 6973   HG_HOOKNAME=lis
+00003d90: 746b 6579 730a 2020 4847 5f48 4f4f 4b54  tkeys.  HG_HOOKT
+00003da0: 5950 453d 6c69 7374 6b65 7973 0a20 2048  YPE=listkeys.  H
+00003db0: 475f 4e41 4d45 5350 4143 453d 626f 6f6b  G_NAMESPACE=book
+00003dc0: 6d61 726b 730a 2020 4847 5f56 414c 5545  marks.  HG_VALUE
+00003dd0: 533d 7b27 6261 7227 3a20 2730 3030 3030  S={'bar': '00000
 00003de0: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
-00003df0: 3030 3030 3030 3030 3030 3030 3030 3027  000000000000000'
-00003e00: 2c20 2766 6f6f 273a 2027 3030 3030 3030  , 'foo': '000000
+00003df0: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
+00003e00: 3030 3027 2c20 2766 6f6f 273a 2027 3030  000', 'foo': '00
 00003e10: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
 00003e20: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
-00003e30: 3030 277d 0a20 200a 2020 6e6f 2063 6861  00'}.  .  no cha
-00003e40: 6e67 6573 2066 6f75 6e64 0a20 2061 6464  nges found.  add
-00003e50: 696e 6720 7265 6d6f 7465 2062 6f6f 6b6d  ing remote bookm
-00003e60: 6172 6b20 6261 720a 2020 2420 6364 202e  ark bar.  $ cd .
-00003e70: 2e2f 610a 0a74 6573 7420 7468 6174 2070  ./a..test that p
-00003e80: 7265 7075 7368 6b65 7920 6361 6e20 7072  repushkey can pr
-00003e90: 6576 656e 7420 696e 636f 6d69 6e67 206b  event incoming k
-00003ea0: 6579 730a 0a20 2024 2063 6174 203e 3e20  eys..  $ cat >> 
-00003eb0: 2e68 672f 6867 7263 203c 3c45 4f46 0a20  .hg/hgrc <<EOF. 
-00003ec0: 203e 2070 7265 7075 7368 6b65 7920 3d20   > prepushkey = 
-00003ed0: 7368 202d 6320 2270 7269 6e74 656e 762e  sh -c "printenv.
-00003ee0: 7079 202d 2d6c 696e 6520 7072 6570 7573  py --line prepus
-00003ef0: 686b 6579 2e66 6f72 6269 6420 3122 0a20  hkey.forbid 1". 
-00003f00: 203e 2045 4f46 0a20 2024 2063 6420 2e2e   > EOF.  $ cd ..
-00003f10: 2f62 0a20 2024 2068 6720 626f 6f6b 6d61  /b.  $ hg bookma
-00003f20: 726b 202d 7220 6e75 6c6c 2062 617a 0a20  rk -r null baz. 
-00003f30: 2024 2068 6720 7075 7368 202d 4220 6261   $ hg push -B ba
-00003f40: 7a20 2e2e 2f61 0a20 2070 7573 6869 6e67  z ../a.  pushing
-00003f50: 2074 6f20 2e2e 2f61 0a20 2073 6561 7263   to ../a.  searc
-00003f60: 6869 6e67 2066 6f72 2063 6861 6e67 6573  hing for changes
-00003f70: 0a20 206c 6973 746b 6579 7320 686f 6f6b  .  listkeys hook
-00003f80: 3a20 4847 5f48 4f4f 4b4e 414d 453d 6c69  : HG_HOOKNAME=li
-00003f90: 7374 6b65 7973 0a20 2048 475f 484f 4f4b  stkeys.  HG_HOOK
-00003fa0: 5459 5045 3d6c 6973 746b 6579 730a 2020  TYPE=listkeys.  
-00003fb0: 4847 5f4e 414d 4553 5041 4345 3d70 6861  HG_NAMESPACE=pha
-00003fc0: 7365 730a 2020 4847 5f56 414c 5545 533d  ses.  HG_VALUES=
-00003fd0: 7b27 6362 3961 3966 3331 3462 3862 3037  {'cb9a9f314b8b07
-00003fe0: 6261 3731 3031 3266 6364 6263 3534 3462  ba71012fcdbc544b
-00003ff0: 3561 3464 3832 6666 3562 273a 2027 3127  5a4d82ff5b': '1'
-00004000: 2c20 2770 7562 6c69 7368 696e 6727 3a20  , 'publishing': 
-00004010: 2754 7275 6527 7d0a 2020 0a20 206c 6973  'True'}.  .  lis
-00004020: 746b 6579 7320 686f 6f6b 3a20 4847 5f48  tkeys hook: HG_H
-00004030: 4f4f 4b4e 414d 453d 6c69 7374 6b65 7973  OOKNAME=listkeys
-00004040: 0a20 2048 475f 484f 4f4b 5459 5045 3d6c  .  HG_HOOKTYPE=l
-00004050: 6973 746b 6579 730a 2020 4847 5f4e 414d  istkeys.  HG_NAM
-00004060: 4553 5041 4345 3d62 6f6f 6b6d 6172 6b73  ESPACE=bookmarks
-00004070: 0a20 2048 475f 5641 4c55 4553 3d7b 2762  .  HG_VALUES={'b
-00004080: 6172 273a 2027 3030 3030 3030 3030 3030  ar': '0000000000
+00003e30: 3030 3030 3030 277d 0a20 200a 2020 6e6f  000000'}.  .  no
+00003e40: 2063 6861 6e67 6573 2066 6f75 6e64 0a20   changes found. 
+00003e50: 2061 6464 696e 6720 7265 6d6f 7465 2062   adding remote b
+00003e60: 6f6f 6b6d 6172 6b20 6261 720a 2020 2420  ookmark bar.  $ 
+00003e70: 6364 202e 2e2f 610a 0a74 6573 7420 7468  cd ../a..test th
+00003e80: 6174 2070 7265 7075 7368 6b65 7920 6361  at prepushkey ca
+00003e90: 6e20 7072 6576 656e 7420 696e 636f 6d69  n prevent incomi
+00003ea0: 6e67 206b 6579 730a 0a20 2024 2063 6174  ng keys..  $ cat
+00003eb0: 203e 3e20 2e68 672f 6867 7263 203c 3c45   >> .hg/hgrc <<E
+00003ec0: 4f46 0a20 203e 2070 7265 7075 7368 6b65  OF.  > prepushke
+00003ed0: 7920 3d20 7368 202d 6320 2270 7269 6e74  y = sh -c "print
+00003ee0: 656e 762e 7079 202d 2d6c 696e 6520 7072  env.py --line pr
+00003ef0: 6570 7573 686b 6579 2e66 6f72 6269 6420  epushkey.forbid 
+00003f00: 3122 0a20 203e 2045 4f46 0a20 2024 2063  1".  > EOF.  $ c
+00003f10: 6420 2e2e 2f62 0a20 2024 2068 6720 626f  d ../b.  $ hg bo
+00003f20: 6f6b 6d61 726b 202d 7220 6e75 6c6c 2062  okmark -r null b
+00003f30: 617a 0a20 2024 2068 6720 7075 7368 202d  az.  $ hg push -
+00003f40: 4220 6261 7a20 2e2e 2f61 0a20 2070 7573  B baz ../a.  pus
+00003f50: 6869 6e67 2074 6f20 2e2e 2f61 0a20 2073  hing to ../a.  s
+00003f60: 6561 7263 6869 6e67 2066 6f72 2063 6861  earching for cha
+00003f70: 6e67 6573 0a20 206c 6973 746b 6579 7320  nges.  listkeys 
+00003f80: 686f 6f6b 3a20 4847 5f48 4f4f 4b4e 414d  hook: HG_HOOKNAM
+00003f90: 453d 6c69 7374 6b65 7973 0a20 2048 475f  E=listkeys.  HG_
+00003fa0: 484f 4f4b 5459 5045 3d6c 6973 746b 6579  HOOKTYPE=listkey
+00003fb0: 730a 2020 4847 5f4e 414d 4553 5041 4345  s.  HG_NAMESPACE
+00003fc0: 3d70 6861 7365 730a 2020 4847 5f56 414c  =phases.  HG_VAL
+00003fd0: 5545 533d 7b27 6362 3961 3966 3331 3462  UES={'cb9a9f314b
+00003fe0: 3862 3037 6261 3731 3031 3266 6364 6263  8b07ba71012fcdbc
+00003ff0: 3534 3462 3561 3464 3832 6666 3562 273a  544b5a4d82ff5b':
+00004000: 2027 3127 2c20 2770 7562 6c69 7368 696e   '1', 'publishin
+00004010: 6727 3a20 2754 7275 6527 7d0a 2020 0a20  g': 'True'}.  . 
+00004020: 206c 6973 746b 6579 7320 686f 6f6b 3a20   listkeys hook: 
+00004030: 4847 5f48 4f4f 4b4e 414d 453d 6c69 7374  HG_HOOKNAME=list
+00004040: 6b65 7973 0a20 2048 475f 484f 4f4b 5459  keys.  HG_HOOKTY
+00004050: 5045 3d6c 6973 746b 6579 730a 2020 4847  PE=listkeys.  HG
+00004060: 5f4e 414d 4553 5041 4345 3d62 6f6f 6b6d  _NAMESPACE=bookm
+00004070: 6172 6b73 0a20 2048 475f 5641 4c55 4553  arks.  HG_VALUES
+00004080: 3d7b 2762 6172 273a 2027 3030 3030 3030  ={'bar': '000000
 00004090: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
-000040a0: 3030 3030 3030 3030 3030 3030 3030 272c  00000000000000',
-000040b0: 2027 666f 6f27 3a20 2730 3030 3030 3030   'foo': '0000000
+000040a0: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
+000040b0: 3030 272c 2027 666f 6f27 3a20 2730 3030  00', 'foo': '000
 000040c0: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
 000040d0: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
-000040e0: 3027 7d0a 2020 0a20 206e 6f20 6368 616e  0'}.  .  no chan
-000040f0: 6765 7320 666f 756e 640a 2020 7072 6574  ges found.  pret
-00004100: 786e 6f70 656e 2068 6f6f 6b3a 2048 475f  xnopen hook: HG_
-00004110: 484f 4f4b 4e41 4d45 3d70 7265 7478 6e6f  HOOKNAME=pretxno
-00004120: 7065 6e0a 2020 4847 5f48 4f4f 4b54 5950  pen.  HG_HOOKTYP
-00004130: 453d 7072 6574 786e 6f70 656e 0a20 2048  E=pretxnopen.  H
-00004140: 475f 5458 4e49 443d 5458 4e3a 2449 4424  G_TXNID=TXN:$ID$
-00004150: 0a20 2048 475f 5458 4e4e 414d 453d 7075  .  HG_TXNNAME=pu
-00004160: 7368 0a20 200a 2020 7072 6570 7573 686b  sh.  .  prepushk
-00004170: 6579 2e66 6f72 6269 6420 686f 6f6b 3a20  ey.forbid hook: 
-00004180: 4847 5f42 554e 444c 4532 3d31 0a20 2048  HG_BUNDLE2=1.  H
-00004190: 475f 484f 4f4b 4e41 4d45 3d70 7265 7075  G_HOOKNAME=prepu
-000041a0: 7368 6b65 790a 2020 4847 5f48 4f4f 4b54  shkey.  HG_HOOKT
-000041b0: 5950 453d 7072 6570 7573 686b 6579 0a20  YPE=prepushkey. 
-000041c0: 2048 475f 4b45 593d 6261 7a0a 2020 4847   HG_KEY=baz.  HG
-000041d0: 5f4e 414d 4553 5041 4345 3d62 6f6f 6b6d  _NAMESPACE=bookm
-000041e0: 6172 6b73 0a20 2048 475f 4e45 573d 3030  arks.  HG_NEW=00
-000041f0: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
+000040e0: 3030 3030 3027 7d0a 2020 0a20 206e 6f20  00000'}.  .  no 
+000040f0: 6368 616e 6765 7320 666f 756e 640a 2020  changes found.  
+00004100: 7072 6574 786e 6f70 656e 2068 6f6f 6b3a  pretxnopen hook:
+00004110: 2048 475f 484f 4f4b 4e41 4d45 3d70 7265   HG_HOOKNAME=pre
+00004120: 7478 6e6f 7065 6e0a 2020 4847 5f48 4f4f  txnopen.  HG_HOO
+00004130: 4b54 5950 453d 7072 6574 786e 6f70 656e  KTYPE=pretxnopen
+00004140: 0a20 2048 475f 5458 4e49 443d 5458 4e3a  .  HG_TXNID=TXN:
+00004150: 2449 4424 0a20 2048 475f 5458 4e4e 414d  $ID$.  HG_TXNNAM
+00004160: 453d 7075 7368 0a20 200a 2020 7072 6570  E=push.  .  prep
+00004170: 7573 686b 6579 2e66 6f72 6269 6420 686f  ushkey.forbid ho
+00004180: 6f6b 3a20 4847 5f42 554e 444c 4532 3d31  ok: HG_BUNDLE2=1
+00004190: 0a20 2048 475f 484f 4f4b 4e41 4d45 3d70  .  HG_HOOKNAME=p
+000041a0: 7265 7075 7368 6b65 790a 2020 4847 5f48  repushkey.  HG_H
+000041b0: 4f4f 4b54 5950 453d 7072 6570 7573 686b  OOKTYPE=prepushk
+000041c0: 6579 0a20 2048 475f 4b45 593d 6261 7a0a  ey.  HG_KEY=baz.
+000041d0: 2020 4847 5f4e 414d 4553 5041 4345 3d62    HG_NAMESPACE=b
+000041e0: 6f6f 6b6d 6172 6b73 0a20 2048 475f 4e45  ookmarks.  HG_NE
+000041f0: 573d 3030 3030 3030 3030 3030 3030 3030  W=00000000000000
 00004200: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
-00004210: 3030 3030 3030 0a20 2048 475f 5055 5348  000000.  HG_PUSH
-00004220: 4b45 5943 4f4d 5041 543d 310a 2020 4847  KEYCOMPAT=1.  HG
-00004230: 5f53 4f55 5243 453d 7075 7368 0a20 2048  _SOURCE=push.  H
-00004240: 475f 5458 4e49 443d 5458 4e3a 2449 4424  G_TXNID=TXN:$ID$
-00004250: 0a20 2048 475f 5458 4e4e 414d 453d 7075  .  HG_TXNNAME=pu
-00004260: 7368 0a20 2048 475f 5552 4c3d 6669 6c65  sh.  HG_URL=file
-00004270: 3a24 5445 5354 544d 502f 610a 2020 0a20  :$TESTTMP/a.  . 
-00004280: 2074 786e 6162 6f72 7420 5079 7468 6f6e   txnabort Python
-00004290: 2068 6f6f 6b3a 2062 756e 646c 6532 2c63   hook: bundle2,c
-000042a0: 6861 6e67 6573 2c73 6f75 7263 652c 7478  hanges,source,tx
-000042b0: 6e69 642c 7478 6e6e 616d 652c 7572 6c0a  nid,txnname,url.
-000042c0: 2020 7478 6e61 626f 7274 2068 6f6f 6b3a    txnabort hook:
-000042d0: 2048 475f 4255 4e44 4c45 323d 310a 2020   HG_BUNDLE2=1.  
-000042e0: 4847 5f48 4f4f 4b4e 414d 453d 7478 6e61  HG_HOOKNAME=txna
-000042f0: 626f 7274 2e31 0a20 2048 475f 484f 4f4b  bort.1.  HG_HOOK
-00004300: 5459 5045 3d74 786e 6162 6f72 740a 2020  TYPE=txnabort.  
-00004310: 4847 5f53 4f55 5243 453d 7075 7368 0a20  HG_SOURCE=push. 
-00004320: 2048 475f 5458 4e49 443d 5458 4e3a 2449   HG_TXNID=TXN:$I
-00004330: 4424 0a20 2048 475f 5458 4e4e 414d 453d  D$.  HG_TXNNAME=
-00004340: 7075 7368 0a20 2048 475f 5552 4c3d 6669  push.  HG_URL=fi
-00004350: 6c65 3a24 5445 5354 544d 502f 610a 2020  le:$TESTTMP/a.  
-00004360: 0a20 2061 626f 7274 3a20 7072 6570 7573  .  abort: prepus
-00004370: 686b 6579 2068 6f6f 6b20 6578 6974 6564  hkey hook exited
-00004380: 2077 6974 6820 7374 6174 7573 2031 0a20   with status 1. 
-00004390: 205b 3430 5d0a 2020 2420 6364 202e 2e2f   [40].  $ cd ../
-000043a0: 610a 0a74 6573 7420 7468 6174 2070 7265  a..test that pre
-000043b0: 6c69 7374 6b65 7973 2063 616e 2070 7265  listkeys can pre
-000043c0: 7665 6e74 206c 6973 7469 6e67 206b 6579  vent listing key
-000043d0: 730a 0a20 2024 2063 6174 203e 3e20 2e68  s..  $ cat >> .h
-000043e0: 672f 6867 7263 203c 3c45 4f46 0a20 203e  g/hgrc <<EOF.  >
-000043f0: 2070 7265 6c69 7374 6b65 7973 203d 2073   prelistkeys = s
-00004400: 6820 2d63 2022 7072 696e 7465 6e76 2e70  h -c "printenv.p
-00004410: 7920 2d2d 6c69 6e65 2070 7265 6c69 7374  y --line prelist
-00004420: 6b65 7973 2e66 6f72 6269 6420 3122 0a20  keys.forbid 1". 
-00004430: 203e 2045 4f46 0a20 2024 2068 6720 626f   > EOF.  $ hg bo
-00004440: 6f6b 6d61 726b 202d 7220 6e75 6c6c 2071  okmark -r null q
-00004450: 7575 780a 2020 7072 6574 786e 6f70 656e  uux.  pretxnopen
-00004460: 2068 6f6f 6b3a 2048 475f 484f 4f4b 4e41   hook: HG_HOOKNA
-00004470: 4d45 3d70 7265 7478 6e6f 7065 6e0a 2020  ME=pretxnopen.  
-00004480: 4847 5f48 4f4f 4b54 5950 453d 7072 6574  HG_HOOKTYPE=pret
-00004490: 786e 6f70 656e 0a20 2048 475f 5458 4e49  xnopen.  HG_TXNI
-000044a0: 443d 5458 4e3a 2449 4424 0a20 2048 475f  D=TXN:$ID$.  HG_
-000044b0: 5458 4e4e 414d 453d 626f 6f6b 6d61 726b  TXNNAME=bookmark
-000044c0: 0a20 200a 2020 7072 6574 786e 636c 6f73  .  .  pretxnclos
-000044d0: 6520 686f 6f6b 3a20 4847 5f42 4f4f 4b4d  e hook: HG_BOOKM
-000044e0: 4152 4b5f 4d4f 5645 443d 310a 2020 4847  ARK_MOVED=1.  HG
-000044f0: 5f48 4f4f 4b4e 414d 453d 7072 6574 786e  _HOOKNAME=pretxn
-00004500: 636c 6f73 650a 2020 4847 5f48 4f4f 4b54  close.  HG_HOOKT
-00004510: 5950 453d 7072 6574 786e 636c 6f73 650a  YPE=pretxnclose.
-00004520: 2020 4847 5f50 454e 4449 4e47 3d24 5445    HG_PENDING=$TE
-00004530: 5354 544d 502f 610a 2020 4847 5f54 584e  STTMP/a.  HG_TXN
-00004540: 4944 3d54 584e 3a24 4944 240a 2020 4847  ID=TXN:$ID$.  HG
-00004550: 5f54 584e 4e41 4d45 3d62 6f6f 6b6d 6172  _TXNNAME=bookmar
-00004560: 6b0a 2020 0a20 2074 786e 636c 6f73 6520  k.  .  txnclose 
-00004570: 686f 6f6b 3a20 4847 5f42 4f4f 4b4d 4152  hook: HG_BOOKMAR
-00004580: 4b5f 4d4f 5645 443d 310a 2020 4847 5f48  K_MOVED=1.  HG_H
-00004590: 4f4f 4b4e 414d 453d 7478 6e63 6c6f 7365  OOKNAME=txnclose
-000045a0: 0a20 2048 475f 484f 4f4b 5459 5045 3d74  .  HG_HOOKTYPE=t
-000045b0: 786e 636c 6f73 650a 2020 4847 5f54 584e  xnclose.  HG_TXN
-000045c0: 4944 3d54 584e 3a24 4944 240a 2020 4847  ID=TXN:$ID$.  HG
-000045d0: 5f54 584e 4e41 4d45 3d62 6f6f 6b6d 6172  _TXNNAME=bookmar
-000045e0: 6b0a 2020 0a20 2024 2063 6420 2e2e 2f62  k.  .  $ cd ../b
-000045f0: 0a20 2024 2068 6720 7075 6c6c 202d 4220  .  $ hg pull -B 
-00004600: 7175 7578 202e 2e2f 610a 2020 7075 6c6c  quux ../a.  pull
-00004610: 696e 6720 6672 6f6d 202e 2e2f 610a 2020  ing from ../a.  
-00004620: 7072 656c 6973 746b 6579 732e 666f 7262  prelistkeys.forb
-00004630: 6964 2068 6f6f 6b3a 2048 475f 484f 4f4b  id hook: HG_HOOK
-00004640: 4e41 4d45 3d70 7265 6c69 7374 6b65 7973  NAME=prelistkeys
-00004650: 0a20 2048 475f 484f 4f4b 5459 5045 3d70  .  HG_HOOKTYPE=p
-00004660: 7265 6c69 7374 6b65 7973 0a20 2048 475f  relistkeys.  HG_
-00004670: 4e41 4d45 5350 4143 453d 626f 6f6b 6d61  NAMESPACE=bookma
-00004680: 726b 730a 2020 0a20 2061 626f 7274 3a20  rks.  .  abort: 
-00004690: 7072 656c 6973 746b 6579 7320 686f 6f6b  prelistkeys hook
-000046a0: 2065 7869 7465 6420 7769 7468 2073 7461   exited with sta
-000046b0: 7475 7320 310a 2020 5b34 305d 0a20 2024  tus 1.  [40].  $
-000046c0: 2063 6420 2e2e 2f61 0a20 2024 2072 6d20   cd ../a.  $ rm 
-000046d0: 2e68 672f 6867 7263 0a0a 7072 6563 6861  .hg/hgrc..precha
-000046e0: 6e67 6567 726f 7570 2068 6f6f 6b20 6361  ngegroup hook ca
-000046f0: 6e20 7072 6576 656e 7420 696e 636f 6d69  n prevent incomi
-00004700: 6e67 2063 6861 6e67 6573 0a0a 2020 2420  ng changes..  $ 
-00004710: 6364 202e 2e2f 620a 2020 2420 6867 202d  cd ../b.  $ hg -
-00004720: 7120 7469 700a 2020 333a 3037 6633 3337  q tip.  3:07f337
-00004730: 3663 3165 3635 0a20 2024 2063 6174 203e  6c1e65.  $ cat >
-00004740: 202e 6867 2f68 6772 6320 3c3c 454f 460a   .hg/hgrc <<EOF.
-00004750: 2020 3e20 5b68 6f6f 6b73 5d0a 2020 3e20    > [hooks].  > 
-00004760: 7072 6563 6861 6e67 6567 726f 7570 2e66  prechangegroup.f
-00004770: 6f72 6269 6420 3d20 7368 202d 6320 2270  orbid = sh -c "p
-00004780: 7269 6e74 656e 762e 7079 202d 2d6c 696e  rintenv.py --lin
-00004790: 6520 7072 6563 6861 6e67 6567 726f 7570  e prechangegroup
-000047a0: 2e66 6f72 6269 6420 3122 0a20 203e 2045  .forbid 1".  > E
-000047b0: 4f46 0a20 2024 2068 6720 7075 6c6c 202e  OF.  $ hg pull .
-000047c0: 2e2f 610a 2020 7075 6c6c 696e 6720 6672  ./a.  pulling fr
-000047d0: 6f6d 202e 2e2f 610a 2020 7365 6172 6368  om ../a.  search
-000047e0: 696e 6720 666f 7220 6368 616e 6765 730a  ing for changes.
-000047f0: 2020 7072 6563 6861 6e67 6567 726f 7570    prechangegroup
-00004800: 2e66 6f72 6269 6420 686f 6f6b 3a20 4847  .forbid hook: HG
-00004810: 5f48 4f4f 4b4e 414d 453d 7072 6563 6861  _HOOKNAME=precha
-00004820: 6e67 6567 726f 7570 2e66 6f72 6269 640a  ngegroup.forbid.
-00004830: 2020 4847 5f48 4f4f 4b54 5950 453d 7072    HG_HOOKTYPE=pr
-00004840: 6563 6861 6e67 6567 726f 7570 0a20 2048  echangegroup.  H
-00004850: 475f 534f 5552 4345 3d70 756c 6c0a 2020  G_SOURCE=pull.  
-00004860: 4847 5f54 584e 4944 3d54 584e 3a24 4944  HG_TXNID=TXN:$ID
-00004870: 240a 2020 4847 5f54 584e 4e41 4d45 3d70  $.  HG_TXNNAME=p
-00004880: 756c 6c0a 2020 6669 6c65 3a2f 2a2f 2454  ull.  file:/*/$T
-00004890: 4553 5454 4d50 2f61 2028 676c 6f62 290a  ESTTMP/a (glob).
-000048a0: 2020 4847 5f55 524c 3d66 696c 653a 2454    HG_URL=file:$T
-000048b0: 4553 5454 4d50 2f61 0a20 200a 2020 6162  ESTTMP/a.  .  ab
-000048c0: 6f72 743a 2070 7265 6368 616e 6765 6772  ort: prechangegr
-000048d0: 6f75 702e 666f 7262 6964 2068 6f6f 6b20  oup.forbid hook 
-000048e0: 6578 6974 6564 2077 6974 6820 7374 6174  exited with stat
-000048f0: 7573 2031 0a20 205b 3430 5d0a 0a70 7265  us 1.  [40]..pre
-00004900: 7478 6e63 6861 6e67 6567 726f 7570 2068  txnchangegroup h
-00004910: 6f6f 6b20 6361 6e20 7365 6520 696e 636f  ook can see inco
-00004920: 6d69 6e67 2063 6861 6e67 6573 2c20 6361  ming changes, ca
-00004930: 6e20 726f 6c6c 2062 6163 6b20 7478 6e2c  n roll back txn,
-00004940: 0a69 6e63 6f6d 696e 6720 6368 616e 6765  .incoming change
-00004950: 7320 6e6f 206c 6f6e 6765 7220 7468 6572  s no longer ther
-00004960: 6520 6166 7465 720a 0a20 2024 2063 6174  e after..  $ cat
-00004970: 203e 202e 6867 2f68 6772 6320 3c3c 454f   > .hg/hgrc <<EO
-00004980: 460a 2020 3e20 5b68 6f6f 6b73 5d0a 2020  F.  > [hooks].  
-00004990: 3e20 7072 6574 786e 6368 616e 6765 6772  > pretxnchangegr
-000049a0: 6f75 702e 666f 7262 6964 3020 3d20 6867  oup.forbid0 = hg
-000049b0: 2074 6970 202d 710a 2020 3e20 7072 6574   tip -q.  > pret
-000049c0: 786e 6368 616e 6765 6772 6f75 702e 666f  xnchangegroup.fo
-000049d0: 7262 6964 3120 3d20 7368 202d 6320 2270  rbid1 = sh -c "p
-000049e0: 7269 6e74 656e 762e 7079 202d 2d6c 696e  rintenv.py --lin
-000049f0: 6520 7072 6574 786e 6368 616e 6765 6772  e pretxnchangegr
-00004a00: 6f75 702e 666f 7262 6964 2031 220a 2020  oup.forbid 1".  
-00004a10: 3e20 454f 460a 2020 2420 6867 2070 756c  > EOF.  $ hg pul
-00004a20: 6c20 2e2e 2f61 0a20 2070 756c 6c69 6e67  l ../a.  pulling
-00004a30: 2066 726f 6d20 2e2e 2f61 0a20 2073 6561   from ../a.  sea
-00004a40: 7263 6869 6e67 2066 6f72 2063 6861 6e67  rching for chang
-00004a50: 6573 0a20 2061 6464 696e 6720 6368 616e  es.  adding chan
-00004a60: 6765 7365 7473 0a20 2061 6464 696e 6720  gesets.  adding 
-00004a70: 6d61 6e69 6665 7374 730a 2020 6164 6469  manifests.  addi
-00004a80: 6e67 2066 696c 6520 6368 616e 6765 730a  ng file changes.
-00004a90: 2020 343a 3533 3965 3462 3331 6236 6463    4:539e4b31b6dc
-00004aa0: 0a20 2070 7265 7478 6e63 6861 6e67 6567  .  pretxnchangeg
-00004ab0: 726f 7570 2e66 6f72 6269 6420 686f 6f6b  roup.forbid hook
-00004ac0: 3a20 4847 5f48 4f4f 4b4e 414d 453d 7072  : HG_HOOKNAME=pr
-00004ad0: 6574 786e 6368 616e 6765 6772 6f75 702e  etxnchangegroup.
-00004ae0: 666f 7262 6964 310a 2020 4847 5f48 4f4f  forbid1.  HG_HOO
-00004af0: 4b54 5950 453d 7072 6574 786e 6368 616e  KTYPE=pretxnchan
-00004b00: 6765 6772 6f75 700a 2020 4847 5f4e 4f44  gegroup.  HG_NOD
-00004b10: 453d 3533 3965 3462 3331 6236 6463 3939  E=539e4b31b6dc99
-00004b20: 6233 6366 6261 6136 6235 3363 6263 3163  b3cfbaa6b53cbc1c
-00004b30: 3166 3961 3165 3361 3130 0a20 2048 475f  1f9a1e3a10.  HG_
-00004b40: 4e4f 4445 5f4c 4153 543d 3533 3965 3462  NODE_LAST=539e4b
-00004b50: 3331 6236 6463 3939 6233 6366 6261 6136  31b6dc99b3cfbaa6
-00004b60: 6235 3363 6263 3163 3166 3961 3165 3361  b53cbc1c1f9a1e3a
-00004b70: 3130 0a20 2048 475f 5045 4e44 494e 473d  10.  HG_PENDING=
-00004b80: 2454 4553 5454 4d50 2f62 0a20 2048 475f  $TESTTMP/b.  HG_
-00004b90: 534f 5552 4345 3d70 756c 6c0a 2020 4847  SOURCE=pull.  HG
-00004ba0: 5f54 584e 4944 3d54 584e 3a24 4944 240a  _TXNID=TXN:$ID$.
-00004bb0: 2020 4847 5f54 584e 4e41 4d45 3d70 756c    HG_TXNNAME=pul
-00004bc0: 6c0a 2020 6669 6c65 3a2f 2a2f 2454 4553  l.  file:/*/$TES
-00004bd0: 5454 4d50 2f61 2028 676c 6f62 290a 2020  TTMP/a (glob).  
-00004be0: 4847 5f55 524c 3d66 696c 653a 2454 4553  HG_URL=file:$TES
-00004bf0: 5454 4d50 2f61 0a20 200a 2020 7472 616e  TTMP/a.  .  tran
-00004c00: 7361 6374 696f 6e20 6162 6f72 7421 0a20  saction abort!. 
-00004c10: 2072 6f6c 6c62 6163 6b20 636f 6d70 6c65   rollback comple
-00004c20: 7465 640a 2020 6162 6f72 743a 2070 7265  ted.  abort: pre
-00004c30: 7478 6e63 6861 6e67 6567 726f 7570 2e66  txnchangegroup.f
-00004c40: 6f72 6269 6431 2068 6f6f 6b20 6578 6974  orbid1 hook exit
-00004c50: 6564 2077 6974 6820 7374 6174 7573 2031  ed with status 1
-00004c60: 0a20 205b 3430 5d0a 2020 2420 6867 202d  .  [40].  $ hg -
-00004c70: 7120 7469 700a 2020 333a 3037 6633 3337  q tip.  3:07f337
-00004c80: 3663 3165 3635 0a0a 6f75 7467 6f69 6e67  6c1e65..outgoing
-00004c90: 2068 6f6f 6b73 2063 616e 2073 6565 2065   hooks can see e
-00004ca0: 6e76 2076 6172 730a 0a20 2024 2072 6d20  nv vars..  $ rm 
-00004cb0: 2e68 672f 6867 7263 0a20 2024 2063 6174  .hg/hgrc.  $ cat
-00004cc0: 203e 202e 2e2f 612f 2e68 672f 6867 7263   > ../a/.hg/hgrc
-00004cd0: 203c 3c45 4f46 0a20 203e 205b 686f 6f6b   <<EOF.  > [hook
-00004ce0: 735d 0a20 203e 2070 7265 6f75 7467 6f69  s].  > preoutgoi
-00004cf0: 6e67 203d 2073 6820 2d63 2022 7072 696e  ng = sh -c "prin
-00004d00: 7465 6e76 2e70 7920 2d2d 6c69 6e65 2070  tenv.py --line p
-00004d10: 7265 6f75 7467 6f69 6e67 220a 2020 3e20  reoutgoing".  > 
-00004d20: 6f75 7467 6f69 6e67 203d 2073 6820 2d63  outgoing = sh -c
-00004d30: 2022 7072 696e 7465 6e76 2e70 7920 2d2d   "printenv.py --
-00004d40: 6c69 6e65 206f 7574 676f 696e 6722 0a20  line outgoing". 
-00004d50: 203e 2045 4f46 0a20 2024 2068 6720 7075   > EOF.  $ hg pu
-00004d60: 6c6c 202e 2e2f 610a 2020 7075 6c6c 696e  ll ../a.  pullin
-00004d70: 6720 6672 6f6d 202e 2e2f 610a 2020 7365  g from ../a.  se
-00004d80: 6172 6368 696e 6720 666f 7220 6368 616e  arching for chan
-00004d90: 6765 730a 2020 7072 656f 7574 676f 696e  ges.  preoutgoin
-00004da0: 6720 686f 6f6b 3a20 4847 5f48 4f4f 4b4e  g hook: HG_HOOKN
-00004db0: 414d 453d 7072 656f 7574 676f 696e 670a  AME=preoutgoing.
-00004dc0: 2020 4847 5f48 4f4f 4b54 5950 453d 7072    HG_HOOKTYPE=pr
-00004dd0: 656f 7574 676f 696e 670a 2020 4847 5f53  eoutgoing.  HG_S
-00004de0: 4f55 5243 453d 7075 6c6c 0a20 200a 2020  OURCE=pull.  .  
-00004df0: 6f75 7467 6f69 6e67 2068 6f6f 6b3a 2048  outgoing hook: H
-00004e00: 475f 484f 4f4b 4e41 4d45 3d6f 7574 676f  G_HOOKNAME=outgo
-00004e10: 696e 670a 2020 4847 5f48 4f4f 4b54 5950  ing.  HG_HOOKTYP
-00004e20: 453d 6f75 7467 6f69 6e67 0a20 2048 475f  E=outgoing.  HG_
-00004e30: 4e4f 4445 3d35 3339 6534 6233 3162 3664  NODE=539e4b31b6d
-00004e40: 6339 3962 3363 6662 6161 3662 3533 6362  c99b3cfbaa6b53cb
-00004e50: 6331 6331 6639 6131 6533 6131 300a 2020  c1c1f9a1e3a10.  
-00004e60: 4847 5f53 4f55 5243 453d 7075 6c6c 0a20  HG_SOURCE=pull. 
-00004e70: 200a 2020 6164 6469 6e67 2063 6861 6e67   .  adding chang
-00004e80: 6573 6574 730a 2020 6164 6469 6e67 206d  esets.  adding m
-00004e90: 616e 6966 6573 7473 0a20 2061 6464 696e  anifests.  addin
-00004ea0: 6720 6669 6c65 2063 6861 6e67 6573 0a20  g file changes. 
-00004eb0: 2061 6464 696e 6720 7265 6d6f 7465 2062   adding remote b
-00004ec0: 6f6f 6b6d 6172 6b20 7175 7578 0a20 2061  ookmark quux.  a
-00004ed0: 6464 6564 2031 2063 6861 6e67 6573 6574  dded 1 changeset
-00004ee0: 7320 7769 7468 2031 2063 6861 6e67 6573  s with 1 changes
-00004ef0: 2074 6f20 3120 6669 6c65 730a 2020 6e65   to 1 files.  ne
-00004f00: 7720 6368 616e 6765 7365 7473 2035 3339  w changesets 539
-00004f10: 6534 6233 3162 3664 630a 2020 2872 756e  e4b31b6dc.  (run
-00004f20: 2027 6867 2075 7064 6174 6527 2074 6f20   'hg update' to 
-00004f30: 6765 7420 6120 776f 726b 696e 6720 636f  get a working co
-00004f40: 7079 290a 2020 2420 6867 2072 6f6c 6c62  py).  $ hg rollb
-00004f50: 6163 6b0a 2020 7265 706f 7369 746f 7279  ack.  repository
-00004f60: 2074 6970 2072 6f6c 6c65 6420 6261 636b   tip rolled back
-00004f70: 2074 6f20 7265 7669 7369 6f6e 2033 2028   to revision 3 (
-00004f80: 756e 646f 2070 756c 6c29 0a0a 7072 656f  undo pull)..preo
-00004f90: 7574 676f 696e 6720 686f 6f6b 2063 616e  utgoing hook can
-00004fa0: 2070 7265 7665 6e74 206f 7574 676f 696e   prevent outgoin
-00004fb0: 6720 6368 616e 6765 730a 0a20 2024 2063  g changes..  $ c
-00004fc0: 6174 203e 3e20 2e2e 2f61 2f2e 6867 2f68  at >> ../a/.hg/h
-00004fd0: 6772 6320 3c3c 454f 460a 2020 3e20 7072  grc <<EOF.  > pr
-00004fe0: 656f 7574 676f 696e 672e 666f 7262 6964  eoutgoing.forbid
-00004ff0: 203d 2073 6820 2d63 2022 7072 696e 7465   = sh -c "printe
-00005000: 6e76 2e70 7920 2d2d 6c69 6e65 2070 7265  nv.py --line pre
-00005010: 6f75 7467 6f69 6e67 2e66 6f72 6269 6420  outgoing.forbid 
-00005020: 3122 0a20 203e 2045 4f46 0a20 2024 2068  1".  > EOF.  $ h
-00005030: 6720 7075 6c6c 202e 2e2f 610a 2020 7075  g pull ../a.  pu
-00005040: 6c6c 696e 6720 6672 6f6d 202e 2e2f 610a  lling from ../a.
-00005050: 2020 7365 6172 6368 696e 6720 666f 7220    searching for 
-00005060: 6368 616e 6765 730a 2020 7072 656f 7574  changes.  preout
-00005070: 676f 696e 6720 686f 6f6b 3a20 4847 5f48  going hook: HG_H
-00005080: 4f4f 4b4e 414d 453d 7072 656f 7574 676f  OOKNAME=preoutgo
-00005090: 696e 670a 2020 4847 5f48 4f4f 4b54 5950  ing.  HG_HOOKTYP
-000050a0: 453d 7072 656f 7574 676f 696e 670a 2020  E=preoutgoing.  
-000050b0: 4847 5f53 4f55 5243 453d 7075 6c6c 0a20  HG_SOURCE=pull. 
-000050c0: 200a 2020 7072 656f 7574 676f 696e 672e   .  preoutgoing.
-000050d0: 666f 7262 6964 2068 6f6f 6b3a 2048 475f  forbid hook: HG_
-000050e0: 484f 4f4b 4e41 4d45 3d70 7265 6f75 7467  HOOKNAME=preoutg
-000050f0: 6f69 6e67 2e66 6f72 6269 640a 2020 4847  oing.forbid.  HG
-00005100: 5f48 4f4f 4b54 5950 453d 7072 656f 7574  _HOOKTYPE=preout
-00005110: 676f 696e 670a 2020 4847 5f53 4f55 5243  going.  HG_SOURC
-00005120: 453d 7075 6c6c 0a20 200a 2020 6162 6f72  E=pull.  .  abor
-00005130: 743a 2070 7265 6f75 7467 6f69 6e67 2e66  t: preoutgoing.f
-00005140: 6f72 6269 6420 686f 6f6b 2065 7869 7465  orbid hook exite
-00005150: 6420 7769 7468 2073 7461 7475 7320 310a  d with status 1.
-00005160: 2020 5b34 305d 0a0a 6f75 7467 6f69 6e67    [40]..outgoing
-00005170: 2068 6f6f 6b73 2077 6f72 6b20 666f 7220   hooks work for 
-00005180: 6c6f 6361 6c20 636c 6f6e 6573 0a0a 2020  local clones..  
-00005190: 2420 6364 202e 2e0a 2020 2420 6361 7420  $ cd ...  $ cat 
-000051a0: 3e20 612f 2e68 672f 6867 7263 203c 3c45  > a/.hg/hgrc <<E
-000051b0: 4f46 0a20 203e 205b 686f 6f6b 735d 0a20  OF.  > [hooks]. 
-000051c0: 203e 2070 7265 6f75 7467 6f69 6e67 203d   > preoutgoing =
-000051d0: 2073 6820 2d63 2022 7072 696e 7465 6e76   sh -c "printenv
-000051e0: 2e70 7920 2d2d 6c69 6e65 2070 7265 6f75  .py --line preou
-000051f0: 7467 6f69 6e67 220a 2020 3e20 6f75 7467  tgoing".  > outg
-00005200: 6f69 6e67 203d 2073 6820 2d63 2022 7072  oing = sh -c "pr
-00005210: 696e 7465 6e76 2e70 7920 2d2d 6c69 6e65  intenv.py --line
-00005220: 206f 7574 676f 696e 6722 0a20 203e 2045   outgoing".  > E
-00005230: 4f46 0a20 2024 2068 6720 636c 6f6e 6520  OF.  $ hg clone 
-00005240: 6120 630a 2020 7072 656f 7574 676f 696e  a c.  preoutgoin
-00005250: 6720 686f 6f6b 3a20 4847 5f48 4f4f 4b4e  g hook: HG_HOOKN
-00005260: 414d 453d 7072 656f 7574 676f 696e 670a  AME=preoutgoing.
-00005270: 2020 4847 5f48 4f4f 4b54 5950 453d 7072    HG_HOOKTYPE=pr
-00005280: 656f 7574 676f 696e 670a 2020 4847 5f53  eoutgoing.  HG_S
-00005290: 4f55 5243 453d 636c 6f6e 650a 2020 0a20  OURCE=clone.  . 
-000052a0: 206f 7574 676f 696e 6720 686f 6f6b 3a20   outgoing hook: 
-000052b0: 4847 5f48 4f4f 4b4e 414d 453d 6f75 7467  HG_HOOKNAME=outg
-000052c0: 6f69 6e67 0a20 2048 475f 484f 4f4b 5459  oing.  HG_HOOKTY
-000052d0: 5045 3d6f 7574 676f 696e 670a 2020 4847  PE=outgoing.  HG
-000052e0: 5f4e 4f44 453d 3030 3030 3030 3030 3030  _NODE=0000000000
+00004210: 3030 3030 3030 3030 3030 0a20 2048 475f  0000000000.  HG_
+00004220: 5055 5348 4b45 5943 4f4d 5041 543d 310a  PUSHKEYCOMPAT=1.
+00004230: 2020 4847 5f53 4f55 5243 453d 7075 7368    HG_SOURCE=push
+00004240: 0a20 2048 475f 5458 4e49 443d 5458 4e3a  .  HG_TXNID=TXN:
+00004250: 2449 4424 0a20 2048 475f 5458 4e4e 414d  $ID$.  HG_TXNNAM
+00004260: 453d 7075 7368 0a20 2048 475f 5552 4c3d  E=push.  HG_URL=
+00004270: 6669 6c65 3a24 5445 5354 544d 502f 610a  file:$TESTTMP/a.
+00004280: 2020 0a20 2074 786e 6162 6f72 7420 5079    .  txnabort Py
+00004290: 7468 6f6e 2068 6f6f 6b3a 2062 756e 646c  thon hook: bundl
+000042a0: 6532 2c63 6861 6e67 6573 2c73 6f75 7263  e2,changes,sourc
+000042b0: 652c 7478 6e69 642c 7478 6e6e 616d 652c  e,txnid,txnname,
+000042c0: 7572 6c0a 2020 7478 6e61 626f 7274 2068  url.  txnabort h
+000042d0: 6f6f 6b3a 2048 475f 4255 4e44 4c45 323d  ook: HG_BUNDLE2=
+000042e0: 310a 2020 4847 5f48 4f4f 4b4e 414d 453d  1.  HG_HOOKNAME=
+000042f0: 7478 6e61 626f 7274 2e31 0a20 2048 475f  txnabort.1.  HG_
+00004300: 484f 4f4b 5459 5045 3d74 786e 6162 6f72  HOOKTYPE=txnabor
+00004310: 740a 2020 4847 5f53 4f55 5243 453d 7075  t.  HG_SOURCE=pu
+00004320: 7368 0a20 2048 475f 5458 4e49 443d 5458  sh.  HG_TXNID=TX
+00004330: 4e3a 2449 4424 0a20 2048 475f 5458 4e4e  N:$ID$.  HG_TXNN
+00004340: 414d 453d 7075 7368 0a20 2048 475f 5552  AME=push.  HG_UR
+00004350: 4c3d 6669 6c65 3a24 5445 5354 544d 502f  L=file:$TESTTMP/
+00004360: 610a 2020 0a20 2061 626f 7274 3a20 7072  a.  .  abort: pr
+00004370: 6570 7573 686b 6579 2068 6f6f 6b20 6578  epushkey hook ex
+00004380: 6974 6564 2077 6974 6820 7374 6174 7573  ited with status
+00004390: 2031 0a20 205b 3430 5d0a 2020 2420 6364   1.  [40].  $ cd
+000043a0: 202e 2e2f 610a 0a74 6573 7420 7468 6174   ../a..test that
+000043b0: 2070 7265 6c69 7374 6b65 7973 2063 616e   prelistkeys can
+000043c0: 2070 7265 7665 6e74 206c 6973 7469 6e67   prevent listing
+000043d0: 206b 6579 730a 0a20 2024 2063 6174 203e   keys..  $ cat >
+000043e0: 3e20 2e68 672f 6867 7263 203c 3c45 4f46  > .hg/hgrc <<EOF
+000043f0: 0a20 203e 2070 7265 6c69 7374 6b65 7973  .  > prelistkeys
+00004400: 203d 2073 6820 2d63 2022 7072 696e 7465   = sh -c "printe
+00004410: 6e76 2e70 7920 2d2d 6c69 6e65 2070 7265  nv.py --line pre
+00004420: 6c69 7374 6b65 7973 2e66 6f72 6269 6420  listkeys.forbid 
+00004430: 3122 0a20 203e 2045 4f46 0a20 2024 2068  1".  > EOF.  $ h
+00004440: 6720 626f 6f6b 6d61 726b 202d 7220 6e75  g bookmark -r nu
+00004450: 6c6c 2071 7575 780a 2020 7072 6574 786e  ll quux.  pretxn
+00004460: 6f70 656e 2068 6f6f 6b3a 2048 475f 484f  open hook: HG_HO
+00004470: 4f4b 4e41 4d45 3d70 7265 7478 6e6f 7065  OKNAME=pretxnope
+00004480: 6e0a 2020 4847 5f48 4f4f 4b54 5950 453d  n.  HG_HOOKTYPE=
+00004490: 7072 6574 786e 6f70 656e 0a20 2048 475f  pretxnopen.  HG_
+000044a0: 5458 4e49 443d 5458 4e3a 2449 4424 0a20  TXNID=TXN:$ID$. 
+000044b0: 2048 475f 5458 4e4e 414d 453d 626f 6f6b   HG_TXNNAME=book
+000044c0: 6d61 726b 0a20 200a 2020 7072 6574 786e  mark.  .  pretxn
+000044d0: 636c 6f73 6520 686f 6f6b 3a20 4847 5f42  close hook: HG_B
+000044e0: 4f4f 4b4d 4152 4b5f 4d4f 5645 443d 310a  OOKMARK_MOVED=1.
+000044f0: 2020 4847 5f48 4f4f 4b4e 414d 453d 7072    HG_HOOKNAME=pr
+00004500: 6574 786e 636c 6f73 650a 2020 4847 5f48  etxnclose.  HG_H
+00004510: 4f4f 4b54 5950 453d 7072 6574 786e 636c  OOKTYPE=pretxncl
+00004520: 6f73 650a 2020 4847 5f50 454e 4449 4e47  ose.  HG_PENDING
+00004530: 3d24 5445 5354 544d 502f 610a 2020 4847  =$TESTTMP/a.  HG
+00004540: 5f54 584e 4944 3d54 584e 3a24 4944 240a  _TXNID=TXN:$ID$.
+00004550: 2020 4847 5f54 584e 4e41 4d45 3d62 6f6f    HG_TXNNAME=boo
+00004560: 6b6d 6172 6b0a 2020 0a20 2074 786e 636c  kmark.  .  txncl
+00004570: 6f73 6520 686f 6f6b 3a20 4847 5f42 4f4f  ose hook: HG_BOO
+00004580: 4b4d 4152 4b5f 4d4f 5645 443d 310a 2020  KMARK_MOVED=1.  
+00004590: 4847 5f48 4f4f 4b4e 414d 453d 7478 6e63  HG_HOOKNAME=txnc
+000045a0: 6c6f 7365 0a20 2048 475f 484f 4f4b 5459  lose.  HG_HOOKTY
+000045b0: 5045 3d74 786e 636c 6f73 650a 2020 4847  PE=txnclose.  HG
+000045c0: 5f54 584e 4944 3d54 584e 3a24 4944 240a  _TXNID=TXN:$ID$.
+000045d0: 2020 4847 5f54 584e 4e41 4d45 3d62 6f6f    HG_TXNNAME=boo
+000045e0: 6b6d 6172 6b0a 2020 0a20 2024 2063 6420  kmark.  .  $ cd 
+000045f0: 2e2e 2f62 0a20 2024 2068 6720 7075 6c6c  ../b.  $ hg pull
+00004600: 202d 4220 7175 7578 202e 2e2f 610a 2020   -B quux ../a.  
+00004610: 7075 6c6c 696e 6720 6672 6f6d 202e 2e2f  pulling from ../
+00004620: 610a 2020 7072 656c 6973 746b 6579 732e  a.  prelistkeys.
+00004630: 666f 7262 6964 2068 6f6f 6b3a 2048 475f  forbid hook: HG_
+00004640: 484f 4f4b 4e41 4d45 3d70 7265 6c69 7374  HOOKNAME=prelist
+00004650: 6b65 7973 0a20 2048 475f 484f 4f4b 5459  keys.  HG_HOOKTY
+00004660: 5045 3d70 7265 6c69 7374 6b65 7973 0a20  PE=prelistkeys. 
+00004670: 2048 475f 4e41 4d45 5350 4143 453d 626f   HG_NAMESPACE=bo
+00004680: 6f6b 6d61 726b 730a 2020 0a20 2061 626f  okmarks.  .  abo
+00004690: 7274 3a20 7072 656c 6973 746b 6579 7320  rt: prelistkeys 
+000046a0: 686f 6f6b 2065 7869 7465 6420 7769 7468  hook exited with
+000046b0: 2073 7461 7475 7320 310a 2020 5b34 305d   status 1.  [40]
+000046c0: 0a20 2024 2063 6420 2e2e 2f61 0a20 2024  .  $ cd ../a.  $
+000046d0: 2072 6d20 2e68 672f 6867 7263 0a0a 7072   rm .hg/hgrc..pr
+000046e0: 6563 6861 6e67 6567 726f 7570 2068 6f6f  echangegroup hoo
+000046f0: 6b20 6361 6e20 7072 6576 656e 7420 696e  k can prevent in
+00004700: 636f 6d69 6e67 2063 6861 6e67 6573 0a0a  coming changes..
+00004710: 2020 2420 6364 202e 2e2f 620a 2020 2420    $ cd ../b.  $ 
+00004720: 6867 202d 7120 7469 700a 2020 333a 3037  hg -q tip.  3:07
+00004730: 6633 3337 3663 3165 3635 0a20 2024 2063  f3376c1e65.  $ c
+00004740: 6174 203e 202e 6867 2f68 6772 6320 3c3c  at > .hg/hgrc <<
+00004750: 454f 460a 2020 3e20 5b68 6f6f 6b73 5d0a  EOF.  > [hooks].
+00004760: 2020 3e20 7072 6563 6861 6e67 6567 726f    > prechangegro
+00004770: 7570 2e66 6f72 6269 6420 3d20 7368 202d  up.forbid = sh -
+00004780: 6320 2270 7269 6e74 656e 762e 7079 202d  c "printenv.py -
+00004790: 2d6c 696e 6520 7072 6563 6861 6e67 6567  -line prechangeg
+000047a0: 726f 7570 2e66 6f72 6269 6420 3122 0a20  roup.forbid 1". 
+000047b0: 203e 2045 4f46 0a20 2024 2068 6720 7075   > EOF.  $ hg pu
+000047c0: 6c6c 202e 2e2f 610a 2020 7075 6c6c 696e  ll ../a.  pullin
+000047d0: 6720 6672 6f6d 202e 2e2f 610a 2020 7365  g from ../a.  se
+000047e0: 6172 6368 696e 6720 666f 7220 6368 616e  arching for chan
+000047f0: 6765 730a 2020 7072 6563 6861 6e67 6567  ges.  prechangeg
+00004800: 726f 7570 2e66 6f72 6269 6420 686f 6f6b  roup.forbid hook
+00004810: 3a20 4847 5f48 4f4f 4b4e 414d 453d 7072  : HG_HOOKNAME=pr
+00004820: 6563 6861 6e67 6567 726f 7570 2e66 6f72  echangegroup.for
+00004830: 6269 640a 2020 4847 5f48 4f4f 4b54 5950  bid.  HG_HOOKTYP
+00004840: 453d 7072 6563 6861 6e67 6567 726f 7570  E=prechangegroup
+00004850: 0a20 2048 475f 534f 5552 4345 3d70 756c  .  HG_SOURCE=pul
+00004860: 6c0a 2020 4847 5f54 584e 4944 3d54 584e  l.  HG_TXNID=TXN
+00004870: 3a24 4944 240a 2020 4847 5f54 584e 4e41  :$ID$.  HG_TXNNA
+00004880: 4d45 3d70 756c 6c0a 2020 6669 6c65 3a2f  ME=pull.  file:/
+00004890: 2a2f 2454 4553 5454 4d50 2f61 2028 676c  */$TESTTMP/a (gl
+000048a0: 6f62 290a 2020 4847 5f55 524c 3d66 696c  ob).  HG_URL=fil
+000048b0: 653a 2454 4553 5454 4d50 2f61 0a20 200a  e:$TESTTMP/a.  .
+000048c0: 2020 6162 6f72 743a 2070 7265 6368 616e    abort: prechan
+000048d0: 6765 6772 6f75 702e 666f 7262 6964 2068  gegroup.forbid h
+000048e0: 6f6f 6b20 6578 6974 6564 2077 6974 6820  ook exited with 
+000048f0: 7374 6174 7573 2031 0a20 205b 3430 5d0a  status 1.  [40].
+00004900: 0a70 7265 7478 6e63 6861 6e67 6567 726f  .pretxnchangegro
+00004910: 7570 2068 6f6f 6b20 6361 6e20 7365 6520  up hook can see 
+00004920: 696e 636f 6d69 6e67 2063 6861 6e67 6573  incoming changes
+00004930: 2c20 6361 6e20 726f 6c6c 2062 6163 6b20  , can roll back 
+00004940: 7478 6e2c 0a69 6e63 6f6d 696e 6720 6368  txn,.incoming ch
+00004950: 616e 6765 7320 6e6f 206c 6f6e 6765 7220  anges no longer 
+00004960: 7468 6572 6520 6166 7465 720a 0a20 2024  there after..  $
+00004970: 2063 6174 203e 202e 6867 2f68 6772 6320   cat > .hg/hgrc 
+00004980: 3c3c 454f 460a 2020 3e20 5b68 6f6f 6b73  <<EOF.  > [hooks
+00004990: 5d0a 2020 3e20 7072 6574 786e 6368 616e  ].  > pretxnchan
+000049a0: 6765 6772 6f75 702e 666f 7262 6964 3020  gegroup.forbid0 
+000049b0: 3d20 6867 2074 6970 202d 710a 2020 3e20  = hg tip -q.  > 
+000049c0: 7072 6574 786e 6368 616e 6765 6772 6f75  pretxnchangegrou
+000049d0: 702e 666f 7262 6964 3120 3d20 7368 202d  p.forbid1 = sh -
+000049e0: 6320 2270 7269 6e74 656e 762e 7079 202d  c "printenv.py -
+000049f0: 2d6c 696e 6520 7072 6574 786e 6368 616e  -line pretxnchan
+00004a00: 6765 6772 6f75 702e 666f 7262 6964 2031  gegroup.forbid 1
+00004a10: 220a 2020 3e20 454f 460a 2020 2420 6867  ".  > EOF.  $ hg
+00004a20: 2070 756c 6c20 2e2e 2f61 0a20 2070 756c   pull ../a.  pul
+00004a30: 6c69 6e67 2066 726f 6d20 2e2e 2f61 0a20  ling from ../a. 
+00004a40: 2073 6561 7263 6869 6e67 2066 6f72 2063   searching for c
+00004a50: 6861 6e67 6573 0a20 2061 6464 696e 6720  hanges.  adding 
+00004a60: 6368 616e 6765 7365 7473 0a20 2061 6464  changesets.  add
+00004a70: 696e 6720 6d61 6e69 6665 7374 730a 2020  ing manifests.  
+00004a80: 6164 6469 6e67 2066 696c 6520 6368 616e  adding file chan
+00004a90: 6765 730a 2020 343a 3533 3965 3462 3331  ges.  4:539e4b31
+00004aa0: 6236 6463 0a20 2070 7265 7478 6e63 6861  b6dc.  pretxncha
+00004ab0: 6e67 6567 726f 7570 2e66 6f72 6269 6420  ngegroup.forbid 
+00004ac0: 686f 6f6b 3a20 4847 5f48 4f4f 4b4e 414d  hook: HG_HOOKNAM
+00004ad0: 453d 7072 6574 786e 6368 616e 6765 6772  E=pretxnchangegr
+00004ae0: 6f75 702e 666f 7262 6964 310a 2020 4847  oup.forbid1.  HG
+00004af0: 5f48 4f4f 4b54 5950 453d 7072 6574 786e  _HOOKTYPE=pretxn
+00004b00: 6368 616e 6765 6772 6f75 700a 2020 4847  changegroup.  HG
+00004b10: 5f4e 4f44 453d 3533 3965 3462 3331 6236  _NODE=539e4b31b6
+00004b20: 6463 3939 6233 6366 6261 6136 6235 3363  dc99b3cfbaa6b53c
+00004b30: 6263 3163 3166 3961 3165 3361 3130 0a20  bc1c1f9a1e3a10. 
+00004b40: 2048 475f 4e4f 4445 5f4c 4153 543d 3533   HG_NODE_LAST=53
+00004b50: 3965 3462 3331 6236 6463 3939 6233 6366  9e4b31b6dc99b3cf
+00004b60: 6261 6136 6235 3363 6263 3163 3166 3961  baa6b53cbc1c1f9a
+00004b70: 3165 3361 3130 0a20 2048 475f 5045 4e44  1e3a10.  HG_PEND
+00004b80: 494e 473d 2454 4553 5454 4d50 2f62 0a20  ING=$TESTTMP/b. 
+00004b90: 2048 475f 534f 5552 4345 3d70 756c 6c0a   HG_SOURCE=pull.
+00004ba0: 2020 4847 5f54 584e 4944 3d54 584e 3a24    HG_TXNID=TXN:$
+00004bb0: 4944 240a 2020 4847 5f54 584e 4e41 4d45  ID$.  HG_TXNNAME
+00004bc0: 3d70 756c 6c0a 2020 6669 6c65 3a2f 2a2f  =pull.  file:/*/
+00004bd0: 2454 4553 5454 4d50 2f61 2028 676c 6f62  $TESTTMP/a (glob
+00004be0: 290a 2020 4847 5f55 524c 3d66 696c 653a  ).  HG_URL=file:
+00004bf0: 2454 4553 5454 4d50 2f61 0a20 200a 2020  $TESTTMP/a.  .  
+00004c00: 7472 616e 7361 6374 696f 6e20 6162 6f72  transaction abor
+00004c10: 7421 0a20 2072 6f6c 6c62 6163 6b20 636f  t!.  rollback co
+00004c20: 6d70 6c65 7465 640a 2020 6162 6f72 743a  mpleted.  abort:
+00004c30: 2070 7265 7478 6e63 6861 6e67 6567 726f   pretxnchangegro
+00004c40: 7570 2e66 6f72 6269 6431 2068 6f6f 6b20  up.forbid1 hook 
+00004c50: 6578 6974 6564 2077 6974 6820 7374 6174  exited with stat
+00004c60: 7573 2031 0a20 205b 3430 5d0a 2020 2420  us 1.  [40].  $ 
+00004c70: 6867 202d 7120 7469 700a 2020 333a 3037  hg -q tip.  3:07
+00004c80: 6633 3337 3663 3165 3635 0a0a 6f75 7467  f3376c1e65..outg
+00004c90: 6f69 6e67 2068 6f6f 6b73 2063 616e 2073  oing hooks can s
+00004ca0: 6565 2065 6e76 2076 6172 730a 0a20 2024  ee env vars..  $
+00004cb0: 2072 6d20 2e68 672f 6867 7263 0a20 2024   rm .hg/hgrc.  $
+00004cc0: 2063 6174 203e 202e 2e2f 612f 2e68 672f   cat > ../a/.hg/
+00004cd0: 6867 7263 203c 3c45 4f46 0a20 203e 205b  hgrc <<EOF.  > [
+00004ce0: 686f 6f6b 735d 0a20 203e 2070 7265 6f75  hooks].  > preou
+00004cf0: 7467 6f69 6e67 203d 2073 6820 2d63 2022  tgoing = sh -c "
+00004d00: 7072 696e 7465 6e76 2e70 7920 2d2d 6c69  printenv.py --li
+00004d10: 6e65 2070 7265 6f75 7467 6f69 6e67 220a  ne preoutgoing".
+00004d20: 2020 3e20 6f75 7467 6f69 6e67 203d 2073    > outgoing = s
+00004d30: 6820 2d63 2022 7072 696e 7465 6e76 2e70  h -c "printenv.p
+00004d40: 7920 2d2d 6c69 6e65 206f 7574 676f 696e  y --line outgoin
+00004d50: 6722 0a20 203e 2045 4f46 0a20 2024 2068  g".  > EOF.  $ h
+00004d60: 6720 7075 6c6c 202e 2e2f 610a 2020 7075  g pull ../a.  pu
+00004d70: 6c6c 696e 6720 6672 6f6d 202e 2e2f 610a  lling from ../a.
+00004d80: 2020 7365 6172 6368 696e 6720 666f 7220    searching for 
+00004d90: 6368 616e 6765 730a 2020 7072 656f 7574  changes.  preout
+00004da0: 676f 696e 6720 686f 6f6b 3a20 4847 5f48  going hook: HG_H
+00004db0: 4f4f 4b4e 414d 453d 7072 656f 7574 676f  OOKNAME=preoutgo
+00004dc0: 696e 670a 2020 4847 5f48 4f4f 4b54 5950  ing.  HG_HOOKTYP
+00004dd0: 453d 7072 656f 7574 676f 696e 670a 2020  E=preoutgoing.  
+00004de0: 4847 5f53 4f55 5243 453d 7075 6c6c 0a20  HG_SOURCE=pull. 
+00004df0: 200a 2020 6f75 7467 6f69 6e67 2068 6f6f   .  outgoing hoo
+00004e00: 6b3a 2048 475f 484f 4f4b 4e41 4d45 3d6f  k: HG_HOOKNAME=o
+00004e10: 7574 676f 696e 670a 2020 4847 5f48 4f4f  utgoing.  HG_HOO
+00004e20: 4b54 5950 453d 6f75 7467 6f69 6e67 0a20  KTYPE=outgoing. 
+00004e30: 2048 475f 4e4f 4445 3d35 3339 6534 6233   HG_NODE=539e4b3
+00004e40: 3162 3664 6339 3962 3363 6662 6161 3662  1b6dc99b3cfbaa6b
+00004e50: 3533 6362 6331 6331 6639 6131 6533 6131  53cbc1c1f9a1e3a1
+00004e60: 300a 2020 4847 5f53 4f55 5243 453d 7075  0.  HG_SOURCE=pu
+00004e70: 6c6c 0a20 200a 2020 6164 6469 6e67 2063  ll.  .  adding c
+00004e80: 6861 6e67 6573 6574 730a 2020 6164 6469  hangesets.  addi
+00004e90: 6e67 206d 616e 6966 6573 7473 0a20 2061  ng manifests.  a
+00004ea0: 6464 696e 6720 6669 6c65 2063 6861 6e67  dding file chang
+00004eb0: 6573 0a20 2061 6464 696e 6720 7265 6d6f  es.  adding remo
+00004ec0: 7465 2062 6f6f 6b6d 6172 6b20 7175 7578  te bookmark quux
+00004ed0: 0a20 2061 6464 6564 2031 2063 6861 6e67  .  added 1 chang
+00004ee0: 6573 6574 7320 7769 7468 2031 2063 6861  esets with 1 cha
+00004ef0: 6e67 6573 2074 6f20 3120 6669 6c65 730a  nges to 1 files.
+00004f00: 2020 6e65 7720 6368 616e 6765 7365 7473    new changesets
+00004f10: 2035 3339 6534 6233 3162 3664 630a 2020   539e4b31b6dc.  
+00004f20: 2872 756e 2027 6867 2075 7064 6174 6527  (run 'hg update'
+00004f30: 2074 6f20 6765 7420 6120 776f 726b 696e   to get a workin
+00004f40: 6720 636f 7079 290a 2020 2420 6867 2072  g copy).  $ hg r
+00004f50: 6f6c 6c62 6163 6b0a 2020 7265 706f 7369  ollback.  reposi
+00004f60: 746f 7279 2074 6970 2072 6f6c 6c65 6420  tory tip rolled 
+00004f70: 6261 636b 2074 6f20 7265 7669 7369 6f6e  back to revision
+00004f80: 2033 2028 756e 646f 2070 756c 6c29 0a0a   3 (undo pull)..
+00004f90: 7072 656f 7574 676f 696e 6720 686f 6f6b  preoutgoing hook
+00004fa0: 2063 616e 2070 7265 7665 6e74 206f 7574   can prevent out
+00004fb0: 676f 696e 6720 6368 616e 6765 730a 0a20  going changes.. 
+00004fc0: 2024 2063 6174 203e 3e20 2e2e 2f61 2f2e   $ cat >> ../a/.
+00004fd0: 6867 2f68 6772 6320 3c3c 454f 460a 2020  hg/hgrc <<EOF.  
+00004fe0: 3e20 7072 656f 7574 676f 696e 672e 666f  > preoutgoing.fo
+00004ff0: 7262 6964 203d 2073 6820 2d63 2022 7072  rbid = sh -c "pr
+00005000: 696e 7465 6e76 2e70 7920 2d2d 6c69 6e65  intenv.py --line
+00005010: 2070 7265 6f75 7467 6f69 6e67 2e66 6f72   preoutgoing.for
+00005020: 6269 6420 3122 0a20 203e 2045 4f46 0a20  bid 1".  > EOF. 
+00005030: 2024 2068 6720 7075 6c6c 202e 2e2f 610a   $ hg pull ../a.
+00005040: 2020 7075 6c6c 696e 6720 6672 6f6d 202e    pulling from .
+00005050: 2e2f 610a 2020 7365 6172 6368 696e 6720  ./a.  searching 
+00005060: 666f 7220 6368 616e 6765 730a 2020 7072  for changes.  pr
+00005070: 656f 7574 676f 696e 6720 686f 6f6b 3a20  eoutgoing hook: 
+00005080: 4847 5f48 4f4f 4b4e 414d 453d 7072 656f  HG_HOOKNAME=preo
+00005090: 7574 676f 696e 670a 2020 4847 5f48 4f4f  utgoing.  HG_HOO
+000050a0: 4b54 5950 453d 7072 656f 7574 676f 696e  KTYPE=preoutgoin
+000050b0: 670a 2020 4847 5f53 4f55 5243 453d 7075  g.  HG_SOURCE=pu
+000050c0: 6c6c 0a20 200a 2020 7072 656f 7574 676f  ll.  .  preoutgo
+000050d0: 696e 672e 666f 7262 6964 2068 6f6f 6b3a  ing.forbid hook:
+000050e0: 2048 475f 484f 4f4b 4e41 4d45 3d70 7265   HG_HOOKNAME=pre
+000050f0: 6f75 7467 6f69 6e67 2e66 6f72 6269 640a  outgoing.forbid.
+00005100: 2020 4847 5f48 4f4f 4b54 5950 453d 7072    HG_HOOKTYPE=pr
+00005110: 656f 7574 676f 696e 670a 2020 4847 5f53  eoutgoing.  HG_S
+00005120: 4f55 5243 453d 7075 6c6c 0a20 200a 2020  OURCE=pull.  .  
+00005130: 6162 6f72 743a 2070 7265 6f75 7467 6f69  abort: preoutgoi
+00005140: 6e67 2e66 6f72 6269 6420 686f 6f6b 2065  ng.forbid hook e
+00005150: 7869 7465 6420 7769 7468 2073 7461 7475  xited with statu
+00005160: 7320 310a 2020 5b34 305d 0a0a 6f75 7467  s 1.  [40]..outg
+00005170: 6f69 6e67 2068 6f6f 6b73 2077 6f72 6b20  oing hooks work 
+00005180: 666f 7220 6c6f 6361 6c20 636c 6f6e 6573  for local clones
+00005190: 0a0a 2020 2420 6364 202e 2e0a 2020 2420  ..  $ cd ...  $ 
+000051a0: 6361 7420 3e20 612f 2e68 672f 6867 7263  cat > a/.hg/hgrc
+000051b0: 203c 3c45 4f46 0a20 203e 205b 686f 6f6b   <<EOF.  > [hook
+000051c0: 735d 0a20 203e 2070 7265 6f75 7467 6f69  s].  > preoutgoi
+000051d0: 6e67 203d 2073 6820 2d63 2022 7072 696e  ng = sh -c "prin
+000051e0: 7465 6e76 2e70 7920 2d2d 6c69 6e65 2070  tenv.py --line p
+000051f0: 7265 6f75 7467 6f69 6e67 220a 2020 3e20  reoutgoing".  > 
+00005200: 6f75 7467 6f69 6e67 203d 2073 6820 2d63  outgoing = sh -c
+00005210: 2022 7072 696e 7465 6e76 2e70 7920 2d2d   "printenv.py --
+00005220: 6c69 6e65 206f 7574 676f 696e 6722 0a20  line outgoing". 
+00005230: 203e 2045 4f46 0a20 2024 2068 6720 636c   > EOF.  $ hg cl
+00005240: 6f6e 6520 6120 630a 2020 7072 656f 7574  one a c.  preout
+00005250: 676f 696e 6720 686f 6f6b 3a20 4847 5f48  going hook: HG_H
+00005260: 4f4f 4b4e 414d 453d 7072 656f 7574 676f  OOKNAME=preoutgo
+00005270: 696e 670a 2020 4847 5f48 4f4f 4b54 5950  ing.  HG_HOOKTYP
+00005280: 453d 7072 656f 7574 676f 696e 670a 2020  E=preoutgoing.  
+00005290: 4847 5f53 4f55 5243 453d 636c 6f6e 650a  HG_SOURCE=clone.
+000052a0: 2020 0a20 206f 7574 676f 696e 6720 686f    .  outgoing ho
+000052b0: 6f6b 3a20 4847 5f48 4f4f 4b4e 414d 453d  ok: HG_HOOKNAME=
+000052c0: 6f75 7467 6f69 6e67 0a20 2048 475f 484f  outgoing.  HG_HO
+000052d0: 4f4b 5459 5045 3d6f 7574 676f 696e 670a  OKTYPE=outgoing.
+000052e0: 2020 4847 5f4e 4f44 453d 3030 3030 3030    HG_NODE=000000
 000052f0: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
-00005300: 3030 3030 3030 3030 3030 3030 3030 0a20  00000000000000. 
-00005310: 2048 475f 534f 5552 4345 3d63 6c6f 6e65   HG_SOURCE=clone
-00005320: 0a20 200a 2020 7570 6461 7469 6e67 2074  .  .  updating t
-00005330: 6f20 6272 616e 6368 2064 6566 6175 6c74  o branch default
-00005340: 0a20 2033 2066 696c 6573 2075 7064 6174  .  3 files updat
-00005350: 6564 2c20 3020 6669 6c65 7320 6d65 7267  ed, 0 files merg
-00005360: 6564 2c20 3020 6669 6c65 7320 7265 6d6f  ed, 0 files remo
-00005370: 7665 642c 2030 2066 696c 6573 2075 6e72  ved, 0 files unr
-00005380: 6573 6f6c 7665 640a 2020 2420 726d 202d  esolved.  $ rm -
-00005390: 7266 2063 0a0a 7072 656f 7574 676f 696e  rf c..preoutgoin
-000053a0: 6720 686f 6f6b 2063 616e 2070 7265 7665  g hook can preve
-000053b0: 6e74 206f 7574 676f 696e 6720 6368 616e  nt outgoing chan
-000053c0: 6765 7320 666f 7220 6c6f 6361 6c20 636c  ges for local cl
-000053d0: 6f6e 6573 0a0a 2020 2420 6361 7420 3e3e  ones..  $ cat >>
-000053e0: 2061 2f2e 6867 2f68 6772 6320 3c3c 454f   a/.hg/hgrc <<EO
-000053f0: 460a 2020 3e20 7072 656f 7574 676f 696e  F.  > preoutgoin
-00005400: 672e 666f 7262 6964 203d 2073 6820 2d63  g.forbid = sh -c
-00005410: 2022 7072 696e 7465 6e76 2e70 7920 2d2d   "printenv.py --
-00005420: 6c69 6e65 2070 7265 6f75 7467 6f69 6e67  line preoutgoing
-00005430: 2e66 6f72 6269 6420 3122 0a20 203e 2045  .forbid 1".  > E
-00005440: 4f46 0a20 2024 2068 6720 636c 6f6e 6520  OF.  $ hg clone 
-00005450: 6120 7a7a 7a0a 2020 7072 656f 7574 676f  a zzz.  preoutgo
-00005460: 696e 6720 686f 6f6b 3a20 4847 5f48 4f4f  ing hook: HG_HOO
-00005470: 4b4e 414d 453d 7072 656f 7574 676f 696e  KNAME=preoutgoin
-00005480: 670a 2020 4847 5f48 4f4f 4b54 5950 453d  g.  HG_HOOKTYPE=
-00005490: 7072 656f 7574 676f 696e 670a 2020 4847  preoutgoing.  HG
-000054a0: 5f53 4f55 5243 453d 636c 6f6e 650a 2020  _SOURCE=clone.  
-000054b0: 0a20 2070 7265 6f75 7467 6f69 6e67 2e66  .  preoutgoing.f
-000054c0: 6f72 6269 6420 686f 6f6b 3a20 4847 5f48  orbid hook: HG_H
-000054d0: 4f4f 4b4e 414d 453d 7072 656f 7574 676f  OOKNAME=preoutgo
-000054e0: 696e 672e 666f 7262 6964 0a20 2048 475f  ing.forbid.  HG_
-000054f0: 484f 4f4b 5459 5045 3d70 7265 6f75 7467  HOOKTYPE=preoutg
-00005500: 6f69 6e67 0a20 2048 475f 534f 5552 4345  oing.  HG_SOURCE
-00005510: 3d63 6c6f 6e65 0a20 200a 2020 6162 6f72  =clone.  .  abor
-00005520: 743a 2070 7265 6f75 7467 6f69 6e67 2e66  t: preoutgoing.f
-00005530: 6f72 6269 6420 686f 6f6b 2065 7869 7465  orbid hook exite
-00005540: 6420 7769 7468 2073 7461 7475 7320 310a  d with status 1.
-00005550: 2020 5b34 305d 0a0a 2020 2420 6364 2022    [40]..  $ cd "
-00005560: 2454 4553 5454 4d50 2f62 220a 0a20 2024  $TESTTMP/b"..  $
-00005570: 2063 6174 203e 2068 6f6f 6b74 6573 7473   cat > hooktests
-00005580: 2e70 7920 3c3c 454f 460a 2020 3e20 6672  .py <<EOF.  > fr
-00005590: 6f6d 206d 6572 6375 7269 616c 2069 6d70  om mercurial imp
-000055a0: 6f72 7420 280a 2020 3e20 2020 2020 6572  ort (.  >     er
-000055b0: 726f 722c 0a20 203e 2020 2020 2070 7963  ror,.  >     pyc
-000055c0: 6f6d 7061 742c 0a20 203e 2029 0a20 203e  ompat,.  > ).  >
-000055d0: 200a 2020 3e20 756e 6361 6c6c 6162 6c65   .  > uncallable
-000055e0: 203d 2030 0a20 203e 200a 2020 3e20 6465   = 0.  > .  > de
-000055f0: 6620 7072 696e 7461 7267 7328 7569 2c20  f printargs(ui, 
-00005600: 6172 6773 293a 0a20 203e 2020 2020 2061  args):.  >     a
-00005610: 203d 206c 6973 7428 7079 636f 6d70 6174   = list(pycompat
-00005620: 2e62 7974 6573 6b77 6172 6773 2861 7267  .byteskwargs(arg
-00005630: 7329 2e69 7465 6d73 2829 290a 2020 3e20  s).items()).  > 
-00005640: 2020 2020 612e 736f 7274 2829 0a20 203e      a.sort().  >
-00005650: 2020 2020 2075 692e 7772 6974 6528 6227       ui.write(b'
-00005660: 686f 6f6b 2061 7267 733a 5c6e 2729 0a20  hook args:\n'). 
-00005670: 203e 2020 2020 2066 6f72 206b 2c20 7620   >     for k, v 
-00005680: 696e 2061 3a0a 2020 3e20 2020 2020 2020  in a:.  >       
-00005690: 2075 692e 7772 6974 6528 6227 2020 2573   ui.write(b'  %s
-000056a0: 2025 735c 6e27 2025 2028 6b2c 2076 2929   %s\n' % (k, v))
-000056b0: 0a20 203e 200a 2020 3e20 6465 6620 7061  .  > .  > def pa
-000056c0: 7373 686f 6f6b 2875 692c 2072 6570 6f2c  sshook(ui, repo,
-000056d0: 202a 2a61 7267 7329 3a0a 2020 3e20 2020   **args):.  >   
-000056e0: 2020 7072 696e 7461 7267 7328 7569 2c20    printargs(ui, 
-000056f0: 6172 6773 290a 2020 3e20 0a20 203e 2064  args).  > .  > d
-00005700: 6566 2066 6169 6c68 6f6f 6b28 7569 2c20  ef failhook(ui, 
-00005710: 7265 706f 2c20 2a2a 6172 6773 293a 0a20  repo, **args):. 
-00005720: 203e 2020 2020 2070 7269 6e74 6172 6773   >     printargs
-00005730: 2875 692c 2061 7267 7329 0a20 203e 2020  (ui, args).  >  
-00005740: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
-00005750: 203e 200a 2020 3e20 636c 6173 7320 4c6f   > .  > class Lo
-00005760: 6361 6c45 7863 6570 7469 6f6e 2845 7863  calException(Exc
-00005770: 6570 7469 6f6e 293a 0a20 203e 2020 2020  eption):.  >    
-00005780: 2070 6173 730a 2020 3e20 0a20 203e 2064   pass.  > .  > d
-00005790: 6566 2072 6169 7365 686f 6f6b 282a 2a61  ef raisehook(**a
-000057a0: 7267 7329 3a0a 2020 3e20 2020 2020 7261  rgs):.  >     ra
-000057b0: 6973 6520 4c6f 6361 6c45 7863 6570 7469  ise LocalExcepti
-000057c0: 6f6e 2827 6578 6365 7074 696f 6e20 6672  on('exception fr
-000057d0: 6f6d 2068 6f6f 6b27 290a 2020 3e20 0a20  om hook').  > . 
-000057e0: 203e 2064 6566 2061 626f 7274 686f 6f6b   > def aborthook
-000057f0: 282a 2a61 7267 7329 3a0a 2020 3e20 2020  (**args):.  >   
-00005800: 2020 7261 6973 6520 6572 726f 722e 4162    raise error.Ab
-00005810: 6f72 7428 6227 7261 6973 6520 6162 6f72  ort(b'raise abor
-00005820: 7420 6672 6f6d 2068 6f6f 6b27 290a 2020  t from hook').  
-00005830: 3e20 0a20 203e 2064 6566 2062 726f 6b65  > .  > def broke
-00005840: 6e68 6f6f 6b28 2a2a 6172 6773 293a 0a20  nhook(**args):. 
-00005850: 203e 2020 2020 2072 6574 7572 6e20 3120   >     return 1 
-00005860: 2b20 7b7d 0a20 203e 200a 2020 3e20 6465  + {}.  > .  > de
-00005870: 6620 7665 7262 6f73 6568 6f6f 6b28 7569  f verbosehook(ui
-00005880: 2c20 2a2a 6172 6773 293a 0a20 203e 2020  , **args):.  >  
-00005890: 2020 2075 692e 6e6f 7465 2862 2776 6572     ui.note(b'ver
-000058a0: 626f 7365 206f 7574 7075 7420 6672 6f6d  bose output from
-000058b0: 2068 6f6f 6b5c 6e27 290a 2020 3e20 0a20   hook\n').  > . 
-000058c0: 203e 2064 6566 2070 7269 6e74 7461 6773   > def printtags
-000058d0: 2875 692c 2072 6570 6f2c 202a 2a61 7267  (ui, repo, **arg
-000058e0: 7329 3a0a 2020 3e20 2020 2020 7569 2e77  s):.  >     ui.w
-000058f0: 7269 7465 2862 275b 2573 5d5c 6e27 2025  rite(b'[%s]\n' %
-00005900: 2062 272c 2027 2e6a 6f69 6e28 736f 7274   b', '.join(sort
-00005910: 6564 2872 6570 6f2e 7461 6773 2829 2929  ed(repo.tags()))
-00005920: 290a 2020 3e20 0a20 203e 2063 6c61 7373  ).  > .  > class
-00005930: 2063 6f6e 7461 696e 6572 286f 626a 6563   container(objec
-00005940: 7429 3a0a 2020 3e20 2020 2020 756e 7265  t):.  >     unre
-00005950: 6163 6861 626c 6520 3d20 310a 2020 3e20  achable = 1.  > 
-00005960: 454f 460a 0a20 2024 2063 6174 203e 2073  EOF..  $ cat > s
-00005970: 796e 7461 7865 7272 6f72 2e70 7920 3c3c  yntaxerror.py <<
-00005980: 204e 4f5f 4348 4543 4b5f 454f 460a 2020   NO_CHECK_EOF.  
-00005990: 3e20 2866 6f6f 0a20 203e 204e 4f5f 4348  > (foo.  > NO_CH
-000059a0: 4543 4b5f 454f 460a 0a74 6573 7420 7079  ECK_EOF..test py
-000059b0: 7468 6f6e 2068 6f6f 6b73 0a0a 2369 6620  thon hooks..#if 
-000059c0: 7769 6e64 6f77 730a 2020 2420 5059 5448  windows.  $ PYTH
-000059d0: 4f4e 5041 5448 3d22 2454 4553 5454 4d50  ONPATH="$TESTTMP
-000059e0: 2f62 3b24 5059 5448 4f4e 5041 5448 220a  /b;$PYTHONPATH".
-000059f0: 2365 6c73 650a 2020 2420 5059 5448 4f4e  #else.  $ PYTHON
-00005a00: 5041 5448 3d22 2454 4553 5454 4d50 2f62  PATH="$TESTTMP/b
-00005a10: 3a24 5059 5448 4f4e 5041 5448 220a 2365  :$PYTHONPATH".#e
-00005a20: 6e64 6966 0a20 2024 2065 7870 6f72 7420  ndif.  $ export 
-00005a30: 5059 5448 4f4e 5041 5448 0a0a 2020 2420  PYTHONPATH..  $ 
-00005a40: 6563 686f 2027 5b68 6f6f 6b73 5d27 203e  echo '[hooks]' >
-00005a50: 202e 2e2f 612f 2e68 672f 6867 7263 0a20   ../a/.hg/hgrc. 
-00005a60: 2024 2065 6368 6f20 2770 7265 6f75 7467   $ echo 'preoutg
-00005a70: 6f69 6e67 2e62 726f 6b65 6e20 3d20 7079  oing.broken = py
-00005a80: 7468 6f6e 3a68 6f6f 6b74 6573 7473 2e62  thon:hooktests.b
-00005a90: 726f 6b65 6e68 6f6f 6b27 203e 3e20 2e2e  rokenhook' >> ..
-00005aa0: 2f61 2f2e 6867 2f68 6772 630a 2020 2420  /a/.hg/hgrc.  $ 
-00005ab0: 6867 2070 756c 6c20 2e2e 2f61 2032 3e26  hg pull ../a 2>&
-00005ac0: 3120 7c20 6772 6570 2027 7261 6973 6564  1 | grep 'raised
-00005ad0: 2061 6e20 6578 6365 7074 696f 6e27 0a20   an exception'. 
-00005ae0: 2065 7272 6f72 3a20 7072 656f 7574 676f   error: preoutgo
-00005af0: 696e 672e 6272 6f6b 656e 2068 6f6f 6b20  ing.broken hook 
-00005b00: 7261 6973 6564 2061 6e20 6578 6365 7074  raised an except
-00005b10: 696f 6e3a 2075 6e73 7570 706f 7274 6564  ion: unsupported
-00005b20: 206f 7065 7261 6e64 2074 7970 6528 7329   operand type(s)
-00005b30: 2066 6f72 202b 3a20 2769 6e74 2720 616e   for +: 'int' an
-00005b40: 6420 2764 6963 7427 0a0a 2020 2420 6563  d 'dict'..  $ ec
-00005b50: 686f 2027 5b68 6f6f 6b73 5d27 203e 202e  ho '[hooks]' > .
-00005b60: 2e2f 612f 2e68 672f 6867 7263 0a20 2024  ./a/.hg/hgrc.  $
-00005b70: 2065 6368 6f20 2770 7265 6f75 7467 6f69   echo 'preoutgoi
-00005b80: 6e67 2e72 6169 7365 203d 2070 7974 686f  ng.raise = pytho
-00005b90: 6e3a 686f 6f6b 7465 7374 732e 7261 6973  n:hooktests.rais
-00005ba0: 6568 6f6f 6b27 203e 3e20 2e2e 2f61 2f2e  ehook' >> ../a/.
-00005bb0: 6867 2f68 6772 630a 2020 2420 6867 2070  hg/hgrc.  $ hg p
-00005bc0: 756c 6c20 2e2e 2f61 2032 3e26 3120 7c20  ull ../a 2>&1 | 
-00005bd0: 6772 6570 2027 7261 6973 6564 2061 6e20  grep 'raised an 
-00005be0: 6578 6365 7074 696f 6e27 0a20 2065 7272  exception'.  err
-00005bf0: 6f72 3a20 7072 656f 7574 676f 696e 672e  or: preoutgoing.
-00005c00: 7261 6973 6520 686f 6f6b 2072 6169 7365  raise hook raise
-00005c10: 6420 616e 2065 7863 6570 7469 6f6e 3a20  d an exception: 
-00005c20: 6578 6365 7074 696f 6e20 6672 6f6d 2068  exception from h
-00005c30: 6f6f 6b0a 0a20 2024 2065 6368 6f20 275b  ook..  $ echo '[
-00005c40: 686f 6f6b 735d 2720 3e20 2e2e 2f61 2f2e  hooks]' > ../a/.
-00005c50: 6867 2f68 6772 630a 2020 2420 6563 686f  hg/hgrc.  $ echo
-00005c60: 2027 7072 656f 7574 676f 696e 672e 6162   'preoutgoing.ab
-00005c70: 6f72 7420 3d20 7079 7468 6f6e 3a68 6f6f  ort = python:hoo
-00005c80: 6b74 6573 7473 2e61 626f 7274 686f 6f6b  ktests.aborthook
-00005c90: 2720 3e3e 202e 2e2f 612f 2e68 672f 6867  ' >> ../a/.hg/hg
-00005ca0: 7263 0a20 2024 2068 6720 7075 6c6c 202e  rc.  $ hg pull .
-00005cb0: 2e2f 610a 2020 7075 6c6c 696e 6720 6672  ./a.  pulling fr
-00005cc0: 6f6d 202e 2e2f 610a 2020 7365 6172 6368  om ../a.  search
-00005cd0: 696e 6720 666f 7220 6368 616e 6765 730a  ing for changes.
-00005ce0: 2020 6572 726f 723a 2070 7265 6f75 7467    error: preoutg
-00005cf0: 6f69 6e67 2e61 626f 7274 2068 6f6f 6b20  oing.abort hook 
-00005d00: 6661 696c 6564 3a20 7261 6973 6520 6162  failed: raise ab
-00005d10: 6f72 7420 6672 6f6d 2068 6f6f 6b0a 2020  ort from hook.  
-00005d20: 6162 6f72 743a 2072 6169 7365 2061 626f  abort: raise abo
-00005d30: 7274 2066 726f 6d20 686f 6f6b 0a20 205b  rt from hook.  [
-00005d40: 3235 355d 0a0a 2020 2420 6563 686f 2027  255]..  $ echo '
-00005d50: 5b68 6f6f 6b73 5d27 203e 202e 2e2f 612f  [hooks]' > ../a/
-00005d60: 2e68 672f 6867 7263 0a20 2024 2065 6368  .hg/hgrc.  $ ech
-00005d70: 6f20 2770 7265 6f75 7467 6f69 6e67 2e66  o 'preoutgoing.f
-00005d80: 6169 6c20 3d20 7079 7468 6f6e 3a68 6f6f  ail = python:hoo
-00005d90: 6b74 6573 7473 2e66 6169 6c68 6f6f 6b27  ktests.failhook'
-00005da0: 203e 3e20 2e2e 2f61 2f2e 6867 2f68 6772   >> ../a/.hg/hgr
-00005db0: 630a 2020 2420 6867 2070 756c 6c20 2e2e  c.  $ hg pull ..
-00005dc0: 2f61 0a20 2070 756c 6c69 6e67 2066 726f  /a.  pulling fro
-00005dd0: 6d20 2e2e 2f61 0a20 2073 6561 7263 6869  m ../a.  searchi
-00005de0: 6e67 2066 6f72 2063 6861 6e67 6573 0a20  ng for changes. 
-00005df0: 2068 6f6f 6b20 6172 6773 3a0a 2020 2020   hook args:.    
-00005e00: 686f 6f6b 7479 7065 2070 7265 6f75 7467  hooktype preoutg
-00005e10: 6f69 6e67 0a20 2020 2073 6f75 7263 6520  oing.    source 
-00005e20: 7075 6c6c 0a20 2061 626f 7274 3a20 7072  pull.  abort: pr
-00005e30: 656f 7574 676f 696e 672e 6661 696c 2068  eoutgoing.fail h
-00005e40: 6f6f 6b20 6661 696c 6564 0a20 205b 3430  ook failed.  [40
-00005e50: 5d0a 0a20 2024 2065 6368 6f20 275b 686f  ]..  $ echo '[ho
-00005e60: 6f6b 735d 2720 3e20 2e2e 2f61 2f2e 6867  oks]' > ../a/.hg
-00005e70: 2f68 6772 630a 2020 2420 6563 686f 2027  /hgrc.  $ echo '
-00005e80: 7072 656f 7574 676f 696e 672e 756e 6361  preoutgoing.unca
-00005e90: 6c6c 6162 6c65 203d 2070 7974 686f 6e3a  llable = python:
-00005ea0: 686f 6f6b 7465 7374 732e 756e 6361 6c6c  hooktests.uncall
-00005eb0: 6162 6c65 2720 3e3e 202e 2e2f 612f 2e68  able' >> ../a/.h
-00005ec0: 672f 6867 7263 0a20 2024 2068 6720 7075  g/hgrc.  $ hg pu
-00005ed0: 6c6c 202e 2e2f 610a 2020 7075 6c6c 696e  ll ../a.  pullin
-00005ee0: 6720 6672 6f6d 202e 2e2f 610a 2020 7365  g from ../a.  se
-00005ef0: 6172 6368 696e 6720 666f 7220 6368 616e  arching for chan
-00005f00: 6765 730a 2020 6162 6f72 743a 2070 7265  ges.  abort: pre
-00005f10: 6f75 7467 6f69 6e67 2e75 6e63 616c 6c61  outgoing.uncalla
-00005f20: 626c 6520 686f 6f6b 2069 7320 696e 7661  ble hook is inva
-00005f30: 6c69 643a 2022 686f 6f6b 7465 7374 732e  lid: "hooktests.
-00005f40: 756e 6361 6c6c 6162 6c65 2220 6973 206e  uncallable" is n
-00005f50: 6f74 2063 616c 6c61 626c 650a 2020 5b32  ot callable.  [2
-00005f60: 3535 5d0a 0a20 2024 2065 6368 6f20 275b  55]..  $ echo '[
-00005f70: 686f 6f6b 735d 2720 3e20 2e2e 2f61 2f2e  hooks]' > ../a/.
-00005f80: 6867 2f68 6772 630a 2020 2420 6563 686f  hg/hgrc.  $ echo
-00005f90: 2027 7072 656f 7574 676f 696e 672e 6e6f   'preoutgoing.no
-00005fa0: 686f 6f6b 203d 2070 7974 686f 6e3a 686f  hook = python:ho
-00005fb0: 6f6b 7465 7374 732e 6e6f 686f 6f6b 2720  oktests.nohook' 
-00005fc0: 3e3e 202e 2e2f 612f 2e68 672f 6867 7263  >> ../a/.hg/hgrc
-00005fd0: 0a20 2024 2068 6720 7075 6c6c 202e 2e2f  .  $ hg pull ../
-00005fe0: 610a 2020 7075 6c6c 696e 6720 6672 6f6d  a.  pulling from
-00005ff0: 202e 2e2f 610a 2020 7365 6172 6368 696e   ../a.  searchin
-00006000: 6720 666f 7220 6368 616e 6765 730a 2020  g for changes.  
-00006010: 6162 6f72 743a 2070 7265 6f75 7467 6f69  abort: preoutgoi
-00006020: 6e67 2e6e 6f68 6f6f 6b20 686f 6f6b 2069  ng.nohook hook i
-00006030: 7320 696e 7661 6c69 643a 2022 686f 6f6b  s invalid: "hook
-00006040: 7465 7374 732e 6e6f 686f 6f6b 2220 6973  tests.nohook" is
-00006050: 206e 6f74 2064 6566 696e 6564 0a20 205b   not defined.  [
-00006060: 3235 355d 0a0a 2020 2420 6563 686f 2027  255]..  $ echo '
-00006070: 5b68 6f6f 6b73 5d27 203e 202e 2e2f 612f  [hooks]' > ../a/
-00006080: 2e68 672f 6867 7263 0a20 2024 2065 6368  .hg/hgrc.  $ ech
-00006090: 6f20 2770 7265 6f75 7467 6f69 6e67 2e6e  o 'preoutgoing.n
-000060a0: 6f6d 6f64 756c 6520 3d20 7079 7468 6f6e  omodule = python
-000060b0: 3a6e 6f6d 6f64 756c 6527 203e 3e20 2e2e  :nomodule' >> ..
-000060c0: 2f61 2f2e 6867 2f68 6772 630a 2020 2420  /a/.hg/hgrc.  $ 
-000060d0: 6867 2070 756c 6c20 2e2e 2f61 0a20 2070  hg pull ../a.  p
-000060e0: 756c 6c69 6e67 2066 726f 6d20 2e2e 2f61  ulling from ../a
-000060f0: 0a20 2073 6561 7263 6869 6e67 2066 6f72  .  searching for
-00006100: 2063 6861 6e67 6573 0a20 2061 626f 7274   changes.  abort
-00006110: 3a20 7072 656f 7574 676f 696e 672e 6e6f  : preoutgoing.no
-00006120: 6d6f 6475 6c65 2068 6f6f 6b20 6973 2069  module hook is i
-00006130: 6e76 616c 6964 3a20 226e 6f6d 6f64 756c  nvalid: "nomodul
-00006140: 6522 206e 6f74 2069 6e20 6120 6d6f 6475  e" not in a modu
-00006150: 6c65 0a20 205b 3235 355d 0a0a 2020 2420  le.  [255]..  $ 
-00006160: 6563 686f 2027 5b68 6f6f 6b73 5d27 203e  echo '[hooks]' >
-00006170: 202e 2e2f 612f 2e68 672f 6867 7263 0a20   ../a/.hg/hgrc. 
-00006180: 2024 2065 6368 6f20 2770 7265 6f75 7467   $ echo 'preoutg
-00006190: 6f69 6e67 2e62 6164 6d6f 6475 6c65 203d  oing.badmodule =
-000061a0: 2070 7974 686f 6e3a 6e6f 6d6f 6475 6c65   python:nomodule
-000061b0: 2e6e 6f77 6865 7265 2720 3e3e 202e 2e2f  .nowhere' >> ../
-000061c0: 612f 2e68 672f 6867 7263 0a20 2024 2068  a/.hg/hgrc.  $ h
-000061d0: 6720 7075 6c6c 202e 2e2f 610a 2020 7075  g pull ../a.  pu
-000061e0: 6c6c 696e 6720 6672 6f6d 202e 2e2f 610a  lling from ../a.
-000061f0: 2020 7365 6172 6368 696e 6720 666f 7220    searching for 
-00006200: 6368 616e 6765 730a 2020 6162 6f72 743a  changes.  abort:
-00006210: 2070 7265 6f75 7467 6f69 6e67 2e62 6164   preoutgoing.bad
-00006220: 6d6f 6475 6c65 2068 6f6f 6b20 6973 2069  module hook is i
-00006230: 6e76 616c 6964 3a20 696d 706f 7274 206f  nvalid: import o
-00006240: 6620 226e 6f6d 6f64 756c 6522 2066 6169  f "nomodule" fai
-00006250: 6c65 640a 2020 2872 756e 2077 6974 6820  led.  (run with 
-00006260: 2d2d 7472 6163 6562 6163 6b20 666f 7220  --traceback for 
-00006270: 7374 6163 6b20 7472 6163 6529 0a20 205b  stack trace).  [
-00006280: 3235 355d 0a0a 2020 2420 6563 686f 2027  255]..  $ echo '
-00006290: 5b68 6f6f 6b73 5d27 203e 202e 2e2f 612f  [hooks]' > ../a/
-000062a0: 2e68 672f 6867 7263 0a20 2024 2065 6368  .hg/hgrc.  $ ech
-000062b0: 6f20 2770 7265 6f75 7467 6f69 6e67 2e75  o 'preoutgoing.u
-000062c0: 6e72 6561 6368 6162 6c65 203d 2070 7974  nreachable = pyt
-000062d0: 686f 6e3a 686f 6f6b 7465 7374 732e 636f  hon:hooktests.co
-000062e0: 6e74 6169 6e65 722e 756e 7265 6163 6861  ntainer.unreacha
-000062f0: 626c 6527 203e 3e20 2e2e 2f61 2f2e 6867  ble' >> ../a/.hg
-00006300: 2f68 6772 630a 2020 2420 6867 2070 756c  /hgrc.  $ hg pul
-00006310: 6c20 2e2e 2f61 0a20 2070 756c 6c69 6e67  l ../a.  pulling
-00006320: 2066 726f 6d20 2e2e 2f61 0a20 2073 6561   from ../a.  sea
-00006330: 7263 6869 6e67 2066 6f72 2063 6861 6e67  rching for chang
-00006340: 6573 0a20 2061 626f 7274 3a20 7072 656f  es.  abort: preo
-00006350: 7574 676f 696e 672e 756e 7265 6163 6861  utgoing.unreacha
-00006360: 626c 6520 686f 6f6b 2069 7320 696e 7661  ble hook is inva
-00006370: 6c69 643a 2069 6d70 6f72 7420 6f66 2022  lid: import of "
-00006380: 686f 6f6b 7465 7374 732e 636f 6e74 6169  hooktests.contai
-00006390: 6e65 7222 2066 6169 6c65 640a 2020 2872  ner" failed.  (r
-000063a0: 756e 2077 6974 6820 2d2d 7472 6163 6562  un with --traceb
-000063b0: 6163 6b20 666f 7220 7374 6163 6b20 7472  ack for stack tr
-000063c0: 6163 6529 0a20 205b 3235 355d 0a0a 2020  ace).  [255]..  
-000063d0: 2420 6563 686f 2027 5b68 6f6f 6b73 5d27  $ echo '[hooks]'
-000063e0: 203e 202e 2e2f 612f 2e68 672f 6867 7263   > ../a/.hg/hgrc
-000063f0: 0a20 2024 2065 6368 6f20 2770 7265 6f75  .  $ echo 'preou
-00006400: 7467 6f69 6e67 2e73 796e 7461 7865 7272  tgoing.syntaxerr
-00006410: 6f72 203d 2070 7974 686f 6e3a 7379 6e74  or = python:synt
-00006420: 6178 6572 726f 722e 7379 6e74 6178 6572  axerror.syntaxer
-00006430: 726f 7227 203e 3e20 2e2e 2f61 2f2e 6867  ror' >> ../a/.hg
-00006440: 2f68 6772 630a 2020 2420 6867 2070 756c  /hgrc.  $ hg pul
-00006450: 6c20 2e2e 2f61 0a20 2070 756c 6c69 6e67  l ../a.  pulling
-00006460: 2066 726f 6d20 2e2e 2f61 0a20 2073 6561   from ../a.  sea
-00006470: 7263 6869 6e67 2066 6f72 2063 6861 6e67  rching for chang
-00006480: 6573 0a20 2061 626f 7274 3a20 7072 656f  es.  abort: preo
-00006490: 7574 676f 696e 672e 7379 6e74 6178 6572  utgoing.syntaxer
-000064a0: 726f 7220 686f 6f6b 2069 7320 696e 7661  ror hook is inva
-000064b0: 6c69 643a 2069 6d70 6f72 7420 6f66 2022  lid: import of "
-000064c0: 7379 6e74 6178 6572 726f 7222 2066 6169  syntaxerror" fai
-000064d0: 6c65 640a 2020 2872 756e 2077 6974 6820  led.  (run with 
-000064e0: 2d2d 7472 6163 6562 6163 6b20 666f 7220  --traceback for 
-000064f0: 7374 6163 6b20 7472 6163 6529 0a20 205b  stack trace).  [
-00006500: 3235 355d 0a0a 2020 2420 6867 2070 756c  255]..  $ hg pul
-00006510: 6c20 2e2e 2f61 202d 2d74 7261 6365 6261  l ../a --traceba
-00006520: 636b 2032 3e26 3120 7c20 6567 7265 7020  ck 2>&1 | egrep 
-00006530: 2770 756c 6c69 6e67 7c73 6561 7263 6869  'pulling|searchi
-00006540: 6e67 7c5e 6578 6365 7074 696f 6e7c 5472  ng|^exception|Tr
-00006550: 6163 6562 6163 6b7c 5379 6e74 6178 4572  aceback|SyntaxEr
-00006560: 726f 727c 496d 706f 7274 4572 726f 727c  ror|ImportError|
-00006570: 4d6f 6475 6c65 4e6f 7446 6f75 6e64 4572  ModuleNotFoundEr
-00006580: 726f 727c 486f 6f6b 4c6f 6164 4572 726f  ror|HookLoadErro
-00006590: 727c 6162 6f72 7427 0a20 2070 756c 6c69  r|abort'.  pulli
-000065a0: 6e67 2066 726f 6d20 2e2e 2f61 0a20 2073  ng from ../a.  s
-000065b0: 6561 7263 6869 6e67 2066 6f72 2063 6861  earching for cha
-000065c0: 6e67 6573 0a20 2065 7863 6570 7469 6f6e  nges.  exception
-000065d0: 2066 726f 6d20 6669 7273 7420 6661 696c   from first fail
-000065e0: 6564 2069 6d70 6f72 7420 6174 7465 6d70  ed import attemp
-000065f0: 743a 0a20 2054 7261 6365 6261 636b 2028  t:.  Traceback (
-00006600: 6d6f 7374 2072 6563 656e 7420 6361 6c6c  most recent call
-00006610: 206c 6173 7429 3a0a 2020 5379 6e74 6178   last):.  Syntax
-00006620: 4572 726f 723a 202a 2028 676c 6f62 290a  Error: * (glob).
-00006630: 2020 6578 6365 7074 696f 6e20 6672 6f6d    exception from
-00006640: 2073 6563 6f6e 6420 6661 696c 6564 2069   second failed i
-00006650: 6d70 6f72 7420 6174 7465 6d70 743a 0a20  mport attempt:. 
-00006660: 2054 7261 6365 6261 636b 2028 6d6f 7374   Traceback (most
-00006670: 2072 6563 656e 7420 6361 6c6c 206c 6173   recent call las
-00006680: 7429 3a0a 2020 5379 6e74 6178 4572 726f  t):.  SyntaxErro
-00006690: 723a 202a 2028 676c 6f62 290a 2020 5472  r: * (glob).  Tr
-000066a0: 6163 6562 6163 6b20 286d 6f73 7420 7265  aceback (most re
-000066b0: 6365 6e74 2063 616c 6c20 6c61 7374 293a  cent call last):
-000066c0: 0a20 2049 6d70 6f72 7445 7272 6f72 3a20  .  ImportError: 
-000066d0: 4e6f 206d 6f64 756c 6520 6e61 6d65 6420  No module named 
-000066e0: 2768 6765 7874 5f73 796e 7461 7865 7272  'hgext_syntaxerr
-000066f0: 6f72 2720 286e 6f2d 7079 3336 2021 290a  or' (no-py36 !).
-00006700: 2020 4d6f 6475 6c65 4e6f 7446 6f75 6e64    ModuleNotFound
-00006710: 4572 726f 723a 204e 6f20 6d6f 6475 6c65  Error: No module
-00006720: 206e 616d 6564 2027 6867 6578 745f 7379   named 'hgext_sy
-00006730: 6e74 6178 6572 726f 7227 2028 7079 3336  ntaxerror' (py36
-00006740: 2021 290a 2020 5472 6163 6562 6163 6b20   !).  Traceback 
-00006750: 286d 6f73 7420 7265 6365 6e74 2063 616c  (most recent cal
-00006760: 6c20 6c61 7374 293a 0a20 2053 796e 7461  l last):.  Synta
-00006770: 7845 7272 6f72 3a20 2a20 2867 6c6f 6229  xError: * (glob)
-00006780: 0a20 2054 7261 6365 6261 636b 2028 6d6f  .  Traceback (mo
-00006790: 7374 2072 6563 656e 7420 6361 6c6c 206c  st recent call l
-000067a0: 6173 7429 3a0a 2020 496d 706f 7274 4572  ast):.  ImportEr
-000067b0: 726f 723a 204e 6f20 6d6f 6475 6c65 206e  ror: No module n
-000067c0: 616d 6564 2027 6867 6578 745f 7379 6e74  amed 'hgext_synt
-000067d0: 6178 6572 726f 7227 2028 6e6f 2d70 7933  axerror' (no-py3
-000067e0: 3620 2129 0a20 204d 6f64 756c 654e 6f74  6 !).  ModuleNot
-000067f0: 466f 756e 6445 7272 6f72 3a20 4e6f 206d  FoundError: No m
-00006800: 6f64 756c 6520 6e61 6d65 6420 2768 6765  odule named 'hge
-00006810: 7874 5f73 796e 7461 7865 7272 6f72 2720  xt_syntaxerror' 
-00006820: 2870 7933 3620 2129 0a20 2054 7261 6365  (py36 !).  Trace
-00006830: 6261 636b 2028 6d6f 7374 2072 6563 656e  back (most recen
-00006840: 7420 6361 6c6c 206c 6173 7429 3a0a 2020  t call last):.  
-00006850: 2020 2020 7261 6973 6520 6572 726f 722e      raise error.
-00006860: 486f 6f6b 4c6f 6164 4572 726f 7228 2028  HookLoadError( (
-00006870: 7079 3338 2021 290a 2020 6d65 7263 7572  py38 !).  mercur
-00006880: 6961 6c2e 6572 726f 722e 486f 6f6b 4c6f  ial.error.HookLo
-00006890: 6164 4572 726f 723a 2070 7265 6f75 7467  adError: preoutg
-000068a0: 6f69 6e67 2e73 796e 7461 7865 7272 6f72  oing.syntaxerror
-000068b0: 2068 6f6f 6b20 6973 2069 6e76 616c 6964   hook is invalid
-000068c0: 3a20 696d 706f 7274 206f 6620 2273 796e  : import of "syn
-000068d0: 7461 7865 7272 6f72 2220 6661 696c 6564  taxerror" failed
-000068e0: 0a20 2061 626f 7274 3a20 7072 656f 7574  .  abort: preout
-000068f0: 676f 696e 672e 7379 6e74 6178 6572 726f  going.syntaxerro
-00006900: 7220 686f 6f6b 2069 7320 696e 7661 6c69  r hook is invali
-00006910: 643a 2069 6d70 6f72 7420 6f66 2022 7379  d: import of "sy
-00006920: 6e74 6178 6572 726f 7222 2066 6169 6c65  ntaxerror" faile
-00006930: 640a 0a20 2024 2065 6368 6f20 275b 686f  d..  $ echo '[ho
-00006940: 6f6b 735d 2720 3e20 2e2e 2f61 2f2e 6867  oks]' > ../a/.hg
-00006950: 2f68 6772 630a 2020 2420 6563 686f 2027  /hgrc.  $ echo '
-00006960: 7072 656f 7574 676f 696e 672e 7061 7373  preoutgoing.pass
-00006970: 203d 2070 7974 686f 6e3a 686f 6f6b 7465   = python:hookte
-00006980: 7374 732e 7061 7373 686f 6f6b 2720 3e3e  sts.passhook' >>
-00006990: 202e 2e2f 612f 2e68 672f 6867 7263 0a20   ../a/.hg/hgrc. 
-000069a0: 2024 2068 6720 7075 6c6c 202e 2e2f 610a   $ hg pull ../a.
-000069b0: 2020 7075 6c6c 696e 6720 6672 6f6d 202e    pulling from .
-000069c0: 2e2f 610a 2020 7365 6172 6368 696e 6720  ./a.  searching 
-000069d0: 666f 7220 6368 616e 6765 730a 2020 686f  for changes.  ho
-000069e0: 6f6b 2061 7267 733a 0a20 2020 2068 6f6f  ok args:.    hoo
-000069f0: 6b74 7970 6520 7072 656f 7574 676f 696e  ktype preoutgoin
-00006a00: 670a 2020 2020 736f 7572 6365 2070 756c  g.    source pul
-00006a10: 6c0a 2020 6164 6469 6e67 2063 6861 6e67  l.  adding chang
-00006a20: 6573 6574 730a 2020 6164 6469 6e67 206d  esets.  adding m
-00006a30: 616e 6966 6573 7473 0a20 2061 6464 696e  anifests.  addin
-00006a40: 6720 6669 6c65 2063 6861 6e67 6573 0a20  g file changes. 
-00006a50: 2061 6464 696e 6720 7265 6d6f 7465 2062   adding remote b
-00006a60: 6f6f 6b6d 6172 6b20 7175 7578 0a20 2061  ookmark quux.  a
-00006a70: 6464 6564 2031 2063 6861 6e67 6573 6574  dded 1 changeset
-00006a80: 7320 7769 7468 2031 2063 6861 6e67 6573  s with 1 changes
-00006a90: 2074 6f20 3120 6669 6c65 730a 2020 6e65   to 1 files.  ne
-00006aa0: 7720 6368 616e 6765 7365 7473 2035 3339  w changesets 539
-00006ab0: 6534 6233 3162 3664 630a 2020 2872 756e  e4b31b6dc.  (run
-00006ac0: 2027 6867 2075 7064 6174 6527 2074 6f20   'hg update' to 
-00006ad0: 6765 7420 6120 776f 726b 696e 6720 636f  get a working co
-00006ae0: 7079 290a 0a70 6f73 742d 2070 7974 686f  py)..post- pytho
-00006af0: 6e20 686f 6f6b 7320 7468 6174 2066 6169  n hooks that fai
-00006b00: 6c20 746f 202a 7275 6e2a 2064 6f6e 2774  l to *run* don't
-00006b10: 2063 6175 7365 2061 6e20 6162 6f72 740a   cause an abort.
-00006b20: 2020 2420 726d 202e 2e2f 612f 2e68 672f    $ rm ../a/.hg/
-00006b30: 6867 7263 0a20 2024 2065 6368 6f20 275b  hgrc.  $ echo '[
-00006b40: 686f 6f6b 735d 2720 3e20 2e68 672f 6867  hooks]' > .hg/hg
-00006b50: 7263 0a20 2024 2065 6368 6f20 2770 6f73  rc.  $ echo 'pos
-00006b60: 742d 7075 6c6c 2e62 726f 6b65 6e20 3d20  t-pull.broken = 
-00006b70: 7079 7468 6f6e 3a68 6f6f 6b74 6573 7473  python:hooktests
-00006b80: 2e62 726f 6b65 6e68 6f6f 6b27 203e 3e20  .brokenhook' >> 
-00006b90: 2e68 672f 6867 7263 0a20 2024 2068 6720  .hg/hgrc.  $ hg 
-00006ba0: 7075 6c6c 202e 2e2f 610a 2020 7075 6c6c  pull ../a.  pull
-00006bb0: 696e 6720 6672 6f6d 202e 2e2f 610a 2020  ing from ../a.  
-00006bc0: 7365 6172 6368 696e 6720 666f 7220 6368  searching for ch
-00006bd0: 616e 6765 730a 2020 6e6f 2063 6861 6e67  anges.  no chang
-00006be0: 6573 2066 6f75 6e64 0a20 2065 7272 6f72  es found.  error
-00006bf0: 3a20 706f 7374 2d70 756c 6c2e 6272 6f6b  : post-pull.brok
-00006c00: 656e 2068 6f6f 6b20 7261 6973 6564 2061  en hook raised a
-00006c10: 6e20 6578 6365 7074 696f 6e3a 2075 6e73  n exception: uns
-00006c20: 7570 706f 7274 6564 206f 7065 7261 6e64  upported operand
-00006c30: 2074 7970 6528 7329 2066 6f72 202b 3a20   type(s) for +: 
-00006c40: 2769 6e74 2720 616e 6420 2764 6963 7427  'int' and 'dict'
-00006c50: 0a20 2028 7275 6e20 7769 7468 202d 2d74  .  (run with --t
-00006c60: 7261 6365 6261 636b 2066 6f72 2073 7461  raceback for sta
-00006c70: 636b 2074 7261 6365 290a 0a62 7574 2070  ck trace)..but p
-00006c80: 6f73 742d 2070 7974 686f 6e20 686f 6f6b  ost- python hook
-00006c90: 7320 7468 6174 2066 6169 6c20 746f 202a  s that fail to *
-00006ca0: 6c6f 6164 2a20 646f 0a20 2024 2065 6368  load* do.  $ ech
-00006cb0: 6f20 275b 686f 6f6b 735d 2720 3e20 2e68  o '[hooks]' > .h
-00006cc0: 672f 6867 7263 0a20 2024 2065 6368 6f20  g/hgrc.  $ echo 
-00006cd0: 2770 6f73 742d 7075 6c6c 2e6e 6f6d 6f64  'post-pull.nomod
-00006ce0: 756c 6520 3d20 7079 7468 6f6e 3a6e 6f6d  ule = python:nom
-00006cf0: 6f64 756c 6527 203e 3e20 2e68 672f 6867  odule' >> .hg/hg
-00006d00: 7263 0a20 2024 2068 6720 7075 6c6c 202e  rc.  $ hg pull .
-00006d10: 2e2f 610a 2020 7075 6c6c 696e 6720 6672  ./a.  pulling fr
-00006d20: 6f6d 202e 2e2f 610a 2020 7365 6172 6368  om ../a.  search
-00006d30: 696e 6720 666f 7220 6368 616e 6765 730a  ing for changes.
-00006d40: 2020 6e6f 2063 6861 6e67 6573 2066 6f75    no changes fou
-00006d50: 6e64 0a20 2061 626f 7274 3a20 706f 7374  nd.  abort: post
-00006d60: 2d70 756c 6c2e 6e6f 6d6f 6475 6c65 2068  -pull.nomodule h
-00006d70: 6f6f 6b20 6973 2069 6e76 616c 6964 3a20  ook is invalid: 
-00006d80: 226e 6f6d 6f64 756c 6522 206e 6f74 2069  "nomodule" not i
-00006d90: 6e20 6120 6d6f 6475 6c65 0a20 205b 3235  n a module.  [25
-00006da0: 355d 0a0a 2020 2420 6563 686f 2027 5b68  5]..  $ echo '[h
-00006db0: 6f6f 6b73 5d27 203e 202e 6867 2f68 6772  ooks]' > .hg/hgr
-00006dc0: 630a 2020 2420 6563 686f 2027 706f 7374  c.  $ echo 'post
-00006dd0: 2d70 756c 6c2e 6261 646d 6f64 756c 6520  -pull.badmodule 
-00006de0: 3d20 7079 7468 6f6e 3a6e 6f6d 6f64 756c  = python:nomodul
-00006df0: 652e 6e6f 7768 6572 6527 203e 3e20 2e68  e.nowhere' >> .h
-00006e00: 672f 6867 7263 0a20 2024 2068 6720 7075  g/hgrc.  $ hg pu
-00006e10: 6c6c 202e 2e2f 610a 2020 7075 6c6c 696e  ll ../a.  pullin
-00006e20: 6720 6672 6f6d 202e 2e2f 610a 2020 7365  g from ../a.  se
-00006e30: 6172 6368 696e 6720 666f 7220 6368 616e  arching for chan
-00006e40: 6765 730a 2020 6e6f 2063 6861 6e67 6573  ges.  no changes
-00006e50: 2066 6f75 6e64 0a20 2061 626f 7274 3a20   found.  abort: 
-00006e60: 706f 7374 2d70 756c 6c2e 6261 646d 6f64  post-pull.badmod
-00006e70: 756c 6520 686f 6f6b 2069 7320 696e 7661  ule hook is inva
-00006e80: 6c69 643a 2069 6d70 6f72 7420 6f66 2022  lid: import of "
-00006e90: 6e6f 6d6f 6475 6c65 2220 6661 696c 6564  nomodule" failed
-00006ea0: 0a20 2028 7275 6e20 7769 7468 202d 2d74  .  (run with --t
-00006eb0: 7261 6365 6261 636b 2066 6f72 2073 7461  raceback for sta
-00006ec0: 636b 2074 7261 6365 290a 2020 5b32 3535  ck trace).  [255
-00006ed0: 5d0a 0a20 2024 2065 6368 6f20 275b 686f  ]..  $ echo '[ho
-00006ee0: 6f6b 735d 2720 3e20 2e68 672f 6867 7263  oks]' > .hg/hgrc
-00006ef0: 0a20 2024 2065 6368 6f20 2770 6f73 742d  .  $ echo 'post-
-00006f00: 7075 6c6c 2e6e 6f68 6f6f 6b20 3d20 7079  pull.nohook = py
-00006f10: 7468 6f6e 3a68 6f6f 6b74 6573 7473 2e6e  thon:hooktests.n
-00006f20: 6f68 6f6f 6b27 203e 3e20 2e68 672f 6867  ohook' >> .hg/hg
-00006f30: 7263 0a20 2024 2068 6720 7075 6c6c 202e  rc.  $ hg pull .
-00006f40: 2e2f 610a 2020 7075 6c6c 696e 6720 6672  ./a.  pulling fr
-00006f50: 6f6d 202e 2e2f 610a 2020 7365 6172 6368  om ../a.  search
-00006f60: 696e 6720 666f 7220 6368 616e 6765 730a  ing for changes.
-00006f70: 2020 6e6f 2063 6861 6e67 6573 2066 6f75    no changes fou
-00006f80: 6e64 0a20 2061 626f 7274 3a20 706f 7374  nd.  abort: post
-00006f90: 2d70 756c 6c2e 6e6f 686f 6f6b 2068 6f6f  -pull.nohook hoo
-00006fa0: 6b20 6973 2069 6e76 616c 6964 3a20 2268  k is invalid: "h
-00006fb0: 6f6f 6b74 6573 7473 2e6e 6f68 6f6f 6b22  ooktests.nohook"
-00006fc0: 2069 7320 6e6f 7420 6465 6669 6e65 640a   is not defined.
-00006fd0: 2020 5b32 3535 5d0a 0a6d 616b 6520 7375    [255]..make su
-00006fe0: 7265 202d 2d74 7261 6365 6261 636b 2077  re --traceback w
-00006ff0: 6f72 6b73 0a0a 2020 2420 6563 686f 2027  orks..  $ echo '
-00007000: 5b68 6f6f 6b73 5d27 203e 202e 6867 2f68  [hooks]' > .hg/h
-00007010: 6772 630a 2020 2420 6563 686f 2027 636f  grc.  $ echo 'co
-00007020: 6d6d 6974 2e61 626f 7274 203d 2070 7974  mmit.abort = pyt
-00007030: 686f 6e3a 686f 6f6b 7465 7374 732e 6162  hon:hooktests.ab
-00007040: 6f72 7468 6f6f 6b27 203e 3e20 2e68 672f  orthook' >> .hg/
-00007050: 6867 7263 0a0a 2020 2420 6563 686f 2061  hgrc..  $ echo a
-00007060: 6120 3e20 610a 2020 2420 6867 202d 2d74  a > a.  $ hg --t
-00007070: 7261 6365 6261 636b 2063 6f6d 6d69 7420  raceback commit 
-00007080: 2d64 2027 3020 3027 202d 6d61 2032 3e26  -d '0 0' -ma 2>&
-00007090: 3120 7c20 6772 6570 2027 5e54 7261 6365  1 | grep '^Trace
-000070a0: 6261 636b 270a 2020 5472 6163 6562 6163  back'.  Tracebac
-000070b0: 6b20 286d 6f73 7420 7265 6365 6e74 2063  k (most recent c
-000070c0: 616c 6c20 6c61 7374 293a 0a0a 2020 2420  all last):..  $ 
-000070d0: 6364 202e 2e0a 2020 2420 6867 2069 6e69  cd ...  $ hg ini
-000070e0: 7420 630a 2020 2420 6364 2063 0a0a 2020  t c.  $ cd c..  
-000070f0: 2420 6361 7420 3e20 686f 6f6b 6578 742e  $ cat > hookext.
-00007100: 7079 203c 3c45 4f46 0a20 203e 2064 6566  py <<EOF.  > def
-00007110: 2061 7574 6f68 6f6f 6b28 7569 2c20 2a2a   autohook(ui, **
-00007120: 6172 6773 293a 0a20 203e 2020 2020 2075  args):.  >     u
-00007130: 692e 7772 6974 6528 6227 4175 746f 6d61  i.write(b'Automa
-00007140: 7469 6361 6c6c 7920 696e 7374 616c 6c65  tically installe
-00007150: 6420 686f 6f6b 5c6e 2729 0a20 203e 200a  d hook\n').  > .
-00007160: 2020 3e20 6465 6620 7265 706f 7365 7475    > def reposetu
-00007170: 7028 7569 2c20 7265 706f 293a 0a20 203e  p(ui, repo):.  >
-00007180: 2020 2020 2072 6570 6f2e 7569 2e73 6574       repo.ui.set
-00007190: 636f 6e66 6967 2862 2268 6f6f 6b73 222c  config(b"hooks",
-000071a0: 2062 2263 6f6d 6d69 742e 6175 746f 222c   b"commit.auto",
-000071b0: 2061 7574 6f68 6f6f 6b29 0a20 203e 2045   autohook).  > E
-000071c0: 4f46 0a20 2024 2065 6368 6f20 275b 6578  OF.  $ echo '[ex
-000071d0: 7465 6e73 696f 6e73 5d27 203e 3e20 2e68  tensions]' >> .h
-000071e0: 672f 6867 7263 0a20 2024 2065 6368 6f20  g/hgrc.  $ echo 
-000071f0: 2768 6f6f 6b65 7874 203d 2068 6f6f 6b65  'hookext = hooke
-00007200: 7874 2e70 7927 203e 3e20 2e68 672f 6867  xt.py' >> .hg/hg
-00007210: 7263 0a0a 2020 2420 746f 7563 6820 666f  rc..  $ touch fo
-00007220: 6f0a 2020 2420 6867 2061 6464 2066 6f6f  o.  $ hg add foo
-00007230: 0a20 2024 2068 6720 6369 202d 6420 2730  .  $ hg ci -d '0
-00007240: 2030 2720 2d6d 2027 6164 6420 666f 6f27   0' -m 'add foo'
-00007250: 0a20 2041 7574 6f6d 6174 6963 616c 6c79  .  Automatically
-00007260: 2069 6e73 7461 6c6c 6564 2068 6f6f 6b0a   installed hook.
-00007270: 2020 2420 6563 686f 203e 3e20 666f 6f0a    $ echo >> foo.
-00007280: 2020 2420 6867 2063 6920 2d2d 6465 6275    $ hg ci --debu
-00007290: 6720 2d64 2027 3020 3027 202d 6d20 2763  g -d '0 0' -m 'c
-000072a0: 6861 6e67 6520 666f 6f27 0a20 2063 6f6d  hange foo'.  com
-000072b0: 6d69 7474 696e 6720 6669 6c65 733a 0a20  mitting files:. 
-000072c0: 2066 6f6f 0a20 2063 6f6d 6d69 7474 696e   foo.  committin
-000072d0: 6720 6d61 6e69 6665 7374 0a20 2063 6f6d  g manifest.  com
-000072e0: 6d69 7474 696e 6720 6368 616e 6765 6c6f  mitting changelo
-000072f0: 670a 2020 7570 6461 7469 6e67 2074 6865  g.  updating the
-00007300: 2062 7261 6e63 6820 6361 6368 650a 2020   branch cache.  
-00007310: 636f 6d6d 6974 7465 6420 6368 616e 6765  committed change
-00007320: 7365 7420 313a 3532 3939 3830 3139 6636  set 1:52998019f6
-00007330: 3235 3261 3262 3839 3334 3532 3736 3566  252a2b893452765f
-00007340: 6362 3061 3437 3335 3161 3537 3038 0a20  cb0a47351a5708. 
-00007350: 2063 616c 6c69 6e67 2068 6f6f 6b20 636f   calling hook co
-00007360: 6d6d 6974 2e61 7574 6f3a 2068 6765 7874  mmit.auto: hgext
-00007370: 5f68 6f6f 6b65 7874 2e61 7574 6f68 6f6f  _hookext.autohoo
-00007380: 6b0a 2020 4175 746f 6d61 7469 6361 6c6c  k.  Automaticall
-00007390: 7920 696e 7374 616c 6c65 6420 686f 6f6b  y installed hook
-000073a0: 0a0a 2020 2420 6867 2073 686f 7763 6f6e  ..  $ hg showcon
-000073b0: 6669 6720 686f 6f6b 730a 2020 686f 6f6b  fig hooks.  hook
-000073c0: 732e 636f 6d6d 6974 2e61 7574 6f3d 3c66  s.commit.auto=<f
-000073d0: 756e 6374 696f 6e20 6175 746f 686f 6f6b  unction autohook
-000073e0: 2061 7420 2a3e 2028 676c 6f62 290a 0a74   at *> (glob)..t
-000073f0: 6573 7420 7079 7468 6f6e 2068 6f6f 6b20  est python hook 
-00007400: 636f 6e66 6967 7572 6564 2077 6974 6820  configured with 
-00007410: 7079 7468 6f6e 3a5b 6669 6c65 5d3a 5b68  python:[file]:[h
-00007420: 6f6f 6b5d 2073 796e 7461 780a 0a20 2024  ook] syntax..  $
-00007430: 2063 6420 2e2e 0a20 2024 206d 6b64 6972   cd ...  $ mkdir
-00007440: 2064 0a20 2024 2063 6420 640a 2020 2420   d.  $ cd d.  $ 
-00007450: 6867 2069 6e69 7420 7265 706f 0a20 2024  hg init repo.  $
-00007460: 206d 6b64 6972 2068 6f6f 6b73 0a0a 2020   mkdir hooks..  
-00007470: 2420 6364 2068 6f6f 6b73 0a20 2024 2063  $ cd hooks.  $ c
-00007480: 6174 203e 2074 6573 7468 6f6f 6b73 2e70  at > testhooks.p
-00007490: 7920 3c3c 454f 460a 2020 3e20 6465 6620  y <<EOF.  > def 
-000074a0: 7465 7374 686f 6f6b 2875 692c 202a 2a61  testhook(ui, **a
-000074b0: 7267 7329 3a0a 2020 3e20 2020 2020 7569  rgs):.  >     ui
-000074c0: 2e77 7269 7465 2862 2768 6f6f 6b20 776f  .write(b'hook wo
-000074d0: 726b 735c 6e27 290a 2020 3e20 454f 460a  rks\n').  > EOF.
-000074e0: 2020 2420 6563 686f 2027 5b68 6f6f 6b73    $ echo '[hooks
-000074f0: 5d27 203e 202e 2e2f 7265 706f 2f2e 6867  ]' > ../repo/.hg
-00007500: 2f68 6772 630a 2020 2420 6563 686f 2022  /hgrc.  $ echo "
-00007510: 7072 652d 636f 6d6d 6974 2e74 6573 7420  pre-commit.test 
-00007520: 3d20 7079 7468 6f6e 3a60 7077 6460 2f74  = python:`pwd`/t
-00007530: 6573 7468 6f6f 6b73 2e70 793a 7465 7374  esthooks.py:test
-00007540: 686f 6f6b 2220 3e3e 202e 2e2f 7265 706f  hook" >> ../repo
-00007550: 2f2e 6867 2f68 6772 630a 0a20 2024 2063  /.hg/hgrc..  $ c
-00007560: 6420 2e2e 2f72 6570 6f0a 2020 2420 6867  d ../repo.  $ hg
-00007570: 2063 6f6d 6d69 7420 2d64 2027 3020 3027   commit -d '0 0'
-00007580: 0a20 2068 6f6f 6b20 776f 726b 730a 2020  .  hook works.  
-00007590: 6e6f 7468 696e 6720 6368 616e 6765 640a  nothing changed.
-000075a0: 2020 5b31 5d0a 0a20 2024 2065 6368 6f20    [1]..  $ echo 
-000075b0: 275b 686f 6f6b 735d 2720 3e20 2e68 672f  '[hooks]' > .hg/
-000075c0: 6867 7263 0a20 2024 2065 6368 6f20 2275  hgrc.  $ echo "u
-000075d0: 7064 6174 652e 6e65 203d 2070 7974 686f  pdate.ne = pytho
-000075e0: 6e3a 6070 7764 602f 6e6f 6e65 7869 7374  n:`pwd`/nonexist
-000075f0: 656e 742e 7079 3a74 6573 7468 6f6f 6b22  ent.py:testhook"
-00007600: 203e 3e20 2e68 672f 6867 7263 0a20 2024   >> .hg/hgrc.  $
-00007610: 2065 6368 6f20 2270 7265 2d69 6465 6e74   echo "pre-ident
-00007620: 6966 792e 6e70 6d64 203d 2070 7974 686f  ify.npmd = pytho
-00007630: 6e3a 6070 7764 602f 3a6e 6f5f 7079 7468  n:`pwd`/:no_pyth
-00007640: 6f6e 5f6d 6f64 756c 655f 6469 7222 203e  on_module_dir" >
-00007650: 3e20 2e68 672f 6867 7263 0a0a 2020 2420  > .hg/hgrc..  $ 
-00007660: 6867 2075 7020 6e75 6c6c 0a20 206c 6f61  hg up null.  loa
-00007670: 6469 6e67 2075 7064 6174 652e 6e65 2068  ding update.ne h
-00007680: 6f6f 6b20 6661 696c 6564 3a0a 2020 6162  ook failed:.  ab
-00007690: 6f72 743a 2024 454e 4f45 4e54 243a 2027  ort: $ENOENT$: '
-000076a0: 2454 4553 5454 4d50 2f64 2f72 6570 6f2f  $TESTTMP/d/repo/
-000076b0: 6e6f 6e65 7869 7374 656e 742e 7079 270a  nonexistent.py'.
-000076c0: 2020 5b32 3535 5d0a 0a20 2024 2068 6720    [255]..  $ hg 
-000076d0: 6964 0a20 206c 6f61 6469 6e67 2070 7265  id.  loading pre
-000076e0: 2d69 6465 6e74 6966 792e 6e70 6d64 2068  -identify.npmd h
-000076f0: 6f6f 6b20 6661 696c 6564 3a0a 2020 6162  ook failed:.  ab
-00007700: 6f72 743a 204e 6f20 6d6f 6475 6c65 206e  ort: No module n
-00007710: 616d 6564 2027 7265 706f 270a 2020 5b32  amed 'repo'.  [2
-00007720: 3535 5d0a 0a20 2024 2063 6420 2e2e 2f2e  55]..  $ cd ../.
-00007730: 2e2f 620a 0a6d 616b 6520 7375 7265 202d  ./b..make sure -
-00007740: 2d74 7261 6365 6261 636b 2077 6f72 6b73  -traceback works
-00007750: 206f 6e20 686f 6f6b 2069 6d70 6f72 7420   on hook import 
-00007760: 6661 696c 7572 650a 0a20 2024 2063 6174  failure..  $ cat
-00007770: 203e 2069 6d70 6f72 7466 6169 6c2e 7079   > importfail.py
-00007780: 203c 3c45 4f46 0a20 203e 2069 6d70 6f72   <<EOF.  > impor
-00007790: 7420 736f 6d65 626f 6775 736d 6f64 756c  t somebogusmodul
-000077a0: 650a 2020 3e20 2320 6465 7265 6665 7265  e.  > # derefere
-000077b0: 6e63 6520 736f 6d65 7468 696e 6720 696e  nce something in
-000077c0: 2074 6865 206d 6f64 756c 6520 746f 2066   the module to f
-000077d0: 6f72 6365 2064 656d 616e 6469 6d70 6f72  orce demandimpor
-000077e0: 7420 746f 206c 6f61 6420 6974 0a20 203e  t to load it.  >
-000077f0: 2073 6f6d 6562 6f67 7573 6d6f 6475 6c65   somebogusmodule
-00007800: 2e77 6861 7465 7665 720a 2020 3e20 454f  .whatever.  > EO
-00007810: 460a 0a20 2024 2065 6368 6f20 275b 686f  F..  $ echo '[ho
-00007820: 6f6b 735d 2720 3e20 2e68 672f 6867 7263  oks]' > .hg/hgrc
-00007830: 0a20 2024 2065 6368 6f20 2770 7265 636f  .  $ echo 'preco
-00007840: 6d6d 6974 2e69 6d70 6f72 7466 6169 6c20  mmit.importfail 
-00007850: 3d20 7079 7468 6f6e 3a69 6d70 6f72 7466  = python:importf
-00007860: 6169 6c2e 7768 6174 6576 6572 2720 3e3e  ail.whatever' >>
-00007870: 202e 6867 2f68 6772 630a 0a20 2024 2065   .hg/hgrc..  $ e
-00007880: 6368 6f20 6120 3e3e 2061 0a20 2024 2068  cho a >> a.  $ h
-00007890: 6720 2d2d 7472 6163 6562 6163 6b20 636f  g --traceback co
-000078a0: 6d6d 6974 202d 6d61 2032 3e26 3120 7c20  mmit -ma 2>&1 | 
-000078b0: 6567 7265 7020 275e 6578 6365 7074 696f  egrep '^exceptio
-000078c0: 6e7c 496d 706f 7274 4572 726f 727c 4d6f  n|ImportError|Mo
-000078d0: 6475 6c65 4e6f 7446 6f75 6e64 4572 726f  duleNotFoundErro
-000078e0: 727c 5472 6163 6562 6163 6b7c 486f 6f6b  r|Traceback|Hook
-000078f0: 4c6f 6164 4572 726f 727c 6162 6f72 7427  LoadError|abort'
+00005300: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
+00005310: 3030 0a20 2048 475f 534f 5552 4345 3d63  00.  HG_SOURCE=c
+00005320: 6c6f 6e65 0a20 200a 2020 7570 6461 7469  lone.  .  updati
+00005330: 6e67 2074 6f20 6272 616e 6368 2064 6566  ng to branch def
+00005340: 6175 6c74 0a20 2033 2066 696c 6573 2075  ault.  3 files u
+00005350: 7064 6174 6564 2c20 3020 6669 6c65 7320  pdated, 0 files 
+00005360: 6d65 7267 6564 2c20 3020 6669 6c65 7320  merged, 0 files 
+00005370: 7265 6d6f 7665 642c 2030 2066 696c 6573  removed, 0 files
+00005380: 2075 6e72 6573 6f6c 7665 640a 2020 2420   unresolved.  $ 
+00005390: 726d 202d 7266 2063 0a0a 7072 656f 7574  rm -rf c..preout
+000053a0: 676f 696e 6720 686f 6f6b 2063 616e 2070  going hook can p
+000053b0: 7265 7665 6e74 206f 7574 676f 696e 6720  revent outgoing 
+000053c0: 6368 616e 6765 7320 666f 7220 6c6f 6361  changes for loca
+000053d0: 6c20 636c 6f6e 6573 0a0a 2020 2420 6361  l clones..  $ ca
+000053e0: 7420 3e3e 2061 2f2e 6867 2f68 6772 6320  t >> a/.hg/hgrc 
+000053f0: 3c3c 454f 460a 2020 3e20 7072 656f 7574  <<EOF.  > preout
+00005400: 676f 696e 672e 666f 7262 6964 203d 2073  going.forbid = s
+00005410: 6820 2d63 2022 7072 696e 7465 6e76 2e70  h -c "printenv.p
+00005420: 7920 2d2d 6c69 6e65 2070 7265 6f75 7467  y --line preoutg
+00005430: 6f69 6e67 2e66 6f72 6269 6420 3122 0a20  oing.forbid 1". 
+00005440: 203e 2045 4f46 0a20 2024 2068 6720 636c   > EOF.  $ hg cl
+00005450: 6f6e 6520 6120 7a7a 7a0a 2020 7072 656f  one a zzz.  preo
+00005460: 7574 676f 696e 6720 686f 6f6b 3a20 4847  utgoing hook: HG
+00005470: 5f48 4f4f 4b4e 414d 453d 7072 656f 7574  _HOOKNAME=preout
+00005480: 676f 696e 670a 2020 4847 5f48 4f4f 4b54  going.  HG_HOOKT
+00005490: 5950 453d 7072 656f 7574 676f 696e 670a  YPE=preoutgoing.
+000054a0: 2020 4847 5f53 4f55 5243 453d 636c 6f6e    HG_SOURCE=clon
+000054b0: 650a 2020 0a20 2070 7265 6f75 7467 6f69  e.  .  preoutgoi
+000054c0: 6e67 2e66 6f72 6269 6420 686f 6f6b 3a20  ng.forbid hook: 
+000054d0: 4847 5f48 4f4f 4b4e 414d 453d 7072 656f  HG_HOOKNAME=preo
+000054e0: 7574 676f 696e 672e 666f 7262 6964 0a20  utgoing.forbid. 
+000054f0: 2048 475f 484f 4f4b 5459 5045 3d70 7265   HG_HOOKTYPE=pre
+00005500: 6f75 7467 6f69 6e67 0a20 2048 475f 534f  outgoing.  HG_SO
+00005510: 5552 4345 3d63 6c6f 6e65 0a20 200a 2020  URCE=clone.  .  
+00005520: 6162 6f72 743a 2070 7265 6f75 7467 6f69  abort: preoutgoi
+00005530: 6e67 2e66 6f72 6269 6420 686f 6f6b 2065  ng.forbid hook e
+00005540: 7869 7465 6420 7769 7468 2073 7461 7475  xited with statu
+00005550: 7320 310a 2020 5b34 305d 0a0a 2020 2420  s 1.  [40]..  $ 
+00005560: 6364 2022 2454 4553 5454 4d50 2f62 220a  cd "$TESTTMP/b".
+00005570: 0a20 2024 2063 6174 203e 2068 6f6f 6b74  .  $ cat > hookt
+00005580: 6573 7473 2e70 7920 3c3c 454f 460a 2020  ests.py <<EOF.  
+00005590: 3e20 6672 6f6d 206d 6572 6375 7269 616c  > from mercurial
+000055a0: 2069 6d70 6f72 7420 280a 2020 3e20 2020   import (.  >   
+000055b0: 2020 6572 726f 722c 0a20 203e 2020 2020    error,.  >    
+000055c0: 2070 7963 6f6d 7061 742c 0a20 203e 2029   pycompat,.  > )
+000055d0: 0a20 203e 200a 2020 3e20 756e 6361 6c6c  .  > .  > uncall
+000055e0: 6162 6c65 203d 2030 0a20 203e 200a 2020  able = 0.  > .  
+000055f0: 3e20 6465 6620 7072 696e 7461 7267 7328  > def printargs(
+00005600: 7569 2c20 6172 6773 293a 0a20 203e 2020  ui, args):.  >  
+00005610: 2020 2061 203d 206c 6973 7428 7079 636f     a = list(pyco
+00005620: 6d70 6174 2e62 7974 6573 6b77 6172 6773  mpat.byteskwargs
+00005630: 2861 7267 7329 2e69 7465 6d73 2829 290a  (args).items()).
+00005640: 2020 3e20 2020 2020 612e 736f 7274 2829    >     a.sort()
+00005650: 0a20 203e 2020 2020 2075 692e 7772 6974  .  >     ui.writ
+00005660: 6528 6227 686f 6f6b 2061 7267 733a 5c6e  e(b'hook args:\n
+00005670: 2729 0a20 203e 2020 2020 2066 6f72 206b  ').  >     for k
+00005680: 2c20 7620 696e 2061 3a0a 2020 3e20 2020  , v in a:.  >   
+00005690: 2020 2020 2075 692e 7772 6974 6528 6227       ui.write(b'
+000056a0: 2020 2573 2025 735c 6e27 2025 2028 6b2c    %s %s\n' % (k,
+000056b0: 2076 2929 0a20 203e 200a 2020 3e20 6465   v)).  > .  > de
+000056c0: 6620 7061 7373 686f 6f6b 2875 692c 2072  f passhook(ui, r
+000056d0: 6570 6f2c 202a 2a61 7267 7329 3a0a 2020  epo, **args):.  
+000056e0: 3e20 2020 2020 7072 696e 7461 7267 7328  >     printargs(
+000056f0: 7569 2c20 6172 6773 290a 2020 3e20 0a20  ui, args).  > . 
+00005700: 203e 2064 6566 2066 6169 6c68 6f6f 6b28   > def failhook(
+00005710: 7569 2c20 7265 706f 2c20 2a2a 6172 6773  ui, repo, **args
+00005720: 293a 0a20 203e 2020 2020 2070 7269 6e74  ):.  >     print
+00005730: 6172 6773 2875 692c 2061 7267 7329 0a20  args(ui, args). 
+00005740: 203e 2020 2020 2072 6574 7572 6e20 5472   >     return Tr
+00005750: 7565 0a20 203e 200a 2020 3e20 636c 6173  ue.  > .  > clas
+00005760: 7320 4c6f 6361 6c45 7863 6570 7469 6f6e  s LocalException
+00005770: 2845 7863 6570 7469 6f6e 293a 0a20 203e  (Exception):.  >
+00005780: 2020 2020 2070 6173 730a 2020 3e20 0a20       pass.  > . 
+00005790: 203e 2064 6566 2072 6169 7365 686f 6f6b   > def raisehook
+000057a0: 282a 2a61 7267 7329 3a0a 2020 3e20 2020  (**args):.  >   
+000057b0: 2020 7261 6973 6520 4c6f 6361 6c45 7863    raise LocalExc
+000057c0: 6570 7469 6f6e 2827 6578 6365 7074 696f  eption('exceptio
+000057d0: 6e20 6672 6f6d 2068 6f6f 6b27 290a 2020  n from hook').  
+000057e0: 3e20 0a20 203e 2064 6566 2061 626f 7274  > .  > def abort
+000057f0: 686f 6f6b 282a 2a61 7267 7329 3a0a 2020  hook(**args):.  
+00005800: 3e20 2020 2020 7261 6973 6520 6572 726f  >     raise erro
+00005810: 722e 4162 6f72 7428 6227 7261 6973 6520  r.Abort(b'raise 
+00005820: 6162 6f72 7420 6672 6f6d 2068 6f6f 6b27  abort from hook'
+00005830: 290a 2020 3e20 0a20 203e 2064 6566 2062  ).  > .  > def b
+00005840: 726f 6b65 6e68 6f6f 6b28 2a2a 6172 6773  rokenhook(**args
+00005850: 293a 0a20 203e 2020 2020 2072 6574 7572  ):.  >     retur
+00005860: 6e20 3120 2b20 7b7d 0a20 203e 200a 2020  n 1 + {}.  > .  
+00005870: 3e20 6465 6620 7665 7262 6f73 6568 6f6f  > def verbosehoo
+00005880: 6b28 7569 2c20 2a2a 6172 6773 293a 0a20  k(ui, **args):. 
+00005890: 203e 2020 2020 2075 692e 6e6f 7465 2862   >     ui.note(b
+000058a0: 2776 6572 626f 7365 206f 7574 7075 7420  'verbose output 
+000058b0: 6672 6f6d 2068 6f6f 6b5c 6e27 290a 2020  from hook\n').  
+000058c0: 3e20 0a20 203e 2064 6566 2070 7269 6e74  > .  > def print
+000058d0: 7461 6773 2875 692c 2072 6570 6f2c 202a  tags(ui, repo, *
+000058e0: 2a61 7267 7329 3a0a 2020 3e20 2020 2020  *args):.  >     
+000058f0: 7569 2e77 7269 7465 2862 275b 2573 5d5c  ui.write(b'[%s]\
+00005900: 6e27 2025 2062 272c 2027 2e6a 6f69 6e28  n' % b', '.join(
+00005910: 736f 7274 6564 2872 6570 6f2e 7461 6773  sorted(repo.tags
+00005920: 2829 2929 290a 2020 3e20 0a20 203e 2063  ()))).  > .  > c
+00005930: 6c61 7373 2063 6f6e 7461 696e 6572 286f  lass container(o
+00005940: 626a 6563 7429 3a0a 2020 3e20 2020 2020  bject):.  >     
+00005950: 756e 7265 6163 6861 626c 6520 3d20 310a  unreachable = 1.
+00005960: 2020 3e20 454f 460a 0a20 2024 2063 6174    > EOF..  $ cat
+00005970: 203e 2073 796e 7461 7865 7272 6f72 2e70   > syntaxerror.p
+00005980: 7920 3c3c 204e 4f5f 4348 4543 4b5f 454f  y << NO_CHECK_EO
+00005990: 460a 2020 3e20 2866 6f6f 0a20 203e 204e  F.  > (foo.  > N
+000059a0: 4f5f 4348 4543 4b5f 454f 460a 0a74 6573  O_CHECK_EOF..tes
+000059b0: 7420 7079 7468 6f6e 2068 6f6f 6b73 0a0a  t python hooks..
+000059c0: 2369 6620 7769 6e64 6f77 730a 2020 2420  #if windows.  $ 
+000059d0: 5059 5448 4f4e 5041 5448 3d22 2454 4553  PYTHONPATH="$TES
+000059e0: 5454 4d50 2f62 3b24 5059 5448 4f4e 5041  TTMP/b;$PYTHONPA
+000059f0: 5448 220a 2365 6c73 650a 2020 2420 5059  TH".#else.  $ PY
+00005a00: 5448 4f4e 5041 5448 3d22 2454 4553 5454  THONPATH="$TESTT
+00005a10: 4d50 2f62 3a24 5059 5448 4f4e 5041 5448  MP/b:$PYTHONPATH
+00005a20: 220a 2365 6e64 6966 0a20 2024 2065 7870  ".#endif.  $ exp
+00005a30: 6f72 7420 5059 5448 4f4e 5041 5448 0a0a  ort PYTHONPATH..
+00005a40: 2020 2420 6563 686f 2027 5b68 6f6f 6b73    $ echo '[hooks
+00005a50: 5d27 203e 202e 2e2f 612f 2e68 672f 6867  ]' > ../a/.hg/hg
+00005a60: 7263 0a20 2024 2065 6368 6f20 2770 7265  rc.  $ echo 'pre
+00005a70: 6f75 7467 6f69 6e67 2e62 726f 6b65 6e20  outgoing.broken 
+00005a80: 3d20 7079 7468 6f6e 3a68 6f6f 6b74 6573  = python:hooktes
+00005a90: 7473 2e62 726f 6b65 6e68 6f6f 6b27 203e  ts.brokenhook' >
+00005aa0: 3e20 2e2e 2f61 2f2e 6867 2f68 6772 630a  > ../a/.hg/hgrc.
+00005ab0: 2020 2420 6867 2070 756c 6c20 2e2e 2f61    $ hg pull ../a
+00005ac0: 2032 3e26 3120 7c20 6772 6570 2027 7261   2>&1 | grep 'ra
+00005ad0: 6973 6564 2061 6e20 6578 6365 7074 696f  ised an exceptio
+00005ae0: 6e27 0a20 2065 7272 6f72 3a20 7072 656f  n'.  error: preo
+00005af0: 7574 676f 696e 672e 6272 6f6b 656e 2068  utgoing.broken h
+00005b00: 6f6f 6b20 7261 6973 6564 2061 6e20 6578  ook raised an ex
+00005b10: 6365 7074 696f 6e3a 2075 6e73 7570 706f  ception: unsuppo
+00005b20: 7274 6564 206f 7065 7261 6e64 2074 7970  rted operand typ
+00005b30: 6528 7329 2066 6f72 202b 3a20 2769 6e74  e(s) for +: 'int
+00005b40: 2720 616e 6420 2764 6963 7427 0a0a 2020  ' and 'dict'..  
+00005b50: 2420 6563 686f 2027 5b68 6f6f 6b73 5d27  $ echo '[hooks]'
+00005b60: 203e 202e 2e2f 612f 2e68 672f 6867 7263   > ../a/.hg/hgrc
+00005b70: 0a20 2024 2065 6368 6f20 2770 7265 6f75  .  $ echo 'preou
+00005b80: 7467 6f69 6e67 2e72 6169 7365 203d 2070  tgoing.raise = p
+00005b90: 7974 686f 6e3a 686f 6f6b 7465 7374 732e  ython:hooktests.
+00005ba0: 7261 6973 6568 6f6f 6b27 203e 3e20 2e2e  raisehook' >> ..
+00005bb0: 2f61 2f2e 6867 2f68 6772 630a 2020 2420  /a/.hg/hgrc.  $ 
+00005bc0: 6867 2070 756c 6c20 2e2e 2f61 2032 3e26  hg pull ../a 2>&
+00005bd0: 3120 7c20 6772 6570 2027 7261 6973 6564  1 | grep 'raised
+00005be0: 2061 6e20 6578 6365 7074 696f 6e27 0a20   an exception'. 
+00005bf0: 2065 7272 6f72 3a20 7072 656f 7574 676f   error: preoutgo
+00005c00: 696e 672e 7261 6973 6520 686f 6f6b 2072  ing.raise hook r
+00005c10: 6169 7365 6420 616e 2065 7863 6570 7469  aised an excepti
+00005c20: 6f6e 3a20 6578 6365 7074 696f 6e20 6672  on: exception fr
+00005c30: 6f6d 2068 6f6f 6b0a 0a20 2024 2065 6368  om hook..  $ ech
+00005c40: 6f20 275b 686f 6f6b 735d 2720 3e20 2e2e  o '[hooks]' > ..
+00005c50: 2f61 2f2e 6867 2f68 6772 630a 2020 2420  /a/.hg/hgrc.  $ 
+00005c60: 6563 686f 2027 7072 656f 7574 676f 696e  echo 'preoutgoin
+00005c70: 672e 6162 6f72 7420 3d20 7079 7468 6f6e  g.abort = python
+00005c80: 3a68 6f6f 6b74 6573 7473 2e61 626f 7274  :hooktests.abort
+00005c90: 686f 6f6b 2720 3e3e 202e 2e2f 612f 2e68  hook' >> ../a/.h
+00005ca0: 672f 6867 7263 0a20 2024 2068 6720 7075  g/hgrc.  $ hg pu
+00005cb0: 6c6c 202e 2e2f 610a 2020 7075 6c6c 696e  ll ../a.  pullin
+00005cc0: 6720 6672 6f6d 202e 2e2f 610a 2020 7365  g from ../a.  se
+00005cd0: 6172 6368 696e 6720 666f 7220 6368 616e  arching for chan
+00005ce0: 6765 730a 2020 6572 726f 723a 2070 7265  ges.  error: pre
+00005cf0: 6f75 7467 6f69 6e67 2e61 626f 7274 2068  outgoing.abort h
+00005d00: 6f6f 6b20 6661 696c 6564 3a20 7261 6973  ook failed: rais
+00005d10: 6520 6162 6f72 7420 6672 6f6d 2068 6f6f  e abort from hoo
+00005d20: 6b0a 2020 6162 6f72 743a 2072 6169 7365  k.  abort: raise
+00005d30: 2061 626f 7274 2066 726f 6d20 686f 6f6b   abort from hook
+00005d40: 0a20 205b 3235 355d 0a0a 2020 2420 6563  .  [255]..  $ ec
+00005d50: 686f 2027 5b68 6f6f 6b73 5d27 203e 202e  ho '[hooks]' > .
+00005d60: 2e2f 612f 2e68 672f 6867 7263 0a20 2024  ./a/.hg/hgrc.  $
+00005d70: 2065 6368 6f20 2770 7265 6f75 7467 6f69   echo 'preoutgoi
+00005d80: 6e67 2e66 6169 6c20 3d20 7079 7468 6f6e  ng.fail = python
+00005d90: 3a68 6f6f 6b74 6573 7473 2e66 6169 6c68  :hooktests.failh
+00005da0: 6f6f 6b27 203e 3e20 2e2e 2f61 2f2e 6867  ook' >> ../a/.hg
+00005db0: 2f68 6772 630a 2020 2420 6867 2070 756c  /hgrc.  $ hg pul
+00005dc0: 6c20 2e2e 2f61 0a20 2070 756c 6c69 6e67  l ../a.  pulling
+00005dd0: 2066 726f 6d20 2e2e 2f61 0a20 2073 6561   from ../a.  sea
+00005de0: 7263 6869 6e67 2066 6f72 2063 6861 6e67  rching for chang
+00005df0: 6573 0a20 2068 6f6f 6b20 6172 6773 3a0a  es.  hook args:.
+00005e00: 2020 2020 686f 6f6b 7479 7065 2070 7265      hooktype pre
+00005e10: 6f75 7467 6f69 6e67 0a20 2020 2073 6f75  outgoing.    sou
+00005e20: 7263 6520 7075 6c6c 0a20 2061 626f 7274  rce pull.  abort
+00005e30: 3a20 7072 656f 7574 676f 696e 672e 6661  : preoutgoing.fa
+00005e40: 696c 2068 6f6f 6b20 6661 696c 6564 0a20  il hook failed. 
+00005e50: 205b 3430 5d0a 0a20 2024 2065 6368 6f20   [40]..  $ echo 
+00005e60: 275b 686f 6f6b 735d 2720 3e20 2e2e 2f61  '[hooks]' > ../a
+00005e70: 2f2e 6867 2f68 6772 630a 2020 2420 6563  /.hg/hgrc.  $ ec
+00005e80: 686f 2027 7072 656f 7574 676f 696e 672e  ho 'preoutgoing.
+00005e90: 756e 6361 6c6c 6162 6c65 203d 2070 7974  uncallable = pyt
+00005ea0: 686f 6e3a 686f 6f6b 7465 7374 732e 756e  hon:hooktests.un
+00005eb0: 6361 6c6c 6162 6c65 2720 3e3e 202e 2e2f  callable' >> ../
+00005ec0: 612f 2e68 672f 6867 7263 0a20 2024 2068  a/.hg/hgrc.  $ h
+00005ed0: 6720 7075 6c6c 202e 2e2f 610a 2020 7075  g pull ../a.  pu
+00005ee0: 6c6c 696e 6720 6672 6f6d 202e 2e2f 610a  lling from ../a.
+00005ef0: 2020 7365 6172 6368 696e 6720 666f 7220    searching for 
+00005f00: 6368 616e 6765 730a 2020 6162 6f72 743a  changes.  abort:
+00005f10: 2070 7265 6f75 7467 6f69 6e67 2e75 6e63   preoutgoing.unc
+00005f20: 616c 6c61 626c 6520 686f 6f6b 2069 7320  allable hook is 
+00005f30: 696e 7661 6c69 643a 2022 686f 6f6b 7465  invalid: "hookte
+00005f40: 7374 732e 756e 6361 6c6c 6162 6c65 2220  sts.uncallable" 
+00005f50: 6973 206e 6f74 2063 616c 6c61 626c 650a  is not callable.
+00005f60: 2020 5b32 3535 5d0a 0a20 2024 2065 6368    [255]..  $ ech
+00005f70: 6f20 275b 686f 6f6b 735d 2720 3e20 2e2e  o '[hooks]' > ..
+00005f80: 2f61 2f2e 6867 2f68 6772 630a 2020 2420  /a/.hg/hgrc.  $ 
+00005f90: 6563 686f 2027 7072 656f 7574 676f 696e  echo 'preoutgoin
+00005fa0: 672e 6e6f 686f 6f6b 203d 2070 7974 686f  g.nohook = pytho
+00005fb0: 6e3a 686f 6f6b 7465 7374 732e 6e6f 686f  n:hooktests.noho
+00005fc0: 6f6b 2720 3e3e 202e 2e2f 612f 2e68 672f  ok' >> ../a/.hg/
+00005fd0: 6867 7263 0a20 2024 2068 6720 7075 6c6c  hgrc.  $ hg pull
+00005fe0: 202e 2e2f 610a 2020 7075 6c6c 696e 6720   ../a.  pulling 
+00005ff0: 6672 6f6d 202e 2e2f 610a 2020 7365 6172  from ../a.  sear
+00006000: 6368 696e 6720 666f 7220 6368 616e 6765  ching for change
+00006010: 730a 2020 6162 6f72 743a 2070 7265 6f75  s.  abort: preou
+00006020: 7467 6f69 6e67 2e6e 6f68 6f6f 6b20 686f  tgoing.nohook ho
+00006030: 6f6b 2069 7320 696e 7661 6c69 643a 2022  ok is invalid: "
+00006040: 686f 6f6b 7465 7374 732e 6e6f 686f 6f6b  hooktests.nohook
+00006050: 2220 6973 206e 6f74 2064 6566 696e 6564  " is not defined
+00006060: 0a20 205b 3235 355d 0a0a 2020 2420 6563  .  [255]..  $ ec
+00006070: 686f 2027 5b68 6f6f 6b73 5d27 203e 202e  ho '[hooks]' > .
+00006080: 2e2f 612f 2e68 672f 6867 7263 0a20 2024  ./a/.hg/hgrc.  $
+00006090: 2065 6368 6f20 2770 7265 6f75 7467 6f69   echo 'preoutgoi
+000060a0: 6e67 2e6e 6f6d 6f64 756c 6520 3d20 7079  ng.nomodule = py
+000060b0: 7468 6f6e 3a6e 6f6d 6f64 756c 6527 203e  thon:nomodule' >
+000060c0: 3e20 2e2e 2f61 2f2e 6867 2f68 6772 630a  > ../a/.hg/hgrc.
+000060d0: 2020 2420 6867 2070 756c 6c20 2e2e 2f61    $ hg pull ../a
+000060e0: 0a20 2070 756c 6c69 6e67 2066 726f 6d20  .  pulling from 
+000060f0: 2e2e 2f61 0a20 2073 6561 7263 6869 6e67  ../a.  searching
+00006100: 2066 6f72 2063 6861 6e67 6573 0a20 2061   for changes.  a
+00006110: 626f 7274 3a20 7072 656f 7574 676f 696e  bort: preoutgoin
+00006120: 672e 6e6f 6d6f 6475 6c65 2068 6f6f 6b20  g.nomodule hook 
+00006130: 6973 2069 6e76 616c 6964 3a20 226e 6f6d  is invalid: "nom
+00006140: 6f64 756c 6522 206e 6f74 2069 6e20 6120  odule" not in a 
+00006150: 6d6f 6475 6c65 0a20 205b 3235 355d 0a0a  module.  [255]..
+00006160: 2020 2420 6563 686f 2027 5b68 6f6f 6b73    $ echo '[hooks
+00006170: 5d27 203e 202e 2e2f 612f 2e68 672f 6867  ]' > ../a/.hg/hg
+00006180: 7263 0a20 2024 2065 6368 6f20 2770 7265  rc.  $ echo 'pre
+00006190: 6f75 7467 6f69 6e67 2e62 6164 6d6f 6475  outgoing.badmodu
+000061a0: 6c65 203d 2070 7974 686f 6e3a 6e6f 6d6f  le = python:nomo
+000061b0: 6475 6c65 2e6e 6f77 6865 7265 2720 3e3e  dule.nowhere' >>
+000061c0: 202e 2e2f 612f 2e68 672f 6867 7263 0a20   ../a/.hg/hgrc. 
+000061d0: 2024 2068 6720 7075 6c6c 202e 2e2f 610a   $ hg pull ../a.
+000061e0: 2020 7075 6c6c 696e 6720 6672 6f6d 202e    pulling from .
+000061f0: 2e2f 610a 2020 7365 6172 6368 696e 6720  ./a.  searching 
+00006200: 666f 7220 6368 616e 6765 730a 2020 6162  for changes.  ab
+00006210: 6f72 743a 2070 7265 6f75 7467 6f69 6e67  ort: preoutgoing
+00006220: 2e62 6164 6d6f 6475 6c65 2068 6f6f 6b20  .badmodule hook 
+00006230: 6973 2069 6e76 616c 6964 3a20 696d 706f  is invalid: impo
+00006240: 7274 206f 6620 226e 6f6d 6f64 756c 6522  rt of "nomodule"
+00006250: 2066 6169 6c65 640a 2020 2872 756e 2077   failed.  (run w
+00006260: 6974 6820 2d2d 7472 6163 6562 6163 6b20  ith --traceback 
+00006270: 666f 7220 7374 6163 6b20 7472 6163 6529  for stack trace)
+00006280: 0a20 205b 3235 355d 0a0a 2020 2420 6563  .  [255]..  $ ec
+00006290: 686f 2027 5b68 6f6f 6b73 5d27 203e 202e  ho '[hooks]' > .
+000062a0: 2e2f 612f 2e68 672f 6867 7263 0a20 2024  ./a/.hg/hgrc.  $
+000062b0: 2065 6368 6f20 2770 7265 6f75 7467 6f69   echo 'preoutgoi
+000062c0: 6e67 2e75 6e72 6561 6368 6162 6c65 203d  ng.unreachable =
+000062d0: 2070 7974 686f 6e3a 686f 6f6b 7465 7374   python:hooktest
+000062e0: 732e 636f 6e74 6169 6e65 722e 756e 7265  s.container.unre
+000062f0: 6163 6861 626c 6527 203e 3e20 2e2e 2f61  achable' >> ../a
+00006300: 2f2e 6867 2f68 6772 630a 2020 2420 6867  /.hg/hgrc.  $ hg
+00006310: 2070 756c 6c20 2e2e 2f61 0a20 2070 756c   pull ../a.  pul
+00006320: 6c69 6e67 2066 726f 6d20 2e2e 2f61 0a20  ling from ../a. 
+00006330: 2073 6561 7263 6869 6e67 2066 6f72 2063   searching for c
+00006340: 6861 6e67 6573 0a20 2061 626f 7274 3a20  hanges.  abort: 
+00006350: 7072 656f 7574 676f 696e 672e 756e 7265  preoutgoing.unre
+00006360: 6163 6861 626c 6520 686f 6f6b 2069 7320  achable hook is 
+00006370: 696e 7661 6c69 643a 2069 6d70 6f72 7420  invalid: import 
+00006380: 6f66 2022 686f 6f6b 7465 7374 732e 636f  of "hooktests.co
+00006390: 6e74 6169 6e65 7222 2066 6169 6c65 640a  ntainer" failed.
+000063a0: 2020 2872 756e 2077 6974 6820 2d2d 7472    (run with --tr
+000063b0: 6163 6562 6163 6b20 666f 7220 7374 6163  aceback for stac
+000063c0: 6b20 7472 6163 6529 0a20 205b 3235 355d  k trace).  [255]
+000063d0: 0a0a 2020 2420 6563 686f 2027 5b68 6f6f  ..  $ echo '[hoo
+000063e0: 6b73 5d27 203e 202e 2e2f 612f 2e68 672f  ks]' > ../a/.hg/
+000063f0: 6867 7263 0a20 2024 2065 6368 6f20 2770  hgrc.  $ echo 'p
+00006400: 7265 6f75 7467 6f69 6e67 2e73 796e 7461  reoutgoing.synta
+00006410: 7865 7272 6f72 203d 2070 7974 686f 6e3a  xerror = python:
+00006420: 7379 6e74 6178 6572 726f 722e 7379 6e74  syntaxerror.synt
+00006430: 6178 6572 726f 7227 203e 3e20 2e2e 2f61  axerror' >> ../a
+00006440: 2f2e 6867 2f68 6772 630a 2020 2420 6867  /.hg/hgrc.  $ hg
+00006450: 2070 756c 6c20 2e2e 2f61 0a20 2070 756c   pull ../a.  pul
+00006460: 6c69 6e67 2066 726f 6d20 2e2e 2f61 0a20  ling from ../a. 
+00006470: 2073 6561 7263 6869 6e67 2066 6f72 2063   searching for c
+00006480: 6861 6e67 6573 0a20 2061 626f 7274 3a20  hanges.  abort: 
+00006490: 7072 656f 7574 676f 696e 672e 7379 6e74  preoutgoing.synt
+000064a0: 6178 6572 726f 7220 686f 6f6b 2069 7320  axerror hook is 
+000064b0: 696e 7661 6c69 643a 2069 6d70 6f72 7420  invalid: import 
+000064c0: 6f66 2022 7379 6e74 6178 6572 726f 7222  of "syntaxerror"
+000064d0: 2066 6169 6c65 640a 2020 2872 756e 2077   failed.  (run w
+000064e0: 6974 6820 2d2d 7472 6163 6562 6163 6b20  ith --traceback 
+000064f0: 666f 7220 7374 6163 6b20 7472 6163 6529  for stack trace)
+00006500: 0a20 205b 3235 355d 0a0a 2020 2420 6867  .  [255]..  $ hg
+00006510: 2070 756c 6c20 2e2e 2f61 202d 2d74 7261   pull ../a --tra
+00006520: 6365 6261 636b 2032 3e26 3120 7c20 6567  ceback 2>&1 | eg
+00006530: 7265 7020 2770 756c 6c69 6e67 7c73 6561  rep 'pulling|sea
+00006540: 7263 6869 6e67 7c5e 6578 6365 7074 696f  rching|^exceptio
+00006550: 6e7c 5472 6163 6562 6163 6b7c 5379 6e74  n|Traceback|Synt
+00006560: 6178 4572 726f 727c 496d 706f 7274 4572  axError|ImportEr
+00006570: 726f 727c 4d6f 6475 6c65 4e6f 7446 6f75  ror|ModuleNotFou
+00006580: 6e64 4572 726f 727c 486f 6f6b 4c6f 6164  ndError|HookLoad
+00006590: 4572 726f 727c 6162 6f72 7427 0a20 2070  Error|abort'.  p
+000065a0: 756c 6c69 6e67 2066 726f 6d20 2e2e 2f61  ulling from ../a
+000065b0: 0a20 2073 6561 7263 6869 6e67 2066 6f72  .  searching for
+000065c0: 2063 6861 6e67 6573 0a20 2065 7863 6570   changes.  excep
+000065d0: 7469 6f6e 2066 726f 6d20 6669 7273 7420  tion from first 
+000065e0: 6661 696c 6564 2069 6d70 6f72 7420 6174  failed import at
+000065f0: 7465 6d70 743a 0a20 2054 7261 6365 6261  tempt:.  Traceba
+00006600: 636b 2028 6d6f 7374 2072 6563 656e 7420  ck (most recent 
+00006610: 6361 6c6c 206c 6173 7429 3a0a 2020 5379  call last):.  Sy
+00006620: 6e74 6178 4572 726f 723a 202a 2028 676c  ntaxError: * (gl
+00006630: 6f62 290a 2020 6578 6365 7074 696f 6e20  ob).  exception 
+00006640: 6672 6f6d 2073 6563 6f6e 6420 6661 696c  from second fail
+00006650: 6564 2069 6d70 6f72 7420 6174 7465 6d70  ed import attemp
+00006660: 743a 0a20 2054 7261 6365 6261 636b 2028  t:.  Traceback (
+00006670: 6d6f 7374 2072 6563 656e 7420 6361 6c6c  most recent call
+00006680: 206c 6173 7429 3a0a 2020 5379 6e74 6178   last):.  Syntax
+00006690: 4572 726f 723a 202a 2028 676c 6f62 290a  Error: * (glob).
+000066a0: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
+000066b0: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
+000066c0: 7374 293a 0a20 204d 6f64 756c 654e 6f74  st):.  ModuleNot
+000066d0: 466f 756e 6445 7272 6f72 3a20 4e6f 206d  FoundError: No m
+000066e0: 6f64 756c 6520 6e61 6d65 6420 2768 6765  odule named 'hge
+000066f0: 7874 5f73 796e 7461 7865 7272 6f72 270a  xt_syntaxerror'.
+00006700: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
+00006710: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
+00006720: 7374 293a 0a20 2053 796e 7461 7845 7272  st):.  SyntaxErr
+00006730: 6f72 3a20 2a20 2867 6c6f 6229 0a20 2054  or: * (glob).  T
+00006740: 7261 6365 6261 636b 2028 6d6f 7374 2072  raceback (most r
+00006750: 6563 656e 7420 6361 6c6c 206c 6173 7429  ecent call last)
+00006760: 3a0a 2020 4d6f 6475 6c65 4e6f 7446 6f75  :.  ModuleNotFou
+00006770: 6e64 4572 726f 723a 204e 6f20 6d6f 6475  ndError: No modu
+00006780: 6c65 206e 616d 6564 2027 6867 6578 745f  le named 'hgext_
+00006790: 7379 6e74 6178 6572 726f 7227 0a20 2054  syntaxerror'.  T
+000067a0: 7261 6365 6261 636b 2028 6d6f 7374 2072  raceback (most r
+000067b0: 6563 656e 7420 6361 6c6c 206c 6173 7429  ecent call last)
+000067c0: 3a0a 2020 2020 2020 7261 6973 6520 6572  :.      raise er
+000067d0: 726f 722e 486f 6f6b 4c6f 6164 4572 726f  ror.HookLoadErro
+000067e0: 7228 2028 7079 3338 2021 290a 2020 6d65  r( (py38 !).  me
+000067f0: 7263 7572 6961 6c2e 6572 726f 722e 486f  rcurial.error.Ho
+00006800: 6f6b 4c6f 6164 4572 726f 723a 2070 7265  okLoadError: pre
+00006810: 6f75 7467 6f69 6e67 2e73 796e 7461 7865  outgoing.syntaxe
+00006820: 7272 6f72 2068 6f6f 6b20 6973 2069 6e76  rror hook is inv
+00006830: 616c 6964 3a20 696d 706f 7274 206f 6620  alid: import of 
+00006840: 2273 796e 7461 7865 7272 6f72 2220 6661  "syntaxerror" fa
+00006850: 696c 6564 0a20 2061 626f 7274 3a20 7072  iled.  abort: pr
+00006860: 656f 7574 676f 696e 672e 7379 6e74 6178  eoutgoing.syntax
+00006870: 6572 726f 7220 686f 6f6b 2069 7320 696e  error hook is in
+00006880: 7661 6c69 643a 2069 6d70 6f72 7420 6f66  valid: import of
+00006890: 2022 7379 6e74 6178 6572 726f 7222 2066   "syntaxerror" f
+000068a0: 6169 6c65 640a 0a20 2024 2065 6368 6f20  ailed..  $ echo 
+000068b0: 275b 686f 6f6b 735d 2720 3e20 2e2e 2f61  '[hooks]' > ../a
+000068c0: 2f2e 6867 2f68 6772 630a 2020 2420 6563  /.hg/hgrc.  $ ec
+000068d0: 686f 2027 7072 656f 7574 676f 696e 672e  ho 'preoutgoing.
+000068e0: 7061 7373 203d 2070 7974 686f 6e3a 686f  pass = python:ho
+000068f0: 6f6b 7465 7374 732e 7061 7373 686f 6f6b  oktests.passhook
+00006900: 2720 3e3e 202e 2e2f 612f 2e68 672f 6867  ' >> ../a/.hg/hg
+00006910: 7263 0a20 2024 2068 6720 7075 6c6c 202e  rc.  $ hg pull .
+00006920: 2e2f 610a 2020 7075 6c6c 696e 6720 6672  ./a.  pulling fr
+00006930: 6f6d 202e 2e2f 610a 2020 7365 6172 6368  om ../a.  search
+00006940: 696e 6720 666f 7220 6368 616e 6765 730a  ing for changes.
+00006950: 2020 686f 6f6b 2061 7267 733a 0a20 2020    hook args:.   
+00006960: 2068 6f6f 6b74 7970 6520 7072 656f 7574   hooktype preout
+00006970: 676f 696e 670a 2020 2020 736f 7572 6365  going.    source
+00006980: 2070 756c 6c0a 2020 6164 6469 6e67 2063   pull.  adding c
+00006990: 6861 6e67 6573 6574 730a 2020 6164 6469  hangesets.  addi
+000069a0: 6e67 206d 616e 6966 6573 7473 0a20 2061  ng manifests.  a
+000069b0: 6464 696e 6720 6669 6c65 2063 6861 6e67  dding file chang
+000069c0: 6573 0a20 2061 6464 696e 6720 7265 6d6f  es.  adding remo
+000069d0: 7465 2062 6f6f 6b6d 6172 6b20 7175 7578  te bookmark quux
+000069e0: 0a20 2061 6464 6564 2031 2063 6861 6e67  .  added 1 chang
+000069f0: 6573 6574 7320 7769 7468 2031 2063 6861  esets with 1 cha
+00006a00: 6e67 6573 2074 6f20 3120 6669 6c65 730a  nges to 1 files.
+00006a10: 2020 6e65 7720 6368 616e 6765 7365 7473    new changesets
+00006a20: 2035 3339 6534 6233 3162 3664 630a 2020   539e4b31b6dc.  
+00006a30: 2872 756e 2027 6867 2075 7064 6174 6527  (run 'hg update'
+00006a40: 2074 6f20 6765 7420 6120 776f 726b 696e   to get a workin
+00006a50: 6720 636f 7079 290a 0a70 6f73 742d 2070  g copy)..post- p
+00006a60: 7974 686f 6e20 686f 6f6b 7320 7468 6174  ython hooks that
+00006a70: 2066 6169 6c20 746f 202a 7275 6e2a 2064   fail to *run* d
+00006a80: 6f6e 2774 2063 6175 7365 2061 6e20 6162  on't cause an ab
+00006a90: 6f72 740a 2020 2420 726d 202e 2e2f 612f  ort.  $ rm ../a/
+00006aa0: 2e68 672f 6867 7263 0a20 2024 2065 6368  .hg/hgrc.  $ ech
+00006ab0: 6f20 275b 686f 6f6b 735d 2720 3e20 2e68  o '[hooks]' > .h
+00006ac0: 672f 6867 7263 0a20 2024 2065 6368 6f20  g/hgrc.  $ echo 
+00006ad0: 2770 6f73 742d 7075 6c6c 2e62 726f 6b65  'post-pull.broke
+00006ae0: 6e20 3d20 7079 7468 6f6e 3a68 6f6f 6b74  n = python:hookt
+00006af0: 6573 7473 2e62 726f 6b65 6e68 6f6f 6b27  ests.brokenhook'
+00006b00: 203e 3e20 2e68 672f 6867 7263 0a20 2024   >> .hg/hgrc.  $
+00006b10: 2068 6720 7075 6c6c 202e 2e2f 610a 2020   hg pull ../a.  
+00006b20: 7075 6c6c 696e 6720 6672 6f6d 202e 2e2f  pulling from ../
+00006b30: 610a 2020 7365 6172 6368 696e 6720 666f  a.  searching fo
+00006b40: 7220 6368 616e 6765 730a 2020 6e6f 2063  r changes.  no c
+00006b50: 6861 6e67 6573 2066 6f75 6e64 0a20 2065  hanges found.  e
+00006b60: 7272 6f72 3a20 706f 7374 2d70 756c 6c2e  rror: post-pull.
+00006b70: 6272 6f6b 656e 2068 6f6f 6b20 7261 6973  broken hook rais
+00006b80: 6564 2061 6e20 6578 6365 7074 696f 6e3a  ed an exception:
+00006b90: 2075 6e73 7570 706f 7274 6564 206f 7065   unsupported ope
+00006ba0: 7261 6e64 2074 7970 6528 7329 2066 6f72  rand type(s) for
+00006bb0: 202b 3a20 2769 6e74 2720 616e 6420 2764   +: 'int' and 'd
+00006bc0: 6963 7427 0a20 2028 7275 6e20 7769 7468  ict'.  (run with
+00006bd0: 202d 2d74 7261 6365 6261 636b 2066 6f72   --traceback for
+00006be0: 2073 7461 636b 2074 7261 6365 290a 0a62   stack trace)..b
+00006bf0: 7574 2070 6f73 742d 2070 7974 686f 6e20  ut post- python 
+00006c00: 686f 6f6b 7320 7468 6174 2066 6169 6c20  hooks that fail 
+00006c10: 746f 202a 6c6f 6164 2a20 646f 0a20 2024  to *load* do.  $
+00006c20: 2065 6368 6f20 275b 686f 6f6b 735d 2720   echo '[hooks]' 
+00006c30: 3e20 2e68 672f 6867 7263 0a20 2024 2065  > .hg/hgrc.  $ e
+00006c40: 6368 6f20 2770 6f73 742d 7075 6c6c 2e6e  cho 'post-pull.n
+00006c50: 6f6d 6f64 756c 6520 3d20 7079 7468 6f6e  omodule = python
+00006c60: 3a6e 6f6d 6f64 756c 6527 203e 3e20 2e68  :nomodule' >> .h
+00006c70: 672f 6867 7263 0a20 2024 2068 6720 7075  g/hgrc.  $ hg pu
+00006c80: 6c6c 202e 2e2f 610a 2020 7075 6c6c 696e  ll ../a.  pullin
+00006c90: 6720 6672 6f6d 202e 2e2f 610a 2020 7365  g from ../a.  se
+00006ca0: 6172 6368 696e 6720 666f 7220 6368 616e  arching for chan
+00006cb0: 6765 730a 2020 6e6f 2063 6861 6e67 6573  ges.  no changes
+00006cc0: 2066 6f75 6e64 0a20 2061 626f 7274 3a20   found.  abort: 
+00006cd0: 706f 7374 2d70 756c 6c2e 6e6f 6d6f 6475  post-pull.nomodu
+00006ce0: 6c65 2068 6f6f 6b20 6973 2069 6e76 616c  le hook is inval
+00006cf0: 6964 3a20 226e 6f6d 6f64 756c 6522 206e  id: "nomodule" n
+00006d00: 6f74 2069 6e20 6120 6d6f 6475 6c65 0a20  ot in a module. 
+00006d10: 205b 3235 355d 0a0a 2020 2420 6563 686f   [255]..  $ echo
+00006d20: 2027 5b68 6f6f 6b73 5d27 203e 202e 6867   '[hooks]' > .hg
+00006d30: 2f68 6772 630a 2020 2420 6563 686f 2027  /hgrc.  $ echo '
+00006d40: 706f 7374 2d70 756c 6c2e 6261 646d 6f64  post-pull.badmod
+00006d50: 756c 6520 3d20 7079 7468 6f6e 3a6e 6f6d  ule = python:nom
+00006d60: 6f64 756c 652e 6e6f 7768 6572 6527 203e  odule.nowhere' >
+00006d70: 3e20 2e68 672f 6867 7263 0a20 2024 2068  > .hg/hgrc.  $ h
+00006d80: 6720 7075 6c6c 202e 2e2f 610a 2020 7075  g pull ../a.  pu
+00006d90: 6c6c 696e 6720 6672 6f6d 202e 2e2f 610a  lling from ../a.
+00006da0: 2020 7365 6172 6368 696e 6720 666f 7220    searching for 
+00006db0: 6368 616e 6765 730a 2020 6e6f 2063 6861  changes.  no cha
+00006dc0: 6e67 6573 2066 6f75 6e64 0a20 2061 626f  nges found.  abo
+00006dd0: 7274 3a20 706f 7374 2d70 756c 6c2e 6261  rt: post-pull.ba
+00006de0: 646d 6f64 756c 6520 686f 6f6b 2069 7320  dmodule hook is 
+00006df0: 696e 7661 6c69 643a 2069 6d70 6f72 7420  invalid: import 
+00006e00: 6f66 2022 6e6f 6d6f 6475 6c65 2220 6661  of "nomodule" fa
+00006e10: 696c 6564 0a20 2028 7275 6e20 7769 7468  iled.  (run with
+00006e20: 202d 2d74 7261 6365 6261 636b 2066 6f72   --traceback for
+00006e30: 2073 7461 636b 2074 7261 6365 290a 2020   stack trace).  
+00006e40: 5b32 3535 5d0a 0a20 2024 2065 6368 6f20  [255]..  $ echo 
+00006e50: 275b 686f 6f6b 735d 2720 3e20 2e68 672f  '[hooks]' > .hg/
+00006e60: 6867 7263 0a20 2024 2065 6368 6f20 2770  hgrc.  $ echo 'p
+00006e70: 6f73 742d 7075 6c6c 2e6e 6f68 6f6f 6b20  ost-pull.nohook 
+00006e80: 3d20 7079 7468 6f6e 3a68 6f6f 6b74 6573  = python:hooktes
+00006e90: 7473 2e6e 6f68 6f6f 6b27 203e 3e20 2e68  ts.nohook' >> .h
+00006ea0: 672f 6867 7263 0a20 2024 2068 6720 7075  g/hgrc.  $ hg pu
+00006eb0: 6c6c 202e 2e2f 610a 2020 7075 6c6c 696e  ll ../a.  pullin
+00006ec0: 6720 6672 6f6d 202e 2e2f 610a 2020 7365  g from ../a.  se
+00006ed0: 6172 6368 696e 6720 666f 7220 6368 616e  arching for chan
+00006ee0: 6765 730a 2020 6e6f 2063 6861 6e67 6573  ges.  no changes
+00006ef0: 2066 6f75 6e64 0a20 2061 626f 7274 3a20   found.  abort: 
+00006f00: 706f 7374 2d70 756c 6c2e 6e6f 686f 6f6b  post-pull.nohook
+00006f10: 2068 6f6f 6b20 6973 2069 6e76 616c 6964   hook is invalid
+00006f20: 3a20 2268 6f6f 6b74 6573 7473 2e6e 6f68  : "hooktests.noh
+00006f30: 6f6f 6b22 2069 7320 6e6f 7420 6465 6669  ook" is not defi
+00006f40: 6e65 640a 2020 5b32 3535 5d0a 0a6d 616b  ned.  [255]..mak
+00006f50: 6520 7375 7265 202d 2d74 7261 6365 6261  e sure --traceba
+00006f60: 636b 2077 6f72 6b73 0a0a 2020 2420 6563  ck works..  $ ec
+00006f70: 686f 2027 5b68 6f6f 6b73 5d27 203e 202e  ho '[hooks]' > .
+00006f80: 6867 2f68 6772 630a 2020 2420 6563 686f  hg/hgrc.  $ echo
+00006f90: 2027 636f 6d6d 6974 2e61 626f 7274 203d   'commit.abort =
+00006fa0: 2070 7974 686f 6e3a 686f 6f6b 7465 7374   python:hooktest
+00006fb0: 732e 6162 6f72 7468 6f6f 6b27 203e 3e20  s.aborthook' >> 
+00006fc0: 2e68 672f 6867 7263 0a0a 2020 2420 6563  .hg/hgrc..  $ ec
+00006fd0: 686f 2061 6120 3e20 610a 2020 2420 6867  ho aa > a.  $ hg
+00006fe0: 202d 2d74 7261 6365 6261 636b 2063 6f6d   --traceback com
+00006ff0: 6d69 7420 2d64 2027 3020 3027 202d 6d61  mit -d '0 0' -ma
+00007000: 2032 3e26 3120 7c20 6772 6570 2027 5e54   2>&1 | grep '^T
+00007010: 7261 6365 6261 636b 270a 2020 5472 6163  raceback'.  Trac
+00007020: 6562 6163 6b20 286d 6f73 7420 7265 6365  eback (most rece
+00007030: 6e74 2063 616c 6c20 6c61 7374 293a 0a0a  nt call last):..
+00007040: 2020 2420 6364 202e 2e0a 2020 2420 6867    $ cd ...  $ hg
+00007050: 2069 6e69 7420 630a 2020 2420 6364 2063   init c.  $ cd c
+00007060: 0a0a 2020 2420 6361 7420 3e20 686f 6f6b  ..  $ cat > hook
+00007070: 6578 742e 7079 203c 3c45 4f46 0a20 203e  ext.py <<EOF.  >
+00007080: 2064 6566 2061 7574 6f68 6f6f 6b28 7569   def autohook(ui
+00007090: 2c20 2a2a 6172 6773 293a 0a20 203e 2020  , **args):.  >  
+000070a0: 2020 2075 692e 7772 6974 6528 6227 4175     ui.write(b'Au
+000070b0: 746f 6d61 7469 6361 6c6c 7920 696e 7374  tomatically inst
+000070c0: 616c 6c65 6420 686f 6f6b 5c6e 2729 0a20  alled hook\n'). 
+000070d0: 203e 200a 2020 3e20 6465 6620 7265 706f   > .  > def repo
+000070e0: 7365 7475 7028 7569 2c20 7265 706f 293a  setup(ui, repo):
+000070f0: 0a20 203e 2020 2020 2072 6570 6f2e 7569  .  >     repo.ui
+00007100: 2e73 6574 636f 6e66 6967 2862 2268 6f6f  .setconfig(b"hoo
+00007110: 6b73 222c 2062 2263 6f6d 6d69 742e 6175  ks", b"commit.au
+00007120: 746f 222c 2061 7574 6f68 6f6f 6b29 0a20  to", autohook). 
+00007130: 203e 2045 4f46 0a20 2024 2065 6368 6f20   > EOF.  $ echo 
+00007140: 275b 6578 7465 6e73 696f 6e73 5d27 203e  '[extensions]' >
+00007150: 3e20 2e68 672f 6867 7263 0a20 2024 2065  > .hg/hgrc.  $ e
+00007160: 6368 6f20 2768 6f6f 6b65 7874 203d 2068  cho 'hookext = h
+00007170: 6f6f 6b65 7874 2e70 7927 203e 3e20 2e68  ookext.py' >> .h
+00007180: 672f 6867 7263 0a0a 2020 2420 746f 7563  g/hgrc..  $ touc
+00007190: 6820 666f 6f0a 2020 2420 6867 2061 6464  h foo.  $ hg add
+000071a0: 2066 6f6f 0a20 2024 2068 6720 6369 202d   foo.  $ hg ci -
+000071b0: 6420 2730 2030 2720 2d6d 2027 6164 6420  d '0 0' -m 'add 
+000071c0: 666f 6f27 0a20 2041 7574 6f6d 6174 6963  foo'.  Automatic
+000071d0: 616c 6c79 2069 6e73 7461 6c6c 6564 2068  ally installed h
+000071e0: 6f6f 6b0a 2020 2420 6563 686f 203e 3e20  ook.  $ echo >> 
+000071f0: 666f 6f0a 2020 2420 6867 2063 6920 2d2d  foo.  $ hg ci --
+00007200: 6465 6275 6720 2d64 2027 3020 3027 202d  debug -d '0 0' -
+00007210: 6d20 2763 6861 6e67 6520 666f 6f27 0a20  m 'change foo'. 
+00007220: 2063 6f6d 6d69 7474 696e 6720 6669 6c65   committing file
+00007230: 733a 0a20 2066 6f6f 0a20 2063 6f6d 6d69  s:.  foo.  commi
+00007240: 7474 696e 6720 6d61 6e69 6665 7374 0a20  tting manifest. 
+00007250: 2063 6f6d 6d69 7474 696e 6720 6368 616e   committing chan
+00007260: 6765 6c6f 670a 2020 7570 6461 7469 6e67  gelog.  updating
+00007270: 2074 6865 2062 7261 6e63 6820 6361 6368   the branch cach
+00007280: 650a 2020 636f 6d6d 6974 7465 6420 6368  e.  committed ch
+00007290: 616e 6765 7365 7420 313a 3532 3939 3830  angeset 1:529980
+000072a0: 3139 6636 3235 3261 3262 3839 3334 3532  19f6252a2b893452
+000072b0: 3736 3566 6362 3061 3437 3335 3161 3537  765fcb0a47351a57
+000072c0: 3038 0a20 2063 616c 6c69 6e67 2068 6f6f  08.  calling hoo
+000072d0: 6b20 636f 6d6d 6974 2e61 7574 6f3a 2068  k commit.auto: h
+000072e0: 6765 7874 5f68 6f6f 6b65 7874 2e61 7574  gext_hookext.aut
+000072f0: 6f68 6f6f 6b0a 2020 4175 746f 6d61 7469  ohook.  Automati
+00007300: 6361 6c6c 7920 696e 7374 616c 6c65 6420  cally installed 
+00007310: 686f 6f6b 0a0a 2020 2420 6867 2073 686f  hook..  $ hg sho
+00007320: 7763 6f6e 6669 6720 686f 6f6b 730a 2020  wconfig hooks.  
+00007330: 686f 6f6b 732e 636f 6d6d 6974 2e61 7574  hooks.commit.aut
+00007340: 6f3d 3c66 756e 6374 696f 6e20 6175 746f  o=<function auto
+00007350: 686f 6f6b 2061 7420 2a3e 2028 676c 6f62  hook at *> (glob
+00007360: 290a 0a74 6573 7420 7079 7468 6f6e 2068  )..test python h
+00007370: 6f6f 6b20 636f 6e66 6967 7572 6564 2077  ook configured w
+00007380: 6974 6820 7079 7468 6f6e 3a5b 6669 6c65  ith python:[file
+00007390: 5d3a 5b68 6f6f 6b5d 2073 796e 7461 780a  ]:[hook] syntax.
+000073a0: 0a20 2024 2063 6420 2e2e 0a20 2024 206d  .  $ cd ...  $ m
+000073b0: 6b64 6972 2064 0a20 2024 2063 6420 640a  kdir d.  $ cd d.
+000073c0: 2020 2420 6867 2069 6e69 7420 7265 706f    $ hg init repo
+000073d0: 0a20 2024 206d 6b64 6972 2068 6f6f 6b73  .  $ mkdir hooks
+000073e0: 0a0a 2020 2420 6364 2068 6f6f 6b73 0a20  ..  $ cd hooks. 
+000073f0: 2024 2063 6174 203e 2074 6573 7468 6f6f   $ cat > testhoo
+00007400: 6b73 2e70 7920 3c3c 454f 460a 2020 3e20  ks.py <<EOF.  > 
+00007410: 6465 6620 7465 7374 686f 6f6b 2875 692c  def testhook(ui,
+00007420: 202a 2a61 7267 7329 3a0a 2020 3e20 2020   **args):.  >   
+00007430: 2020 7569 2e77 7269 7465 2862 2768 6f6f    ui.write(b'hoo
+00007440: 6b20 776f 726b 735c 6e27 290a 2020 3e20  k works\n').  > 
+00007450: 454f 460a 2020 2420 6563 686f 2027 5b68  EOF.  $ echo '[h
+00007460: 6f6f 6b73 5d27 203e 202e 2e2f 7265 706f  ooks]' > ../repo
+00007470: 2f2e 6867 2f68 6772 630a 2020 2420 6563  /.hg/hgrc.  $ ec
+00007480: 686f 2022 7072 652d 636f 6d6d 6974 2e74  ho "pre-commit.t
+00007490: 6573 7420 3d20 7079 7468 6f6e 3a60 7077  est = python:`pw
+000074a0: 6460 2f74 6573 7468 6f6f 6b73 2e70 793a  d`/testhooks.py:
+000074b0: 7465 7374 686f 6f6b 2220 3e3e 202e 2e2f  testhook" >> ../
+000074c0: 7265 706f 2f2e 6867 2f68 6772 630a 0a20  repo/.hg/hgrc.. 
+000074d0: 2024 2063 6420 2e2e 2f72 6570 6f0a 2020   $ cd ../repo.  
+000074e0: 2420 6867 2063 6f6d 6d69 7420 2d64 2027  $ hg commit -d '
+000074f0: 3020 3027 0a20 2068 6f6f 6b20 776f 726b  0 0'.  hook work
+00007500: 730a 2020 6e6f 7468 696e 6720 6368 616e  s.  nothing chan
+00007510: 6765 640a 2020 5b31 5d0a 0a20 2024 2065  ged.  [1]..  $ e
+00007520: 6368 6f20 275b 686f 6f6b 735d 2720 3e20  cho '[hooks]' > 
+00007530: 2e68 672f 6867 7263 0a20 2024 2065 6368  .hg/hgrc.  $ ech
+00007540: 6f20 2275 7064 6174 652e 6e65 203d 2070  o "update.ne = p
+00007550: 7974 686f 6e3a 6070 7764 602f 6e6f 6e65  ython:`pwd`/none
+00007560: 7869 7374 656e 742e 7079 3a74 6573 7468  xistent.py:testh
+00007570: 6f6f 6b22 203e 3e20 2e68 672f 6867 7263  ook" >> .hg/hgrc
+00007580: 0a20 2024 2065 6368 6f20 2270 7265 2d69  .  $ echo "pre-i
+00007590: 6465 6e74 6966 792e 6e70 6d64 203d 2070  dentify.npmd = p
+000075a0: 7974 686f 6e3a 6070 7764 602f 3a6e 6f5f  ython:`pwd`/:no_
+000075b0: 7079 7468 6f6e 5f6d 6f64 756c 655f 6469  python_module_di
+000075c0: 7222 203e 3e20 2e68 672f 6867 7263 0a0a  r" >> .hg/hgrc..
+000075d0: 2020 2420 6867 2075 7020 6e75 6c6c 0a20    $ hg up null. 
+000075e0: 206c 6f61 6469 6e67 2075 7064 6174 652e   loading update.
+000075f0: 6e65 2068 6f6f 6b20 6661 696c 6564 3a0a  ne hook failed:.
+00007600: 2020 6162 6f72 743a 2024 454e 4f45 4e54    abort: $ENOENT
+00007610: 243a 2027 2454 4553 5454 4d50 2f64 2f72  $: '$TESTTMP/d/r
+00007620: 6570 6f2f 6e6f 6e65 7869 7374 656e 742e  epo/nonexistent.
+00007630: 7079 270a 2020 5b32 3535 5d0a 0a20 2024  py'.  [255]..  $
+00007640: 2068 6720 6964 0a20 206c 6f61 6469 6e67   hg id.  loading
+00007650: 2070 7265 2d69 6465 6e74 6966 792e 6e70   pre-identify.np
+00007660: 6d64 2068 6f6f 6b20 6661 696c 6564 3a0a  md hook failed:.
+00007670: 2020 6162 6f72 743a 204e 6f20 6d6f 6475    abort: No modu
+00007680: 6c65 206e 616d 6564 2027 7265 706f 270a  le named 'repo'.
+00007690: 2020 5b32 3535 5d0a 0a20 2024 2063 6420    [255]..  $ cd 
+000076a0: 2e2e 2f2e 2e2f 620a 0a6d 616b 6520 7375  ../../b..make su
+000076b0: 7265 202d 2d74 7261 6365 6261 636b 2077  re --traceback w
+000076c0: 6f72 6b73 206f 6e20 686f 6f6b 2069 6d70  orks on hook imp
+000076d0: 6f72 7420 6661 696c 7572 650a 0a20 2024  ort failure..  $
+000076e0: 2063 6174 203e 2069 6d70 6f72 7466 6169   cat > importfai
+000076f0: 6c2e 7079 203c 3c45 4f46 0a20 203e 2069  l.py <<EOF.  > i
+00007700: 6d70 6f72 7420 736f 6d65 626f 6775 736d  mport somebogusm
+00007710: 6f64 756c 650a 2020 3e20 2320 6465 7265  odule.  > # dere
+00007720: 6665 7265 6e63 6520 736f 6d65 7468 696e  ference somethin
+00007730: 6720 696e 2074 6865 206d 6f64 756c 6520  g in the module 
+00007740: 746f 2066 6f72 6365 2064 656d 616e 6469  to force demandi
+00007750: 6d70 6f72 7420 746f 206c 6f61 6420 6974  mport to load it
+00007760: 0a20 203e 2073 6f6d 6562 6f67 7573 6d6f  .  > somebogusmo
+00007770: 6475 6c65 2e77 6861 7465 7665 720a 2020  dule.whatever.  
+00007780: 3e20 454f 460a 0a20 2024 2065 6368 6f20  > EOF..  $ echo 
+00007790: 275b 686f 6f6b 735d 2720 3e20 2e68 672f  '[hooks]' > .hg/
+000077a0: 6867 7263 0a20 2024 2065 6368 6f20 2770  hgrc.  $ echo 'p
+000077b0: 7265 636f 6d6d 6974 2e69 6d70 6f72 7466  recommit.importf
+000077c0: 6169 6c20 3d20 7079 7468 6f6e 3a69 6d70  ail = python:imp
+000077d0: 6f72 7466 6169 6c2e 7768 6174 6576 6572  ortfail.whatever
+000077e0: 2720 3e3e 202e 6867 2f68 6772 630a 0a20  ' >> .hg/hgrc.. 
+000077f0: 2024 2065 6368 6f20 6120 3e3e 2061 0a20   $ echo a >> a. 
+00007800: 2024 2068 6720 2d2d 7472 6163 6562 6163   $ hg --tracebac
+00007810: 6b20 636f 6d6d 6974 202d 6d61 2032 3e26  k commit -ma 2>&
+00007820: 3120 7c20 6567 7265 7020 275e 6578 6365  1 | egrep '^exce
+00007830: 7074 696f 6e7c 496d 706f 7274 4572 726f  ption|ImportErro
+00007840: 727c 4d6f 6475 6c65 4e6f 7446 6f75 6e64  r|ModuleNotFound
+00007850: 4572 726f 727c 5472 6163 6562 6163 6b7c  Error|Traceback|
+00007860: 486f 6f6b 4c6f 6164 4572 726f 727c 6162  HookLoadError|ab
+00007870: 6f72 7427 0a20 2065 7863 6570 7469 6f6e  ort'.  exception
+00007880: 2066 726f 6d20 6669 7273 7420 6661 696c   from first fail
+00007890: 6564 2069 6d70 6f72 7420 6174 7465 6d70  ed import attemp
+000078a0: 743a 0a20 2054 7261 6365 6261 636b 2028  t:.  Traceback (
+000078b0: 6d6f 7374 2072 6563 656e 7420 6361 6c6c  most recent call
+000078c0: 206c 6173 7429 3a0a 2020 4d6f 6475 6c65   last):.  Module
+000078d0: 4e6f 7446 6f75 6e64 4572 726f 723a 204e  NotFoundError: N
+000078e0: 6f20 6d6f 6475 6c65 206e 616d 6564 2027  o module named '
+000078f0: 736f 6d65 626f 6775 736d 6f64 756c 6527  somebogusmodule'
 00007900: 0a20 2065 7863 6570 7469 6f6e 2066 726f  .  exception fro
-00007910: 6d20 6669 7273 7420 6661 696c 6564 2069  m first failed i
-00007920: 6d70 6f72 7420 6174 7465 6d70 743a 0a20  mport attempt:. 
-00007930: 2054 7261 6365 6261 636b 2028 6d6f 7374   Traceback (most
-00007940: 2072 6563 656e 7420 6361 6c6c 206c 6173   recent call las
-00007950: 7429 3a0a 2020 496d 706f 7274 4572 726f  t):.  ImportErro
-00007960: 723a 204e 6f20 6d6f 6475 6c65 206e 616d  r: No module nam
-00007970: 6564 2027 736f 6d65 626f 6775 736d 6f64  ed 'somebogusmod
-00007980: 756c 6527 2028 6e6f 2d70 7933 3620 2129  ule' (no-py36 !)
-00007990: 0a20 204d 6f64 756c 654e 6f74 466f 756e  .  ModuleNotFoun
-000079a0: 6445 7272 6f72 3a20 4e6f 206d 6f64 756c  dError: No modul
-000079b0: 6520 6e61 6d65 6420 2773 6f6d 6562 6f67  e named 'somebog
-000079c0: 7573 6d6f 6475 6c65 2720 2870 7933 3620  usmodule' (py36 
-000079d0: 2129 0a20 2065 7863 6570 7469 6f6e 2066  !).  exception f
-000079e0: 726f 6d20 7365 636f 6e64 2066 6169 6c65  rom second faile
-000079f0: 6420 696d 706f 7274 2061 7474 656d 7074  d import attempt
-00007a00: 3a0a 2020 5472 6163 6562 6163 6b20 286d  :.  Traceback (m
-00007a10: 6f73 7420 7265 6365 6e74 2063 616c 6c20  ost recent call 
-00007a20: 6c61 7374 293a 0a20 2049 6d70 6f72 7445  last):.  ImportE
-00007a30: 7272 6f72 3a20 4e6f 206d 6f64 756c 6520  rror: No module 
-00007a40: 6e61 6d65 6420 2773 6f6d 6562 6f67 7573  named 'somebogus
-00007a50: 6d6f 6475 6c65 2720 286e 6f2d 7079 3336  module' (no-py36
-00007a60: 2021 290a 2020 4d6f 6475 6c65 4e6f 7446   !).  ModuleNotF
-00007a70: 6f75 6e64 4572 726f 723a 204e 6f20 6d6f  oundError: No mo
-00007a80: 6475 6c65 206e 616d 6564 2027 736f 6d65  dule named 'some
-00007a90: 626f 6775 736d 6f64 756c 6527 2028 7079  bogusmodule' (py
-00007aa0: 3336 2021 290a 2020 5472 6163 6562 6163  36 !).  Tracebac
-00007ab0: 6b20 286d 6f73 7420 7265 6365 6e74 2063  k (most recent c
-00007ac0: 616c 6c20 6c61 7374 293a 0a20 2049 6d70  all last):.  Imp
-00007ad0: 6f72 7445 7272 6f72 3a20 4e6f 206d 6f64  ortError: No mod
-00007ae0: 756c 6520 6e61 6d65 6420 2768 6765 7874  ule named 'hgext
-00007af0: 5f69 6d70 6f72 7466 6169 6c27 2028 6e6f  _importfail' (no
-00007b00: 2d70 7933 3620 2129 0a20 204d 6f64 756c  -py36 !).  Modul
-00007b10: 654e 6f74 466f 756e 6445 7272 6f72 3a20  eNotFoundError: 
-00007b20: 4e6f 206d 6f64 756c 6520 6e61 6d65 6420  No module named 
-00007b30: 2768 6765 7874 5f69 6d70 6f72 7466 6169  'hgext_importfai
-00007b40: 6c27 2028 7079 3336 2021 290a 2020 5472  l' (py36 !).  Tr
-00007b50: 6163 6562 6163 6b20 286d 6f73 7420 7265  aceback (most re
-00007b60: 6365 6e74 2063 616c 6c20 6c61 7374 293a  cent call last):
-00007b70: 0a20 2049 6d70 6f72 7445 7272 6f72 3a20  .  ImportError: 
-00007b80: 4e6f 206d 6f64 756c 6520 6e61 6d65 6420  No module named 
-00007b90: 2773 6f6d 6562 6f67 7573 6d6f 6475 6c65  'somebogusmodule
-00007ba0: 2720 286e 6f2d 7079 3336 2021 290a 2020  ' (no-py36 !).  
-00007bb0: 4d6f 6475 6c65 4e6f 7446 6f75 6e64 4572  ModuleNotFoundEr
-00007bc0: 726f 723a 204e 6f20 6d6f 6475 6c65 206e  ror: No module n
-00007bd0: 616d 6564 2027 736f 6d65 626f 6775 736d  amed 'somebogusm
-00007be0: 6f64 756c 6527 2028 7079 3336 2021 290a  odule' (py36 !).
-00007bf0: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
-00007c00: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
-00007c10: 7374 293a 0a20 2049 6d70 6f72 7445 7272  st):.  ImportErr
-00007c20: 6f72 3a20 4e6f 206d 6f64 756c 6520 6e61  or: No module na
-00007c30: 6d65 6420 2768 6765 7874 5f69 6d70 6f72  med 'hgext_impor
-00007c40: 7466 6169 6c27 2028 6e6f 2d70 7933 3620  tfail' (no-py36 
-00007c50: 2129 0a20 204d 6f64 756c 654e 6f74 466f  !).  ModuleNotFo
-00007c60: 756e 6445 7272 6f72 3a20 4e6f 206d 6f64  undError: No mod
-00007c70: 756c 6520 6e61 6d65 6420 2768 6765 7874  ule named 'hgext
-00007c80: 5f69 6d70 6f72 7466 6169 6c27 2028 7079  _importfail' (py
-00007c90: 3336 2021 290a 2020 5472 6163 6562 6163  36 !).  Tracebac
-00007ca0: 6b20 286d 6f73 7420 7265 6365 6e74 2063  k (most recent c
-00007cb0: 616c 6c20 6c61 7374 293a 0a20 2020 2020  all last):.     
-00007cc0: 2072 6169 7365 2065 7272 6f72 2e48 6f6f   raise error.Hoo
-00007cd0: 6b4c 6f61 6445 7272 6f72 2820 2870 7933  kLoadError( (py3
-00007ce0: 3820 2129 0a20 206d 6572 6375 7269 616c  8 !).  mercurial
-00007cf0: 2e65 7272 6f72 2e48 6f6f 6b4c 6f61 6445  .error.HookLoadE
-00007d00: 7272 6f72 3a20 7072 6563 6f6d 6d69 742e  rror: precommit.
-00007d10: 696d 706f 7274 6661 696c 2068 6f6f 6b20  importfail hook 
-00007d20: 6973 2069 6e76 616c 6964 3a20 696d 706f  is invalid: impo
-00007d30: 7274 206f 6620 2269 6d70 6f72 7466 6169  rt of "importfai
-00007d40: 6c22 2066 6169 6c65 640a 2020 6162 6f72  l" failed.  abor
-00007d50: 743a 2070 7265 636f 6d6d 6974 2e69 6d70  t: precommit.imp
-00007d60: 6f72 7466 6169 6c20 686f 6f6b 2069 7320  ortfail hook is 
-00007d70: 696e 7661 6c69 643a 2069 6d70 6f72 7420  invalid: import 
-00007d80: 6f66 2022 696d 706f 7274 6661 696c 2220  of "importfail" 
-00007d90: 6661 696c 6564 0a0a 4973 7375 6531 3832  failed..Issue182
-00007da0: 373a 2048 6f6f 6b73 2055 7064 6174 6520  7: Hooks Update 
-00007db0: 2620 436f 6d6d 6974 206e 6f74 2063 6f6d  & Commit not com
-00007dc0: 706c 6574 656c 7920 706f 7374 206f 7065  pletely post ope
-00007dd0: 7261 7469 6f6e 0a0a 636f 6d6d 6974 2061  ration..commit a
-00007de0: 6e64 2075 7064 6174 6520 686f 6f6b 7320  nd update hooks 
-00007df0: 7368 6f75 6c64 2072 756e 2061 6674 6572  should run after
-00007e00: 2063 6f6d 6d61 6e64 2063 6f6d 706c 6574   command complet
-00007e10: 696f 6e2e 2020 5468 6520 6c61 7267 6566  ion.  The largef
-00007e20: 696c 6573 0a75 7365 2064 656d 6f6e 7374  iles.use demonst
-00007e30: 7261 7465 7320 6120 7265 6375 7273 6976  rates a recursiv
-00007e40: 6520 776c 6f63 6b2c 2073 686f 7769 6e67  e wlock, showing
-00007e50: 2074 6865 2068 6f6f 6b20 646f 6573 6e27   the hook doesn'
-00007e60: 7420 7275 6e20 756e 7469 6c20 7468 650a  t run until the.
-00007e70: 6669 6e61 6c20 7265 6c65 6173 6520 2861  final release (a
-00007e80: 6e64 2064 6972 7374 6174 6520 666c 7573  nd dirstate flus
-00007e90: 6829 2e0a 0a20 2024 2065 6368 6f20 275b  h)...  $ echo '[
-00007ea0: 686f 6f6b 735d 2720 3e20 2e68 672f 6867  hooks]' > .hg/hg
-00007eb0: 7263 0a20 2024 2065 6368 6f20 2763 6f6d  rc.  $ echo 'com
-00007ec0: 6d69 7420 3d20 6867 2069 6427 203e 3e20  mit = hg id' >> 
-00007ed0: 2e68 672f 6867 7263 0a20 2024 2065 6368  .hg/hgrc.  $ ech
-00007ee0: 6f20 2775 7064 6174 6520 3d20 6867 2069  o 'update = hg i
-00007ef0: 6427 203e 3e20 2e68 672f 6867 7263 0a20  d' >> .hg/hgrc. 
-00007f00: 2024 2065 6368 6f20 6262 203e 2061 0a20   $ echo bb > a. 
-00007f10: 2024 2068 6720 6369 202d 6d61 0a20 2032   $ hg ci -ma.  2
-00007f20: 3233 6561 6665 3237 3530 6320 7469 700a  23eafe2750c tip.
-00007f30: 2020 2420 6867 2075 7020 3020 2d2d 636f    $ hg up 0 --co
-00007f40: 6e66 6967 2065 7874 656e 7369 6f6e 732e  nfig extensions.
-00007f50: 6c61 7267 6566 696c 6573 3d0a 2020 5468  largefiles=.  Th
-00007f60: 6520 6673 6d6f 6e69 746f 7220 6578 7465  e fsmonitor exte
-00007f70: 6e73 696f 6e20 6973 2069 6e63 6f6d 7061  nsion is incompa
-00007f80: 7469 626c 6520 7769 7468 2074 6865 206c  tible with the l
-00007f90: 6172 6765 6669 6c65 7320 6578 7465 6e73  argefiles extens
-00007fa0: 696f 6e20 616e 6420 6861 7320 6265 656e  ion and has been
-00007fb0: 2064 6973 6162 6c65 642e 2028 6673 6d6f   disabled. (fsmo
-00007fc0: 6e69 746f 7220 2129 0a20 2063 6239 6139  nitor !).  cb9a9
-00007fd0: 6633 3134 6238 620a 2020 3120 6669 6c65  f314b8b.  1 file
-00007fe0: 7320 7570 6461 7465 642c 2030 2066 696c  s updated, 0 fil
-00007ff0: 6573 206d 6572 6765 642c 2030 2066 696c  es merged, 0 fil
-00008000: 6573 2072 656d 6f76 6564 2c20 3020 6669  es removed, 0 fi
-00008010: 6c65 7320 756e 7265 736f 6c76 6564 0a0a  les unresolved..
-00008020: 6d61 6b65 2073 7572 6520 2d2d 7665 7262  make sure --verb
-00008030: 6f73 6520 2861 6e64 202d 2d71 7569 6574  ose (and --quiet
-00008040: 2f2d 2d64 6562 7567 2065 7463 2e29 2061  /--debug etc.) a
-00008050: 7265 2070 726f 7061 6761 7465 6420 746f  re propagated to
-00008060: 2074 6865 206c 6f63 616c 2075 690a 7468   the local ui.th
-00008070: 6174 2069 7320 7061 7373 6564 2074 6f20  at is passed to 
-00008080: 7072 652f 706f 7374 2068 6f6f 6b73 0a0a  pre/post hooks..
-00008090: 2020 2420 6563 686f 2027 5b68 6f6f 6b73    $ echo '[hooks
-000080a0: 5d27 203e 202e 6867 2f68 6772 630a 2020  ]' > .hg/hgrc.  
-000080b0: 2420 6563 686f 2027 7072 652d 6964 656e  $ echo 'pre-iden
-000080c0: 7469 6679 203d 2070 7974 686f 6e3a 686f  tify = python:ho
-000080d0: 6f6b 7465 7374 732e 7665 7262 6f73 6568  oktests.verboseh
-000080e0: 6f6f 6b27 203e 3e20 2e68 672f 6867 7263  ook' >> .hg/hgrc
-000080f0: 0a20 2024 2068 6720 6964 0a20 2063 6239  .  $ hg id.  cb9
-00008100: 6139 6633 3134 6238 620a 2020 2420 6867  a9f314b8b.  $ hg
-00008110: 2069 6420 2d2d 7665 7262 6f73 650a 2020   id --verbose.  
-00008120: 6361 6c6c 696e 6720 686f 6f6b 2070 7265  calling hook pre
-00008130: 2d69 6465 6e74 6966 793a 2068 6f6f 6b74  -identify: hookt
-00008140: 6573 7473 2e76 6572 626f 7365 686f 6f6b  ests.verbosehook
-00008150: 0a20 2076 6572 626f 7365 206f 7574 7075  .  verbose outpu
-00008160: 7420 6672 6f6d 2068 6f6f 6b0a 2020 6362  t from hook.  cb
-00008170: 3961 3966 3331 3462 3862 0a0a 456e 7375  9a9f314b8b..Ensu
-00008180: 7265 2068 6f6f 6b73 2063 616e 2062 6520  re hooks can be 
-00008190: 7072 696f 7269 7469 7a65 640a 0a20 2024  prioritized..  $
-000081a0: 2065 6368 6f20 275b 686f 6f6b 735d 2720   echo '[hooks]' 
-000081b0: 3e20 2e68 672f 6867 7263 0a20 2024 2065  > .hg/hgrc.  $ e
-000081c0: 6368 6f20 2770 7265 2d69 6465 6e74 6966  cho 'pre-identif
-000081d0: 792e 6120 3d20 7079 7468 6f6e 3a68 6f6f  y.a = python:hoo
-000081e0: 6b74 6573 7473 2e76 6572 626f 7365 686f  ktests.verboseho
-000081f0: 6f6b 2720 3e3e 202e 6867 2f68 6772 630a  ok' >> .hg/hgrc.
-00008200: 2020 2420 6563 686f 2027 7072 652d 6964    $ echo 'pre-id
-00008210: 656e 7469 6679 2e62 203d 2070 7974 686f  entify.b = pytho
-00008220: 6e3a 686f 6f6b 7465 7374 732e 7665 7262  n:hooktests.verb
-00008230: 6f73 6568 6f6f 6b27 203e 3e20 2e68 672f  osehook' >> .hg/
-00008240: 6867 7263 0a20 2024 2065 6368 6f20 2770  hgrc.  $ echo 'p
-00008250: 7269 6f72 6974 792e 7072 652d 6964 656e  riority.pre-iden
-00008260: 7469 6679 2e62 203d 2031 2720 3e3e 202e  tify.b = 1' >> .
-00008270: 6867 2f68 6772 630a 2020 2420 6563 686f  hg/hgrc.  $ echo
-00008280: 2027 7072 652d 6964 656e 7469 6679 2e63   'pre-identify.c
-00008290: 203d 2070 7974 686f 6e3a 686f 6f6b 7465   = python:hookte
-000082a0: 7374 732e 7665 7262 6f73 6568 6f6f 6b27  sts.verbosehook'
-000082b0: 203e 3e20 2e68 672f 6867 7263 0a20 2024   >> .hg/hgrc.  $
-000082c0: 2068 6720 6964 202d 2d76 6572 626f 7365   hg id --verbose
-000082d0: 0a20 2063 616c 6c69 6e67 2068 6f6f 6b20  .  calling hook 
-000082e0: 7072 652d 6964 656e 7469 6679 2e62 3a20  pre-identify.b: 
-000082f0: 686f 6f6b 7465 7374 732e 7665 7262 6f73  hooktests.verbos
-00008300: 6568 6f6f 6b0a 2020 7665 7262 6f73 6520  ehook.  verbose 
-00008310: 6f75 7470 7574 2066 726f 6d20 686f 6f6b  output from hook
-00008320: 0a20 2063 616c 6c69 6e67 2068 6f6f 6b20  .  calling hook 
-00008330: 7072 652d 6964 656e 7469 6679 2e61 3a20  pre-identify.a: 
-00008340: 686f 6f6b 7465 7374 732e 7665 7262 6f73  hooktests.verbos
-00008350: 6568 6f6f 6b0a 2020 7665 7262 6f73 6520  ehook.  verbose 
-00008360: 6f75 7470 7574 2066 726f 6d20 686f 6f6b  output from hook
-00008370: 0a20 2063 616c 6c69 6e67 2068 6f6f 6b20  .  calling hook 
-00008380: 7072 652d 6964 656e 7469 6679 2e63 3a20  pre-identify.c: 
-00008390: 686f 6f6b 7465 7374 732e 7665 7262 6f73  hooktests.verbos
-000083a0: 6568 6f6f 6b0a 2020 7665 7262 6f73 6520  ehook.  verbose 
-000083b0: 6f75 7470 7574 2066 726f 6d20 686f 6f6b  output from hook
-000083c0: 0a20 2063 6239 6139 6633 3134 6238 620a  .  cb9a9f314b8b.
-000083d0: 0a6e 6577 2074 6167 7320 6d75 7374 2062  .new tags must b
-000083e0: 6520 7669 7369 626c 6520 696e 2070 7265  e visible in pre
-000083f0: 7478 6e63 6f6d 6d69 7420 2869 7373 7565  txncommit (issue
-00008400: 3332 3130 290a 0a20 2024 2065 6368 6f20  3210)..  $ echo 
-00008410: 2770 7265 7478 6e63 6f6d 6d69 742e 7072  'pretxncommit.pr
-00008420: 696e 7474 6167 7320 3d20 7079 7468 6f6e  inttags = python
-00008430: 3a68 6f6f 6b74 6573 7473 2e70 7269 6e74  :hooktests.print
-00008440: 7461 6773 2720 3e3e 202e 6867 2f68 6772  tags' >> .hg/hgr
-00008450: 630a 2020 2420 6867 2074 6167 202d 6620  c.  $ hg tag -f 
-00008460: 666f 6f0a 2020 5b61 2c20 666f 6f2c 2074  foo.  [a, foo, t
-00008470: 6970 5d0a 0a70 6f73 742d 696e 6974 2068  ip]..post-init h
-00008480: 6f6f 6b73 206d 7573 7420 6e6f 7420 6372  ooks must not cr
-00008490: 6173 6820 2869 7373 7565 3439 3833 290a  ash (issue4983).
-000084a0: 5468 6973 2061 6c73 6f20 6372 6561 7465  This also create
-000084b0: 7320 7468 6520 6074 6f60 2072 6570 6f20  s the `to` repo 
-000084c0: 666f 7220 7468 6520 6e65 7874 2074 6573  for the next tes
-000084d0: 7420 626c 6f63 6b2e 0a0a 2020 2420 6364  t block...  $ cd
-000084e0: 202e 2e0a 2020 2420 6361 7420 3c3c 2045   ...  $ cat << E
-000084f0: 4f46 203e 3e20 6867 7263 2d77 6974 682d  OF >> hgrc-with-
-00008500: 706f 7374 2d69 6e69 742d 686f 6f6b 0a20  post-init-hook. 
-00008510: 203e 205b 686f 6f6b 735d 0a20 203e 2070   > [hooks].  > p
-00008520: 6f73 742d 696e 6974 203d 2073 6820 2d63  ost-init = sh -c
-00008530: 2022 7072 696e 7465 6e76 2e70 7920 2d2d   "printenv.py --
-00008540: 6c69 6e65 2070 6f73 742d 696e 6974 220a  line post-init".
-00008550: 2020 3e20 454f 460a 2020 2420 4847 5243    > EOF.  $ HGRC
-00008560: 5041 5448 3d68 6772 632d 7769 7468 2d70  PATH=hgrc-with-p
-00008570: 6f73 742d 696e 6974 2d68 6f6f 6b20 6867  ost-init-hook hg
-00008580: 2069 6e69 7420 746f 0a20 2070 6f73 742d   init to.  post-
-00008590: 696e 6974 2068 6f6f 6b3a 2048 475f 4152  init hook: HG_AR
-000085a0: 4753 3d69 6e69 7420 746f 0a20 2048 475f  GS=init to.  HG_
-000085b0: 484f 4f4b 4e41 4d45 3d70 6f73 742d 696e  HOOKNAME=post-in
-000085c0: 6974 0a20 2048 475f 484f 4f4b 5459 5045  it.  HG_HOOKTYPE
-000085d0: 3d70 6f73 742d 696e 6974 0a20 2048 475f  =post-init.  HG_
-000085e0: 4f50 5453 3d7b 2769 6e73 6563 7572 6527  OPTS={'insecure'
-000085f0: 3a20 4e6f 6e65 2c20 2772 656d 6f74 6563  : None, 'remotec
-00008600: 6d64 273a 2027 272c 2027 7373 6827 3a20  md': '', 'ssh': 
-00008610: 2727 7d0a 2020 4847 5f50 4154 533d 5b27  ''}.  HG_PATS=['
-00008620: 746f 275d 0a20 2048 475f 5245 5355 4c54  to'].  HG_RESULT
-00008630: 3d30 0a20 200a 0a6e 6577 2063 6f6d 6d69  =0.  ..new commi
-00008640: 7473 206d 7573 7420 6265 2076 6973 6962  ts must be visib
-00008650: 6c65 2069 6e20 7072 6574 786e 6368 616e  le in pretxnchan
-00008660: 6765 6772 6f75 7020 2869 7373 7565 3334  gegroup (issue34
-00008670: 3238 290a 0a20 2024 2065 6368 6f20 275b  28)..  $ echo '[
-00008680: 686f 6f6b 735d 2720 3e3e 2074 6f2f 2e68  hooks]' >> to/.h
-00008690: 672f 6867 7263 0a20 2024 2065 6368 6f20  g/hgrc.  $ echo 
-000086a0: 2770 7265 6368 616e 6765 6772 6f75 7020  'prechangegroup 
-000086b0: 3d20 6867 202d 2d74 7261 6365 6261 636b  = hg --traceback
-000086c0: 2074 6970 2720 3e3e 2074 6f2f 2e68 672f   tip' >> to/.hg/
-000086d0: 6867 7263 0a20 2024 2065 6368 6f20 2770  hgrc.  $ echo 'p
-000086e0: 7265 7478 6e63 6861 6e67 6567 726f 7570  retxnchangegroup
-000086f0: 203d 2068 6720 2d2d 7472 6163 6562 6163   = hg --tracebac
-00008700: 6b20 7469 7027 203e 3e20 746f 2f2e 6867  k tip' >> to/.hg
-00008710: 2f68 6772 630a 2020 2420 6563 686f 2061  /hgrc.  $ echo a
-00008720: 203e 3e20 746f 2f61 0a20 2024 2068 6720   >> to/a.  $ hg 
-00008730: 2d2d 6377 6420 746f 2063 6920 2d41 6d61  --cwd to ci -Ama
-00008740: 0a20 2061 6464 696e 6720 610a 2020 2420  .  adding a.  $ 
-00008750: 6867 2063 6c6f 6e65 2074 6f20 6672 6f6d  hg clone to from
-00008760: 0a20 2075 7064 6174 696e 6720 746f 2062  .  updating to b
-00008770: 7261 6e63 6820 6465 6661 756c 740a 2020  ranch default.  
-00008780: 3120 6669 6c65 7320 7570 6461 7465 642c  1 files updated,
-00008790: 2030 2066 696c 6573 206d 6572 6765 642c   0 files merged,
-000087a0: 2030 2066 696c 6573 2072 656d 6f76 6564   0 files removed
-000087b0: 2c20 3020 6669 6c65 7320 756e 7265 736f  , 0 files unreso
-000087c0: 6c76 6564 0a20 2024 2065 6368 6f20 6161  lved.  $ echo aa
-000087d0: 203e 3e20 6672 6f6d 2f61 0a20 2024 2068   >> from/a.  $ h
-000087e0: 6720 2d2d 6377 6420 6672 6f6d 2063 6920  g --cwd from ci 
-000087f0: 2d6d 620a 2020 2420 6867 202d 2d63 7764  -mb.  $ hg --cwd
-00008800: 2066 726f 6d20 7075 7368 0a20 2070 7573   from push.  pus
-00008810: 6869 6e67 2074 6f20 2454 4553 5454 4d50  hing to $TESTTMP
-00008820: 2f74 6f0a 2020 7365 6172 6368 696e 6720  /to.  searching 
-00008830: 666f 7220 6368 616e 6765 730a 2020 6368  for changes.  ch
-00008840: 616e 6765 7365 743a 2020 2030 3a63 6239  angeset:   0:cb9
-00008850: 6139 6633 3134 6238 620a 2020 7461 673a  a9f314b8b.  tag:
-00008860: 2020 2020 2020 2020 2074 6970 0a20 2075           tip.  u
-00008870: 7365 723a 2020 2020 2020 2020 7465 7374  ser:        test
-00008880: 0a20 2064 6174 653a 2020 2020 2020 2020  .  date:        
-00008890: 5468 7520 4a61 6e20 3031 2030 303a 3030  Thu Jan 01 00:00
-000088a0: 3a30 3020 3139 3730 202b 3030 3030 0a20  :00 1970 +0000. 
-000088b0: 2073 756d 6d61 7279 3a20 2020 2020 610a   summary:     a.
-000088c0: 2020 0a20 2061 6464 696e 6720 6368 616e    .  adding chan
-000088d0: 6765 7365 7473 0a20 2061 6464 696e 6720  gesets.  adding 
-000088e0: 6d61 6e69 6665 7374 730a 2020 6164 6469  manifests.  addi
-000088f0: 6e67 2066 696c 6520 6368 616e 6765 730a  ng file changes.
-00008900: 2020 6368 616e 6765 7365 743a 2020 2031    changeset:   1
-00008910: 3a39 3833 3661 3037 6239 6239 640a 2020  :9836a07b9b9d.  
-00008920: 7461 673a 2020 2020 2020 2020 2074 6970  tag:         tip
-00008930: 0a20 2075 7365 723a 2020 2020 2020 2020  .  user:        
-00008940: 7465 7374 0a20 2064 6174 653a 2020 2020  test.  date:    
-00008950: 2020 2020 5468 7520 4a61 6e20 3031 2030      Thu Jan 01 0
-00008960: 303a 3030 3a30 3020 3139 3730 202b 3030  0:00:00 1970 +00
-00008970: 3030 0a20 2073 756d 6d61 7279 3a20 2020  00.  summary:   
-00008980: 2020 620a 2020 0a20 2061 6464 6564 2031    b.  .  added 1
-00008990: 2063 6861 6e67 6573 6574 7320 7769 7468   changesets with
-000089a0: 2031 2063 6861 6e67 6573 2074 6f20 3120   1 changes to 1 
-000089b0: 6669 6c65 730a 0a70 7265 7478 6e63 6c6f  files..pretxnclo
-000089c0: 7365 2068 6f6f 6b20 6661 696c 7572 6520  se hook failure 
-000089d0: 7368 6f75 6c64 2061 626f 7274 2074 6865  should abort the
-000089e0: 2074 7261 6e73 6163 7469 6f6e 0a0a 2020   transaction..  
-000089f0: 2420 6867 2069 6e69 7420 7478 6e66 6169  $ hg init txnfai
-00008a00: 6c75 7265 0a20 2024 2063 6420 7478 6e66  lure.  $ cd txnf
-00008a10: 6169 6c75 7265 0a20 2024 2074 6f75 6368  ailure.  $ touch
-00008a20: 2061 2026 2620 6867 2063 6f6d 6d69 7420   a && hg commit 
-00008a30: 2d41 716d 2061 0a20 2024 2063 6174 203e  -Aqm a.  $ cat >
-00008a40: 3e20 2e68 672f 6867 7263 203c 3c45 4f46  > .hg/hgrc <<EOF
-00008a50: 0a20 203e 205b 686f 6f6b 735d 0a20 203e  .  > [hooks].  >
-00008a60: 2070 7265 7478 6e63 6c6f 7365 2e65 7272   pretxnclose.err
-00008a70: 6f72 203d 2065 7869 7420 310a 2020 3e20  or = exit 1.  > 
-00008a80: 454f 460a 2020 2420 6867 2073 7472 6970  EOF.  $ hg strip
-00008a90: 202d 7220 3020 2d2d 636f 6e66 6967 2065   -r 0 --config e
-00008aa0: 7874 656e 7369 6f6e 732e 7374 7269 703d  xtensions.strip=
-00008ab0: 0a20 2030 2066 696c 6573 2075 7064 6174  .  0 files updat
-00008ac0: 6564 2c20 3020 6669 6c65 7320 6d65 7267  ed, 0 files merg
-00008ad0: 6564 2c20 3120 6669 6c65 7320 7265 6d6f  ed, 1 files remo
-00008ae0: 7665 642c 2030 2066 696c 6573 2075 6e72  ved, 0 files unr
-00008af0: 6573 6f6c 7665 640a 2020 7361 7665 6420  esolved.  saved 
-00008b00: 6261 636b 7570 2062 756e 646c 6520 746f  backup bundle to
-00008b10: 202a 2028 676c 6f62 290a 2020 7472 616e   * (glob).  tran
-00008b20: 7361 6374 696f 6e20 6162 6f72 7421 0a20  saction abort!. 
-00008b30: 2072 6f6c 6c62 6163 6b20 636f 6d70 6c65   rollback comple
-00008b40: 7465 640a 2020 7374 7269 7020 6661 696c  ted.  strip fail
-00008b50: 6564 2c20 6261 636b 7570 2062 756e 646c  ed, backup bundl
-00008b60: 6520 7374 6f72 6564 2069 6e20 2a20 2867  e stored in * (g
-00008b70: 6c6f 6229 0a20 2061 626f 7274 3a20 7072  lob).  abort: pr
-00008b80: 6574 786e 636c 6f73 652e 6572 726f 7220  etxnclose.error 
-00008b90: 686f 6f6b 2065 7869 7465 6420 7769 7468  hook exited with
-00008ba0: 2073 7461 7475 7320 310a 2020 5b34 305d   status 1.  [40]
-00008bb0: 0a20 2024 2068 6720 7265 636f 7665 720a  .  $ hg recover.
-00008bc0: 2020 6e6f 2069 6e74 6572 7275 7074 6564    no interrupted
-00008bd0: 2074 7261 6e73 6163 7469 6f6e 2061 7661   transaction ava
-00008be0: 696c 6162 6c65 0a20 205b 315d 0a20 2024  ilable.  [1].  $
-00008bf0: 2063 6420 2e2e 0a0a 6368 6563 6b20 7768   cd ....check wh
-00008c00: 6574 6865 7220 4847 5f50 454e 4449 4e47  ether HG_PENDING
-00008c10: 206d 616b 6573 2070 656e 6469 6e67 2063   makes pending c
-00008c20: 6861 6e67 6573 206f 6e6c 7920 696e 2072  hanges only in r
-00008c30: 656c 6174 6564 0a72 6570 6f73 6974 6f72  elated.repositor
-00008c40: 6965 7320 7669 7369 626c 6520 746f 2061  ies visible to a
-00008c50: 6e20 6578 7465 726e 616c 2068 6f6f 6b2e  n external hook.
-00008c60: 0a0a 2865 6d75 6c61 7465 2061 2074 7261  ..(emulate a tra
-00008c70: 6e73 6163 7469 6f6e 2072 756e 6e69 6e67  nsaction running
-00008c80: 2063 6f6e 6375 7272 656e 746c 7920 6279   concurrently by
-00008c90: 2063 6f70 6965 640a 2e68 672f 7374 6f72   copied..hg/stor
-00008ca0: 652f 3030 6368 616e 6765 6c6f 672e 692e  e/00changelog.i.
-00008cb0: 6120 696e 2073 7562 7365 7175 656e 7420  a in subsequent 
-00008cc0: 7465 7374 290a 0a20 2024 2063 6174 203e  test)..  $ cat >
-00008cd0: 2024 5445 5354 544d 502f 7361 7665 7065   $TESTTMP/savepe
-00008ce0: 6e64 696e 672e 7368 203c 3c45 4f46 0a20  nding.sh <<EOF. 
-00008cf0: 203e 2063 7020 2e68 672f 7374 6f72 652f   > cp .hg/store/
-00008d00: 3030 6368 616e 6765 6c6f 672e 692e 6120  00changelog.i.a 
-00008d10: 202e 6867 2f73 746f 7265 2f30 3063 6861   .hg/store/00cha
-00008d20: 6e67 656c 6f67 2e69 2e61 2e73 6176 6564  ngelog.i.a.saved
-00008d30: 0a20 203e 2065 7869 7420 3120 2320 746f  .  > exit 1 # to
-00008d40: 2061 766f 6964 2061 6464 696e 6720 6e65   avoid adding ne
-00008d50: 7720 7265 7669 7369 6f6e 2066 6f72 2073  w revision for s
-00008d60: 7562 7365 7175 656e 7420 7465 7374 730a  ubsequent tests.
-00008d70: 2020 3e20 454f 460a 2020 2420 6364 2061    > EOF.  $ cd a
-00008d80: 0a20 2024 2068 6720 7469 7020 2d71 0a20  .  $ hg tip -q. 
-00008d90: 2034 3a35 3339 6534 6233 3162 3664 630a   4:539e4b31b6dc.
-00008da0: 2020 2420 6867 202d 2d63 6f6e 6669 6720    $ hg --config 
-00008db0: 686f 6f6b 732e 7072 6574 786e 636c 6f73  hooks.pretxnclos
-00008dc0: 653d 2273 6820 2454 4553 5454 4d50 2f73  e="sh $TESTTMP/s
-00008dd0: 6176 6570 656e 6469 6e67 2e73 6822 2063  avepending.sh" c
-00008de0: 6f6d 6d69 7420 2d6d 2022 696e 7669 7369  ommit -m "invisi
-00008df0: 626c 6522 0a20 2074 7261 6e73 6163 7469  ble".  transacti
-00008e00: 6f6e 2061 626f 7274 210a 2020 726f 6c6c  on abort!.  roll
-00008e10: 6261 636b 2063 6f6d 706c 6574 6564 0a20  back completed. 
-00008e20: 2061 626f 7274 3a20 7072 6574 786e 636c   abort: pretxncl
-00008e30: 6f73 6520 686f 6f6b 2065 7869 7465 6420  ose hook exited 
-00008e40: 7769 7468 2073 7461 7475 7320 310a 2020  with status 1.  
-00008e50: 5b34 305d 0a20 2024 2063 7020 2e68 672f  [40].  $ cp .hg/
-00008e60: 7374 6f72 652f 3030 6368 616e 6765 6c6f  store/00changelo
-00008e70: 672e 692e 612e 7361 7665 6420 2e68 672f  g.i.a.saved .hg/
-00008e80: 7374 6f72 652f 3030 6368 616e 6765 6c6f  store/00changelo
-00008e90: 672e 692e 610a 0a28 6368 6563 6b20 2869  g.i.a..(check (i
-00008ea0: 6e29 7669 7369 6269 6c69 7479 206f 6620  n)visibility of 
-00008eb0: 6e65 7720 6368 616e 6765 7365 7420 7768  new changeset wh
-00008ec0: 696c 6520 7472 616e 7361 6374 696f 6e20  ile transaction 
-00008ed0: 7275 6e6e 696e 6720 696e 0a72 6570 6f29  running in.repo)
-00008ee0: 0a0a 2020 2420 6361 7420 3e20 2454 4553  ..  $ cat > $TES
-00008ef0: 5454 4d50 2f63 6865 636b 7065 6e64 696e  TTMP/checkpendin
-00008f00: 672e 7368 203c 3c45 4f46 0a20 203e 2065  g.sh <<EOF.  > e
-00008f10: 6368 6f20 2740 6127 0a20 203e 2068 6720  cho '@a'.  > hg 
-00008f20: 2d52 2022 2454 4553 5454 4d50 2f61 2220  -R "$TESTTMP/a" 
-00008f30: 7469 7020 2d71 0a20 203e 2065 6368 6f20  tip -q.  > echo 
-00008f40: 2740 612f 6e65 7374 6564 270a 2020 3e20  '@a/nested'.  > 
-00008f50: 6867 202d 5220 2224 5445 5354 544d 502f  hg -R "$TESTTMP/
-00008f60: 612f 6e65 7374 6564 2220 7469 7020 2d71  a/nested" tip -q
-00008f70: 0a20 203e 2065 7869 7420 3120 2320 746f  .  > exit 1 # to
-00008f80: 2061 766f 6964 2061 6464 696e 6720 6e65   avoid adding ne
-00008f90: 7720 7265 7669 7369 6f6e 2066 6f72 2073  w revision for s
-00008fa0: 7562 7365 7175 656e 7420 7465 7374 730a  ubsequent tests.
-00008fb0: 2020 3e20 454f 460a 2020 2420 6867 2069    > EOF.  $ hg i
-00008fc0: 6e69 7420 6e65 7374 6564 0a20 2024 2063  nit nested.  $ c
-00008fd0: 6420 6e65 7374 6564 0a20 2024 2065 6368  d nested.  $ ech
-00008fe0: 6f20 6120 3e20 610a 2020 2420 6867 2061  o a > a.  $ hg a
-00008ff0: 6464 2061 0a20 2024 2068 6720 2d2d 636f  dd a.  $ hg --co
-00009000: 6e66 6967 2068 6f6f 6b73 2e70 7265 7478  nfig hooks.pretx
-00009010: 6e63 6c6f 7365 3d22 7368 2024 5445 5354  nclose="sh $TEST
-00009020: 544d 502f 6368 6563 6b70 656e 6469 6e67  TMP/checkpending
-00009030: 2e73 6822 2063 6f6d 6d69 7420 2d6d 2027  .sh" commit -m '
-00009040: 2330 270a 2020 4061 0a20 2034 3a35 3339  #0'.  @a.  4:539
-00009050: 6534 6233 3162 3664 630a 2020 4061 2f6e  e4b31b6dc.  @a/n
-00009060: 6573 7465 640a 2020 303a 6266 3565 3339  ested.  0:bf5e39
-00009070: 3563 6564 3263 0a20 2074 7261 6e73 6163  5ced2c.  transac
-00009080: 7469 6f6e 2061 626f 7274 210a 2020 726f  tion abort!.  ro
-00009090: 6c6c 6261 636b 2063 6f6d 706c 6574 6564  llback completed
-000090a0: 0a20 2061 626f 7274 3a20 7072 6574 786e  .  abort: pretxn
-000090b0: 636c 6f73 6520 686f 6f6b 2065 7869 7465  close hook exite
-000090c0: 6420 7769 7468 2073 7461 7475 7320 310a  d with status 1.
-000090d0: 2020 5b34 305d 0a0a 486f 6f6b 2066 726f    [40]..Hook fro
-000090e0: 6d20 756e 7472 7573 7465 6420 6867 7263  m untrusted hgrc
-000090f0: 2061 7265 2072 6570 6f72 7465 6420 6173   are reported as
-00009100: 2066 6169 6c75 7265 0a3d 3d3d 3d3d 3d3d   failure.=======
-00009110: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00009120: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00009130: 3d3d 3d3d 3d3d 3d3d 3d0a 0a20 2024 2063  =========..  $ c
-00009140: 6174 203c 3c20 454f 4620 3e20 2454 4553  at << EOF > $TES
-00009150: 5454 4d50 2f75 6e74 7275 7374 6564 2e70  TTMP/untrusted.p
-00009160: 790a 2020 3e20 6672 6f6d 206d 6572 6375  y.  > from mercu
-00009170: 7269 616c 2069 6d70 6f72 7420 7363 6d75  rial import scmu
-00009180: 7469 6c2c 2075 7469 6c0a 2020 3e20 6465  til, util.  > de
-00009190: 6620 7569 7365 7475 7028 7569 293a 0a20  f uisetup(ui):. 
-000091a0: 203e 2020 2020 2063 6c61 7373 2075 6e74   >     class unt
-000091b0: 7275 7374 6564 7569 2875 692e 5f5f 636c  rustedui(ui.__cl
-000091c0: 6173 735f 5f29 3a0a 2020 3e20 2020 2020  ass__):.  >     
-000091d0: 2020 2020 6465 6620 5f74 7275 7374 6564      def _trusted
-000091e0: 2873 656c 662c 2066 702c 2066 293a 0a20  (self, fp, f):. 
-000091f0: 203e 2020 2020 2020 2020 2020 2020 2069   >             i
-00009200: 6620 7574 696c 2e6e 6f72 6d70 6174 6828  f util.normpath(
-00009210: 6670 2e6e 616d 6529 2e65 6e64 7377 6974  fp.name).endswit
-00009220: 6828 6227 756e 7472 7573 7465 642f 2e68  h(b'untrusted/.h
-00009230: 672f 6867 7263 2729 3a0a 2020 3e20 2020  g/hgrc'):.  >   
-00009240: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00009250: 7475 726e 2046 616c 7365 0a20 203e 2020  turn False.  >  
-00009260: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00009270: 6e20 7375 7065 7228 756e 7472 7573 7465  n super(untruste
-00009280: 6475 692c 2073 656c 6629 2e5f 7472 7573  dui, self)._trus
-00009290: 7465 6428 6670 2c20 6629 0a20 203e 2020  ted(fp, f).  >  
-000092a0: 2020 2075 692e 5f5f 636c 6173 735f 5f20     ui.__class__ 
-000092b0: 3d20 756e 7472 7573 7465 6475 690a 2020  = untrustedui.  
-000092c0: 3e20 454f 460a 2020 2420 6361 7420 3c3c  > EOF.  $ cat <<
-000092d0: 2045 4f46 203e 3e20 2448 4752 4350 4154   EOF >> $HGRCPAT
-000092e0: 480a 2020 3e20 5b65 7874 656e 7369 6f6e  H.  > [extension
-000092f0: 735d 0a20 203e 2075 6e74 7275 7374 6564  s].  > untrusted
-00009300: 3d24 5445 5354 544d 502f 756e 7472 7573  =$TESTTMP/untrus
-00009310: 7465 642e 7079 0a20 203e 2045 4f46 0a20  ted.py.  > EOF. 
-00009320: 2024 2068 6720 696e 6974 2075 6e74 7275   $ hg init untru
-00009330: 7374 6564 0a20 2024 2063 6420 756e 7472  sted.  $ cd untr
-00009340: 7573 7465 640a 0a4e 6f6e 2d62 6c6f 636b  usted..Non-block
-00009350: 696e 6720 686f 6f6b 0a2d 2d2d 2d2d 2d2d  ing hook.-------
-00009360: 2d2d 2d2d 2d2d 2d2d 2d2d 0a0a 2020 2420  ----------..  $ 
-00009370: 6361 7420 3c3c 2045 4f46 203e 3e20 2e68  cat << EOF >> .h
-00009380: 672f 6867 7263 0a20 203e 205b 686f 6f6b  g/hgrc.  > [hook
-00009390: 735d 0a20 203e 2074 786e 636c 6f73 652e  s].  > txnclose.
-000093a0: 7465 7374 696e 673d 6563 686f 2074 786e  testing=echo txn
-000093b0: 636c 6f73 6520 686f 6f6b 2063 616c 6c65  close hook calle
-000093c0: 640a 2020 3e20 454f 460a 2020 2420 746f  d.  > EOF.  $ to
-000093d0: 7563 6820 6120 2626 2068 6720 636f 6d6d  uch a && hg comm
-000093e0: 6974 202d 4171 6d20 610a 2020 7761 726e  it -Aqm a.  warn
-000093f0: 696e 673a 2075 6e74 7275 7374 6564 2068  ing: untrusted h
-00009400: 6f6f 6b20 7478 6e63 6c6f 7365 2e74 6573  ook txnclose.tes
-00009410: 7469 6e67 206e 6f74 2065 7865 6375 7465  ting not execute
-00009420: 640a 2020 2420 6867 206c 6f67 0a20 2063  d.  $ hg log.  c
-00009430: 6861 6e67 6573 6574 3a20 2020 303a 3339  hangeset:   0:39
-00009440: 3033 3737 3531 3736 6564 0a20 2074 6167  03775176ed.  tag
-00009450: 3a20 2020 2020 2020 2020 7469 700a 2020  :         tip.  
-00009460: 7573 6572 3a20 2020 2020 2020 2074 6573  user:        tes
-00009470: 740a 2020 6461 7465 3a20 2020 2020 2020  t.  date:       
-00009480: 2054 6875 204a 616e 2030 3120 3030 3a30   Thu Jan 01 00:0
-00009490: 303a 3030 2031 3937 3020 2b30 3030 300a  0:00 1970 +0000.
-000094a0: 2020 7375 6d6d 6172 793a 2020 2020 2061    summary:     a
-000094b0: 0a20 200a 0a4e 6f6e 2d62 6c6f 636b 696e  .  ..Non-blockin
-000094c0: 6720 686f 6f6b 0a2d 2d2d 2d2d 2d2d 2d2d  g hook.---------
-000094d0: 2d2d 2d2d 2d2d 2d2d 0a0a 2020 2420 6361  --------..  $ ca
-000094e0: 7420 3c3c 2045 4f46 203e 3e20 2e68 672f  t << EOF >> .hg/
-000094f0: 6867 7263 0a20 203e 205b 686f 6f6b 735d  hgrc.  > [hooks]
-00009500: 0a20 203e 2070 7265 7478 6e63 6c6f 7365  .  > pretxnclose
-00009510: 2e74 6573 7469 6e67 3d65 6368 6f20 7072  .testing=echo pr
-00009520: 652d 7478 6e63 6c6f 7365 2068 6f6f 6b20  e-txnclose hook 
-00009530: 6361 6c6c 6564 0a20 203e 2045 4f46 0a20  called.  > EOF. 
-00009540: 2024 2074 6f75 6368 2062 2026 2620 6867   $ touch b && hg
-00009550: 2063 6f6d 6d69 7420 2d41 716d 2061 0a20   commit -Aqm a. 
-00009560: 2074 7261 6e73 6163 7469 6f6e 2061 626f   transaction abo
-00009570: 7274 210a 2020 726f 6c6c 6261 636b 2063  rt!.  rollback c
-00009580: 6f6d 706c 6574 6564 0a20 2061 626f 7274  ompleted.  abort
-00009590: 3a20 756e 7472 7573 7465 6420 686f 6f6b  : untrusted hook
-000095a0: 2070 7265 7478 6e63 6c6f 7365 2e74 6573   pretxnclose.tes
-000095b0: 7469 6e67 206e 6f74 2065 7865 6375 7465  ting not execute
-000095c0: 640a 2020 2873 6565 2027 6867 2068 656c  d.  (see 'hg hel
-000095d0: 7020 636f 6e66 6967 2e74 7275 7374 6564  p config.trusted
-000095e0: 2729 0a20 205b 3430 5d0a 2020 2420 6867  ').  [40].  $ hg
-000095f0: 206c 6f67 0a20 2063 6861 6e67 6573 6574   log.  changeset
-00009600: 3a20 2020 303a 3339 3033 3737 3531 3736  :   0:3903775176
-00009610: 6564 0a20 2074 6167 3a20 2020 2020 2020  ed.  tag:       
-00009620: 2020 7469 700a 2020 7573 6572 3a20 2020    tip.  user:   
-00009630: 2020 2020 2074 6573 740a 2020 6461 7465       test.  date
-00009640: 3a20 2020 2020 2020 2054 6875 204a 616e  :        Thu Jan
-00009650: 2030 3120 3030 3a30 303a 3030 2031 3937   01 00:00:00 197
-00009660: 3020 2b30 3030 300a 2020 7375 6d6d 6172  0 +0000.  summar
-00009670: 793a 2020 2020 2061 0a20 200a 0a75 6e73  y:     a.  ..uns
-00009680: 6574 7570 2074 6865 2074 6573 740a 2d2d  etup the test.--
-00009690: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a0a  --------------..
-000096a0: 2320 746f 7563 6820 7468 6520 6669 6c65  # touch the file
-000096b0: 2074 6f20 756e 636f 6e66 7573 6520 6368   to unconfuse ch
-000096c0: 6720 7769 7468 2061 2064 6966 6672 656e  g with a diffren
-000096d0: 7420 6d74 696d 650a 2020 2420 736c 6565  t mtime.  $ slee
-000096e0: 7020 310a 2020 2420 746f 7563 6820 2454  p 1.  $ touch $T
-000096f0: 4553 5454 4d50 2f75 6e74 7275 7374 6564  ESTTMP/untrusted
-00009700: 2e70 790a 2020 2420 6361 7420 3c3c 2045  .py.  $ cat << E
-00009710: 4f46 203e 3e20 2448 4752 4350 4154 480a  OF >> $HGRCPATH.
-00009720: 2020 3e20 5b65 7874 656e 7369 6f6e 735d    > [extensions]
-00009730: 0a20 203e 2075 6e74 7275 7374 6564 3d21  .  > untrusted=!
-00009740: 0a20 203e 2045 4f46 0a0a 4847 504c 4149  .  > EOF..HGPLAI
-00009750: 4e20 7365 7474 696e 6720 696e 2068 6f6f  N setting in hoo
-00009760: 6b73 0a3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ks.=============
-00009770: 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 0a20 2024  ===========..  $
-00009780: 2063 6174 203c 3c20 454f 4620 3e3e 202e   cat << EOF >> .
-00009790: 6867 2f68 6772 630a 2020 3e20 5b68 6f6f  hg/hgrc.  > [hoo
-000097a0: 6b73 5d0a 2020 3e20 7072 652d 7665 7273  ks].  > pre-vers
-000097b0: 696f 6e2e 7465 7374 696e 672d 6465 6661  ion.testing-defa
-000097c0: 756c 743d 7368 202d 6320 2265 6368 6f20  ult=sh -c "echo 
-000097d0: 2723 2323 2064 6566 6175 6c74 2023 2323  '### default ###
-000097e0: 2720 706c 6169 6e3a 205c 247b 4847 504c  ' plain: \${HGPL
-000097f0: 4149 4e3a 2d27 3c75 6e73 6574 3e27 7d22  AIN:-'<unset>'}"
-00009800: 0a20 203e 2070 7265 2d76 6572 7369 6f6e  .  > pre-version
-00009810: 2e74 6573 7469 6e67 2d79 6573 3d73 6820  .testing-yes=sh 
-00009820: 2d63 2022 6563 686f 2027 2323 2320 7965  -c "echo '### ye
-00009830: 7320 2323 2323 2323 2327 2070 6c61 696e  s #######' plain
-00009840: 3a20 5c24 7b48 4750 4c41 494e 3a2d 273c  : \${HGPLAIN:-'<
-00009850: 756e 7365 743e 277d 220a 2020 3e20 7072  unset>'}".  > pr
-00009860: 652d 7665 7273 696f 6e2e 7465 7374 696e  e-version.testin
-00009870: 672d 7965 733a 7275 6e2d 7769 7468 2d70  g-yes:run-with-p
-00009880: 6c61 696e 3d79 6573 0a20 203e 2070 7265  lain=yes.  > pre
-00009890: 2d76 6572 7369 6f6e 2e74 6573 7469 6e67  -version.testing
-000098a0: 2d6e 6f3d 7368 202d 6320 2265 6368 6f20  -no=sh -c "echo 
-000098b0: 2723 2323 206e 6f20 2323 2323 2323 2323  '### no ########
-000098c0: 2720 706c 6169 6e3a 205c 247b 4847 504c  ' plain: \${HGPL
-000098d0: 4149 4e3a 2d27 3c75 6e73 6574 3e27 7d22  AIN:-'<unset>'}"
-000098e0: 0a20 203e 2070 7265 2d76 6572 7369 6f6e  .  > pre-version
-000098f0: 2e74 6573 7469 6e67 2d6e 6f3a 7275 6e2d  .testing-no:run-
-00009900: 7769 7468 2d70 6c61 696e 3d6e 6f0a 2020  with-plain=no.  
-00009910: 3e20 7072 652d 7665 7273 696f 6e2e 7465  > pre-version.te
-00009920: 7374 696e 672d 6175 746f 3d73 6820 2d63  sting-auto=sh -c
-00009930: 2022 6563 686f 2027 2323 2320 6175 746f   "echo '### auto
-00009940: 2023 2323 2323 2327 2070 6c61 696e 3a20   ######' plain: 
-00009950: 5c24 7b48 4750 4c41 494e 3a2d 273c 756e  \${HGPLAIN:-'<un
-00009960: 7365 743e 277d 220a 2020 3e20 7072 652d  set>'}".  > pre-
-00009970: 7665 7273 696f 6e2e 7465 7374 696e 672d  version.testing-
-00009980: 6175 746f 3a72 756e 2d77 6974 682d 706c  auto:run-with-pl
-00009990: 6169 6e3d 6175 746f 0a20 203e 2045 4f46  ain=auto.  > EOF
-000099a0: 0a0a 2020 2420 2875 6e73 6574 2048 4750  ..  $ (unset HGP
-000099b0: 4c41 494e 3b20 6867 2076 6572 7369 6f6e  LAIN; hg version
-000099c0: 202d 2d71 7569 6574 290a 2020 2323 2320   --quiet).  ### 
-000099d0: 6465 6661 756c 7420 2323 2320 706c 6169  default ### plai
-000099e0: 6e3a 2031 0a20 2023 2323 2079 6573 2023  n: 1.  ### yes #
-000099f0: 2323 2323 2323 2070 6c61 696e 3a20 310a  ###### plain: 1.
-00009a00: 2020 2323 2320 6e6f 2023 2323 2323 2323    ### no #######
-00009a10: 2320 706c 6169 6e3a 203c 756e 7365 743e  # plain: <unset>
-00009a20: 0a20 2023 2323 2061 7574 6f20 2323 2323  .  ### auto ####
-00009a30: 2323 2070 6c61 696e 3a20 3c75 6e73 6574  ## plain: <unset
-00009a40: 3e0a 2020 4d65 7263 7572 6961 6c20 4469  >.  Mercurial Di
-00009a50: 7374 7269 6275 7465 6420 5343 4d20 282a  stributed SCM (*
-00009a60: 2920 2867 6c6f 6229 0a0a 2020 2420 4847  ) (glob)..  $ HG
-00009a70: 504c 4149 4e3d 3120 6867 2076 6572 7369  PLAIN=1 hg versi
-00009a80: 6f6e 202d 2d71 7569 6574 0a20 2023 2323  on --quiet.  ###
-00009a90: 2064 6566 6175 6c74 2023 2323 2070 6c61   default ### pla
-00009aa0: 696e 3a20 310a 2020 2323 2320 7965 7320  in: 1.  ### yes 
-00009ab0: 2323 2323 2323 2320 706c 6169 6e3a 2031  ####### plain: 1
-00009ac0: 0a20 2023 2323 206e 6f20 2323 2323 2323  .  ### no ######
-00009ad0: 2323 2070 6c61 696e 3a20 3c75 6e73 6574  ## plain: <unset
-00009ae0: 3e0a 2020 2323 2320 6175 746f 2023 2323  >.  ### auto ###
-00009af0: 2323 2320 706c 6169 6e3a 2031 0a20 204d  ### plain: 1.  M
-00009b00: 6572 6375 7269 616c 2044 6973 7472 6962  ercurial Distrib
-00009b10: 7574 6564 2053 434d 2028 2a29 2028 676c  uted SCM (*) (gl
-00009b20: 6f62 290a                                ob).
+00007910: 6d20 7365 636f 6e64 2066 6169 6c65 6420  m second failed 
+00007920: 696d 706f 7274 2061 7474 656d 7074 3a0a  import attempt:.
+00007930: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
+00007940: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
+00007950: 7374 293a 0a20 204d 6f64 756c 654e 6f74  st):.  ModuleNot
+00007960: 466f 756e 6445 7272 6f72 3a20 4e6f 206d  FoundError: No m
+00007970: 6f64 756c 6520 6e61 6d65 6420 2773 6f6d  odule named 'som
+00007980: 6562 6f67 7573 6d6f 6475 6c65 270a 2020  ebogusmodule'.  
+00007990: 5472 6163 6562 6163 6b20 286d 6f73 7420  Traceback (most 
+000079a0: 7265 6365 6e74 2063 616c 6c20 6c61 7374  recent call last
+000079b0: 293a 0a20 204d 6f64 756c 654e 6f74 466f  ):.  ModuleNotFo
+000079c0: 756e 6445 7272 6f72 3a20 4e6f 206d 6f64  undError: No mod
+000079d0: 756c 6520 6e61 6d65 6420 2768 6765 7874  ule named 'hgext
+000079e0: 5f69 6d70 6f72 7466 6169 6c27 0a20 2054  _importfail'.  T
+000079f0: 7261 6365 6261 636b 2028 6d6f 7374 2072  raceback (most r
+00007a00: 6563 656e 7420 6361 6c6c 206c 6173 7429  ecent call last)
+00007a10: 3a0a 2020 4d6f 6475 6c65 4e6f 7446 6f75  :.  ModuleNotFou
+00007a20: 6e64 4572 726f 723a 204e 6f20 6d6f 6475  ndError: No modu
+00007a30: 6c65 206e 616d 6564 2027 736f 6d65 626f  le named 'somebo
+00007a40: 6775 736d 6f64 756c 6527 0a20 2054 7261  gusmodule'.  Tra
+00007a50: 6365 6261 636b 2028 6d6f 7374 2072 6563  ceback (most rec
+00007a60: 656e 7420 6361 6c6c 206c 6173 7429 3a0a  ent call last):.
+00007a70: 2020 4d6f 6475 6c65 4e6f 7446 6f75 6e64    ModuleNotFound
+00007a80: 4572 726f 723a 204e 6f20 6d6f 6475 6c65  Error: No module
+00007a90: 206e 616d 6564 2027 6867 6578 745f 696d   named 'hgext_im
+00007aa0: 706f 7274 6661 696c 270a 2020 5472 6163  portfail'.  Trac
+00007ab0: 6562 6163 6b20 286d 6f73 7420 7265 6365  eback (most rece
+00007ac0: 6e74 2063 616c 6c20 6c61 7374 293a 0a20  nt call last):. 
+00007ad0: 2020 2020 2072 6169 7365 2065 7272 6f72       raise error
+00007ae0: 2e48 6f6f 6b4c 6f61 6445 7272 6f72 2820  .HookLoadError( 
+00007af0: 2870 7933 3820 2129 0a20 206d 6572 6375  (py38 !).  mercu
+00007b00: 7269 616c 2e65 7272 6f72 2e48 6f6f 6b4c  rial.error.HookL
+00007b10: 6f61 6445 7272 6f72 3a20 7072 6563 6f6d  oadError: precom
+00007b20: 6d69 742e 696d 706f 7274 6661 696c 2068  mit.importfail h
+00007b30: 6f6f 6b20 6973 2069 6e76 616c 6964 3a20  ook is invalid: 
+00007b40: 696d 706f 7274 206f 6620 2269 6d70 6f72  import of "impor
+00007b50: 7466 6169 6c22 2066 6169 6c65 640a 2020  tfail" failed.  
+00007b60: 6162 6f72 743a 2070 7265 636f 6d6d 6974  abort: precommit
+00007b70: 2e69 6d70 6f72 7466 6169 6c20 686f 6f6b  .importfail hook
+00007b80: 2069 7320 696e 7661 6c69 643a 2069 6d70   is invalid: imp
+00007b90: 6f72 7420 6f66 2022 696d 706f 7274 6661  ort of "importfa
+00007ba0: 696c 2220 6661 696c 6564 0a0a 4973 7375  il" failed..Issu
+00007bb0: 6531 3832 373a 2048 6f6f 6b73 2055 7064  e1827: Hooks Upd
+00007bc0: 6174 6520 2620 436f 6d6d 6974 206e 6f74  ate & Commit not
+00007bd0: 2063 6f6d 706c 6574 656c 7920 706f 7374   completely post
+00007be0: 206f 7065 7261 7469 6f6e 0a0a 636f 6d6d   operation..comm
+00007bf0: 6974 2061 6e64 2075 7064 6174 6520 686f  it and update ho
+00007c00: 6f6b 7320 7368 6f75 6c64 2072 756e 2061  oks should run a
+00007c10: 6674 6572 2063 6f6d 6d61 6e64 2063 6f6d  fter command com
+00007c20: 706c 6574 696f 6e2e 2020 5468 6520 6c61  pletion.  The la
+00007c30: 7267 6566 696c 6573 0a75 7365 2064 656d  rgefiles.use dem
+00007c40: 6f6e 7374 7261 7465 7320 6120 7265 6375  onstrates a recu
+00007c50: 7273 6976 6520 776c 6f63 6b2c 2073 686f  rsive wlock, sho
+00007c60: 7769 6e67 2074 6865 2068 6f6f 6b20 646f  wing the hook do
+00007c70: 6573 6e27 7420 7275 6e20 756e 7469 6c20  esn't run until 
+00007c80: 7468 650a 6669 6e61 6c20 7265 6c65 6173  the.final releas
+00007c90: 6520 2861 6e64 2064 6972 7374 6174 6520  e (and dirstate 
+00007ca0: 666c 7573 6829 2e0a 0a20 2024 2065 6368  flush)...  $ ech
+00007cb0: 6f20 275b 686f 6f6b 735d 2720 3e20 2e68  o '[hooks]' > .h
+00007cc0: 672f 6867 7263 0a20 2024 2065 6368 6f20  g/hgrc.  $ echo 
+00007cd0: 2763 6f6d 6d69 7420 3d20 6867 2069 6427  'commit = hg id'
+00007ce0: 203e 3e20 2e68 672f 6867 7263 0a20 2024   >> .hg/hgrc.  $
+00007cf0: 2065 6368 6f20 2775 7064 6174 6520 3d20   echo 'update = 
+00007d00: 6867 2069 6427 203e 3e20 2e68 672f 6867  hg id' >> .hg/hg
+00007d10: 7263 0a20 2024 2065 6368 6f20 6262 203e  rc.  $ echo bb >
+00007d20: 2061 0a20 2024 2068 6720 6369 202d 6d61   a.  $ hg ci -ma
+00007d30: 0a20 2032 3233 6561 6665 3237 3530 6320  .  223eafe2750c 
+00007d40: 7469 700a 2020 2420 6867 2075 7020 3020  tip.  $ hg up 0 
+00007d50: 2d2d 636f 6e66 6967 2065 7874 656e 7369  --config extensi
+00007d60: 6f6e 732e 6c61 7267 6566 696c 6573 3d0a  ons.largefiles=.
+00007d70: 2020 5468 6520 6673 6d6f 6e69 746f 7220    The fsmonitor 
+00007d80: 6578 7465 6e73 696f 6e20 6973 2069 6e63  extension is inc
+00007d90: 6f6d 7061 7469 626c 6520 7769 7468 2074  ompatible with t
+00007da0: 6865 206c 6172 6765 6669 6c65 7320 6578  he largefiles ex
+00007db0: 7465 6e73 696f 6e20 616e 6420 6861 7320  tension and has 
+00007dc0: 6265 656e 2064 6973 6162 6c65 642e 2028  been disabled. (
+00007dd0: 6673 6d6f 6e69 746f 7220 2129 0a20 2063  fsmonitor !).  c
+00007de0: 6239 6139 6633 3134 6238 620a 2020 3120  b9a9f314b8b.  1 
+00007df0: 6669 6c65 7320 7570 6461 7465 642c 2030  files updated, 0
+00007e00: 2066 696c 6573 206d 6572 6765 642c 2030   files merged, 0
+00007e10: 2066 696c 6573 2072 656d 6f76 6564 2c20   files removed, 
+00007e20: 3020 6669 6c65 7320 756e 7265 736f 6c76  0 files unresolv
+00007e30: 6564 0a0a 6d61 6b65 2073 7572 6520 2d2d  ed..make sure --
+00007e40: 7665 7262 6f73 6520 2861 6e64 202d 2d71  verbose (and --q
+00007e50: 7569 6574 2f2d 2d64 6562 7567 2065 7463  uiet/--debug etc
+00007e60: 2e29 2061 7265 2070 726f 7061 6761 7465  .) are propagate
+00007e70: 6420 746f 2074 6865 206c 6f63 616c 2075  d to the local u
+00007e80: 690a 7468 6174 2069 7320 7061 7373 6564  i.that is passed
+00007e90: 2074 6f20 7072 652f 706f 7374 2068 6f6f   to pre/post hoo
+00007ea0: 6b73 0a0a 2020 2420 6563 686f 2027 5b68  ks..  $ echo '[h
+00007eb0: 6f6f 6b73 5d27 203e 202e 6867 2f68 6772  ooks]' > .hg/hgr
+00007ec0: 630a 2020 2420 6563 686f 2027 7072 652d  c.  $ echo 'pre-
+00007ed0: 6964 656e 7469 6679 203d 2070 7974 686f  identify = pytho
+00007ee0: 6e3a 686f 6f6b 7465 7374 732e 7665 7262  n:hooktests.verb
+00007ef0: 6f73 6568 6f6f 6b27 203e 3e20 2e68 672f  osehook' >> .hg/
+00007f00: 6867 7263 0a20 2024 2068 6720 6964 0a20  hgrc.  $ hg id. 
+00007f10: 2063 6239 6139 6633 3134 6238 620a 2020   cb9a9f314b8b.  
+00007f20: 2420 6867 2069 6420 2d2d 7665 7262 6f73  $ hg id --verbos
+00007f30: 650a 2020 6361 6c6c 696e 6720 686f 6f6b  e.  calling hook
+00007f40: 2070 7265 2d69 6465 6e74 6966 793a 2068   pre-identify: h
+00007f50: 6f6f 6b74 6573 7473 2e76 6572 626f 7365  ooktests.verbose
+00007f60: 686f 6f6b 0a20 2076 6572 626f 7365 206f  hook.  verbose o
+00007f70: 7574 7075 7420 6672 6f6d 2068 6f6f 6b0a  utput from hook.
+00007f80: 2020 6362 3961 3966 3331 3462 3862 0a0a    cb9a9f314b8b..
+00007f90: 456e 7375 7265 2068 6f6f 6b73 2063 616e  Ensure hooks can
+00007fa0: 2062 6520 7072 696f 7269 7469 7a65 640a   be prioritized.
+00007fb0: 0a20 2024 2065 6368 6f20 275b 686f 6f6b  .  $ echo '[hook
+00007fc0: 735d 2720 3e20 2e68 672f 6867 7263 0a20  s]' > .hg/hgrc. 
+00007fd0: 2024 2065 6368 6f20 2770 7265 2d69 6465   $ echo 'pre-ide
+00007fe0: 6e74 6966 792e 6120 3d20 7079 7468 6f6e  ntify.a = python
+00007ff0: 3a68 6f6f 6b74 6573 7473 2e76 6572 626f  :hooktests.verbo
+00008000: 7365 686f 6f6b 2720 3e3e 202e 6867 2f68  sehook' >> .hg/h
+00008010: 6772 630a 2020 2420 6563 686f 2027 7072  grc.  $ echo 'pr
+00008020: 652d 6964 656e 7469 6679 2e62 203d 2070  e-identify.b = p
+00008030: 7974 686f 6e3a 686f 6f6b 7465 7374 732e  ython:hooktests.
+00008040: 7665 7262 6f73 6568 6f6f 6b27 203e 3e20  verbosehook' >> 
+00008050: 2e68 672f 6867 7263 0a20 2024 2065 6368  .hg/hgrc.  $ ech
+00008060: 6f20 2770 7269 6f72 6974 792e 7072 652d  o 'priority.pre-
+00008070: 6964 656e 7469 6679 2e62 203d 2031 2720  identify.b = 1' 
+00008080: 3e3e 202e 6867 2f68 6772 630a 2020 2420  >> .hg/hgrc.  $ 
+00008090: 6563 686f 2027 7072 652d 6964 656e 7469  echo 'pre-identi
+000080a0: 6679 2e63 203d 2070 7974 686f 6e3a 686f  fy.c = python:ho
+000080b0: 6f6b 7465 7374 732e 7665 7262 6f73 6568  oktests.verboseh
+000080c0: 6f6f 6b27 203e 3e20 2e68 672f 6867 7263  ook' >> .hg/hgrc
+000080d0: 0a20 2024 2068 6720 6964 202d 2d76 6572  .  $ hg id --ver
+000080e0: 626f 7365 0a20 2063 616c 6c69 6e67 2068  bose.  calling h
+000080f0: 6f6f 6b20 7072 652d 6964 656e 7469 6679  ook pre-identify
+00008100: 2e62 3a20 686f 6f6b 7465 7374 732e 7665  .b: hooktests.ve
+00008110: 7262 6f73 6568 6f6f 6b0a 2020 7665 7262  rbosehook.  verb
+00008120: 6f73 6520 6f75 7470 7574 2066 726f 6d20  ose output from 
+00008130: 686f 6f6b 0a20 2063 616c 6c69 6e67 2068  hook.  calling h
+00008140: 6f6f 6b20 7072 652d 6964 656e 7469 6679  ook pre-identify
+00008150: 2e61 3a20 686f 6f6b 7465 7374 732e 7665  .a: hooktests.ve
+00008160: 7262 6f73 6568 6f6f 6b0a 2020 7665 7262  rbosehook.  verb
+00008170: 6f73 6520 6f75 7470 7574 2066 726f 6d20  ose output from 
+00008180: 686f 6f6b 0a20 2063 616c 6c69 6e67 2068  hook.  calling h
+00008190: 6f6f 6b20 7072 652d 6964 656e 7469 6679  ook pre-identify
+000081a0: 2e63 3a20 686f 6f6b 7465 7374 732e 7665  .c: hooktests.ve
+000081b0: 7262 6f73 6568 6f6f 6b0a 2020 7665 7262  rbosehook.  verb
+000081c0: 6f73 6520 6f75 7470 7574 2066 726f 6d20  ose output from 
+000081d0: 686f 6f6b 0a20 2063 6239 6139 6633 3134  hook.  cb9a9f314
+000081e0: 6238 620a 0a6e 6577 2074 6167 7320 6d75  b8b..new tags mu
+000081f0: 7374 2062 6520 7669 7369 626c 6520 696e  st be visible in
+00008200: 2070 7265 7478 6e63 6f6d 6d69 7420 2869   pretxncommit (i
+00008210: 7373 7565 3332 3130 290a 0a20 2024 2065  ssue3210)..  $ e
+00008220: 6368 6f20 2770 7265 7478 6e63 6f6d 6d69  cho 'pretxncommi
+00008230: 742e 7072 696e 7474 6167 7320 3d20 7079  t.printtags = py
+00008240: 7468 6f6e 3a68 6f6f 6b74 6573 7473 2e70  thon:hooktests.p
+00008250: 7269 6e74 7461 6773 2720 3e3e 202e 6867  rinttags' >> .hg
+00008260: 2f68 6772 630a 2020 2420 6867 2074 6167  /hgrc.  $ hg tag
+00008270: 202d 6620 666f 6f0a 2020 5b61 2c20 666f   -f foo.  [a, fo
+00008280: 6f2c 2074 6970 5d0a 0a70 6f73 742d 696e  o, tip]..post-in
+00008290: 6974 2068 6f6f 6b73 206d 7573 7420 6e6f  it hooks must no
+000082a0: 7420 6372 6173 6820 2869 7373 7565 3439  t crash (issue49
+000082b0: 3833 290a 5468 6973 2061 6c73 6f20 6372  83).This also cr
+000082c0: 6561 7465 7320 7468 6520 6074 6f60 2072  eates the `to` r
+000082d0: 6570 6f20 666f 7220 7468 6520 6e65 7874  epo for the next
+000082e0: 2074 6573 7420 626c 6f63 6b2e 0a0a 2020   test block...  
+000082f0: 2420 6364 202e 2e0a 2020 2420 6361 7420  $ cd ...  $ cat 
+00008300: 3c3c 2045 4f46 203e 3e20 6867 7263 2d77  << EOF >> hgrc-w
+00008310: 6974 682d 706f 7374 2d69 6e69 742d 686f  ith-post-init-ho
+00008320: 6f6b 0a20 203e 205b 686f 6f6b 735d 0a20  ok.  > [hooks]. 
+00008330: 203e 2070 6f73 742d 696e 6974 203d 2073   > post-init = s
+00008340: 6820 2d63 2022 7072 696e 7465 6e76 2e70  h -c "printenv.p
+00008350: 7920 2d2d 6c69 6e65 2070 6f73 742d 696e  y --line post-in
+00008360: 6974 220a 2020 3e20 454f 460a 2020 2420  it".  > EOF.  $ 
+00008370: 4847 5243 5041 5448 3d68 6772 632d 7769  HGRCPATH=hgrc-wi
+00008380: 7468 2d70 6f73 742d 696e 6974 2d68 6f6f  th-post-init-hoo
+00008390: 6b20 6867 2069 6e69 7420 746f 0a20 2070  k hg init to.  p
+000083a0: 6f73 742d 696e 6974 2068 6f6f 6b3a 2048  ost-init hook: H
+000083b0: 475f 4152 4753 3d69 6e69 7420 746f 0a20  G_ARGS=init to. 
+000083c0: 2048 475f 484f 4f4b 4e41 4d45 3d70 6f73   HG_HOOKNAME=pos
+000083d0: 742d 696e 6974 0a20 2048 475f 484f 4f4b  t-init.  HG_HOOK
+000083e0: 5459 5045 3d70 6f73 742d 696e 6974 0a20  TYPE=post-init. 
+000083f0: 2048 475f 4f50 5453 3d7b 2769 6e73 6563   HG_OPTS={'insec
+00008400: 7572 6527 3a20 4e6f 6e65 2c20 2772 656d  ure': None, 'rem
+00008410: 6f74 6563 6d64 273a 2027 272c 2027 7373  otecmd': '', 'ss
+00008420: 6827 3a20 2727 7d0a 2020 4847 5f50 4154  h': ''}.  HG_PAT
+00008430: 533d 5b27 746f 275d 0a20 2048 475f 5245  S=['to'].  HG_RE
+00008440: 5355 4c54 3d30 0a20 200a 0a6e 6577 2063  SULT=0.  ..new c
+00008450: 6f6d 6d69 7473 206d 7573 7420 6265 2076  ommits must be v
+00008460: 6973 6962 6c65 2069 6e20 7072 6574 786e  isible in pretxn
+00008470: 6368 616e 6765 6772 6f75 7020 2869 7373  changegroup (iss
+00008480: 7565 3334 3238 290a 0a20 2024 2065 6368  ue3428)..  $ ech
+00008490: 6f20 275b 686f 6f6b 735d 2720 3e3e 2074  o '[hooks]' >> t
+000084a0: 6f2f 2e68 672f 6867 7263 0a20 2024 2065  o/.hg/hgrc.  $ e
+000084b0: 6368 6f20 2770 7265 6368 616e 6765 6772  cho 'prechangegr
+000084c0: 6f75 7020 3d20 6867 202d 2d74 7261 6365  oup = hg --trace
+000084d0: 6261 636b 2074 6970 2720 3e3e 2074 6f2f  back tip' >> to/
+000084e0: 2e68 672f 6867 7263 0a20 2024 2065 6368  .hg/hgrc.  $ ech
+000084f0: 6f20 2770 7265 7478 6e63 6861 6e67 6567  o 'pretxnchangeg
+00008500: 726f 7570 203d 2068 6720 2d2d 7472 6163  roup = hg --trac
+00008510: 6562 6163 6b20 7469 7027 203e 3e20 746f  eback tip' >> to
+00008520: 2f2e 6867 2f68 6772 630a 2020 2420 6563  /.hg/hgrc.  $ ec
+00008530: 686f 2061 203e 3e20 746f 2f61 0a20 2024  ho a >> to/a.  $
+00008540: 2068 6720 2d2d 6377 6420 746f 2063 6920   hg --cwd to ci 
+00008550: 2d41 6d61 0a20 2061 6464 696e 6720 610a  -Ama.  adding a.
+00008560: 2020 2420 6867 2063 6c6f 6e65 2074 6f20    $ hg clone to 
+00008570: 6672 6f6d 0a20 2075 7064 6174 696e 6720  from.  updating 
+00008580: 746f 2062 7261 6e63 6820 6465 6661 756c  to branch defaul
+00008590: 740a 2020 3120 6669 6c65 7320 7570 6461  t.  1 files upda
+000085a0: 7465 642c 2030 2066 696c 6573 206d 6572  ted, 0 files mer
+000085b0: 6765 642c 2030 2066 696c 6573 2072 656d  ged, 0 files rem
+000085c0: 6f76 6564 2c20 3020 6669 6c65 7320 756e  oved, 0 files un
+000085d0: 7265 736f 6c76 6564 0a20 2024 2065 6368  resolved.  $ ech
+000085e0: 6f20 6161 203e 3e20 6672 6f6d 2f61 0a20  o aa >> from/a. 
+000085f0: 2024 2068 6720 2d2d 6377 6420 6672 6f6d   $ hg --cwd from
+00008600: 2063 6920 2d6d 620a 2020 2420 6867 202d   ci -mb.  $ hg -
+00008610: 2d63 7764 2066 726f 6d20 7075 7368 0a20  -cwd from push. 
+00008620: 2070 7573 6869 6e67 2074 6f20 2454 4553   pushing to $TES
+00008630: 5454 4d50 2f74 6f0a 2020 7365 6172 6368  TTMP/to.  search
+00008640: 696e 6720 666f 7220 6368 616e 6765 730a  ing for changes.
+00008650: 2020 6368 616e 6765 7365 743a 2020 2030    changeset:   0
+00008660: 3a63 6239 6139 6633 3134 6238 620a 2020  :cb9a9f314b8b.  
+00008670: 7461 673a 2020 2020 2020 2020 2074 6970  tag:         tip
+00008680: 0a20 2075 7365 723a 2020 2020 2020 2020  .  user:        
+00008690: 7465 7374 0a20 2064 6174 653a 2020 2020  test.  date:    
+000086a0: 2020 2020 5468 7520 4a61 6e20 3031 2030      Thu Jan 01 0
+000086b0: 303a 3030 3a30 3020 3139 3730 202b 3030  0:00:00 1970 +00
+000086c0: 3030 0a20 2073 756d 6d61 7279 3a20 2020  00.  summary:   
+000086d0: 2020 610a 2020 0a20 2061 6464 696e 6720    a.  .  adding 
+000086e0: 6368 616e 6765 7365 7473 0a20 2061 6464  changesets.  add
+000086f0: 696e 6720 6d61 6e69 6665 7374 730a 2020  ing manifests.  
+00008700: 6164 6469 6e67 2066 696c 6520 6368 616e  adding file chan
+00008710: 6765 730a 2020 6368 616e 6765 7365 743a  ges.  changeset:
+00008720: 2020 2031 3a39 3833 3661 3037 6239 6239     1:9836a07b9b9
+00008730: 640a 2020 7461 673a 2020 2020 2020 2020  d.  tag:        
+00008740: 2074 6970 0a20 2075 7365 723a 2020 2020   tip.  user:    
+00008750: 2020 2020 7465 7374 0a20 2064 6174 653a      test.  date:
+00008760: 2020 2020 2020 2020 5468 7520 4a61 6e20          Thu Jan 
+00008770: 3031 2030 303a 3030 3a30 3020 3139 3730  01 00:00:00 1970
+00008780: 202b 3030 3030 0a20 2073 756d 6d61 7279   +0000.  summary
+00008790: 3a20 2020 2020 620a 2020 0a20 2061 6464  :     b.  .  add
+000087a0: 6564 2031 2063 6861 6e67 6573 6574 7320  ed 1 changesets 
+000087b0: 7769 7468 2031 2063 6861 6e67 6573 2074  with 1 changes t
+000087c0: 6f20 3120 6669 6c65 730a 0a70 7265 7478  o 1 files..pretx
+000087d0: 6e63 6c6f 7365 2068 6f6f 6b20 6661 696c  nclose hook fail
+000087e0: 7572 6520 7368 6f75 6c64 2061 626f 7274  ure should abort
+000087f0: 2074 6865 2074 7261 6e73 6163 7469 6f6e   the transaction
+00008800: 0a0a 2020 2420 6867 2069 6e69 7420 7478  ..  $ hg init tx
+00008810: 6e66 6169 6c75 7265 0a20 2024 2063 6420  nfailure.  $ cd 
+00008820: 7478 6e66 6169 6c75 7265 0a20 2024 2074  txnfailure.  $ t
+00008830: 6f75 6368 2061 2026 2620 6867 2063 6f6d  ouch a && hg com
+00008840: 6d69 7420 2d41 716d 2061 0a20 2024 2063  mit -Aqm a.  $ c
+00008850: 6174 203e 3e20 2e68 672f 6867 7263 203c  at >> .hg/hgrc <
+00008860: 3c45 4f46 0a20 203e 205b 686f 6f6b 735d  <EOF.  > [hooks]
+00008870: 0a20 203e 2070 7265 7478 6e63 6c6f 7365  .  > pretxnclose
+00008880: 2e65 7272 6f72 203d 2065 7869 7420 310a  .error = exit 1.
+00008890: 2020 3e20 454f 460a 2020 2420 6867 2073    > EOF.  $ hg s
+000088a0: 7472 6970 202d 7220 3020 2d2d 636f 6e66  trip -r 0 --conf
+000088b0: 6967 2065 7874 656e 7369 6f6e 732e 7374  ig extensions.st
+000088c0: 7269 703d 0a20 2030 2066 696c 6573 2075  rip=.  0 files u
+000088d0: 7064 6174 6564 2c20 3020 6669 6c65 7320  pdated, 0 files 
+000088e0: 6d65 7267 6564 2c20 3120 6669 6c65 7320  merged, 1 files 
+000088f0: 7265 6d6f 7665 642c 2030 2066 696c 6573  removed, 0 files
+00008900: 2075 6e72 6573 6f6c 7665 640a 2020 7361   unresolved.  sa
+00008910: 7665 6420 6261 636b 7570 2062 756e 646c  ved backup bundl
+00008920: 6520 746f 202a 2028 676c 6f62 290a 2020  e to * (glob).  
+00008930: 7472 616e 7361 6374 696f 6e20 6162 6f72  transaction abor
+00008940: 7421 0a20 2072 6f6c 6c62 6163 6b20 636f  t!.  rollback co
+00008950: 6d70 6c65 7465 640a 2020 7374 7269 7020  mpleted.  strip 
+00008960: 6661 696c 6564 2c20 6261 636b 7570 2062  failed, backup b
+00008970: 756e 646c 6520 7374 6f72 6564 2069 6e20  undle stored in 
+00008980: 2a20 2867 6c6f 6229 0a20 2061 626f 7274  * (glob).  abort
+00008990: 3a20 7072 6574 786e 636c 6f73 652e 6572  : pretxnclose.er
+000089a0: 726f 7220 686f 6f6b 2065 7869 7465 6420  ror hook exited 
+000089b0: 7769 7468 2073 7461 7475 7320 310a 2020  with status 1.  
+000089c0: 5b34 305d 0a20 2024 2068 6720 7265 636f  [40].  $ hg reco
+000089d0: 7665 720a 2020 6e6f 2069 6e74 6572 7275  ver.  no interru
+000089e0: 7074 6564 2074 7261 6e73 6163 7469 6f6e  pted transaction
+000089f0: 2061 7661 696c 6162 6c65 0a20 205b 315d   available.  [1]
+00008a00: 0a20 2024 2063 6420 2e2e 0a0a 6368 6563  .  $ cd ....chec
+00008a10: 6b20 7768 6574 6865 7220 4847 5f50 454e  k whether HG_PEN
+00008a20: 4449 4e47 206d 616b 6573 2070 656e 6469  DING makes pendi
+00008a30: 6e67 2063 6861 6e67 6573 206f 6e6c 7920  ng changes only 
+00008a40: 696e 2072 656c 6174 6564 0a72 6570 6f73  in related.repos
+00008a50: 6974 6f72 6965 7320 7669 7369 626c 6520  itories visible 
+00008a60: 746f 2061 6e20 6578 7465 726e 616c 2068  to an external h
+00008a70: 6f6f 6b2e 0a0a 2865 6d75 6c61 7465 2061  ook...(emulate a
+00008a80: 2074 7261 6e73 6163 7469 6f6e 2072 756e   transaction run
+00008a90: 6e69 6e67 2063 6f6e 6375 7272 656e 746c  ning concurrentl
+00008aa0: 7920 6279 2063 6f70 6965 640a 2e68 672f  y by copied..hg/
+00008ab0: 7374 6f72 652f 3030 6368 616e 6765 6c6f  store/00changelo
+00008ac0: 672e 692e 6120 696e 2073 7562 7365 7175  g.i.a in subsequ
+00008ad0: 656e 7420 7465 7374 290a 0a20 2024 2063  ent test)..  $ c
+00008ae0: 6174 203e 2024 5445 5354 544d 502f 7361  at > $TESTTMP/sa
+00008af0: 7665 7065 6e64 696e 672e 7368 203c 3c45  vepending.sh <<E
+00008b00: 4f46 0a20 203e 2063 7020 2e68 672f 7374  OF.  > cp .hg/st
+00008b10: 6f72 652f 3030 6368 616e 6765 6c6f 672e  ore/00changelog.
+00008b20: 692e 6120 202e 6867 2f73 746f 7265 2f30  i.a  .hg/store/0
+00008b30: 3063 6861 6e67 656c 6f67 2e69 2e61 2e73  0changelog.i.a.s
+00008b40: 6176 6564 0a20 203e 2065 7869 7420 3120  aved.  > exit 1 
+00008b50: 2320 746f 2061 766f 6964 2061 6464 696e  # to avoid addin
+00008b60: 6720 6e65 7720 7265 7669 7369 6f6e 2066  g new revision f
+00008b70: 6f72 2073 7562 7365 7175 656e 7420 7465  or subsequent te
+00008b80: 7374 730a 2020 3e20 454f 460a 2020 2420  sts.  > EOF.  $ 
+00008b90: 6364 2061 0a20 2024 2068 6720 7469 7020  cd a.  $ hg tip 
+00008ba0: 2d71 0a20 2034 3a35 3339 6534 6233 3162  -q.  4:539e4b31b
+00008bb0: 3664 630a 2020 2420 6867 202d 2d63 6f6e  6dc.  $ hg --con
+00008bc0: 6669 6720 686f 6f6b 732e 7072 6574 786e  fig hooks.pretxn
+00008bd0: 636c 6f73 653d 2273 6820 2454 4553 5454  close="sh $TESTT
+00008be0: 4d50 2f73 6176 6570 656e 6469 6e67 2e73  MP/savepending.s
+00008bf0: 6822 2063 6f6d 6d69 7420 2d6d 2022 696e  h" commit -m "in
+00008c00: 7669 7369 626c 6522 0a20 2074 7261 6e73  visible".  trans
+00008c10: 6163 7469 6f6e 2061 626f 7274 210a 2020  action abort!.  
+00008c20: 726f 6c6c 6261 636b 2063 6f6d 706c 6574  rollback complet
+00008c30: 6564 0a20 2061 626f 7274 3a20 7072 6574  ed.  abort: pret
+00008c40: 786e 636c 6f73 6520 686f 6f6b 2065 7869  xnclose hook exi
+00008c50: 7465 6420 7769 7468 2073 7461 7475 7320  ted with status 
+00008c60: 310a 2020 5b34 305d 0a20 2024 2063 7020  1.  [40].  $ cp 
+00008c70: 2e68 672f 7374 6f72 652f 3030 6368 616e  .hg/store/00chan
+00008c80: 6765 6c6f 672e 692e 612e 7361 7665 6420  gelog.i.a.saved 
+00008c90: 2e68 672f 7374 6f72 652f 3030 6368 616e  .hg/store/00chan
+00008ca0: 6765 6c6f 672e 692e 610a 0a28 6368 6563  gelog.i.a..(chec
+00008cb0: 6b20 2869 6e29 7669 7369 6269 6c69 7479  k (in)visibility
+00008cc0: 206f 6620 6e65 7720 6368 616e 6765 7365   of new changese
+00008cd0: 7420 7768 696c 6520 7472 616e 7361 6374  t while transact
+00008ce0: 696f 6e20 7275 6e6e 696e 6720 696e 0a72  ion running in.r
+00008cf0: 6570 6f29 0a0a 2020 2420 6361 7420 3e20  epo)..  $ cat > 
+00008d00: 2454 4553 5454 4d50 2f63 6865 636b 7065  $TESTTMP/checkpe
+00008d10: 6e64 696e 672e 7368 203c 3c45 4f46 0a20  nding.sh <<EOF. 
+00008d20: 203e 2065 6368 6f20 2740 6127 0a20 203e   > echo '@a'.  >
+00008d30: 2068 6720 2d52 2022 2454 4553 5454 4d50   hg -R "$TESTTMP
+00008d40: 2f61 2220 7469 7020 2d71 0a20 203e 2065  /a" tip -q.  > e
+00008d50: 6368 6f20 2740 612f 6e65 7374 6564 270a  cho '@a/nested'.
+00008d60: 2020 3e20 6867 202d 5220 2224 5445 5354    > hg -R "$TEST
+00008d70: 544d 502f 612f 6e65 7374 6564 2220 7469  TMP/a/nested" ti
+00008d80: 7020 2d71 0a20 203e 2065 7869 7420 3120  p -q.  > exit 1 
+00008d90: 2320 746f 2061 766f 6964 2061 6464 696e  # to avoid addin
+00008da0: 6720 6e65 7720 7265 7669 7369 6f6e 2066  g new revision f
+00008db0: 6f72 2073 7562 7365 7175 656e 7420 7465  or subsequent te
+00008dc0: 7374 730a 2020 3e20 454f 460a 2020 2420  sts.  > EOF.  $ 
+00008dd0: 6867 2069 6e69 7420 6e65 7374 6564 0a20  hg init nested. 
+00008de0: 2024 2063 6420 6e65 7374 6564 0a20 2024   $ cd nested.  $
+00008df0: 2065 6368 6f20 6120 3e20 610a 2020 2420   echo a > a.  $ 
+00008e00: 6867 2061 6464 2061 0a20 2024 2068 6720  hg add a.  $ hg 
+00008e10: 2d2d 636f 6e66 6967 2068 6f6f 6b73 2e70  --config hooks.p
+00008e20: 7265 7478 6e63 6c6f 7365 3d22 7368 2024  retxnclose="sh $
+00008e30: 5445 5354 544d 502f 6368 6563 6b70 656e  TESTTMP/checkpen
+00008e40: 6469 6e67 2e73 6822 2063 6f6d 6d69 7420  ding.sh" commit 
+00008e50: 2d6d 2027 2330 270a 2020 4061 0a20 2034  -m '#0'.  @a.  4
+00008e60: 3a35 3339 6534 6233 3162 3664 630a 2020  :539e4b31b6dc.  
+00008e70: 4061 2f6e 6573 7465 640a 2020 303a 6266  @a/nested.  0:bf
+00008e80: 3565 3339 3563 6564 3263 0a20 2074 7261  5e395ced2c.  tra
+00008e90: 6e73 6163 7469 6f6e 2061 626f 7274 210a  nsaction abort!.
+00008ea0: 2020 726f 6c6c 6261 636b 2063 6f6d 706c    rollback compl
+00008eb0: 6574 6564 0a20 2061 626f 7274 3a20 7072  eted.  abort: pr
+00008ec0: 6574 786e 636c 6f73 6520 686f 6f6b 2065  etxnclose hook e
+00008ed0: 7869 7465 6420 7769 7468 2073 7461 7475  xited with statu
+00008ee0: 7320 310a 2020 5b34 305d 0a0a 486f 6f6b  s 1.  [40]..Hook
+00008ef0: 2066 726f 6d20 756e 7472 7573 7465 6420   from untrusted 
+00008f00: 6867 7263 2061 7265 2072 6570 6f72 7465  hgrc are reporte
+00008f10: 6420 6173 2066 6169 6c75 7265 0a3d 3d3d  d as failure.===
+00008f20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00008f30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00008f40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 0a20  =============.. 
+00008f50: 2024 2063 6174 203c 3c20 454f 4620 3e20   $ cat << EOF > 
+00008f60: 2454 4553 5454 4d50 2f75 6e74 7275 7374  $TESTTMP/untrust
+00008f70: 6564 2e70 790a 2020 3e20 6672 6f6d 206d  ed.py.  > from m
+00008f80: 6572 6375 7269 616c 2069 6d70 6f72 7420  ercurial import 
+00008f90: 7363 6d75 7469 6c2c 2075 7469 6c0a 2020  scmutil, util.  
+00008fa0: 3e20 6465 6620 7569 7365 7475 7028 7569  > def uisetup(ui
+00008fb0: 293a 0a20 203e 2020 2020 2063 6c61 7373  ):.  >     class
+00008fc0: 2075 6e74 7275 7374 6564 7569 2875 692e   untrustedui(ui.
+00008fd0: 5f5f 636c 6173 735f 5f29 3a0a 2020 3e20  __class__):.  > 
+00008fe0: 2020 2020 2020 2020 6465 6620 5f74 7275          def _tru
+00008ff0: 7374 6564 2873 656c 662c 2066 702c 2066  sted(self, fp, f
+00009000: 293a 0a20 203e 2020 2020 2020 2020 2020  ):.  >          
+00009010: 2020 2069 6620 7574 696c 2e6e 6f72 6d70     if util.normp
+00009020: 6174 6828 6670 2e6e 616d 6529 2e65 6e64  ath(fp.name).end
+00009030: 7377 6974 6828 6227 756e 7472 7573 7465  swith(b'untruste
+00009040: 642f 2e68 672f 6867 7263 2729 3a0a 2020  d/.hg/hgrc'):.  
+00009050: 3e20 2020 2020 2020 2020 2020 2020 2020  >               
+00009060: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+00009070: 203e 2020 2020 2020 2020 2020 2020 2072   >             r
+00009080: 6574 7572 6e20 7375 7065 7228 756e 7472  eturn super(untr
+00009090: 7573 7465 6475 692c 2073 656c 6629 2e5f  ustedui, self)._
+000090a0: 7472 7573 7465 6428 6670 2c20 6629 0a20  trusted(fp, f). 
+000090b0: 203e 2020 2020 2075 692e 5f5f 636c 6173   >     ui.__clas
+000090c0: 735f 5f20 3d20 756e 7472 7573 7465 6475  s__ = untrustedu
+000090d0: 690a 2020 3e20 454f 460a 2020 2420 6361  i.  > EOF.  $ ca
+000090e0: 7420 3c3c 2045 4f46 203e 3e20 2448 4752  t << EOF >> $HGR
+000090f0: 4350 4154 480a 2020 3e20 5b65 7874 656e  CPATH.  > [exten
+00009100: 7369 6f6e 735d 0a20 203e 2075 6e74 7275  sions].  > untru
+00009110: 7374 6564 3d24 5445 5354 544d 502f 756e  sted=$TESTTMP/un
+00009120: 7472 7573 7465 642e 7079 0a20 203e 2045  trusted.py.  > E
+00009130: 4f46 0a20 2024 2068 6720 696e 6974 2075  OF.  $ hg init u
+00009140: 6e74 7275 7374 6564 0a20 2024 2063 6420  ntrusted.  $ cd 
+00009150: 756e 7472 7573 7465 640a 0a4e 6f6e 2d62  untrusted..Non-b
+00009160: 6c6f 636b 696e 6720 686f 6f6b 0a2d 2d2d  locking hook.---
+00009170: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a0a  --------------..
+00009180: 2020 2420 6361 7420 3c3c 2045 4f46 203e    $ cat << EOF >
+00009190: 3e20 2e68 672f 6867 7263 0a20 203e 205b  > .hg/hgrc.  > [
+000091a0: 686f 6f6b 735d 0a20 203e 2074 786e 636c  hooks].  > txncl
+000091b0: 6f73 652e 7465 7374 696e 673d 6563 686f  ose.testing=echo
+000091c0: 2074 786e 636c 6f73 6520 686f 6f6b 2063   txnclose hook c
+000091d0: 616c 6c65 640a 2020 3e20 454f 460a 2020  alled.  > EOF.  
+000091e0: 2420 746f 7563 6820 6120 2626 2068 6720  $ touch a && hg 
+000091f0: 636f 6d6d 6974 202d 4171 6d20 610a 2020  commit -Aqm a.  
+00009200: 7761 726e 696e 673a 2075 6e74 7275 7374  warning: untrust
+00009210: 6564 2068 6f6f 6b20 7478 6e63 6c6f 7365  ed hook txnclose
+00009220: 2e74 6573 7469 6e67 206e 6f74 2065 7865  .testing not exe
+00009230: 6375 7465 640a 2020 2420 6867 206c 6f67  cuted.  $ hg log
+00009240: 0a20 2063 6861 6e67 6573 6574 3a20 2020  .  changeset:   
+00009250: 303a 3339 3033 3737 3531 3736 6564 0a20  0:3903775176ed. 
+00009260: 2074 6167 3a20 2020 2020 2020 2020 7469   tag:         ti
+00009270: 700a 2020 7573 6572 3a20 2020 2020 2020  p.  user:       
+00009280: 2074 6573 740a 2020 6461 7465 3a20 2020   test.  date:   
+00009290: 2020 2020 2054 6875 204a 616e 2030 3120       Thu Jan 01 
+000092a0: 3030 3a30 303a 3030 2031 3937 3020 2b30  00:00:00 1970 +0
+000092b0: 3030 300a 2020 7375 6d6d 6172 793a 2020  000.  summary:  
+000092c0: 2020 2061 0a20 200a 0a4e 6f6e 2d62 6c6f     a.  ..Non-blo
+000092d0: 636b 696e 6720 686f 6f6b 0a2d 2d2d 2d2d  cking hook.-----
+000092e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a0a 2020  ------------..  
+000092f0: 2420 6361 7420 3c3c 2045 4f46 203e 3e20  $ cat << EOF >> 
+00009300: 2e68 672f 6867 7263 0a20 203e 205b 686f  .hg/hgrc.  > [ho
+00009310: 6f6b 735d 0a20 203e 2070 7265 7478 6e63  oks].  > pretxnc
+00009320: 6c6f 7365 2e74 6573 7469 6e67 3d65 6368  lose.testing=ech
+00009330: 6f20 7072 652d 7478 6e63 6c6f 7365 2068  o pre-txnclose h
+00009340: 6f6f 6b20 6361 6c6c 6564 0a20 203e 2045  ook called.  > E
+00009350: 4f46 0a20 2024 2074 6f75 6368 2062 2026  OF.  $ touch b &
+00009360: 2620 6867 2063 6f6d 6d69 7420 2d41 716d  & hg commit -Aqm
+00009370: 2061 0a20 2074 7261 6e73 6163 7469 6f6e   a.  transaction
+00009380: 2061 626f 7274 210a 2020 726f 6c6c 6261   abort!.  rollba
+00009390: 636b 2063 6f6d 706c 6574 6564 0a20 2061  ck completed.  a
+000093a0: 626f 7274 3a20 756e 7472 7573 7465 6420  bort: untrusted 
+000093b0: 686f 6f6b 2070 7265 7478 6e63 6c6f 7365  hook pretxnclose
+000093c0: 2e74 6573 7469 6e67 206e 6f74 2065 7865  .testing not exe
+000093d0: 6375 7465 640a 2020 2873 6565 2027 6867  cuted.  (see 'hg
+000093e0: 2068 656c 7020 636f 6e66 6967 2e74 7275   help config.tru
+000093f0: 7374 6564 2729 0a20 205b 3430 5d0a 2020  sted').  [40].  
+00009400: 2420 6867 206c 6f67 0a20 2063 6861 6e67  $ hg log.  chang
+00009410: 6573 6574 3a20 2020 303a 3339 3033 3737  eset:   0:390377
+00009420: 3531 3736 6564 0a20 2074 6167 3a20 2020  5176ed.  tag:   
+00009430: 2020 2020 2020 7469 700a 2020 7573 6572        tip.  user
+00009440: 3a20 2020 2020 2020 2074 6573 740a 2020  :        test.  
+00009450: 6461 7465 3a20 2020 2020 2020 2054 6875  date:        Thu
+00009460: 204a 616e 2030 3120 3030 3a30 303a 3030   Jan 01 00:00:00
+00009470: 2031 3937 3020 2b30 3030 300a 2020 7375   1970 +0000.  su
+00009480: 6d6d 6172 793a 2020 2020 2061 0a20 200a  mmary:     a.  .
+00009490: 0a75 6e73 6574 7570 2074 6865 2074 6573  .unsetup the tes
+000094a0: 740a 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  t.--------------
+000094b0: 2d2d 0a0a 2320 746f 7563 6820 7468 6520  --..# touch the 
+000094c0: 6669 6c65 2074 6f20 756e 636f 6e66 7573  file to unconfus
+000094d0: 6520 6368 6720 7769 7468 2061 2064 6966  e chg with a dif
+000094e0: 6672 656e 7420 6d74 696d 650a 2020 2420  frent mtime.  $ 
+000094f0: 736c 6565 7020 310a 2020 2420 746f 7563  sleep 1.  $ touc
+00009500: 6820 2454 4553 5454 4d50 2f75 6e74 7275  h $TESTTMP/untru
+00009510: 7374 6564 2e70 790a 2020 2420 6361 7420  sted.py.  $ cat 
+00009520: 3c3c 2045 4f46 203e 3e20 2448 4752 4350  << EOF >> $HGRCP
+00009530: 4154 480a 2020 3e20 5b65 7874 656e 7369  ATH.  > [extensi
+00009540: 6f6e 735d 0a20 203e 2075 6e74 7275 7374  ons].  > untrust
+00009550: 6564 3d21 0a20 203e 2045 4f46 0a0a 4847  ed=!.  > EOF..HG
+00009560: 504c 4149 4e20 7365 7474 696e 6720 696e  PLAIN setting in
+00009570: 2068 6f6f 6b73 0a3d 3d3d 3d3d 3d3d 3d3d   hooks.=========
+00009580: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
+00009590: 0a20 2024 2063 6174 203c 3c20 454f 4620  .  $ cat << EOF 
+000095a0: 3e3e 202e 6867 2f68 6772 630a 2020 3e20  >> .hg/hgrc.  > 
+000095b0: 5b68 6f6f 6b73 5d0a 2020 3e20 7072 652d  [hooks].  > pre-
+000095c0: 7665 7273 696f 6e2e 7465 7374 696e 672d  version.testing-
+000095d0: 6465 6661 756c 743d 7368 202d 6320 2265  default=sh -c "e
+000095e0: 6368 6f20 2723 2323 2064 6566 6175 6c74  cho '### default
+000095f0: 2023 2323 2720 706c 6169 6e3a 205c 247b   ###' plain: \${
+00009600: 4847 504c 4149 4e3a 2d27 3c75 6e73 6574  HGPLAIN:-'<unset
+00009610: 3e27 7d22 0a20 203e 2070 7265 2d76 6572  >'}".  > pre-ver
+00009620: 7369 6f6e 2e74 6573 7469 6e67 2d79 6573  sion.testing-yes
+00009630: 3d73 6820 2d63 2022 6563 686f 2027 2323  =sh -c "echo '##
+00009640: 2320 7965 7320 2323 2323 2323 2327 2070  # yes #######' p
+00009650: 6c61 696e 3a20 5c24 7b48 4750 4c41 494e  lain: \${HGPLAIN
+00009660: 3a2d 273c 756e 7365 743e 277d 220a 2020  :-'<unset>'}".  
+00009670: 3e20 7072 652d 7665 7273 696f 6e2e 7465  > pre-version.te
+00009680: 7374 696e 672d 7965 733a 7275 6e2d 7769  sting-yes:run-wi
+00009690: 7468 2d70 6c61 696e 3d79 6573 0a20 203e  th-plain=yes.  >
+000096a0: 2070 7265 2d76 6572 7369 6f6e 2e74 6573   pre-version.tes
+000096b0: 7469 6e67 2d6e 6f3d 7368 202d 6320 2265  ting-no=sh -c "e
+000096c0: 6368 6f20 2723 2323 206e 6f20 2323 2323  cho '### no ####
+000096d0: 2323 2323 2720 706c 6169 6e3a 205c 247b  ####' plain: \${
+000096e0: 4847 504c 4149 4e3a 2d27 3c75 6e73 6574  HGPLAIN:-'<unset
+000096f0: 3e27 7d22 0a20 203e 2070 7265 2d76 6572  >'}".  > pre-ver
+00009700: 7369 6f6e 2e74 6573 7469 6e67 2d6e 6f3a  sion.testing-no:
+00009710: 7275 6e2d 7769 7468 2d70 6c61 696e 3d6e  run-with-plain=n
+00009720: 6f0a 2020 3e20 7072 652d 7665 7273 696f  o.  > pre-versio
+00009730: 6e2e 7465 7374 696e 672d 6175 746f 3d73  n.testing-auto=s
+00009740: 6820 2d63 2022 6563 686f 2027 2323 2320  h -c "echo '### 
+00009750: 6175 746f 2023 2323 2323 2327 2070 6c61  auto ######' pla
+00009760: 696e 3a20 5c24 7b48 4750 4c41 494e 3a2d  in: \${HGPLAIN:-
+00009770: 273c 756e 7365 743e 277d 220a 2020 3e20  '<unset>'}".  > 
+00009780: 7072 652d 7665 7273 696f 6e2e 7465 7374  pre-version.test
+00009790: 696e 672d 6175 746f 3a72 756e 2d77 6974  ing-auto:run-wit
+000097a0: 682d 706c 6169 6e3d 6175 746f 0a20 203e  h-plain=auto.  >
+000097b0: 2045 4f46 0a0a 2020 2420 2875 6e73 6574   EOF..  $ (unset
+000097c0: 2048 4750 4c41 494e 3b20 6867 2076 6572   HGPLAIN; hg ver
+000097d0: 7369 6f6e 202d 2d71 7569 6574 290a 2020  sion --quiet).  
+000097e0: 2323 2320 6465 6661 756c 7420 2323 2320  ### default ### 
+000097f0: 706c 6169 6e3a 2031 0a20 2023 2323 2079  plain: 1.  ### y
+00009800: 6573 2023 2323 2323 2323 2070 6c61 696e  es ####### plain
+00009810: 3a20 310a 2020 2323 2320 6e6f 2023 2323  : 1.  ### no ###
+00009820: 2323 2323 2320 706c 6169 6e3a 203c 756e  ##### plain: <un
+00009830: 7365 743e 0a20 2023 2323 2061 7574 6f20  set>.  ### auto 
+00009840: 2323 2323 2323 2070 6c61 696e 3a20 3c75  ###### plain: <u
+00009850: 6e73 6574 3e0a 2020 4d65 7263 7572 6961  nset>.  Mercuria
+00009860: 6c20 4469 7374 7269 6275 7465 6420 5343  l Distributed SC
+00009870: 4d20 282a 2920 2867 6c6f 6229 0a0a 2020  M (*) (glob)..  
+00009880: 2420 4847 504c 4149 4e3d 3120 6867 2076  $ HGPLAIN=1 hg v
+00009890: 6572 7369 6f6e 202d 2d71 7569 6574 0a20  ersion --quiet. 
+000098a0: 2023 2323 2064 6566 6175 6c74 2023 2323   ### default ###
+000098b0: 2070 6c61 696e 3a20 310a 2020 2323 2320   plain: 1.  ### 
+000098c0: 7965 7320 2323 2323 2323 2320 706c 6169  yes ####### plai
+000098d0: 6e3a 2031 0a20 2023 2323 206e 6f20 2323  n: 1.  ### no ##
+000098e0: 2323 2323 2323 2070 6c61 696e 3a20 3c75  ###### plain: <u
+000098f0: 6e73 6574 3e0a 2020 2323 2320 6175 746f  nset>.  ### auto
+00009900: 2023 2323 2323 2320 706c 6169 6e3a 2031   ###### plain: 1
+00009910: 0a20 204d 6572 6375 7269 616c 2044 6973  .  Mercurial Dis
+00009920: 7472 6962 7574 6564 2053 434d 2028 2a29  tributed SCM (*)
+00009930: 2028 676c 6f62 290a 0a54 6573 7420 686f   (glob)..Test ho
+00009940: 6f6b 2074 6861 7420 6368 616e 6765 2074  ok that change t
+00009950: 6865 2075 6e64 6572 6c79 696e 6720 7265  he underlying re
+00009960: 706f 0a3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  po.=============
+00009970: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00009980: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a 626c  ============..bl
+00009990: 6163 6b62 6f78 2061 6363 6573 7320 7468  ackbox access th
+000099a0: 6520 6469 7273 7461 7465 2061 6674 6572  e dirstate after
+000099b0: 7761 7264 2061 6e64 2063 616e 2073 6565  ward and can see
+000099c0: 2061 2063 6861 6e67 656c 6f67 202f 2064   a changelog / d
+000099d0: 6972 7374 6174 650a 6465 7379 6e63 2e0a  irstate.desync..
+000099e0: 0a0a 2020 2420 6364 2024 5445 5354 544d  ..  $ cd $TESTTM
+000099f0: 500a 2020 2420 6361 7420 3c3c 454f 4620  P.  $ cat <<EOF 
+00009a00: 3e3e 2024 4847 5243 5041 5448 0a20 203e  >> $HGRCPATH.  >
+00009a10: 205b 6578 7465 6e73 696f 6e73 5d0a 2020   [extensions].  
+00009a20: 3e20 626c 6163 6b62 6f78 3d0a 2020 3e20  > blackbox=.  > 
+00009a30: 5b68 6f6f 6b73 5d0a 2020 3e20 706f 7374  [hooks].  > post
+00009a40: 2d6d 6572 6765 203d 2068 6720 636f 6d6d  -merge = hg comm
+00009a50: 6974 202d 6d20 2261 7574 6f20 6d65 7267  it -m "auto merg
+00009a60: 6522 0a20 203e 2045 4f46 0a0a 2020 2420  e".  > EOF..  $ 
+00009a70: 6867 2069 6e69 7420 740a 2020 2420 6364  hg init t.  $ cd
+00009a80: 2074 0a20 2024 2074 6f75 6368 2022 2e68   t.  $ touch ".h
+00009a90: 6769 676e 6f72 6522 0a20 2024 2068 6720  gignore".  $ hg 
+00009aa0: 636f 6d6d 6974 202d 416d 2022 696e 6974  commit -Am "init
+00009ab0: 6961 6c22 202d 6427 3020 3027 0a20 2061  ial" -d'0 0'.  a
+00009ac0: 6464 696e 6720 2e68 6769 676e 6f72 650a  dding .hgignore.
+00009ad0: 0a20 2024 2065 6368 6f20 5468 6973 2069  .  $ echo This i
+00009ae0: 7320 6669 6c65 2061 3120 3e20 610a 2020  s file a1 > a.  
+00009af0: 2420 6867 2063 6f6d 6d69 7420 2d41 6d20  $ hg commit -Am 
+00009b00: 2263 6f6d 6d69 7420 2331 2220 2d64 2730  "commit #1" -d'0
+00009b10: 2030 270a 2020 6164 6469 6e67 2061 0a0a   0'.  adding a..
+00009b20: 2020 2420 6867 2075 7064 6174 6520 300a    $ hg update 0.
+00009b30: 2020 3020 6669 6c65 7320 7570 6461 7465    0 files update
+00009b40: 642c 2030 2066 696c 6573 206d 6572 6765  d, 0 files merge
+00009b50: 642c 2031 2066 696c 6573 2072 656d 6f76  d, 1 files remov
+00009b60: 6564 2c20 3020 6669 6c65 7320 756e 7265  ed, 0 files unre
+00009b70: 736f 6c76 6564 0a20 2024 2065 6368 6f20  solved.  $ echo 
+00009b80: 5468 6973 2069 7320 6669 6c65 2062 3120  This is file b1 
+00009b90: 3e20 620a 2020 2420 6867 2063 6f6d 6d69  > b.  $ hg commi
+00009ba0: 7420 2d41 6d20 2263 6f6d 6d69 7420 2332  t -Am "commit #2
+00009bb0: 2220 2d64 2730 2030 270a 2020 6164 6469  " -d'0 0'.  addi
+00009bc0: 6e67 2062 0a20 2063 7265 6174 6564 206e  ng b.  created n
+00009bd0: 6577 2068 6561 640a 0a20 2024 2068 6720  ew head..  $ hg 
+00009be0: 6d65 7267 6520 310a 2020 3120 6669 6c65  merge 1.  1 file
+00009bf0: 7320 7570 6461 7465 642c 2030 2066 696c  s updated, 0 fil
+00009c00: 6573 206d 6572 6765 642c 2030 2066 696c  es merged, 0 fil
+00009c10: 6573 2072 656d 6f76 6564 2c20 3020 6669  es removed, 0 fi
+00009c20: 6c65 7320 756e 7265 736f 6c76 6564 0a20  les unresolved. 
+00009c30: 2028 6272 616e 6368 206d 6572 6765 2c20   (branch merge, 
+00009c40: 646f 6e27 7420 666f 7267 6574 2074 6f20  don't forget to 
+00009c50: 636f 6d6d 6974 290a 0a20 2024 2063 6420  commit)..  $ cd 
+00009c60: 2e2e 0a                                  ...
```

### Comparing `mercurial-6.4rc0/tests/test-hooklib-changeset_obsoleted.t` & `mercurial-6.5rc0/tests/test-hooklib-changeset_obsoleted.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hooklib-changeset_published.t` & `mercurial-6.5rc0/tests/test-hooklib-changeset_published.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hooklib-enforce_draft_commits.t` & `mercurial-6.5rc0/tests/test-hooklib-enforce_draft_commits.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hooklib-reject_merge_commits.t` & `mercurial-6.5rc0/tests/test-hooklib-reject_merge_commits.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-hooklib-reject_new_heads.t` & `mercurial-6.5rc0/tests/test-hooklib-reject_new_heads.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-http-bad-server.t` & `mercurial-6.5rc0/tests/test-http-bad-server.t`

 * *Files 18% similar despite different names*

```diff
@@ -126,18 +126,16 @@
   $ cat error.log
   readline(~) -> (33) GET /?cmd=capabilities HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (*) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (py36 !)
-  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (py36 !)
-  write(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (no-py36 !)
-  write(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (no-py36 !)
+  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob)
+  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob)
   readline(~) -> (26) GET /?cmd=batch HTTP/1.1\r\n (glob)
   readline(*) -> (1?) Accept-Encoding* (glob)
   read limit reached; closing socket
   readline(~) -> (26) GET /?cmd=batch HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
   readline(*) -> (41) x-hgarg-1: cmds=heads+%3Bknown+nodes%3D\r\n (glob)
@@ -149,15 +147,15 @@
   $ rm -f error.log
 
 Failure to read getbundle HTTP request
 --------------------------------------
 
   $ hg serve \
   > --config badserver.close-after-recv-patterns="GET /\?cmd=batch,user-agent: mercurial/proto-1.0,GET /\?cmd=getbundle" \
-  > --config badserver.close-after-recv-bytes=110,26,274 \
+  > --config badserver.close-after-recv-bytes=110,26,281 \
   > -p $HGPORT -d --pid-file=hg.pid -E error.log
   $ cat hg.pid > $DAEMON_PIDS
   $ hg clone http://localhost:$HGPORT/ clone
   requesting all changes
   abort: error: bad HTTP status line: * (glob)
   [100]
 
@@ -168,18 +166,16 @@
   readline(1 from -1) -> (1) x (?)
   readline(~) -> (33) GET /?cmd=capabilities HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (*) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (py36 !)
-  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (py36 !)
-  write(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (no-py36 !)
-  write(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (no-py36 !)
+  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob)
+  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob)
   readline(~) -> (26) GET /?cmd=batch HTTP/1.1\r\n (glob)
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
   readline(*) -> (41) x-hgarg-1: cmds=heads+%3Bknown+nodes%3D\r\n (glob)
   readline(*) -> (1?) x-hgproto-1:* (glob)
   read limit reached; closing socket
   readline(~) -> (26) GET /?cmd=batch HTTP/1.1\r\n
@@ -187,24 +183,22 @@
   readline(*) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
   readline(*) -> (41) x-hgarg-1: cmds=heads+%3Bknown+nodes%3D\r\n (glob)
   readline(*) -> (61) x-hgproto-1: 0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (*) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n (py36 !)
-  sendall(42) -> 96ee1d7354c4ad7372047672c36a1f561e3a6a4c\n; (py36 !)
-  write(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n (no-py36 !)
-  write(42) -> 96ee1d7354c4ad7372047672c36a1f561e3a6a4c\n; (no-py36 !)
+  sendall(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n
+  sendall(42) -> 96ee1d7354c4ad7372047672c36a1f561e3a6a4c\n;
   readline(24 from ~) -> (*) GET /?cmd=getbundle HTTP* (glob)
   read limit reached; closing socket
   readline(~) -> (30) GET /?cmd=getbundle HTTP/1.1\r\n
-  readline(274 from *) -> (27) Accept-Encoding: identity\r\n (glob)
-  readline(247 from *) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
-  readline(218 from *) -> (218) x-hgarg-1: bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtag (glob)
+  readline(281 from *) -> (27) Accept-Encoding: identity\r\n (glob)
+  readline(254 from *) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
+  readline(225 from *) -> (225) x-hgarg-1: bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtag (glob)
   read limit reached; closing socket
 
   $ rm -f error.log
 
 Now do a variation using POST to send arguments
 ===============================================
 
@@ -224,18 +218,16 @@
   $ cat error.log | "$PYTHON" $TESTDIR/filtertraceback.py
   readline(~) -> (33) GET /?cmd=capabilities HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (py36 !)
-  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx httppostargs known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (py36 !)
-  write(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (no-py36 !)
-  write(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx httppostargs known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (no-py36 !)
+  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob)
+  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx httppostargs known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob)
   readline(~) -> (27) POST /?cmd=batch HTTP/1.1\r\n (glob)
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (41) content-type: application/mercurial-0.1\r\n (glob)
   readline(*) -> (33) vary: X-HgArgs-Post,X-HgProto-1\r\n (glob)
   readline(*) -> (19) x-hgargs-post: 28\r\n (glob)
   readline(*) -> (1?) x-hgproto-1: * (glob)
   read limit reached; closing socket
@@ -252,15 +244,14 @@
   readline(*) -> (2) \r\n (glob)
   read(24 from 28) -> (*) cmds=* (glob)
   read limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=batch': (glob)
   Traceback (most recent call last):
   Exception: connection closed after receiving N bytes
   
-  write(126) -> HTTP/1.1 500 Internal Server Error\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nTransfer-Encoding: chunked\r\n\r\n (no-py36 !)
 
   $ rm -f error.log
 
 Now move on to partial server responses
 =======================================
 
 Server sends a single character from the HTTP response line
@@ -278,22 +269,20 @@
   $ cat error.log | "$PYTHON" $TESTDIR/filtertraceback.py
   readline(~) -> (33) GET /?cmd=capabilities HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(1 from 160) -> (0) H (py36 !)
-  write(1 from 160) -> (0) H (no-py36 !)
+  sendall(1 from 160) -> (0) H
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=capabilities': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-  write(286) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\nHTTP/1.1 500 Internal Server Error\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nTransfer-Encoding: chunked\r\n\r\n (glob) (no-py36 !)
 
   $ rm -f error.log
 
 Server sends an incomplete capabilities response body
 -----------------------------------------------------
 
   $ hg serve \
@@ -311,18 +300,16 @@
   $ cat error.log | "$PYTHON" $TESTDIR/filtertraceback.py
   readline(~) -> (33) GET /?cmd=capabilities HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (py36 !)
-  sendall(20 from *) -> (0) batch branchmap bund (glob) (py36 !)
-  write(160) -> (20) HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (no-py36 !)
-  write(20 from *) -> (0) batch branchmap bund (glob) (no-py36 !)
+  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob)
+  sendall(20 from *) -> (0) batch branchmap bund (glob)
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=capabilities': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
 
   $ rm -f error.log
@@ -350,35 +337,31 @@
   $ cat error.log | "$PYTHON" $TESTDIR/filtertraceback.py
   readline(~) -> (33) GET /?cmd=capabilities HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (py36 !)
-  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (py36 !)
-  write(160) -> (568) HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (no-py36 !)
-  write(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (no-py36 !)
+  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob)
+  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob)
   readline(~) -> (26) GET /?cmd=batch HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
   readline(*) -> (41) x-hgarg-1: cmds=heads+%3Bknown+nodes%3D\r\n (glob)
   readline(*) -> (61) x-hgproto-1: 0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(118 from 159) -> (0) HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: applicat (py36 !)
-  write(118 from 159) -> (0) HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: applicat (no-py36 !)
+  sendall(118 from 159) -> (0) HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: applicat
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=batch': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-  write(285) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\nHTTP/1.1 500 Internal Server Error\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nTransfer-Encoding: chunked\r\n\r\n (no-py36 !)
 
   $ rm -f error.log
 
 Server sends an incomplete HTTP response body to batch request
 --------------------------------------------------------------
 
   $ hg serve \
@@ -396,31 +379,27 @@
   $ cat error.log | "$PYTHON" $TESTDIR/filtertraceback.py
   readline(~) -> (33) GET /?cmd=capabilities HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (py36 !)
-  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (py36 !)
-  write(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (no-py36 !)
-  write(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (no-py36 !)
+  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob)
+  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob)
   readline(~) -> (26) GET /?cmd=batch HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
   readline(*) -> (41) x-hgarg-1: cmds=heads+%3Bknown+nodes%3D\r\n (glob)
   readline(*) -> (61) x-hgproto-1: 0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n (py36 !)
-  sendall(24 from 42) -> (0) 96ee1d7354c4ad7372047672 (py36 !)
-  write(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n (no-py36 !)
-  write(24 from 42) -> (0) 96ee1d7354c4ad7372047672 (no-py36 !)
+  sendall(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n
+  sendall(24 from 42) -> (0) 96ee1d7354c4ad7372047672
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=batch': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
 
   $ rm -f error.log
@@ -449,48 +428,42 @@
   $ cat error.log | "$PYTHON" $TESTDIR/filtertraceback.py
   readline(~) -> (33) GET /?cmd=capabilities HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (py36 !)
-  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (py36 !)
-  write(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (no-py36 !)
-  write(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (no-py36 !)
+  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob)
+  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob)
   readline(~) -> (26) GET /?cmd=batch HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
   readline(*) -> (41) x-hgarg-1: cmds=heads+%3Bknown+nodes%3D\r\n (glob)
   readline(*) -> (61) x-hgproto-1: 0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n (py36 !)
-  sendall(42) -> 96ee1d7354c4ad7372047672c36a1f561e3a6a4c\n; (py36 !)
-  write(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n (no-py36 !)
-  write(42) -> 96ee1d7354c4ad7372047672c36a1f561e3a6a4c\n; (no-py36 !)
+  sendall(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n
+  sendall(42) -> 96ee1d7354c4ad7372047672c36a1f561e3a6a4c\n;
   readline(~) -> (30) GET /?cmd=getbundle HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
-  readline(*) -> (440) x-hgarg-1: bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps%250Astream%253Dv2&cg=1&common=0000000000000000000000000000000000000000&heads=96ee1d7354c4ad7372047672c36a1f561e3a6a4c&listkeys=phases%2Cbookmarks\r\n (glob)
+  readline(*) -> (447) x-hgarg-1: bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps%250Astream%253Dv2&cg=1&common=0000000000000000000000000000000000000000&heads=96ee1d7354c4ad7372047672c36a1f561e3a6a4c&listkeys=phases%2Cbookmarks\r\n (glob)
   readline(*) -> (61) x-hgproto-1: 0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(129 from 167) -> (0) HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercuri (py36 !)
-  write(129 from 167) -> (0) HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercuri (no-py36 !)
+  sendall(129 from 167) -> (0) HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercuri
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-  write(293) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\nHTTP/1.1 500 Internal Server Error\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nTransfer-Encoding: chunked\r\n\r\n (no-py36 !)
 
   $ rm -f error.log
 
 Server stops before it sends transfer encoding
 ----------------------------------------------
 
   $ hg serve \
@@ -501,35 +474,21 @@
   $ hg clone http://localhost:$HGPORT/ clone
   requesting all changes
   abort: stream ended unexpectedly (got 0 bytes, expected 1)
   [255]
 
   $ killdaemons.py $DAEMON_PIDS
 
-#if py36
   $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -6
   sendall(162 from 167) -> (0) HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunke
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-
-#else
-  $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -7
-  write(41) -> Content-Type: application/mercurial-0.2\r\n
-  write(25 from 28) -> (0) Transfer-Encoding: chunke
-  write limit reached; closing socket
-  $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
-  Traceback (most recent call last):
-  Exception: connection closed after sending N bytes
-  write(293) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\nHTTP/1.1 500 Internal Server Error\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nTransfer-Encoding: chunked\r\n\r\n
-  
-#endif
-
   $ rm -f error.log
 
 Server sends empty HTTP body for getbundle
 ------------------------------------------
 
   $ hg serve \
   > --config badserver.close-after-send-patterns='Transfer-Encoding: chunked\r\n\r\n' \
@@ -547,48 +506,42 @@
   $ cat error.log | "$PYTHON" $TESTDIR/filtertraceback.py
   readline(~) -> (33) GET /?cmd=capabilities HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (py36 !)
-  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (py36 !)
-  write(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (no-py36 !)
-  write(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (no-py36 !)
+  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob)
+  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob)
   readline(~) -> (26) GET /?cmd=batch HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
   readline(*) -> (41) x-hgarg-1: cmds=heads+%3Bknown+nodes%3D\r\n (glob)
   readline(*) -> (61) x-hgproto-1: 0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n (py36 !)
-  sendall(42) -> 96ee1d7354c4ad7372047672c36a1f561e3a6a4c\n; (py36 !)
-  write(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n (no-py36 !)
-  write(42) -> 96ee1d7354c4ad7372047672c36a1f561e3a6a4c\n; (no-py36 !)
+  sendall(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n
+  sendall(42) -> 96ee1d7354c4ad7372047672c36a1f561e3a6a4c\n;
   readline(~) -> (30) GET /?cmd=getbundle HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
-  readline(*) -> (440) x-hgarg-1: bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps%250Astream%253Dv2&cg=1&common=0000000000000000000000000000000000000000&heads=96ee1d7354c4ad7372047672c36a1f561e3a6a4c&listkeys=phases%2Cbookmarks\r\n (glob)
+  readline(*) -> (447) x-hgarg-1: bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps%250Astream%253Dv2&cg=1&common=0000000000000000000000000000000000000000&heads=96ee1d7354c4ad7372047672c36a1f561e3a6a4c&listkeys=phases%2Cbookmarks\r\n (glob)
   readline(*) -> (61) x-hgproto-1: 0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(167 from 167) -> (0) HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n (py36 !)
-  write(167 from 167) -> (0) HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n (no-py36 !)
+  sendall(167 from 167) -> (0) HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-  write(293) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\nHTTP/1.1 500 Internal Server Error\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nTransfer-Encoding: chunked\r\n\r\n (no-py36 !)
 
   $ rm -f error.log
 
 Server sends partial compression string
 ---------------------------------------
 
   $ hg serve \
@@ -607,44 +560,40 @@
   $ cat error.log | "$PYTHON" $TESTDIR/filtertraceback.py
   readline(~) -> (33) GET /?cmd=capabilities HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (py36 !)
-  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (py36 !)
-  write(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob) (no-py36 !)
-  write(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob) (no-py36 !)
+  sendall(160) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: *\r\n\r\n (glob)
+  sendall(*) -> batch branchmap $USUAL_BUNDLE2_CAPS_NO_PHASES$ changegroupsubset compression=none getbundle httpheader=1024 httpmediatype=0.1rx,0.1tx,0.2tx known lookup pushkey streamreqs=* unbundle=HG10GZ,HG10BZ,HG10UN unbundlehash (glob)
   readline(~) -> (26) GET /?cmd=batch HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
   readline(*) -> (41) x-hgarg-1: cmds=heads+%3Bknown+nodes%3D\r\n (glob)
   readline(*) -> (61) x-hgproto-1: 0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n (py36 !)
-  sendall(42) -> 96ee1d7354c4ad7372047672c36a1f561e3a6a4c\n; (py36 !)
-  write(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n (no-py36 !)
+  sendall(159) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.1\r\nContent-Length: 42\r\n\r\n
+  sendall(42) -> 96ee1d7354c4ad7372047672c36a1f561e3a6a4c\n;
   readline(~) -> (30) GET /?cmd=getbundle HTTP/1.1\r\n
   readline(*) -> (27) Accept-Encoding: identity\r\n (glob)
   readline(*) -> (29) vary: X-HgArg-1,X-HgProto-1\r\n (glob)
-  readline(*) -> (440) x-hgarg-1: bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps%250Astream%253Dv2&cg=1&common=0000000000000000000000000000000000000000&heads=96ee1d7354c4ad7372047672c36a1f561e3a6a4c&listkeys=phases%2Cbookmarks\r\n (glob)
+  readline(*) -> (447) x-hgarg-1: bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps%250Astream%253Dv2&cg=1&common=0000000000000000000000000000000000000000&heads=96ee1d7354c4ad7372047672c36a1f561e3a6a4c&listkeys=phases%2Cbookmarks\r\n (glob)
   readline(*) -> (61) x-hgproto-1: 0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull\r\n (glob)
   readline(*) -> (35) accept: application/mercurial-0.1\r\n (glob)
   readline(*) -> (2?) host: localhost:$HGPORT\r\n (glob)
   readline(*) -> (49) user-agent: mercurial/proto-1.0 (Mercurial 4.2)\r\n (glob)
   readline(*) -> (2) \r\n (glob)
-  sendall(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n (py36 !)
-  sendall(6) -> 1\\r\\n\x04\\r\\n (esc) (py36 !)
-  sendall(9) -> 4\r\nnone\r\n (py36 !)
-  sendall(9 from 9) -> (0) 4\r\nHG20\r\n (py36 !)
-  write(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n (no-py36 !)
+  sendall(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
+  sendall(6) -> 1\\r\\n\x04\\r\\n (esc)
+  sendall(9) -> 4\r\nnone\r\n
+  sendall(9 from 9) -> (0) 4\r\nHG20\r\n
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
 
   $ rm -f error.log
@@ -661,40 +610,24 @@
   requesting all changes
   abort: HTTP request error (incomplete response*) (glob)
   (this may be an intermittent network failure; if the error persists, consider contacting the network or server operator)
   [255]
 
   $ killdaemons.py $DAEMON_PIDS
 
-#if py36
   $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -9
   sendall(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
   sendall(6) -> 1\\r\\n\x04\\r\\n (esc)
   sendall(9) -> 4\r\nnone\r\n
   sendall(6 from 9) -> (0) 4\r\nHG2
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-
-#else
-  $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -11
-  readline(~) -> (2) \r\n
-  write(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
-  write(6) -> 1\\r\\n\x04\\r\\n (esc)
-  write(9) -> 4\r\nnone\r\n
-  write(6 from 9) -> (0) 4\r\nHG2
-  write limit reached; closing socket
-  $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
-  Traceback (most recent call last):
-  Exception: connection closed after sending N bytes
-  
-#endif
-
   $ rm -f error.log
 
 Server sends incomplete bundle2 stream params length
 ----------------------------------------------------
 
   $ hg serve \
   > --config badserver.close-after-send-patterns='4\r\n\0\0\0' \
@@ -705,43 +638,25 @@
   requesting all changes
   abort: HTTP request error (incomplete response*) (glob)
   (this may be an intermittent network failure; if the error persists, consider contacting the network or server operator)
   [255]
 
   $ killdaemons.py $DAEMON_PIDS
 
-#if py36
   $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -10
   sendall(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
   sendall(6) -> 1\\r\\n\x04\\r\\n (esc)
   sendall(9) -> 4\r\nnone\r\n
   sendall(9) -> 4\r\nHG20\r\n
   sendall(6 from 9) -> (0) 4\\r\\n\x00\x00\x00 (esc)
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-
-#else
-  $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -12
-  readline(~) -> (2) \r\n
-  write(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
-  write(41) -> Content-Type: application/mercurial-0.2\r\n
-  write(6) -> 1\\r\\n\x04\\r\\n (esc)
-  write(9) -> 4\r\nnone\r\n
-  write(9) -> 4\r\nHG20\r\n
-  write(6 from 9) -> (0) 4\\r\\n\x00\x00\x00 (esc)
-  write limit reached; closing socket
-  $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
-  Traceback (most recent call last):
-  Exception: connection closed after sending N bytes
-  
-#endif
-
   $ rm -f error.log
 
 Servers stops after bundle2 stream params header
 ------------------------------------------------
 
   $ hg serve \
   > --config badserver.close-after-send-patterns='4\r\n\0\0\0\0\r\n' \
@@ -752,43 +667,25 @@
   requesting all changes
   abort: HTTP request error (incomplete response)
   (this may be an intermittent network failure; if the error persists, consider contacting the network or server operator)
   [255]
 
   $ killdaemons.py $DAEMON_PIDS
 
-#if py36
   $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -10
   sendall(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
   sendall(6) -> 1\\r\\n\x04\\r\\n (esc)
   sendall(9) -> 4\r\nnone\r\n
   sendall(9) -> 4\r\nHG20\r\n
   sendall(9 from 9) -> (0) 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-
-#else
-  $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -12
-  readline(~) -> (2) \r\n
-  write(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
-  write(41) -> Content-Type: application/mercurial-0.2\r\n
-  write(6) -> 1\\r\\n\x04\\r\\n (esc)
-  write(9) -> 4\r\nnone\r\n
-  write(9) -> 4\r\nHG20\r\n
-  write(9 from 9) -> (0) 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write limit reached; closing socket
-  $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
-  Traceback (most recent call last):
-  Exception: connection closed after sending N bytes
-  
-#endif
-
   $ rm -f error.log
 
 Server stops sending after bundle2 part header length
 -----------------------------------------------------
 
   $ hg serve \
   > --config badserver.close-after-send-patterns='4\r\n\0\0\0\)\r\n' \
@@ -799,215 +696,132 @@
   requesting all changes
   abort: HTTP request error (incomplete response)
   (this may be an intermittent network failure; if the error persists, consider contacting the network or server operator)
   [255]
 
   $ killdaemons.py $DAEMON_PIDS
 
-#if py36
   $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -11
   sendall(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
   sendall(6) -> 1\\r\\n\x04\\r\\n (esc)
   sendall(9) -> 4\r\nnone\r\n
   sendall(9) -> 4\r\nHG20\r\n
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9 from 9) -> (0) 4\\r\\n\x00\x00\x00)\\r\\n (esc)
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-
-#else
-
-  $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -13
-  readline(~) -> (2) \r\n
-  write(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
-  write(41) -> Content-Type: application/mercurial-0.2\r\n
-  write(6) -> 1\\r\\n\x04\\r\\n (esc)
-  write(9) -> 4\r\nnone\r\n
-  write(9) -> 4\r\nHG20\r\n
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9 from 9) -> (0) 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  write limit reached; closing socket
-  $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
-  Traceback (most recent call last):
-  Exception: connection closed after sending N bytes
-  
-#endif
-
   $ rm -f error.log
 
 Server stops sending after bundle2 part header
 ----------------------------------------------
 
   $ hg serve \
-  > --config badserver.close-after-send-patterns="version02nbchanges1\\r\\n" \
+  > --config badserver.close-after-send-patterns="version03nbchanges1\\r\\n" \
   > -p $HGPORT -d --pid-file=hg.pid -E error.log
   $ cat hg.pid > $DAEMON_PIDS
 
   $ hg clone http://localhost:$HGPORT/ clone
   requesting all changes
   adding changesets
   transaction abort!
   rollback completed
   abort: HTTP request error (incomplete response)
   (this may be an intermittent network failure; if the error persists, consider contacting the network or server operator)
   [255]
 
   $ killdaemons.py $DAEMON_PIDS
 
-#if py36
   $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -12
   sendall(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
   sendall(6) -> 1\\r\\n\x04\\r\\n (esc)
   sendall(9) -> 4\r\nnone\r\n
   sendall(9) -> 4\r\nHG20\r\n
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  sendall(47 from 47) -> (0) 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version02nbchanges1\\r\\n (esc)
+  sendall(47 from 47) -> (0) 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version03nbchanges1\\r\\n (esc)
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-
-#else
-  $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -14
-  readline(~) -> (2) \r\n
-  write(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
-  write(41) -> Content-Type: application/mercurial-0.2\r\n
-  write(6) -> 1\\r\\n\x04\\r\\n (esc)
-  write(9) -> 4\r\nnone\r\n
-  write(9) -> 4\r\nHG20\r\n
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  write(47 from 47) -> (0) 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version02nbchanges1\\r\\n (esc)
-  write limit reached; closing socket
-  $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
-  Traceback (most recent call last):
-  Exception: connection closed after sending N bytes
-  
-#endif
-
   $ rm -f error.log
 
 Server stops after bundle2 part payload chunk size
 --------------------------------------------------
 
   $ hg serve \
-  > --config badserver.close-after-send-patterns='1d2\r\n.......' \
+  > --config badserver.close-after-send-patterns='1dc\r\n.......' \
   > -p $HGPORT -d --pid-file=hg.pid -E error.log
   $ cat hg.pid > $DAEMON_PIDS
 
   $ hg clone http://localhost:$HGPORT/ clone
   requesting all changes
   adding changesets
   transaction abort!
   rollback completed
   abort: HTTP request error (incomplete response*) (glob)
   (this may be an intermittent network failure; if the error persists, consider contacting the network or server operator)
   [255]
 
   $ killdaemons.py $DAEMON_PIDS
 
-#if py36
   $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -14
   sendall(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
   sendall(6) -> 1\\r\\n\x04\\r\\n (esc)
   sendall(9) -> 4\r\nnone\r\n
   sendall(9) -> 4\r\nHG20\r\n
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  sendall(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version02nbchanges1\\r\\n (esc)
-  sendall(9) -> 4\\r\\n\x00\x00\x01\xd2\\r\\n (esc)
-  sendall(12 from 473) -> (0) 1d2\\r\\n\x00\x00\x00\xb2\x96\xee\x1d (esc)
-  write limit reached; closing socket
-  $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
-  Traceback (most recent call last):
-  Exception: connection closed after sending N bytes
-  
-
-#else
-  $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -15
-  write(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
-  write(28) -> Transfer-Encoding: chunked\r\n
-  write(6) -> 1\\r\\n\x04\\r\\n (esc)
-  write(9) -> 4\r\nnone\r\n
-  write(9) -> 4\r\nHG20\r\n
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  write(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version02nbchanges1\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x01\xd2\\r\\n (esc)
-  write(12 from 473) -> (0) 1d2\\r\\n\x00\x00\x00\xb2\x96\xee\x1d (esc)
+  sendall(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version03nbchanges1\\r\\n (esc)
+  sendall(9) -> 4\\r\\n\x00\x00\x01\xdc\\r\\n (esc)
+  sendall(12 from 483) -> (0) 1dc\\r\\n\x00\x00\x00\xb4\x96\xee\x1d (esc)
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-#endif
-
   $ rm -f error.log
 
 Server stops sending in middle of bundle2 payload chunk
 -------------------------------------------------------
 
   $ hg serve \
-  > --config badserver.close-after-send-patterns=':jL\0\0\x00\0\0\0\0\0\r\n' \
+  > --config badserver.close-after-send-patterns=':jL\0\0\x00\0\0\0\0\0\0\0\r\n' \
   > -p $HGPORT -d --pid-file=hg.pid -E error.log
   $ cat hg.pid > $DAEMON_PIDS
 
   $ hg clone http://localhost:$HGPORT/ clone
   requesting all changes
   adding changesets
   transaction abort!
   rollback completed
   abort: HTTP request error (incomplete response)
   (this may be an intermittent network failure; if the error persists, consider contacting the network or server operator)
   [255]
 
   $ killdaemons.py $DAEMON_PIDS
 
-#if py36
   $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -14
   sendall(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
   sendall(6) -> 1\\r\\n\x04\\r\\n (esc)
   sendall(9) -> 4\r\nnone\r\n
   sendall(9) -> 4\r\nHG20\r\n
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  sendall(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version02nbchanges1\\r\\n (esc)
-  sendall(9) -> 4\\r\\n\x00\x00\x01\xd2\\r\\n (esc)
-  sendall(473 from 473) -> (0) 1d2\\r\\n\x00\x00\x00\xb2\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>6a3df4de388f3c4f8e28f4f9a814299a3cbb5f50\\ntest\\n0 0\\nfoo\\n\\ninitial\x00\x00\x00\x00\x00\x00\x00\xa1j=\xf4\xde8\x8f<O\x8e(\xf4\xf9\xa8\x14)\x9a<\xbb_P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-foo\x00b80de5d138758541c5f05265ad144ab9fa86d1db\\n\x00\x00\x00\x00\x00\x00\x00\x07foo\x00\x00\x00h\xb8\\r\xe5\xd18u\x85A\xc5\xf0Re\xad\x14J\xb9\xfa\x86\xd1\xdb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\\r\\n (esc)
+  sendall(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version03nbchanges1\\r\\n (esc)
+  sendall(9) -> 4\\r\\n\x00\x00\x01\xdc\\r\\n (esc)
+  sendall(483 from 483) -> (0) 1dc\\r\\n\x00\x00\x00\xb4\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>6a3df4de388f3c4f8e28f4f9a814299a3cbb5f50\\ntest\\n0 0\\nfoo\\n\\ninitial\x00\x00\x00\x00\x00\x00\x00\xa3j=\xf4\xde8\x8f<O\x8e(\xf4\xf9\xa8\x14)\x9a<\xbb_P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-foo\x00b80de5d138758541c5f05265ad144ab9fa86d1db\\n\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07foo\x00\x00\x00j\xb8\\r\xe5\xd18u\x85A\xc5\xf0Re\xad\x14J\xb9\xfa\x86\xd1\xdb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\\r\\n (esc)
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-
-#else
-  $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -16
-  readline(~) -> (2) \r\n
-  write(167) -> HTTP/1.1 200 Script output follows\r\nServer: badhttpserver\r\nDate: $HTTP_DATE$\r\nContent-Type: application/mercurial-0.2\r\nTransfer-Encoding: chunked\r\n\r\n
-  write(41) -> Content-Type: application/mercurial-0.2\r\n
-  write(6) -> 1\\r\\n\x04\\r\\n (esc)
-  write(9) -> 4\r\nnone\r\n
-  write(9) -> 4\r\nHG20\r\n
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  write(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version02nbchanges1\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x01\xd2\\r\\n (esc)
-  write(473 from 473) -> (0) 1d2\\r\\n\x00\x00\x00\xb2\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>6a3df4de388f3c4f8e28f4f9a814299a3cbb5f50\\ntest\\n0 0\\nfoo\\n\\ninitial\x00\x00\x00\x00\x00\x00\x00\xa1j=\xf4\xde8\x8f<O\x8e(\xf4\xf9\xa8\x14)\x9a<\xbb_P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-foo\x00b80de5d138758541c5f05265ad144ab9fa86d1db\\n\x00\x00\x00\x00\x00\x00\x00\x07foo\x00\x00\x00h\xb8\\r\xe5\xd18u\x85A\xc5\xf0Re\xad\x14J\xb9\xfa\x86\xd1\xdb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\\r\\n (esc)
-  write limit reached; closing socket
-  $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
-  Traceback (most recent call last):
-  Exception: connection closed after sending N bytes
-  
-#endif
-
   $ rm -f error.log
 
 Server stops sending after 0 length payload chunk size
 ------------------------------------------------------
 
   $ hg serve \
   > --config badserver.close-after-send-patterns=LISTKEYS \
@@ -1023,54 +837,31 @@
   rollback completed
   abort: HTTP request error (incomplete response*) (glob)
   (this may be an intermittent network failure; if the error persists, consider contacting the network or server operator)
   [255]
 
   $ killdaemons.py $DAEMON_PIDS
 
-#if py36
   $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -16
   sendall(6) -> 1\\r\\n\x04\\r\\n (esc)
   sendall(9) -> 4\r\nnone\r\n
   sendall(9) -> 4\r\nHG20\r\n
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  sendall(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version02nbchanges1\\r\\n (esc)
-  sendall(9) -> 4\\r\\n\x00\x00\x01\xd2\\r\\n (esc)
-  sendall(473) -> 1d2\\r\\n\x00\x00\x00\xb2\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>6a3df4de388f3c4f8e28f4f9a814299a3cbb5f50\\ntest\\n0 0\\nfoo\\n\\ninitial\x00\x00\x00\x00\x00\x00\x00\xa1j=\xf4\xde8\x8f<O\x8e(\xf4\xf9\xa8\x14)\x9a<\xbb_P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-foo\x00b80de5d138758541c5f05265ad144ab9fa86d1db\\n\x00\x00\x00\x00\x00\x00\x00\x07foo\x00\x00\x00h\xb8\\r\xe5\xd18u\x85A\xc5\xf0Re\xad\x14J\xb9\xfa\x86\xd1\xdb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\\r\\n (esc)
+  sendall(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version03nbchanges1\\r\\n (esc)
+  sendall(9) -> 4\\r\\n\x00\x00\x01\xdc\\r\\n (esc)
+  sendall(483) -> 1dc\\r\\n\x00\x00\x00\xb4\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>6a3df4de388f3c4f8e28f4f9a814299a3cbb5f50\\ntest\\n0 0\\nfoo\\n\\ninitial\x00\x00\x00\x00\x00\x00\x00\xa3j=\xf4\xde8\x8f<O\x8e(\xf4\xf9\xa8\x14)\x9a<\xbb_P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-foo\x00b80de5d138758541c5f05265ad144ab9fa86d1db\\n\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07foo\x00\x00\x00j\xb8\\r\xe5\xd18u\x85A\xc5\xf0Re\xad\x14J\xb9\xfa\x86\xd1\xdb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00 \\r\\n (esc)
   sendall(13 from 38) -> (0) 20\\r\\n\x08LISTKEYS (esc)
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-
-#else
-  $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -17
-  write(2) -> \r\n
-  write(6) -> 1\\r\\n\x04\\r\\n (esc)
-  write(9) -> 4\r\nnone\r\n
-  write(9) -> 4\r\nHG20\r\n
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  write(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version02nbchanges1\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x01\xd2\\r\\n (esc)
-  write(473) -> 1d2\\r\\n\x00\x00\x00\xb2\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>6a3df4de388f3c4f8e28f4f9a814299a3cbb5f50\\ntest\\n0 0\\nfoo\\n\\ninitial\x00\x00\x00\x00\x00\x00\x00\xa1j=\xf4\xde8\x8f<O\x8e(\xf4\xf9\xa8\x14)\x9a<\xbb_P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-foo\x00b80de5d138758541c5f05265ad144ab9fa86d1db\\n\x00\x00\x00\x00\x00\x00\x00\x07foo\x00\x00\x00h\xb8\\r\xe5\xd18u\x85A\xc5\xf0Re\xad\x14J\xb9\xfa\x86\xd1\xdb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00 \\r\\n (esc)
-  write(13 from 38) -> (0) 20\\r\\n\x08LISTKEYS (esc)
-  write limit reached; closing socket
-  $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
-  Traceback (most recent call last):
-  Exception: connection closed after sending N bytes
-  
-#endif
-
   $ rm -f error.log
 
 Server stops sending after 0 part bundle part header (indicating end of bundle2 payload)
 ----------------------------------------------------------------------------------------
 
 This is before the 0 size chunked transfer part that signals end of HTTP response.
 
@@ -1087,21 +878,20 @@
   added 1 changesets with 1 changes to 1 files
   new changesets 96ee1d7354c4
   updating to branch default
   1 files updated, 0 files merged, 0 files removed, 0 files unresolved
 
   $ killdaemons.py $DAEMON_PIDS
 
-#if py36
   $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -20
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  sendall(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version02nbchanges1\\r\\n (esc)
-  sendall(9) -> 4\\r\\n\x00\x00\x01\xd2\\r\\n (esc)
-  sendall(473) -> 1d2\\r\\n\x00\x00\x00\xb2\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>6a3df4de388f3c4f8e28f4f9a814299a3cbb5f50\\ntest\\n0 0\\nfoo\\n\\ninitial\x00\x00\x00\x00\x00\x00\x00\xa1j=\xf4\xde8\x8f<O\x8e(\xf4\xf9\xa8\x14)\x9a<\xbb_P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-foo\x00b80de5d138758541c5f05265ad144ab9fa86d1db\\n\x00\x00\x00\x00\x00\x00\x00\x07foo\x00\x00\x00h\xb8\\r\xe5\xd18u\x85A\xc5\xf0Re\xad\x14J\xb9\xfa\x86\xd1\xdb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\\r\\n (esc)
+  sendall(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version03nbchanges1\\r\\n (esc)
+  sendall(9) -> 4\\r\\n\x00\x00\x01\xdc\\r\\n (esc)
+  sendall(483) -> 1dc\\r\\n\x00\x00\x00\xb4\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>6a3df4de388f3c4f8e28f4f9a814299a3cbb5f50\\ntest\\n0 0\\nfoo\\n\\ninitial\x00\x00\x00\x00\x00\x00\x00\xa3j=\xf4\xde8\x8f<O\x8e(\xf4\xf9\xa8\x14)\x9a<\xbb_P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-foo\x00b80de5d138758541c5f05265ad144ab9fa86d1db\\n\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07foo\x00\x00\x00j\xb8\\r\xe5\xd18u\x85A\xc5\xf0Re\xad\x14J\xb9\xfa\x86\xd1\xdb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00 \\r\\n (esc)
   sendall(38) -> 20\\r\\n\x08LISTKEYS\x00\x00\x00\x01\x01\x00	\x06namespacephases\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00:\\r\\n (esc)
   sendall(64) -> 3a\r\n96ee1d7354c4ad7372047672c36a1f561e3a6a4c	1\npublishing	True\r\n
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00#\\r\\n (esc)
@@ -1109,40 +899,14 @@
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9 from 9) -> (0) 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-
-#else
-  $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -21
-  write(9) -> 4\r\nHG20\r\n
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  write(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version02nbchanges1\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x01\xd2\\r\\n (esc)
-  write(473) -> 1d2\\r\\n\x00\x00\x00\xb2\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>6a3df4de388f3c4f8e28f4f9a814299a3cbb5f50\\ntest\\n0 0\\nfoo\\n\\ninitial\x00\x00\x00\x00\x00\x00\x00\xa1j=\xf4\xde8\x8f<O\x8e(\xf4\xf9\xa8\x14)\x9a<\xbb_P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-foo\x00b80de5d138758541c5f05265ad144ab9fa86d1db\\n\x00\x00\x00\x00\x00\x00\x00\x07foo\x00\x00\x00h\xb8\\r\xe5\xd18u\x85A\xc5\xf0Re\xad\x14J\xb9\xfa\x86\xd1\xdb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00 \\r\\n (esc)
-  write(38) -> 20\\r\\n\x08LISTKEYS\x00\x00\x00\x01\x01\x00	\x06namespacephases\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00:\\r\\n (esc)
-  write(64) -> 3a\r\n96ee1d7354c4ad7372047672c36a1f561e3a6a4c	1\npublishing	True\r\n
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00#\\r\\n (esc)
-  write(41) -> 23\\r\\n\x08LISTKEYS\x00\x00\x00\x02\x01\x00		namespacebookmarks\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9 from 9) -> (0) 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write limit reached; closing socket
-  $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
-  Traceback (most recent call last):
-  Exception: connection closed after sending N bytes
-  
-#endif
-
   $ rm -f error.log
   $ rm -rf clone
 
 Server sends a size 0 chunked-transfer size without terminating \r\n
 --------------------------------------------------------------------
 
   $ hg serve \
@@ -1158,21 +922,20 @@
   added 1 changesets with 1 changes to 1 files
   new changesets 96ee1d7354c4
   updating to branch default
   1 files updated, 0 files merged, 0 files removed, 0 files unresolved
 
   $ killdaemons.py $DAEMON_PIDS
 
-#if py36
   $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -21
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  sendall(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version02nbchanges1\\r\\n (esc)
-  sendall(9) -> 4\\r\\n\x00\x00\x01\xd2\\r\\n (esc)
-  sendall(473) -> 1d2\\r\\n\x00\x00\x00\xb2\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>6a3df4de388f3c4f8e28f4f9a814299a3cbb5f50\\ntest\\n0 0\\nfoo\\n\\ninitial\x00\x00\x00\x00\x00\x00\x00\xa1j=\xf4\xde8\x8f<O\x8e(\xf4\xf9\xa8\x14)\x9a<\xbb_P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-foo\x00b80de5d138758541c5f05265ad144ab9fa86d1db\\n\x00\x00\x00\x00\x00\x00\x00\x07foo\x00\x00\x00h\xb8\\r\xe5\xd18u\x85A\xc5\xf0Re\xad\x14J\xb9\xfa\x86\xd1\xdb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\\r\\n (esc)
+  sendall(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version03nbchanges1\\r\\n (esc)
+  sendall(9) -> 4\\r\\n\x00\x00\x01\xdc\\r\\n (esc)
+  sendall(483) -> 1dc\\r\\n\x00\x00\x00\xb4\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>6a3df4de388f3c4f8e28f4f9a814299a3cbb5f50\\ntest\\n0 0\\nfoo\\n\\ninitial\x00\x00\x00\x00\x00\x00\x00\xa3j=\xf4\xde8\x8f<O\x8e(\xf4\xf9\xa8\x14)\x9a<\xbb_P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-foo\x00b80de5d138758541c5f05265ad144ab9fa86d1db\\n\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07foo\x00\x00\x00j\xb8\\r\xe5\xd18u\x85A\xc5\xf0Re\xad\x14J\xb9\xfa\x86\xd1\xdb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00 \\r\\n (esc)
   sendall(38) -> 20\\r\\n\x08LISTKEYS\x00\x00\x00\x01\x01\x00	\x06namespacephases\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00:\\r\\n (esc)
   sendall(64) -> 3a\r\n96ee1d7354c4ad7372047672c36a1f561e3a6a4c	1\npublishing	True\r\n
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(9) -> 4\\r\\n\x00\x00\x00#\\r\\n (esc)
@@ -1181,36 +944,9 @@
   sendall(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
   sendall(3 from 5) -> (0) 0\r\n
   write limit reached; closing socket
   $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
   Traceback (most recent call last):
   Exception: connection closed after sending N bytes
   
-
-#else
-  $ "$PYTHON" $TESTDIR/filtertraceback.py < error.log | tail -22
-  write(9) -> 4\r\nHG20\r\n
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00)\\r\\n (esc)
-  write(47) -> 29\\r\\n\x0bCHANGEGROUP\x00\x00\x00\x00\x01\x01\x07\x02	\x01version02nbchanges1\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x01\xd2\\r\\n (esc)
-  write(473) -> 1d2\\r\\n\x00\x00\x00\xb2\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>6a3df4de388f3c4f8e28f4f9a814299a3cbb5f50\\ntest\\n0 0\\nfoo\\n\\ninitial\x00\x00\x00\x00\x00\x00\x00\xa1j=\xf4\xde8\x8f<O\x8e(\xf4\xf9\xa8\x14)\x9a<\xbb_P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00-foo\x00b80de5d138758541c5f05265ad144ab9fa86d1db\\n\x00\x00\x00\x00\x00\x00\x00\x07foo\x00\x00\x00h\xb8\\r\xe5\xd18u\x85A\xc5\xf0Re\xad\x14J\xb9\xfa\x86\xd1\xdb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xee\x1dsT\xc4\xadsr\x04vr\xc3j\x1fV\x1e:jL\x00\x00\x00\x00\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00 \\r\\n (esc)
-  write(38) -> 20\\r\\n\x08LISTKEYS\x00\x00\x00\x01\x01\x00	\x06namespacephases\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00:\\r\\n (esc)
-  write(64) -> 3a\r\n96ee1d7354c4ad7372047672c36a1f561e3a6a4c	1\npublishing	True\r\n
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00#\\r\\n (esc)
-  write(41) -> 23\\r\\n\x08LISTKEYS\x00\x00\x00\x02\x01\x00		namespacebookmarks\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(9) -> 4\\r\\n\x00\x00\x00\x00\\r\\n (esc)
-  write(3 from 5) -> (0) 0\r\n
-  write limit reached; closing socket
-  $LOCALIP - - [$ERRDATE$] Exception happened during processing request '/?cmd=getbundle': (glob)
-  Traceback (most recent call last):
-  Exception: connection closed after sending N bytes
-  
-#endif
-
   $ rm -f error.log
   $ rm -rf clone
```

### Comparing `mercurial-6.4rc0/tests/test-http-branchmap.t` & `mercurial-6.5rc0/tests/test-http-branchmap.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-http-bundle1.t` & `mercurial-6.5rc0/tests/test-http-bundle1.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-http-clone-r.t` & `mercurial-6.5rc0/tests/test-http-clone-r.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-http-permissions.t` & `mercurial-6.5rc0/tests/test-http-permissions.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-http-protocol.t` & `mercurial-6.5rc0/tests/test-http-protocol.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-http-proxy.t` & `mercurial-6.5rc0/tests/test-http-proxy.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-http.t` & `mercurial-6.5rc0/tests/test-http.t`

 * *Files 1% similar despite different names*

```diff
@@ -337,28 +337,28 @@
   devel-peer-request:   19 bytes of commands arguments in headers
   devel-peer-request:   finished in *.???? seconds (200) (glob)
   received listkey for "bookmarks": 0 bytes
   1 changesets found
   list of changesets:
   7f4e523d01f2cc3765ac8934da3d14db775ff872
   bundle2-output-bundle: "HG20", 5 parts total
-  bundle2-output-part: "replycaps" 207 bytes payload
+  bundle2-output-part: "replycaps" 210 bytes payload
   bundle2-output-part: "check:phases" 24 bytes payload
   bundle2-output-part: "check:updated-heads" streamed payload
   bundle2-output-part: "changegroup" (params: 1 mandatory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   sending unbundle command
-  sending 1023 bytes
+  sending 1036 bytes
   devel-peer-request: POST http://localhost:$HGPORT2/?cmd=unbundle
-  devel-peer-request:   Content-length 1023
+  devel-peer-request:   Content-length 1036
   devel-peer-request:   Content-type application/mercurial-0.1
   devel-peer-request:   Vary X-HgArg-1,X-HgProto-1
   devel-peer-request:   X-hgproto-1 0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull
   devel-peer-request:   16 bytes of commands arguments in headers
-  devel-peer-request:   1023 bytes of data
+  devel-peer-request:   1036 bytes of data
   devel-peer-request:   finished in *.???? seconds (200) (glob)
   bundle2-input-bundle: no-transaction
   bundle2-input-part: "reply:changegroup" (advisory) (params: 0 advisory) supported
   bundle2-input-part: "output" (advisory) (params: 0 advisory) supported
   bundle2-input-part: total payload size 55
   remote: adding changesets
   remote: adding manifests
```

### Comparing `mercurial-6.4rc0/tests/test-https.t` & `mercurial-6.5rc0/tests/test-https.t`

 * *Files 1% similar despite different names*

```diff
@@ -340,29 +340,29 @@
   $ killdaemons.py hg2.pid
 
 #if tls1.2
 Start servers running supported TLS versions
 
   $ cd test
   $ hg serve -p $HGPORT -d --pid-file=../hg0.pid --certificate=$PRIV \
-  > --config devel.serverexactprotocol=tls1.0
+  > --config devel.server-insecure-exact-protocol=tls1.0
   $ cat ../hg0.pid >> $DAEMON_PIDS
   $ hg serve -p $HGPORT1 -d --pid-file=../hg1.pid --certificate=$PRIV \
-  > --config devel.serverexactprotocol=tls1.1
+  > --config devel.server-insecure-exact-protocol=tls1.1
   $ cat ../hg1.pid >> $DAEMON_PIDS
   $ hg serve -p $HGPORT2 -d --pid-file=../hg2.pid --certificate=$PRIV \
-  > --config devel.serverexactprotocol=tls1.2
+  > --config devel.server-insecure-exact-protocol=tls1.2
   $ cat ../hg2.pid >> $DAEMON_PIDS
   $ cd ..
 
 Clients talking same TLS versions work
 
-  $ P="$CERTSDIR" hg --config hostsecurity.minimumprotocol=tls1.0 --config hostsecurity.ciphers=DEFAULT id https://localhost:$HGPORT/
+  $ P="$CERTSDIR" hg --config hostsecurity.minimumprotocol=tls1.0 --config hostsecurity.ciphers="DEFAULT:@SECLEVEL=0" id https://localhost:$HGPORT/
   5fed3813f7f5
-  $ P="$CERTSDIR" hg --config hostsecurity.minimumprotocol=tls1.1 --config hostsecurity.ciphers=DEFAULT id https://localhost:$HGPORT1/
+  $ P="$CERTSDIR" hg --config hostsecurity.minimumprotocol=tls1.1 --config hostsecurity.ciphers="DEFAULT:@SECLEVEL=0" id https://localhost:$HGPORT1/
   5fed3813f7f5
   $ P="$CERTSDIR" hg --config hostsecurity.minimumprotocol=tls1.2 id https://localhost:$HGPORT2/
   5fed3813f7f5
 
 Clients requiring newer TLS version than what server supports fail
 
   $ P="$CERTSDIR" hg id https://localhost:$HGPORT/
@@ -396,15 +396,15 @@
   $ hg --config hostsecurity.minimumprotocol=tls1.2 id --insecure https://localhost:$HGPORT1/
   warning: connection security to localhost is disabled per current settings; communication is susceptible to eavesdropping and tampering
   5fed3813f7f5
 
 The per-host config option overrides the default
 
   $ P="$CERTSDIR" hg id https://localhost:$HGPORT/ \
-  > --config hostsecurity.ciphers=DEFAULT \
+  > --config hostsecurity.ciphers="DEFAULT:@SECLEVEL=0" \
   > --config hostsecurity.minimumprotocol=tls1.2 \
   > --config hostsecurity.localhost:minimumprotocol=tls1.0
   5fed3813f7f5
 
 The per-host config option by itself works
 
   $ P="$CERTSDIR" hg id https://localhost:$HGPORT/ \
```

### Comparing `mercurial-6.4rc0/tests/test-hybridencode.py` & `mercurial-6.5rc0/tests/test-hybridencode.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-i18n.t` & `mercurial-6.5rc0/tests/test-i18n.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-identify.t` & `mercurial-6.5rc0/tests/test-identify.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-impexp-branch.t` & `mercurial-6.5rc0/tests/test-impexp-branch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-import-bypass.t` & `mercurial-6.5rc0/tests/test-import-bypass.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-import-context.t` & `mercurial-6.5rc0/tests/test-import-context.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-import-eol.t` & `mercurial-6.5rc0/tests/test-import-eol.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-import-git.t` & `mercurial-6.5rc0/tests/test-import-git.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-import-merge.t` & `mercurial-6.5rc0/tests/test-import-merge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-import-unknown.t` & `mercurial-6.5rc0/tests/test-import-unknown.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-import.t` & `mercurial-6.5rc0/tests/test-import.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-imports-checker.t` & `mercurial-6.5rc0/tests/test-imports-checker.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-incoming-outgoing.t` & `mercurial-6.5rc0/tests/test-incoming-outgoing.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-infinitepush.t` & `mercurial-6.5rc0/tests/test-remotefilelog-local.t`

 * *Files 24% similar despite different names*

```diff
@@ -1,172 +1,218 @@
-#require no-reposimplestore no-chg
+#require no-windows
 
-XXX-CHG this test hangs if `hg` is really `chg`. This was hidden by the use of
-`alias hg=chg` by run-tests.py. With such alias removed, this test is revealed
-buggy. This need to be resolved sooner than later.
-
-
-Testing infinipush extension and the confi options provided by it
-
-Setup
-
-  $ . "$TESTDIR/library-infinitepush.sh"
-  $ cp $HGRCPATH $TESTTMP/defaulthgrc
-  $ setupcommon
-  $ hg init repo
-  $ cd repo
-  $ setupserver
-  $ echo initialcommit > initialcommit
-  $ hg ci -Aqm "initialcommit"
-  $ hg phase --public .
+  $ . "$TESTDIR/remotefilelog-library.sh"
+
+  $ hg init master
+  $ cd master
+  $ cat >> .hg/hgrc <<EOF
+  > [remotefilelog]
+  > server=True
+  > EOF
+  $ echo x > x
+  $ echo y > y
+  $ echo z > z
+  $ hg commit -qAm xy
 
   $ cd ..
-  $ hg clone ssh://user@dummy/repo client -q
 
-Create two heads. Push first head alone, then two heads together. Make sure that
-multihead push works.
-  $ cd client
-  $ echo multihead1 > multihead1
-  $ hg add multihead1
-  $ hg ci -m "multihead1"
-  $ hg up null
-  0 files updated, 0 files merged, 2 files removed, 0 files unresolved
-  $ echo multihead2 > multihead2
-  $ hg ci -Am "multihead2"
-  adding multihead2
-  created new head
-  $ hg push -r . --bundle-store
-  pushing to ssh://user@dummy/repo
-  searching for changes
-  remote: pushing 1 commit:
-  remote:     ee4802bf6864  multihead2
-  $ hg push -r '1:2' --bundle-store
-  pushing to ssh://user@dummy/repo
-  searching for changes
-  remote: pushing 2 commits:
-  remote:     bc22f9a30a82  multihead1
-  remote:     ee4802bf6864  multihead2
-  $ scratchnodes
-  bc22f9a30a821118244deacbd732e394ed0b686c de1b7d132ba98f0172cd974e3e69dfa80faa335c
-  ee4802bf6864326a6b3dcfff5a03abc2a0a69b8f de1b7d132ba98f0172cd974e3e69dfa80faa335c
-
-Create two new scratch bookmarks
-  $ hg up 0
-  1 files updated, 0 files merged, 1 files removed, 0 files unresolved
-  $ echo scratchfirstpart > scratchfirstpart
-  $ hg ci -Am "scratchfirstpart"
-  adding scratchfirstpart
-  created new head
-  $ hg push -r . -B scratch/firstpart
-  pushing to ssh://user@dummy/repo
-  searching for changes
-  remote: pushing 1 commit:
-  remote:     176993b87e39  scratchfirstpart
-  $ hg up 0
-  0 files updated, 0 files merged, 1 files removed, 0 files unresolved
-  $ echo scratchsecondpart > scratchsecondpart
-  $ hg ci -Am "scratchsecondpart"
-  adding scratchsecondpart
+  $ hgcloneshallow ssh://user@dummy/master shallow -q
+  3 files fetched over 1 fetches - (3 misses, 0.00% hit ratio) over *s (glob)
+  $ cd shallow
+
+# status
+
+  $ clearcache
+  $ echo xx > x
+  $ echo yy > y
+  $ touch a
+  $ hg status
+  M x
+  M y
+  ? a
+  1 files fetched over 1 fetches - (1 misses, 0.00% hit ratio) over *s (glob)
+  $ hg add a
+  $ hg status
+  M x
+  M y
+  A a
+
+# diff
+
+  $ hg debugrebuilddirstate # fixes dirstate non-determinism
+  $ hg add a
+  $ clearcache
+  $ hg diff
+  diff -r f3d0bb0d1e48 x
+  --- a/x* (glob)
+  +++ b/x* (glob)
+  @@ -1,1 +1,1 @@
+  -x
+  +xx
+  diff -r f3d0bb0d1e48 y
+  --- a/y* (glob)
+  +++ b/y* (glob)
+  @@ -1,1 +1,1 @@
+  -y
+  +yy
+  3 files fetched over 1 fetches - (3 misses, 0.00% hit ratio) over *s (glob)
+
+# local commit
+
+  $ clearcache
+  $ echo a > a
+  $ echo xxx > x
+  $ echo yyy > y
+  $ hg commit -m a
+  ? files fetched over 1 fetches - (? misses, 0.00% hit ratio) over *s (glob)
+
+# local commit where the dirstate is clean -- ensure that we do just one fetch
+# (update to a commit on the server first)
+
+  $ hg --config debug.dirstate.delaywrite=1 up 0
+  2 files updated, 0 files merged, 1 files removed, 0 files unresolved
+  $ clearcache
+  $ hg debugdirstate
+  n 644          2 * x (glob)
+  n 644          2 * y (glob)
+  n 644          2 * z (glob)
+  $ echo xxxx > x
+  $ echo yyyy > y
+# run status early to avoid a flaky second fetch during commit.
+  $ hg st
+  M x
+  M y
+  \d+ files fetched over \d+ fetches .* (re) (?)
+  $ hg commit -m x
   created new head
-  $ hg push -r . -B scratch/secondpart
-  pushing to ssh://user@dummy/repo
-  searching for changes
-  remote: pushing 1 commit:
-  remote:     8db3891c220e  scratchsecondpart
+  2 files fetched over 1 fetches - (2 misses, 0.00% hit ratio) over *s (glob)
 
-Pull two bookmarks from the second client
-  $ cd ..
-  $ hg clone ssh://user@dummy/repo client2 -q
-  $ cd client2
-  $ hg pull -B scratch/firstpart -B scratch/secondpart
-  pulling from ssh://user@dummy/repo
+# restore state for future tests
+
+  $ hg -q strip .
+  $ hg -q up tip
+
+# rebase
+
+  $ clearcache
+  $ cd ../master
+  $ echo w > w
+  $ hg commit -qAm w
+
+  $ cd ../shallow
+  $ hg pull
+  pulling from ssh://user@dummy/master
   searching for changes
   adding changesets
   adding manifests
   adding file changes
+  added 1 changesets with 0 changes to 0 files (+1 heads)
+  new changesets fed61014d323
+  (run 'hg heads' to see heads, 'hg merge' to merge)
+
+# run status early to avoid a flaky second fetch during commit
+  $ hg status
+  \d+ files fetched over \d+ fetches .* (re) (?)
+  $ hg rebase -d tip
+  rebasing 1:9abfe7bca547 "a"
+  saved backup bundle to $TESTTMP/shallow/.hg/strip-backup/9abfe7bca547-8b11e5ff-rebase.hg (glob)
+  3 files fetched over 2 fetches - (3 misses, 0.00% hit ratio) over *s (glob)
+
+# strip
+
+  $ clearcache
+  $ hg debugrebuilddirstate # fixes dirstate non-determinism
+  $ hg strip -r .
+  2 files updated, 0 files merged, 1 files removed, 0 files unresolved
+  saved backup bundle to $TESTTMP/shallow/.hg/strip-backup/19edf50f4de7-df3d0f74-backup.hg (glob)
+  3 files fetched over 2 fetches - (3 misses, 0.00% hit ratio) over *s (glob)
+
+# unbundle
+
+  $ clearcache
+  $ ls -A
+  .hg
+  w
+  x
+  y
+  z
+
+  $ hg debugrebuilddirstate # fixes dirstate non-determinism
+  $ hg unbundle .hg/strip-backup/19edf50f4de7-df3d0f74-backup.hg
   adding changesets
   adding manifests
   adding file changes
-  added 2 changesets with 2 changes to 2 files (+1 heads)
-  new changesets * (glob)
-  (run 'hg heads' to see heads, 'hg merge' to merge)
-  $ hg log -r scratch/secondpart -T '{node}'
-  8db3891c220e216f6da214e8254bd4371f55efca (no-eol)
-  $ hg log -r scratch/firstpart -T '{node}'
-  176993b87e39bd88d66a2cccadabe33f0b346339 (no-eol)
-Make two commits to the scratch branch
-
-  $ echo testpullbycommithash1 > testpullbycommithash1
-  $ hg ci -Am "testpullbycommithash1"
-  adding testpullbycommithash1
-  created new head
-  $ hg log -r '.' -T '{node}\n' > ../testpullbycommithash1
-  $ echo testpullbycommithash2 > testpullbycommithash2
-  $ hg ci -Aqm "testpullbycommithash2"
-  $ hg push -r . -B scratch/mybranch -q
+  added 1 changesets with 3 changes to 3 files
+  new changesets 19edf50f4de7 (1 drafts)
+  (run 'hg update' to get a working copy)
+  2 files fetched over 1 fetches - (2 misses, 0.00% hit ratio) over *s (glob)
 
-Create third client and pull by commit hash.
-Make sure testpullbycommithash2 has not fetched
+  $ hg up
+  3 files updated, 0 files merged, 0 files removed, 0 files unresolved
+  1 files fetched over 1 fetches - (1 misses, 0.00% hit ratio) over *s (glob)
+  $ cat a
+  a
+
+# revert
+
+  $ clearcache
+  $ hg revert -r .~2 y z
+  no changes needed to z
+  1 files fetched over 1 fetches - (1 misses, 0.00% hit ratio) over *s (glob)
+  $ hg checkout -C -r . -q
+
+# explicit bundle should produce full bundle file
+
+  $ hg bundle -r 2 --base 1 ../local.bundle
+  1 changesets found
+  1 files fetched over 1 fetches - (1 misses, 0.00% hit ratio) over *s (glob)
   $ cd ..
-  $ hg clone ssh://user@dummy/repo client3 -q
-  $ cd client3
-  $ hg pull -r `cat ../testpullbycommithash1`
-  pulling from ssh://user@dummy/repo
-  searching for changes
+
+  $ hgcloneshallow ssh://user@dummy/master shallow2 -q
+  2 files fetched over 1 fetches - (2 misses, 0.00% hit ratio) over *s (glob)
+  $ cd shallow2
+  $ hg unbundle ../local.bundle
   adding changesets
   adding manifests
   adding file changes
-  added 1 changesets with 1 changes to 1 files
-  new changesets 33910bfe6ffe (1 drafts)
+  added 1 changesets with 3 changes to 3 files
+  new changesets 19edf50f4de7 (1 drafts)
   (run 'hg update' to get a working copy)
-  $ hg log -G -T '{desc} {phase} {bookmarks}'
-  o  testpullbycommithash1 draft
-  |
-  @  initialcommit public
+
+  $ hg log -r 2 --stat
+  changeset:   2:19edf50f4de7
+  tag:         tip
+  user:        test
+  date:        Thu Jan 01 00:00:00 1970 +0000
+  summary:     a
   
-Make public commit in the repo and pull it.
-Make sure phase on the client is public.
-  $ cd ../repo
-  $ echo publiccommit > publiccommit
-  $ hg ci -Aqm "publiccommit"
-  $ hg phase --public .
-  $ cd ../client3
-  $ hg pull
-  pulling from ssh://user@dummy/repo
-  searching for changes
-  adding changesets
-  adding manifests
-  adding file changes
-  added 1 changesets with 1 changes to 1 files (+1 heads)
-  new changesets a79b6597f322
-  (run 'hg heads' to see heads, 'hg merge' to merge)
-  $ hg log -G -T '{desc} {phase} {bookmarks} {node|short}'
-  o  publiccommit public  a79b6597f322
-  |
-  | o  testpullbycommithash1 draft  33910bfe6ffe
-  |/
-  @  initialcommit public  67145f466344
+   a |  1 +
+   x |  2 +-
+   y |  2 +-
+   3 files changed, 3 insertions(+), 2 deletions(-)
   
-  $ hg up a79b6597f322
-  1 files updated, 0 files merged, 0 files removed, 0 files unresolved
-  $ echo scratchontopofpublic > scratchontopofpublic
-  $ hg ci -Aqm "scratchontopofpublic"
-  $ hg push -r . -B scratch/scratchontopofpublic
-  pushing to ssh://user@dummy/repo
-  searching for changes
-  remote: pushing 1 commit:
-  remote:     c70aee6da07d  scratchontopofpublic
-  $ cd ../client2
-  $ hg pull -B scratch/scratchontopofpublic
-  pulling from ssh://user@dummy/repo
-  searching for changes
-  adding changesets
-  adding manifests
-  adding file changes
-  adding changesets
-  adding manifests
-  adding file changes
-  added 2 changesets with 2 changes to 2 files (+1 heads)
-  new changesets a79b6597f322:c70aee6da07d (1 drafts)
-  (run 'hg heads .' to see heads, 'hg merge' to merge)
-  $ hg log -r scratch/scratchontopofpublic -T '{phase}'
-  draft (no-eol)
+# Merge
+
+  $ echo merge >> w
+  $ hg commit -m w
+  created new head
+  $ hg merge 2
+  3 files updated, 0 files merged, 0 files removed, 0 files unresolved
+  (branch merge, don't forget to commit)
+  $ hg commit -m merge
+  $ hg strip -q -r ".^"
+
+# commit without producing new node
+
+  $ cd $TESTTMP
+  $ hgcloneshallow ssh://user@dummy/master shallow3 -q
+  $ cd shallow3
+  $ echo 1 > A
+  $ hg commit -m foo -A A
+  $ hg log -r . -T '{node}\n'
+  383ce605500277f879b7460a16ba620eb6930b7f
+  $ hg update -r '.^' -q
+  $ echo 1 > A
+  $ hg commit -m foo -A A
+  warning: commit already existed in the repository!
+  $ hg log -r . -T '{node}\n'
+  383ce605500277f879b7460a16ba620eb6930b7f
```

### Comparing `mercurial-6.4rc0/tests/test-inherit-mode.t` & `mercurial-6.5rc0/tests/test-inherit-mode.t`

 * *Files 2% similar despite different names*

```diff
@@ -91,15 +91,15 @@
   00660 ./.hg/store/data/foo/b80de5d138758541c5f05265ad144ab9fa86d1db (reposimplestore !)
   00660 ./.hg/store/data/foo/index (reposimplestore !)
   00660 ./.hg/store/fncache (repofncache !)
   00660 ./.hg/store/phaseroots
   00600 ./.hg/store/requires
   00660 ./.hg/store/undo
   00660 ./.hg/store/undo.backupfiles
-  00660 ./.hg/undo.backup.branch
+  00660 ./.hg/undo.backup.branch.bck
   00660 ./.hg/undo.desc
   00770 ./.hg/wcache/
   00711 ./.hg/wcache/checkisexec
   007.. ./.hg/wcache/checklink (re)
   00600 ./.hg/wcache/checklink-target
   00660 ./.hg/wcache/manifestfulltextcache (reporevlogstore !)
   00700 ./dir/
@@ -149,15 +149,15 @@
   00770 ../push/.hg/store/data/foo/ (reposimplestore !)
   00660 ../push/.hg/store/data/foo/b80de5d138758541c5f05265ad144ab9fa86d1db (reposimplestore !)
   00660 ../push/.hg/store/data/foo/index (reposimplestore !)
   00660 ../push/.hg/store/fncache (repofncache !)
   00660 ../push/.hg/store/requires
   00660 ../push/.hg/store/undo
   00660 ../push/.hg/store/undo.backupfiles
-  00660 ../push/.hg/undo.backup.branch
+  00660 ../push/.hg/undo.backup.branch.bck
   00660 ../push/.hg/undo.desc
   00770 ../push/.hg/wcache/
 
 
 Test that we don't lose the setgid bit when we call chmod.
 Not all systems support setgid directories (e.g. HFS+), so
 just check that directories have the same mode.
```

### Comparing `mercurial-6.4rc0/tests/test-init.t` & `mercurial-6.5rc0/tests/test-init.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-install.t` & `mercurial-6.5rc0/tests/test-install.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue1102.t` & `mercurial-6.5rc0/tests/test-issue1102.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue1175.t` & `mercurial-6.5rc0/tests/test-issue1175.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue1306.t` & `mercurial-6.5rc0/tests/test-issue1306.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue1502.t` & `mercurial-6.5rc0/tests/test-issue1502.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue1802.t` & `mercurial-6.5rc0/tests/test-issue1802.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue1877.t` & `mercurial-6.5rc0/tests/test-issue1877.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue1993.t` & `mercurial-6.5rc0/tests/test-issue1993.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue2137.t` & `mercurial-6.5rc0/tests/test-issue2137.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue3084.t` & `mercurial-6.5rc0/tests/test-issue3084.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue4074.t` & `mercurial-6.5rc0/tests/test-issue4074.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue522.t` & `mercurial-6.5rc0/tests/test-issue522.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue586.t` & `mercurial-6.5rc0/tests/test-issue586.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue5979.t` & `mercurial-6.5rc0/tests/test-issue5979.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue612.t` & `mercurial-6.5rc0/tests/test-issue612.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue619.t` & `mercurial-6.5rc0/tests/test-issue619.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue6528.t` & `mercurial-6.5rc0/tests/test-issue6528.t`

 * *Files 5% similar despite different names*

```diff
@@ -197,17 +197,17 @@
   $ hg debugrevlogindex D.txt
      rev linkrev nodeid       p1           p2
        0       6 2a8d3833f2fb 000000000000 000000000000
        1       7 2a80419dfc31 2a8d3833f2fb 000000000000
 
 Dry-run the fix
   $ hg debug-repair-issue6528 --dry-run
-  found affected revision 1 for filelog 'data/D.txt.i'
-  found affected revision 1 for filelog 'data/b.txt.i'
-  found affected revision 3 for filelog 'data/b.txt.i'
+  found affected revision 1 for file 'D.txt'
+  found affected revision 1 for file 'b.txt'
+  found affected revision 3 for file 'b.txt'
   $ hg st
   M D.txt
   M b.txt
   $ hg debugrevlogindex b.txt
      rev linkrev nodeid       p1           p2
        0       2 05b806ebe5ea 000000000000 000000000000
        1       3 a58b36ad6b65 05b806ebe5ea 000000000000
@@ -216,17 +216,17 @@
   $ hg debugrevlogindex D.txt
      rev linkrev nodeid       p1           p2
        0       6 2a8d3833f2fb 000000000000 000000000000
        1       7 2a80419dfc31 2a8d3833f2fb 000000000000
 
 Test the --paranoid option
   $ hg debug-repair-issue6528 --dry-run --paranoid
-  found affected revision 1 for filelog 'data/D.txt.i'
-  found affected revision 1 for filelog 'data/b.txt.i'
-  found affected revision 3 for filelog 'data/b.txt.i'
+  found affected revision 1 for file 'D.txt'
+  found affected revision 1 for file 'b.txt'
+  found affected revision 3 for file 'b.txt'
   $ hg st
   M D.txt
   M b.txt
   $ hg debugrevlogindex b.txt
      rev linkrev nodeid       p1           p2
        0       2 05b806ebe5ea 000000000000 000000000000
        1       3 a58b36ad6b65 05b806ebe5ea 000000000000
@@ -235,18 +235,18 @@
   $ hg debugrevlogindex D.txt
      rev linkrev nodeid       p1           p2
        0       6 2a8d3833f2fb 000000000000 000000000000
        1       7 2a80419dfc31 2a8d3833f2fb 000000000000
 
 Run the fix
   $ hg debug-repair-issue6528
-  found affected revision 1 for filelog 'data/D.txt.i'
+  found affected revision 1 for file 'D.txt'
   repaired revision 1 of 'filelog data/D.txt.i'
-  found affected revision 1 for filelog 'data/b.txt.i'
-  found affected revision 3 for filelog 'data/b.txt.i'
+  found affected revision 1 for file 'b.txt'
+  found affected revision 3 for file 'b.txt'
   repaired revision 1 of 'filelog data/b.txt.i'
   repaired revision 3 of 'filelog data/b.txt.i'
 
 Check that the fix worked and that running it twice does nothing
   $ hg st
   $ hg debugrevlogindex b.txt
      rev linkrev nodeid       p1           p2
@@ -277,17 +277,17 @@
 
   $ cd ..
   $ mkdir repo-to-fix-report
   $ cd repo-to-fix
   $ tar -xf - < "$TESTDIR"/bundles/issue6528.tar
 
   $ hg debug-repair-issue6528 --to-report $TESTTMP/report.txt
-  found affected revision 1 for filelog 'data/D.txt.i'
-  found affected revision 1 for filelog 'data/b.txt.i'
-  found affected revision 3 for filelog 'data/b.txt.i'
+  found affected revision 1 for file 'D.txt'
+  found affected revision 1 for file 'b.txt'
+  found affected revision 3 for file 'b.txt'
   $ cat $TESTTMP/report.txt
   2a80419dfc31d7dfb308ac40f3f138282de7d73b D.txt
   a58b36ad6b6545195952793099613c2116f3563b,ea4f2f2463cca5b29ddf3461012b8ce5c6dac175 b.txt
 
   $ hg debug-repair-issue6528 --from-report $TESTTMP/report.txt --dry-run
   loading report file '$TESTTMP/report.txt'
   found affected revision 1 for filelog 'D.txt'
@@ -388,18 +388,18 @@
      rev linkrev nodeid       p1           p2
        0       6 2a8d3833f2fb 000000000000 000000000000
        1       7 2a80419dfc31 2a8d3833f2fb 000000000000
        2       8 65aecc89bb5d 2a80419dfc31 000000000000
 
 Run the fix on the non-inline revlog
   $ hg debug-repair-issue6528
-  found affected revision 1 for filelog 'data/D.txt.i'
+  found affected revision 1 for file 'D.txt'
   repaired revision 1 of 'filelog data/D.txt.i'
-  found affected revision 1 for filelog 'data/b.txt.i'
-  found affected revision 3 for filelog 'data/b.txt.i'
+  found affected revision 1 for file 'b.txt'
+  found affected revision 3 for file 'b.txt'
   repaired revision 1 of 'filelog data/b.txt.i'
   repaired revision 3 of 'filelog data/b.txt.i'
 
 Check that it worked
   $ hg debugrevlogindex b.txt
      rev linkrev nodeid       p1           p2
        0       2 05b806ebe5ea 000000000000 000000000000
@@ -552,17 +552,17 @@
   $ hg status
   M D.txt (?)
   M b.txt (?)
 
 And that the repair command find issue to fix.
 
   $ hg debug-repair-issue6528 --dry-run
-  found affected revision 1 for filelog 'data/D.txt.i'
-  found affected revision 1 for filelog 'data/b.txt.i'
-  found affected revision 3 for filelog 'data/b.txt.i'
+  found affected revision 1 for file 'D.txt'
+  found affected revision 1 for file 'b.txt'
+  found affected revision 3 for file 'b.txt'
 
   $ cd ..
 
 from a v2 bundle
 ~~~~~~~~~~~~~~~~
 
   $ hg debugbundle --spec "$TESTDIR"/bundles/issue6528.hg-v2
@@ -600,12 +600,12 @@
   $ hg status
   M D.txt (?)
   M b.txt (?)
 
 And that the repair command find issue to fix.
 
   $ hg debug-repair-issue6528 --dry-run
-  found affected revision 1 for filelog 'data/D.txt.i'
-  found affected revision 1 for filelog 'data/b.txt.i'
-  found affected revision 3 for filelog 'data/b.txt.i'
+  found affected revision 1 for file 'D.txt'
+  found affected revision 1 for file 'b.txt'
+  found affected revision 3 for file 'b.txt'
 
   $ cd ..
```

### Comparing `mercurial-6.4rc0/tests/test-issue660.t` & `mercurial-6.5rc0/tests/test-issue660.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue6642.t` & `mercurial-6.5rc0/tests/test-issue6642.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue672.t` & `mercurial-6.5rc0/tests/test-issue672.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-issue842.t` & `mercurial-6.5rc0/tests/test-issue842.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-journal-exists.t` & `mercurial-6.5rc0/tests/test-journal-exists.t`

 * *Files 6% similar despite different names*

```diff
@@ -43,13 +43,13 @@
 
 #if unix-permissions no-root
   $ hg bundle -qa repo.hg
   $ chmod -w foo/.hg/store/00changelog.i
 
   $ hg -R foo unbundle repo.hg
   adding changesets
-  abort: Permission denied: '$TESTTMP/repo/foo/.hg/store/.00changelog.i-*' (glob)
+  abort: $EACCES$: '$TESTTMP/repo/foo/.hg/store/.00changelog.i-*' (glob)
   [255]
 
   $ if test -f foo/.hg/store/journal; then echo 'journal exists :-('; fi
 #endif
```

### Comparing `mercurial-6.4rc0/tests/test-journal-share.t` & `mercurial-6.5rc0/tests/test-journal-share.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-journal.t` & `mercurial-6.5rc0/tests/test-journal.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-keyword.t` & `mercurial-6.5rc0/tests/test-keyword.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-known.t` & `mercurial-6.5rc0/tests/test-known.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-largefiles-cache.t` & `mercurial-6.5rc0/tests/test-largefiles-cache.t`

 * *Files 2% similar despite different names*

```diff
@@ -180,20 +180,19 @@
 conditional above.
   $ hash=`hg -R share_dst cat share_dst/.hglf/large`
   $ echo $hash
   e2fb5f2139d086ded2cb600d5a91a196e76bf020
 
   $ find share_dst/.hg/largefiles/* | sort
   share_dst/.hg/largefiles/dirstate
-  share_dst/.hg/largefiles/undo.backup.dirstate
+  share_dst/.hg/largefiles/undo.backup.dirstate.bck
 
   $ find src/.hg/largefiles/* | egrep "(dirstate|$hash)" | sort
   src/.hg/largefiles/dirstate
   src/.hg/largefiles/e2fb5f2139d086ded2cb600d5a91a196e76bf020
-  src/.hg/largefiles/undo.backup.dirstate
 
 Verify that backwards compatibility is maintained for old storage layout
   $ mv src/.hg/largefiles/$hash share_dst/.hg/largefiles
   $ hg verify --quiet --lfa -R share_dst --config largefiles.usercache=
 
 Inject corruption into the largefiles store and see how update handles that:
```

### Comparing `mercurial-6.4rc0/tests/test-largefiles-misc.t` & `mercurial-6.5rc0/tests/test-largefiles-misc.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-largefiles-small-disk.t` & `mercurial-6.5rc0/tests/test-largefiles-small-disk.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-largefiles-update.t` & `mercurial-6.5rc0/tests/test-largefiles-update.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-largefiles-wireproto.t` & `mercurial-6.5rc0/tests/test-largefiles-wireproto.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-largefiles.t` & `mercurial-6.5rc0/tests/test-largefiles.t`

 * *Files 0% similar despite different names*

```diff
@@ -1110,24 +1110,24 @@
   repository tip rolled back to revision 1 (undo pull)
   $ hg pull -v --lfrev 'heads(pulled())+min(pulled())'
   pulling from $TESTTMP/a
   searching for changes
   all local changesets known remotely
   6 changesets found
   uncompressed size of bundle content:
-      1389 (changelog)
-      1698 (manifests)
-       254  .hglf/large1
-       564  .hglf/large3
-       572  .hglf/sub/large4
-       182  .hglf/sub2/large6
-       182  .hglf/sub2/large7
-       212  normal1
-       457  normal3
-       465  sub/normal4
+      1401 (changelog)
+      1710 (manifests)
+       256  .hglf/large1
+       570  .hglf/large3
+       578  .hglf/sub/large4
+       184  .hglf/sub2/large6
+       184  .hglf/sub2/large7
+       214  normal1
+       463  normal3
+       471  sub/normal4
   adding changesets
   adding manifests
   adding file changes
   added 6 changesets with 16 changes to 8 files
   new changesets 51a0ae4d5864:daea875e9014 (6 drafts)
   calling hook changegroup.lfiles: hgext.largefiles.reposetup.checkrequireslfiles
   (run 'hg update' to get a working copy)
```

### Comparing `mercurial-6.4rc0/tests/test-legacy-exit-code.t` & `mercurial-6.5rc0/tests/test-legacy-exit-code.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-lfconvert.t` & `mercurial-6.5rc0/tests/test-lfconvert.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-lfs-bundle.t` & `mercurial-6.5rc0/tests/test-lfs-bundle.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-lfs-largefiles.t` & `mercurial-6.5rc0/tests/test-lfs-largefiles.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-lfs-pointer.py` & `mercurial-6.5rc0/tests/test-lfs-pointer.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-lfs-pointer.py.out` & `mercurial-6.5rc0/tests/test-lfs-pointer.py.out`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-lfs-serve-access.t` & `mercurial-6.5rc0/tests/test-lfs-serve-access.t`

 * *Files 13% similar despite different names*

```diff
@@ -62,15 +62,15 @@
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=capabilities HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=batch HTTP/1.1" 200 - x-hgarg-1:cmds=heads+%3Bknown+nodes%3D525251863cad618e55d483555f3d00a2ca99597e x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=listkeys HTTP/1.1" 200 - x-hgarg-1:namespace=phases x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=listkeys HTTP/1.1" 200 - x-hgarg-1:namespace=bookmarks x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "POST /.git/info/lfs/objects/batch HTTP/1.1" 400 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=capabilities HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=batch HTTP/1.1" 200 - x-hgarg-1:cmds=heads+%3Bknown+nodes%3D x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
-  $LOCALIP - - [$LOGDATE$] "GET /?cmd=getbundle HTTP/1.1" 200 - x-hgarg-1:bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Acheckheads%253Drelated%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Aphases%253Dheads%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps%250Astream%253Dv2&cg=1&common=0000000000000000000000000000000000000000&heads=525251863cad618e55d483555f3d00a2ca99597e&listkeys=bookmarks&phases=1 x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
+  $LOCALIP - - [$LOGDATE$] "GET /?cmd=getbundle HTTP/1.1" 200 - x-hgarg-1:bookmarks=1&$USUAL_BUNDLE_CAPS$&cg=1&common=0000000000000000000000000000000000000000&heads=525251863cad618e55d483555f3d00a2ca99597e&listkeys=bookmarks&phases=1 x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "POST /.git/info/lfs/objects/batch HTTP/1.1" 400 - (glob)
 
   $ rm -f $TESTTMP/access.log $TESTTMP/errors.log
   $ hg --config "lfs.usercache=$TESTTMP/servercache" -R server serve -d \
   >    -p $HGPORT --pid-file=hg.pid --prefix=subdir/mount/point \
   >    -A $TESTTMP/access.log -E $TESTTMP/errors.log
   $ cat hg.pid >> $DAEMON_PIDS
@@ -161,15 +161,15 @@
 
   $ "$PYTHON" $RUNTESTDIR/killdaemons.py $DAEMON_PIDS
 
   $ cat $TESTTMP/access.log $TESTTMP/errors.log
   $LOCALIP - - [$LOGDATE$] "POST /missing/objects/batch HTTP/1.1" 404 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /subdir/mount/point?cmd=capabilities HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /subdir/mount/point?cmd=batch HTTP/1.1" 200 - x-hgarg-1:cmds=heads+%3Bknown+nodes%3D x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
-  $LOCALIP - - [$LOGDATE$] "GET /subdir/mount/point?cmd=getbundle HTTP/1.1" 200 - x-hgarg-1:bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Acheckheads%253Drelated%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Aphases%253Dheads%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps%250Astream%253Dv2&cg=1&common=0000000000000000000000000000000000000000&heads=525251863cad618e55d483555f3d00a2ca99597e&listkeys=bookmarks&phases=1 x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
+  $LOCALIP - - [$LOGDATE$] "GET /subdir/mount/point?cmd=getbundle HTTP/1.1" 200 - x-hgarg-1:bookmarks=1&$USUAL_BUNDLE_CAPS$&cg=1&common=0000000000000000000000000000000000000000&heads=525251863cad618e55d483555f3d00a2ca99597e&listkeys=bookmarks&phases=1 x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "POST /subdir/mount/point/.git/info/lfs/objects/batch HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /subdir/mount/point/.hg/lfs/objects/f03217a32529a28a42d03b1244fe09b6e0f9fd06d7b966d4d50567be2abe6c0e HTTP/1.1" 200 - (glob)
 
 Blobs that already exist in the usercache are linked into the repo store, even
 though the client doesn't send the blob.
 
   $ hg init server2
@@ -307,15 +307,15 @@
   [50]
 
   $ "$PYTHON" $RUNTESTDIR/killdaemons.py $DAEMON_PIDS
 
   $ cat $TESTTMP/access.log
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=capabilities HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=batch HTTP/1.1" 200 - x-hgarg-1:cmds=heads+%3Bknown+nodes%3D x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
-  $LOCALIP - - [$LOGDATE$] "GET /?cmd=getbundle HTTP/1.1" 200 - x-hgarg-1:bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Acheckheads%253Drelated%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Aphases%253Dheads%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps%250Astream%253Dv2&cg=1&common=0000000000000000000000000000000000000000&heads=525251863cad618e55d483555f3d00a2ca99597e&listkeys=bookmarks&phases=1 x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
+  $LOCALIP - - [$LOGDATE$] "GET /?cmd=getbundle HTTP/1.1" 200 - x-hgarg-1:bookmarks=1&$USUAL_BUNDLE_CAPS$&cg=1&common=0000000000000000000000000000000000000000&heads=525251863cad618e55d483555f3d00a2ca99597e&listkeys=bookmarks&phases=1 x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "POST /.git/info/lfs/objects/batch HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=capabilities HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=batch HTTP/1.1" 200 - x-hgarg-1:cmds=heads+%3Bknown+nodes%3D392c05922088bacf8e68a6939b480017afbf245d x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=listkeys HTTP/1.1" 200 - x-hgarg-1:namespace=phases x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=listkeys HTTP/1.1" 200 - x-hgarg-1:namespace=bookmarks x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=branchmap HTTP/1.1" 200 - x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=listkeys HTTP/1.1" 200 - x-hgarg-1:namespace=bookmarks x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
@@ -326,15 +326,15 @@
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=listkeys HTTP/1.1" 200 - x-hgarg-1:namespace=bookmarks x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=branchmap HTTP/1.1" 200 - x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=listkeys HTTP/1.1" 200 - x-hgarg-1:namespace=bookmarks x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "POST /.git/info/lfs/objects/batch HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "PUT /.hg/lfs/objects/b5bb9d8014a0f9b1d61e21e796d78dccdf1352f23cd32812f4850b878ae4944c HTTP/1.1" 422 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=capabilities HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=batch HTTP/1.1" 200 - x-hgarg-1:cmds=heads+%3Bknown+nodes%3D392c05922088bacf8e68a6939b480017afbf245d x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
-  $LOCALIP - - [$LOGDATE$] "GET /?cmd=getbundle HTTP/1.1" 200 - x-hgarg-1:bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Acheckheads%253Drelated%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Aphases%253Dheads%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps%250Astream%253Dv2&cg=1&common=525251863cad618e55d483555f3d00a2ca99597e&heads=506bf3d83f78c54b89e81c6411adee19fdf02156+525251863cad618e55d483555f3d00a2ca99597e&listkeys=bookmarks&phases=1 x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
+  $LOCALIP - - [$LOGDATE$] "GET /?cmd=getbundle HTTP/1.1" 200 - x-hgarg-1:bookmarks=1&$USUAL_BUNDLE_CAPS$&cg=1&common=525251863cad618e55d483555f3d00a2ca99597e&heads=506bf3d83f78c54b89e81c6411adee19fdf02156+525251863cad618e55d483555f3d00a2ca99597e&listkeys=bookmarks&phases=1 x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "POST /.git/info/lfs/objects/batch HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /.hg/lfs/objects/276f73cfd75f9fb519810df5f5d96d6594ca2521abd86cbcd92122f7d51a1f3d HTTP/1.1" 500 - (glob)
   $LOCALIP - - [$LOGDATE$] "POST /.git/info/lfs/objects/batch HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /.hg/lfs/objects/276f73cfd75f9fb519810df5f5d96d6594ca2521abd86cbcd92122f7d51a1f3d HTTP/1.1" 422 - (glob)
 
   $ grep -v '  File "' $TESTTMP/errors.log
   $LOCALIP - - [$ERRDATE$] HG error:  Exception happened while processing request '/.git/info/lfs/objects/batch': (glob)
@@ -483,15 +483,15 @@
 
   $ "$PYTHON" $RUNTESTDIR/killdaemons.py $DAEMON_PIDS
 
   $ cat $TESTTMP/access.log $TESTTMP/errors.log
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=capabilities HTTP/1.1" 401 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=capabilities HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=batch HTTP/1.1" 200 - x-hgarg-1:cmds=heads+%3Bknown+nodes%3D x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
-  $LOCALIP - - [$LOGDATE$] "GET /?cmd=getbundle HTTP/1.1" 200 - x-hgarg-1:bookmarks=1&bundlecaps=HG20%2Cbundle2%3DHG20%250Abookmarks%250Achangegroup%253D01%252C02%252C03%250Acheckheads%253Drelated%250Adigests%253Dmd5%252Csha1%252Csha512%250Aerror%253Dabort%252Cunsupportedcontent%252Cpushraced%252Cpushkey%250Ahgtagsfnodes%250Alistkeys%250Aphases%253Dheads%250Apushkey%250Aremote-changegroup%253Dhttp%252Chttps%250Astream%253Dv2&cg=1&common=0000000000000000000000000000000000000000&heads=506bf3d83f78c54b89e81c6411adee19fdf02156+525251863cad618e55d483555f3d00a2ca99597e&listkeys=bookmarks&phases=1 x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
+  $LOCALIP - - [$LOGDATE$] "GET /?cmd=getbundle HTTP/1.1" 200 - x-hgarg-1:bookmarks=1&$USUAL_BUNDLE_CAPS$&cg=1&common=0000000000000000000000000000000000000000&heads=506bf3d83f78c54b89e81c6411adee19fdf02156+525251863cad618e55d483555f3d00a2ca99597e&listkeys=bookmarks&phases=1 x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull (glob)
   $LOCALIP - - [$LOGDATE$] "POST /.git/info/lfs/objects/batch HTTP/1.1" 401 - (glob)
   $LOCALIP - - [$LOGDATE$] "POST /.git/info/lfs/objects/batch HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /.hg/lfs/objects/276f73cfd75f9fb519810df5f5d96d6594ca2521abd86cbcd92122f7d51a1f3d HTTP/1.1" 200 - (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=capabilities HTTP/1.1" 401 - x-hgtest-authtype:Digest (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=capabilities HTTP/1.1" 200 - x-hgtest-authtype:Digest (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=batch HTTP/1.1" 401 - x-hgarg-1:cmds=heads+%3Bknown+nodes%3D525251863cad618e55d483555f3d00a2ca99597e+4d9397055dc0c205f3132f331f36353ab1a525a3 x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull x-hgtest-authtype:Digest (glob)
   $LOCALIP - - [$LOGDATE$] "GET /?cmd=batch HTTP/1.1" 200 - x-hgarg-1:cmds=heads+%3Bknown+nodes%3D525251863cad618e55d483555f3d00a2ca99597e+4d9397055dc0c205f3132f331f36353ab1a525a3 x-hgproto-1:0.1 0.2 comp=$USUAL_COMPRESSIONS$ partial-pull x-hgtest-authtype:Digest (glob)
```

### Comparing `mercurial-6.4rc0/tests/test-lfs-serve.t` & `mercurial-6.5rc0/tests/test-lfs-serve.t`

 * *Files 2% similar despite different names*

```diff
@@ -304,17 +304,22 @@
 
 TODO: fail more gracefully.
 
   $ hg init $TESTTMP/client4_pull
   $ hg -R $TESTTMP/client4_pull pull http://localhost:$HGPORT
   pulling from http://localhost:$HGPORT/
   requesting all changes
-  remote: abort: no common changegroup version
-  abort: pull failed on remote
-  [100]
+  adding changesets
+  adding manifests
+  adding file changes
+  transaction abort!
+  rollback completed
+  abort: missing processor for flag '0x2000'
+  (the lfs extension must be enabled)
+  [50]
   $ hg debugrequires -R $TESTTMP/client4_pull/ | grep 'lfs'
   [1]
   $ hg debugrequires -R $SERVER_PATH --config extensions.lfs= | grep 'lfs'
   lfs
 
   $ hg identify http://localhost:$HGPORT
   03b080fa9d93
```

### Comparing `mercurial-6.4rc0/tests/test-lfs-test-server.t` & `mercurial-6.5rc0/tests/test-lfs-test-server.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-lfs.t` & `mercurial-6.5rc0/tests/test-lfs.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-linelog.py` & `mercurial-6.5rc0/tests/test-linelog.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-linerange.py` & `mercurial-6.5rc0/tests/test-linerange.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-locate.t` & `mercurial-6.5rc0/tests/test-locate.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-lock-badness.t` & `mercurial-6.5rc0/tests/test-lock-badness.t`

 * *Files 1% similar despite different names*

```diff
@@ -131,11 +131,11 @@
 Pushing to a local read-only repo that can't be locked
 
   $ chmod 100 a/.hg/store
 
   $ hg -R b push a
   pushing to a
   searching for changes
-  abort: could not lock repository a: Permission denied
+  abort: could not lock repository a: $EACCES$
   [20]
 
   $ chmod 700 a/.hg/store
```

### Comparing `mercurial-6.4rc0/tests/test-lock.py` & `mercurial-6.5rc0/tests/test-lock.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-log-bookmark.t` & `mercurial-6.5rc0/tests/test-log-bookmark.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-log-exthook.t` & `mercurial-6.5rc0/tests/test-log-exthook.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-log-linerange.t` & `mercurial-6.5rc0/tests/test-log-linerange.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-log.t` & `mercurial-6.5rc0/tests/test-log.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-logexchange.t` & `mercurial-6.5rc0/tests/test-logexchange.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-logtoprocess.t` & `mercurial-6.5rc0/tests/test-logtoprocess.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-lrucachedict.py` & `mercurial-6.5rc0/tests/test-lrucachedict.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mac-packages.t` & `mercurial-6.5rc0/tests/test-mac-packages.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mactext.t` & `mercurial-6.5rc0/tests/test-mactext.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mailmap.t` & `mercurial-6.5rc0/tests/test-mailmap.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-manifest-merging.t` & `mercurial-6.5rc0/tests/test-manifest-merging.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-manifest.py` & `mercurial-6.5rc0/tests/test-manifest.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-manifest.t` & `mercurial-6.5rc0/tests/test-manifest.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-match.py` & `mercurial-6.5rc0/tests/test-match.py`

 * *Files 1% similar despite different names*

```diff
@@ -136,14 +136,36 @@
         self.assertEqual(m.visitchildrenset(b''), b'this')
         self.assertEqual(m.visitchildrenset(b'folder'), set())
         self.assertEqual(m.visitchildrenset(b'dir'), b'this')
         # OPT: these should probably be set().
         self.assertEqual(m.visitchildrenset(b'dir/subdir'), b'this')
         self.assertEqual(m.visitchildrenset(b'dir/subdir/x'), b'this')
 
+    def testVisitdirFilepath(self):
+        m = matchmod.match(
+            util.localpath(b'/repo'), b'', patterns=[b'filepath:dir/z']
+        )
+        assert isinstance(m, matchmod.patternmatcher)
+        self.assertTrue(m.visitdir(b''))
+        self.assertTrue(m.visitdir(b'dir'))
+        self.assertFalse(m.visitdir(b'folder'))
+        self.assertFalse(m.visitdir(b'dir/subdir'))
+        self.assertFalse(m.visitdir(b'dir/subdir/x'))
+
+    def testVisitchildrensetFilepath(self):
+        m = matchmod.match(
+            util.localpath(b'/repo'), b'', patterns=[b'filepath:dir/z']
+        )
+        assert isinstance(m, matchmod.patternmatcher)
+        self.assertEqual(m.visitchildrenset(b''), b'this')
+        self.assertEqual(m.visitchildrenset(b'folder'), set())
+        self.assertEqual(m.visitchildrenset(b'dir'), b'this')
+        self.assertEqual(m.visitchildrenset(b'dir/subdir'), set())
+        self.assertEqual(m.visitchildrenset(b'dir/subdir/x'), set())
+
 
 class IncludeMatcherTests(unittest.TestCase):
     def testVisitdirPrefix(self):
         m = matchmod.match(
             util.localpath(b'/repo'), b'', include=[b'path:dir/subdir']
         )
         assert isinstance(m, matchmod.includematcher)
@@ -208,14 +230,36 @@
         self.assertEqual(m.visitchildrenset(b''), {b'dir'})
         self.assertEqual(m.visitchildrenset(b'folder'), set())
         self.assertEqual(m.visitchildrenset(b'dir'), b'this')
         # OPT: these should probably be set().
         self.assertEqual(m.visitchildrenset(b'dir/subdir'), b'this')
         self.assertEqual(m.visitchildrenset(b'dir/subdir/x'), b'this')
 
+    def testVisitdirFilepath(self):
+        m = matchmod.match(
+            util.localpath(b'/repo'), b'', include=[b'filepath:dir/z']
+        )
+        assert isinstance(m, matchmod.includematcher)
+        self.assertTrue(m.visitdir(b''))
+        self.assertTrue(m.visitdir(b'dir'))
+        self.assertFalse(m.visitdir(b'folder'))
+        self.assertFalse(m.visitdir(b'dir/subdir'))
+        self.assertFalse(m.visitdir(b'dir/subdir/x'))
+
+    def testVisitchildrensetFilepath(self):
+        m = matchmod.match(
+            util.localpath(b'/repo'), b'', include=[b'filepath:dir/z']
+        )
+        assert isinstance(m, matchmod.includematcher)
+        self.assertEqual(m.visitchildrenset(b''), {b'dir'})
+        self.assertEqual(m.visitchildrenset(b'folder'), set())
+        self.assertEqual(m.visitchildrenset(b'dir'), {b'z'})
+        self.assertEqual(m.visitchildrenset(b'dir/subdir'), set())
+        self.assertEqual(m.visitchildrenset(b'dir/subdir/x'), set())
+
 
 class ExactMatcherTests(unittest.TestCase):
     def testVisitdir(self):
         m = matchmod.exact(files=[b'dir/subdir/foo.txt'])
         assert isinstance(m, matchmod.exactmatcher)
         self.assertTrue(m.visitdir(b''))
         self.assertTrue(m.visitdir(b'dir'))
```

### Comparing `mercurial-6.4rc0/tests/test-mdiff.py` & `mercurial-6.5rc0/tests/test-mdiff.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-changedelete.t` & `mercurial-6.5rc0/tests/test-merge-changedelete.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-closedheads.t` & `mercurial-6.5rc0/tests/test-merge-closedheads.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-combination-exec-bytes.t` & `mercurial-6.5rc0/tests/test-merge-combination-exec-bytes.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-combination-file-content.t` & `mercurial-6.5rc0/tests/test-merge-combination-file-content.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-combination-misc.t` & `mercurial-6.5rc0/tests/test-merge-combination-misc.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-commit.t` & `mercurial-6.5rc0/tests/test-merge-commit.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-criss-cross.t` & `mercurial-6.5rc0/tests/test-merge-criss-cross.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-default.t` & `mercurial-6.5rc0/tests/test-merge-default.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-exec.t` & `mercurial-6.5rc0/tests/test-merge-exec.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-force.t` & `mercurial-6.5rc0/tests/test-merge-force.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-halt.t` & `mercurial-6.5rc0/tests/test-merge-halt.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-internal-tools-pattern.t` & `mercurial-6.5rc0/tests/test-merge-internal-tools-pattern.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-local.t` & `mercurial-6.5rc0/tests/test-merge-local.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-no-file-change.t` & `mercurial-6.5rc0/tests/test-merge-no-file-change.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-partial-tool.t` & `mercurial-6.5rc0/tests/test-merge-partial-tool.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-remove.t` & `mercurial-6.5rc0/tests/test-merge-remove.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-revert.t` & `mercurial-6.5rc0/tests/test-merge-revert.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-revert2.t` & `mercurial-6.5rc0/tests/test-merge-revert2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-subrepos.t` & `mercurial-6.5rc0/tests/test-merge-subrepos.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-symlinks.t` & `mercurial-6.5rc0/tests/test-merge-symlinks.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-tools.t` & `mercurial-6.5rc0/tests/test-merge-tools.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge-types.t` & `mercurial-6.5rc0/tests/test-merge-types.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge1.t` & `mercurial-6.5rc0/tests/test-merge1.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge10.t` & `mercurial-6.5rc0/tests/test-merge10.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge2.t` & `mercurial-6.5rc0/tests/test-merge2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge4.t` & `mercurial-6.5rc0/tests/test-merge4.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge5.t` & `mercurial-6.5rc0/tests/test-merge5.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge6.t` & `mercurial-6.5rc0/tests/test-merge6.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge7.t` & `mercurial-6.5rc0/tests/test-merge7.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge8.t` & `mercurial-6.5rc0/tests/test-merge8.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-merge9.t` & `mercurial-6.5rc0/tests/test-merge9.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-minifileset.py` & `mercurial-6.5rc0/tests/test-minifileset.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-minirst.py` & `mercurial-6.5rc0/tests/test-minirst.py`

 * *Files 0% similar despite different names*

```diff
@@ -150,15 +150,15 @@
 marker after the option. It is treated as a normal paragraph:
 
 --foo bar baz
 """
 
 debugformats('options', options)
 
-fields = b"""
+fields = br"""
 :a: First item.
 :ab: Second item. Indentation and wrapping
      is handled automatically.
 :c\:d: a key with colon
 :efg\:\:hh: a key with many colon
 
 Next list:
```

### Comparing `mercurial-6.4rc0/tests/test-minirst.py.out` & `mercurial-6.5rc0/tests/test-minirst.py.out`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-missing-capability.t` & `mercurial-6.5rc0/tests/test-missing-capability.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-eol.t` & `mercurial-6.5rc0/tests/test-mq-eol.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-git.t` & `mercurial-6.5rc0/tests/test-mq-git.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-guards.t` & `mercurial-6.5rc0/tests/test-mq-guards.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-header-date.t` & `mercurial-6.5rc0/tests/test-mq-header-date.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-header-from.t` & `mercurial-6.5rc0/tests/test-mq-header-from.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-merge.t` & `mercurial-6.5rc0/tests/test-mq-merge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-missingfiles.t` & `mercurial-6.5rc0/tests/test-mq-missingfiles.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-pull-from-bundle.t` & `mercurial-6.5rc0/tests/test-mq-pull-from-bundle.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qclone-http.t` & `mercurial-6.5rc0/tests/test-mq-qclone-http.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qdelete.t` & `mercurial-6.5rc0/tests/test-mq-qdelete.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qdiff.t` & `mercurial-6.5rc0/tests/test-mq-qdiff.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qfold.t` & `mercurial-6.5rc0/tests/test-mq-qfold.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qgoto.t` & `mercurial-6.5rc0/tests/test-mq-qgoto.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qimport-fail-cleanup.t` & `mercurial-6.5rc0/tests/test-mq-qimport-fail-cleanup.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qimport.t` & `mercurial-6.5rc0/tests/test-mq-qimport.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qnew.t` & `mercurial-6.5rc0/tests/test-mq-qnew.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qpush-exact.t` & `mercurial-6.5rc0/tests/test-mq-qpush-exact.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qpush-fail.t` & `mercurial-6.5rc0/tests/test-mq-qpush-fail.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qqueue.t` & `mercurial-6.5rc0/tests/test-mq-qqueue.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qrefresh-interactive.t` & `mercurial-6.5rc0/tests/test-mq-qrefresh-interactive.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qrefresh-replace-log-message.t` & `mercurial-6.5rc0/tests/test-mq-qrefresh-replace-log-message.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qrefresh.t` & `mercurial-6.5rc0/tests/test-mq-qrefresh.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-qrename.t` & `mercurial-6.5rc0/tests/test-mq-qrename.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-safety.t` & `mercurial-6.5rc0/tests/test-mq-safety.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-subrepo-svn.t` & `mercurial-6.5rc0/tests/test-mq-subrepo-svn.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-subrepo.t` & `mercurial-6.5rc0/tests/test-mq-subrepo.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq-symlinks.t` & `mercurial-6.5rc0/tests/test-mq-symlinks.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mq.t` & `mercurial-6.5rc0/tests/test-mq.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-mv-cp-st-diff.t` & `mercurial-6.5rc0/tests/test-mv-cp-st-diff.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-acl.t` & `mercurial-6.5rc0/tests/test-narrow-acl.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-archive.t` & `mercurial-6.5rc0/tests/test-narrow-archive.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-clone-no-ellipsis.t` & `mercurial-6.5rc0/tests/test-narrow-clone-no-ellipsis.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-clone-non-narrow-server.t` & `mercurial-6.5rc0/tests/test-narrow-clone-non-narrow-server.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-clone-nonlinear.t` & `mercurial-6.5rc0/tests/test-narrow-clone-nonlinear.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-clone-stream.t` & `mercurial-6.5rc0/tests/test-narrow-clone-stream.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-clone.t` & `mercurial-6.5rc0/tests/test-narrow-clone.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-commit.t` & `mercurial-6.5rc0/tests/test-narrow-commit.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-copies.t` & `mercurial-6.5rc0/tests/test-narrow-copies.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-debugcommands.t` & `mercurial-6.5rc0/tests/test-narrow-debugcommands.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-debugrebuilddirstate.t` & `mercurial-6.5rc0/tests/test-narrow-debugrebuilddirstate.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-exchange-merges.t` & `mercurial-6.5rc0/tests/test-narrow-exchange-merges.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-exchange.t` & `mercurial-6.5rc0/tests/test-narrow-exchange.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-expanddirstate.t` & `mercurial-6.5rc0/tests/test-narrow-expanddirstate.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-merge-outside.t` & `mercurial-6.5rc0/tests/test-narrow-merge-outside.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-merge.t` & `mercurial-6.5rc0/tests/test-narrow-merge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-patch.t` & `mercurial-6.5rc0/tests/test-narrow-patch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-patterns.t` & `mercurial-6.5rc0/tests/test-narrow-patterns.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-pull.t` & `mercurial-6.5rc0/tests/test-narrow-pull.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-rebase.t` & `mercurial-6.5rc0/tests/test-narrow-rebase.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-shallow-merges.t` & `mercurial-6.5rc0/tests/test-narrow-shallow-merges.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-shallow.t` & `mercurial-6.5rc0/tests/test-narrow-shallow.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-share.t` & `mercurial-6.5rc0/tests/test-narrow-share.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-sparse.t` & `mercurial-6.5rc0/tests/test-narrow-sparse.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-strip.t` & `mercurial-6.5rc0/tests/test-narrow-strip.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-trackedcmd.t` & `mercurial-6.5rc0/tests/test-narrow-trackedcmd.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-update.t` & `mercurial-6.5rc0/tests/test-narrow-update.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-widen-no-ellipsis.t` & `mercurial-6.5rc0/tests/test-narrow-widen-no-ellipsis.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow-widen.t` & `mercurial-6.5rc0/tests/test-narrow-widen.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-narrow.t` & `mercurial-6.5rc0/tests/test-narrow.t`

 * *Files 1% similar despite different names*

```diff
@@ -69,22 +69,16 @@
   added 1 changesets with 0 changes to 0 files
   new changesets * (glob)
   updating to branch default
   0 files updated, 0 files merged, 0 files removed, 0 files unresolved
 
 The "narrow" repo requirement is ignored by [debugupgraderepo]
 
-#if tree
-  $ (cd should-work; hg debugupgraderepo)
-  abort: cannot upgrade repository; unsupported source requirement: treemanifest
-  [255]
-#else
   $ (cd should-work; hg debugupgraderepo | grep 'no format upgrades found in existing repository')
   (no format upgrades found in existing repository)
-#endif
 
 Test repo with local changes
   $ hg clone --narrow ssh://user@dummy/master narrow-local-changes --include d0 --include d3 --include d6
   requesting all changes
   adding changesets
   adding manifests
   adding file changes
@@ -488,22 +482,22 @@
   obsoleted 1 changesets
   $ echo n | hg tracked --auto-remove-includes --config ui.interactive=yes
   comparing with ssh://user@dummy/master
   searching for changes
   looking for unused includes to remove
   path:d0
   path:d2
-  remove these unused includes (yn)? n
+  remove these unused includes (Yn)? n
   $ hg tracked --auto-remove-includes
   comparing with ssh://user@dummy/master
   searching for changes
   looking for unused includes to remove
   path:d0
   path:d2
-  remove these unused includes (yn)? y
+  remove these unused includes (Yn)? y
   looking for local changes to affected paths
   moving unwanted changesets to backup
   saved backup bundle to $TESTTMP/narrow-auto-remove/.hg/strip-backup/*-narrow.hg (glob)
   deleting data/d0/f.i
   deleting data/d2/f.i
   deleting meta/d0/00manifest.i (tree !)
   deleting meta/d2/00manifest.i (tree !)
@@ -523,15 +517,15 @@
   $ rm .hg/strip-backup/*
   $ hg tracked --auto-remove-includes --no-backup
   comparing with ssh://user@dummy/master
   searching for changes
   looking for unused includes to remove
   path:d0
   path:d2
-  remove these unused includes (yn)? y
+  remove these unused includes (Yn)? y
   looking for local changes to affected paths
   deleting unwanted changesets
   deleting data/d0/f.i
   deleting data/d2/f.i
   deleting meta/d0/00manifest.i (tree !)
   deleting meta/d2/00manifest.i (tree !)
   deleting unwanted files from working copy
```

### Comparing `mercurial-6.4rc0/tests/test-nested-repo.t` & `mercurial-6.5rc0/tests/test-nested-repo.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-newbranch.t` & `mercurial-6.5rc0/tests/test-newbranch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-newcgi.t` & `mercurial-6.5rc0/tests/test-newcgi.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-newercgi.t` & `mercurial-6.5rc0/tests/test-newercgi.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-no-symlinks.t` & `mercurial-6.5rc0/tests/test-no-symlinks.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-nointerrupt.t` & `mercurial-6.5rc0/tests/test-nointerrupt.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-notify-changegroup.t` & `mercurial-6.5rc0/tests/test-notify-changegroup.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-notify.t` & `mercurial-6.5rc0/tests/test-notify.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-obshistory.t` & `mercurial-6.5rc0/tests/test-obshistory.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-obsmarker-template.t` & `mercurial-6.5rc0/tests/test-obsmarker-template.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-obsmarkers-effectflag.t` & `mercurial-6.5rc0/tests/test-obsmarkers-effectflag.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-obsolete-bounds-checking.t` & `mercurial-6.5rc0/tests/test-obsolete-bounds-checking.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-obsolete-bundle-strip.t` & `mercurial-6.5rc0/tests/test-obsolete-bundle-strip.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-obsolete-changeset-exchange.t` & `mercurial-6.5rc0/tests/test-obsolete-changeset-exchange.t`

 * *Files 2% similar despite different names*

```diff
@@ -160,15 +160,15 @@
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "changegroup" (params: 1 mandatory 1 advisory) supported
   adding changesets
   add changeset bec0734cd68e
   adding manifests
   adding file changes
   adding foo revisions
-  bundle2-input-part: total payload size 476
+  bundle2-input-part: total payload size 486
   bundle2-input-part: "listkeys" (params: 1 mandatory) supported
   bundle2-input-part: "phase-heads" supported
   bundle2-input-part: total payload size 24
   bundle2-input-bundle: 3 parts total
   checking for updated bookmarks
   updating the branch cache
   added 1 changesets with 1 changes to 1 files (+1 heads)
```

### Comparing `mercurial-6.4rc0/tests/test-obsolete-check-push.t` & `mercurial-6.5rc0/tests/test-obsolete-check-push.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-obsolete-checkheads.t` & `mercurial-6.5rc0/tests/test-obsolete-checkheads.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-obsolete-distributed.t` & `mercurial-6.5rc0/tests/test-obsolete-distributed.t`

 * *Files 0% similar despite different names*

```diff
@@ -159,15 +159,15 @@
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "changegroup" (params: 1 mandatory 1 advisory) supported
   adding changesets
   add changeset 391a2bf12b1b
   adding manifests
   adding file changes
   adding c_B1 revisions
-  bundle2-input-part: total payload size 485
+  bundle2-input-part: total payload size 495
   bundle2-input-part: "listkeys" (params: 1 mandatory) supported
   bundle2-input-part: "obsmarkers" supported
   bundle2-input-part: total payload size 143
   bundle2-input-part: "phase-heads" supported
   bundle2-input-part: total payload size 48
   bundle2-input-bundle: 4 parts total
   checking for updated bookmarks
```

### Comparing `mercurial-6.4rc0/tests/test-obsolete-divergent.t` & `mercurial-6.5rc0/tests/test-obsolete-divergent.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-obsolete-tag-cache.t` & `mercurial-6.5rc0/tests/test-obsolete-tag-cache.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-obsolete.t` & `mercurial-6.5rc0/tests/test-obsolete.t`

 * *Files 0% similar despite different names*

```diff
@@ -1596,15 +1596,15 @@
   |
   o  1:e016b03fd86f (draft) [ ] 1
   |
   o  0:a78f55e5508c (draft) [ ] 0
   
   $ hg debugbundle .hg/strip-backup/e008cf283490-*-backup.hg
   Stream params: {Compression: BZ}
-  changegroup -- {nbchanges: 1, version: 02} (mandatory: True)
+  changegroup -- {nbchanges: 1, version: 03} (mandatory: True)
       e008cf2834908e5d6b0f792a9d4b0e2272260fb8
   cache:rev-branch-cache -- {} (mandatory: False)
   phase-heads -- {} (mandatory: True)
       e008cf2834908e5d6b0f792a9d4b0e2272260fb8 draft
 
 #if repobundlerepo
   $ hg pull .hg/strip-backup/e008cf283490-*-backup.hg
@@ -1639,15 +1639,15 @@
   @  0:a78f55e5508c (draft) [tip ] 0
   
   $ hg log -G --hidden
   @  0:a78f55e5508c (draft) [tip ] 0
   
   $ hg debugbundle .hg/strip-backup/e016b03fd86f-*-backup.hg
   Stream params: {Compression: BZ}
-  changegroup -- {nbchanges: 2, version: 02} (mandatory: True)
+  changegroup -- {nbchanges: 2, version: 03} (mandatory: True)
       e016b03fd86fcccc54817d120b90b751aaf367d6
       b0551702f918510f01ae838ab03a463054c67b46
   cache:rev-branch-cache -- {} (mandatory: False)
   obsmarkers -- {} (mandatory: True)
       version: 1 (92 bytes)
       e008cf2834908e5d6b0f792a9d4b0e2272260fb8 b0551702f918510f01ae838ab03a463054c67b46 0 (Thu Jan 01 00:00:00 1970 +0000) {'ef1': '8', 'operation': 'amend', 'user': 'test'}
   phase-heads -- {} (mandatory: True)
```

### Comparing `mercurial-6.4rc0/tests/test-oldcgi.t` & `mercurial-6.5rc0/tests/test-oldcgi.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-origbackup-conflict.t` & `mercurial-6.5rc0/tests/test-origbackup-conflict.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pager-legacy.t` & `mercurial-6.5rc0/tests/test-pager-legacy.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pager.t` & `mercurial-6.5rc0/tests/test-pager.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-parents.t` & `mercurial-6.5rc0/tests/test-parents.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-parse-date.t` & `mercurial-6.5rc0/tests/test-parse-date.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-parseindex.t` & `mercurial-6.5rc0/tests/test-parseindex.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-parseindex2.py` & `mercurial-6.5rc0/tests/test-parseindex2.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-patch-offset.t` & `mercurial-6.5rc0/tests/test-patch-offset.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-patch.t` & `mercurial-6.5rc0/tests/test-patch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-patchbomb-bookmark.t` & `mercurial-6.5rc0/tests/test-patchbomb-bookmark.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-patchbomb-tls.t` & `mercurial-6.5rc0/tests/test-patchbomb-tls.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-patchbomb.t` & `mercurial-6.5rc0/tests/test-patchbomb.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pathconflicts-basic.t` & `mercurial-6.5rc0/tests/test-pathconflicts-basic.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pathconflicts-merge.t` & `mercurial-6.5rc0/tests/test-pathconflicts-merge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pathconflicts-update.t` & `mercurial-6.5rc0/tests/test-pathconflicts-update.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pathencode.py` & `mercurial-6.5rc0/tests/test-pathencode.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-paths.t` & `mercurial-6.5rc0/tests/test-paths.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pending.t` & `mercurial-6.5rc0/tests/test-pending.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-permissions.t` & `mercurial-6.5rc0/tests/test-permissions.t`

 * *Files 12% similar despite different names*

```diff
@@ -20,27 +20,27 @@
   $ hg commit -m "1"
 
   $ hg verify -q
 
   $ chmod -r .hg/store/data/a.i
 
   $ hg verify -q
-  abort: Permission denied: '$TESTTMP/t/.hg/store/data/a.i'
+  abort: $EACCES$: '$TESTTMP/t/.hg/store/data/a.i'
   [255]
 
   $ chmod +r .hg/store/data/a.i
 
   $ hg verify -q
 
   $ chmod -w .hg/store/data/a.i
 
   $ echo barber > a
   $ hg commit -m "2"
   trouble committing a!
-  abort: Permission denied: '$TESTTMP/t/.hg/store/data/a.i'
+  abort: $EACCES$: '$TESTTMP/t/.hg/store/data/a.i'
   [255]
 
   $ chmod -w .
 
   $ hg diff --nodates
   diff -r 2a18120dc1c9 a
   --- a/a
@@ -60,15 +60,15 @@
   $ chmod -rx dir
 
 #if no-fsmonitor
 
 (fsmonitor makes "hg status" avoid accessing to "dir")
 
   $ hg status
-  dir: Permission denied* (glob)
+  dir: $EACCES$* (glob)
   M a
 
 #endif
 
 Reenable perm to allow deletion:
 
   $ chmod +rx dir
```

### Comparing `mercurial-6.4rc0/tests/test-persistent-nodemap.t` & `mercurial-6.5rc0/tests/test-persistent-nodemap.t`

 * *Files 14% similar despite different names*

```diff
@@ -86,14 +86,22 @@
   tip-node: 6b02b8c7b96654c25e86ba69eda198d7e6ad8b3c
   data-length: 121088
   data-unused: 0
   data-unused: 0.000%
   $ f --size .hg/store/00changelog.n
   .hg/store/00changelog.n: size=62
 
+  $ hg debugnodemap --metadata --manifest
+  uid: ???????? (glob)
+  tip-rev: 5000
+  tip-node: 513d42790a19f0f60c6ebea54b9543bc9537b959
+  data-length: 120960
+  data-unused: 0
+  data-unused: 0.000%
+
 Simple lookup works
 
   $ ANYNODE=`hg log --template '{node|short}\n' --rev tip`
   $ hg log -r "$ANYNODE" --template '{rev}\n'
   5000
 
 
@@ -150,16 +158,16 @@
   00d0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff |................|
   00e0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff f1 02 |................|
   00f0: ff ff ff ff ff ff ed 1b ff ff ff ff ff ff ff ff |................|
 
 #endif
 
   $ hg debugnodemap --check
-  revision in index:   5001
-  revision in nodemap: 5001
+  revisions in index:   5001
+  revisions in nodemap: 5001
 
 add a new commit
 
   $ hg up
   5001 files updated, 0 files merged, 0 files removed, 0 files unresolved
   $ echo foo > foo
   $ hg add foo
@@ -237,30 +245,30 @@
 
 #if no-pure no-rust
   $ f --sha256 .hg/store/00changelog-*.nd --size
   .hg/store/00changelog-????????.nd: size=121088, sha256=df7c06a035b96cb28c7287d349d603baef43240be7736fe34eea419a49702e17 (glob)
 #endif
 
   $ hg debugnodemap --check
-  revision in index:   5002
-  revision in nodemap: 5002
+  revisions in index:   5002
+  revisions in nodemap: 5002
 
 Test code path without mmap
 ---------------------------
 
   $ echo bar > bar
   $ hg add bar
   $ hg ci -m 'bar' --config storage.revlog.persistent-nodemap.mmap=no
 
   $ hg debugnodemap --check --config storage.revlog.persistent-nodemap.mmap=yes
-  revision in index:   5003
-  revision in nodemap: 5003
+  revisions in index:   5003
+  revisions in nodemap: 5003
   $ hg debugnodemap --check --config storage.revlog.persistent-nodemap.mmap=no
-  revision in index:   5003
-  revision in nodemap: 5003
+  revisions in index:   5003
+  revisions in nodemap: 5003
 
 
 #if pure
   $ hg debugnodemap --metadata
   uid: ???????? (glob)
   tip-rev: 5002
   tip-node: 880b18d239dfa9f632413a2071bfdbcc4806a4fd
@@ -807,16 +815,15 @@
   
   processed revlogs:
     - all-filelogs
     - changelog
     - manifest
   
   $ ls -1 .hg/store/ | egrep '00(changelog|manifest)(\.n|-.*\.nd)'
-  undo.backup.00changelog.n
-  undo.backup.00manifest.n
+  [1]
   $ hg debugnodemap --metadata
 
 
 upgrading
 
   $ cat << EOF >> .hg/hgrc
   > [format]
@@ -854,16 +861,14 @@
     - manifest
   
   $ ls -1 .hg/store/ | egrep '00(changelog|manifest)(\.n|-.*\.nd)'
   00changelog-*.nd (glob)
   00changelog.n
   00manifest-*.nd (glob)
   00manifest.n
-  undo.backup.00changelog.n
-  undo.backup.00manifest.n
 
   $ hg debugnodemap --metadata
   uid: * (glob)
   tip-rev: 5005
   tip-node: 90d5d3ba2fc47db50f712570487cb261a68c8ffe
   data-length: 121088
   data-unused: 0
@@ -1002,262 +1007,7 @@
   $ hg -R corruption-test-repo log -r . --traceback
   changeset:   5005:90d5d3ba2fc4
   tag:         tip
   user:        test
   date:        Thu Jan 01 00:00:00 1970 +0000
   summary:     a2
   
-
-
-stream clone
-============
-
-The persistent nodemap should exist after a streaming clone
-
-Simple case
------------
-
-No race condition
-
-  $ hg clone -U --stream ssh://user@dummy/test-repo stream-clone --debug | egrep '00(changelog|manifest)'
-  adding [s] 00manifest.n (62 bytes)
-  adding [s] 00manifest-*.nd (118 KB) (glob)
-  adding [s] 00changelog.n (62 bytes)
-  adding [s] 00changelog-*.nd (118 KB) (glob)
-  adding [s] 00manifest.d (452 KB) (no-zstd !)
-  adding [s] 00manifest.d (491 KB) (zstd no-bigendian !)
-  adding [s] 00manifest.d (492 KB) (zstd bigendian !)
-  adding [s] 00changelog.d (360 KB) (no-zstd !)
-  adding [s] 00changelog.d (368 KB) (zstd !)
-  adding [s] 00manifest.i (313 KB)
-  adding [s] 00changelog.i (313 KB)
-  $ ls -1 stream-clone/.hg/store/ | egrep '00(changelog|manifest)(\.n|-.*\.nd)'
-  00changelog-*.nd (glob)
-  00changelog.n
-  00manifest-*.nd (glob)
-  00manifest.n
-  $ hg -R stream-clone debugnodemap --metadata
-  uid: * (glob)
-  tip-rev: 5005
-  tip-node: 90d5d3ba2fc47db50f712570487cb261a68c8ffe
-  data-length: 121088
-  data-unused: 0
-  data-unused: 0.000%
-
-new data appened
------------------
-
-Other commit happening on the server during the stream clone
-
-setup the step-by-step stream cloning
-
-  $ HG_TEST_STREAM_WALKED_FILE_1="$TESTTMP/sync_file_walked_1"
-  $ export HG_TEST_STREAM_WALKED_FILE_1
-  $ HG_TEST_STREAM_WALKED_FILE_2="$TESTTMP/sync_file_walked_2"
-  $ export HG_TEST_STREAM_WALKED_FILE_2
-  $ HG_TEST_STREAM_WALKED_FILE_3="$TESTTMP/sync_file_walked_3"
-  $ export HG_TEST_STREAM_WALKED_FILE_3
-  $ cat << EOF >> test-repo/.hg/hgrc
-  > [extensions]
-  > steps=$RUNTESTDIR/testlib/ext-stream-clone-steps.py
-  > EOF
-
-Check and record file state beforehand
-
-  $ f --size test-repo/.hg/store/00changelog*
-  test-repo/.hg/store/00changelog-*.nd: size=121088 (glob)
-  test-repo/.hg/store/00changelog.d: size=376891 (zstd no-bigendian !)
-  test-repo/.hg/store/00changelog.d: size=376889 (zstd bigendian !)
-  test-repo/.hg/store/00changelog.d: size=368890 (no-zstd !)
-  test-repo/.hg/store/00changelog.i: size=320384
-  test-repo/.hg/store/00changelog.n: size=62
-  $ hg -R test-repo debugnodemap --metadata | tee server-metadata.txt
-  uid: * (glob)
-  tip-rev: 5005
-  tip-node: 90d5d3ba2fc47db50f712570487cb261a68c8ffe
-  data-length: 121088
-  data-unused: 0
-  data-unused: 0.000%
-
-Prepare a commit
-
-  $ echo foo >> test-repo/foo
-  $ hg -R test-repo/ add test-repo/foo
-
-Do a mix of clone and commit at the same time so that the file listed on disk differ at actual transfer time.
-
-  $ (hg clone -U --stream ssh://user@dummy/test-repo stream-clone-race-1 --debug 2>> clone-output | egrep '00(changelog|manifest)' >> clone-output; touch $HG_TEST_STREAM_WALKED_FILE_3) &
-  $ $RUNTESTDIR/testlib/wait-on-file 10 $HG_TEST_STREAM_WALKED_FILE_1
-  $ hg -R test-repo/ commit -m foo
-  $ touch $HG_TEST_STREAM_WALKED_FILE_2
-  $ $RUNTESTDIR/testlib/wait-on-file 10 $HG_TEST_STREAM_WALKED_FILE_3
-  $ cat clone-output
-  adding [s] 00manifest.n (62 bytes)
-  adding [s] 00manifest-*.nd (118 KB) (glob)
-  adding [s] 00changelog.n (62 bytes)
-  adding [s] 00changelog-*.nd (118 KB) (glob)
-  adding [s] 00manifest.d (452 KB) (no-zstd !)
-  adding [s] 00manifest.d (491 KB) (zstd no-bigendian !)
-  adding [s] 00manifest.d (492 KB) (zstd bigendian !)
-  adding [s] 00changelog.d (360 KB) (no-zstd !)
-  adding [s] 00changelog.d (368 KB) (zstd !)
-  adding [s] 00manifest.i (313 KB)
-  adding [s] 00changelog.i (313 KB)
-
-Check the result state
-
-  $ f --size stream-clone-race-1/.hg/store/00changelog*
-  stream-clone-race-1/.hg/store/00changelog-*.nd: size=121088 (glob)
-  stream-clone-race-1/.hg/store/00changelog.d: size=368890 (no-zstd !)
-  stream-clone-race-1/.hg/store/00changelog.d: size=376891 (zstd no-bigendian !)
-  stream-clone-race-1/.hg/store/00changelog.d: size=376889 (zstd bigendian !)
-  stream-clone-race-1/.hg/store/00changelog.i: size=320384
-  stream-clone-race-1/.hg/store/00changelog.n: size=62
-
-  $ hg -R stream-clone-race-1 debugnodemap --metadata | tee client-metadata.txt
-  uid: * (glob)
-  tip-rev: 5005
-  tip-node: 90d5d3ba2fc47db50f712570487cb261a68c8ffe
-  data-length: 121088
-  data-unused: 0
-  data-unused: 0.000%
-
-We get a usable nodemap, so no rewrite would be needed and the metadata should be identical
-(ie: the following diff should be empty)
-
-This isn't the case for the `no-rust` `no-pure` implementation as it use a very minimal nodemap implementation that unconditionnaly rewrite the nodemap "all the time".
-
-#if no-rust no-pure
-  $ diff -u server-metadata.txt client-metadata.txt
-  --- server-metadata.txt	* (glob)
-  +++ client-metadata.txt	* (glob)
-  @@ -1,4 +1,4 @@
-  -uid: * (glob)
-  +uid: * (glob)
-   tip-rev: 5005
-   tip-node: 90d5d3ba2fc47db50f712570487cb261a68c8ffe
-   data-length: 121088
-  [1]
-#else
-  $ diff -u server-metadata.txt client-metadata.txt
-#endif
-
-
-Clean up after the test.
-
-  $ rm -f "$HG_TEST_STREAM_WALKED_FILE_1"
-  $ rm -f "$HG_TEST_STREAM_WALKED_FILE_2"
-  $ rm -f "$HG_TEST_STREAM_WALKED_FILE_3"
-
-full regeneration
------------------
-
-A full nodemap is generated
-
-(ideally this test would append enough data to make sure the nodemap data file
-get changed, however to make thing simpler we will force the regeneration for
-this test.
-
-Check the initial state
-
-  $ f --size test-repo/.hg/store/00changelog*
-  test-repo/.hg/store/00changelog-*.nd: size=121344 (glob) (rust !)
-  test-repo/.hg/store/00changelog-*.nd: size=121344 (glob) (pure !)
-  test-repo/.hg/store/00changelog-*.nd: size=121152 (glob) (no-rust no-pure !)
-  test-repo/.hg/store/00changelog.d: size=376950 (zstd no-bigendian !)
-  test-repo/.hg/store/00changelog.d: size=376948 (zstd bigendian !)
-  test-repo/.hg/store/00changelog.d: size=368949 (no-zstd !)
-  test-repo/.hg/store/00changelog.i: size=320448
-  test-repo/.hg/store/00changelog.n: size=62
-  $ hg -R test-repo debugnodemap --metadata | tee server-metadata-2.txt
-  uid: * (glob)
-  tip-rev: 5006
-  tip-node: ed2ec1eef9aa2a0ec5057c51483bc148d03e810b
-  data-length: 121344 (rust !)
-  data-length: 121344 (pure !)
-  data-length: 121152 (no-rust no-pure !)
-  data-unused: 192 (rust !)
-  data-unused: 192 (pure !)
-  data-unused: 0 (no-rust no-pure !)
-  data-unused: 0.158% (rust !)
-  data-unused: 0.158% (pure !)
-  data-unused: 0.000% (no-rust no-pure !)
-
-Performe the mix of clone and full refresh of the nodemap, so that the files
-(and filenames) are different between listing time and actual transfer time.
-
-  $ (hg clone -U --stream ssh://user@dummy/test-repo stream-clone-race-2 --debug 2>> clone-output-2 | egrep '00(changelog|manifest)' >> clone-output-2; touch $HG_TEST_STREAM_WALKED_FILE_3) &
-  $ $RUNTESTDIR/testlib/wait-on-file 10 $HG_TEST_STREAM_WALKED_FILE_1
-  $ rm test-repo/.hg/store/00changelog.n
-  $ rm test-repo/.hg/store/00changelog-*.nd
-  $ hg -R test-repo/ debugupdatecache
-  $ touch $HG_TEST_STREAM_WALKED_FILE_2
-  $ $RUNTESTDIR/testlib/wait-on-file 10 $HG_TEST_STREAM_WALKED_FILE_3
-
-(note: the stream clone code wronly pick the `undo.` files)
-
-  $ cat clone-output-2
-  adding [s] undo.backup.00manifest.n (62 bytes) (known-bad-output !)
-  adding [s] undo.backup.00changelog.n (62 bytes) (known-bad-output !)
-  adding [s] 00manifest.n (62 bytes)
-  adding [s] 00manifest-*.nd (118 KB) (glob)
-  adding [s] 00changelog.n (62 bytes)
-  adding [s] 00changelog-*.nd (118 KB) (glob)
-  adding [s] 00manifest.d (492 KB) (zstd !)
-  adding [s] 00manifest.d (452 KB) (no-zstd !)
-  adding [s] 00changelog.d (360 KB) (no-zstd !)
-  adding [s] 00changelog.d (368 KB) (zstd !)
-  adding [s] 00manifest.i (313 KB)
-  adding [s] 00changelog.i (313 KB)
-
-Check the result.
-
-  $ f --size stream-clone-race-2/.hg/store/00changelog*
-  stream-clone-race-2/.hg/store/00changelog-*.nd: size=121344 (glob) (rust !)
-  stream-clone-race-2/.hg/store/00changelog-*.nd: size=121344 (glob) (pure !)
-  stream-clone-race-2/.hg/store/00changelog-*.nd: size=121152 (glob) (no-rust no-pure !)
-  stream-clone-race-2/.hg/store/00changelog.d: size=376950 (zstd no-bigendian !)
-  stream-clone-race-2/.hg/store/00changelog.d: size=376948 (zstd bigendian !)
-  stream-clone-race-2/.hg/store/00changelog.d: size=368949 (no-zstd !)
-  stream-clone-race-2/.hg/store/00changelog.i: size=320448
-  stream-clone-race-2/.hg/store/00changelog.n: size=62
-
-  $ hg -R stream-clone-race-2 debugnodemap --metadata | tee client-metadata-2.txt
-  uid: * (glob)
-  tip-rev: 5006
-  tip-node: ed2ec1eef9aa2a0ec5057c51483bc148d03e810b
-  data-length: 121344 (rust !)
-  data-unused: 192 (rust !)
-  data-unused: 0.158% (rust !)
-  data-length: 121152 (no-rust no-pure !)
-  data-unused: 0 (no-rust no-pure !)
-  data-unused: 0.000% (no-rust no-pure !)
-  data-length: 121344 (pure !)
-  data-unused: 192 (pure !)
-  data-unused: 0.158% (pure !)
-
-We get a usable nodemap, so no rewrite would be needed and the metadata should be identical
-(ie: the following diff should be empty)
-
-This isn't the case for the `no-rust` `no-pure` implementation as it use a very minimal nodemap implementation that unconditionnaly rewrite the nodemap "all the time".
-
-#if no-rust no-pure
-  $ diff -u server-metadata-2.txt client-metadata-2.txt
-  --- server-metadata-2.txt	* (glob)
-  +++ client-metadata-2.txt	* (glob)
-  @@ -1,4 +1,4 @@
-  -uid: * (glob)
-  +uid: * (glob)
-   tip-rev: 5006
-   tip-node: ed2ec1eef9aa2a0ec5057c51483bc148d03e810b
-   data-length: 121152
-  [1]
-#else
-  $ diff -u server-metadata-2.txt client-metadata-2.txt
-#endif
-
-Clean up after the test
-
-  $ rm -f $HG_TEST_STREAM_WALKED_FILE_1
-  $ rm -f $HG_TEST_STREAM_WALKED_FILE_2
-  $ rm -f $HG_TEST_STREAM_WALKED_FILE_3
-
```

### Comparing `mercurial-6.4rc0/tests/test-phabricator.t` & `mercurial-6.5rc0/tests/test-phabricator.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-phases-exchange.t` & `mercurial-6.5rc0/tests/test-phases-exchange.t`

 * *Files 0% similar despite different names*

```diff
@@ -848,17 +848,17 @@
   test-debug-phase: move rev 8: 0 -> 1
   test-debug-phase: move rev 9: 0 -> 1
   $ hg push -fv ../alpha
   pushing to ../alpha
   searching for changes
   1 changesets found
   uncompressed size of bundle content:
-       178 (changelog)
-       165 (manifests)
-       131  a-H
+       180 (changelog)
+       167 (manifests)
+       133  a-H
   adding changesets
   adding manifests
   adding file changes
   added 1 changesets with 1 changes to 1 files (+1 heads)
   test-debug-phase: new rev 10:  x -> 0
   test-debug-phase: move rev 8: 1 -> 0
   test-debug-phase: move rev 9: 1 -> 0
```

### Comparing `mercurial-6.4rc0/tests/test-phases.t` & `mercurial-6.5rc0/tests/test-phases.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-profile.t` & `mercurial-6.5rc0/tests/test-profile.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-progress.t` & `mercurial-6.5rc0/tests/test-progress.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-propertycache.py` & `mercurial-6.5rc0/tests/test-propertycache.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-propertycache.py.out` & `mercurial-6.5rc0/tests/test-propertycache.py.out`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pull-branch.t` & `mercurial-6.5rc0/tests/test-pull-branch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pull-bundle.t` & `mercurial-6.5rc0/tests/test-pull-bundle.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pull-http.t` & `mercurial-6.5rc0/tests/test-pull-http.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pull-network.t` & `mercurial-6.5rc0/tests/test-pull-network.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pull-pull-corruption.t` & `mercurial-6.5rc0/tests/test-pull-pull-corruption.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pull-r.t` & `mercurial-6.5rc0/tests/test-pull-r.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pull-update.t` & `mercurial-6.5rc0/tests/test-pull-update.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-purge.t` & `mercurial-6.5rc0/tests/test-purge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-cgi.t` & `mercurial-6.5rc0/tests/test-push-cgi.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-multibranches-E1.t` & `mercurial-6.5rc0/tests/test-push-checkheads-multibranches-E1.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-multibranches-E2.t` & `mercurial-6.5rc0/tests/test-push-checkheads-multibranches-E2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-multibranches-E3.t` & `mercurial-6.5rc0/tests/test-push-checkheads-multibranches-E3.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-partial-C1.t` & `mercurial-6.5rc0/tests/test-push-checkheads-partial-C1.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-partial-C2.t` & `mercurial-6.5rc0/tests/test-push-checkheads-partial-C2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-partial-C3.t` & `mercurial-6.5rc0/tests/test-push-checkheads-partial-C3.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-partial-C4.t` & `mercurial-6.5rc0/tests/test-push-checkheads-partial-C4.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-pruned-B1.t` & `mercurial-6.5rc0/tests/test-push-checkheads-pruned-B1.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-pruned-B2.t` & `mercurial-6.5rc0/tests/test-push-checkheads-pruned-B2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-pruned-B3.t` & `mercurial-6.5rc0/tests/test-push-checkheads-pruned-B3.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-pruned-B4.t` & `mercurial-6.5rc0/tests/test-push-checkheads-pruned-B4.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-pruned-B5.t` & `mercurial-6.5rc0/tests/test-push-checkheads-pruned-B5.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-pruned-B6.t` & `mercurial-6.5rc0/tests/test-push-checkheads-pruned-B6.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-pruned-B7.t` & `mercurial-6.5rc0/tests/test-push-checkheads-pruned-B7.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-pruned-B8.t` & `mercurial-6.5rc0/tests/test-push-checkheads-pruned-B8.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-superceed-A1.t` & `mercurial-6.5rc0/tests/test-push-checkheads-superceed-A1.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-superceed-A2.t` & `mercurial-6.5rc0/tests/test-push-checkheads-superceed-A2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-superceed-A3.t` & `mercurial-6.5rc0/tests/test-push-checkheads-superceed-A3.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-superceed-A4.t` & `mercurial-6.5rc0/tests/test-push-checkheads-superceed-A4.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-superceed-A5.t` & `mercurial-6.5rc0/tests/test-push-checkheads-superceed-A5.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-superceed-A6.t` & `mercurial-6.5rc0/tests/test-push-checkheads-superceed-A6.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-superceed-A7.t` & `mercurial-6.5rc0/tests/test-push-checkheads-superceed-A7.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-superceed-A8.t` & `mercurial-6.5rc0/tests/test-push-checkheads-superceed-A8.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D1.t` & `mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D1.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D2.t` & `mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D3.t` & `mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D3.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D4.t` & `mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D4.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D5.t` & `mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D5.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D6.t` & `mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D6.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-checkheads-unpushed-D7.t` & `mercurial-6.5rc0/tests/test-push-checkheads-unpushed-D7.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-http.t` & `mercurial-6.5rc0/tests/test-push-http.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-push-race.t` & `mercurial-6.5rc0/tests/test-push-race.t`

 * *Files 0% similar despite different names*

```diff
@@ -46,14 +46,18 @@
   >     # now wait for the other process to be done
   >     watchpath = ui.config(b'delaypush', b'release-path')
   >     if watchpath is not None:
   >         ui.status(b'waiting on: %s\n' % watchpath)
   >         limit = 100
   >         test_default_timeout = os.environ.get('HGTEST_TIMEOUT_DEFAULT')
   >         test_timeout = os.environ.get('HGTEST_TIMEOUT')
+  >         if test_default_timeout is not None:
+  >            test_default_timeout = int(test_default_timeout)
+  >         if test_timeout is not None:
+  >            test_timeout = int(test_timeout)
   >         if (
   >             test_default_timeout is not None
   >             and test_timeout is not None
   >             and test_default_timeout < test_timeout
   >         ):
   >             limit = int(limit * (test_timeout / test_default_timeout))
   >         while 0 < limit and not os.path.exists(watchpath):
```

### Comparing `mercurial-6.4rc0/tests/test-push-warn.t` & `mercurial-6.5rc0/tests/test-push-warn.t`

 * *Files 0% similar despite different names*

```diff
@@ -147,17 +147,17 @@
   [20]
 
   $ hg push -v -f -r 3 -r 4 ../c
   pushing to ../c
   searching for changes
   2 changesets found
   uncompressed size of bundle content:
-       352 (changelog)
-       326 (manifests)
-       25\d  foo (re)
+       356 (changelog)
+       330 (manifests)
+       261  foo
   adding changesets
   adding manifests
   adding file changes
   added 2 changesets with 2 changes to 1 files (+2 heads)
 
   $ hg push -r 5 ../c
   pushing to ../c
```

### Comparing `mercurial-6.4rc0/tests/test-push.t` & `mercurial-6.5rc0/tests/test-push.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-pushvars.t` & `mercurial-6.5rc0/tests/test-pushvars.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-qrecord.t` & `mercurial-6.5rc0/tests/test-qrecord.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-racy-mutations.t` & `mercurial-6.5rc0/tests/test-racy-mutations.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rank.t` & `mercurial-6.5rc0/tests/test-rank.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-abort.t` & `mercurial-6.5rc0/tests/test-rebase-abort.t`

 * *Files 0% similar despite different names*

```diff
@@ -388,15 +388,14 @@
 
 New operations are blocked with the correct state message
 
   $ find .hg -name '*state' -prune | sort
   .hg/dirstate
   .hg/merge/state
   .hg/rebasestate
-  .hg/undo.backup.dirstate
   .hg/updatestate
 
   $ hg rebase -s 3 -d tip
   abort: rebase in progress
   (use 'hg rebase --continue', 'hg rebase --abort', or 'hg rebase --stop')
   [20]
   $ hg up .
```

### Comparing `mercurial-6.4rc0/tests/test-rebase-backup.t` & `mercurial-6.5rc0/tests/test-rebase-backup.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-base-flag.t` & `mercurial-6.5rc0/tests/test-rebase-base-flag.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-bookmarks.t` & `mercurial-6.5rc0/tests/test-rebase-bookmarks.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-brute-force.t` & `mercurial-6.5rc0/tests/test-rebase-brute-force.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-cache.t` & `mercurial-6.5rc0/tests/test-rebase-cache.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-check-restore.t` & `mercurial-6.5rc0/tests/test-rebase-check-restore.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-collapse.t` & `mercurial-6.5rc0/tests/test-rebase-collapse.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-conflicts.t` & `mercurial-6.5rc0/tests/test-rebase-conflicts.t`

 * *Files 1% similar despite different names*

```diff
@@ -292,36 +292,34 @@
   e31216eec445e44352c5f01588856059466a24c9
   2f2496ddf49d69b5ef23ad8cf9fb2e0e4faf0ac2
   bundle2-output-bundle: "HG20", (1 params) 3 parts total
   bundle2-output-part: "changegroup" (params: 1 mandatory 1 advisory) streamed payload
   bundle2-output-part: "cache:rev-branch-cache" (advisory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   saved backup bundle to $TESTTMP/issue4041/.hg/strip-backup/e31216eec445-15f7a814-rebase.hg
-  3 changesets found
+  2 changesets found
   list of changesets:
-  4c9fbe56a16f30c0d5dcc40ec1a97bbe3325209c
   19c888675e133ab5dff84516926a65672eaf04d9
   c1ffa3b5274e92a9388fe782854e295d2e8d0443
   bundle2-output-bundle: "HG20", 3 parts total
   bundle2-output-part: "changegroup" (params: 1 mandatory 1 advisory) streamed payload
   bundle2-output-part: "cache:rev-branch-cache" (advisory) streamed payload
   bundle2-output-part: "phase-heads" 24 bytes payload
   adding branch
   bundle2-input-bundle: with-transaction
   bundle2-input-part: "changegroup" (params: 1 mandatory 1 advisory) supported
   adding changesets
-  add changeset 4c9fbe56a16f
   add changeset 19c888675e13
   add changeset c1ffa3b5274e
   adding manifests
   adding file changes
   adding f1.txt revisions
-  bundle2-input-part: total payload size 1739
+  bundle2-input-part: total payload size 1255
   bundle2-input-part: "cache:rev-branch-cache" (advisory) supported
-  bundle2-input-part: total payload size 74
+  bundle2-input-part: total payload size 54
   bundle2-input-part: "phase-heads" supported
   bundle2-input-part: total payload size 24
   bundle2-input-bundle: 3 parts total
   truncating cache/rbc-revs-v1 to 72
   added 2 changesets with 2 changes to 1 files
   updating the branch cache
   invalid branch cache (served): tip differs
```

### Comparing `mercurial-6.4rc0/tests/test-rebase-dest.t` & `mercurial-6.5rc0/tests/test-rebase-dest.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-detach.t` & `mercurial-6.5rc0/tests/test-rebase-detach.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-empty-successor.t` & `mercurial-6.5rc0/tests/test-rebase-empty-successor.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-emptycommit.t` & `mercurial-6.5rc0/tests/test-rebase-emptycommit.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-inmemory.t` & `mercurial-6.5rc0/tests/test-rebase-inmemory.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-interruptions.t` & `mercurial-6.5rc0/tests/test-rebase-interruptions.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-issue-noparam-single-rev.t` & `mercurial-6.5rc0/tests/test-rebase-issue-noparam-single-rev.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-legacy.t` & `mercurial-6.5rc0/tests/test-rebase-legacy.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-mq-skip.t` & `mercurial-6.5rc0/tests/test-rebase-mq-skip.t`

 * *Files 2% similar despite different names*

```diff
@@ -71,25 +71,25 @@
   resolving manifests
   note: not rebasing 3:148775c71080 p1.patch qtip "P1", its destination already has all its changes
   rebase merging completed
   updating mq patch p0.patch to 5:9ecc820b1737
   $TESTTMP/a/.hg/patches/p0.patch
   2 changesets found
   uncompressed size of bundle content:
-       348 (changelog)
-       324 (manifests)
-       129  p0
-       129  p1
+       352 (changelog)
+       328 (manifests)
+       131  p0
+       131  p1
   saved backup bundle to $TESTTMP/a/.hg/strip-backup/13a46ce44f60-5da6ecfb-rebase.hg
   2 changesets found
   uncompressed size of bundle content:
-       403 (changelog)
-       324 (manifests)
-       129  p0
-       129  p1
+       407 (changelog)
+       328 (manifests)
+       131  p0
+       131  p1
   adding branch
   adding changesets
   adding manifests
   adding file changes
   added 2 changesets with 2 changes to 2 files
   rebase completed
   1 revisions have been skipped
```

### Comparing `mercurial-6.4rc0/tests/test-rebase-mq.t` & `mercurial-6.5rc0/tests/test-rebase-mq.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-named-branches.t` & `mercurial-6.5rc0/tests/test-rebase-named-branches.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-newancestor.t` & `mercurial-6.5rc0/tests/test-rebase-newancestor.t`

 * *Files 2% similar despite different names*

```diff
@@ -259,23 +259,23 @@
   committing files:
   other
   committing manifest
   committing changelog
   rebase merging completed
   1 changesets found
   uncompressed size of bundle content:
-       199 (changelog)
-       216 (manifests)
-       182  other
+       201 (changelog)
+       218 (manifests)
+       184  other
   saved backup bundle to $TESTTMP/parentorder/.hg/strip-backup/4c5f12f25ebe-f46990e5-rebase.hg
   1 changesets found
   uncompressed size of bundle content:
-       254 (changelog)
-       167 (manifests)
-       182  other
+       256 (changelog)
+       169 (manifests)
+       184  other
   adding branch
   adding changesets
   adding manifests
   adding file changes
   added 1 changesets with 1 changes to 1 files
   rebase completed
   $ hg tglog
```

### Comparing `mercurial-6.4rc0/tests/test-rebase-obsolete.t` & `mercurial-6.5rc0/tests/test-rebase-obsolete.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-obsolete2.t` & `mercurial-6.5rc0/tests/test-rebase-obsolete2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-obsolete3.t` & `mercurial-6.5rc0/tests/test-rebase-obsolete3.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-obsolete4.t` & `mercurial-6.5rc0/tests/test-rebase-obsolete4.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-parameters.t` & `mercurial-6.5rc0/tests/test-rebase-parameters.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-partial.t` & `mercurial-6.5rc0/tests/test-rebase-partial.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-pull.t` & `mercurial-6.5rc0/tests/test-rebase-pull.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-rename.t` & `mercurial-6.5rc0/tests/test-rebase-rename.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-scenario-global.t` & `mercurial-6.5rc0/tests/test-rebase-scenario-global.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-templates.t` & `mercurial-6.5rc0/tests/test-rebase-templates.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebase-transaction.t` & `mercurial-6.5rc0/tests/test-rebase-transaction.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rebuildstate.t` & `mercurial-6.5rc0/tests/test-rebuildstate.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-record.t` & `mercurial-6.5rc0/tests/test-record.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-releasenotes-formatting.t` & `mercurial-6.5rc0/tests/test-releasenotes-formatting.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-releasenotes-merging.t` & `mercurial-6.5rc0/tests/test-releasenotes-merging.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-releasenotes-parsing.t` & `mercurial-6.5rc0/tests/test-releasenotes-parsing.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-relink.t` & `mercurial-6.5rc0/tests/test-relink.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-bad-configs.t` & `mercurial-6.5rc0/tests/test-remotefilelog-bad-configs.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-bgprefetch.t` & `mercurial-6.5rc0/tests/test-remotefilelog-bgprefetch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-blame.t` & `mercurial-6.5rc0/tests/test-remotefilelog-blame.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-bundle2-legacy.t` & `mercurial-6.5rc0/tests/test-remotefilelog-bundle2-legacy.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-bundle2.t` & `mercurial-6.5rc0/tests/test-remotefilelog-bundle2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-bundles.t` & `mercurial-6.5rc0/tests/test-remotefilelog-bundles.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-cacheprocess.t` & `mercurial-6.5rc0/tests/test-remotefilelog-cacheprocess.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-clone-tree.t` & `mercurial-6.5rc0/tests/test-remotefilelog-clone-tree.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-clone.t` & `mercurial-6.5rc0/tests/test-remotefilelog-clone.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-corrupt-cache.t` & `mercurial-6.5rc0/tests/test-remotefilelog-corrupt-cache.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-datapack.py` & `mercurial-6.5rc0/tests/test-remotefilelog-datapack.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-gc.t` & `mercurial-6.5rc0/tests/test-remotefilelog-gc.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-gcrepack.t` & `mercurial-6.5rc0/tests/test-remotefilelog-gcrepack.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-hgweb.t` & `mercurial-6.5rc0/tests/test-remotefilelog-hgweb.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-histpack.py` & `mercurial-6.5rc0/tests/test-remotefilelog-histpack.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-http.t` & `mercurial-6.5rc0/tests/test-remotefilelog-http.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-keepset.t` & `mercurial-6.5rc0/tests/test-remotefilelog-keepset.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-linknodes.t` & `mercurial-6.5rc0/tests/test-remotefilelog-linknodes.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-local.t` & `mercurial-6.5rc0/tests/test-rename-merge1.t`

 * *Files 22% similar despite different names*

```diff
@@ -1,218 +1,237 @@
-#require no-windows
+  $ hg init repo
+  $ cd repo
 
-  $ . "$TESTDIR/remotefilelog-library.sh"
+  $ echo "[merge]" >> .hg/hgrc
+  $ echo "followcopies = 1" >> .hg/hgrc
 
-  $ hg init master
-  $ cd master
-  $ cat >> .hg/hgrc <<EOF
-  > [remotefilelog]
-  > server=True
-  > EOF
-  $ echo x > x
-  $ echo y > y
-  $ echo z > z
-  $ hg commit -qAm xy
+  $ echo foo > a
+  $ echo foo > a2
+  $ hg add a a2
+  $ hg ci -m "start"
+
+  $ hg mv a b
+  $ hg mv a2 b2
+  $ hg ci -m "rename"
+
+  $ hg co 0
+  2 files updated, 0 files merged, 2 files removed, 0 files unresolved
+
+  $ echo blahblah > a
+  $ echo blahblah > a2
+  $ hg mv a2 c2
+  $ hg ci -m "modify"
+  created new head
 
-  $ cd ..
+  $ hg merge -y --debug
+    unmatched files in local:
+     c2
+    unmatched files in other:
+     b
+     b2
+    all copies found (* = to merge, ! = divergent, % = renamed and deleted):
+     on local side:
+      src: 'a2' -> dst: 'c2' !
+     on remote side:
+      src: 'a' -> dst: 'b' *
+      src: 'a2' -> dst: 'b2' !
+    checking for directory renames
+  resolving manifests
+   branchmerge: True, force: False, partial: False
+   ancestor: af1939970a1c, local: 044f8520aeeb+, remote: 85c198ef2f6c
+  note: possible conflict - a2 was renamed multiple times to:
+   b2
+   c2
+   b2: remote created -> g
+  getting b2
+   preserving a for resolve of b
+  removing a
+   b: remote moved from a -> m
+  picked tool ':merge' for b (binary False symlink False changedelete False)
+  merging a and b to b
+  my b@044f8520aeeb+ other b@85c198ef2f6c ancestor a@af1939970a1c
+   premerge successful
+  1 files updated, 1 files merged, 0 files removed, 0 files unresolved
+  (branch merge, don't forget to commit)
 
-  $ hgcloneshallow ssh://user@dummy/master shallow -q
-  3 files fetched over 1 fetches - (3 misses, 0.00% hit ratio) over *s (glob)
-  $ cd shallow
-
-# status
-
-  $ clearcache
-  $ echo xx > x
-  $ echo yy > y
-  $ touch a
-  $ hg status
-  M x
-  M y
-  ? a
-  1 files fetched over 1 fetches - (1 misses, 0.00% hit ratio) over *s (glob)
-  $ hg add a
-  $ hg status
-  M x
-  M y
-  A a
-
-# diff
-
-  $ hg debugrebuilddirstate # fixes dirstate non-determinism
-  $ hg add a
-  $ clearcache
-  $ hg diff
-  diff -r f3d0bb0d1e48 x
-  --- a/x* (glob)
-  +++ b/x* (glob)
-  @@ -1,1 +1,1 @@
-  -x
-  +xx
-  diff -r f3d0bb0d1e48 y
-  --- a/y* (glob)
-  +++ b/y* (glob)
-  @@ -1,1 +1,1 @@
-  -y
-  +yy
-  3 files fetched over 1 fetches - (3 misses, 0.00% hit ratio) over *s (glob)
-
-# local commit
-
-  $ clearcache
-  $ echo a > a
-  $ echo xxx > x
-  $ echo yyy > y
-  $ hg commit -m a
-  ? files fetched over 1 fetches - (? misses, 0.00% hit ratio) over *s (glob)
+  $ hg status -AC
+  M b
+    a
+  M b2
+  R a
+  C c2
+
+  $ cat b
+  blahblah
+
+  $ hg ci -m "merge"
+
+  $ hg debugindex b
+     rev linkrev       nodeid    p1-nodeid    p2-nodeid
+       0       1 57eacc201a7f 000000000000 000000000000
+       1       3 4727ba907962 000000000000 57eacc201a7f
+
+  $ hg debugrename b
+  b renamed from a:dd03b83622e78778b403775d0d074b9ac7387a66
+
+This used to trigger a "divergent renames" warning, despite no renames
+
+  $ hg cp b b3
+  $ hg cp b b4
+  $ hg ci -A -m 'copy b twice'
+  $ hg up '.^'
+  0 files updated, 0 files merged, 2 files removed, 0 files unresolved
+  $ hg up
+  2 files updated, 0 files merged, 0 files removed, 0 files unresolved
+  $ hg rm b3 b4
+  $ hg ci -m 'clean up a bit of our mess'
+
+We'd rather not warn on divergent renames done in the same changeset (issue2113)
+
+  $ hg cp b b3
+  $ hg mv b b4
+  $ hg ci -A -m 'divergent renames in same changeset'
+  $ hg up '.^'
+  1 files updated, 0 files merged, 2 files removed, 0 files unresolved
+  $ hg up
+  2 files updated, 0 files merged, 1 files removed, 0 files unresolved
 
-# local commit where the dirstate is clean -- ensure that we do just one fetch
-# (update to a commit on the server first)
+Check for issue2642
 
-  $ hg --config debug.dirstate.delaywrite=1 up 0
-  2 files updated, 0 files merged, 1 files removed, 0 files unresolved
-  $ clearcache
-  $ hg debugdirstate
-  n 644          2 * x (glob)
-  n 644          2 * y (glob)
-  n 644          2 * z (glob)
-  $ echo xxxx > x
-  $ echo yyyy > y
-# run status early to avoid a flaky second fetch during commit.
-  $ hg st
-  M x
-  M y
-  \d+ files fetched over \d+ fetches .* (re) (?)
-  $ hg commit -m x
-  created new head
-  2 files fetched over 1 fetches - (2 misses, 0.00% hit ratio) over *s (glob)
+  $ hg init t
+  $ cd t
 
-# restore state for future tests
+  $ echo c0 > f1
+  $ hg ci -Aqm0
 
-  $ hg -q strip .
-  $ hg -q up tip
+  $ hg up null -q
+  $ echo c1 > f1 # backport
+  $ hg ci -Aqm1
+  $ hg mv f1 f2
+  $ hg ci -qm2
+
+  $ hg up 0 -q
+  $ hg merge 1 -q --tool internal:local
+  $ hg ci -qm3
 
-# rebase
+  $ hg merge 2
+  merging f1 and f2 to f2
+  0 files updated, 1 files merged, 0 files removed, 0 files unresolved
+  (branch merge, don't forget to commit)
 
-  $ clearcache
-  $ cd ../master
-  $ echo w > w
-  $ hg commit -qAm w
-
-  $ cd ../shallow
-  $ hg pull
-  pulling from ssh://user@dummy/master
-  searching for changes
-  adding changesets
-  adding manifests
-  adding file changes
-  added 1 changesets with 0 changes to 0 files (+1 heads)
-  new changesets fed61014d323
-  (run 'hg heads' to see heads, 'hg merge' to merge)
+  $ cat f2
+  c0
 
-# run status early to avoid a flaky second fetch during commit
-  $ hg status
-  \d+ files fetched over \d+ fetches .* (re) (?)
-  $ hg rebase -d tip
-  rebasing 1:9abfe7bca547 "a"
-  saved backup bundle to $TESTTMP/shallow/.hg/strip-backup/9abfe7bca547-8b11e5ff-rebase.hg (glob)
-  3 files fetched over 2 fetches - (3 misses, 0.00% hit ratio) over *s (glob)
-
-# strip
-
-  $ clearcache
-  $ hg debugrebuilddirstate # fixes dirstate non-determinism
-  $ hg strip -r .
-  2 files updated, 0 files merged, 1 files removed, 0 files unresolved
-  saved backup bundle to $TESTTMP/shallow/.hg/strip-backup/19edf50f4de7-df3d0f74-backup.hg (glob)
-  3 files fetched over 2 fetches - (3 misses, 0.00% hit ratio) over *s (glob)
+  $ cd ..
 
-# unbundle
+Check for issue2089
 
-  $ clearcache
-  $ ls -A
-  .hg
-  w
-  x
-  y
-  z
+  $ hg init repo2089
+  $ cd repo2089
 
-  $ hg debugrebuilddirstate # fixes dirstate non-determinism
-  $ hg unbundle .hg/strip-backup/19edf50f4de7-df3d0f74-backup.hg
-  adding changesets
-  adding manifests
-  adding file changes
-  added 1 changesets with 3 changes to 3 files
-  new changesets 19edf50f4de7 (1 drafts)
-  (run 'hg update' to get a working copy)
-  2 files fetched over 1 fetches - (2 misses, 0.00% hit ratio) over *s (glob)
+  $ echo c0 > f1
+  $ hg ci -Aqm0
+
+  $ hg up null -q
+  $ echo c1 > f1
+  $ hg ci -Aqm1
+
+  $ hg up 0 -q
+  $ hg merge 1 -q --tool internal:local
+  $ echo c2 > f1
+  $ hg ci -qm2
+
+  $ hg up 1 -q
+  $ hg mv f1 f2
+  $ hg ci -Aqm3
+
+  $ hg up 2 -q
+  $ hg merge 3
+  merging f1 and f2 to f2
+  0 files updated, 1 files merged, 0 files removed, 0 files unresolved
+  (branch merge, don't forget to commit)
+
+  $ cat f2
+  c2
 
-  $ hg up
-  3 files updated, 0 files merged, 0 files removed, 0 files unresolved
-  1 files fetched over 1 fetches - (1 misses, 0.00% hit ratio) over *s (glob)
-  $ cat a
-  a
-
-# revert
-
-  $ clearcache
-  $ hg revert -r .~2 y z
-  no changes needed to z
-  1 files fetched over 1 fetches - (1 misses, 0.00% hit ratio) over *s (glob)
-  $ hg checkout -C -r . -q
-
-# explicit bundle should produce full bundle file
-
-  $ hg bundle -r 2 --base 1 ../local.bundle
-  1 changesets found
-  1 files fetched over 1 fetches - (1 misses, 0.00% hit ratio) over *s (glob)
   $ cd ..
 
-  $ hgcloneshallow ssh://user@dummy/master shallow2 -q
-  2 files fetched over 1 fetches - (2 misses, 0.00% hit ratio) over *s (glob)
-  $ cd shallow2
-  $ hg unbundle ../local.bundle
-  adding changesets
-  adding manifests
-  adding file changes
-  added 1 changesets with 3 changes to 3 files
-  new changesets 19edf50f4de7 (1 drafts)
-  (run 'hg update' to get a working copy)
-
-  $ hg log -r 2 --stat
-  changeset:   2:19edf50f4de7
-  tag:         tip
-  user:        test
-  date:        Thu Jan 01 00:00:00 1970 +0000
-  summary:     a
-  
-   a |  1 +
-   x |  2 +-
-   y |  2 +-
-   3 files changed, 3 insertions(+), 2 deletions(-)
-  
-# Merge
+Check for issue3074
 
-  $ echo merge >> w
-  $ hg commit -m w
+  $ hg init repo3074
+  $ cd repo3074
+  $ echo foo > file
+  $ hg add file
+  $ hg commit -m "added file"
+  $ hg mv file newfile
+  $ hg commit -m "renamed file"
+  $ hg update 0
+  1 files updated, 0 files merged, 1 files removed, 0 files unresolved
+  $ hg rm file
+  $ hg commit -m "deleted file"
   created new head
-  $ hg merge 2
-  3 files updated, 0 files merged, 0 files removed, 0 files unresolved
+  $ hg merge --debug
+    unmatched files in other:
+     newfile
+    all copies found (* = to merge, ! = divergent, % = renamed and deleted):
+     on remote side:
+      src: 'file' -> dst: 'newfile' %
+    checking for directory renames
+  resolving manifests
+   branchmerge: True, force: False, partial: False
+   ancestor: 19d7f95df299, local: 0084274f6b67+, remote: 5d32493049f0
+  note: possible conflict - file was deleted and renamed to:
+   newfile
+   newfile: remote created -> g
+  getting newfile
+  1 files updated, 0 files merged, 0 files removed, 0 files unresolved
   (branch merge, don't forget to commit)
-  $ hg commit -m merge
-  $ hg strip -q -r ".^"
-
-# commit without producing new node
+  $ hg status
+  M newfile
+  $ cd ..
 
-  $ cd $TESTTMP
-  $ hgcloneshallow ssh://user@dummy/master shallow3 -q
-  $ cd shallow3
-  $ echo 1 > A
-  $ hg commit -m foo -A A
-  $ hg log -r . -T '{node}\n'
-  383ce605500277f879b7460a16ba620eb6930b7f
-  $ hg update -r '.^' -q
-  $ echo 1 > A
-  $ hg commit -m foo -A A
-  warning: commit already existed in the repository!
-  $ hg log -r . -T '{node}\n'
-  383ce605500277f879b7460a16ba620eb6930b7f
+Create x and y, then modify y and rename x to z on one side of merge, and
+modify x and rename y to z on the other side.
+  $ hg init conflicting-target
+  $ cd conflicting-target
+  $ echo x > x
+  $ echo y > y
+  $ hg ci -Aqm 'add x and y'
+  $ hg mv x z
+  $ echo foo >> y
+  $ hg ci -qm 'modify y, rename x to z'
+  $ hg co -q 0
+  $ hg mv y z
+  $ echo foo >> x
+  $ hg ci -qm 'modify x, rename y to z'
+# We should probably tell the user about the conflicting rename sources.
+# Depending on which side they pick, we should take that rename and get
+# the changes to the source from the other side. The unchanged file should
+# remain.
+  $ hg merge --debug 1 -t :merge3
+    all copies found (* = to merge, ! = divergent, % = renamed and deleted):
+     on local side:
+      src: 'y' -> dst: 'z' *
+     on remote side:
+      src: 'x' -> dst: 'z' *
+    checking for directory renames
+  resolving manifests
+   branchmerge: True, force: False, partial: False
+   ancestor: 5151c134577e, local: 07fcbc9a74ed+, remote: f21419739508
+  starting 4 threads for background file closing (?)
+   preserving z for resolve of z
+   z: both renamed from y -> m
+  picked tool ':merge3' for z (binary False symlink False changedelete False)
+  merging z
+  my z@07fcbc9a74ed+ other z@f21419739508 ancestor y@5151c134577e
+   premerge successful
+  0 files updated, 1 files merged, 0 files removed, 0 files unresolved
+  (branch merge, don't forget to commit)
+  $ ls
+  x
+  z
+  $ cat x
+  x
+  foo
+# 'z' should have had the added 'foo' line
+  $ cat z
+  x
```

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-log.t` & `mercurial-6.5rc0/tests/test-remotefilelog-log.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-partial-shallow.t` & `mercurial-6.5rc0/tests/test-remotefilelog-partial-shallow.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-permissions.t` & `mercurial-6.5rc0/tests/test-remotefilelog-permissions.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-prefetch.t` & `mercurial-6.5rc0/tests/test-remotefilelog-prefetch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-pull-noshallow.t` & `mercurial-6.5rc0/tests/test-remotefilelog-pull-noshallow.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-push-pull.t` & `mercurial-6.5rc0/tests/test-remotefilelog-push-pull.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-repack-fast.t` & `mercurial-6.5rc0/tests/test-remotefilelog-repack-fast.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-repack.t` & `mercurial-6.5rc0/tests/test-remotefilelog-repack.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-share.t` & `mercurial-6.5rc0/tests/test-remotefilelog-share.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-sparse.t` & `mercurial-6.5rc0/tests/test-remotefilelog-sparse.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-strip.t` & `mercurial-6.5rc0/tests/test-remotefilelog-strip.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-tags.t` & `mercurial-6.5rc0/tests/test-remotefilelog-tags.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remotefilelog-wireproto.t` & `mercurial-6.5rc0/tests/test-remotefilelog-wireproto.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-remove.t` & `mercurial-6.5rc0/tests/test-remove.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-removeemptydirs.t` & `mercurial-6.5rc0/tests/test-removeemptydirs.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rename-after-merge.t` & `mercurial-6.5rc0/tests/test-rename-after-merge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rename-dir-merge.t` & `mercurial-6.5rc0/tests/test-rename-dir-merge.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rename-merge1.t` & `mercurial-6.5rc0/tests/test-up-local-change.t`

 * *Files 18% similar despite different names*

```diff
@@ -1,237 +1,236 @@
-  $ hg init repo
-  $ cd repo
+  $ HGMERGE=true; export HGMERGE
 
-  $ echo "[merge]" >> .hg/hgrc
-  $ echo "followcopies = 1" >> .hg/hgrc
+  $ hg init r1
+  $ cd r1
+  $ echo a > a
+  $ hg addremove
+  adding a
+  $ hg commit -m "1"
 
-  $ echo foo > a
-  $ echo foo > a2
-  $ hg add a a2
-  $ hg ci -m "start"
-
-  $ hg mv a b
-  $ hg mv a2 b2
-  $ hg ci -m "rename"
-
-  $ hg co 0
-  2 files updated, 0 files merged, 2 files removed, 0 files unresolved
-
-  $ echo blahblah > a
-  $ echo blahblah > a2
-  $ hg mv a2 c2
-  $ hg ci -m "modify"
-  created new head
+  $ hg clone . ../r2
+  updating to branch default
+  1 files updated, 0 files merged, 0 files removed, 0 files unresolved
+  $ cd ../r2
+  $ hg up
+  0 files updated, 0 files merged, 0 files removed, 0 files unresolved
+  $ echo abc > a
+  $ hg diff --nodates
+  diff -r c19d34741b0a a
+  --- a/a
+  +++ b/a
+  @@ -1,1 +1,1 @@
+  -a
+  +abc
+
+  $ cd ../r1
+  $ echo b > b
+  $ echo a2 > a
+  $ hg addremove
+  adding b
+  $ hg commit -m "2"
 
-  $ hg merge -y --debug
-    unmatched files in local:
-     c2
-    unmatched files in other:
-     b
-     b2
-    all copies found (* = to merge, ! = divergent, % = renamed and deleted):
-     on local side:
-      src: 'a2' -> dst: 'c2' !
-     on remote side:
-      src: 'a' -> dst: 'b' *
-      src: 'a2' -> dst: 'b2' !
-    checking for directory renames
+  $ cd ../r2
+  $ hg -q pull ../r1
+  $ hg status
+  M a
+  $ hg parents
+  changeset:   0:c19d34741b0a
+  user:        test
+  date:        Thu Jan 01 00:00:00 1970 +0000
+  summary:     1
+  
+  $ hg --debug up
   resolving manifests
-   branchmerge: True, force: False, partial: False
-   ancestor: af1939970a1c, local: 044f8520aeeb+, remote: 85c198ef2f6c
-  note: possible conflict - a2 was renamed multiple times to:
-   b2
-   c2
-   b2: remote created -> g
-  getting b2
-   preserving a for resolve of b
-  removing a
-   b: remote moved from a -> m
-  picked tool ':merge' for b (binary False symlink False changedelete False)
-  merging a and b to b
-  my b@044f8520aeeb+ other b@85c198ef2f6c ancestor a@af1939970a1c
-   premerge successful
+   branchmerge: False, force: False, partial: False
+   ancestor: c19d34741b0a, local: c19d34741b0a+, remote: 1e71731e6fbb
+   b: remote created -> g
+  getting b
+   preserving a for resolve of a
+   a: versions differ -> m
+  picked tool 'true' for a (binary False symlink False changedelete False)
+  merging a
+  my a@c19d34741b0a+ other a@1e71731e6fbb ancestor a@c19d34741b0a
+  launching merge tool: true *$TESTTMP/r2/a* * * (glob)
+  merge tool returned: 0
   1 files updated, 1 files merged, 0 files removed, 0 files unresolved
-  (branch merge, don't forget to commit)
-
-  $ hg status -AC
-  M b
-    a
-  M b2
-  R a
-  C c2
-
-  $ cat b
-  blahblah
-
-  $ hg ci -m "merge"
-
-  $ hg debugindex b
-     rev linkrev       nodeid    p1-nodeid    p2-nodeid
-       0       1 57eacc201a7f 000000000000 000000000000
-       1       3 4727ba907962 000000000000 57eacc201a7f
-
-  $ hg debugrename b
-  b renamed from a:dd03b83622e78778b403775d0d074b9ac7387a66
-
-This used to trigger a "divergent renames" warning, despite no renames
-
-  $ hg cp b b3
-  $ hg cp b b4
-  $ hg ci -A -m 'copy b twice'
-  $ hg up '.^'
-  0 files updated, 0 files merged, 2 files removed, 0 files unresolved
-  $ hg up
-  2 files updated, 0 files merged, 0 files removed, 0 files unresolved
-  $ hg rm b3 b4
-  $ hg ci -m 'clean up a bit of our mess'
-
-We'd rather not warn on divergent renames done in the same changeset (issue2113)
-
-  $ hg cp b b3
-  $ hg mv b b4
-  $ hg ci -A -m 'divergent renames in same changeset'
-  $ hg up '.^'
-  1 files updated, 0 files merged, 2 files removed, 0 files unresolved
-  $ hg up
-  2 files updated, 0 files merged, 1 files removed, 0 files unresolved
-
-Check for issue2642
-
-  $ hg init t
-  $ cd t
+  $ hg parents
+  changeset:   1:1e71731e6fbb
+  tag:         tip
+  user:        test
+  date:        Thu Jan 01 00:00:00 1970 +0000
+  summary:     2
+  
+  $ hg --debug up 0
+  starting 4 threads for background file closing (?)
+  resolving manifests
+   branchmerge: False, force: False, partial: False
+   ancestor: 1e71731e6fbb, local: 1e71731e6fbb+, remote: c19d34741b0a
+   b: other deleted -> r
+  removing b
+  starting 4 threads for background file closing (?)
+   preserving a for resolve of a
+   a: versions differ -> m
+  picked tool 'true' for a (binary False symlink False changedelete False)
+  merging a
+  my a@1e71731e6fbb+ other a@c19d34741b0a ancestor a@1e71731e6fbb
+  launching merge tool: true *$TESTTMP/r2/a* * * (glob)
+  merge tool returned: 0
+  0 files updated, 1 files merged, 1 files removed, 0 files unresolved
+  $ hg parents
+  changeset:   0:c19d34741b0a
+  user:        test
+  date:        Thu Jan 01 00:00:00 1970 +0000
+  summary:     1
+  
+  $ hg --debug up
+  resolving manifests
+   branchmerge: False, force: False, partial: False
+   ancestor: c19d34741b0a, local: c19d34741b0a+, remote: 1e71731e6fbb
+   b: remote created -> g
+  getting b
+   preserving a for resolve of a
+   a: versions differ -> m
+  picked tool 'true' for a (binary False symlink False changedelete False)
+  merging a
+  my a@c19d34741b0a+ other a@1e71731e6fbb ancestor a@c19d34741b0a
+  launching merge tool: true *$TESTTMP/r2/a* * * (glob)
+  merge tool returned: 0
+  1 files updated, 1 files merged, 0 files removed, 0 files unresolved
+  $ hg parents
+  changeset:   1:1e71731e6fbb
+  tag:         tip
+  user:        test
+  date:        Thu Jan 01 00:00:00 1970 +0000
+  summary:     2
+  
+  $ hg -v history
+  changeset:   1:1e71731e6fbb
+  tag:         tip
+  user:        test
+  date:        Thu Jan 01 00:00:00 1970 +0000
+  files:       a b
+  description:
+  2
+  
+  
+  changeset:   0:c19d34741b0a
+  user:        test
+  date:        Thu Jan 01 00:00:00 1970 +0000
+  files:       a
+  description:
+  1
+  
+  
+  $ hg diff --nodates
+  diff -r 1e71731e6fbb a
+  --- a/a
+  +++ b/a
+  @@ -1,1 +1,1 @@
+  -a2
+  +abc
 
-  $ echo c0 > f1
-  $ hg ci -Aqm0
 
-  $ hg up null -q
-  $ echo c1 > f1 # backport
-  $ hg ci -Aqm1
-  $ hg mv f1 f2
-  $ hg ci -qm2
+create a second head
 
-  $ hg up 0 -q
-  $ hg merge 1 -q --tool internal:local
-  $ hg ci -qm3
+  $ cd ../r1
+  $ hg up 0
+  1 files updated, 0 files merged, 1 files removed, 0 files unresolved
+  $ echo b2 > b
+  $ echo a3 > a
+  $ hg addremove
+  adding b
+  $ hg commit -m "3"
+  created new head
 
-  $ hg merge 2
-  merging f1 and f2 to f2
-  0 files updated, 1 files merged, 0 files removed, 0 files unresolved
-  (branch merge, don't forget to commit)
+  $ cd ../r2
+  $ hg -q pull ../r1
+  $ hg status
+  M a
+  $ hg parents
+  changeset:   1:1e71731e6fbb
+  user:        test
+  date:        Thu Jan 01 00:00:00 1970 +0000
+  summary:     2
+  
+  $ hg --debug up
+  0 files updated, 0 files merged, 0 files removed, 0 files unresolved
+  updated to "1e71731e6fbb: 2"
+  1 other heads for branch "default"
+
+test conflicting untracked files
+
+  $ hg up -qC 0
+  $ echo untracked > b
+  $ hg st
+  ? b
+  $ hg up 1
+  b: untracked file differs
+  abort: untracked files in working directory differ from files in requested revision
+  [20]
+  $ rm b
+
+test conflicting untracked ignored file
+
+  $ hg up -qC 0
+  $ echo ignored > .hgignore
+  $ hg add .hgignore
+  $ hg ci -m 'add .hgignore'
+  created new head
+  $ echo ignored > ignored
+  $ hg add ignored
+  $ hg ci -m 'add ignored file'
+
+  $ hg up -q 'desc("add .hgignore")'
+  $ echo untracked > ignored
+  $ hg st
+  $ hg up 'desc("add ignored file")'
+  ignored: untracked file differs
+  abort: untracked files in working directory differ from files in requested revision
+  [20]
 
-  $ cat f2
-  c0
+test a local add
 
   $ cd ..
+  $ hg init a
+  $ hg init b
+  $ echo a > a/a
+  $ echo a > b/a
+  $ hg --cwd a commit -A -m a
+  adding a
+  $ cd b
+  $ hg add a
+  $ hg pull -u ../a
+  pulling from ../a
+  requesting all changes
+  adding changesets
+  adding manifests
+  adding file changes
+  added 1 changesets with 1 changes to 1 files
+  new changesets cb9a9f314b8b
+  1 files updated, 0 files merged, 0 files removed, 0 files unresolved
+  $ hg st
 
-Check for issue2089
-
-  $ hg init repo2089
-  $ cd repo2089
-
-  $ echo c0 > f1
-  $ hg ci -Aqm0
-
-  $ hg up null -q
-  $ echo c1 > f1
-  $ hg ci -Aqm1
-
-  $ hg up 0 -q
-  $ hg merge 1 -q --tool internal:local
-  $ echo c2 > f1
-  $ hg ci -qm2
-
-  $ hg up 1 -q
-  $ hg mv f1 f2
-  $ hg ci -Aqm3
-
-  $ hg up 2 -q
-  $ hg merge 3
-  merging f1 and f2 to f2
-  0 files updated, 1 files merged, 0 files removed, 0 files unresolved
-  (branch merge, don't forget to commit)
-
-  $ cat f2
-  c2
-
-  $ cd ..
+test updating backwards through a rename
 
-Check for issue3074
+  $ hg mv a b
+  $ hg ci -m b
+  $ echo b > b
+  $ hg up -q 0
+  $ hg st
+  M a
+  $ hg diff --nodates
+  diff -r cb9a9f314b8b a
+  --- a/a
+  +++ b/a
+  @@ -1,1 +1,1 @@
+  -a
+  +b
+
+test for superfluous filemerge of clean files renamed in the past
+
+  $ hg up -qC tip
+  $ echo c > c
+  $ hg add c
+  $ hg up -qt:fail 0
 
-  $ hg init repo3074
-  $ cd repo3074
-  $ echo foo > file
-  $ hg add file
-  $ hg commit -m "added file"
-  $ hg mv file newfile
-  $ hg commit -m "renamed file"
-  $ hg update 0
-  1 files updated, 0 files merged, 1 files removed, 0 files unresolved
-  $ hg rm file
-  $ hg commit -m "deleted file"
-  created new head
-  $ hg merge --debug
-    unmatched files in other:
-     newfile
-    all copies found (* = to merge, ! = divergent, % = renamed and deleted):
-     on remote side:
-      src: 'file' -> dst: 'newfile' %
-    checking for directory renames
-  resolving manifests
-   branchmerge: True, force: False, partial: False
-   ancestor: 19d7f95df299, local: 0084274f6b67+, remote: 5d32493049f0
-  note: possible conflict - file was deleted and renamed to:
-   newfile
-   newfile: remote created -> g
-  getting newfile
-  1 files updated, 0 files merged, 0 files removed, 0 files unresolved
-  (branch merge, don't forget to commit)
-  $ hg status
-  M newfile
   $ cd ..
-
-Create x and y, then modify y and rename x to z on one side of merge, and
-modify x and rename y to z on the other side.
-  $ hg init conflicting-target
-  $ cd conflicting-target
-  $ echo x > x
-  $ echo y > y
-  $ hg ci -Aqm 'add x and y'
-  $ hg mv x z
-  $ echo foo >> y
-  $ hg ci -qm 'modify y, rename x to z'
-  $ hg co -q 0
-  $ hg mv y z
-  $ echo foo >> x
-  $ hg ci -qm 'modify x, rename y to z'
-# We should probably tell the user about the conflicting rename sources.
-# Depending on which side they pick, we should take that rename and get
-# the changes to the source from the other side. The unchanged file should
-# remain.
-  $ hg merge --debug 1 -t :merge3
-    all copies found (* = to merge, ! = divergent, % = renamed and deleted):
-     on local side:
-      src: 'y' -> dst: 'z' *
-     on remote side:
-      src: 'x' -> dst: 'z' *
-    checking for directory renames
-  resolving manifests
-   branchmerge: True, force: False, partial: False
-   ancestor: 5151c134577e, local: 07fcbc9a74ed+, remote: f21419739508
-  starting 4 threads for background file closing (?)
-   preserving z for resolve of z
-   z: both renamed from y -> m
-  picked tool ':merge3' for z (binary False symlink False changedelete False)
-  merging z
-  my z@07fcbc9a74ed+ other z@f21419739508 ancestor y@5151c134577e
-   premerge successful
-  0 files updated, 1 files merged, 0 files removed, 0 files unresolved
-  (branch merge, don't forget to commit)
-  $ ls
-  x
-  z
-  $ cat x
-  x
-  foo
-# 'z' should have had the added 'foo' line
-  $ cat z
-  x
```

### Comparing `mercurial-6.4rc0/tests/test-rename-merge2.t` & `mercurial-6.5rc0/tests/test-rename-merge2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rename-rev.t` & `mercurial-6.5rc0/tests/test-rename-rev.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rename.t` & `mercurial-6.5rc0/tests/test-rename.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-repair-strip.t` & `mercurial-6.5rc0/tests/test-repair-strip.t`

 * *Files 4% similar despite different names*

```diff
@@ -49,17 +49,17 @@
   date:        Thu Jan 01 00:00:00 1970 +0000
   summary:     a
   
   saved backup bundle
   transaction abort!
   failed to truncate data/b.i
   rollback failed - please run hg recover
-  (failure reason: [Errno *] Permission denied .hg/store/data/b.i') (glob)
+  (failure reason: [Errno *] $EACCES$ .hg/store/data/b.i') (glob)
   strip failed, backup bundle
-  abort: Permission denied .hg/store/data/b.i'
+  abort: $EACCES$ .hg/store/data/b.i'
   % after update 0, strip 2
   abandoned transaction found - run hg recover
   checking changesets
   checking manifests
   crosschecking files in changesets and manifests
   checking files
    b@?: rev 1 points to nonexistent changeset 2
@@ -85,15 +85,15 @@
   $ teststrip 0 2 r .hg/store/data/b.i
   % before update 0, strip 2
   changeset:   0:cb9a9f314b8b
   user:        test
   date:        Thu Jan 01 00:00:00 1970 +0000
   summary:     a
   
-  abort: Permission denied .hg/store/data/b.i'
+  abort: $EACCES$ .hg/store/data/b.i'
   % after update 0, strip 2
   checking changesets
   checking manifests
   crosschecking files in changesets and manifests
   checking files
   checking dirstate
   checked 4 changesets with 4 changes to 3 files
@@ -106,17 +106,17 @@
   date:        Thu Jan 01 00:00:00 1970 +0000
   summary:     a
   
   saved backup bundle
   transaction abort!
   failed to truncate 00manifest.i
   rollback failed - please run hg recover
-  (failure reason: [Errno *] Permission denied .hg/store/00manifest.i') (glob)
+  (failure reason: [Errno *] $EACCES$ .hg/store/00manifest.i') (glob)
   strip failed, backup bundle
-  abort: Permission denied .hg/store/00manifest.i'
+  abort: $EACCES$ .hg/store/00manifest.i'
   % after update 0, strip 2
   abandoned transaction found - run hg recover
   checking changesets
   checking manifests
    manifest@?: rev 2 points to nonexistent changeset 2
    manifest@?: 3362547cdf64 not in changesets
    manifest@?: rev 3 points to nonexistent changeset 3
```

### Comparing `mercurial-6.4rc0/tests/test-repo-compengines.t` & `mercurial-6.5rc0/tests/test-repo-compengines.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-repo-filters-tiptoe.t` & `mercurial-6.5rc0/tests/test-repo-filters-tiptoe.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-requires.t` & `mercurial-6.5rc0/tests/test-requires.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-resolve.t` & `mercurial-6.5rc0/tests/test-resolve.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revert-interactive-curses.t` & `mercurial-6.5rc0/tests/test-revert-interactive-curses.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revert-interactive.t` & `mercurial-6.5rc0/tests/test-revert-interactive.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revert.t` & `mercurial-6.5rc0/tests/test-revert.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revisions.t` & `mercurial-6.5rc0/tests/test-revisions.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revlog-ancestry.py` & `mercurial-6.5rc0/tests/test-revlog-ancestry.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revlog-delta-find.t` & `mercurial-6.5rc0/tests/test-revlog-delta-find.t`

 * *Files 6% similar despite different names*

```diff
@@ -325,9 +325,38 @@
   $ cp -ar local-pre-pull-full local-forced-full-p1
   $ hg -R local-forced-full-p1 pull --quiet \
   > --config 'paths.*:pulled-delta-reuse-policy=forced' all-p1.hg
   DBG-DELTAS: CHANGELOG: * (glob)
   DBG-DELTAS: CHANGELOG: * (glob)
   DBG-DELTAS: MANIFESTLOG: * (glob)
   DBG-DELTAS: MANIFESTLOG: * (glob)
-  DBG-DELTAS: FILELOG:my-file.txt: rev=3: delta-base=2 * (glob)
-  DBG-DELTAS: FILELOG:my-file.txt: rev=4: delta-base=3 * (glob)
+  DBG-DELTAS: FILELOG:my-file.txt: rev=3: delta-base=2 is-cached=1 *search-rounds=0 try-count=0* (glob)
+  DBG-DELTAS: FILELOG:my-file.txt: rev=4: delta-base=3 is-cached=1 *search-rounds=0 try-count=0* (glob)
+
+Check that running "forced" on a non-general delta repository does not corrupt it
+---------------------------------------------------------------------------------
+
+Even if requested to be used, some of the delta in the revlog cannot be stored on a non-general delta repository. We check that the bundle application was correct.
+
+  $ hg init \
+  >    --config format.usegeneraldelta=no \
+  >    --config format.sparse-revlog=no \
+  >    local-forced-full-p1-no-gd
+  $ hg debugformat -R local-forced-full-p1-no-gd | grep generaldelta
+  generaldelta:        no
+  $ hg -R local-forced-full-p1-no-gd pull --quiet local-pre-pull-full \
+  >    --config debug.revlog.debug-delta=no
+  $ hg -R local-forced-full-p1-no-gd pull --quiet \
+  > --config 'paths.*:pulled-delta-reuse-policy=forced' all-p1.hg
+  DBG-DELTAS: CHANGELOG: * (glob)
+  DBG-DELTAS: CHANGELOG: * (glob)
+  DBG-DELTAS: MANIFESTLOG: * (glob)
+  DBG-DELTAS: MANIFESTLOG: * (glob)
+  DBG-DELTAS: FILELOG:my-file.txt: rev=3: delta-base=0 * - search-rounds=1 try-count=1 * (glob)
+  DBG-DELTAS: FILELOG:my-file.txt: rev=4: delta-base=4 * - search-rounds=1 try-count=1 * (glob)
+  $ hg -R local-forced-full-p1-no-gd verify
+  checking changesets
+  checking manifests
+  crosschecking files in changesets and manifests
+  checking files
+  checking dirstate
+  checked 5 changesets with 5 changes to 1 files
```

### Comparing `mercurial-6.4rc0/tests/test-revlog-group-emptyiter.t` & `mercurial-6.5rc0/tests/test-revlog-group-emptyiter.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revlog-mmapindex.t` & `mercurial-6.5rc0/tests/test-revlog-mmapindex.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revlog-raw.py` & `mercurial-6.5rc0/tests/test-revlog-raw.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revlog-v2.t` & `mercurial-6.5rc0/tests/test-revlog-v2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revlog.t` & `mercurial-6.5rc0/tests/test-revlog.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revset-dirstate-parents.t` & `mercurial-6.5rc0/tests/test-revset-dirstate-parents.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revset-legacy-lookup.t` & `mercurial-6.5rc0/tests/test-revset-legacy-lookup.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revset-outgoing.t` & `mercurial-6.5rc0/tests/test-revset-outgoing.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revset.t` & `mercurial-6.5rc0/tests/test-revset.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-revset2.t` & `mercurial-6.5rc0/tests/test-revset2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rhg-no-generaldelta.t` & `mercurial-6.5rc0/tests/test-rhg-no-generaldelta.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rhg-sparse-narrow.t` & `mercurial-6.5rc0/tests/test-rhg-sparse-narrow.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rhg.t` & `mercurial-6.5rc0/tests/test-rhg.t`

 * *Files 3% similar despite different names*

```diff
@@ -67,14 +67,29 @@
   $ mkdir -p path/to/directory
   $ cd path/to/directory
   $ $NO_FALLBACK rhg files
   ../../../file1
   ../../../file2
   ../../../file3
 
+  $ $NO_FALLBACK rhg files --config ui.relative-paths=legacy
+  ../../../file1
+  ../../../file2
+  ../../../file3
+
+  $ $NO_FALLBACK rhg files --config ui.relative-paths=false
+  file1
+  file2
+  file3
+
+  $ $NO_FALLBACK rhg files --config ui.relative-paths=true
+  ../../../file1
+  ../../../file2
+  ../../../file3
+
 Listing tracked files through broken pipe
   $ $NO_FALLBACK rhg files | head -n 1
   ../../../file1
 
 Debuging data in inline index
   $ cd $TESTTMP
   $ rm -rf repository
```

### Comparing `mercurial-6.4rc0/tests/test-rollback.t` & `mercurial-6.5rc0/tests/test-rollback.t`

 * *Files 0% similar despite different names*

```diff
@@ -68,15 +68,15 @@
   o  1  [test] () modify a again
   |
   o  0  [default] (bar) add a again
   
   $ hg update bar
   1 files updated, 0 files merged, 1 files removed, 0 files unresolved
   (activating bookmark bar)
-  $ cat .hg/undo.backup.branch
+  $ cat .hg/undo.backup.branch.bck
   test
   $ hg log -G --template '{rev}  [{branch}] ({bookmarks}) {desc|firstline}\n'
   o  2  [test] (foo) add b
   |
   o  1  [test] () modify a again
   |
   @  0  [default] (bar) add a again
```

### Comparing `mercurial-6.4rc0/tests/test-run-tests.py` & `mercurial-6.5rc0/tests/test-run-tests.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-run-tests.t` & `mercurial-6.5rc0/tests/test-run-tests.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rust-ancestor.py` & `mercurial-6.5rc0/tests/test-rust-ancestor.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rust-discovery.py` & `mercurial-6.5rc0/tests/test-rust-discovery.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-rust-revlog.py` & `mercurial-6.5rc0/tests/test-rust-revlog.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-schemes.t` & `mercurial-6.5rc0/tests/test-schemes.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-serve.t` & `mercurial-6.5rc0/tests/test-serve.t`

 * *Files 2% similar despite different names*

```diff
@@ -51,15 +51,15 @@
 #
 # On some others the kernel is configured to allow any user to bind them and
 # this will work fine
 
 #if no-windows
   $ KILLQUIETLY=Y
   $ hgserve -p daytime
-  abort: cannot start server at 'localhost:13': Permission denied (?)
+  abort: cannot start server at 'localhost:13': $EACCES$ (?)
   abort: child process failed to start (?)
   abort: no port number associated with service 'daytime' (?)
   listening at http://localhost/ (bound to $LOCALIP:13) (?)
   % errors
   $ KILLQUIETLY=N
 #endif
```

### Comparing `mercurial-6.4rc0/tests/test-server-view.t` & `mercurial-6.5rc0/tests/test-server-view.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-setdiscovery.t` & `mercurial-6.5rc0/tests/test-setdiscovery.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-share-bookmarks.t` & `mercurial-6.5rc0/tests/test-share-bookmarks.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-share-safe.t` & `mercurial-6.5rc0/tests/test-share-safe.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-share.t` & `mercurial-6.5rc0/tests/test-share.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-shelve.t` & `mercurial-6.5rc0/tests/test-shelve.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-shelve2.t` & `mercurial-6.5rc0/tests/test-shelve2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-show-stack.t` & `mercurial-6.5rc0/tests/test-show-stack.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-show-work.t` & `mercurial-6.5rc0/tests/test-show-work.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-show.t` & `mercurial-6.5rc0/tests/test-show.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sidedata-exchange.t` & `mercurial-6.5rc0/tests/test-sidedata-exchange.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sidedata.t` & `mercurial-6.5rc0/tests/test-sidedata.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-simple-update.t` & `mercurial-6.5rc0/tests/test-simple-update.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-simplekeyvaluefile.py` & `mercurial-6.5rc0/tests/test-simplekeyvaluefile.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-simplemerge.py` & `mercurial-6.5rc0/tests/test-simplemerge.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-single-head-obsolescence-named-branch-A1.t` & `mercurial-6.5rc0/tests/test-single-head-obsolescence-named-branch-A1.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-single-head-obsolescence-named-branch-A2.t` & `mercurial-6.5rc0/tests/test-single-head-obsolescence-named-branch-A2.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-single-head-obsolescence-named-branch-A3.t` & `mercurial-6.5rc0/tests/test-single-head-obsolescence-named-branch-A3.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-single-head-obsolescence-named-branch-A4.t` & `mercurial-6.5rc0/tests/test-single-head-obsolescence-named-branch-A4.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-single-head-obsolescence-named-branch-A5.t` & `mercurial-6.5rc0/tests/test-single-head-obsolescence-named-branch-A5.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-single-head.t` & `mercurial-6.5rc0/tests/test-single-head.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sparse-clear.t` & `mercurial-6.5rc0/tests/test-sparse-clear.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sparse-clone.t` & `mercurial-6.5rc0/tests/test-sparse-clone.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sparse-fsmonitor.t` & `mercurial-6.5rc0/tests/test-sparse-fsmonitor.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sparse-import.t` & `mercurial-6.5rc0/tests/test-sparse-import.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sparse-merges.t` & `mercurial-6.5rc0/tests/test-sparse-merges.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sparse-profiles.t` & `mercurial-6.5rc0/tests/test-sparse-profiles.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sparse-requirement.t` & `mercurial-6.5rc0/tests/test-sparse-requirement.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sparse-revlog.t` & `mercurial-6.5rc0/tests/test-sparse-revlog.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sparse-verbose-json.t` & `mercurial-6.5rc0/tests/test-sparse-verbose-json.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sparse.t` & `mercurial-6.5rc0/tests/test-sparse.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-split.t` & `mercurial-6.5rc0/tests/test-split.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-sqlitestore.t` & `mercurial-6.5rc0/tests/test-sqlitestore.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-ssh-batch.t` & `mercurial-6.5rc0/tests/test-ssh-batch.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-ssh-bundle1.t` & `mercurial-6.5rc0/tests/test-ssh-bundle1.t`

 * *Files 0% similar despite different names*

```diff
@@ -399,17 +399,17 @@
 
   $ cd read-only-local
   $ echo "baz" > bar
   $ hg ci -A -m "unpushable commit" bar
   $ hg push --ssh "sh ../ssh.sh"
   pushing to ssh://user@dummy/*/remote (glob)
   searching for changes
-  remote: Permission denied
+  remote: $EACCES$
   remote: abort: pretxnopen.hg-ssh hook failed
-  remote: Permission denied
+  remote: $EACCES$
   remote: pushkey-abort: prepushkey.hg-ssh hook failed
   updating 6c0482d977a3 to public failed!
   [1]
 
   $ cd $TESTTMP
 
 stderr from remote commands should be printed before stdout from local code (issue4336)
```

### Comparing `mercurial-6.4rc0/tests/test-ssh-clone-r.t` & `mercurial-6.5rc0/tests/test-ssh-clone-r.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-ssh-proto-unbundle.t` & `mercurial-6.5rc0/tests/test-ssh-proto-unbundle.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-ssh-proto.t` & `mercurial-6.5rc0/tests/test-ssh-proto.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-ssh-repoerror.t` & `mercurial-6.5rc0/tests/test-ssh-repoerror.t`

 * *Files 12% similar despite different names*

```diff
@@ -9,15 +9,15 @@
 
   $ hg init no-read
   $ hg id ssh://user@dummy/no-read
   000000000000
   $ chmod a-rx no-read
 
   $ hg id ssh://user@dummy/no-read
-  remote: abort: Permission denied: *$TESTTMP/no-read/.hg* (glob)
+  remote: abort: $EACCES$: *$TESTTMP/no-read/.hg* (glob)
   abort: no suitable response from remote hg
   [255]
 
 special case files are visible, but unreadable
 ----------------------------------------------
 
 This is "similar" to the test above, but the directory is "traversable". This
@@ -27,15 +27,15 @@
   $ hg id ssh://user@dummy/other
   000000000000
   $ for item in `find other | sort -r` ; do
   >     chmod a-r $item
   > done
 
   $ hg id ssh://user@dummy/other
-  remote: abort: Permission denied: '$TESTTMP/other/.hg/requires'
+  remote: abort: $EACCES$: '$TESTTMP/other/.hg/requires'
   abort: no suitable response from remote hg
   [255]
 
 directory toward the repository is read only
 --------------------------------------------
 
   $ mkdir deep
@@ -43,15 +43,15 @@
 
   $ hg id ssh://user@dummy/deep/nested
   000000000000
 
   $ chmod a-rx deep
 
   $ hg id ssh://user@dummy/deep/nested
-  remote: abort: Permission denied: *$TESTTMP/deep/nested/.hg* (glob)
+  remote: abort: $EACCES$: *$TESTTMP/deep/nested/.hg* (glob)
   abort: no suitable response from remote hg
   [255]
 
 repository has wrong requirement
 --------------------------------
 
   $ hg init repo-future
```

### Comparing `mercurial-6.4rc0/tests/test-ssh.t` & `mercurial-6.5rc0/tests/test-ssh.t`

 * *Files 0% similar despite different names*

```diff
@@ -452,15 +452,15 @@
 
   $ cd read-only-local
   $ echo "baz" > bar
   $ hg ci -A -m "unpushable commit" bar
   $ hg push --ssh "sh ../ssh.sh"
   pushing to ssh://user@dummy/*/remote (glob)
   searching for changes
-  remote: Permission denied
+  remote: $EACCES$
   remote: pretxnopen.hg-ssh hook failed
   abort: push failed on remote
   [100]
 
   $ cd $TESTTMP
 
 stderr from remote commands should be printed before stdout from local code (issue4336)
@@ -525,15 +525,15 @@
   devel-peer-request:   cmds: 141 bytes
   sending batch command
   searching for changes
   all remote heads known locally
   no changes found
   devel-peer-request: getbundle
   devel-peer-request:   bookmarks: 1 bytes
-  devel-peer-request:   bundlecaps: 270 bytes
+  devel-peer-request:   bundlecaps: 275 bytes
   devel-peer-request:   cg: 1 bytes
   devel-peer-request:   common: 122 bytes
   devel-peer-request:   heads: 122 bytes
   devel-peer-request:   listkeys: 9 bytes
   devel-peer-request:   phases: 1 bytes
   sending getbundle command
   bundle2-input-bundle: with-transaction
```

### Comparing `mercurial-6.4rc0/tests/test-sshserver.py` & `mercurial-6.5rc0/tests/test-sshserver.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-stack.t` & `mercurial-6.5rc0/tests/test-stack.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-state-extension.t` & `mercurial-6.5rc0/tests/test-state-extension.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-static-http.t` & `mercurial-6.5rc0/tests/test-static-http.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-status-color.t` & `mercurial-6.5rc0/tests/test-status-color.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-status-inprocess.py` & `mercurial-6.5rc0/tests/test-status-inprocess.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-status-rev.t` & `mercurial-6.5rc0/tests/test-status-rev.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-status-terse.t` & `mercurial-6.5rc0/tests/test-status-terse.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-status-tracked-key.t` & `mercurial-6.5rc0/tests/test-status-tracked-key.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-status.t` & `mercurial-6.5rc0/tests/test-status.t`

 * *Files 1% similar despite different names*

```diff
@@ -242,14 +242,19 @@
   A added
   A copied
     modified
   R removed
   ! deleted
   ? unknown
 
+hg status -0:
+
+  $ hg status -0 --config rhg.on-unsupported=abort
+  A added\x00A copied\x00R removed\x00! deleted\x00? unknown\x00 (no-eol) (esc)
+
 hg status -A:
 
   $ hg status -A
   A added
   A copied
     modified
   R removed
@@ -845,15 +850,15 @@
 
 Not having permission to read a directory that contains tracked files makes
 status emit a warning then behave as if the directory was empty or removed
 entirely:
 
   $ chmod 0 subdir
   $ hg status --include subdir
-  subdir: Permission denied
+  subdir: $EACCES$
   R subdir/removed
   ! subdir/clean
   ! subdir/deleted
   ! subdir/modified
   $ chmod 755 subdir
 
 #endif
@@ -996,7 +1001,31 @@
 One invocation of status is enough to populate the cache even if it's invalidated
 in the same run.
 
   $ hg debugdirstate --all --no-dates | grep '^ '
       0         -1 set                 subdir
 
 #endif
+
+
+Test copy source formatting.
+  $ cd ..
+  $ hg init copy-source-repo
+  $ cd copy-source-repo
+  $ mkdir -p foo/bar
+  $ cd foo/bar
+  $ touch file
+  $ hg addremove
+  adding foo/bar/file
+  $ hg commit -m 'add file'
+  $ hg mv file copy
+
+Copy source respects relative path setting.
+  $ hg st --config ui.statuscopies=true --config commands.status.relative=true
+  A copy
+    file
+  R file
+
+Copy source is not shown when --no-status is passed.
+  $ hg st --config ui.statuscopies=true --no-status
+  foo/bar/copy
+  foo/bar/file
```

### Comparing `mercurial-6.4rc0/tests/test-stdio.py` & `mercurial-6.5rc0/tests/test-stdio.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-storage.py` & `mercurial-6.5rc0/tests/test-storage.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-strip-branch-cache.t` & `mercurial-6.5rc0/tests/test-strip-branch-cache.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-strip-cross.t` & `mercurial-6.5rc0/tests/test-strip-cross.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-strip.t` & `mercurial-6.5rc0/tests/test-strip.t`

 * *Files 0% similar despite different names*

```diff
@@ -247,15 +247,15 @@
   changeset:   1:ef3a871183d7
   user:        test
   date:        Thu Jan 01 00:00:00 1970 +0000
   summary:     b
   
   $ hg debugbundle .hg/strip-backup/*
   Stream params: {Compression: BZ}
-  changegroup -- {nbchanges: 1, version: 02} (mandatory: True)
+  changegroup -- {nbchanges: 1, version: 03} (mandatory: True)
       264128213d290d868c54642d13aeaa3675551a78
   cache:rev-branch-cache -- {} (mandatory: False)
   phase-heads -- {} (mandatory: True)
       264128213d290d868c54642d13aeaa3675551a78 draft
   $ hg unbundle .hg/strip-backup/*
   adding changesets
   adding manifests
```

### Comparing `mercurial-6.4rc0/tests/test-subrepo-deep-nested-change.t` & `mercurial-6.5rc0/tests/test-subrepo-deep-nested-change.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-subrepo-git.t` & `mercurial-6.5rc0/tests/test-subrepo-git.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-subrepo-missing.t` & `mercurial-6.5rc0/tests/test-subrepo-missing.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-subrepo-paths.t` & `mercurial-6.5rc0/tests/test-subrepo-paths.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-subrepo-recursion.t` & `mercurial-6.5rc0/tests/test-subrepo-recursion.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-subrepo-relative-path.t` & `mercurial-6.5rc0/tests/test-subrepo-relative-path.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-subrepo-svn.t` & `mercurial-6.5rc0/tests/test-subrepo-svn.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-subrepo.t` & `mercurial-6.5rc0/tests/test-subrepo.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-symlink-os-yes-fs-no.py` & `mercurial-6.5rc0/tests/test-symlink-os-yes-fs-no.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-symlink-placeholder.t` & `mercurial-6.5rc0/tests/test-symlink-placeholder.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-symlinks.t` & `mercurial-6.5rc0/tests/test-symlinks.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-tag.t` & `mercurial-6.5rc0/tests/test-tag.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-tags.t` & `mercurial-6.5rc0/tests/test-tags.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-template-basic.t` & `mercurial-6.5rc0/tests/test-template-basic.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-template-functions.t` & `mercurial-6.5rc0/tests/test-template-functions.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-template-graph.t` & `mercurial-6.5rc0/tests/test-template-graph.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-template-keywords.t` & `mercurial-6.5rc0/tests/test-template-keywords.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-template-map.t` & `mercurial-6.5rc0/tests/test-template-map.t`

 * *Files 1% similar despite different names*

```diff
@@ -1256,15 +1256,15 @@
 
 Error if style not readable:
 
 #if unix-permissions no-root
   $ touch q
   $ chmod 0 q
   $ hg log --style ./q
-  abort: Permission denied: './q'
+  abort: $EACCES$: './q'
   [255]
 #endif
 
 Error if no style:
 
   $ hg log --style notexist
   abort: style 'notexist' not found
@@ -1305,15 +1305,15 @@
   [10]
 
 Error if include fails:
 
   $ echo 'changeset = q' >> t
 #if unix-permissions no-root
   $ hg log --style ./t
-  abort: template file ./q: Permission denied
+  abort: template file ./q: $EACCES$
   [255]
   $ rm -f q
 #endif
 
 Include works:
 
   $ echo '{rev}' > q
```

### Comparing `mercurial-6.4rc0/tests/test-tools.t` & `mercurial-6.5rc0/tests/test-tools.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-transaction-rollback-on-sigpipe.t` & `mercurial-6.5rc0/tests/test-transaction-rollback-on-sigpipe.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-transaction-safety.t` & `mercurial-6.5rc0/tests/test-transaction-safety.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-transaction-wc-rollback-race.t` & `mercurial-6.5rc0/tests/test-transaction-wc-rollback-race.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-transplant.t` & `mercurial-6.5rc0/tests/test-transplant.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-treediscovery-legacy.t` & `mercurial-6.5rc0/tests/test-treediscovery-legacy.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-treediscovery.t` & `mercurial-6.5rc0/tests/test-treediscovery.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-treemanifest.t` & `mercurial-6.5rc0/tests/test-treemanifest.t`

 * *Files 2% similar despite different names*

```diff
@@ -207,29 +207,32 @@
   $ hg ci -Aqm 'modify on branch 2'
 
   $ hg merge 1
   3 files updated, 0 files merged, 0 files removed, 0 files unresolved
   (branch merge, don't forget to commit)
   $ hg ci -m 'merge of flat manifests to new flat manifest'
 
-  $ hg serve -p $HGPORT -d --pid-file=hg.pid --errorlog=errors.log
-  $ cat hg.pid >> $DAEMON_PIDS
+  $ cd ..
+  $ hg -R repo-flat serve -p $HGPORT -d \
+  >   --pid-file=port-0-hg.pid \
+  >   --errorlog=port-0-errors.log
+  $ cat port-0-hg.pid >> $DAEMON_PIDS
 
 Create clone with tree manifests enabled
 
-  $ cd ..
   $ hg clone --config experimental.treemanifest=1 \
   >   http://localhost:$HGPORT repo-mixed -r 1
   adding changesets
   adding manifests
   adding file changes
   added 2 changesets with 14 changes to 11 files
   new changesets 5b02a3e8db7e:581ef6037d8b
   updating to branch default
   11 files updated, 0 files merged, 0 files removed, 0 files unresolved
+  $ cat port-0-errors.log
   $ cd repo-mixed
   $ test -d .hg/store/meta
   [1]
   $ hg debugrequires | grep treemanifest
   treemanifest
 
 Should be possible to push updates from flat to tree manifest repo
@@ -650,31 +653,35 @@
   2 warnings encountered!
   8 integrity errors encountered!
   (first damaged changeset appears to be 2)
   [1]
   $ cp -R .hg/store-newcopy/. .hg/store
 
 Test cloning a treemanifest repo over http.
-  $ hg serve -p $HGPORT -d --pid-file=hg.pid --errorlog=errors.log
-  $ cat hg.pid >> $DAEMON_PIDS
   $ cd ..
+  $ hg -R deeprepo serve -p $HGPORT -d \
+  >   --pid-file=port-0-hg.pid \
+  >   --errorlog=port-0-errors.log
+  $ cat port-0-hg.pid >> $DAEMON_PIDS
+
 We can clone even with the knob turned off and we'll get a treemanifest repo.
   $ hg clone --config experimental.treemanifest=False \
   >   --config experimental.changegroup3=True \
   >   http://localhost:$HGPORT deepclone
   requesting all changes
   adding changesets
   adding manifests
   adding file changes
   added 4 changesets with 18 changes to 8 files
   new changesets 775704be6f52:523e5c631710
   updating to branch default
   8 files updated, 0 files merged, 0 files removed, 0 files unresolved
 No server errors.
-  $ cat deeprepo/errors.log
+  $ cat port-0-errors.log
+
 requires got updated to include treemanifest
   $ hg debugrequires -R deepclone | grep treemanifest
   treemanifest
 Tree manifest revlogs exist.
   $ find deepclone/.hg/store/meta | sort
   deepclone/.hg/store/meta
   deepclone/.hg/store/meta/._a (reposimplestore !)
@@ -709,37 +716,38 @@
   adding changesets
   adding manifests
   adding file changes
   added 4 changesets with 18 changes to 8 files
   new changesets 775704be6f52:523e5c631710
   updating to branch default
   8 files updated, 0 files merged, 0 files removed, 0 files unresolved
-  $ cd deeprepo-basicstore
-  $ hg debugrequires | grep store
+  $ hg -R deeprepo-basicstore debugrequires | grep store
   [1]
-  $ hg serve -p $HGPORT1 -d --pid-file=hg.pid --errorlog=errors.log
-  $ cat hg.pid >> $DAEMON_PIDS
-  $ cd ..
+  $ hg -R deeprepo-basicstore serve -p $HGPORT1 -d \
+  >   --pid-file=port-1-hg.pid \
+  >   --errorlog=port-1-errors.log
+  $ cat port-1-hg.pid >> $DAEMON_PIDS
+
   $ hg clone --config format.usefncache=False \
   >   --config experimental.changegroup3=True \
   >   http://localhost:$HGPORT deeprepo-encodedstore
   requesting all changes
   adding changesets
   adding manifests
   adding file changes
   added 4 changesets with 18 changes to 8 files
   new changesets 775704be6f52:523e5c631710
   updating to branch default
   8 files updated, 0 files merged, 0 files removed, 0 files unresolved
-  $ cd deeprepo-encodedstore
-  $ hg debugrequires | grep fncache
+  $ hg -R deeprepo-encodedstore debugrequires | grep fncache
   [1]
-  $ hg serve -p $HGPORT2 -d --pid-file=hg.pid --errorlog=errors.log
-  $ cat hg.pid >> $DAEMON_PIDS
-  $ cd ..
+  $ hg -R deeprepo-encodedstore serve -p $HGPORT2 -d \
+  >   --pid-file=port-2-hg.pid \
+  >   --errorlog=port-2-errors.log
+  $ cat port-2-hg.pid >> $DAEMON_PIDS
 
 Local clone with basicstore
   $ hg clone -U deeprepo-basicstore local-clone-basicstore
   $ hg -R local-clone-basicstore verify -q
 
 Local clone with encodedstore
   $ hg clone -U deeprepo-encodedstore local-clone-encodedstore
@@ -752,30 +760,33 @@
 Stream clone with basicstore
   $ hg clone --config experimental.changegroup3=True --stream -U \
   >   http://localhost:$HGPORT1 stream-clone-basicstore
   streaming all changes
   28 files to transfer, * of data (glob)
   transferred * in * seconds (*) (glob)
   $ hg -R stream-clone-basicstore verify -q
+  $ cat port-1-errors.log
 
 Stream clone with encodedstore
   $ hg clone --config experimental.changegroup3=True --stream -U \
   >   http://localhost:$HGPORT2 stream-clone-encodedstore
   streaming all changes
   28 files to transfer, * of data (glob)
   transferred * in * seconds (*) (glob)
   $ hg -R stream-clone-encodedstore verify -q
+  $ cat port-2-errors.log
 
 Stream clone with fncachestore
   $ hg clone --config experimental.changegroup3=True --stream -U \
   >   http://localhost:$HGPORT stream-clone-fncachestore
   streaming all changes
   22 files to transfer, * of data (glob)
   transferred * in * seconds (*) (glob)
   $ hg -R stream-clone-fncachestore verify -q
+  $ cat port-0-errors.log
 
 Packed bundle
   $ hg -R deeprepo debugcreatestreamclonebundle repo-packed.hg
   writing 5330 bytes for 18 files (no-zstd !)
   writing 5400 bytes for 18 files (zstd !)
   bundle requirements:.* treemanifest(,.*)? (re)
   $ hg debugbundle --spec repo-packed.hg
@@ -838,7 +849,56 @@
   $ hg rm z
   $ hg commit --amend -m 'empty commit'
   saved backup bundle to $TESTTMP/grafted-dir-repo-clone/.hg/strip-backup/cb99d5717cea-9e3b6b02-amend.hg
   $ hg log -r 'tip + tip^' -T '{manifest}\n'
   1:678d3574b88c
   1:678d3574b88c
   $ hg --config extensions.strip= strip -r . -q
+
+Testing repository upgrade
+--------------------------
+
+  $ for x in 1 2 3 4 5 6 7 8 9; do
+  >    echo $x > file-$x # make sure we have interresting compression
+  >    echo $x > dir/foo-$x # make sure we have interresting compression
+  >    hg add file-$x
+  >    hg add dir/foo-$x
+  > done
+  $ hg ci -m 'have some content'
+  $ f -s .hg/store/00manifest.*
+  .hg/store/00manifest.i: size=798 (no-pure !)
+  .hg/store/00manifest.i: size=784 (pure !)
+  $ f -s .hg/store/meta/dir/00manifest*
+  .hg/store/meta/dir/00manifest.i: size=556 (no-pure !)
+  .hg/store/meta/dir/00manifest.i: size=544 (pure !)
+  $ hg debugupgraderepo --config format.revlog-compression=none --config experimental.treemanifest=yes --run --quiet --no-backup
+  upgrade will perform the following actions:
+  
+  requirements
+     preserved: * (glob)
+     removed: revlog-compression-zstd (no-pure !)
+     added: exp-compression-none
+  
+  processed revlogs:
+    - all-filelogs
+    - changelog
+    - manifest
+  
+  $ hg verify
+  checking changesets
+  checking manifests
+  checking directory manifests
+  crosschecking files in changesets and manifests
+  checking files
+  checking dirstate
+  checked 4 changesets with 22 changes to 20 files
+  $ f -s .hg/store/00manifest.*
+  .hg/store/00manifest.i: size=1002
+  $ f -s .hg/store/meta/dir/00manifest*
+  .hg/store/meta/dir/00manifest.i: size=721
+  $ hg files --rev tip | wc -l
+  \s*20 (re)
+
+testing cache update warming persistent nodemaps
+------------------------------------------------
+
+  $ hg debugupdatecache
```

### Comparing `mercurial-6.4rc0/tests/test-trusted.py` & `mercurial-6.5rc0/tests/test-trusted.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-trusted.py.out` & `mercurial-6.5rc0/tests/test-trusted.py.out`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-ui-color.py` & `mercurial-6.5rc0/tests/test-ui-color.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-ui-config.py` & `mercurial-6.5rc0/tests/test-ui-config.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-ui-config.py.out` & `mercurial-6.5rc0/tests/test-ui-config.py.out`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-ui-verbosity.py` & `mercurial-6.5rc0/tests/test-ui-verbosity.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-ui-verbosity.py.out` & `mercurial-6.5rc0/tests/test-ui-verbosity.py.out`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-unamend.t` & `mercurial-6.5rc0/tests/test-unamend.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-unbundlehash.t` & `mercurial-6.5rc0/tests/test-unbundlehash.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-uncommit.t` & `mercurial-6.5rc0/tests/test-uncommit.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-unified-test.t` & `mercurial-6.5rc0/tests/test-unified-test.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-unionrepo.t` & `mercurial-6.5rc0/tests/test-unionrepo.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-unrelated-pull.t` & `mercurial-6.5rc0/tests/test-unrelated-pull.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-update-atomic.t` & `mercurial-6.5rc0/tests/test-update-atomic.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-update-branches.t` & `mercurial-6.5rc0/tests/test-update-branches.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-update-dest.t` & `mercurial-6.5rc0/tests/test-update-dest.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-update-issue1456.t` & `mercurial-6.5rc0/tests/test-update-issue1456.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-update-names.t` & `mercurial-6.5rc0/tests/test-update-names.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-update-reverse.t` & `mercurial-6.5rc0/tests/test-update-reverse.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-upgrade-repo.t` & `mercurial-6.5rc0/tests/test-upgrade-repo.t`

 * *Files 1% similar despite different names*

```diff
@@ -188,19 +188,19 @@
   
   changeset:   7:e60bfe72517e
   user:        debugbuilddag
   date:        Thu Jan 01 00:00:07 1970 +0000
   summary:     r7
   
 
-Do not yet support upgrading treemanifest repos
+Do not yet support downgrading treemanifest repos
 
   $ hg --config experimental.treemanifest=true init treemanifest
   $ hg -R treemanifest debugupgraderepo
-  abort: cannot upgrade repository; unsupported source requirement: treemanifest
+  abort: cannot upgrade repository; requirement would be removed: treemanifest
   [255]
 
 Cannot add treemanifest requirement during upgrade
 
   $ hg init disallowaddedreq
   $ hg -R disallowaddedreq --config experimental.treemanifest=true debugupgraderepo
   abort: cannot upgrade repository; do not support adding requirement: treemanifest
@@ -835,14 +835,15 @@
 
 store directory has files we expect
 
   $ ls .hg/store
   00changelog.i
   00manifest.i
   data
+  data-s
   fncache
   phaseroots
   requires
   undo
   undo.backupfiles
 
 manifest should be generaldelta
@@ -858,19 +859,20 @@
 
   $ ls -d .hg/upgradebackup.*/
   .hg/upgradebackup.*/ (glob)
   $ ls .hg/upgradebackup.*/store
   00changelog.i
   00manifest.i
   data
+  data-s
   fncache
   phaseroots
   requires
   undo
-  undo.backup.fncache
+  undo.backup.fncache.bck
   undo.backupfiles
 
 unless --no-backup is passed
 
   $ rm -rf .hg/upgradebackup.*/
   $ hg debugupgraderepo --run --no-backup
   note:    selecting all-filelogs for processing to change: sparserevlog
```

### Comparing `mercurial-6.4rc0/tests/test-url-download.t` & `mercurial-6.5rc0/tests/test-url-download.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-url-rev.t` & `mercurial-6.5rc0/tests/test-url-rev.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-url.py` & `mercurial-6.5rc0/tests/test-url.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-username-newline.t` & `mercurial-6.5rc0/tests/test-username-newline.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-util.py` & `mercurial-6.5rc0/tests/test-util.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-verify-repo-operations.py` & `mercurial-6.5rc0/tests/test-verify-repo-operations.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-verify.t` & `mercurial-6.5rc0/tests/test-verify.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-walk.t` & `mercurial-6.5rc0/tests/test-walk.t`

 * *Files 2% similar despite different names*

```diff
@@ -57,14 +57,45 @@
   f  fenugreek                       fenugreek
   f  fiddlehead                      fiddlehead
   f  mammals/Procyonidae/cacomistle  mammals/Procyonidae/cacomistle
   f  mammals/Procyonidae/coatimundi  mammals/Procyonidae/coatimundi
   f  mammals/Procyonidae/raccoon     mammals/Procyonidae/raccoon
   f  mammals/skunk                   mammals/skunk
 
+Test 'filepath:' pattern
+
+  $ hg debugwalk -v -I 'filepath:mammals/Procyonidae/cacomistle'
+  * matcher:
+  <includematcher includes=''>
+  f  mammals/Procyonidae/cacomistle  mammals/Procyonidae/cacomistle
+
+  $ hg debugwalk -v -I 'filepath:mammals/Procyonidae'
+  * matcher:
+  <includematcher includes=''>
+
+  $ hg debugwalk -v -X 'filepath:beans/borlotti'
+  * matcher:
+  <differencematcher
+    m1=<alwaysmatcher>,
+    m2=<includematcher includes=''>>
+  f  beans/black                     beans/black
+  f  beans/kidney                    beans/kidney
+  f  beans/navy                      beans/navy
+  f  beans/pinto                     beans/pinto
+  f  beans/turtle                    beans/turtle
+  f  fennel                          fennel
+  f  fenugreek                       fenugreek
+  f  fiddlehead                      fiddlehead
+  f  mammals/Procyonidae/cacomistle  mammals/Procyonidae/cacomistle
+  f  mammals/Procyonidae/coatimundi  mammals/Procyonidae/coatimundi
+  f  mammals/Procyonidae/raccoon     mammals/Procyonidae/raccoon
+  f  mammals/skunk                   mammals/skunk
+
+Test relative paths
+
   $ cd mammals
   $ hg debugwalk -v
   * matcher:
   <alwaysmatcher>
   f  beans/black                     ../beans/black
   f  beans/borlotti                  ../beans/borlotti
   f  beans/kidney                    ../beans/kidney
@@ -532,15 +563,15 @@
   <patternmatcher patterns='(?:|.*/)Procyonidae/.*$|fennel(?:/|$)'>
   f  fennel                          fennel                          exact
   f  mammals/Procyonidae/cacomistle  mammals/Procyonidae/cacomistle
   f  mammals/Procyonidae/coatimundi  mammals/Procyonidae/coatimundi
   f  mammals/Procyonidae/raccoon     mammals/Procyonidae/raccoon
   $ hg debugwalk -v beans 'glob:beans/*'
   * matcher:
-  <patternmatcher patterns='beans(?:/|$)|beans/[^/]*$'>
+  <patternmatcher patterns='beans/[^/]*$|beans(?:/|$)'>
   f  beans/black     beans/black
   f  beans/borlotti  beans/borlotti
   f  beans/kidney    beans/kidney
   f  beans/navy      beans/navy
   f  beans/pinto     beans/pinto
   f  beans/turtle    beans/turtle
   $ hg debugwalk -v 'glob:mamm**'
```

### Comparing `mercurial-6.4rc0/tests/test-walkrepo.py` & `mercurial-6.5rc0/tests/test-walkrepo.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-websub.t` & `mercurial-6.5rc0/tests/test-websub.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-win32text.t` & `mercurial-6.5rc0/tests/test-win32text.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-wireproto-clientreactor.py` & `mercurial-6.5rc0/tests/test-wireproto-clientreactor.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-wireproto-framing.py` & `mercurial-6.5rc0/tests/test-wireproto-framing.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-wireproto-serverreactor.py` & `mercurial-6.5rc0/tests/test-wireproto-serverreactor.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-wireproto.py` & `mercurial-6.5rc0/tests/test-wireproto.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-wireproto.t` & `mercurial-6.5rc0/tests/test-wireproto.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-worker.t` & `mercurial-6.5rc0/tests/test-worker.t`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/test-wsgirequest.py` & `mercurial-6.5rc0/tests/test-wsgirequest.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/badserverext.py` & `mercurial-6.5rc0/tests/testlib/badserverext.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/crash_transaction_late.py` & `mercurial-6.5rc0/tests/testlib/crash_transaction_late.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/exchange-obsmarker-util.sh` & `mercurial-6.5rc0/tests/testlib/exchange-obsmarker-util.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/ext-phase-report.py` & `mercurial-6.5rc0/tests/testlib/ext-phase-report.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/ext-sidedata-2.py` & `mercurial-6.5rc0/tests/testlib/ext-sidedata-2.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/ext-sidedata-3.py` & `mercurial-6.5rc0/tests/testlib/ext-sidedata-3.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/ext-sidedata-4.py` & `mercurial-6.5rc0/tests/testlib/ext-sidedata-4.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/ext-sidedata-5.py` & `mercurial-6.5rc0/tests/testlib/ext-sidedata-5.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/ext-sidedata.py` & `mercurial-6.5rc0/tests/testlib/ext-sidedata.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/merge-combination-util.sh` & `mercurial-6.5rc0/tests/testlib/merge-combination-util.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/persistent-nodemap-race-ext.py` & `mercurial-6.5rc0/tests/testlib/persistent-nodemap-race-ext.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-"""Create the race condition for issue6554
+r"""Create the race condition for issue6554
 
 The persistent nodemap issues had an issue where a second writer could
 overwrite the data that a previous write just wrote. The would break the append
 only garantee of the persistent nodemap and could confuse reader. This
 extensions create all the necessary synchronisation point to the race condition
 to happen.
```

### Comparing `mercurial-6.4rc0/tests/testlib/push-checkheads-util.sh` & `mercurial-6.5rc0/tests/testlib/push-checkheads-util.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/sigpipe-remote.py` & `mercurial-6.5rc0/tests/testlib/sigpipe-remote.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/stream_clone_setup.sh` & `mercurial-6.5rc0/tests/testlib/stream_clone_setup.sh`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/testlib/wait-on-file` & `mercurial-6.5rc0/tests/testlib/wait-on-file`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/tinyproxy.py` & `mercurial-6.5rc0/tests/tinyproxy.py`

 * *Files identical despite different names*

### Comparing `mercurial-6.4rc0/tests/wireprotohelpers.sh` & `mercurial-6.5rc0/tests/wireprotohelpers.sh`

 * *Files identical despite different names*

