# Comparing `tmp/mail_devel-0.3.0-py3-none-any.whl.zip` & `tmp/mail_devel-0.4.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,19 +1,19 @@
-Zip file size: 14646 bytes, number of entries: 17
--rw-r--r--  2.0 unx       48 b- defN 23-Jun-14 19:32 mail_devel/__init__.py
--rw-r--r--  2.0 unx     1668 b- defN 23-Jun-14 19:32 mail_devel/__main__.py
--rw-r--r--  2.0 unx     8195 b- defN 23-Jun-14 19:32 mail_devel/http.py
--rw-r--r--  2.0 unx      410 b- defN 23-Jun-14 19:32 mail_devel/mailbox.py
--rw-r--r--  2.0 unx     8275 b- defN 23-Jun-14 19:32 mail_devel/service.py
--rw-r--r--  2.0 unx     1929 b- defN 23-Jun-14 19:32 mail_devel/smtp.py
--rw-r--r--  2.0 unx     2708 b- defN 23-Jun-14 19:32 mail_devel/utils.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-14 19:32 mail_devel/resources/__init__.py
--rw-r--r--  2.0 unx     2356 b- defN 23-Jun-14 19:32 mail_devel/resources/index.html
--rw-r--r--  2.0 unx     2681 b- defN 23-Jun-14 19:32 mail_devel/resources/main.css
--rw-r--r--  2.0 unx     6395 b- defN 23-Jun-14 19:32 mail_devel/resources/main.js
--rw-r--r--  2.0 unx     1085 b- defN 23-Jun-14 19:33 mail_devel-0.3.0.dist-info/LICENSE
--rw-r--r--  2.0 unx     1478 b- defN 23-Jun-14 19:33 mail_devel-0.3.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jun-14 19:33 mail_devel-0.3.0.dist-info/WHEEL
--rw-r--r--  2.0 unx       56 b- defN 23-Jun-14 19:33 mail_devel-0.3.0.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       11 b- defN 23-Jun-14 19:33 mail_devel-0.3.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1381 b- defN 23-Jun-14 19:33 mail_devel-0.3.0.dist-info/RECORD
-17 files, 38768 bytes uncompressed, 12376 bytes compressed:  68.1%
+Zip file size: 16617 bytes, number of entries: 17
+-rw-r--r--  2.0 unx       48 b- defN 23-Jun-22 16:21 mail_devel/__init__.py
+-rw-r--r--  2.0 unx     1668 b- defN 23-Jun-22 16:21 mail_devel/__main__.py
+-rw-r--r--  2.0 unx    10723 b- defN 23-Jun-22 16:21 mail_devel/http.py
+-rw-r--r--  2.0 unx      410 b- defN 23-Jun-22 16:21 mail_devel/mailbox.py
+-rw-r--r--  2.0 unx     8877 b- defN 23-Jun-22 16:21 mail_devel/service.py
+-rw-r--r--  2.0 unx     1929 b- defN 23-Jun-22 16:21 mail_devel/smtp.py
+-rw-r--r--  2.0 unx     2708 b- defN 23-Jun-22 16:21 mail_devel/utils.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-22 16:21 mail_devel/resources/__init__.py
+-rw-r--r--  2.0 unx     3613 b- defN 23-Jun-22 16:21 mail_devel/resources/index.html
+-rw-r--r--  2.0 unx     3404 b- defN 23-Jun-22 16:21 mail_devel/resources/main.css
+-rw-r--r--  2.0 unx    10813 b- defN 23-Jun-22 16:21 mail_devel/resources/main.js
+-rw-r--r--  2.0 unx     1085 b- defN 23-Jun-22 16:22 mail_devel-0.4.0.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1479 b- defN 23-Jun-22 16:22 mail_devel-0.4.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jun-22 16:22 mail_devel-0.4.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx       56 b- defN 23-Jun-22 16:22 mail_devel-0.4.0.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       11 b- defN 23-Jun-22 16:22 mail_devel-0.4.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1383 b- defN 23-Jun-22 16:22 mail_devel-0.4.0.dist-info/RECORD
+17 files, 48299 bytes uncompressed, 14347 bytes compressed:  70.3%
```

## zipnote {}

```diff
@@ -27,26 +27,26 @@
 
 Filename: mail_devel/resources/main.css
 Comment: 
 
 Filename: mail_devel/resources/main.js
 Comment: 
 
-Filename: mail_devel-0.3.0.dist-info/LICENSE
+Filename: mail_devel-0.4.0.dist-info/LICENSE
 Comment: 
 
-Filename: mail_devel-0.3.0.dist-info/METADATA
+Filename: mail_devel-0.4.0.dist-info/METADATA
 Comment: 
 
-Filename: mail_devel-0.3.0.dist-info/WHEEL
+Filename: mail_devel-0.4.0.dist-info/WHEEL
 Comment: 
 
-Filename: mail_devel-0.3.0.dist-info/entry_points.txt
+Filename: mail_devel-0.4.0.dist-info/entry_points.txt
 Comment: 
 
-Filename: mail_devel-0.3.0.dist-info/top_level.txt
+Filename: mail_devel-0.4.0.dist-info/top_level.txt
 Comment: 
 
-Filename: mail_devel-0.3.0.dist-info/RECORD
+Filename: mail_devel-0.4.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mail_devel/__init__.py

```diff
@@ -1,3 +1,3 @@
 from .service import Service
 
-VERSION = "0.3.0"
+VERSION = "0.4.0"
```

## mail_devel/http.py

```diff
@@ -1,37 +1,45 @@
 import logging
 import sys
+import uuid
+from datetime import datetime
 from email import message_from_bytes
+from email.message import EmailMessage
 from importlib import resources
 
 from aiohttp import web
 from aiohttp.web import Request, Response
 from pymap.backend.dict import MailboxSet
 from pymap.backend.dict.mailbox import Message
+from pymap.parsing.message import AppendMessage
 from pymap.parsing.specials.flag import Flag
 
 _logger = logging.getLogger(__name__)
 
 
 def flags_to_api(flags):
     return [f.value.decode().strip("\\").lower() for f in flags]
 
 
 class Frontend:
     def __init__(
         self,
         mailbox_set: MailboxSet,
+        user: str,
         host: str = "",
         port: int = 8080,
         devel: bool = False,
+        flagged_seen: bool = False,
     ):
         self.mailbox_set = mailbox_set
         self.api = None
         self.devel = devel
         self.host, self.port = host, port
+        self.user = user
+        self.flagged_seen = flagged_seen
 
     def load_resource(self, resource: str) -> str:
         if self.devel:
             with open(resource, encoding="utf-8") as fp:
                 return fp.read()
 
         package = f"{__package__}.resources"
@@ -51,17 +59,19 @@
     async def start(self) -> None:
         self.api = web.Application()
 
         self.api.add_routes(
             [
                 web.get("/", self._page_index),
                 web.get(r"/{static:.*\.(css|js)}", self._page_static),
+                web.post(r"/api", self._api_post),
                 web.get(r"/api", self._api_index),
                 web.get(r"/api/{mailbox}", self._api_mailbox),
                 web.get(r"/api/{mailbox}/{uid:\d+}", self._api_message),
+                web.get(r"/api/{mailbox}/{uid:\d+}/reply", self._api_reply),
                 web.get(
                     r"/api/{mailbox}/{uid:\d+}/attachment/{attachment}",
                     self._api_attachment,
                 ),
                 web.get(r"/api/{mailbox}/{uid:\d+}/flags", self._api_flag),
                 web.put(r"/api/{mailbox}/{uid:\d+}/flags/{flag}", self._api_flag),
                 web.delete(r"/api/{mailbox}/{uid:\d+}/flags/{flag}", self._api_flag),
@@ -125,26 +135,52 @@
 
                 if cdispo == "attachment":
                     result["attachments"].append(part.get_filename())
                 elif ctype == "text/plain":
                     result["body_plain"] = part.get_payload(decode=True).decode()
                 elif ctype == "text/html":
                     result["body_html"] = part.get_payload(decode=True).decode()
-        elif part.get_content_type() == "text/html":
+        elif message.get_content_type() == "text/html":
             result["body_html"] = message.get_payload(decode=True).decode()
         else:
             result["body_plain"] = message.get_payload(decode=True).decode()
 
         result["content"] = bytes(content).decode()
         return result
 
     async def _api_index(self, request: Request) -> Response:  # pylint: disable=W0613
         mailboxes = await self.mailbox_set.list_mailboxes()
         return web.json_response([e.name for e in mailboxes.list()])
 
+    async def _api_post(self, request: Request) -> Response:
+        data = await request.json()
+        if not isinstance(data, dict):
+            raise web.HTTPBadRequest()
+
+        header, body = map(data.get, ("header", "body"))
+        if not isinstance(header, dict) or not isinstance(body, str):
+            raise web.HTTPBadRequest()
+
+        message = EmailMessage()
+        for key, value in header.items():
+            if key.strip() and value.strip():
+                message.add_header(key.title(), value)
+
+        message.set_content(body)
+
+        mailbox = await self.mailbox_set.get_mailbox("INBOX")
+        await mailbox.append(
+            AppendMessage(
+                literal=str(message).encode(),
+                when=datetime.now(),
+                flag_set=frozenset({Flag(b"\\Seen")} if self.flagged_seen else []),
+            )
+        )
+        return web.json_response({"status": "ok"})
+
     async def _api_mailbox(self, request: Request) -> Response:
         try:
             name = request.match_info["mailbox"]
             mailbox = await self.mailbox_set.get_mailbox(name)
         except KeyError as e:
             raise web.HTTPNotFound() from e
 
@@ -163,14 +199,42 @@
 
         async for msg in mailbox.messages():
             if msg.uid == uid:
                 return web.json_response(await self._convert_message(msg, True))
 
         raise web.HTTPNotFound()
 
+    async def _api_reply(self, request: Request) -> Response:
+        try:
+            name = request.match_info["mailbox"]
+            uid = int(request.match_info["uid"])
+            mailbox = await self.mailbox_set.get_mailbox(name)
+        except (IndexError, KeyError) as e:
+            raise web.HTTPNotFound() from e
+
+        async for msg in mailbox.messages():
+            if msg.uid == uid:
+                message = await self._convert_message(msg, True)
+                headers = message["header"]
+                headers["subject"] = f"RE: {headers['subject']}"
+                msg_id = headers.get("message-id", None)
+                if msg_id:
+                    headers["in-reply-to"] = msg_id
+                    headers["references"] = f"{msg_id} {headers.get('references', '')}"
+                headers["message-id"] = f"{uuid.uuid4()}@mail-devel"
+                headers["to"] = headers["from"]
+                headers["from"] = self.user
+                headers.pop("content-type", None)
+                for key in list(headers):
+                    if key.startswith("x-"):
+                        headers.pop(key, None)
+                return web.json_response(message)
+
+        raise web.HTTPNotFound()
+
     async def _api_attachment(self, request: Request) -> Response:
         try:
             name = request.match_info["mailbox"]
             uid = int(request.match_info["uid"])
             attachment = request.match_info["attachment"]
             mailbox = await self.mailbox_set.get_mailbox(name)
         except (IndexError, KeyError) as e:
```

## mail_devel/service.py

```diff
@@ -1,11 +1,12 @@
 import argparse
 import asyncio
 import logging
 import os
+import secrets
 from contextlib import AsyncExitStack, asynccontextmanager
 from typing import List, TypeVar
 
 from aiosmtpd.controller import Controller
 from pymap.backend.dict import DictBackend, FilterSet
 from pymap.imap import IMAPService
 
@@ -101,17 +102,19 @@
                 authenticator=Authenticator(args.user, args.password),
             )
 
         # Create the HTTP service
         if args.http:
             service.frontend = Frontend(
                 service.mailbox_set,
+                user=args.user,
                 host=args.http_host or args.host,
                 port=args.http_port,
                 devel=args.devel,
+                flagged_seen=args.flagged_seen,
             )
 
         return service
 
     @asynccontextmanager
     async def start(self) -> None:
         loop = asyncio.get_event_loop()
@@ -131,25 +134,34 @@
 
     @classmethod
     def parse(cls, args: List[str] = None) -> argparse.ArgumentParser:
         parser = argparse.ArgumentParser()
         parser.add_argument(
             "--host",
             default=os.environ.get("MAIL_HOST", ""),
-            help="The IP to bind the listening server ports. Default is %(default)s",
+            help="The IP to bind the listening server ports. Can also be set using "
+            "the environment variable MAIL_HOST. Default is %(default)s",
         )
         parser.add_argument(
             "--user",
             default=os.environ.get("MAIL_USER", "test@example.org"),
-            help="The user account for SMTP and IMAP. Default is %(default)s",
+            help="The user account for SMTP and IMAP. Can also be set using "
+            "the environment variable MAIL_USER. Default is %(default)s",
         )
         pw = parser.add_argument(
             "--password",
             default=os.environ.get("MAIL_PASSWORD"),
-            help="The password for SMTP and IMAP",
+            help="The password for SMTP and IMAP. Can also be set using the "
+            "environment variable MAIL_PASSWORD",
+        )
+        parser.add_argument(
+            "--gen-password",
+            default=False,
+            action="store_true",
+            help="Generate the SMTP and IMAP password and print at start",
         )
 
         group = parser.add_argument_group("IMAP")
         parser.add_argument(
             "--imap-host",
             default=False,
             help="Overrules the IP binding specifically for IMAP",
@@ -242,10 +254,12 @@
             default=None,
             metavar="FILE",
             type=utils.valid_file,
             help="TLS key file",
         )
 
         args = parser.parse_args(args)
+        if args.gen_password:
+            args.password = secrets.token_hex(16)
         if not args.password:
             raise argparse.ArgumentError(pw, "Missing argument `password`")
         return args
```

## mail_devel/resources/index.html

```diff
@@ -10,14 +10,15 @@
 </head>
 
 <body>
   <div id="wrapper">
     <div id="nav" class="container">
       <div id="logo">mail<span class="highlight">devel</span></div>
 
+      <button id="btn-new" type="button">Send Mail</button>
       <select id="mailboxes" name="mailboxes" multiple="multiple">
       </select>
     </div>
 
     <div id="mailbox" class="container">
       <table>
         <thead>
@@ -28,15 +29,15 @@
             <th id="mailbox-date">Date</th>
           </tr>
         </thead>
         <tbody></tbody>
       </table>
     </div>
 
-    <table id="header">
+    <table id="header" class="header">
       <tr id="header-from">
         <th>From:</th>
         <td><input type="text" readonly="readonly"/></td>
       </tr>
       <tr id="header-to">
         <th>To:</th>
         <td><input type="text" readonly="readonly"/></td>
@@ -49,17 +50,18 @@
         <th>BCC:</th>
         <td><input type="text" readonly="readonly"/></td>
       </tr>
       <tr id="header-subject">
         <th>Subject:</th>
         <td><input type="text" readonly="readonly"/></td>
       </tr>
-      <tr id="header-button">
+      <tr id="header-button" class="buttons">
         <th></th>
         <td>
+          <button id="btn-reply" type="button">Reply</button>
           <button id="btn-html" type="button">Show HTML</button>
           <button id="btn-plain" type="button">Show Plain</button>
           <button id="btn-source" type="button">Show Source</button>
           <button id="btn-seen" type="button">Seen</button>
           <button id="btn-unseen" type="button">Unseen</button>
           <div id="btn-dropdown">
             <button type="button">Attachments</button>
@@ -72,13 +74,53 @@
     <div id="content" class="container">
       <iframe id="html"></iframe>
       <textarea id="plain" readonly="readonly"></textarea>
       <textarea id="source" readonly="readonly"></textarea>
     </div>
   </div>
 
+  <div id="editor" class="hidden">
+    <div id="editor-buttons" class="buttons">
+      <button id="btn-send">Send</button>
+      <button id="btn-add-header">Add Header</button>
+      <button id="btn-advanced"></button>
+      <button id="btn-cancel">Cancel</button>
+    </div>
+
+    <table id="editor-header" class="header">
+      <tr id="editor-from">
+        <th>From:</th>
+        <td><input type="text"/></td>
+        <td class="control"></td>
+      </tr>
+      <tr id="editor-to">
+        <th>To:</th>
+        <td><input type="text"/></td>
+        <td class="control"></td>
+      </tr>
+      <tr id="editor-cc">
+        <th>CC:</th>
+        <td><input type="text"/></td>
+        <td class="control"></td>
+      </tr>
+      <tr id="editor-bcc">
+        <th>BCC:</th>
+        <td><input type="text"/></td>
+        <td class="control"></td>
+      </tr>
+      <tr id="editor-subject">
+        <th>Subject:</th>
+        <td><input type="text"/></td>
+        <td class="control"></td>
+      </tr>
+    </table>
+    <div id="editor-content" class="container">
+      <textarea></textarea>
+    </div>
+  </div>
+
   <script>
     const client = new MailClient();
     client.initialize();
   </script>
 </body>
 </html>
```

### html2text {}

```diff
@@ -3,9 +3,15 @@
 maildevel
 From To Subject Date
 From:    [                    ]
 To:      [                    ]
 CC:      [                    ]
 BCC:     [                    ]
 Subject: [                    ]
-         Show HTML Show Plain Show Source Seen Unseen
+         Reply Show HTML Show Plain Show Source Seen Unseen
          Attachments
+Send Add Header  Cancel
+From:    [                    ]
+To:      [                    ]
+CC:      [                    ]
+BCC:     [                    ]
+Subject: [                    ]
```

## mail_devel/resources/main.css

```diff
@@ -17,29 +17,33 @@
 }
 
 html, body {
   height: 100%;
   margin: 0;
 }
 
-body, input, select, textarea, table {
+body, input, select, textarea, table, #editor {
   background-color: var(--back);
   color: var(--primary);
 }
 
+button {
+  text-transform: capitalize;
+}
+
 #wrapper {
   display: grid;
   height: 100%;
   grid-template-areas: "nav mailbox" "nav header" "nav content";
   grid-template-columns: 200px auto;
   grid-template-rows: 30% 150px auto;
 }
 
 *:focus-visible {outline: none}
-.hidden {display: none}
+.hidden {display: none !important}
 .highlight {color: #469}
 .selected {background-color: var(--highlight)}
 .unseen {font-weight: bold}
 
 #content {grid-area: content}
 #mailbox {grid-area: mailbox}
 #nav {
@@ -83,43 +87,44 @@
 #logo {
   font-family: monospace;
   font-size: 20pt;
   padding: 5% 0;
   text-align: center;
 }
 
-#header {
+.header {
   background-color: var(--highlight);
   border-bottom: 2px solid var(--border);
   border-top: 2px solid var(--border);
 }
-#header th {
+.header th {
   text-align: right;
   width: 100px;
 }
-#header #header-button td {text-align: right}
-#header button {margin-right: 5px}
-#header td {position: relative;}
-#header input {
+.header .buttons td {text-align: right}
+.header td {position: relative;}
+.header input {
   position: absolute;
   left: 5px;
   right: 5px;
   top: 0;
 }
 
-#content {height: 100%; overflow: hidden}
-#content textarea, #content iframe {
+.buttons button {margin-right: 5px}
+
+.container {height: 100%; overflow: hidden}
+.container textarea, .container iframe {
   border: 0;
   margin: 0;
   padding: 0;
   height: 100%;
   resize: none;
   width: 100%;
 }
-#content textarea {box-sizing: border-box; padding: 5px}
+.container textarea {box-sizing: border-box; padding: 5px}
 
 #btn-dropdown button {
   cursor: pointer;
 }
 #btn-dropdown {
   position: relative;
   display: inline-block;
@@ -134,7 +139,48 @@
 #btn-dropdown a {
   display: block;
   margin: 3px;
   text-align: center;
 }
 #btn-dropdown:hover div {display: block}
 #btn-dropdown a:hover {background: var(--highlight)}
+
+#editor {
+  display: grid;
+  z-index: 1000;
+  position: fixed;
+  border: 2px solid var(--border);
+  top: 150px;
+  left: 150px;
+  bottom: 150px;
+  right: 150px;
+  grid-template-rows: max-content max-content auto;
+}
+
+#editor-content {
+  display: block;
+  height: 100%;
+}
+#editor-header {
+  display: block;
+  max-height: 200px;
+  overflow-y: scroll;
+  padding: 3px;
+}
+#editor-header th {
+  position: relative;
+  min-width: 150px;
+}
+#editor-header .delete {
+  content: "&#128465;";
+}
+#editor-buttons {
+  background-color: var(--highlight);
+  text-align: right;
+  padding: 3px;
+}
+#editor-header td {width: 100%}
+#editor-header .control {
+  min-width: 20px;
+}
+
+
```

## mail_devel/resources/main.js

### js-beautify {}

```diff
@@ -1,31 +1,53 @@
+function element(tag, attrs) {
+    const ele = document.createElement(tag);
+    if (!attrs)
+        return ele;
+
+    for (let key in attrs)
+        ele.setAttribute(key, attrs[key]);
+    return ele;
+}
+
 function vis(selector, visible) {
-    if (visible)
-        document.querySelector(selector).classList.remove("hidden");
-    else
-        document.querySelector(selector).classList.add("hidden");
+    const elements = document.querySelectorAll(selector);
+    if (!elements)
+        return
+
+    for (const element of elements)
+        if (visible)
+            element.classList.remove("hidden");
+        else
+            element.classList.add("hidden");
 }
 
 class MailClient {
     constructor() {
         this.mailboxes = document.getElementById("mailboxes");
         this.mailbox = document.querySelector("#mailbox table tbody");
+        this.fixed_headers = ["from", "to", "cc", "bcc", "subject"];
         this.mailbox_name = null;
         this.mail_uid = null;
         this.mail_selected = null;
         this.content_mode = "html";
+        this.editor_mode = "simple";
     }
 
     async visibility() {
         vis("#btn-html", this.content_mode !== "html");
         vis("#btn-plain", this.content_mode !== "plain");
         vis("#btn-source", this.content_mode !== "source");
         vis("#content iframe#html", this.content_mode === "html");
         vis("#content textarea#plain", this.content_mode === "plain");
         vis("#content textarea#source", this.content_mode === "source");
+        vis("#editor .header .extra", this.editor_mode === "advanced");
+
+        document.getElementById("btn-advanced").innerText = (
+            `${this.editor_mode === "simple" ? "Advanced" : "Simple"} View`
+        );
     }
 
     async idle() {
         const self = this;
 
         await this.fetch_mailboxes();
         if (this.mailbox_name)
@@ -54,14 +76,35 @@
 
             return await response.json();
         } catch (TypeError) {
             return null;
         }
     }
 
+    async post_data(data, ...path) {
+        try {
+            const response = await fetch(
+                path.length ? `/api/${path.join('/')}` : "/api", {
+                    method: "POST",
+                    headers: {
+                        "Accept": "application/json",
+                        "Content-Type": "application/json",
+                    },
+                    body: JSON.stringify(data),
+                },
+            );
+            if (response.status !== 200)
+                return null;
+
+            return await response.json();
+        } catch (TypeError) {
+            return null;
+        }
+    }
+
     async _mail_row(row, msg) {
         const self = this;
 
         if ((msg?.flags || []).indexOf("seen") < 0)
             row.classList.add("unseen");
         else
             row.classList.remove("unseen");
@@ -153,15 +196,15 @@
             }
 
             if (!found)
                 missing_msg.push(msg);
         }
 
         for (const msg of missing_msg) {
-            const row = document.createElement("tr");
+            const row = element("tr");
             this.mailbox.append(row);
             row.uid = msg.uid;
             await self._mail_row(row, msg);
         }
 
         for (const line of this.mailbox.children) {
             if (uids.indexOf(line.uid) < 0)
@@ -198,14 +241,108 @@
 
         if (!data?.body_html && self.content_mode === "html")
             self.content_mode = "plain";
 
         await self.visibility();
     }
 
+    async add_header(key = null, value = null) {
+        const table = document.getElementById("editor-header");
+        const row = element("tr", {
+            "class": "extra"
+        });
+        const key_td = element("th"),
+            value_td = element("td"),
+            btn_td = element("td");
+        const btn = element("button", {
+            "type": "button",
+            "class": "delete"
+        });
+        const key_input = element("input", {
+            "type": "input"
+        });
+        const value_input = element("input", {
+            "type": "input"
+        });
+
+        btn.innerHTML = "&#10006;";
+        if (key) key_input.value = key;
+        if (value) value_input.value = value;
+
+        key_td.append(key_input);
+        value_td.append(value_input);
+        btn_td.append(btn);
+
+        btn.addEventListener("click", (ev) => {
+            row.remove();
+        });
+
+        row.append(key_td);
+        row.append(value_td);
+        row.append(btn_td);
+        table.append(row);
+
+        await this.visibility();
+    }
+
+    async send_mail() {
+        const headers = {};
+        for (const key of this.fixed_headers)
+            headers[key] = document.querySelector(`#editor-${key} input`).value;
+
+        for (const row of document.querySelectorAll("#editor .header .extra")) {
+            const inputs = row.querySelectorAll("input");
+            if (inputs.length < 2)
+                continue;
+
+            const key = inputs[0].value.trim().toLowerCase();
+            const value = inputs[1].value.trim().toLowerCase();
+            if (key && value && !this.fixed_headers.includes(key))
+                headers[key] = value;
+        }
+
+        await this.post_data({
+            header: headers,
+            body: document.querySelector("#editor-content textarea").value,
+        });
+
+        document.querySelector("#editor").classList.add("hidden");
+        await this.reset_editor();
+    }
+
+    async reply_mail() {
+        if (!this.mailbox_name || !this.mail_uid)
+            return;
+
+        const data = await this.fetch_data(this.mailbox_name, this.mail_uid, "reply");
+        if (data === null)
+            return;
+
+        await this.reset_editor(data.header || {});
+        document.querySelector("#editor").classList.remove("hidden");
+    }
+
+    async reset_editor(header = null, body = null) {
+        for (const row of document.querySelectorAll("#editor .header .extra"))
+            row.remove();
+
+        if (header)
+            for (const key in header) {
+                if (!this.fixed_headers.includes(key))
+                    await this.add_header(key, header[key]);
+            }
+
+        for (const key of this.fixed_headers) {
+            const element = document.querySelector(`#editor-${key} input`);
+            element.value = (header && header[key]) ? header[key] : "";
+        }
+
+        document.querySelector("#editor-content textarea").value = body || "";
+    }
+
     async initialize() {
         const self = this;
         this.mailboxes.addEventListener("change", (ev) => {
             self.fetch_mailbox(ev.target.value);
         });
         document.getElementById("btn-html").addEventListener("click", () => {
             self.content_mode = "html";
@@ -221,12 +358,32 @@
         });
         document.getElementById("btn-seen").addEventListener("click", (ev) => {
             self.set_flag("seen", "PUT");
         });
         document.getElementById("btn-unseen").addEventListener("click", (ev) => {
             self.set_flag("seen", "DELETE");
         });
+        document.getElementById("btn-new").addEventListener("click", (ev) => {
+            document.querySelector("#editor").classList.remove("hidden");
+        });
+        document.getElementById("btn-cancel").addEventListener("click", (ev) => {
+            document.querySelector("#editor").classList.add("hidden");
+            self.reset_editor();
+        });
+        document.getElementById("btn-send").addEventListener("click", (ev) => {
+            self.send_mail();
+        });
+        document.getElementById("btn-reply").addEventListener("click", (ev) => {
+            self.reply_mail();
+        });
+        document.getElementById("btn-advanced").addEventListener("click", (ev) => {
+            self.editor_mode = (self.editor_mode === "simple") ? "advanced" : "simple";
+            self.visibility();
+        });
+        document.getElementById("btn-add-header").addEventListener("click", (ev) => {
+            self.add_header();
+        });
 
         await this.visibility();
         await this.idle();
     }
 }
```

## Comparing `mail_devel-0.3.0.dist-info/LICENSE` & `mail_devel-0.4.0.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mail_devel-0.3.0.dist-info/METADATA` & `mail_devel-0.4.0.dist-info/METADATA`

 * *Files 6% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mail-devel
-Version: 0.3.0
+Version: 0.4.0
 Summary: IMAP and SMTP in memory test server
 Home-page: https://github.com/fkantelberg/mail-devel
 Author: Florian Kantelberg
 Author-email: florian.kantelberg@mailbox.org
 License: MIT
 Keywords: imap smtp development
 Classifier: License :: OSI Approved :: MIT License
@@ -24,15 +24,15 @@
 
 # mail-devel
 
 This tool combines an in-memory SMTP mail-sink with an IMAP server. All mails coming over SMTP
 are stored in the IMAP inbox. This can be used to test outgoing and incoming mail configurations.
 Built on top of [aiosmtpd](https://github.com/aio-libs/aiosmtpd) and [pymap](https://github.com/icgood/pymap/).
 
-The frontend is minimally showing the content of the mailbox. Please connect a proper mail client
+The frontend is minimally handling the content of the mailbox. Please connect a proper mail client
 like Thunderbird for more advanced usage.
 
 DO NOT USE FOR PRODUCTION.
 
 ### Supported
 
 - SMTP (optionally with STARTTLS)
```

