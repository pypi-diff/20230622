# Comparing `tmp/rayfed_nightly-0.1.0b20230620.dev0-py3-none-any.whl.zip` & `tmp/rayfed_nightly-0.1.0b20230621.dev0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,27 +1,27 @@
-Zip file size: 38981 bytes, number of entries: 25
--rw-r--r--  2.0 unx      853 b- defN 23-Jun-20 01:36 fed/__init__.py
--rw-r--r--  2.0 unx    15747 b- defN 23-Jun-20 01:36 fed/api.py
--rw-r--r--  2.0 unx    15662 b- defN 23-Jun-20 01:36 fed/barriers.py
--rw-r--r--  2.0 unx     3172 b- defN 23-Jun-20 01:36 fed/cleanup.py
--rw-r--r--  2.0 unx     2280 b- defN 23-Jun-20 01:36 fed/config.py
--rw-r--r--  2.0 unx     2877 b- defN 23-Jun-20 01:36 fed/fed_object.py
--rw-r--r--  2.0 unx     7908 b- defN 23-Jun-20 01:36 fed/tree_util.py
--rw-r--r--  2.0 unx     6735 b- defN 23-Jun-20 01:36 fed/utils.py
--rw-r--r--  2.0 unx      581 b- defN 23-Jun-20 01:36 fed/_private/__init__.py
--rw-r--r--  2.0 unx      581 b- defN 23-Jun-20 01:36 fed/_private/api.py
--rw-r--r--  2.0 unx     5021 b- defN 23-Jun-20 01:36 fed/_private/compatible_utils.py
--rw-r--r--  2.0 unx     1268 b- defN 23-Jun-20 01:36 fed/_private/constants.py
--rw-r--r--  2.0 unx     3837 b- defN 23-Jun-20 01:36 fed/_private/fed_actor.py
--rw-r--r--  2.0 unx     3825 b- defN 23-Jun-20 01:36 fed/_private/fed_call_holder.py
--rw-r--r--  2.0 unx     1017 b- defN 23-Jun-20 01:36 fed/_private/global_context.py
--rw-r--r--  2.0 unx     2859 b- defN 23-Jun-20 01:36 fed/_private/grpc_options.py
--rw-r--r--  2.0 unx     2386 b- defN 23-Jun-20 01:36 fed/_private/serialization_utils.py
--rw-r--r--  2.0 unx      581 b- defN 23-Jun-20 01:36 fed/grpc/__init__.py
--rw-r--r--  2.0 unx     5608 b- defN 23-Jun-20 01:36 fed/grpc/fed_pb2.py
--rw-r--r--  2.0 unx     2955 b- defN 23-Jun-20 01:36 fed/grpc/fed_pb2_grpc.py
--rw-r--r--  2.0 unx    11356 b- defN 23-Jun-20 01:38 rayfed_nightly-0.1.0b20230620.dev0.dist-info/LICENSE
--rw-r--r--  2.0 unx     7312 b- defN 23-Jun-20 01:38 rayfed_nightly-0.1.0b20230620.dev0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jun-20 01:38 rayfed_nightly-0.1.0b20230620.dev0.dist-info/WHEEL
--rw-r--r--  2.0 unx        4 b- defN 23-Jun-20 01:38 rayfed_nightly-0.1.0b20230620.dev0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2053 b- defN 23-Jun-20 01:38 rayfed_nightly-0.1.0b20230620.dev0.dist-info/RECORD
-25 files, 106570 bytes uncompressed, 35683 bytes compressed:  66.5%
+Zip file size: 39222 bytes, number of entries: 25
+-rw-r--r--  2.0 unx      853 b- defN 23-Jun-21 01:38 fed/__init__.py
+-rw-r--r--  2.0 unx    15747 b- defN 23-Jun-21 01:38 fed/api.py
+-rw-r--r--  2.0 unx    16436 b- defN 23-Jun-21 01:38 fed/barriers.py
+-rw-r--r--  2.0 unx     3172 b- defN 23-Jun-21 01:38 fed/cleanup.py
+-rw-r--r--  2.0 unx     2280 b- defN 23-Jun-21 01:38 fed/config.py
+-rw-r--r--  2.0 unx     2877 b- defN 23-Jun-21 01:38 fed/fed_object.py
+-rw-r--r--  2.0 unx     7908 b- defN 23-Jun-21 01:38 fed/tree_util.py
+-rw-r--r--  2.0 unx     6735 b- defN 23-Jun-21 01:38 fed/utils.py
+-rw-r--r--  2.0 unx      581 b- defN 23-Jun-21 01:38 fed/_private/__init__.py
+-rw-r--r--  2.0 unx      581 b- defN 23-Jun-21 01:38 fed/_private/api.py
+-rw-r--r--  2.0 unx     5021 b- defN 23-Jun-21 01:38 fed/_private/compatible_utils.py
+-rw-r--r--  2.0 unx     1268 b- defN 23-Jun-21 01:38 fed/_private/constants.py
+-rw-r--r--  2.0 unx     3837 b- defN 23-Jun-21 01:38 fed/_private/fed_actor.py
+-rw-r--r--  2.0 unx     3825 b- defN 23-Jun-21 01:38 fed/_private/fed_call_holder.py
+-rw-r--r--  2.0 unx     1017 b- defN 23-Jun-21 01:38 fed/_private/global_context.py
+-rw-r--r--  2.0 unx     2893 b- defN 23-Jun-21 01:38 fed/_private/grpc_options.py
+-rw-r--r--  2.0 unx     2386 b- defN 23-Jun-21 01:38 fed/_private/serialization_utils.py
+-rw-r--r--  2.0 unx      581 b- defN 23-Jun-21 01:38 fed/grpc/__init__.py
+-rw-r--r--  2.0 unx     5608 b- defN 23-Jun-21 01:38 fed/grpc/fed_pb2.py
+-rw-r--r--  2.0 unx     2955 b- defN 23-Jun-21 01:38 fed/grpc/fed_pb2_grpc.py
+-rw-r--r--  2.0 unx    11356 b- defN 23-Jun-21 01:40 rayfed_nightly-0.1.0b20230621.dev0.dist-info/LICENSE
+-rw-r--r--  2.0 unx     7312 b- defN 23-Jun-21 01:40 rayfed_nightly-0.1.0b20230621.dev0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jun-21 01:40 rayfed_nightly-0.1.0b20230621.dev0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        4 b- defN 23-Jun-21 01:40 rayfed_nightly-0.1.0b20230621.dev0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2053 b- defN 23-Jun-21 01:40 rayfed_nightly-0.1.0b20230621.dev0.dist-info/RECORD
+25 files, 107378 bytes uncompressed, 35924 bytes compressed:  66.5%
```

## zipnote {}

```diff
@@ -54,23 +54,23 @@
 
 Filename: fed/grpc/fed_pb2.py
 Comment: 
 
 Filename: fed/grpc/fed_pb2_grpc.py
 Comment: 
 
-Filename: rayfed_nightly-0.1.0b20230620.dev0.dist-info/LICENSE
+Filename: rayfed_nightly-0.1.0b20230621.dev0.dist-info/LICENSE
 Comment: 
 
-Filename: rayfed_nightly-0.1.0b20230620.dev0.dist-info/METADATA
+Filename: rayfed_nightly-0.1.0b20230621.dev0.dist-info/METADATA
 Comment: 
 
-Filename: rayfed_nightly-0.1.0b20230620.dev0.dist-info/WHEEL
+Filename: rayfed_nightly-0.1.0b20230621.dev0.dist-info/WHEEL
 Comment: 
 
-Filename: rayfed_nightly-0.1.0b20230620.dev0.dist-info/top_level.txt
+Filename: rayfed_nightly-0.1.0b20230621.dev0.dist-info/top_level.txt
 Comment: 
 
-Filename: rayfed_nightly-0.1.0b20230620.dev0.dist-info/RECORD
+Filename: rayfed_nightly-0.1.0b20230621.dev0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## fed/barriers.py

```diff
@@ -87,15 +87,16 @@
         event = get_from_two_dim_dict(self._events, upstream_seq_id, downstream_seq_id)
         event.set()
         logger.debug(f"Event set for {upstream_seq_id}")
         return fed_pb2.SendDataResponse(result="OK")
 
 
 async def _run_grpc_server(
-    port, event, all_data, party, lock, tls_config=None, grpc_options=None
+    port, event, all_data, party, lock,
+    server_ready_future, tls_config=None, grpc_options=None
 ):
     server = grpc.aio.server(options=grpc_options)
     fed_pb2_grpc.add_GrpcServiceServicer_to_server(
         SendDataService(event, all_data, party, lock), server
     )
 
     tls_enabled = fed_utils.tls_enabled(tls_config)
@@ -106,19 +107,21 @@
             root_certificates=ca_cert,
             require_client_auth=ca_cert is not None,
         )
         server.add_secure_port(f'[::]:{port}', server_credentials)
     else:
         server.add_insecure_port(f'[::]:{port}')
 
+    msg = f"Succeeded to add port {port}."
     await server.start()
     logger.info(
         f'Successfully start Grpc service with{"out" if not tls_enabled else ""} '
         'credentials.'
     )
+    server_ready_future.set_result((True, msg))
     await server.wait_for_termination()
 
 
 async def send_data_grpc(
     dest,
     data,
     upstream_seq_id,
@@ -298,32 +301,44 @@
         self._party = party
         self._tls_config = tls_config
         self.retry_policy = retry_policy
         config = fed_config.get_cluster_config()
         set_max_message_length(config.cross_silo_messages_max_size)
         # Workaround the threading coordinations
 
+        # Flag to see whether grpc server starts
+        self._server_ready_future = asyncio.Future()
+
         # All events for grpc waitting usage.
         self._events = {}  # map from (upstream_seq_id, downstream_seq_id) to event
         self._all_data = {}  # map from (upstream_seq_id, downstream_seq_id) to data
         self._lock = threading.Lock()
 
     async def run_grpc_server(self):
-        return await _run_grpc_server(
-            self._listen_addr[self._listen_addr.index(':') + 1 :],
-            self._events,
-            self._all_data,
-            self._party,
-            self._lock,
-            self._tls_config,
-            get_grpc_options(self.retry_policy),
-        )
+        try:
+            port = self._listen_addr[self._listen_addr.index(':') + 1 :]
+            await _run_grpc_server(
+                port,
+                self._events,
+                self._all_data,
+                self._party,
+                self._lock,
+                self._server_ready_future,
+                self._tls_config,
+                get_grpc_options(self.retry_policy),
+            )
+        except RuntimeError as err:
+            msg = f'Grpc server failed to listen to port: {port}' \
+                  f' Try another port by setting `listen_addr` into `cluster` config' \
+                  f' when calling `fed.init`. Grpc error msg: {err}'
+            self._server_ready_future.set_result((False, msg))
 
     async def is_ready(self):
-        return True
+        await self._server_ready_future
+        return self._server_ready_future.result()
 
     async def get_data(self, src_aprty, upstream_seq_id, curr_seq_id):
         self._stats["receive_op_count"] += 1
         data_log_msg = f"data for {curr_seq_id} from {upstream_seq_id} of {src_aprty}"
         logger.debug(f"Getting {data_log_msg}")
         with self._lock:
             if not key_exists_in_two_dim_dict(
@@ -372,15 +387,16 @@
         listen_addr=listen_addr,
         party=party,
         tls_config=tls_config,
         logging_level=logging_level,
         retry_policy=retry_policy,
     )
     recver_proxy_actor.run_grpc_server.remote()
-    assert ray.get(recver_proxy_actor.is_ready.remote())
+    server_state = ray.get(recver_proxy_actor.is_ready.remote())
+    assert server_state[0], server_state[1]
     logger.info("RecverProxy was successfully created.")
 
 
 _SEND_PROXY_ACTOR = None
 
 
 def start_send_proxy(
```

## fed/_private/grpc_options.py

```diff
@@ -85,8 +85,9 @@
                             'name': [{'service': _GRPC_SERVICE}],
                             'retryPolicy': retry_policy,
                         }
                     ]
                 }
             ),
         ),
+        ('grpc.so_reuseport', 0),
     ]
```

## Comparing `rayfed_nightly-0.1.0b20230620.dev0.dist-info/LICENSE` & `rayfed_nightly-0.1.0b20230621.dev0.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `rayfed_nightly-0.1.0b20230620.dev0.dist-info/METADATA` & `rayfed_nightly-0.1.0b20230621.dev0.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: rayfed-nightly
-Version: 0.1.0b20230620.dev0
+Version: 0.1.0b20230621.dev0
 Summary: A multiple parties joint, distributed execution engine based on Ray,to help build your own federated learning frameworks in minutes.
 Home-page: https://github.com/ray-project/rayfed
 Author: RayFed Team
 Author-email: rayfed-dev@googlegroups.com
 License: Apache 2.0
 Platform: UNKNOWN
 Description-Content-Type: text/markdown
@@ -122,20 +122,20 @@
 
 ### Step 4: Declare Cross-party Cluster & Init 
 ```python
 def main(party):
     ray.init(address='local')
 
     cluster = {
-        'alice': {'address': '127.0.0.1:11010'},
+        'alice': {'address': '127.0.0.1:11012'},
         'bob': {'address': '127.0.0.1:11011'},
     }
     fed.init(cluster=cluster, party=party)
 ```
-This first declares a two-party cluster, whose addresses corresponding to '127.0.0.1:11010' in 'alice' and '127.0.0.1:11011' in 'bob'.
+This first declares a two-party cluster, whose addresses corresponding to '127.0.0.1:11012' in 'alice' and '127.0.0.1:11011' in 'bob'.
 And then, the `fed.init` create a cluster in the specified party.
 Note that `fed.init` should be called twice, passing in the different party each time.
 
 When executing codes in step 1~3, the 'alice' cluster will only execute functions whose "party" are also declared as 'alice'.
 
 ### Put it together !
 Save below codes as `demo.py`: 
@@ -160,15 +160,15 @@
     return val1 + val2
 
 
 def main(party):
     ray.init(address='local')
 
     cluster = {
-        'alice': {'address': '127.0.0.1:11010'},
+        'alice': {'address': '127.0.0.1:11012'},
         'bob': {'address': '127.0.0.1:11011'},
     }
     fed.init(cluster=cluster, party=party)
 
     actor_alice = MyActor.party("alice").remote(1)
     actor_bob = MyActor.party("bob").remote(1)
```

## Comparing `rayfed_nightly-0.1.0b20230620.dev0.dist-info/RECORD` & `rayfed_nightly-0.1.0b20230621.dev0.dist-info/RECORD`

 * *Files 13% similar despite different names*

```diff
@@ -1,25 +1,25 @@
 fed/__init__.py,sha256=6Xds1gLndBN-E4GBTuxnc7gf3Zw_D8iNejjA3JTjWnc,853
 fed/api.py,sha256=zX6J5f8pjbwQRY_kzzVQrbiGXZv8M9KEKXEJIlTbpqY,15747
-fed/barriers.py,sha256=ZBT8P4p7MXC8fqW7hQb6EWEHCU4GsAbNzCseEKicdqA,15662
+fed/barriers.py,sha256=cmO7sddg_JTyR0q9kytiz9GpX_mZx1ZiuBl5mcNNRQE,16436
 fed/cleanup.py,sha256=pYuljYQzeQg572MbbtxdAa1D2-_sZ9hd7Hi4qSippnA,3172
 fed/config.py,sha256=bpflURNHjH224XWM9BUgvMLzH-3BRzZJ_oX0PtdErrw,2280
 fed/fed_object.py,sha256=l2BRa9WZ3jqXSDjwFPURcAIK8XkH8A5UYA_OcY4TOD0,2877
 fed/tree_util.py,sha256=25LiGASBcreE34OsGsoeRWH4t6BuBk3QVcKjCe38jTI,7908
 fed/utils.py,sha256=FfvqkErgpJ7U9r5pm8rzjzAQhEvrZyI-xUkTfU6l5F0,6735
 fed/_private/__init__.py,sha256=MDXwlZ-y7_o-tfqh8DVkjlO-6MlWqwLdbSIZUJfXtF0,581
 fed/_private/api.py,sha256=MDXwlZ-y7_o-tfqh8DVkjlO-6MlWqwLdbSIZUJfXtF0,581
 fed/_private/compatible_utils.py,sha256=eLnZiO0xn4Ganrd1J5cCSu1gRjV9BhqEryrXQZANuFo,5021
 fed/_private/constants.py,sha256=r0vt4ueAsB3cyNVOQ8lJZgCCDosYHgNYZblaUfapk1o,1268
 fed/_private/fed_actor.py,sha256=8nqXO_l9yOno5duMiEhWagp9q9-w696erKos-RgcnoU,3837
 fed/_private/fed_call_holder.py,sha256=uJhmyq1nIn4nqJUg1bOqjgXrgFscZHsdpi5pXrXPF2M,3825
 fed/_private/global_context.py,sha256=dlfeqdp6C_5bGDvzHcxbR6xZGELfVyoQtDIZ4ampwZw,1017
-fed/_private/grpc_options.py,sha256=_r43xjQfg0JmD0T447wHV42EYhP0YpBubsGKG22TuN4,2859
+fed/_private/grpc_options.py,sha256=x9kEjqnOw0uGmixjfc3dsV0qxUUsF1ugK0q0pXHH4ek,2893
 fed/_private/serialization_utils.py,sha256=l63nacVabcyKpys9tVT2zUMmKecimeVflsJ6v45AYvc,2386
 fed/grpc/__init__.py,sha256=MDXwlZ-y7_o-tfqh8DVkjlO-6MlWqwLdbSIZUJfXtF0,581
 fed/grpc/fed_pb2.py,sha256=CKRJyBIx8MG4XtqtARL9ETFEyIsX2ksO0IVU9JgBhWQ,5608
 fed/grpc/fed_pb2_grpc.py,sha256=PsTotUwY4gEHWV0gQnPwpoQWdNJCczNZti6bJBYFj5Q,2955
-rayfed_nightly-0.1.0b20230620.dev0.dist-info/LICENSE,sha256=QwcOLU5TJoTeUhuIXzhdCEEDDvorGiC6-3YTOl4TecE,11356
-rayfed_nightly-0.1.0b20230620.dev0.dist-info/METADATA,sha256=cU_emYOPqQZo7yOoh66GL0xjPPrdOwWqB8nOqB_HXEA,7312
-rayfed_nightly-0.1.0b20230620.dev0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-rayfed_nightly-0.1.0b20230620.dev0.dist-info/top_level.txt,sha256=5gd1qhbpzLAi36ONV8p_s65_-iAiOSwFljYh-ONEwts,4
-rayfed_nightly-0.1.0b20230620.dev0.dist-info/RECORD,,
+rayfed_nightly-0.1.0b20230621.dev0.dist-info/LICENSE,sha256=QwcOLU5TJoTeUhuIXzhdCEEDDvorGiC6-3YTOl4TecE,11356
+rayfed_nightly-0.1.0b20230621.dev0.dist-info/METADATA,sha256=u1bNxhAhoXtbwsJl46LwBkkKTYx-3TGkYyxvU_wbq_Q,7312
+rayfed_nightly-0.1.0b20230621.dev0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+rayfed_nightly-0.1.0b20230621.dev0.dist-info/top_level.txt,sha256=5gd1qhbpzLAi36ONV8p_s65_-iAiOSwFljYh-ONEwts,4
+rayfed_nightly-0.1.0b20230621.dev0.dist-info/RECORD,,
```

